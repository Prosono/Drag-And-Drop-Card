var Po=Object.create;var hi=Object.defineProperty;var Io=Object.getOwnPropertyDescriptor;var Lo=Object.getOwnPropertyNames;var Fo=Object.getPrototypeOf,zo=Object.prototype.hasOwnProperty;var Do=(e,i)=>()=>(i||e((i={exports:{}}).exports,i),i.exports);var Ro=(e,i,a,c)=>{if(i&&typeof i=="object"||typeof i=="function")for(let d of Lo(i))!zo.call(e,d)&&d!==a&&hi(e,d,{get:()=>i[d],enumerable:!(c=Io(i,d))||c.enumerable});return e};var Bo=(e,i,a)=>(a=e!=null?Po(Fo(e)):{},Ro(i||!e||!e.__esModule?hi(a,"default",{value:e,enumerable:!0}):a,e));var fi=Do((xn,pt)=>{(function(e,i){typeof xn=="object"&&typeof pt!="undefined"?pt.exports=i():typeof define=="function"&&define.amd?define(i):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=i()})(xn,(function(){"use strict";function e(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),r.push.apply(r,o)}return r}function i(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e(Object(r),!0).forEach((function(o){h(n,o,r[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(r,o))}))}return n}function a(n){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(n)}function c(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function d(n,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,A(o.key),o)}}function u(n,t,r){return t&&d(n.prototype,t),r&&d(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function h(n,t,r){return(t=A(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function g(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&v(n,t)}function m(n){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(n)}function v(n,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},v(n,t)}function w(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _(n){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var r,o=m(n);if(t){var s=m(this).constructor;r=Reflect.construct(o,arguments,s)}else r=o.apply(this,arguments);return(function(l,p){if(p&&(typeof p=="object"||typeof p=="function"))return p;if(p!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w(l)})(this,r)}}function E(){return E=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(n,t,r){var o=(function(l,p){for(;!Object.prototype.hasOwnProperty.call(l,p)&&(l=m(l))!==null;);return l})(n,t);if(o){var s=Object.getOwnPropertyDescriptor(o,t);return s.get?s.get.call(arguments.length<3?n:r):s.value}},E.apply(this,arguments)}function A(n){var t=(function(r,o){if(typeof r!="object"||r===null)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var l=s.call(r,o||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)})(n,"string");return typeof t=="symbol"?t:t+""}var M=function(n){return!(!n||!n.Window)&&n instanceof n.Window},I=void 0,R=void 0;function F(n){I=n;var t=n.document.createTextNode("");t.ownerDocument!==n.document&&typeof n.wrap=="function"&&n.wrap(t)===t&&(n=n.wrap(n)),R=n}function T(n){return M(n)?n:(n.ownerDocument||n).defaultView||R.window}typeof window!="undefined"&&window&&F(window);var W=function(n){return!!n&&a(n)==="object"},z=function(n){return typeof n=="function"},k={window:function(n){return n===R||M(n)},docFrag:function(n){return W(n)&&n.nodeType===11},object:W,func:z,number:function(n){return typeof n=="number"},bool:function(n){return typeof n=="boolean"},string:function(n){return typeof n=="string"},element:function(n){if(!n||a(n)!=="object")return!1;var t=T(n)||R;return/object|function/.test(typeof Element=="undefined"?"undefined":a(Element))?n instanceof Element||n instanceof t.Element:n.nodeType===1&&typeof n.nodeName=="string"},plainObject:function(n){return W(n)&&!!n.constructor&&/function Object\b/.test(n.constructor.toString())},array:function(n){return W(n)&&n.length!==void 0&&z(n.splice)}};function ee(n){var t=n.interaction;if(t.prepared.name==="drag"){var r=t.prepared.axis;r==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):r==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function ie(n){var t=n.iEvent,r=n.interaction;if(r.prepared.name==="drag"){var o=r.prepared.axis;if(o==="x"||o==="y"){var s=o==="x"?"y":"x";t.page[s]=r.coords.start.page[s],t.client[s]=r.coords.start.client[s],t.delta[s]=0}}}var V={id:"actions/drag",install:function(n){var t=n.actions,r=n.Interactable,o=n.defaults;r.prototype.draggable=V.draggable,t.map.drag=V,t.methodDict.drag="draggable",o.actions.drag=V.defaults},listeners:{"interactions:before-action-move":ee,"interactions:action-resume":ee,"interactions:action-move":ie,"auto-start:check":function(n){var t=n.interaction,r=n.interactable,o=n.buttons,s=r.options.drag;if(s&&s.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(o&r.options.drag.mouseButtons)!=0))return n.action={name:"drag",axis:s.lockAxis==="start"?s.startAxis:s.lockAxis},!1}},draggable:function(n){return k.object(n)?(this.options.drag.enabled=n.enabled!==!1,this.setPerAction("drag",n),this.setOnEvents("drag",n),/^(xy|x|y|start)$/.test(n.lockAxis)&&(this.options.drag.lockAxis=n.lockAxis),/^(xy|x|y)$/.test(n.startAxis)&&(this.options.drag.startAxis=n.startAxis),this):k.bool(n)?(this.options.drag.enabled=n,this):this.options.drag},beforeMove:ee,move:ie,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(n){return n.search("drag")===0}},Se=V,re={init:function(n){var t=n;re.document=t.document,re.DocumentFragment=t.DocumentFragment||be,re.SVGElement=t.SVGElement||be,re.SVGSVGElement=t.SVGSVGElement||be,re.SVGElementInstance=t.SVGElementInstance||be,re.Element=t.Element||be,re.HTMLElement=t.HTMLElement||re.Element,re.Event=t.Event,re.Touch=t.Touch||be,re.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function be(){}var ce=re,ye={init:function(n){var t=ce.Element,r=n.navigator||{};ye.supportsTouch="ontouchstart"in n||k.func(n.DocumentTouch)&&ce.document instanceof n.DocumentTouch,ye.supportsPointerEvent=r.pointerEnabled!==!1&&!!ce.PointerEvent,ye.isIOS=/iP(hone|od|ad)/.test(r.platform),ye.isIOS7=/iP(hone|od|ad)/.test(r.platform)&&/OS 7[^\d]/.test(r.appVersion),ye.isIe9=/MSIE 9/.test(r.userAgent),ye.isOperaMobile=r.appName==="Opera"&&ye.supportsTouch&&/Presto/.test(r.userAgent),ye.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",ye.pEventTypes=ye.supportsPointerEvent?ce.PointerEvent===n.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,ye.wheelEvent=ce.document&&"onmousewheel"in ce.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},Pe=ye;function He(n,t){if(n.contains)return n.contains(t);for(;t;){if(t===n)return!0;t=t.parentNode}return!1}function rt(n,t){for(;k.element(n);){if(Ye(n,t))return n;n=xe(n)}return null}function xe(n){var t=n.parentNode;if(k.docFrag(t)){for(;(t=t.host)&&k.docFrag(t););return t}return t}function Ye(n,t){return R!==I&&(t=t.replace(/\/deep\//g," ")),n[Pe.prefixedMatchesSelector](t)}var gt=function(n){return n.parentNode||n.host};function $t(n,t){for(var r,o=[],s=n;(r=gt(s))&&s!==t&&r!==s.ownerDocument;)o.unshift(s),s=r;return o}function K(n,t,r){for(;k.element(n);){if(Ye(n,t))return!0;if((n=xe(n))===r)return Ye(n,t)}return!1}function Ce(n){return n.correspondingUseElement||n}function oe(n){var t=n instanceof ce.SVGElement?n.getBoundingClientRect():n.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function pe(n){var t,r=oe(n);if(!Pe.isIOS7&&r){var o={x:(t=(t=T(n))||R).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};r.left+=o.x,r.right+=o.x,r.top+=o.y,r.bottom+=o.y}return r}function De(n){for(var t=[];n;)t.push(n),n=xe(n);return t}function mt(n){return!!k.string(n)&&(ce.document.querySelector(n),!0)}function H(n,t){for(var r in t)n[r]=t[r];return n}function vt(n,t,r){return n==="parent"?xe(r):n==="self"?t.getRect(r):rt(r,n)}function ke(n,t,r,o){var s=n;return k.string(s)?s=vt(s,t,r):k.func(s)&&(s=s.apply(void 0,o)),k.element(s)&&(s=pe(s)),s}function yt(n){return n&&{x:"x"in n?n.x:n.left,y:"y"in n?n.y:n.top}}function Tt(n){return!n||"x"in n&&"y"in n||((n=H({},n)).x=n.left||0,n.y=n.top||0,n.width=n.width||(n.right||0)-n.x,n.height=n.height||(n.bottom||0)-n.y),n}function bt(n,t,r){n.left&&(t.left+=r.x),n.right&&(t.right+=r.x),n.top&&(t.top+=r.y),n.bottom&&(t.bottom+=r.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function We(n,t,r){var o=r&&n.options[r];return yt(ke(o&&o.origin||n.options.origin,n,t,[n&&t]))||{x:0,y:0}}function Re(n,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(y){return!0},o=arguments.length>3?arguments[3]:void 0;if(o=o||{},k.string(n)&&n.search(" ")!==-1&&(n=xt(n)),k.array(n))return n.forEach((function(y){return Re(y,t,r,o)})),o;if(k.object(n)&&(t=n,n=""),k.func(t)&&r(n))o[n]=o[n]||[],o[n].push(t);else if(k.array(t))for(var s=0,l=t;s<l.length;s++){var p=l[s];Re(n,p,r,o)}else if(k.object(t))for(var f in t)Re(xt(f).map((function(y){return"".concat(n).concat(y)})),t[f],r,o);return o}function xt(n){return n.trim().split(/ +/)}var _t=function(n,t){return Math.sqrt(n*n+t*t)},D=["webkit","moz"];function j(n,t){n.__set||(n.__set={});var r=function(s){if(D.some((function(l){return s.indexOf(l)===0})))return 1;typeof n[s]!="function"&&s!=="__set"&&Object.defineProperty(n,s,{get:function(){return s in n.__set?n.__set[s]:n.__set[s]=t[s]},set:function(l){n.__set[s]=l},configurable:!0})};for(var o in t)r(o);return n}function ne(n,t){n.page=n.page||{},n.page.x=t.page.x,n.page.y=t.page.y,n.client=n.client||{},n.client.x=t.client.x,n.client.y=t.client.y,n.timeStamp=t.timeStamp}function se(n){n.page.x=0,n.page.y=0,n.client.x=0,n.client.y=0}function ae(n){return n instanceof ce.Event||n instanceof ce.Touch}function de(n,t,r){return n=n||"page",(r=r||{}).x=t[n+"X"],r.y=t[n+"Y"],r}function _e(n,t){return t=t||{x:0,y:0},Pe.isOperaMobile&&ae(n)?(de("screen",n,t),t.x+=window.scrollX,t.y+=window.scrollY):de("page",n,t),t}function q(n){return k.number(n.pointerId)?n.pointerId:n.identifier}function he(n,t,r){var o=t.length>1?Fe(t):t[0];_e(o,n.page),(function(s,l){l=l||{},Pe.isOperaMobile&&ae(s)?de("screen",s,l):de("client",s,l)})(o,n.client),n.timeStamp=r}function me(n){var t=[];return k.array(n)?(t[0]=n[0],t[1]=n[1]):n.type==="touchend"?n.touches.length===1?(t[0]=n.touches[0],t[1]=n.changedTouches[0]):n.touches.length===0&&(t[0]=n.changedTouches[0],t[1]=n.changedTouches[1]):(t[0]=n.touches[0],t[1]=n.touches[1]),t}function Fe(n){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},r=0;r<n.length;r++){var o=n[r];for(var s in t)t[s]+=o[s]}for(var l in t)t[l]/=n.length;return t}function fe(n){if(!n.length)return null;var t=me(n),r=Math.min(t[0].pageX,t[1].pageX),o=Math.min(t[0].pageY,t[1].pageY),s=Math.max(t[0].pageX,t[1].pageX),l=Math.max(t[0].pageY,t[1].pageY);return{x:r,y:o,left:r,top:o,right:s,bottom:l,width:s-r,height:l-o}}function Be(n,t){var r=t+"X",o=t+"Y",s=me(n),l=s[0][r]-s[1][r],p=s[0][o]-s[1][o];return _t(l,p)}function $e(n,t){var r=t+"X",o=t+"Y",s=me(n),l=s[1][r]-s[0][r],p=s[1][o]-s[0][o];return 180*Math.atan2(p,l)/Math.PI}function Ot(n){return k.string(n.pointerType)?n.pointerType:k.number(n.pointerType)?[void 0,void 0,"touch","pen","mouse"][n.pointerType]:/touch/.test(n.type||"")||n instanceof ce.Touch?"touch":"mouse"}function Mt(n){var t=k.func(n.composedPath)?n.composedPath():n.path;return[Ce(t?t[0]:n.target),Ce(n.currentTarget)]}var ot=(function(){function n(t){c(this,n),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return u(n,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n})();Object.defineProperty(ot.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var Pt=function(n,t){for(var r=0;r<t.length;r++){var o=t[r];n.push(o)}return n},It=function(n){return Pt([],n)},te=function(n,t){for(var r=0;r<n.length;r++)if(t(n[r],r,n))return r;return-1},G=function(n,t){return n[te(n,t)]},le=(function(n){g(r,n);var t=_(r);function r(o,s,l){var p;c(this,r),(p=t.call(this,s._interaction)).dropzone=void 0,p.dragEvent=void 0,p.relatedTarget=void 0,p.draggable=void 0,p.propagationStopped=!1,p.immediatePropagationStopped=!1;var f=l==="dragleave"?o.prev:o.cur,y=f.element,x=f.dropzone;return p.type=l,p.target=y,p.currentTarget=y,p.dropzone=x,p.dragEvent=s,p.relatedTarget=s.target,p.draggable=s.interactable,p.timeStamp=s.timeStamp,p}return u(r,[{key:"reject",value:function(){var o=this,s=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&s.cur.dropzone===this.dropzone&&s.cur.element===this.target)if(s.prev.dropzone=this.dropzone,s.prev.element=this.target,s.rejected=!0,s.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var l=s.activeDrops,p=te(l,(function(y){var x=y.dropzone,b=y.element;return x===o.dropzone&&b===o.target}));s.activeDrops.splice(p,1);var f=new r(s,this.dragEvent,"dropdeactivate");f.dropzone=this.dropzone,f.target=this.target,this.dropzone.fire(f)}else this.dropzone.fire(new r(s,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),r})(ot);function Ie(n,t){for(var r=0,o=n.slice();r<o.length;r++){var s=o[r],l=s.dropzone,p=s.element;t.dropzone=l,t.target=p,l.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function Ae(n,t){for(var r=(function(l,p){for(var f=[],y=0,x=l.interactables.list;y<x.length;y++){var b=x[y];if(b.options.drop.enabled){var S=b.options.drop.accept;if(!(k.element(S)&&S!==p||k.string(S)&&!Ye(p,S)||k.func(S)&&!S({dropzone:b,draggableElement:p})))for(var C=0,P=b.getAllElements();C<P.length;C++){var O=P[C];O!==p&&f.push({dropzone:b,element:O,rect:b.getRect(O)})}}}return f})(n,t),o=0;o<r.length;o++){var s=r[o];s.rect=s.dropzone.getRect(s.element)}return r}function at(n,t,r){for(var o=n.dropState,s=n.interactable,l=n.element,p=[],f=0,y=o.activeDrops;f<y.length;f++){var x=y[f],b=x.dropzone,S=x.element,C=x.rect,P=b.dropCheck(t,r,s,l,S,C);p.push(P?S:null)}var O=(function(L){for(var N,B,Y,J=[],Z=0;Z<L.length;Z++){var U=L[Z],Q=L[N];if(U&&Z!==N)if(Q){var Oe=gt(U),ue=gt(Q);if(Oe!==U.ownerDocument)if(ue!==U.ownerDocument)if(Oe!==ue){J=J.length?J:$t(Q);var ze=void 0;if(Q instanceof ce.HTMLElement&&U instanceof ce.SVGElement&&!(U instanceof ce.SVGSVGElement)){if(U===ue)continue;ze=U.ownerSVGElement}else ze=U;for(var qe=$t(ze,Q.ownerDocument),Ge=0;qe[Ge]&&qe[Ge]===J[Ge];)Ge++;var Zt=[qe[Ge-1],qe[Ge],J[Ge]];if(Zt[0])for(var Bt=Zt[0].lastChild;Bt;){if(Bt===Zt[1]){N=Z,J=qe;break}if(Bt===Zt[2])break;Bt=Bt.previousSibling}}else Y=Q,(parseInt(T(B=U).getComputedStyle(B).zIndex,10)||0)>=(parseInt(T(Y).getComputedStyle(Y).zIndex,10)||0)&&(N=Z);else N=Z}else N=Z}return N})(p);return o.activeDrops[O]||null}function st(n,t,r){var o=n.dropState,s={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return r.type==="dragstart"&&(s.activate=new le(o,r,"dropactivate"),s.activate.target=null,s.activate.dropzone=null),r.type==="dragend"&&(s.deactivate=new le(o,r,"dropdeactivate"),s.deactivate.target=null,s.deactivate.dropzone=null),o.rejected||(o.cur.element!==o.prev.element&&(o.prev.dropzone&&(s.leave=new le(o,r,"dragleave"),r.dragLeave=s.leave.target=o.prev.element,r.prevDropzone=s.leave.dropzone=o.prev.dropzone),o.cur.dropzone&&(s.enter=new le(o,r,"dragenter"),r.dragEnter=o.cur.element,r.dropzone=o.cur.dropzone)),r.type==="dragend"&&o.cur.dropzone&&(s.drop=new le(o,r,"drop"),r.dropzone=o.cur.dropzone,r.relatedTarget=o.cur.element),r.type==="dragmove"&&o.cur.dropzone&&(s.move=new le(o,r,"dropmove"),r.dropzone=o.cur.dropzone)),s}function je(n,t){var r=n.dropState,o=r.activeDrops,s=r.cur,l=r.prev;t.leave&&l.dropzone.fire(t.leave),t.enter&&s.dropzone.fire(t.enter),t.move&&s.dropzone.fire(t.move),t.drop&&s.dropzone.fire(t.drop),t.deactivate&&Ie(o,t.deactivate),r.prev.dropzone=s.dropzone,r.prev.element=s.element}function Ne(n,t){var r=n.interaction,o=n.iEvent,s=n.event;if(o.type==="dragmove"||o.type==="dragend"){var l=r.dropState;t.dynamicDrop&&(l.activeDrops=Ae(t,r.element));var p=o,f=at(r,p,s);l.rejected=l.rejected&&!!f&&f.dropzone===l.cur.dropzone&&f.element===l.cur.element,l.cur.dropzone=f&&f.dropzone,l.cur.element=f&&f.element,l.events=st(r,0,p)}}var lt={id:"actions/drop",install:function(n){var t=n.actions,r=n.interactStatic,o=n.Interactable,s=n.defaults;n.usePlugin(Se),o.prototype.dropzone=function(l){return(function(p,f){if(k.object(f)){if(p.options.drop.enabled=f.enabled!==!1,f.listeners){var y=Re(f.listeners),x=Object.keys(y).reduce((function(S,C){return S[/^(enter|leave)/.test(C)?"drag".concat(C):/^(activate|deactivate|move)/.test(C)?"drop".concat(C):C]=y[C],S}),{}),b=p.options.drop.listeners;b&&p.off(b),p.on(x),p.options.drop.listeners=x}return k.func(f.ondrop)&&p.on("drop",f.ondrop),k.func(f.ondropactivate)&&p.on("dropactivate",f.ondropactivate),k.func(f.ondropdeactivate)&&p.on("dropdeactivate",f.ondropdeactivate),k.func(f.ondragenter)&&p.on("dragenter",f.ondragenter),k.func(f.ondragleave)&&p.on("dragleave",f.ondragleave),k.func(f.ondropmove)&&p.on("dropmove",f.ondropmove),/^(pointer|center)$/.test(f.overlap)?p.options.drop.overlap=f.overlap:k.number(f.overlap)&&(p.options.drop.overlap=Math.max(Math.min(1,f.overlap),0)),"accept"in f&&(p.options.drop.accept=f.accept),"checker"in f&&(p.options.drop.checker=f.checker),p}return k.bool(f)?(p.options.drop.enabled=f,p):p.options.drop})(this,l)},o.prototype.dropCheck=function(l,p,f,y,x,b){return(function(S,C,P,O,L,N,B){var Y=!1;if(!(B=B||S.getRect(N)))return!!S.options.drop.checker&&S.options.drop.checker(C,P,Y,S,N,O,L);var J=S.options.drop.overlap;if(J==="pointer"){var Z=We(O,L,"drag"),U=_e(C);U.x+=Z.x,U.y+=Z.y;var Q=U.x>B.left&&U.x<B.right,Oe=U.y>B.top&&U.y<B.bottom;Y=Q&&Oe}var ue=O.getRect(L);if(ue&&J==="center"){var ze=ue.left+ue.width/2,qe=ue.top+ue.height/2;Y=ze>=B.left&&ze<=B.right&&qe>=B.top&&qe<=B.bottom}return ue&&k.number(J)&&(Y=Math.max(0,Math.min(B.right,ue.right)-Math.max(B.left,ue.left))*Math.max(0,Math.min(B.bottom,ue.bottom)-Math.max(B.top,ue.top))/(ue.width*ue.height)>=J),S.options.drop.checker&&(Y=S.options.drop.checker(C,P,Y,S,N,O,L)),Y})(this,l,p,f,y,x,b)},r.dynamicDrop=function(l){return k.bool(l)?(n.dynamicDrop=l,r):n.dynamicDrop},H(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",n.dynamicDrop=!1,s.actions.drop=lt.defaults},listeners:{"interactions:before-action-start":function(n){var t=n.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(n,t){var r=n.interaction,o=(n.event,n.iEvent);if(r.prepared.name==="drag"){var s=r.dropState;s.activeDrops=[],s.events={},s.activeDrops=Ae(t,r.element),s.events=st(r,0,o),s.events.activate&&(Ie(s.activeDrops,s.events.activate),t.fire("actions/drop:start",{interaction:r,dragEvent:o}))}},"interactions:action-move":Ne,"interactions:after-action-move":function(n,t){var r=n.interaction,o=n.iEvent;if(r.prepared.name==="drag"){var s=r.dropState;je(r,s.events),t.fire("actions/drop:move",{interaction:r,dragEvent:o}),s.events={}}},"interactions:action-end":function(n,t){if(n.interaction.prepared.name==="drag"){var r=n.interaction,o=n.iEvent;Ne(n,t),je(r,r.dropState.events),t.fire("actions/drop:end",{interaction:r,dragEvent:o})}},"interactions:stop":function(n){var t=n.interaction;if(t.prepared.name==="drag"){var r=t.dropState;r&&(r.activeDrops=null,r.events=null,r.cur.dropzone=null,r.cur.element=null,r.prev.dropzone=null,r.prev.element=null,r.rejected=!1)}}},getActiveDrops:Ae,getDrop:at,getDropEvents:st,fireDropEvents:je,filterEventType:function(n){return n.search("drag")===0||n.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},ct=lt;function wt(n){var t=n.interaction,r=n.iEvent,o=n.phase;if(t.prepared.name==="gesture"){var s=t.pointers.map((function(x){return x.pointer})),l=o==="start",p=o==="end",f=t.interactable.options.deltaSource;if(r.touches=[s[0],s[1]],l)r.distance=Be(s,f),r.box=fe(s),r.scale=1,r.ds=0,r.angle=$e(s,f),r.da=0,t.gesture.startDistance=r.distance,t.gesture.startAngle=r.angle;else if(p||t.pointers.length<2){var y=t.prevEvent;r.distance=y.distance,r.box=y.box,r.scale=y.scale,r.ds=0,r.angle=y.angle,r.da=0}else r.distance=Be(s,f),r.box=fe(s),r.scale=r.distance/t.gesture.startDistance,r.angle=$e(s,f),r.ds=r.scale-t.gesture.scale,r.da=r.angle-t.gesture.angle;t.gesture.distance=r.distance,t.gesture.angle=r.angle,k.number(r.scale)&&r.scale!==1/0&&!isNaN(r.scale)&&(t.gesture.scale=r.scale)}}var Ke={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(n){var t=n.actions,r=n.Interactable,o=n.defaults;r.prototype.gesturable=function(s){return k.object(s)?(this.options.gesture.enabled=s.enabled!==!1,this.setPerAction("gesture",s),this.setOnEvents("gesture",s),this):k.bool(s)?(this.options.gesture.enabled=s,this):this.options.gesture},t.map.gesture=Ke,t.methodDict.gesture="gesturable",o.actions.gesture=Ke.defaults},listeners:{"interactions:action-start":wt,"interactions:action-move":wt,"interactions:action-end":wt,"interactions:new":function(n){n.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(n){if(!(n.interaction.pointers.length<2)){var t=n.interactable.options.gesture;if(t&&t.enabled)return n.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(n){return n.search("gesture")===0}},xr=Ke;function _r(n,t,r,o,s,l,p){if(!t)return!1;if(t===!0){var f=k.number(l.width)?l.width:l.right-l.left,y=k.number(l.height)?l.height:l.bottom-l.top;if(p=Math.min(p,Math.abs((n==="left"||n==="right"?f:y)/2)),f<0&&(n==="left"?n="right":n==="right"&&(n="left")),y<0&&(n==="top"?n="bottom":n==="bottom"&&(n="top")),n==="left"){var x=f>=0?l.left:l.right;return r.x<x+p}if(n==="top"){var b=y>=0?l.top:l.bottom;return r.y<b+p}if(n==="right")return r.x>(f>=0?l.right:l.left)-p;if(n==="bottom")return r.y>(y>=0?l.bottom:l.top)-p}return!!k.element(o)&&(k.element(t)?t===o:K(o,t,s))}function Dn(n){var t=n.iEvent,r=n.interaction;if(r.prepared.name==="resize"&&r.resizeAxes){var o=t;r.interactable.options.resize.square?(r.resizeAxes==="y"?o.delta.x=o.delta.y:o.delta.y=o.delta.x,o.axes="xy"):(o.axes=r.resizeAxes,r.resizeAxes==="x"?o.delta.y=0:r.resizeAxes==="y"&&(o.delta.x=0))}}var Xe,dt,Ve={id:"actions/resize",before:["actions/drag"],install:function(n){var t=n.actions,r=n.browser,o=n.Interactable,s=n.defaults;Ve.cursors=(function(l){return l.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(r),Ve.defaultMargin=r.supportsTouch||r.supportsPointerEvent?20:10,o.prototype.resizable=function(l){return(function(p,f,y){return k.object(f)?(p.options.resize.enabled=f.enabled!==!1,p.setPerAction("resize",f),p.setOnEvents("resize",f),k.string(f.axis)&&/^x$|^y$|^xy$/.test(f.axis)?p.options.resize.axis=f.axis:f.axis===null&&(p.options.resize.axis=y.defaults.actions.resize.axis),k.bool(f.preserveAspectRatio)?p.options.resize.preserveAspectRatio=f.preserveAspectRatio:k.bool(f.square)&&(p.options.resize.square=f.square),p):k.bool(f)?(p.options.resize.enabled=f,p):p.options.resize})(this,l,n)},t.map.resize=Ve,t.methodDict.resize="resizable",s.actions.resize=Ve.defaults},listeners:{"interactions:new":function(n){n.interaction.resizeAxes="xy"},"interactions:action-start":function(n){(function(t){var r=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=r,l=o.rect;o._rects={start:H({},l),corrected:H({},l),previous:H({},l),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},s.edges=o.prepared.edges,s.rect=o._rects.corrected,s.deltaRect=o._rects.delta}})(n),Dn(n)},"interactions:action-move":function(n){(function(t){var r=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=r,l=o.interactable.options.resize.invert,p=l==="reposition"||l==="negate",f=o.rect,y=o._rects,x=y.start,b=y.corrected,S=y.delta,C=y.previous;if(H(C,b),p){if(H(b,f),l==="reposition"){if(b.top>b.bottom){var P=b.top;b.top=b.bottom,b.bottom=P}if(b.left>b.right){var O=b.left;b.left=b.right,b.right=O}}}else b.top=Math.min(f.top,x.bottom),b.bottom=Math.max(f.bottom,x.top),b.left=Math.min(f.left,x.right),b.right=Math.max(f.right,x.left);for(var L in b.width=b.right-b.left,b.height=b.bottom-b.top,b)S[L]=b[L]-C[L];s.edges=o.prepared.edges,s.rect=b,s.deltaRect=S}})(n),Dn(n)},"interactions:action-end":function(n){var t=n.iEvent,r=n.interaction;if(r.prepared.name==="resize"&&r.prepared.edges){var o=t;o.edges=r.prepared.edges,o.rect=r._rects.corrected,o.deltaRect=r._rects.delta}},"auto-start:check":function(n){var t=n.interaction,r=n.interactable,o=n.element,s=n.rect,l=n.buttons;if(s){var p=H({},t.coords.cur.page),f=r.options.resize;if(f&&f.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(l&f.mouseButtons)!=0)){if(k.object(f.edges)){var y={left:!1,right:!1,top:!1,bottom:!1};for(var x in y)y[x]=_r(x,f.edges[x],p,t._latestPointer.eventTarget,o,s,f.margin||Ve.defaultMargin);y.left=y.left&&!y.right,y.top=y.top&&!y.bottom,(y.left||y.right||y.top||y.bottom)&&(n.action={name:"resize",edges:y})}else{var b=f.axis!=="y"&&p.x>s.right-Ve.defaultMargin,S=f.axis!=="x"&&p.y>s.bottom-Ve.defaultMargin;(b||S)&&(n.action={name:"resize",axes:(b?"x":"")+(S?"y":"")})}return!n.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(n){var t=n.edges,r=n.axis,o=n.name,s=Ve.cursors,l=null;if(r)l=s[o+r];else if(t){for(var p="",f=0,y=["top","bottom","left","right"];f<y.length;f++){var x=y[f];t[x]&&(p+=x)}l=s[p]}return l},filterEventType:function(n){return n.search("resize")===0},defaultMargin:null},wr=Ve,Sr={id:"actions",install:function(n){n.usePlugin(xr),n.usePlugin(wr),n.usePlugin(Se),n.usePlugin(ct)}},Rn=0,Qe={request:function(n){return Xe(n)},cancel:function(n){return dt(n)},init:function(n){if(Xe=n.requestAnimationFrame,dt=n.cancelAnimationFrame,!Xe)for(var t=["ms","moz","webkit","o"],r=0;r<t.length;r++){var o=t[r];Xe=n["".concat(o,"RequestAnimationFrame")],dt=n["".concat(o,"CancelAnimationFrame")]||n["".concat(o,"CancelRequestAnimationFrame")]}Xe=Xe&&Xe.bind(n),dt=dt&&dt.bind(n),Xe||(Xe=function(s){var l=Date.now(),p=Math.max(0,16-(l-Rn)),f=n.setTimeout((function(){s(l+p)}),p);return Rn=l+p,f},dt=function(s){return clearTimeout(s)})}},X={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(n){X.isScrolling=!0,Qe.cancel(X.i),n.autoScroll=X,X.interaction=n,X.prevTime=X.now(),X.i=Qe.request(X.scroll)},stop:function(){X.isScrolling=!1,X.interaction&&(X.interaction.autoScroll=null),Qe.cancel(X.i)},scroll:function(){var n=X.interaction,t=n.interactable,r=n.element,o=n.prepared.name,s=t.options[o].autoScroll,l=Bn(s.container,t,r),p=X.now(),f=(p-X.prevTime)/1e3,y=s.speed*f;if(y>=1){var x={x:X.x*y,y:X.y*y};if(x.x||x.y){var b=jn(l);k.window(l)?l.scrollBy(x.x,x.y):l&&(l.scrollLeft+=x.x,l.scrollTop+=x.y);var S=jn(l),C={x:S.x-b.x,y:S.y-b.y};(C.x||C.y)&&t.fire({type:"autoscroll",target:r,interactable:t,delta:C,interaction:n,container:l})}X.prevTime=p}X.isScrolling&&(Qe.cancel(X.i),X.i=Qe.request(X.scroll))},check:function(n,t){var r;return(r=n.options[t].autoScroll)==null?void 0:r.enabled},onInteractionMove:function(n){var t=n.interaction,r=n.pointer;if(t.interacting()&&X.check(t.interactable,t.prepared.name))if(t.simulation)X.x=X.y=0;else{var o,s,l,p,f=t.interactable,y=t.element,x=t.prepared.name,b=f.options[x].autoScroll,S=Bn(b.container,f,y);if(k.window(S))p=r.clientX<X.margin,o=r.clientY<X.margin,s=r.clientX>S.innerWidth-X.margin,l=r.clientY>S.innerHeight-X.margin;else{var C=oe(S);p=r.clientX<C.left+X.margin,o=r.clientY<C.top+X.margin,s=r.clientX>C.right-X.margin,l=r.clientY>C.bottom-X.margin}X.x=s?1:p?-1:0,X.y=l?1:o?-1:0,X.isScrolling||(X.margin=b.margin,X.speed=b.speed,X.start(t))}}};function Bn(n,t,r){return(k.string(n)?vt(n,t,r):n)||T(r)}function jn(n){return k.window(n)&&(n=window.document.body),{x:n.scrollLeft,y:n.scrollTop}}var kr={id:"auto-scroll",install:function(n){var t=n.defaults,r=n.actions;n.autoScroll=X,X.now=function(){return n.now()},r.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=X.defaults},listeners:{"interactions:new":function(n){n.interaction.autoScroll=null},"interactions:destroy":function(n){n.interaction.autoScroll=null,X.stop(),X.interaction&&(X.interaction=null)},"interactions:stop":X.stop,"interactions:action-move":function(n){return X.onInteractionMove(n)}}},Er=kr;function Lt(n,t){var r=!1;return function(){return r||(R.console.warn(t),r=!0),n.apply(this,arguments)}}function sn(n,t){return n.name=t.name,n.axis=t.axis,n.edges=t.edges,n}function Cr(n){return k.bool(n)?(this.options.styleCursor=n,this):n===null?(delete this.options.styleCursor,this):this.options.styleCursor}function Ar(n){return k.func(n)?(this.options.actionChecker=n,this):n===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Tr={id:"auto-start/interactableMethods",install:function(n){var t=n.Interactable;t.prototype.getAction=function(r,o,s,l){var p=(function(f,y,x,b,S){var C=f.getRect(b),P=y.buttons||{0:1,1:4,3:8,4:16}[y.button],O={action:null,interactable:f,interaction:x,element:b,rect:C,buttons:P};return S.fire("auto-start:check",O),O.action})(this,o,s,l,n);return this.options.actionChecker?this.options.actionChecker(r,o,p,this,l,s):p},t.prototype.ignoreFrom=Lt((function(r){return this._backCompatOption("ignoreFrom",r)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=Lt((function(r){return this._backCompatOption("allowFrom",r)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Ar,t.prototype.styleCursor=Cr}};function Nn(n,t,r,o,s){return t.testIgnoreAllow(t.options[n.name],r,o)&&t.options[n.name].enabled&&Kt(t,r,n,s)?n:null}function Or(n,t,r,o,s,l,p){for(var f=0,y=o.length;f<y;f++){var x=o[f],b=s[f],S=x.getAction(t,r,n,b);if(S){var C=Nn(S,x,b,l,p);if(C)return{action:C,interactable:x,element:b}}}return{action:null,interactable:null,element:null}}function qn(n,t,r,o,s){var l=[],p=[],f=o;function y(b){l.push(b),p.push(f)}for(;k.element(f);){l=[],p=[],s.interactables.forEachMatch(f,y);var x=Or(n,t,r,l,p,o,s);if(x.action&&!x.interactable.options[x.action.name].manualStart)return x;f=xe(f)}return{action:null,interactable:null,element:null}}function Hn(n,t,r){var o=t.action,s=t.interactable,l=t.element;o=o||{name:null},n.interactable=s,n.element=l,sn(n.prepared,o),n.rect=s&&o.name?s.getRect(l):null,$n(n,r),r.fire("autoStart:prepared",{interaction:n})}function Kt(n,t,r,o){var s=n.options,l=s[r.name].max,p=s[r.name].maxPerElement,f=o.autoStart.maxInteractions,y=0,x=0,b=0;if(!(l&&p&&f))return!1;for(var S=0,C=o.interactions.list;S<C.length;S++){var P=C[S],O=P.prepared.name;if(P.interacting()&&(++y>=f||P.interactable===n&&((x+=O===r.name?1:0)>=l||P.element===t&&(b++,O===r.name&&b>=p))))return!1}return f>0}function Yn(n,t){return k.number(n)?(t.autoStart.maxInteractions=n,this):t.autoStart.maxInteractions}function ln(n,t,r){var o=r.autoStart.cursorElement;o&&o!==n&&(o.style.cursor=""),n.ownerDocument.documentElement.style.cursor=t,n.style.cursor=t,r.autoStart.cursorElement=t?n:null}function $n(n,t){var r=n.interactable,o=n.element,s=n.prepared;if(n.pointerType==="mouse"&&r&&r.options.styleCursor){var l="";if(s.name){var p=r.options[s.name].cursorChecker;l=k.func(p)?p(s,r,o,n._interacting):t.actions.map[s.name].getCursor(s)}ln(n.element,l||"",t)}else t.autoStart.cursorElement&&ln(t.autoStart.cursorElement,"",t)}var Mr={id:"auto-start/base",before:["actions"],install:function(n){var t=n.interactStatic,r=n.defaults;n.usePlugin(Tr),r.base.actionChecker=null,r.base.styleCursor=!0,H(r.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(o){return Yn(o,n)},n.autoStart={maxInteractions:1/0,withinInteractionLimit:Kt,cursorElement:null}},listeners:{"interactions:down":function(n,t){var r=n.interaction,o=n.pointer,s=n.event,l=n.eventTarget;r.interacting()||Hn(r,qn(r,o,s,l,t),t)},"interactions:move":function(n,t){(function(r,o){var s=r.interaction,l=r.pointer,p=r.event,f=r.eventTarget;s.pointerType!=="mouse"||s.pointerIsDown||s.interacting()||Hn(s,qn(s,l,p,f,o),o)})(n,t),(function(r,o){var s=r.interaction;if(s.pointerIsDown&&!s.interacting()&&s.pointerWasMoved&&s.prepared.name){o.fire("autoStart:before-start",r);var l=s.interactable,p=s.prepared.name;p&&l&&(l.options[p].manualStart||!Kt(l,s.element,s.prepared,o)?s.stop():(s.start(s.prepared,l,s.element),$n(s,o)))}})(n,t)},"interactions:stop":function(n,t){var r=n.interaction,o=r.interactable;o&&o.options.styleCursor&&ln(r.element,"",t)}},maxInteractions:Yn,withinInteractionLimit:Kt,validateAction:Nn},cn=Mr,Pr={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(n,t){var r=n.interaction,o=n.eventTarget,s=n.dx,l=n.dy;if(r.prepared.name==="drag"){var p=Math.abs(s),f=Math.abs(l),y=r.interactable.options.drag,x=y.startAxis,b=p>f?"x":p<f?"y":"xy";if(r.prepared.axis=y.lockAxis==="start"?b[0]:y.lockAxis,b!=="xy"&&x!=="xy"&&x!==b){r.prepared.name=null;for(var S=o,C=function(O){if(O!==r.interactable){var L=r.interactable.options.drag;if(!L.manualStart&&O.testIgnoreAllow(L,S,o)){var N=O.getAction(r.downPointer,r.downEvent,r,S);if(N&&N.name==="drag"&&(function(B,Y){if(!Y)return!1;var J=Y.options.drag.startAxis;return B==="xy"||J==="xy"||J===B})(b,O)&&cn.validateAction(N,O,S,o,t))return O}}};k.element(S);){var P=t.interactables.forEachMatch(S,C);if(P){r.prepared.name="drag",r.interactable=P,r.element=S;break}S=xe(S)}}}}}};function dn(n){var t=n.prepared&&n.prepared.name;if(!t)return null;var r=n.interactable.options;return r[t].hold||r[t].delay}var Ir={id:"auto-start/hold",install:function(n){var t=n.defaults;n.usePlugin(cn),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(n){n.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(n){var t=n.interaction,r=dn(t);r>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),r))},"interactions:move":function(n){var t=n.interaction,r=n.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!r&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(n){var t=n.interaction;dn(t)>0&&(t.prepared.name=null)}},getHoldDuration:dn},Lr=Ir,Fr={id:"auto-start",install:function(n){n.usePlugin(cn),n.usePlugin(Lr),n.usePlugin(Pr)}},zr=function(n){return/^(always|never|auto)$/.test(n)?(this.options.preventDefault=n,this):k.bool(n)?(this.options.preventDefault=n?"always":"never",this):this.options.preventDefault};function Dr(n){var t=n.interaction,r=n.event;t.interactable&&t.interactable.checkAndPreventDefault(r)}var Kn={id:"core/interactablePreventDefault",install:function(n){var t=n.Interactable;t.prototype.preventDefault=zr,t.prototype.checkAndPreventDefault=function(r){return(function(o,s,l){var p=o.options.preventDefault;if(p!=="never")if(p!=="always"){if(s.events.supportsPassive&&/^touch(start|move)$/.test(l.type)){var f=T(l.target).document,y=s.getDocOptions(f);if(!y||!y.events||y.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(l.type)||k.element(l.target)&&Ye(l.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||l.preventDefault()}else l.preventDefault()})(this,n,r)},n.interactions.docEvents.push({type:"dragstart",listener:function(r){for(var o=0,s=n.interactions.list;o<s.length;o++){var l=s[o];if(l.element&&(l.element===r.target||He(l.element,r.target)))return void l.interactable.checkAndPreventDefault(r)}}})},listeners:["down","move","up","cancel"].reduce((function(n,t){return n["interactions:".concat(t)]=Dr,n}),{})};function Ut(n,t){if(t.phaselessTypes[n])return!0;for(var r in t.map)if(n.indexOf(r)===0&&n.substr(r.length)in t.phases)return!0;return!1}function St(n){var t={};for(var r in n){var o=n[r];k.plainObject(o)?t[r]=St(o):k.array(o)?t[r]=It(o):t[r]=o}return t}var un=(function(){function n(t){c(this,n),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=Wt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return u(n,[{key:"start",value:function(t,r){var o,s,l=t.phase,p=this.interaction,f=(function(x){var b=x.interactable.options[x.prepared.name],S=b.modifiers;return S&&S.length?S:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(C){var P=b[C];return P&&P.enabled&&{options:P,methods:P._methods}})).filter((function(C){return!!C}))})(p);this.prepareStates(f),this.startEdges=H({},p.edges),this.edges=H({},this.startEdges),this.startOffset=(o=p.rect,s=r,o?{left:s.x-o.left,top:s.y-o.top,right:o.right-s.x,bottom:o.bottom-s.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var y=this.fillArg({phase:l,pageCoords:r,preEnd:!1});return this.result=Wt(),this.startAll(y),this.result=this.setAll(y)}},{key:"fillArg",value:function(t){var r=this.interaction;return t.interaction=r,t.interactable=r.interactable,t.element=r.element,t.rect||(t.rect=r.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var r=0,o=this.states;r<o.length;r++){var s=o[r];s.methods.start&&(t.state=s,s.methods.start(t))}}},{key:"setAll",value:function(t){var r=t.phase,o=t.preEnd,s=t.skipModifiers,l=t.rect,p=t.edges;t.coords=H({},t.pageCoords),t.rect=H({},l),t.edges=H({},p);for(var f=s?this.states.slice(s):this.states,y=Wt(t.coords,t.rect),x=0;x<f.length;x++){var b,S=f[x],C=S.options,P=H({},t.coords),O=null;(b=S.methods)!=null&&b.set&&this.shouldDo(C,o,r)&&(t.state=S,O=S.methods.set(t),bt(t.edges,t.rect,{x:t.coords.x-P.x,y:t.coords.y-P.y})),y.eventProps.push(O)}H(this.edges,t.edges),y.delta.x=t.coords.x-t.pageCoords.x,y.delta.y=t.coords.y-t.pageCoords.y,y.rectDelta.left=t.rect.left-l.left,y.rectDelta.right=t.rect.right-l.right,y.rectDelta.top=t.rect.top-l.top,y.rectDelta.bottom=t.rect.bottom-l.bottom;var L=this.result.coords,N=this.result.rect;if(L&&N){var B=y.rect.left!==N.left||y.rect.right!==N.right||y.rect.top!==N.top||y.rect.bottom!==N.bottom;y.changed=B||L.x!==y.coords.x||L.y!==y.coords.y}return y}},{key:"applyToInteraction",value:function(t){var r=this.interaction,o=t.phase,s=r.coords.cur,l=r.coords.start,p=this.result,f=this.startDelta,y=p.delta;o==="start"&&H(this.startDelta,p.delta);for(var x=0,b=[[l,f],[s,y]];x<b.length;x++){var S=b[x],C=S[0],P=S[1];C.page.x+=P.x,C.page.y+=P.y,C.client.x+=P.x,C.client.y+=P.y}var O=this.result.rectDelta,L=t.rect||r.rect;L.left+=O.left,L.right+=O.right,L.top+=O.top,L.bottom+=O.bottom,L.width=L.right-L.left,L.height=L.bottom-L.top}},{key:"setAndApply",value:function(t){var r=this.interaction,o=t.phase,s=t.preEnd,l=t.skipModifiers,p=this.setAll(this.fillArg({preEnd:s,phase:o,pageCoords:t.modifiedCoords||r.coords.cur.page}));if(this.result=p,!p.changed&&(!l||l<this.states.length)&&r.interacting())return!1;if(t.modifiedCoords){var f=r.coords.cur.page,y={x:t.modifiedCoords.x-f.x,y:t.modifiedCoords.y-f.y};p.coords.x+=y.x,p.coords.y+=y.y,p.delta.x+=y.x,p.delta.y+=y.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var r=t.interaction,o=t.event,s=this.states;if(s&&s.length){for(var l=!1,p=0;p<s.length;p++){var f=s[p];t.state=f;var y=f.options,x=f.methods,b=x.beforeEnd&&x.beforeEnd(t);if(b)return this.endResult=b,!1;l=l||!l&&this.shouldDo(y,!0,t.phase,!0)}l&&r.move({event:o,preEnd:!0})}}},{key:"stop",value:function(t){var r=t.interaction;if(this.states&&this.states.length){var o=H({states:this.states,interactable:r.interactable,element:r.element,rect:null},t);this.fillArg(o);for(var s=0,l=this.states;s<l.length;s++){var p=l[s];o.state=p,p.methods.stop&&p.methods.stop(o)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var r=0;r<t.length;r++){var o=t[r],s=o.options,l=o.methods,p=o.name;this.states.push({options:s,methods:l,index:r,name:p})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var r=t.interaction,o=r.coords,s=r.rect,l=r.modification;if(l.result){for(var p=l.startDelta,f=l.result,y=f.delta,x=f.rectDelta,b=0,S=[[o.start,p],[o.cur,y]];b<S.length;b++){var C=S[b],P=C[0],O=C[1];P.page.x-=O.x,P.page.y-=O.y,P.client.x-=O.x,P.client.y-=O.y}s.left-=x.left,s.right-=x.right,s.top-=x.top,s.bottom-=x.bottom}}},{key:"shouldDo",value:function(t,r,o,s){return!(!t||t.enabled===!1||s&&!t.endOnly||t.endOnly&&!r||o==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(r){return St(r)})),this.result=Wt(H({},t.result.coords),H({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),n})();function Wt(n,t){return{rect:t,coords:n,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function Ze(n,t){var r=n.defaults,o={start:n.start,set:n.set,beforeEnd:n.beforeEnd,stop:n.stop},s=function(l){var p=l||{};for(var f in p.enabled=p.enabled!==!1,r)f in p||(p[f]=r[f]);var y={options:p,methods:o,name:t,enable:function(){return p.enabled=!0,y},disable:function(){return p.enabled=!1,y}};return y};return t&&typeof t=="string"&&(s._defaults=r,s._methods=o),s}function Ft(n){var t=n.iEvent,r=n.interaction.modification.result;r&&(t.modifiers=r.eventProps)}var Rr={id:"modifiers/base",before:["actions"],install:function(n){n.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(n){var t=n.interaction;t.modification=new un(t)},"interactions:before-action-start":function(n){var t=n.interaction,r=n.interaction.modification;r.start(n,t.coords.start.page),t.edges=r.edges,r.applyToInteraction(n)},"interactions:before-action-move":function(n){var t=n.interaction,r=t.modification,o=r.setAndApply(n);return t.edges=r.edges,o},"interactions:before-action-end":function(n){var t=n.interaction,r=t.modification,o=r.beforeEnd(n);return t.edges=r.startEdges,o},"interactions:action-start":Ft,"interactions:action-move":Ft,"interactions:action-end":Ft,"interactions:after-action-start":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-move":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:stop":function(n){return n.interaction.modification.stop(n)}}},Un=Rr,Wn={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},pn=(function(n){g(r,n);var t=_(r);function r(o,s,l,p,f,y,x){var b;c(this,r),(b=t.call(this,o)).relatedTarget=null,b.screenX=void 0,b.screenY=void 0,b.button=void 0,b.buttons=void 0,b.ctrlKey=void 0,b.shiftKey=void 0,b.altKey=void 0,b.metaKey=void 0,b.page=void 0,b.client=void 0,b.delta=void 0,b.rect=void 0,b.x0=void 0,b.y0=void 0,b.t0=void 0,b.dt=void 0,b.duration=void 0,b.clientX0=void 0,b.clientY0=void 0,b.velocity=void 0,b.speed=void 0,b.swipe=void 0,b.axes=void 0,b.preEnd=void 0,f=f||o.element;var S=o.interactable,C=(S&&S.options||Wn).deltaSource,P=We(S,f,l),O=p==="start",L=p==="end",N=O?w(b):o.prevEvent,B=O?o.coords.start:L?{page:N.page,client:N.client,timeStamp:o.coords.cur.timeStamp}:o.coords.cur;return b.page=H({},B.page),b.client=H({},B.client),b.rect=H({},o.rect),b.timeStamp=B.timeStamp,L||(b.page.x-=P.x,b.page.y-=P.y,b.client.x-=P.x,b.client.y-=P.y),b.ctrlKey=s.ctrlKey,b.altKey=s.altKey,b.shiftKey=s.shiftKey,b.metaKey=s.metaKey,b.button=s.button,b.buttons=s.buttons,b.target=f,b.currentTarget=f,b.preEnd=y,b.type=x||l+(p||""),b.interactable=S,b.t0=O?o.pointers[o.pointers.length-1].downTime:N.t0,b.x0=o.coords.start.page.x-P.x,b.y0=o.coords.start.page.y-P.y,b.clientX0=o.coords.start.client.x-P.x,b.clientY0=o.coords.start.client.y-P.y,b.delta=O||L?{x:0,y:0}:{x:b[C].x-N[C].x,y:b[C].y-N[C].y},b.dt=o.coords.delta.timeStamp,b.duration=b.timeStamp-b.t0,b.velocity=H({},o.coords.velocity[C]),b.speed=_t(b.velocity.x,b.velocity.y),b.swipe=L||p==="inertiastart"?b.getSwipe():null,b}return u(r,[{key:"getSwipe",value:function(){var o=this._interaction;if(o.prevEvent.speed<600||this.timeStamp-o.prevEvent.timeStamp>150)return null;var s=180*Math.atan2(o.prevEvent.velocityY,o.prevEvent.velocityX)/Math.PI;s<0&&(s+=360);var l=112.5<=s&&s<247.5,p=202.5<=s&&s<337.5;return{up:p,down:!p&&22.5<=s&&s<157.5,left:l,right:!l&&(292.5<=s||s<67.5),angle:s,speed:o.prevEvent.speed,velocity:{x:o.prevEvent.velocityX,y:o.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),r})(ot);Object.defineProperties(pn.prototype,{pageX:{get:function(){return this.page.x},set:function(n){this.page.x=n}},pageY:{get:function(){return this.page.y},set:function(n){this.page.y=n}},clientX:{get:function(){return this.client.x},set:function(n){this.client.x=n}},clientY:{get:function(){return this.client.y},set:function(n){this.client.y=n}},dx:{get:function(){return this.delta.x},set:function(n){this.delta.x=n}},dy:{get:function(){return this.delta.y},set:function(n){this.delta.y=n}},velocityX:{get:function(){return this.velocity.x},set:function(n){this.velocity.x=n}},velocityY:{get:function(){return this.velocity.y},set:function(n){this.velocity.y=n}}});var Br=u((function n(t,r,o,s,l){c(this,n),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=r,this.event=o,this.downTime=s,this.downTarget=l})),jr=(function(n){return n.interactable="",n.element="",n.prepared="",n.pointerIsDown="",n.pointerWasMoved="",n._proxy="",n})({}),Xn=(function(n){return n.start="",n.move="",n.end="",n.stop="",n.interacting="",n})({}),Nr=0,qr=(function(){function n(t){var r=this,o=t.pointerType,s=t.scopeFire;c(this,n),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Lt((function(b){this.move(b)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=Nr++,this._scopeFire=s,this.pointerType=o;var l=this;this._proxy={};var p=function(b){Object.defineProperty(r._proxy,b,{get:function(){return l[b]}})};for(var f in jr)p(f);var y=function(b){Object.defineProperty(r._proxy,b,{value:function(){return l[b].apply(l,arguments)}})};for(var x in Xn)y(x);this._scopeFire("interactions:new",{interaction:this})}return u(n,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,r,o){var s=this.updatePointer(t,r,o,!0),l=this.pointers[s];this._scopeFire("interactions:down",{pointer:t,event:r,eventTarget:o,pointerIndex:s,pointerInfo:l,type:"down",interaction:this})}},{key:"start",value:function(t,r,o){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!r.options[t.name].enabled)&&(sn(this.prepared,t),this.interactable=r,this.element=o,this.rect=r.getRect(o),this.edges=this.prepared.edges?H({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,r,o){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,r,o,!1);var s,l,p=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(s=this.coords.cur.client.x-this.coords.start.client.x,l=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=_t(s,l)>this.pointerMoveTolerance);var f,y,x,b=this.getPointerIndex(t),S={pointer:t,pointerIndex:b,pointerInfo:this.pointers[b],event:r,type:"move",eventTarget:o,dx:s,dy:l,duplicate:p,interaction:this};p||(f=this.coords.velocity,y=this.coords.delta,x=Math.max(y.timeStamp/1e3,.001),f.page.x=y.page.x/x,f.page.y=y.page.y/x,f.client.x=y.client.x/x,f.client.y=y.client.y/x,f.timeStamp=x),this._scopeFire("interactions:move",S),p||this.simulation||(this.interacting()&&(S.type=null,this.move(S)),this.pointerWasMoved&&ne(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||se(this.coords.delta),(t=H({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,r,o,s){var l=this.getPointerIndex(t);l===-1&&(l=this.updatePointer(t,r,o,!1));var p=/cancel$/i.test(r.type)?"cancel":"up";this._scopeFire("interactions:".concat(p),{pointer:t,pointerIndex:l,pointerInfo:this.pointers[l],event:r,eventTarget:o,type:p,curEventTarget:s,interaction:this}),this.simulation||this.end(r),this.removePointer(t,r)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var r;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(r=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,r===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var r=q(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:te(this.pointers,(function(o){return o.id===r}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,r,o,s){var l,p,f,y=q(t),x=this.getPointerIndex(t),b=this.pointers[x];return s=s!==!1&&(s||/(down|start)$/i.test(r.type)),b?b.pointer=t:(b=new Br(y,t,r,null,null),x=this.pointers.length,this.pointers.push(b)),he(this.coords.cur,this.pointers.map((function(S){return S.pointer})),this._now()),l=this.coords.delta,p=this.coords.prev,f=this.coords.cur,l.page.x=f.page.x-p.page.x,l.page.y=f.page.y-p.page.y,l.client.x=f.client.x-p.client.x,l.client.y=f.client.y-p.client.y,l.timeStamp=f.timeStamp-p.timeStamp,s&&(this.pointerIsDown=!0,b.downTime=this.coords.cur.timeStamp,b.downTarget=o,j(this.downPointer,t),this.interacting()||(ne(this.coords.start,this.coords.cur),ne(this.coords.prev,this.coords.cur),this.downEvent=r,this.pointerWasMoved=!1)),this._updateLatestPointer(t,r,o),this._scopeFire("interactions:update-pointer",{pointer:t,event:r,eventTarget:o,down:s,pointerInfo:b,pointerIndex:x,interaction:this}),x}},{key:"removePointer",value:function(t,r){var o=this.getPointerIndex(t);if(o!==-1){var s=this.pointers[o];this._scopeFire("interactions:remove-pointer",{pointer:t,event:r,eventTarget:null,pointerIndex:o,pointerInfo:s,interaction:this}),this.pointers.splice(o,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,r,o){this._latestPointer.pointer=t,this._latestPointer.event=r,this._latestPointer.eventTarget=o}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,r,o,s){return new pn(this,t,this.prepared.name,r,this.element,o,s)}},{key:"_fireEvent",value:function(t){var r;(r=this.interactable)==null||r.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var r=t.event,o=t.phase,s=t.preEnd,l=t.type,p=this.rect;if(p&&o==="move"&&(bt(this.edges,p,this.coords.delta[this.interactable.options.deltaSource]),p.width=p.right-p.left,p.height=p.bottom-p.top),this._scopeFire("interactions:before-action-".concat(o),t)===!1)return!1;var f=t.iEvent=this._createPreparedEvent(r,o,s,l);return this._scopeFire("interactions:action-".concat(o),t),o==="start"&&(this.prevEvent=f),this._fireEvent(f),this._scopeFire("interactions:after-action-".concat(o),t),!0}},{key:"_now",value:function(){return Date.now()}}]),n})();function Vn(n){Gn(n.interaction)}function Gn(n){if(!(function(r){return!(!r.offset.pending.x&&!r.offset.pending.y)})(n))return!1;var t=n.offset.pending;return hn(n.coords.cur,t),hn(n.coords.delta,t),bt(n.edges,n.rect,t),t.x=0,t.y=0,!0}function Hr(n){var t=n.x,r=n.y;this.offset.pending.x+=t,this.offset.pending.y+=r,this.offset.total.x+=t,this.offset.total.y+=r}function hn(n,t){var r=n.page,o=n.client,s=t.x,l=t.y;r.x+=s,r.y+=l,o.x+=s,o.y+=l}Xn.offsetBy="";var Yr={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(n){n.Interaction.prototype.offsetBy=Hr},listeners:{"interactions:new":function(n){n.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(n){return(function(t){t.pointerIsDown&&(hn(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(n.interaction)},"interactions:before-action-start":Vn,"interactions:before-action-move":Vn,"interactions:before-action-end":function(n){var t=n.interaction;if(Gn(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(n){var t=n.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},Jn=Yr,$r=(function(){function n(t){c(this,n),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return u(n,[{key:"start",value:function(t){var r=this.interaction,o=Xt(r);if(!o||!o.enabled)return!1;var s=r.coords.velocity.client,l=_t(s.x,s.y),p=this.modification||(this.modification=new un(r));if(p.copyFrom(r.modification),this.t0=r._now(),this.allowResume=o.allowResume,this.v0=l,this.currentOffset={x:0,y:0},this.startCoords=r.coords.cur.page,this.modifierArg=p.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-r.coords.cur.timeStamp<50&&l>o.minSpeed&&l>o.endSpeed)this.startInertia();else{if(p.result=p.setAll(this.modifierArg),!p.result.changed)return!1;this.startSmoothEnd()}return r.modification.result.rect=null,r.offsetBy(this.targetOffset),r._doPhase({interaction:r,event:t,phase:"inertiastart"}),r.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),r.modification.result.rect=null,this.active=!0,r.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,r=this.interaction.coords.velocity.client,o=Xt(this.interaction),s=o.resistance,l=-Math.log(o.endSpeed/this.v0)/s;this.targetOffset={x:(r.x-l)/s,y:(r.y-l)/s},this.te=l,this.lambda_v0=s/this.v0,this.one_ve_v0=1-o.endSpeed/this.v0;var p=this.modification,f=this.modifierArg;f.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},p.result=p.setAll(f),p.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+p.result.delta.x,y:this.targetOffset.y+p.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var r=this;this.timeout=Qe.request((function(){r.active&&t()}))}},{key:"inertiaTick",value:function(){var t,r,o,s,l,p,f,y=this,x=this.interaction,b=Xt(x).resistance,S=(x._now()-this.t0)/1e3;if(S<this.te){var C,P=1-(Math.exp(-b*S)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,r=0,o=this.targetOffset.x,s=this.targetOffset.y,l=this.modifiedOffset.x,p=this.modifiedOffset.y,C={x:Qn(f=P,t,o,l),y:Qn(f,r,s,p)}):C={x:this.targetOffset.x*P,y:this.targetOffset.y*P};var O={x:C.x-this.currentOffset.x,y:C.y-this.currentOffset.y};this.currentOffset.x+=O.x,this.currentOffset.y+=O.y,x.offsetBy(O),x.move(),this.onNextFrame((function(){return y.inertiaTick()}))}else x.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,r=this.interaction,o=r._now()-this.t0,s=Xt(r).smoothEndDuration;if(o<s){var l={x:Zn(o,0,this.targetOffset.x,s),y:Zn(o,0,this.targetOffset.y,s)},p={x:l.x-this.currentOffset.x,y:l.y-this.currentOffset.y};this.currentOffset.x+=p.x,this.currentOffset.y+=p.y,r.offsetBy(p),r.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else r.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var r=t.pointer,o=t.event,s=t.eventTarget,l=this.interaction;l.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),l.updatePointer(r,o,s,!0),l._doPhase({interaction:l,event:o,phase:"resume"}),ne(l.coords.prev,l.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,Qe.cancel(this.timeout)}}]),n})();function Xt(n){var t=n.interactable,r=n.prepared;return t&&t.options&&r.name&&t.options[r.name].inertia}var Kr={id:"inertia",before:["modifiers","actions"],install:function(n){var t=n.defaults;n.usePlugin(Jn),n.usePlugin(Un),n.actions.phases.inertiastart=!0,n.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(n){var t=n.interaction;t.inertia=new $r(t)},"interactions:before-action-end":function(n){var t=n.interaction,r=n.event;return(!t._interacting||t.simulation||!t.inertia.start(r))&&null},"interactions:down":function(n){var t=n.interaction,r=n.eventTarget,o=t.inertia;if(o.active)for(var s=r;k.element(s);){if(s===t.element){o.resume(n);break}s=xe(s)}},"interactions:stop":function(n){var t=n.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(n){var t=n.interaction.modification;t.stop(n),t.start(n,n.interaction.coords.cur.page),t.applyToInteraction(n)},"interactions:before-action-inertiastart":function(n){return n.interaction.modification.setAndApply(n)},"interactions:action-resume":Ft,"interactions:action-inertiastart":Ft,"interactions:after-action-inertiastart":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-resume":function(n){return n.interaction.modification.restoreInteractionCoords(n)}}};function Qn(n,t,r,o){var s=1-n;return s*s*t+2*s*n*r+n*n*o}function Zn(n,t,r,o){return-r*(n/=o)*(n-2)+t}var Ur=Kr;function ei(n,t){for(var r=0;r<t.length;r++){var o=t[r];if(n.immediatePropagationStopped)break;o(n)}}var ti=(function(){function n(t){c(this,n),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=H({},t||{})}return u(n,[{key:"fire",value:function(t){var r,o=this.global;(r=this.types[t.type])&&ei(t,r),!t.propagationStopped&&o&&(r=o[t.type])&&ei(t,r)}},{key:"on",value:function(t,r){var o=Re(t,r);for(t in o)this.types[t]=Pt(this.types[t]||[],o[t])}},{key:"off",value:function(t,r){var o=Re(t,r);for(t in o){var s=this.types[t];if(s&&s.length)for(var l=0,p=o[t];l<p.length;l++){var f=p[l],y=s.indexOf(f);y!==-1&&s.splice(y,1)}}}},{key:"getRect",value:function(t){return null}}]),n})(),Wr=(function(){function n(t){c(this,n),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,j(this,t)}return u(n,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),n})();function zt(n){return k.object(n)?{capture:!!n.capture,passive:!!n.passive}:{capture:!!n,passive:!1}}function Vt(n,t){return n===t||(typeof n=="boolean"?!!t.capture===n&&!t.passive:!!n.capture==!!t.capture&&!!n.passive==!!t.passive)}var Xr={id:"events",install:function(n){var t,r=[],o={},s=[],l={add:p,remove:f,addDelegate:function(b,S,C,P,O){var L=zt(O);if(!o[C]){o[C]=[];for(var N=0;N<s.length;N++){var B=s[N];p(B,C,y),p(B,C,x,!0)}}var Y=o[C],J=G(Y,(function(Z){return Z.selector===b&&Z.context===S}));J||(J={selector:b,context:S,listeners:[]},Y.push(J)),J.listeners.push({func:P,options:L})},removeDelegate:function(b,S,C,P,O){var L,N=zt(O),B=o[C],Y=!1;if(B)for(L=B.length-1;L>=0;L--){var J=B[L];if(J.selector===b&&J.context===S){for(var Z=J.listeners,U=Z.length-1;U>=0;U--){var Q=Z[U];if(Q.func===P&&Vt(Q.options,N)){Z.splice(U,1),Z.length||(B.splice(L,1),f(S,C,y),f(S,C,x,!0)),Y=!0;break}}if(Y)break}}},delegateListener:y,delegateUseCapture:x,delegatedEvents:o,documents:s,targets:r,supportsOptions:!1,supportsPassive:!1};function p(b,S,C,P){if(b.addEventListener){var O=zt(P),L=G(r,(function(N){return N.eventTarget===b}));L||(L={eventTarget:b,events:{}},r.push(L)),L.events[S]||(L.events[S]=[]),G(L.events[S],(function(N){return N.func===C&&Vt(N.options,O)}))||(b.addEventListener(S,C,l.supportsOptions?O:O.capture),L.events[S].push({func:C,options:O}))}}function f(b,S,C,P){if(b.addEventListener&&b.removeEventListener){var O=te(r,(function(Oe){return Oe.eventTarget===b})),L=r[O];if(L&&L.events)if(S!=="all"){var N=!1,B=L.events[S];if(B){if(C==="all"){for(var Y=B.length-1;Y>=0;Y--){var J=B[Y];f(b,S,J.func,J.options)}return}for(var Z=zt(P),U=0;U<B.length;U++){var Q=B[U];if(Q.func===C&&Vt(Q.options,Z)){b.removeEventListener(S,C,l.supportsOptions?Z:Z.capture),B.splice(U,1),B.length===0&&(delete L.events[S],N=!0);break}}}N&&!Object.keys(L.events).length&&r.splice(O,1)}else for(S in L.events)L.events.hasOwnProperty(S)&&f(b,S,"all")}}function y(b,S){for(var C=zt(S),P=new Wr(b),O=o[b.type],L=Mt(b)[0],N=L;k.element(N);){for(var B=0;B<O.length;B++){var Y=O[B],J=Y.selector,Z=Y.context;if(Ye(N,J)&&He(Z,L)&&He(Z,N)){var U=Y.listeners;P.currentTarget=N;for(var Q=0;Q<U.length;Q++){var Oe=U[Q];Vt(Oe.options,C)&&Oe.func(P)}}}N=xe(N)}}function x(b){return y(b,!0)}return(t=n.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return l.supportsOptions=!0},get passive(){return l.supportsPassive=!0}}),n.events=l,l}},fn={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(n){for(var t=0,r=fn.methodOrder;t<r.length;t++){var o=r[t],s=fn[o](n);if(s)return s}return null},simulationResume:function(n){var t=n.pointerType,r=n.eventType,o=n.eventTarget,s=n.scope;if(!/down|start/i.test(r))return null;for(var l=0,p=s.interactions.list;l<p.length;l++){var f=p[l],y=o;if(f.simulation&&f.simulation.allowResume&&f.pointerType===t)for(;y;){if(y===f.element)return f;y=xe(y)}}return null},mouseOrPen:function(n){var t,r=n.pointerId,o=n.pointerType,s=n.eventType,l=n.scope;if(o!=="mouse"&&o!=="pen")return null;for(var p=0,f=l.interactions.list;p<f.length;p++){var y=f[p];if(y.pointerType===o){if(y.simulation&&!ni(y,r))continue;if(y.interacting())return y;t||(t=y)}}if(t)return t;for(var x=0,b=l.interactions.list;x<b.length;x++){var S=b[x];if(!(S.pointerType!==o||/down/i.test(s)&&S.simulation))return S}return null},hasPointer:function(n){for(var t=n.pointerId,r=0,o=n.scope.interactions.list;r<o.length;r++){var s=o[r];if(ni(s,t))return s}return null},idle:function(n){for(var t=n.pointerType,r=0,o=n.scope.interactions.list;r<o.length;r++){var s=o[r];if(s.pointers.length===1){var l=s.interactable;if(l&&(!l.options.gesture||!l.options.gesture.enabled))continue}else if(s.pointers.length>=2)continue;if(!s.interacting()&&t===s.pointerType)return s}return null}};function ni(n,t){return n.pointers.some((function(r){return r.id===t}))}var Vr=fn,gn=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function ii(n,t){return function(r){var o=t.interactions.list,s=Ot(r),l=Mt(r),p=l[0],f=l[1],y=[];if(/^touch/.test(r.type)){t.prevTouchTime=t.now();for(var x=0,b=r.changedTouches;x<b.length;x++){var S=b[x],C={pointer:S,pointerId:q(S),pointerType:s,eventType:r.type,eventTarget:p,curEventTarget:f,scope:t},P=ri(C);y.push([C.pointer,C.eventTarget,C.curEventTarget,P])}}else{var O=!1;if(!Pe.supportsPointerEvent&&/mouse/.test(r.type)){for(var L=0;L<o.length&&!O;L++)O=o[L].pointerType!=="mouse"&&o[L].pointerIsDown;O=O||t.now()-t.prevTouchTime<500||r.timeStamp===0}if(!O){var N={pointer:r,pointerId:q(r),pointerType:s,eventType:r.type,curEventTarget:f,eventTarget:p,scope:t},B=ri(N);y.push([N.pointer,N.eventTarget,N.curEventTarget,B])}}for(var Y=0;Y<y.length;Y++){var J=y[Y],Z=J[0],U=J[1],Q=J[2];J[3][n](Z,r,U,Q)}}}function ri(n){var t=n.pointerType,r=n.scope,o={interaction:Vr.search(n),searchDetails:n};return r.fire("interactions:find",o),o.interaction||r.interactions.new({pointerType:t})}function mn(n,t){var r=n.doc,o=n.scope,s=n.options,l=o.interactions.docEvents,p=o.events,f=p[t];for(var y in o.browser.isIOS&&!s.events&&(s.events={passive:!1}),p.delegatedEvents)f(r,y,p.delegateListener),f(r,y,p.delegateUseCapture,!0);for(var x=s&&s.events,b=0;b<l.length;b++){var S=l[b];f(r,S.type,S.listener,x)}}var Gr={id:"core/interactions",install:function(n){for(var t={},r=0;r<gn.length;r++){var o=gn[r];t[o]=ii(o,n)}var s,l=Pe.pEventTypes;function p(){for(var f=0,y=n.interactions.list;f<y.length;f++){var x=y[f];if(x.pointerIsDown&&x.pointerType==="touch"&&!x._interacting)for(var b=function(){var P=C[S];n.documents.some((function(O){return He(O.doc,P.downTarget)}))||x.removePointer(P.pointer,P.event)},S=0,C=x.pointers;S<C.length;S++)b()}}(s=ce.PointerEvent?[{type:l.down,listener:p},{type:l.down,listener:t.pointerDown},{type:l.move,listener:t.pointerMove},{type:l.up,listener:t.pointerUp},{type:l.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:p},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(f){for(var y=0,x=n.interactions.list;y<x.length;y++)x[y].documentBlur(f)}}),n.prevTouchTime=0,n.Interaction=(function(f){g(x,f);var y=_(x);function x(){return c(this,x),y.apply(this,arguments)}return u(x,[{key:"pointerMoveTolerance",get:function(){return n.interactions.pointerMoveTolerance},set:function(b){n.interactions.pointerMoveTolerance=b}},{key:"_now",value:function(){return n.now()}}]),x})(qr),n.interactions={list:[],new:function(f){f.scopeFire=function(x,b){return n.fire(x,b)};var y=new n.Interaction(f);return n.interactions.list.push(y),y},listeners:t,docEvents:s,pointerMoveTolerance:1},n.usePlugin(Kn)},listeners:{"scope:add-document":function(n){return mn(n,"add")},"scope:remove-document":function(n){return mn(n,"remove")},"interactable:unset":function(n,t){for(var r=n.interactable,o=t.interactions.list.length-1;o>=0;o--){var s=t.interactions.list[o];s.interactable===r&&(s.stop(),t.fire("interactions:destroy",{interaction:s}),s.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(o,1))}}},onDocSignal:mn,doOnInteractions:ii,methodNames:gn},Jr=Gr,et=(function(n){return n[n.On=0]="On",n[n.Off=1]="Off",n})(et||{}),Qr=(function(){function n(t,r,o,s){c(this,n),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new ti,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=r.actions,this.target=t,this._context=r.context||o,this._win=T(mt(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=s,this.set(r)}return u(n,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,r){return k.func(r.onstart)&&this.on("".concat(t,"start"),r.onstart),k.func(r.onmove)&&this.on("".concat(t,"move"),r.onmove),k.func(r.onend)&&this.on("".concat(t,"end"),r.onend),k.func(r.oninertiastart)&&this.on("".concat(t,"inertiastart"),r.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,r,o){var s,l=this,p=(s=this._actions.map[t])==null?void 0:s.filterEventType,f=function(y){return(p==null||p(y))&&Ut(y,l._actions)};(k.array(r)||k.object(r))&&this._onOff(et.Off,t,r,void 0,f),(k.array(o)||k.object(o))&&this._onOff(et.On,t,o,void 0,f)}},{key:"setPerAction",value:function(t,r){var o=this._defaults;for(var s in r){var l=s,p=this.options[t],f=r[l];l==="listeners"&&this.updatePerActionListeners(t,p.listeners,f),k.array(f)?p[l]=It(f):k.plainObject(f)?(p[l]=H(p[l]||{},St(f)),k.object(o.perAction[l])&&"enabled"in o.perAction[l]&&(p[l].enabled=f.enabled!==!1)):k.bool(f)&&k.object(o.perAction[l])?p[l].enabled=f:p[l]=f}}},{key:"getRect",value:function(t){return t=t||(k.element(this.target)?this.target:null),k.string(this.target)&&(t=t||this._context.querySelector(this.target)),pe(t)}},{key:"rectChecker",value:function(t){var r=this;return k.func(t)?(this.getRect=function(o){var s=H({},t.apply(r,o));return"width"in s||(s.width=s.right-s.left,s.height=s.bottom-s.top),s},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,r){if(mt(r)||k.object(r)){for(var o in this.options[t]=r,this._actions.map)this.options[o][t]=r;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return k.string(t)?Array.from(this._context.querySelectorAll(t)):k.func(t)&&t.getAllElements?t.getAllElements():k.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||He(this._context,t)}},{key:"testIgnoreAllow",value:function(t,r,o){return!this.testIgnore(t.ignoreFrom,r,o)&&this.testAllow(t.allowFrom,r,o)}},{key:"testAllow",value:function(t,r,o){return!t||!!k.element(o)&&(k.string(t)?K(o,t,r):!!k.element(t)&&He(t,o))}},{key:"testIgnore",value:function(t,r,o){return!(!t||!k.element(o))&&(k.string(t)?K(o,t,r):!!k.element(t)&&He(t,o))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,r,o,s,l){k.object(r)&&!k.array(r)&&(s=o,o=null);var p=Re(r,o,l);for(var f in p){f==="wheel"&&(f=Pe.wheelEvent);for(var y=0,x=p[f];y<x.length;y++){var b=x[y];Ut(f,this._actions)?this.events[t===et.On?"on":"off"](f,b):k.string(this.target)?this._scopeEvents[t===et.On?"addDelegate":"removeDelegate"](this.target,this._context,f,b,s):this._scopeEvents[t===et.On?"add":"remove"](this.target,f,b,s)}}return this}},{key:"on",value:function(t,r,o){return this._onOff(et.On,t,r,o)}},{key:"off",value:function(t,r,o){return this._onOff(et.Off,t,r,o)}},{key:"set",value:function(t){var r=this._defaults;for(var o in k.object(t)||(t={}),this.options=St(r.base),this._actions.methodDict){var s=o,l=this._actions.methodDict[s];this.options[s]={},this.setPerAction(s,H(H({},r.perAction),r.actions[s])),this[l](t[s])}for(var p in t)p!=="getRect"?k.func(this[p])&&this[p](t[p]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(k.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var r=this._scopeEvents.delegatedEvents[t],o=r.length-1;o>=0;o--){var s=r[o],l=s.selector,p=s.context,f=s.listeners;l===this.target&&p===this._context&&r.splice(o,1);for(var y=f.length-1;y>=0;y--)this._scopeEvents.removeDelegate(this.target,this._context,t,f[y][0],f[y][1])}else this._scopeEvents.remove(this.target,"all")}}]),n})(),Zr=(function(){function n(t){var r=this;c(this,n),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(o){var s=o.interactable,l=s.target,p=k.string(l)?r.selectorMap[l]:l[r.scope.id],f=te(p,(function(y){return y===s}));p.splice(f,1)}})}return u(n,[{key:"new",value:function(t,r){r=H(r||{},{actions:this.scope.actions});var o=new this.scope.Interactable(t,r,this.scope.document,this.scope.events);return this.scope.addDocument(o._doc),this.list.push(o),k.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(o)):(o.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(o)),this.scope.fire("interactable:new",{target:t,options:r,interactable:o,win:this.scope._win}),o}},{key:"getExisting",value:function(t,r){var o=r&&r.context||this.scope.document,s=k.string(t),l=s?this.selectorMap[t]:t[this.scope.id];if(l)return G(l,(function(p){return p._context===o&&(s||p.inContext(t))}))}},{key:"forEachMatch",value:function(t,r){for(var o=0,s=this.list;o<s.length;o++){var l=s[o],p=void 0;if((k.string(l.target)?k.element(t)&&Ye(t,l.target):t===l.target)&&l.inContext(t)&&(p=r(l)),p!==void 0)return p}}}]),n})(),eo=(function(){function n(){var t=this;c(this,n),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=Pe,this.defaults=St(Wn),this.Eventable=ti,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(o){var s=function l(p,f){var y=o.interactables.getExisting(p,f);return y||((y=o.interactables.new(p,f)).events.global=l.globalEvents),y};return s.getPointerAverage=Fe,s.getTouchBBox=fe,s.getTouchDistance=Be,s.getTouchAngle=$e,s.getElementRect=pe,s.getElementClientRect=oe,s.matchesSelector=Ye,s.closest=rt,s.globalEvents={},s.version="1.10.27",s.scope=o,s.use=function(l,p){return this.scope.usePlugin(l,p),this},s.isSet=function(l,p){return!!this.scope.interactables.get(l,p&&p.context)},s.on=Lt((function(l,p,f){if(k.string(l)&&l.search(" ")!==-1&&(l=l.trim().split(/ +/)),k.array(l)){for(var y=0,x=l;y<x.length;y++){var b=x[y];this.on(b,p,f)}return this}if(k.object(l)){for(var S in l)this.on(S,l[S],p);return this}return Ut(l,this.scope.actions)?this.globalEvents[l]?this.globalEvents[l].push(p):this.globalEvents[l]=[p]:this.scope.events.add(this.scope.document,l,p,{options:f}),this}),"The interact.on() method is being deprecated"),s.off=Lt((function(l,p,f){if(k.string(l)&&l.search(" ")!==-1&&(l=l.trim().split(/ +/)),k.array(l)){for(var y=0,x=l;y<x.length;y++){var b=x[y];this.off(b,p,f)}return this}if(k.object(l)){for(var S in l)this.off(S,l[S],p);return this}var C;return Ut(l,this.scope.actions)?l in this.globalEvents&&(C=this.globalEvents[l].indexOf(p))!==-1&&this.globalEvents[l].splice(C,1):this.scope.events.remove(this.scope.document,l,p,f),this}),"The interact.off() method is being deprecated"),s.debug=function(){return this.scope},s.supportsTouch=function(){return Pe.supportsTouch},s.supportsPointerEvent=function(){return Pe.supportsPointerEvent},s.stop=function(){for(var l=0,p=this.scope.interactions.list;l<p.length;l++)p[l].stop();return this},s.pointerMoveTolerance=function(l){return k.number(l)?(this.scope.interactions.pointerMoveTolerance=l,this):this.scope.interactions.pointerMoveTolerance},s.addDocument=function(l,p){this.scope.addDocument(l,p)},s.removeDocument=function(l){this.scope.removeDocument(l)},s})(this),this.InteractEvent=pn,this.Interactable=void 0,this.interactables=new Zr(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(o){return t.removeDocument(o.target)};var r=this;this.Interactable=(function(o){g(l,o);var s=_(l);function l(){return c(this,l),s.apply(this,arguments)}return u(l,[{key:"_defaults",get:function(){return r.defaults}},{key:"set",value:function(p){return E(m(l.prototype),"set",this).call(this,p),r.fire("interactable:set",{options:p,interactable:this}),this}},{key:"unset",value:function(){E(m(l.prototype),"unset",this).call(this);var p=r.interactables.list.indexOf(this);p<0||(r.interactables.list.splice(p,1),r.fire("interactable:unset",{interactable:this}))}}]),l})(Qr)}return u(n,[{key:"addListeners",value:function(t,r){this.listenerMaps.push({id:r,map:t})}},{key:"fire",value:function(t,r){for(var o=0,s=this.listenerMaps;o<s.length;o++){var l=s[o].map[t];if(l&&l(r,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(r,o){return r.isInitialized=!0,k.window(o)&&F(o),ce.init(o),Pe.init(o),Qe.init(o),r.window=o,r.document=o.document,r.usePlugin(Jr),r.usePlugin(Xr),r})(this,t)}},{key:"pluginIsInstalled",value:function(t){var r=t.id;return r?!!this._plugins.map[r]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,r){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,r),t.listeners&&t.before){for(var o=0,s=this.listenerMaps.length,l=t.before.reduce((function(f,y){return f[y]=!0,f[oi(y)]=!0,f}),{});o<s;o++){var p=this.listenerMaps[o].id;if(p&&(l[p]||l[oi(p)]))break}this.listenerMaps.splice(o,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,r){if(this.getDocIndex(t)!==-1)return!1;var o=T(t);r=r?H({},r):{},this.documents.push({doc:t,options:r}),this.events.documents.push(t),t!==this.document&&this.events.add(o,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:o,scope:this,options:r})}},{key:"removeDocument",value:function(t){var r=this.getDocIndex(t),o=T(t),s=this.documents[r].options;this.events.remove(o,"unload",this.onWindowUnload),this.documents.splice(r,1),this.events.documents.splice(r,1),this.fire("scope:remove-document",{doc:t,window:o,scope:this,options:s})}},{key:"getDocIndex",value:function(t){for(var r=0;r<this.documents.length;r++)if(this.documents[r].doc===t)return r;return-1}},{key:"getDocOptions",value:function(t){var r=this.getDocIndex(t);return r===-1?null:this.documents[r].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),n})();function oi(n){return n&&n.replace(/\/.*$/,"")}var ai=new eo,Te=ai.interactStatic,to=typeof globalThis!="undefined"?globalThis:window;ai.init(to);var no=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(n){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(o){var s=o[0],l=o[1];return s in n||l in n})),r=function(o,s){for(var l=n.range,p=n.limits,f=p===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:p,y=n.offset,x=y===void 0?{x:0,y:0}:y,b={range:l,grid:n,x:null,y:null},S=0;S<t.length;S++){var C=t[S],P=C[0],O=C[1],L=Math.round((o-x.x)/n[P]),N=Math.round((s-x.y)/n[O]);b[P]=Math.max(f.left,Math.min(f.right,L*n[P]+x.x)),b[O]=Math.max(f.top,Math.min(f.bottom,N*n[O]+x.y))}return b};return r.grid=n,r.coordFields=t,r}}),io={id:"snappers",install:function(n){var t=n.interactStatic;t.snappers=H(t.snappers||{},no),t.createSnapGrid=t.snappers.grid}},ro=io,oo={start:function(n){var t=n.state,r=n.rect,o=n.edges,s=n.pageCoords,l=t.options,p=l.ratio,f=l.enabled,y=t.options,x=y.equalDelta,b=y.modifiers;p==="preserve"&&(p=r.width/r.height),t.startCoords=H({},s),t.startRect=H({},r),t.ratio=p,t.equalDelta=x;var S=t.linkedEdges={top:o.top||o.left&&!o.bottom,left:o.left||o.top&&!o.right,bottom:o.bottom||o.right&&!o.top,right:o.right||o.bottom&&!o.left};if(t.xIsPrimaryAxis=!(!o.left&&!o.right),t.equalDelta){var C=(S.left?1:-1)*(S.top?1:-1);t.edgeSign={x:C,y:C}}else t.edgeSign={x:S.left?-1:1,y:S.top?-1:1};if(f!==!1&&H(o,S),b!=null&&b.length){var P=new un(n.interaction);P.copyFrom(n.interaction.modification),P.prepareStates(b),t.subModification=P,P.startAll(i({},n))}},set:function(n){var t=n.state,r=n.rect,o=n.coords,s=t.linkedEdges,l=H({},o),p=t.equalDelta?ao:so;if(H(n.edges,s),p(t,t.xIsPrimaryAxis,o,r),!t.subModification)return null;var f=H({},r);bt(s,f,{x:o.x-l.x,y:o.y-l.y});var y=t.subModification.setAll(i(i({},n),{},{rect:f,edges:s,pageCoords:o,prevCoords:o,prevRect:f})),x=y.delta;return y.changed&&(p(t,Math.abs(x.x)>Math.abs(x.y),y.coords,y.rect),H(o,y.coords)),y.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function ao(n,t,r){var o=n.startCoords,s=n.edgeSign;t?r.y=o.y+(r.x-o.x)*s.y:r.x=o.x+(r.y-o.y)*s.x}function so(n,t,r,o){var s=n.startRect,l=n.startCoords,p=n.ratio,f=n.edgeSign;if(t){var y=o.width/p;r.y=l.y+(y-s.height)*f.y}else{var x=o.height*p;r.x=l.x+(x-s.width)*f.x}}var lo=Ze(oo,"aspectRatio"),si=function(){};si._defaults={};var Gt=si;function ut(n,t,r){return k.func(n)?ke(n,t.interactable,t.element,[r.x,r.y,t]):ke(n,t.interactable,t.element)}var Jt={start:function(n){var t=n.rect,r=n.startOffset,o=n.state,s=n.interaction,l=n.pageCoords,p=o.options,f=p.elementRect,y=H({left:0,top:0,right:0,bottom:0},p.offset||{});if(t&&f){var x=ut(p.restriction,s,l);if(x){var b=x.right-x.left-t.width,S=x.bottom-x.top-t.height;b<0&&(y.left+=b,y.right+=b),S<0&&(y.top+=S,y.bottom+=S)}y.left+=r.left-t.width*f.left,y.top+=r.top-t.height*f.top,y.right+=r.right-t.width*(1-f.right),y.bottom+=r.bottom-t.height*(1-f.bottom)}o.offset=y},set:function(n){var t=n.coords,r=n.interaction,o=n.state,s=o.options,l=o.offset,p=ut(s.restriction,r,t);if(p){var f=(function(y){return!y||"left"in y&&"top"in y||((y=H({},y)).left=y.x||0,y.top=y.y||0,y.right=y.right||y.left+y.width,y.bottom=y.bottom||y.top+y.height),y})(p);t.x=Math.max(Math.min(f.right-l.right,t.x),f.left+l.left),t.y=Math.max(Math.min(f.bottom-l.bottom,t.y),f.top+l.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},co=Ze(Jt,"restrict"),li={top:1/0,left:1/0,bottom:-1/0,right:-1/0},ci={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function di(n,t){for(var r=0,o=["top","left","bottom","right"];r<o.length;r++){var s=o[r];s in n||(n[s]=t[s])}return n}var Dt={noInner:li,noOuter:ci,start:function(n){var t,r=n.interaction,o=n.startOffset,s=n.state,l=s.options;l&&(t=yt(ut(l.offset,r,r.coords.start.page))),t=t||{x:0,y:0},s.offset={top:t.y+o.top,left:t.x+o.left,bottom:t.y-o.bottom,right:t.x-o.right}},set:function(n){var t=n.coords,r=n.edges,o=n.interaction,s=n.state,l=s.offset,p=s.options;if(r){var f=H({},t),y=ut(p.inner,o,f)||{},x=ut(p.outer,o,f)||{};di(y,li),di(x,ci),r.top?t.y=Math.min(Math.max(x.top+l.top,f.y),y.top+l.top):r.bottom&&(t.y=Math.max(Math.min(x.bottom+l.bottom,f.y),y.bottom+l.bottom)),r.left?t.x=Math.min(Math.max(x.left+l.left,f.x),y.left+l.left):r.right&&(t.x=Math.max(Math.min(x.right+l.right,f.x),y.right+l.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},uo=Ze(Dt,"restrictEdges"),po=H({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(n){}},Jt.defaults),ho=Ze({start:Jt.start,set:Jt.set,defaults:po},"restrictRect"),fo={width:-1/0,height:-1/0},go={width:1/0,height:1/0},mo=Ze({start:function(n){return Dt.start(n)},set:function(n){var t=n.interaction,r=n.state,o=n.rect,s=n.edges,l=r.options;if(s){var p=Tt(ut(l.min,t,n.coords))||fo,f=Tt(ut(l.max,t,n.coords))||go;r.options={endOnly:l.endOnly,inner:H({},Dt.noInner),outer:H({},Dt.noOuter)},s.top?(r.options.inner.top=o.bottom-p.height,r.options.outer.top=o.bottom-f.height):s.bottom&&(r.options.inner.bottom=o.top+p.height,r.options.outer.bottom=o.top+f.height),s.left?(r.options.inner.left=o.right-p.width,r.options.outer.left=o.right-f.width):s.right&&(r.options.inner.right=o.left+p.width,r.options.outer.right=o.left+f.width),Dt.set(n),r.options=l}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),vn={start:function(n){var t,r=n.interaction,o=n.interactable,s=n.element,l=n.rect,p=n.state,f=n.startOffset,y=p.options,x=y.offsetWithOrigin?(function(C){var P=C.interaction.element,O=yt(ke(C.state.options.origin,null,null,[P])),L=O||We(C.interactable,P,C.interaction.prepared.name);return L})(n):{x:0,y:0};if(y.offset==="startCoords")t={x:r.coords.start.page.x,y:r.coords.start.page.y};else{var b=ke(y.offset,o,s,[r]);(t=yt(b)||{x:0,y:0}).x+=x.x,t.y+=x.y}var S=y.relativePoints;p.offsets=l&&S&&S.length?S.map((function(C,P){return{index:P,relativePoint:C,x:f.left-l.width*C.x+t.x,y:f.top-l.height*C.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(n){var t=n.interaction,r=n.coords,o=n.state,s=o.options,l=o.offsets,p=We(t.interactable,t.element,t.prepared.name),f=H({},r),y=[];s.offsetWithOrigin||(f.x-=p.x,f.y-=p.y);for(var x=0,b=l;x<b.length;x++)for(var S=b[x],C=f.x-S.x,P=f.y-S.y,O=0,L=s.targets.length;O<L;O++){var N=s.targets[O],B=void 0;(B=k.func(N)?N(C,P,t._proxy,S,O):N)&&y.push({x:(k.number(B.x)?B.x:C)+S.x,y:(k.number(B.y)?B.y:P)+S.y,range:k.number(B.range)?B.range:s.range,source:N,index:O,offset:S})}for(var Y={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},J=0;J<y.length;J++){var Z=y[J],U=Z.range,Q=Z.x-f.x,Oe=Z.y-f.y,ue=_t(Q,Oe),ze=ue<=U;U===1/0&&Y.inRange&&Y.range!==1/0&&(ze=!1),Y.target&&!(ze?Y.inRange&&U!==1/0?ue/U<Y.distance/Y.range:U===1/0&&Y.range!==1/0||ue<Y.distance:!Y.inRange&&ue<Y.distance)||(Y.target=Z,Y.distance=ue,Y.range=U,Y.inRange=ze,Y.delta.x=Q,Y.delta.y=Oe)}return Y.inRange&&(r.x=Y.target.x,r.y=Y.target.y),o.closest=Y,Y},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},vo=Ze(vn,"snap"),Qt={start:function(n){var t=n.state,r=n.edges,o=t.options;if(!r)return null;n.state={options:{targets:null,relativePoints:[{x:r.left?0:1,y:r.top?0:1}],offset:o.offset||"self",origin:{x:0,y:0},range:o.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],vn.start(n),t.offsets=n.state.offsets,n.state=t},set:function(n){var t=n.interaction,r=n.state,o=n.coords,s=r.options,l=r.offsets,p={x:o.x-l[0].x,y:o.y-l[0].y};r.options=H({},s),r.options.targets=[];for(var f=0,y=s.targets||[];f<y.length;f++){var x=y[f],b=void 0;if(b=k.func(x)?x(p.x,p.y,t):x){for(var S=0,C=r.targetFields;S<C.length;S++){var P=C[S],O=P[0],L=P[1];if(O in b||L in b){b.x=b[O],b.y=b[L];break}}r.options.targets.push(b)}}var N=vn.set(n);return r.options=s,N},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},yo=Ze(Qt,"snapSize"),yn={aspectRatio:lo,restrictEdges:uo,restrict:co,restrictRect:ho,restrictSize:mo,snapEdges:Ze({start:function(n){var t=n.edges;return t?(n.state.targetFields=n.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],Qt.start(n)):null},set:Qt.set,defaults:H(St(Qt.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:vo,snapSize:yo,spring:Gt,avoid:Gt,transform:Gt,rubberband:Gt},bo={id:"modifiers",install:function(n){var t=n.interactStatic;for(var r in n.usePlugin(Un),n.usePlugin(ro),t.modifiers=yn,yn){var o=yn[r],s=o._defaults,l=o._methods;s._methods=l,n.defaults.perAction[r]=s}}},xo=bo,ui=(function(n){g(r,n);var t=_(r);function r(o,s,l,p,f,y){var x;if(c(this,r),j(w(x=t.call(this,f)),l),l!==s&&j(w(x),s),x.timeStamp=y,x.originalEvent=l,x.type=o,x.pointerId=q(s),x.pointerType=Ot(s),x.target=p,x.currentTarget=null,o==="tap"){var b=f.getPointerIndex(s);x.dt=x.timeStamp-f.pointers[b].downTime;var S=x.timeStamp-f.tapTime;x.double=!!f.prevTap&&f.prevTap.type!=="doubletap"&&f.prevTap.target===x.target&&S<500}else o==="doubletap"&&(x.dt=s.timeStamp-f.tapTime,x.double=!0);return x}return u(r,[{key:"_subtractOrigin",value:function(o){var s=o.x,l=o.y;return this.pageX-=s,this.pageY-=l,this.clientX-=s,this.clientY-=l,this}},{key:"_addOrigin",value:function(o){var s=o.x,l=o.y;return this.pageX+=s,this.pageY+=l,this.clientX+=s,this.clientY+=l,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),r})(ot),Rt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(n){n.pointerEvents=Rt,n.defaults.actions.pointerEvents=Rt.defaults,H(n.actions.phaselessTypes,Rt.types)},listeners:{"interactions:new":function(n){var t=n.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(n){var t=n.down,r=n.pointerInfo;!t&&r.hold||(r.hold={duration:1/0,timeout:null})},"interactions:move":function(n,t){var r=n.interaction,o=n.pointer,s=n.event,l=n.eventTarget;n.duplicate||r.pointerIsDown&&!r.pointerWasMoved||(r.pointerIsDown&&bn(n),tt({interaction:r,pointer:o,event:s,eventTarget:l,type:"move"},t))},"interactions:down":function(n,t){(function(r,o){for(var s=r.interaction,l=r.pointer,p=r.event,f=r.eventTarget,y=r.pointerIndex,x=s.pointers[y].hold,b=De(f),S={interaction:s,pointer:l,event:p,eventTarget:f,type:"hold",targets:[],path:b,node:null},C=0;C<b.length;C++){var P=b[C];S.node=P,o.fire("pointerEvents:collect-targets",S)}if(S.targets.length){for(var O=1/0,L=0,N=S.targets;L<N.length;L++){var B=N[L].eventable.options.holdDuration;B<O&&(O=B)}x.duration=O,x.timeout=setTimeout((function(){tt({interaction:s,eventTarget:f,pointer:l,event:p,type:"hold"},o)}),O)}})(n,t),tt(n,t)},"interactions:up":function(n,t){bn(n),tt(n,t),(function(r,o){var s=r.interaction,l=r.pointer,p=r.event,f=r.eventTarget;s.pointerWasMoved||tt({interaction:s,eventTarget:f,pointer:l,event:p,type:"tap"},o)})(n,t)},"interactions:cancel":function(n,t){bn(n),tt(n,t)}},PointerEvent:ui,fire:tt,collectEventTargets:pi,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function tt(n,t){var r=n.interaction,o=n.pointer,s=n.event,l=n.eventTarget,p=n.type,f=n.targets,y=f===void 0?pi(n,t):f,x=new ui(p,o,s,l,r,t.now());t.fire("pointerEvents:new",{pointerEvent:x});for(var b={interaction:r,pointer:o,event:s,eventTarget:l,targets:y,type:p,pointerEvent:x},S=0;S<y.length;S++){var C=y[S];for(var P in C.props||{})x[P]=C.props[P];var O=We(C.eventable,C.node);if(x._subtractOrigin(O),x.eventable=C.eventable,x.currentTarget=C.node,C.eventable.fire(x),x._addOrigin(O),x.immediatePropagationStopped||x.propagationStopped&&S+1<y.length&&y[S+1].node!==x.currentTarget)break}if(t.fire("pointerEvents:fired",b),p==="tap"){var L=x.double?tt({interaction:r,pointer:o,event:s,eventTarget:l,type:"doubletap"},t):x;r.prevTap=L,r.tapTime=L.timeStamp}return x}function pi(n,t){var r=n.interaction,o=n.pointer,s=n.event,l=n.eventTarget,p=n.type,f=r.getPointerIndex(o),y=r.pointers[f];if(p==="tap"&&(r.pointerWasMoved||!y||y.downTarget!==l))return[];for(var x=De(l),b={interaction:r,pointer:o,event:s,eventTarget:l,type:p,path:x,targets:[],node:null},S=0;S<x.length;S++){var C=x[S];b.node=C,t.fire("pointerEvents:collect-targets",b)}return p==="hold"&&(b.targets=b.targets.filter((function(P){var O,L;return P.eventable.options.holdDuration===((O=r.pointers[f])==null||(L=O.hold)==null?void 0:L.duration)}))),b.targets}function bn(n){var t=n.interaction,r=n.pointerIndex,o=t.pointers[r].hold;o&&o.timeout&&(clearTimeout(o.timeout),o.timeout=null)}var _o=Object.freeze({__proto__:null,default:Rt});function wo(n){var t=n.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var So={id:"pointer-events/holdRepeat",install:function(n){n.usePlugin(Rt);var t=n.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=n.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(n,t){return n["pointerEvents:".concat(t)]=wo,n}),{"pointerEvents:new":function(n){var t=n.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(n,t){var r=n.interaction,o=n.pointerEvent,s=n.eventTarget,l=n.targets;if(o.type==="hold"&&l.length){var p=l[0].eventable.options.holdRepeatInterval;p<=0||(r.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:r,eventTarget:s,type:"hold",pointer:o,event:o},t)}),p))}}})},ko=So,Eo={id:"pointer-events/interactableTargets",install:function(n){var t=n.Interactable;t.prototype.pointerEvents=function(o){return H(this.events.options,o),this};var r=t.prototype._backCompatOption;t.prototype._backCompatOption=function(o,s){var l=r.call(this,o,s);return l===this&&(this.events.options[o]=s),l}},listeners:{"pointerEvents:collect-targets":function(n,t){var r=n.targets,o=n.node,s=n.type,l=n.eventTarget;t.interactables.forEachMatch(o,(function(p){var f=p.events,y=f.options;f.types[s]&&f.types[s].length&&p.testIgnoreAllow(y,o,l)&&r.push({node:o,eventable:f,props:{interactable:p}})}))},"interactable:new":function(n){var t=n.interactable;t.events.getRect=function(r){return t.getRect(r)}},"interactable:set":function(n,t){var r=n.interactable,o=n.options;H(r.events.options,t.pointerEvents.defaults),H(r.events.options,o.pointerEvents||{})}}},Co=Eo,Ao={id:"pointer-events",install:function(n){n.usePlugin(_o),n.usePlugin(ko),n.usePlugin(Co)}},To=Ao,Oo={id:"reflow",install:function(n){var t=n.Interactable;n.actions.phases.reflow=!0,t.prototype.reflow=function(r){return(function(o,s,l){for(var p=o.getAllElements(),f=l.window.Promise,y=f?[]:null,x=function(){var S=p[b],C=o.getRect(S);if(!C)return 1;var P,O=G(l.interactions.list,(function(B){return B.interacting()&&B.interactable===o&&B.element===S&&B.prepared.name===s.name}));if(O)O.move(),y&&(P=O._reflowPromise||new f((function(B){O._reflowResolve=B})));else{var L=Tt(C),N=(function(B){return{coords:B,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:L.x,y:L.y},client:{x:L.x,y:L.y},timeStamp:l.now()});P=(function(B,Y,J,Z,U){var Q=B.interactions.new({pointerType:"reflow"}),Oe={interaction:Q,event:U,pointer:U,eventTarget:J,phase:"reflow"};Q.interactable=Y,Q.element=J,Q.prevEvent=U,Q.updatePointer(U,U,J,!0),se(Q.coords.delta),sn(Q.prepared,Z),Q._doPhase(Oe);var ue=B.window,ze=ue.Promise,qe=ze?new ze((function(Ge){Q._reflowResolve=Ge})):void 0;return Q._reflowPromise=qe,Q.start(Z,Y,J),Q._interacting?(Q.move(Oe),Q.end(U)):(Q.stop(),Q._reflowResolve()),Q.removePointer(U,U),qe})(l,o,S,s,N)}y&&y.push(P)},b=0;b<p.length&&!x();b++);return y&&f.all(y).then((function(){return o}))})(this,r,n)}},listeners:{"interactions:stop":function(n,t){var r=n.interaction;r.pointerType==="reflow"&&(r._reflowResolve&&r._reflowResolve(),(function(o,s){o.splice(o.indexOf(s),1)})(t.interactions.list,r))}}},Mo=Oo;if(Te.use(Kn),Te.use(Jn),Te.use(To),Te.use(Ur),Te.use(xo),Te.use(Fr),Te.use(Sr),Te.use(Er),Te.use(Mo),Te.default=Te,(typeof pt=="undefined"?"undefined":a(pt))==="object"&&pt)try{pt.exports=Te}catch{}return Te.default=Te,Te}))});var br=Bo(fi(),1);function Mi(e){return typeof e=="undefined"||e===null}function jo(e){return typeof e=="object"&&e!==null}function No(e){return Array.isArray(e)?e:Mi(e)?[]:[e]}function qo(e,i){var a,c,d,u;if(i)for(u=Object.keys(i),a=0,c=u.length;a<c;a+=1)d=u[a],e[d]=i[d];return e}function Ho(e,i){var a="",c;for(c=0;c<i;c+=1)a+=e;return a}function Yo(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var $o=Mi,Ko=jo,Uo=No,Wo=Ho,Xo=Yo,Vo=qo,ve={isNothing:$o,isObject:Ko,toArray:Uo,repeat:Wo,isNegativeZero:Xo,extend:Vo};function Pi(e,i){var a="",c=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(a+='in "'+e.mark.name+'" '),a+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!i&&e.mark.snippet&&(a+=`

`+e.mark.snippet),c+" "+a):c}function Nt(e,i){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=i,this.message=Pi(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Nt.prototype=Object.create(Error.prototype);Nt.prototype.constructor=Nt;Nt.prototype.toString=function(i){return this.name+": "+Pi(this,i)};var Me=Nt;function _n(e,i,a,c,d){var u="",h="",g=Math.floor(d/2)-1;return c-i>g&&(u=" ... ",i=c-g+u.length),a-c>g&&(h=" ...",a=c+g-h.length),{str:u+e.slice(i,a).replace(/\t/g,"\u2192")+h,pos:c-i+u.length}}function wn(e,i){return ve.repeat(" ",i-e.length)+e}function Go(e,i){if(i=Object.create(i||null),!e.buffer)return null;i.maxLength||(i.maxLength=79),typeof i.indent!="number"&&(i.indent=1),typeof i.linesBefore!="number"&&(i.linesBefore=3),typeof i.linesAfter!="number"&&(i.linesAfter=2);for(var a=/\r?\n|\r|\0/g,c=[0],d=[],u,h=-1;u=a.exec(e.buffer);)d.push(u.index),c.push(u.index+u[0].length),e.position<=u.index&&h<0&&(h=c.length-2);h<0&&(h=c.length-1);var g="",m,v,w=Math.min(e.line+i.linesAfter,d.length).toString().length,_=i.maxLength-(i.indent+w+3);for(m=1;m<=i.linesBefore&&!(h-m<0);m++)v=_n(e.buffer,c[h-m],d[h-m],e.position-(c[h]-c[h-m]),_),g=ve.repeat(" ",i.indent)+wn((e.line-m+1).toString(),w)+" | "+v.str+`
`+g;for(v=_n(e.buffer,c[h],d[h],e.position,_),g+=ve.repeat(" ",i.indent)+wn((e.line+1).toString(),w)+" | "+v.str+`
`,g+=ve.repeat("-",i.indent+w+3+v.pos)+`^
`,m=1;m<=i.linesAfter&&!(h+m>=d.length);m++)v=_n(e.buffer,c[h+m],d[h+m],e.position-(c[h]-c[h+m]),_),g+=ve.repeat(" ",i.indent)+wn((e.line+m+1).toString(),w)+" | "+v.str+`
`;return g.replace(/\n$/,"")}var Jo=Go,Qo=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Zo=["scalar","sequence","mapping"];function ea(e){var i={};return e!==null&&Object.keys(e).forEach(function(a){e[a].forEach(function(c){i[String(c)]=a})}),i}function ta(e,i){if(i=i||{},Object.keys(i).forEach(function(a){if(Qo.indexOf(a)===-1)throw new Me('Unknown option "'+a+'" is met in definition of "'+e+'" YAML type.')}),this.options=i,this.tag=e,this.kind=i.kind||null,this.resolve=i.resolve||function(){return!0},this.construct=i.construct||function(a){return a},this.instanceOf=i.instanceOf||null,this.predicate=i.predicate||null,this.represent=i.represent||null,this.representName=i.representName||null,this.defaultStyle=i.defaultStyle||null,this.multi=i.multi||!1,this.styleAliases=ea(i.styleAliases||null),Zo.indexOf(this.kind)===-1)throw new Me('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var we=ta;function gi(e,i){var a=[];return e[i].forEach(function(c){var d=a.length;a.forEach(function(u,h){u.tag===c.tag&&u.kind===c.kind&&u.multi===c.multi&&(d=h)}),a[d]=c}),a}function na(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},i,a;function c(d){d.multi?(e.multi[d.kind].push(d),e.multi.fallback.push(d)):e[d.kind][d.tag]=e.fallback[d.tag]=d}for(i=0,a=arguments.length;i<a;i+=1)arguments[i].forEach(c);return e}function kn(e){return this.extend(e)}kn.prototype.extend=function(i){var a=[],c=[];if(i instanceof we)c.push(i);else if(Array.isArray(i))c=c.concat(i);else if(i&&(Array.isArray(i.implicit)||Array.isArray(i.explicit)))i.implicit&&(a=a.concat(i.implicit)),i.explicit&&(c=c.concat(i.explicit));else throw new Me("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");a.forEach(function(u){if(!(u instanceof we))throw new Me("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(u.loadKind&&u.loadKind!=="scalar")throw new Me("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(u.multi)throw new Me("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),c.forEach(function(u){if(!(u instanceof we))throw new Me("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var d=Object.create(kn.prototype);return d.implicit=(this.implicit||[]).concat(a),d.explicit=(this.explicit||[]).concat(c),d.compiledImplicit=gi(d,"implicit"),d.compiledExplicit=gi(d,"explicit"),d.compiledTypeMap=na(d.compiledImplicit,d.compiledExplicit),d};var Ii=kn,Li=new we("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Fi=new we("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),zi=new we("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Di=new Ii({explicit:[Li,Fi,zi]});function ia(e){if(e===null)return!0;var i=e.length;return i===1&&e==="~"||i===4&&(e==="null"||e==="Null"||e==="NULL")}function ra(){return null}function oa(e){return e===null}var Ri=new we("tag:yaml.org,2002:null",{kind:"scalar",resolve:ia,construct:ra,predicate:oa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function aa(e){if(e===null)return!1;var i=e.length;return i===4&&(e==="true"||e==="True"||e==="TRUE")||i===5&&(e==="false"||e==="False"||e==="FALSE")}function sa(e){return e==="true"||e==="True"||e==="TRUE"}function la(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Bi=new we("tag:yaml.org,2002:bool",{kind:"scalar",resolve:aa,construct:sa,predicate:la,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ca(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function da(e){return 48<=e&&e<=55}function ua(e){return 48<=e&&e<=57}function pa(e){if(e===null)return!1;var i=e.length,a=0,c=!1,d;if(!i)return!1;if(d=e[a],(d==="-"||d==="+")&&(d=e[++a]),d==="0"){if(a+1===i)return!0;if(d=e[++a],d==="b"){for(a++;a<i;a++)if(d=e[a],d!=="_"){if(d!=="0"&&d!=="1")return!1;c=!0}return c&&d!=="_"}if(d==="x"){for(a++;a<i;a++)if(d=e[a],d!=="_"){if(!ca(e.charCodeAt(a)))return!1;c=!0}return c&&d!=="_"}if(d==="o"){for(a++;a<i;a++)if(d=e[a],d!=="_"){if(!da(e.charCodeAt(a)))return!1;c=!0}return c&&d!=="_"}}if(d==="_")return!1;for(;a<i;a++)if(d=e[a],d!=="_"){if(!ua(e.charCodeAt(a)))return!1;c=!0}return!(!c||d==="_")}function ha(e){var i=e,a=1,c;if(i.indexOf("_")!==-1&&(i=i.replace(/_/g,"")),c=i[0],(c==="-"||c==="+")&&(c==="-"&&(a=-1),i=i.slice(1),c=i[0]),i==="0")return 0;if(c==="0"){if(i[1]==="b")return a*parseInt(i.slice(2),2);if(i[1]==="x")return a*parseInt(i.slice(2),16);if(i[1]==="o")return a*parseInt(i.slice(2),8)}return a*parseInt(i,10)}function fa(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!ve.isNegativeZero(e)}var ji=new we("tag:yaml.org,2002:int",{kind:"scalar",resolve:pa,construct:ha,predicate:fa,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ga=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function ma(e){return!(e===null||!ga.test(e)||e[e.length-1]==="_")}function va(e){var i,a;return i=e.replace(/_/g,"").toLowerCase(),a=i[0]==="-"?-1:1,"+-".indexOf(i[0])>=0&&(i=i.slice(1)),i===".inf"?a===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:i===".nan"?NaN:a*parseFloat(i,10)}var ya=/^[-+]?[0-9]+e/;function ba(e,i){var a;if(isNaN(e))switch(i){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(i){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(i){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(ve.isNegativeZero(e))return"-0.0";return a=e.toString(10),ya.test(a)?a.replace("e",".e"):a}function xa(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||ve.isNegativeZero(e))}var Ni=new we("tag:yaml.org,2002:float",{kind:"scalar",resolve:ma,construct:va,predicate:xa,represent:ba,defaultStyle:"lowercase"}),qi=Di.extend({implicit:[Ri,Bi,ji,Ni]}),Hi=qi,Yi=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),$i=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function _a(e){return e===null?!1:Yi.exec(e)!==null||$i.exec(e)!==null}function wa(e){var i,a,c,d,u,h,g,m=0,v=null,w,_,E;if(i=Yi.exec(e),i===null&&(i=$i.exec(e)),i===null)throw new Error("Date resolve error");if(a=+i[1],c=+i[2]-1,d=+i[3],!i[4])return new Date(Date.UTC(a,c,d));if(u=+i[4],h=+i[5],g=+i[6],i[7]){for(m=i[7].slice(0,3);m.length<3;)m+="0";m=+m}return i[9]&&(w=+i[10],_=+(i[11]||0),v=(w*60+_)*6e4,i[9]==="-"&&(v=-v)),E=new Date(Date.UTC(a,c,d,u,h,g,m)),v&&E.setTime(E.getTime()-v),E}function Sa(e){return e.toISOString()}var Ki=new we("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:_a,construct:wa,instanceOf:Date,represent:Sa});function ka(e){return e==="<<"||e===null}var Ui=new we("tag:yaml.org,2002:merge",{kind:"scalar",resolve:ka}),On=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Ea(e){if(e===null)return!1;var i,a,c=0,d=e.length,u=On;for(a=0;a<d;a++)if(i=u.indexOf(e.charAt(a)),!(i>64)){if(i<0)return!1;c+=6}return c%8===0}function Ca(e){var i,a,c=e.replace(/[\r\n=]/g,""),d=c.length,u=On,h=0,g=[];for(i=0;i<d;i++)i%4===0&&i&&(g.push(h>>16&255),g.push(h>>8&255),g.push(h&255)),h=h<<6|u.indexOf(c.charAt(i));return a=d%4*6,a===0?(g.push(h>>16&255),g.push(h>>8&255),g.push(h&255)):a===18?(g.push(h>>10&255),g.push(h>>2&255)):a===12&&g.push(h>>4&255),new Uint8Array(g)}function Aa(e){var i="",a=0,c,d,u=e.length,h=On;for(c=0;c<u;c++)c%3===0&&c&&(i+=h[a>>18&63],i+=h[a>>12&63],i+=h[a>>6&63],i+=h[a&63]),a=(a<<8)+e[c];return d=u%3,d===0?(i+=h[a>>18&63],i+=h[a>>12&63],i+=h[a>>6&63],i+=h[a&63]):d===2?(i+=h[a>>10&63],i+=h[a>>4&63],i+=h[a<<2&63],i+=h[64]):d===1&&(i+=h[a>>2&63],i+=h[a<<4&63],i+=h[64],i+=h[64]),i}function Ta(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Wi=new we("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Ea,construct:Ca,predicate:Ta,represent:Aa}),Oa=Object.prototype.hasOwnProperty,Ma=Object.prototype.toString;function Pa(e){if(e===null)return!0;var i=[],a,c,d,u,h,g=e;for(a=0,c=g.length;a<c;a+=1){if(d=g[a],h=!1,Ma.call(d)!=="[object Object]")return!1;for(u in d)if(Oa.call(d,u))if(!h)h=!0;else return!1;if(!h)return!1;if(i.indexOf(u)===-1)i.push(u);else return!1}return!0}function Ia(e){return e!==null?e:[]}var Xi=new we("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Pa,construct:Ia}),La=Object.prototype.toString;function Fa(e){if(e===null)return!0;var i,a,c,d,u,h=e;for(u=new Array(h.length),i=0,a=h.length;i<a;i+=1){if(c=h[i],La.call(c)!=="[object Object]"||(d=Object.keys(c),d.length!==1))return!1;u[i]=[d[0],c[d[0]]]}return!0}function za(e){if(e===null)return[];var i,a,c,d,u,h=e;for(u=new Array(h.length),i=0,a=h.length;i<a;i+=1)c=h[i],d=Object.keys(c),u[i]=[d[0],c[d[0]]];return u}var Vi=new we("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Fa,construct:za}),Da=Object.prototype.hasOwnProperty;function Ra(e){if(e===null)return!0;var i,a=e;for(i in a)if(Da.call(a,i)&&a[i]!==null)return!1;return!0}function Ba(e){return e!==null?e:{}}var Gi=new we("tag:yaml.org,2002:set",{kind:"mapping",resolve:Ra,construct:Ba}),Mn=Hi.extend({implicit:[Ki,Ui],explicit:[Wi,Xi,Vi,Gi]}),it=Object.prototype.hasOwnProperty,en=1,Ji=2,Qi=3,tn=4,Sn=1,ja=2,mi=3,Na=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,qa=/[\x85\u2028\u2029]/,Ha=/[,\[\]\{\}]/,Zi=/^(?:!|!!|![a-z\-]+!)$/i,er=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function vi(e){return Object.prototype.toString.call(e)}function Ue(e){return e===10||e===13}function ft(e){return e===9||e===32}function Le(e){return e===9||e===32||e===10||e===13}function Et(e){return e===44||e===91||e===93||e===123||e===125}function Ya(e){var i;return 48<=e&&e<=57?e-48:(i=e|32,97<=i&&i<=102?i-97+10:-1)}function $a(e){return e===120?2:e===117?4:e===85?8:0}function Ka(e){return 48<=e&&e<=57?e-48:-1}function yi(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Ua(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var tr=new Array(256),nr=new Array(256);for(ht=0;ht<256;ht++)tr[ht]=yi(ht)?1:0,nr[ht]=yi(ht);var ht;function Wa(e,i){this.input=e,this.filename=i.filename||null,this.schema=i.schema||Mn,this.onWarning=i.onWarning||null,this.legacy=i.legacy||!1,this.json=i.json||!1,this.listener=i.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function ir(e,i){var a={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return a.snippet=Jo(a),new Me(i,a)}function $(e,i){throw ir(e,i)}function nn(e,i){e.onWarning&&e.onWarning.call(null,ir(e,i))}var bi={YAML:function(i,a,c){var d,u,h;i.version!==null&&$(i,"duplication of %YAML directive"),c.length!==1&&$(i,"YAML directive accepts exactly one argument"),d=/^([0-9]+)\.([0-9]+)$/.exec(c[0]),d===null&&$(i,"ill-formed argument of the YAML directive"),u=parseInt(d[1],10),h=parseInt(d[2],10),u!==1&&$(i,"unacceptable YAML version of the document"),i.version=c[0],i.checkLineBreaks=h<2,h!==1&&h!==2&&nn(i,"unsupported YAML version of the document")},TAG:function(i,a,c){var d,u;c.length!==2&&$(i,"TAG directive accepts exactly two arguments"),d=c[0],u=c[1],Zi.test(d)||$(i,"ill-formed tag handle (first argument) of the TAG directive"),it.call(i.tagMap,d)&&$(i,'there is a previously declared suffix for "'+d+'" tag handle'),er.test(u)||$(i,"ill-formed tag prefix (second argument) of the TAG directive");try{u=decodeURIComponent(u)}catch{$(i,"tag prefix is malformed: "+u)}i.tagMap[d]=u}};function nt(e,i,a,c){var d,u,h,g;if(i<a){if(g=e.input.slice(i,a),c)for(d=0,u=g.length;d<u;d+=1)h=g.charCodeAt(d),h===9||32<=h&&h<=1114111||$(e,"expected valid JSON character");else Na.test(g)&&$(e,"the stream contains non-printable characters");e.result+=g}}function xi(e,i,a,c){var d,u,h,g;for(ve.isObject(a)||$(e,"cannot merge mappings; the provided source object is unacceptable"),d=Object.keys(a),h=0,g=d.length;h<g;h+=1)u=d[h],it.call(i,u)||(i[u]=a[u],c[u]=!0)}function Ct(e,i,a,c,d,u,h,g,m){var v,w;if(Array.isArray(d))for(d=Array.prototype.slice.call(d),v=0,w=d.length;v<w;v+=1)Array.isArray(d[v])&&$(e,"nested arrays are not supported inside keys"),typeof d=="object"&&vi(d[v])==="[object Object]"&&(d[v]="[object Object]");if(typeof d=="object"&&vi(d)==="[object Object]"&&(d="[object Object]"),d=String(d),i===null&&(i={}),c==="tag:yaml.org,2002:merge")if(Array.isArray(u))for(v=0,w=u.length;v<w;v+=1)xi(e,i,u[v],a);else xi(e,i,u,a);else!e.json&&!it.call(a,d)&&it.call(i,d)&&(e.line=h||e.line,e.lineStart=g||e.lineStart,e.position=m||e.position,$(e,"duplicated mapping key")),d==="__proto__"?Object.defineProperty(i,d,{configurable:!0,enumerable:!0,writable:!0,value:u}):i[d]=u,delete a[d];return i}function Pn(e){var i;i=e.input.charCodeAt(e.position),i===10?e.position++:i===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):$(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function ge(e,i,a){for(var c=0,d=e.input.charCodeAt(e.position);d!==0;){for(;ft(d);)d===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),d=e.input.charCodeAt(++e.position);if(i&&d===35)do d=e.input.charCodeAt(++e.position);while(d!==10&&d!==13&&d!==0);if(Ue(d))for(Pn(e),d=e.input.charCodeAt(e.position),c++,e.lineIndent=0;d===32;)e.lineIndent++,d=e.input.charCodeAt(++e.position);else break}return a!==-1&&c!==0&&e.lineIndent<a&&nn(e,"deficient indentation"),c}function an(e){var i=e.position,a;return a=e.input.charCodeAt(i),!!((a===45||a===46)&&a===e.input.charCodeAt(i+1)&&a===e.input.charCodeAt(i+2)&&(i+=3,a=e.input.charCodeAt(i),a===0||Le(a)))}function In(e,i){i===1?e.result+=" ":i>1&&(e.result+=ve.repeat(`
`,i-1))}function Xa(e,i,a){var c,d,u,h,g,m,v,w,_=e.kind,E=e.result,A;if(A=e.input.charCodeAt(e.position),Le(A)||Et(A)||A===35||A===38||A===42||A===33||A===124||A===62||A===39||A===34||A===37||A===64||A===96||(A===63||A===45)&&(d=e.input.charCodeAt(e.position+1),Le(d)||a&&Et(d)))return!1;for(e.kind="scalar",e.result="",u=h=e.position,g=!1;A!==0;){if(A===58){if(d=e.input.charCodeAt(e.position+1),Le(d)||a&&Et(d))break}else if(A===35){if(c=e.input.charCodeAt(e.position-1),Le(c))break}else{if(e.position===e.lineStart&&an(e)||a&&Et(A))break;if(Ue(A))if(m=e.line,v=e.lineStart,w=e.lineIndent,ge(e,!1,-1),e.lineIndent>=i){g=!0,A=e.input.charCodeAt(e.position);continue}else{e.position=h,e.line=m,e.lineStart=v,e.lineIndent=w;break}}g&&(nt(e,u,h,!1),In(e,e.line-m),u=h=e.position,g=!1),ft(A)||(h=e.position+1),A=e.input.charCodeAt(++e.position)}return nt(e,u,h,!1),e.result?!0:(e.kind=_,e.result=E,!1)}function Va(e,i){var a,c,d;if(a=e.input.charCodeAt(e.position),a!==39)return!1;for(e.kind="scalar",e.result="",e.position++,c=d=e.position;(a=e.input.charCodeAt(e.position))!==0;)if(a===39)if(nt(e,c,e.position,!0),a=e.input.charCodeAt(++e.position),a===39)c=e.position,e.position++,d=e.position;else return!0;else Ue(a)?(nt(e,c,d,!0),In(e,ge(e,!1,i)),c=d=e.position):e.position===e.lineStart&&an(e)?$(e,"unexpected end of the document within a single quoted scalar"):(e.position++,d=e.position);$(e,"unexpected end of the stream within a single quoted scalar")}function Ga(e,i){var a,c,d,u,h,g;if(g=e.input.charCodeAt(e.position),g!==34)return!1;for(e.kind="scalar",e.result="",e.position++,a=c=e.position;(g=e.input.charCodeAt(e.position))!==0;){if(g===34)return nt(e,a,e.position,!0),e.position++,!0;if(g===92){if(nt(e,a,e.position,!0),g=e.input.charCodeAt(++e.position),Ue(g))ge(e,!1,i);else if(g<256&&tr[g])e.result+=nr[g],e.position++;else if((h=$a(g))>0){for(d=h,u=0;d>0;d--)g=e.input.charCodeAt(++e.position),(h=Ya(g))>=0?u=(u<<4)+h:$(e,"expected hexadecimal character");e.result+=Ua(u),e.position++}else $(e,"unknown escape sequence");a=c=e.position}else Ue(g)?(nt(e,a,c,!0),In(e,ge(e,!1,i)),a=c=e.position):e.position===e.lineStart&&an(e)?$(e,"unexpected end of the document within a double quoted scalar"):(e.position++,c=e.position)}$(e,"unexpected end of the stream within a double quoted scalar")}function Ja(e,i){var a=!0,c,d,u,h=e.tag,g,m=e.anchor,v,w,_,E,A,M=Object.create(null),I,R,F,T;if(T=e.input.charCodeAt(e.position),T===91)w=93,A=!1,g=[];else if(T===123)w=125,A=!0,g={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=g),T=e.input.charCodeAt(++e.position);T!==0;){if(ge(e,!0,i),T=e.input.charCodeAt(e.position),T===w)return e.position++,e.tag=h,e.anchor=m,e.kind=A?"mapping":"sequence",e.result=g,!0;a?T===44&&$(e,"expected the node content, but found ','"):$(e,"missed comma between flow collection entries"),R=I=F=null,_=E=!1,T===63&&(v=e.input.charCodeAt(e.position+1),Le(v)&&(_=E=!0,e.position++,ge(e,!0,i))),c=e.line,d=e.lineStart,u=e.position,At(e,i,en,!1,!0),R=e.tag,I=e.result,ge(e,!0,i),T=e.input.charCodeAt(e.position),(E||e.line===c)&&T===58&&(_=!0,T=e.input.charCodeAt(++e.position),ge(e,!0,i),At(e,i,en,!1,!0),F=e.result),A?Ct(e,g,M,R,I,F,c,d,u):_?g.push(Ct(e,null,M,R,I,F,c,d,u)):g.push(I),ge(e,!0,i),T=e.input.charCodeAt(e.position),T===44?(a=!0,T=e.input.charCodeAt(++e.position)):a=!1}$(e,"unexpected end of the stream within a flow collection")}function Qa(e,i){var a,c,d=Sn,u=!1,h=!1,g=i,m=0,v=!1,w,_;if(_=e.input.charCodeAt(e.position),_===124)c=!1;else if(_===62)c=!0;else return!1;for(e.kind="scalar",e.result="";_!==0;)if(_=e.input.charCodeAt(++e.position),_===43||_===45)Sn===d?d=_===43?mi:ja:$(e,"repeat of a chomping mode identifier");else if((w=Ka(_))>=0)w===0?$(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):h?$(e,"repeat of an indentation width identifier"):(g=i+w-1,h=!0);else break;if(ft(_)){do _=e.input.charCodeAt(++e.position);while(ft(_));if(_===35)do _=e.input.charCodeAt(++e.position);while(!Ue(_)&&_!==0)}for(;_!==0;){for(Pn(e),e.lineIndent=0,_=e.input.charCodeAt(e.position);(!h||e.lineIndent<g)&&_===32;)e.lineIndent++,_=e.input.charCodeAt(++e.position);if(!h&&e.lineIndent>g&&(g=e.lineIndent),Ue(_)){m++;continue}if(e.lineIndent<g){d===mi?e.result+=ve.repeat(`
`,u?1+m:m):d===Sn&&u&&(e.result+=`
`);break}for(c?ft(_)?(v=!0,e.result+=ve.repeat(`
`,u?1+m:m)):v?(v=!1,e.result+=ve.repeat(`
`,m+1)):m===0?u&&(e.result+=" "):e.result+=ve.repeat(`
`,m):e.result+=ve.repeat(`
`,u?1+m:m),u=!0,h=!0,m=0,a=e.position;!Ue(_)&&_!==0;)_=e.input.charCodeAt(++e.position);nt(e,a,e.position,!1)}return!0}function _i(e,i){var a,c=e.tag,d=e.anchor,u=[],h,g=!1,m;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),m=e.input.charCodeAt(e.position);m!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,$(e,"tab characters must not be used in indentation")),!(m!==45||(h=e.input.charCodeAt(e.position+1),!Le(h))));){if(g=!0,e.position++,ge(e,!0,-1)&&e.lineIndent<=i){u.push(null),m=e.input.charCodeAt(e.position);continue}if(a=e.line,At(e,i,Qi,!1,!0),u.push(e.result),ge(e,!0,-1),m=e.input.charCodeAt(e.position),(e.line===a||e.lineIndent>i)&&m!==0)$(e,"bad indentation of a sequence entry");else if(e.lineIndent<i)break}return g?(e.tag=c,e.anchor=d,e.kind="sequence",e.result=u,!0):!1}function Za(e,i,a){var c,d,u,h,g,m,v=e.tag,w=e.anchor,_={},E=Object.create(null),A=null,M=null,I=null,R=!1,F=!1,T;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=_),T=e.input.charCodeAt(e.position);T!==0;){if(!R&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,$(e,"tab characters must not be used in indentation")),c=e.input.charCodeAt(e.position+1),u=e.line,(T===63||T===58)&&Le(c))T===63?(R&&(Ct(e,_,E,A,M,null,h,g,m),A=M=I=null),F=!0,R=!0,d=!0):R?(R=!1,d=!0):$(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,T=c;else{if(h=e.line,g=e.lineStart,m=e.position,!At(e,a,Ji,!1,!0))break;if(e.line===u){for(T=e.input.charCodeAt(e.position);ft(T);)T=e.input.charCodeAt(++e.position);if(T===58)T=e.input.charCodeAt(++e.position),Le(T)||$(e,"a whitespace character is expected after the key-value separator within a block mapping"),R&&(Ct(e,_,E,A,M,null,h,g,m),A=M=I=null),F=!0,R=!1,d=!1,A=e.tag,M=e.result;else if(F)$(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=v,e.anchor=w,!0}else if(F)$(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=v,e.anchor=w,!0}if((e.line===u||e.lineIndent>i)&&(R&&(h=e.line,g=e.lineStart,m=e.position),At(e,i,tn,!0,d)&&(R?M=e.result:I=e.result),R||(Ct(e,_,E,A,M,I,h,g,m),A=M=I=null),ge(e,!0,-1),T=e.input.charCodeAt(e.position)),(e.line===u||e.lineIndent>i)&&T!==0)$(e,"bad indentation of a mapping entry");else if(e.lineIndent<i)break}return R&&Ct(e,_,E,A,M,null,h,g,m),F&&(e.tag=v,e.anchor=w,e.kind="mapping",e.result=_),F}function es(e){var i,a=!1,c=!1,d,u,h;if(h=e.input.charCodeAt(e.position),h!==33)return!1;if(e.tag!==null&&$(e,"duplication of a tag property"),h=e.input.charCodeAt(++e.position),h===60?(a=!0,h=e.input.charCodeAt(++e.position)):h===33?(c=!0,d="!!",h=e.input.charCodeAt(++e.position)):d="!",i=e.position,a){do h=e.input.charCodeAt(++e.position);while(h!==0&&h!==62);e.position<e.length?(u=e.input.slice(i,e.position),h=e.input.charCodeAt(++e.position)):$(e,"unexpected end of the stream within a verbatim tag")}else{for(;h!==0&&!Le(h);)h===33&&(c?$(e,"tag suffix cannot contain exclamation marks"):(d=e.input.slice(i-1,e.position+1),Zi.test(d)||$(e,"named tag handle cannot contain such characters"),c=!0,i=e.position+1)),h=e.input.charCodeAt(++e.position);u=e.input.slice(i,e.position),Ha.test(u)&&$(e,"tag suffix cannot contain flow indicator characters")}u&&!er.test(u)&&$(e,"tag name cannot contain such characters: "+u);try{u=decodeURIComponent(u)}catch{$(e,"tag name is malformed: "+u)}return a?e.tag=u:it.call(e.tagMap,d)?e.tag=e.tagMap[d]+u:d==="!"?e.tag="!"+u:d==="!!"?e.tag="tag:yaml.org,2002:"+u:$(e,'undeclared tag handle "'+d+'"'),!0}function ts(e){var i,a;if(a=e.input.charCodeAt(e.position),a!==38)return!1;for(e.anchor!==null&&$(e,"duplication of an anchor property"),a=e.input.charCodeAt(++e.position),i=e.position;a!==0&&!Le(a)&&!Et(a);)a=e.input.charCodeAt(++e.position);return e.position===i&&$(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(i,e.position),!0}function ns(e){var i,a,c;if(c=e.input.charCodeAt(e.position),c!==42)return!1;for(c=e.input.charCodeAt(++e.position),i=e.position;c!==0&&!Le(c)&&!Et(c);)c=e.input.charCodeAt(++e.position);return e.position===i&&$(e,"name of an alias node must contain at least one character"),a=e.input.slice(i,e.position),it.call(e.anchorMap,a)||$(e,'unidentified alias "'+a+'"'),e.result=e.anchorMap[a],ge(e,!0,-1),!0}function At(e,i,a,c,d){var u,h,g,m=1,v=!1,w=!1,_,E,A,M,I,R;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,u=h=g=tn===a||Qi===a,c&&ge(e,!0,-1)&&(v=!0,e.lineIndent>i?m=1:e.lineIndent===i?m=0:e.lineIndent<i&&(m=-1)),m===1)for(;es(e)||ts(e);)ge(e,!0,-1)?(v=!0,g=u,e.lineIndent>i?m=1:e.lineIndent===i?m=0:e.lineIndent<i&&(m=-1)):g=!1;if(g&&(g=v||d),(m===1||tn===a)&&(en===a||Ji===a?I=i:I=i+1,R=e.position-e.lineStart,m===1?g&&(_i(e,R)||Za(e,R,I))||Ja(e,I)?w=!0:(h&&Qa(e,I)||Va(e,I)||Ga(e,I)?w=!0:ns(e)?(w=!0,(e.tag!==null||e.anchor!==null)&&$(e,"alias node should not have any properties")):Xa(e,I,en===a)&&(w=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m===0&&(w=g&&_i(e,R))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&$(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),_=0,E=e.implicitTypes.length;_<E;_+=1)if(M=e.implicitTypes[_],M.resolve(e.result)){e.result=M.construct(e.result),e.tag=M.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(it.call(e.typeMap[e.kind||"fallback"],e.tag))M=e.typeMap[e.kind||"fallback"][e.tag];else for(M=null,A=e.typeMap.multi[e.kind||"fallback"],_=0,E=A.length;_<E;_+=1)if(e.tag.slice(0,A[_].tag.length)===A[_].tag){M=A[_];break}M||$(e,"unknown tag !<"+e.tag+">"),e.result!==null&&M.kind!==e.kind&&$(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+M.kind+'", not "'+e.kind+'"'),M.resolve(e.result,e.tag)?(e.result=M.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):$(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||w}function is(e){var i=e.position,a,c,d,u=!1,h;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(h=e.input.charCodeAt(e.position))!==0&&(ge(e,!0,-1),h=e.input.charCodeAt(e.position),!(e.lineIndent>0||h!==37));){for(u=!0,h=e.input.charCodeAt(++e.position),a=e.position;h!==0&&!Le(h);)h=e.input.charCodeAt(++e.position);for(c=e.input.slice(a,e.position),d=[],c.length<1&&$(e,"directive name must not be less than one character in length");h!==0;){for(;ft(h);)h=e.input.charCodeAt(++e.position);if(h===35){do h=e.input.charCodeAt(++e.position);while(h!==0&&!Ue(h));break}if(Ue(h))break;for(a=e.position;h!==0&&!Le(h);)h=e.input.charCodeAt(++e.position);d.push(e.input.slice(a,e.position))}h!==0&&Pn(e),it.call(bi,c)?bi[c](e,c,d):nn(e,'unknown document directive "'+c+'"')}if(ge(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,ge(e,!0,-1)):u&&$(e,"directives end mark is expected"),At(e,e.lineIndent-1,tn,!1,!0),ge(e,!0,-1),e.checkLineBreaks&&qa.test(e.input.slice(i,e.position))&&nn(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&an(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,ge(e,!0,-1));return}if(e.position<e.length-1)$(e,"end of the stream or a document separator is expected");else return}function rr(e,i){e=String(e),i=i||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var a=new Wa(e,i),c=e.indexOf("\0");for(c!==-1&&(a.position=c,$(a,"null byte is not allowed in input")),a.input+="\0";a.input.charCodeAt(a.position)===32;)a.lineIndent+=1,a.position+=1;for(;a.position<a.length-1;)is(a);return a.documents}function rs(e,i,a){i!==null&&typeof i=="object"&&typeof a=="undefined"&&(a=i,i=null);var c=rr(e,a);if(typeof i!="function")return c;for(var d=0,u=c.length;d<u;d+=1)i(c[d])}function os(e,i){var a=rr(e,i);if(a.length!==0){if(a.length===1)return a[0];throw new Me("expected a single document in the stream, but found more")}}var as=rs,ss=os,or={loadAll:as,load:ss},ar=Object.prototype.toString,sr=Object.prototype.hasOwnProperty,Ln=65279,ls=9,qt=10,cs=13,ds=32,us=33,ps=34,En=35,hs=37,fs=38,gs=39,ms=42,lr=44,vs=45,rn=58,ys=61,bs=62,xs=63,_s=64,cr=91,dr=93,ws=96,ur=123,Ss=124,pr=125,Ee={};Ee[0]="\\0";Ee[7]="\\a";Ee[8]="\\b";Ee[9]="\\t";Ee[10]="\\n";Ee[11]="\\v";Ee[12]="\\f";Ee[13]="\\r";Ee[27]="\\e";Ee[34]='\\"';Ee[92]="\\\\";Ee[133]="\\N";Ee[160]="\\_";Ee[8232]="\\L";Ee[8233]="\\P";var ks=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Es=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Cs(e,i){var a,c,d,u,h,g,m;if(i===null)return{};for(a={},c=Object.keys(i),d=0,u=c.length;d<u;d+=1)h=c[d],g=String(i[h]),h.slice(0,2)==="!!"&&(h="tag:yaml.org,2002:"+h.slice(2)),m=e.compiledTypeMap.fallback[h],m&&sr.call(m.styleAliases,g)&&(g=m.styleAliases[g]),a[h]=g;return a}function As(e){var i,a,c;if(i=e.toString(16).toUpperCase(),e<=255)a="x",c=2;else if(e<=65535)a="u",c=4;else if(e<=4294967295)a="U",c=8;else throw new Me("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+a+ve.repeat("0",c-i.length)+i}var Ts=1,Ht=2;function Os(e){this.schema=e.schema||Mn,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=ve.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Cs(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Ht:Ts,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function wi(e,i){for(var a=ve.repeat(" ",i),c=0,d=-1,u="",h,g=e.length;c<g;)d=e.indexOf(`
`,c),d===-1?(h=e.slice(c),c=g):(h=e.slice(c,d+1),c=d+1),h.length&&h!==`
`&&(u+=a),u+=h;return u}function Cn(e,i){return`
`+ve.repeat(" ",e.indent*i)}function Ms(e,i){var a,c,d;for(a=0,c=e.implicitTypes.length;a<c;a+=1)if(d=e.implicitTypes[a],d.resolve(i))return!0;return!1}function on(e){return e===ds||e===ls}function Yt(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Ln||65536<=e&&e<=1114111}function Si(e){return Yt(e)&&e!==Ln&&e!==cs&&e!==qt}function ki(e,i,a){var c=Si(e),d=c&&!on(e);return(a?c:c&&e!==lr&&e!==cr&&e!==dr&&e!==ur&&e!==pr)&&e!==En&&!(i===rn&&!d)||Si(i)&&!on(i)&&e===En||i===rn&&d}function Ps(e){return Yt(e)&&e!==Ln&&!on(e)&&e!==vs&&e!==xs&&e!==rn&&e!==lr&&e!==cr&&e!==dr&&e!==ur&&e!==pr&&e!==En&&e!==fs&&e!==ms&&e!==us&&e!==Ss&&e!==ys&&e!==bs&&e!==gs&&e!==ps&&e!==hs&&e!==_s&&e!==ws}function Is(e){return!on(e)&&e!==rn}function jt(e,i){var a=e.charCodeAt(i),c;return a>=55296&&a<=56319&&i+1<e.length&&(c=e.charCodeAt(i+1),c>=56320&&c<=57343)?(a-55296)*1024+c-56320+65536:a}function hr(e){var i=/^\n* /;return i.test(e)}var fr=1,An=2,gr=3,mr=4,kt=5;function Ls(e,i,a,c,d,u,h,g){var m,v=0,w=null,_=!1,E=!1,A=c!==-1,M=-1,I=Ps(jt(e,0))&&Is(jt(e,e.length-1));if(i||h)for(m=0;m<e.length;v>=65536?m+=2:m++){if(v=jt(e,m),!Yt(v))return kt;I=I&&ki(v,w,g),w=v}else{for(m=0;m<e.length;v>=65536?m+=2:m++){if(v=jt(e,m),v===qt)_=!0,A&&(E=E||m-M-1>c&&e[M+1]!==" ",M=m);else if(!Yt(v))return kt;I=I&&ki(v,w,g),w=v}E=E||A&&m-M-1>c&&e[M+1]!==" "}return!_&&!E?I&&!h&&!d(e)?fr:u===Ht?kt:An:a>9&&hr(e)?kt:h?u===Ht?kt:An:E?mr:gr}function Fs(e,i,a,c,d){e.dump=(function(){if(i.length===0)return e.quotingType===Ht?'""':"''";if(!e.noCompatMode&&(ks.indexOf(i)!==-1||Es.test(i)))return e.quotingType===Ht?'"'+i+'"':"'"+i+"'";var u=e.indent*Math.max(1,a),h=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-u),g=c||e.flowLevel>-1&&a>=e.flowLevel;function m(v){return Ms(e,v)}switch(Ls(i,g,e.indent,h,m,e.quotingType,e.forceQuotes&&!c,d)){case fr:return i;case An:return"'"+i.replace(/'/g,"''")+"'";case gr:return"|"+Ei(i,e.indent)+Ci(wi(i,u));case mr:return">"+Ei(i,e.indent)+Ci(wi(zs(i,h),u));case kt:return'"'+Ds(i)+'"';default:throw new Me("impossible error: invalid scalar style")}})()}function Ei(e,i){var a=hr(e)?String(i):"",c=e[e.length-1]===`
`,d=c&&(e[e.length-2]===`
`||e===`
`),u=d?"+":c?"":"-";return a+u+`
`}function Ci(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function zs(e,i){for(var a=/(\n+)([^\n]*)/g,c=(function(){var v=e.indexOf(`
`);return v=v!==-1?v:e.length,a.lastIndex=v,Ai(e.slice(0,v),i)})(),d=e[0]===`
`||e[0]===" ",u,h;h=a.exec(e);){var g=h[1],m=h[2];u=m[0]===" ",c+=g+(!d&&!u&&m!==""?`
`:"")+Ai(m,i),d=u}return c}function Ai(e,i){if(e===""||e[0]===" ")return e;for(var a=/ [^ ]/g,c,d=0,u,h=0,g=0,m="";c=a.exec(e);)g=c.index,g-d>i&&(u=h>d?h:g,m+=`
`+e.slice(d,u),d=u+1),h=g;return m+=`
`,e.length-d>i&&h>d?m+=e.slice(d,h)+`
`+e.slice(h+1):m+=e.slice(d),m.slice(1)}function Ds(e){for(var i="",a=0,c,d=0;d<e.length;a>=65536?d+=2:d++)a=jt(e,d),c=Ee[a],!c&&Yt(a)?(i+=e[d],a>=65536&&(i+=e[d+1])):i+=c||As(a);return i}function Rs(e,i,a){var c="",d=e.tag,u,h,g;for(u=0,h=a.length;u<h;u+=1)g=a[u],e.replacer&&(g=e.replacer.call(a,String(u),g)),(Je(e,i,g,!1,!1)||typeof g=="undefined"&&Je(e,i,null,!1,!1))&&(c!==""&&(c+=","+(e.condenseFlow?"":" ")),c+=e.dump);e.tag=d,e.dump="["+c+"]"}function Ti(e,i,a,c){var d="",u=e.tag,h,g,m;for(h=0,g=a.length;h<g;h+=1)m=a[h],e.replacer&&(m=e.replacer.call(a,String(h),m)),(Je(e,i+1,m,!0,!0,!1,!0)||typeof m=="undefined"&&Je(e,i+1,null,!0,!0,!1,!0))&&((!c||d!=="")&&(d+=Cn(e,i)),e.dump&&qt===e.dump.charCodeAt(0)?d+="-":d+="- ",d+=e.dump);e.tag=u,e.dump=d||"[]"}function Bs(e,i,a){var c="",d=e.tag,u=Object.keys(a),h,g,m,v,w;for(h=0,g=u.length;h<g;h+=1)w="",c!==""&&(w+=", "),e.condenseFlow&&(w+='"'),m=u[h],v=a[m],e.replacer&&(v=e.replacer.call(a,m,v)),Je(e,i,m,!1,!1)&&(e.dump.length>1024&&(w+="? "),w+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Je(e,i,v,!1,!1)&&(w+=e.dump,c+=w));e.tag=d,e.dump="{"+c+"}"}function js(e,i,a,c){var d="",u=e.tag,h=Object.keys(a),g,m,v,w,_,E;if(e.sortKeys===!0)h.sort();else if(typeof e.sortKeys=="function")h.sort(e.sortKeys);else if(e.sortKeys)throw new Me("sortKeys must be a boolean or a function");for(g=0,m=h.length;g<m;g+=1)E="",(!c||d!=="")&&(E+=Cn(e,i)),v=h[g],w=a[v],e.replacer&&(w=e.replacer.call(a,v,w)),Je(e,i+1,v,!0,!0,!0)&&(_=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,_&&(e.dump&&qt===e.dump.charCodeAt(0)?E+="?":E+="? "),E+=e.dump,_&&(E+=Cn(e,i)),Je(e,i+1,w,!0,_)&&(e.dump&&qt===e.dump.charCodeAt(0)?E+=":":E+=": ",E+=e.dump,d+=E));e.tag=u,e.dump=d||"{}"}function Oi(e,i,a){var c,d,u,h,g,m;for(d=a?e.explicitTypes:e.implicitTypes,u=0,h=d.length;u<h;u+=1)if(g=d[u],(g.instanceOf||g.predicate)&&(!g.instanceOf||typeof i=="object"&&i instanceof g.instanceOf)&&(!g.predicate||g.predicate(i))){if(a?g.multi&&g.representName?e.tag=g.representName(i):e.tag=g.tag:e.tag="?",g.represent){if(m=e.styleMap[g.tag]||g.defaultStyle,ar.call(g.represent)==="[object Function]")c=g.represent(i,m);else if(sr.call(g.represent,m))c=g.represent[m](i,m);else throw new Me("!<"+g.tag+'> tag resolver accepts not "'+m+'" style');e.dump=c}return!0}return!1}function Je(e,i,a,c,d,u,h){e.tag=null,e.dump=a,Oi(e,a,!1)||Oi(e,a,!0);var g=ar.call(e.dump),m=c,v;c&&(c=e.flowLevel<0||e.flowLevel>i);var w=g==="[object Object]"||g==="[object Array]",_,E;if(w&&(_=e.duplicates.indexOf(a),E=_!==-1),(e.tag!==null&&e.tag!=="?"||E||e.indent!==2&&i>0)&&(d=!1),E&&e.usedDuplicates[_])e.dump="*ref_"+_;else{if(w&&E&&!e.usedDuplicates[_]&&(e.usedDuplicates[_]=!0),g==="[object Object]")c&&Object.keys(e.dump).length!==0?(js(e,i,e.dump,d),E&&(e.dump="&ref_"+_+e.dump)):(Bs(e,i,e.dump),E&&(e.dump="&ref_"+_+" "+e.dump));else if(g==="[object Array]")c&&e.dump.length!==0?(e.noArrayIndent&&!h&&i>0?Ti(e,i-1,e.dump,d):Ti(e,i,e.dump,d),E&&(e.dump="&ref_"+_+e.dump)):(Rs(e,i,e.dump),E&&(e.dump="&ref_"+_+" "+e.dump));else if(g==="[object String]")e.tag!=="?"&&Fs(e,e.dump,i,u,m);else{if(g==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new Me("unacceptable kind of an object to dump "+g)}e.tag!==null&&e.tag!=="?"&&(v=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?v="!"+v:v.slice(0,18)==="tag:yaml.org,2002:"?v="!!"+v.slice(18):v="!<"+v+">",e.dump=v+" "+e.dump)}return!0}function Ns(e,i){var a=[],c=[],d,u;for(Tn(e,a,c),d=0,u=c.length;d<u;d+=1)i.duplicates.push(a[c[d]]);i.usedDuplicates=new Array(u)}function Tn(e,i,a){var c,d,u;if(e!==null&&typeof e=="object")if(d=i.indexOf(e),d!==-1)a.indexOf(d)===-1&&a.push(d);else if(i.push(e),Array.isArray(e))for(d=0,u=e.length;d<u;d+=1)Tn(e[d],i,a);else for(c=Object.keys(e),d=0,u=c.length;d<u;d+=1)Tn(e[c[d]],i,a)}function qs(e,i){i=i||{};var a=new Os(i);a.noRefs||Ns(e,a);var c=e;return a.replacer&&(c=a.replacer.call({"":c},"",c)),Je(a,0,c,!0,!0)?a.dump+`
`:""}var Hs=qs,Ys={dump:Hs};function Fn(e,i){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+i+" instead, which is now safe by default.")}}var $s=we,Ks=Ii,Us=Di,Ws=qi,Xs=Hi,Vs=Mn,Gs=or.load,Js=or.loadAll,Qs=Ys.dump,Zs=Me,el={binary:Wi,float:Ni,map:zi,null:Ri,pairs:Vi,set:Gi,timestamp:Ki,bool:Bi,int:ji,merge:Ui,omap:Xi,seq:Fi,str:Li},tl=Fn("safeLoad","load"),nl=Fn("safeLoadAll","loadAll"),il=Fn("safeDump","dump"),rl={Type:$s,Schema:Ks,FAILSAFE_SCHEMA:Us,JSON_SCHEMA:Ws,CORE_SCHEMA:Xs,DEFAULT_SCHEMA:Vs,load:Gs,loadAll:Js,dump:Qs,YAMLException:Zs,types:el,safeLoad:tl,safeLoadAll:nl,safeDump:il},vr=rl;window.interact||(window.interact=br.default);window.jsyaml||(window.jsyaml=vr);var ol="0.1.48";console.info(`%c drag-and-drop-card %c v${ol} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var al=(e,...i)=>console.debug(`[drag-and-drop-card] ${e}`,...i);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var yr=()=>new Promise(e=>requestAnimationFrame(()=>e())),sl=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),zn=class e extends HTMLElement{static getConfigElement(){let i=document.createElement("div");i.innerHTML=`
      <style>
        .cfg-row{display:flex;gap:12px;align-items:center;margin:8px 0;flex-wrap:wrap}
        input[type="text"],input[type="number"],select{
          padding:6px;border-radius:8px;border:1px solid var(--divider-color);
          background:var(--primary-background-color);color:var(--primary-text-color)
        }
        label{font-weight:600;min-width:130px}
        .inline{display:inline-flex;gap:8px;align-items:center}
        .hint{opacity:.65;font-size:.85rem}
      </style>
  
      <div class="cfg-row">
        <label>Storage key</label>
        <input type="text" id="storage_key" placeholder="e.g. livingroom_layout">
      </div>
  
      <div class="cfg-row">
        <label>Grid (px)</label>
        <input type="number" id="grid" min="5" step="1" value="10">
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="liveSnap"> Snap while dragging (live)</label>
      </div>
  
      <div class="cfg-row">
        <label>Auto-save</label>
        <input type="checkbox" id="autoSave" checked>
        <span style="margin-left:auto">Debounce (ms)</span>
        <input type="number" id="autoSaveDebounce" min="0" step="50" value="800" style="width:90px">
      </div>
  
      <div class="cfg-row">
        <label>Container Baxckground</label>
        <input type="text" id="containerBg"
          placeholder="transparent or css e.g. linear-gradient(...)"
          title="Try: transparent, #232f3e, linear-gradient(to right, #1a2a6c, #b21f1f, #fdbb2d), radial-gradient(circle, #4e54c8, #8f94fb)" />
      </div>
  
      <div class="cfg-row">
        <label>Card Background</label>
        <input type="text" id="cardBg"
          placeholder="var(--ha-card-background) or css e.g. #ffffffcc"
          title="Try: transparent, #151515aa, linear-gradient(135deg, #667eea 0%, #764ba2 100%)" />
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="debug"> Debug logs</label>
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="noOverlap">
          Disable overlapping <small style="opacity:.6">(Experimental)</small>
        </label>
      </div>
  
      <!-- NEW: container sizing -->
      <div class="cfg-row">
        <label>Container size</label>
        <select id="sizeMode">
          <option value="dynamic">Dynamic (auto)</option>
          <option value="fixed_custom">User preference (px)</option>
          <option value="preset">Preset</option>
        </select>
  
        <span id="sizeCustom" class="inline" style="display:none">
          W <input type="number" id="sizeW" min="100" step="10" style="width:110px">
          H <input type="number" id="sizeH" min="100" step="10" style="width:110px">
        </span>
  
        <span id="sizePresetWrap" class="inline" style="display:none">
          <select id="sizePreset" style="min-width:240px"></select>
          <select id="sizeOrientation">
            <option value="auto">Auto</option>
            <option value="portrait">Portrait</option>
            <option value="landscape">Landscape</option>
          </select>
        </span>
        <span class="hint">In fixed mode, cards cannot leave the box.</span>
      </div>
    `;let a=e._sizePresets(),c=i.querySelector("#sizePreset"),d=(m,v)=>{let w=document.createElement("optgroup");w.label=m,v.forEach(_=>{let E=document.createElement("option");E.value=_.key,E.textContent=`${_.label} (${_.w}\xD7${_.h})`,c.appendChild(E)}),c.appendChild(w)};[["Phones",a.filter(m=>m.group==="phone")],["Tablets",a.filter(m=>m.group==="tablet")],["Desktop",a.filter(m=>m.group==="desktop")]].forEach(([m,v])=>{if(!v.length)return;let w=document.createElement("optgroup");w.label=m,v.forEach(_=>{let E=document.createElement("option");E.value=_.key,E.textContent=`${_.label} (${_.w}\xD7${_.h})`,w.appendChild(E)}),c.appendChild(w)});let u=()=>{let m=i.querySelector("#sizeMode").value;i.querySelector("#sizeCustom").style.display=m==="fixed_custom"?"inline-flex":"none",i.querySelector("#sizePresetWrap").style.display=m==="preset"?"inline-flex":"none"};i.setConfig=(m={})=>{var v,w,_,E,A,M;i._config={type:m.type||"custom:drag-and-drop-card",...m},i.querySelector("#storage_key").value=m.storage_key||"",i.querySelector("#grid").value=(v=m.grid)!=null?v:10,i.querySelector("#liveSnap").checked=!!m.drag_live_snap,i.querySelector("#autoSave").checked=m.auto_save!==!1,i.querySelector("#autoSaveDebounce").value=(w=m.auto_save_debounce)!=null?w:800,i.querySelector("#containerBg").value=(_=m.container_background)!=null?_:"transparent",i.querySelector("#cardBg").value=(E=m.card_background)!=null?E:"var(--ha-card-background, var(--card-background-color))",i.querySelector("#debug").checked=!!m.debug,i.querySelector("#noOverlap").checked=!!m.disable_overlap,i.querySelector("#sizeMode").value=m.container_size_mode||"dynamic",i.querySelector("#sizeW").value=(A=m.container_fixed_width)!=null?A:"",i.querySelector("#sizeH").value=(M=m.container_fixed_height)!=null?M:"",i.querySelector("#sizePreset").value=m.container_preset||"fullhd",i.querySelector("#sizeOrientation").value=m.container_preset_orientation||"auto",u()},i.getConfig=()=>{let m={...i._config||{type:"custom:drag-and-drop-card"}};return m.type=m.type||"custom:drag-and-drop-card",m.storage_key=i.querySelector("#storage_key").value||void 0,m.grid=Number(i.querySelector("#grid").value||10),m.drag_live_snap=!!i.querySelector("#liveSnap").checked,m.auto_save=!!i.querySelector("#autoSave").checked,m.auto_save_debounce=Number(i.querySelector("#autoSaveDebounce").value||800),m.container_background=i.querySelector("#containerBg").value||"transparent",m.card_background=i.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",m.debug=!!i.querySelector("#debug").checked,m.disable_overlap=!!i.querySelector("#noOverlap").checked,m.container_size_mode=i.querySelector("#sizeMode").value,m.container_fixed_width=Number(i.querySelector("#sizeW").value||0)||void 0,m.container_fixed_height=Number(i.querySelector("#sizeH").value||0)||void 0,m.container_preset=i.querySelector("#sizePreset").value||void 0,m.container_preset_orientation=i.querySelector("#sizeOrientation").value||"auto",m};let h=()=>{i.dispatchEvent(new CustomEvent("config-changed",{detail:{config:i.getConfig()}}))},g=(m,v="input")=>{var w;return(w=i.querySelector(m))==null?void 0:w.addEventListener(v,()=>{m==="#sizeMode"&&u(),h()})};return g("#storage_key"),g("#grid"),g("#liveSnap","change"),g("#autoSave","change"),g("#autoSaveDebounce"),g("#containerBg"),g("#cardBg"),g("#debug","change"),g("#noOverlap","change"),g("#sizeMode","change"),g("#sizeW"),g("#sizeH"),g("#sizePreset","change"),g("#sizeOrientation","change"),i}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let i=Math.max(100,Number(this.containerFixedWidth||0)),a=Math.max(100,Number(this.containerFixedHeight||0));return{w:i,h:a}}if(this.containerSizeMode==="preset"){let i=e._sizePresets().find(d=>d.key===this.containerPreset)||e._sizePresets().find(d=>d.key==="fhd");if(!i)return{w:1920,h:1080};let a=i.w,c=i.h;return this.containerPresetOrient==="portrait"&&a>c&&([a,c]=[c,a]),this.containerPresetOrient==="landscape"&&c>a&&([a,c]=[c,a]),{w:a,h:c}}return null}_applyContainerSizingFromConfig(i=!1){var c,d;let a=this.cardContainer;if(a)if(this._isContainerFixed()){let{w:u,h}=this._resolveFixedSize();a.style.width=`${u}px`,a.style.height=`${h}px`,a.style.overflow="hidden",i||(c=this._dbgPush)==null||c.call(this,"size","Applied fixed size",{w:u,h,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else a.style.overflow="hidden",i||(d=this._dbgPush)==null||d.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let i=this.cardContainer;if(!i)return{w:0,h:0};let a=parseFloat(getComputedStyle(i).width)||i.getBoundingClientRect().width,c=parseFloat(getComputedStyle(i).height)||i.getBoundingClientRect().height;return{w:a,h:c}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:i,h:a}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(d=>{let u=parseFloat(d.getAttribute("data-x"))||0,h=parseFloat(d.getAttribute("data-y"))||0,g=parseFloat(d.style.width)||d.getBoundingClientRect().width,m=parseFloat(d.style.height)||d.getBoundingClientRect().height,v=Math.max(0,Math.min(u,Math.max(0,i-g))),w=Math.max(0,Math.min(h,Math.max(0,a-m))),_=Math.min(g,i),E=Math.min(m,a);(_!==g||E!==m)&&(d.style.width=`${_}px`,d.style.height=`${E}px`);let A=Math.max(0,Math.min(v,Math.max(0,i-_))),M=Math.max(0,Math.min(w,Math.max(0,a-E)));this._setCardPosition(d,A,M)})}_applyGridVars(){var a;let i=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",i),(a=this.cardContainer)==null||a.style.setProperty("--ddc-grid-size",i)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(i,a,c=null){let d={t:new Date().toISOString(),kind:i,msg:a,extra:c};this._dbgBuffer.push(d),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${i}]%c ${a}`,"color:#03a9f4","color:unset",c!=null?c:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(i){return String(i).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}setConfig(i={}){var c,d,u,h,g,m;if(!i.storage_key){let v=`layout_${Date.now().toString(36)}`;i.storage_key=v,this._config={...i}}this._config=i,this.storageKey=i.storage_key||void 0;let a=this.storageKey;if(this._config=i,this.storageKey=i.storage_key||void 0,this.gridSize=Number((c=i.grid)!=null?c:10),this.dragLiveSnap=!!i.drag_live_snap,this.autoSave=i.auto_save!==!1,this.autoSaveDebounce=Number((d=i.auto_save_debounce)!=null?d:800),this.containerBackground=(u=i.container_background)!=null?u:"transparent",this.cardBackground=(h=i.card_background)!=null?h:"var(--ha-card-background, var(--card-background-color))",this.debug=!!i.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!i.disable_overlap,this.containerSizeMode=i.container_size_mode||"dynamic",this.containerFixedWidth=Number((g=i.container_fixed_width)!=null?g:0)||null,this.containerFixedHeight=Number((m=i.container_fixed_height)!=null?m:0)||null,this.containerPreset=i.container_preset||"fullhd",this.containerPresetOrient=i.container_preset_orientation||"auto",this.cardContainer&&this._applyContainerSizingFromConfig(!1),this._applyGridVars(),this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:i.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let v=document.createElement("script");v.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(v)}if(!window.interact){let v=document.createElement("script");v.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",v.onload=()=>this._initInteract(),document.head.appendChild(v)}this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),this._built||(this._built=!0,this.innerHTML=`
        <style>
          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            padding: 10px;
            border: 1px solid var(--divider-color);
            background: var(--ddc-bg, transparent);
            width: auto; height: auto; border-radius: 12px; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }
          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:0;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab;
            /* ensure buttons and resize handles remain visible on very small cards */
            overflow:visible;
            border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:1;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
        .chip{
            position:absolute;
            top:8px;
            right:8px;
            display:flex;
            gap:6px;
            flex-wrap:wrap;             /* allow chip buttons to wrap when space is limited */
            opacity:0;
            transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .chip .mini{
            display:inline-flex;align-items:center;gap:6px;
            background:rgba(28,28,30,.78);color:#fff;border:1px solid rgba(255,255,255,.18);
            border-radius:999px;padding:6px 10px;font-size:.76rem;cursor:pointer;letter-spacing:.2px;
            box-shadow:0 2px 6px rgba(0,0,0,.25); transition:transform .08s, background .12s, box-shadow .12s
          }
          .chip .mini:hover{transform:translateY(-1px); background:rgba(28,28,30,.95); box-shadow:0 3px 10px rgba(0,0,0,.35)}
          .chip .mini ha-icon{--mdc-icon-size:18px;width:18px;height:18px}
          .chip .mini.danger{background:rgba(220, 38, 38, .9);border-color:rgba(255,255,255,.22)}
          .chip .mini.danger:hover{background:rgba(220, 38, 38, 1)}
          .chip .mini.pill{padding:6px}

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:none;
            position:absolute;
            /* Position the handle outside the card so it\u2019s always visible and clickable,
               even when the card is tiny or collapsed. */
            bottom:-14px;
            right:-14px;
            width:30px;
            height:30px;
            border-radius:50%;
            background:var(--primary-color);
            color:#fff;
            border:1px solid rgba(255,255,255,.25);
            cursor:se-resize;
            z-index:50; /* keep it above other card elements */
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            align-items:center;
            justify-content:center;
            transition:transform .1s, box-shadow .1s, background .12s;
          }
          .resize-handle:hover{transform:scale(1.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{--mdc-icon-size:18px;width:18px;height:18px;pointer-events:none}

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96vw);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{border-right:1px solid var(--divider-color);overflow:auto;background:var(--primary-background-color);contain:content}
          #rightPane{overflow:hidden;background:var(--primary-background-color)}
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);overflow:visible;position:relative;contain:content}
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}

          /* --- FIX: YAML editor should scroll and not overflow --- */
          #yamlSec { min-height: 0; }
          #yamlSec .bd { 
            overflow: auto;        /* allow scrolling inside the YAML section */
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec { min-height: 0; }
          #optionsSec .bd {
            overflow: auto;        /* scroll inside the Visual editor section */
            /* allow the visual editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          #editorHost { display:block; min-height: 0; }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: fixed and scroll inside */
          ha-code-editor { 
            display: block; 
            height: 260px !important; 
          }
          .CodeMirror { 
            height: 260px !important; 
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            max-height: 260px; 
            overflow: auto; 
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            display:flex;align-items:center;justify-content:center;width:100%;height:100%;
            background:repeating-conic-gradient(from 45deg, rgba(0,0,0,.05) 0% 25%, transparent 0% 50%) 50% / 14px 14px;pointer-events: none;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }
        </style>
        <div class="ddc-root">
          <div class="toolbar">
            <button class="btn" id="addCardBtn" style="display:none">
              <ha-icon icon="mdi:plus"></ha-icon>
              <span style="margin-left:6px">Add Card</span>
            </button>
            <button class="btn secondary" id="reloadBtn" style="display:none">
              <ha-icon icon="mdi:refresh"></ha-icon>
              <span style="margin-left:6px">Reload</span>
            </button>
            <button class="btn secondary" id="diagBtn" style="display:none">
              <ha-icon icon="mdi:play-circle-outline"></ha-icon>
              <span style="margin-left:6px">Diagnostics</span>
            </button>
            <button class="btn secondary" id="exportBtn" style="display:none">
              <ha-icon icon="mdi:download"></ha-icon>
              <span style="margin-left:6px">Export Design</span>
            </button>
            <button class="btn secondary" id="importBtn" style="display:none">
              <ha-icon icon="mdi:upload"></ha-icon>
              <span style="margin-left:6px">Import Design</span>
            </button>
            <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
              <ha-icon icon="mdi:storefront-outline"></ha-icon>
              <span>Open HADS</span>
            </button>
            <button class="btn warning" id="exitEditBtn" style="display:none">
              <ha-icon icon="mdi:exit-run"></ha-icon>
              <span>Exit edit mode</span>
            </button>
            <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
          </div>
          <div class="card-container" id="cardContainer"></div>
        </div>
      `,this.cardContainer=this.querySelector("#cardContainer"),this.addButton=this.querySelector("#addCardBtn"),this.reloadBtn=this.querySelector("#reloadBtn"),this.diagBtn=this.querySelector("#diagBtn"),this.exitEditBtn=this.querySelector("#exitEditBtn"),this.storeBadge=this.querySelector("#storeBadge"),this.exportBtn=this.querySelector("#exportBtn"),this.importBtn=this.querySelector("#importBtn"),this.exploreBtn=this.querySelector("#exploreBtn"),this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.exploreBtn.addEventListener("click",()=>window.open("https://cardstore.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),this._installLongPressToEnterEdit(),window.addEventListener("keydown",v=>{v.key==="Escape"&&this.editMode&&this._toggleEditMode(!1)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",v=>{this.editMode&&(v.target.closest(".card-wrapper")||!v.shiftKey&&!v.ctrlKey&&!v.metaKey&&this._clearSelection())}));try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),!this.__booted||a!==this.storageKey?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),this._resizeContainer())}connectedCallback(){this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1)}disconnectedCallback(){if(window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis),this.__lpInstalled&&this.__lpHandlers){let i=this.cardContainer;i==null||i.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),i==null||i.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}}set hass(i){var c;this._hass=i,al("set hass"),!this.__probed&&i&&(this.__probed=!0,this._probeBackend().then(()=>this._initialLoad(!0)));let a=((c=this.cardContainer)==null?void 0:c.children)||[];for(let d of a){let u=d.firstElementChild;u&&u.hass!==i&&(u.hass=i)}}get hass(){return this._hass}async _initialLoad(i=!1){var g,m,v,w,_,E,A,M,I,R,F;i&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:i});let a=null;if(this._backendOK&&this.storageKey&&(a=await this._loadLayoutFromBackend(this.storageKey)),!a&&this.storageKey){let T=null;try{T=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(T&&this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(T).length}),T&&this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,T),this._dbgPush("boot","Migrated local -> backend"),a=T}catch(W){this._dbgPush("boot","Migration failed, staying local",{error:String(W)}),a=T}else T&&(a=T)}!a&&((m=(g=this._config)==null?void 0:g.cards)!=null&&m.length)&&(this._dbgPush("boot","Using embedded config"),a={cards:this._config.cards});let c={...this._config||{}};a!=null&&a.options?this._applyImportedOptions(a.options,!0):typeof(a==null?void 0:a.grid)=="number"&&this._applyImportedOptions({grid:a.grid},!0);let d=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation"],u={};for(let T of d)c[T]!==void 0&&(u[T]=c[T]);Object.keys(u).length&&this._applyImportedOptions(u,!0);let h=!1;if((v=a==null?void 0:a.cards)!=null&&v.length){for(let T of a.cards){if(!(T!=null&&T.card)||typeof T.card=="object"&&Object.keys(T.card).length===0){let k=this._makePlaceholderAt(((w=T.position)==null?void 0:w.x)||0,((_=T.position)==null?void 0:_.y)||0,((E=T.size)==null?void 0:E.width)||100,((A=T.size)==null?void 0:A.height)||100);this.cardContainer.appendChild(k),h=!0;continue}let W=await this._createCard(T.card),z=this._makeWrapper(W);this.editMode&&z.classList.add("editing"),this._setCardPosition(z,((M=T.position)==null?void 0:M.x)||0,((I=T.position)==null?void 0:I.y)||0),z.style.width=`${((R=T.size)==null?void 0:R.width)||14*this.gridSize}px`,z.style.height=`${((F=T.size)==null?void 0:F.height)||10*this.gridSize}px`,T.z!=null&&(z.style.zIndex=String(T.z)),this.cardContainer.appendChild(z),this._initCardInteract(z),h=!0}this._resizeContainer(),this._dbgPush("boot","Layout applied",{count:a.cards.length})}h||(this._showEmptyPlaceholder(),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI()}_toggleEditMode(i=null){var u,h,g,m;try{(u=this.__clearPressTimer)==null||u.call(this)}catch{}let a=i===null?!this.editMode:!!i,c=!this.editMode&&a;if(this.editMode=a,this.editMode=a,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(v=>{v.classList.toggle("editing",this.editMode);let w=v.querySelector(".resize-handle");w&&(w.style.display=this.editMode?"flex":"none"),!v.dataset.placeholder&&window.interact&&window.interact(v).draggable(this.editMode).resizable(this.editMode),v.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(h=this.cardContainer)==null||h.querySelectorAll(".card-wrapper.dragging").forEach(v=>v.classList.remove("dragging")),c){let v=(g=this.__lastHoldX)!=null?g:null,w=(m=this.__lastHoldY)!=null?m:null;this._playEditRipple(v,w)}}_isInHaEditorPreview(){let i=this;for(;i;){let a=i.nodeType===1&&i.localName?i.localName.toLowerCase():"";if(a==="hui-card-editor"||a==="hui-dialog-edit-card"||a==="hui-card-preview"||a==="ha-dialog"||a==="mwc-dialog")return!0;let c=i.getRootNode&&i.getRootNode();i=i.parentElement||c&&c.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let i=this.cardContainer;if(!i)return;let a=800,c=18,d=z=>!!z&&typeof z=="object"&&z.nodeType===1,u=(z,k)=>{try{return!!(z&&k&&typeof z.contains=="function"&&d(k)&&z.contains(k))}catch{return!1}},h=z=>u(this.cardContainer,z),g=z=>{var ie,V,Se;let k=(V=(ie=z.target)==null?void 0:ie.closest)==null?void 0:V.call(ie,".card-wrapper");if(d(k)&&h(k)&&!k.classList.contains("ddc-placeholder"))return!0;let ee=typeof z.composedPath=="function"?z.composedPath():[];for(let re of ee)if(d(re)&&h(re)&&(Se=re.classList)!=null&&Se.contains("card-wrapper")&&!re.classList.contains("ddc-placeholder"))return!0;return!1},m=(z,k)=>{let ee=document.createElement("div");ee.className="ddc-press-ring",document.body.appendChild(ee),Object.assign(ee.style,{position:"fixed",left:`${z}px`,top:`${k}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),ee.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let ie=ee.querySelector(".pr-fg"),V=18,Se=2*Math.PI*V;return ie.style.strokeDasharray=`${Se}`,ie.style.strokeDashoffset=`${Se}`,requestAnimationFrame(()=>{ie.style.transition=`stroke-dashoffset ${a}ms linear`,ie.style.strokeDashoffset="0"}),{el:ee,move(re,be){ee.style.left=`${re}px`,ee.style.top=`${be}px`},remove(){try{ee.remove()}catch{}}}},v=null,w=null,_=0,E=0,A=null,M=()=>{v&&clearTimeout(v),v=null,w==null||w.remove(),w=null};this.__clearPressTimer=M;let I=z=>{z.pointerType==="mouse"&&z.button!==0||this._isInHaEditorPreview()||!h(z.target)||g(z)||(A=z.pointerId,_=z.clientX,E=z.clientY,this.__lastHoldX=_,this.__lastHoldY=E,w=m(_,E),v=setTimeout(()=>{var ee;M();let k=!this.editMode;this._toggleEditMode(k),(ee=this._toast)==null||ee.call(this,`Edit mode ${k?"enabled":"disabled"}`)},a))},R=z=>{v==null||z.pointerId!==A||(w==null||w.move(z.clientX,z.clientY),(Math.abs(z.clientX-_)>c||Math.abs(z.clientY-E)>c)&&M())},F=z=>{z.pointerId===A&&(M(),A=null)},T=z=>{if(v)return z.preventDefault(),z.stopPropagation(),!1},W=z=>{var ee;if(this._isInHaEditorPreview()||!h(z.target)||g(z))return;let k=!this.editMode;this._toggleEditMode(k),(ee=this._toast)==null||ee.call(this,`Edit mode ${k?"enabled":"disabled"}`)};i.addEventListener("pointerdown",I),window.addEventListener("pointermove",R,{passive:!0}),window.addEventListener("pointerup",F,{passive:!0}),window.addEventListener("pointercancel",F,{passive:!0}),window.addEventListener("contextmenu",T),i.addEventListener("dblclick",W),this.__lpHandlers={onPointerDown:I,onPointerMove:R,onPointerUpOrCancel:F,onContextMenu:T,onDblClick:W}}_isLayoutEmpty(){let i=this.cardContainer;return i?i.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let i=this._isLayoutEmpty();if(this.addButton){let c=this.editMode||i;this.addButton.style.display=c?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&i)}let a=c=>c&&(c.style.display=this.editMode?"inline-block":"none");a(this.reloadBtn),a(this.diagBtn),a(this.exitEditBtn),a(this.exportBtn),a(this.importBtn),a(this.exploreBtn),a(this.storeBadge)}_playEditRipple(i=null,a=null){let c=this.cardContainer;if(!c)return;let d=c.getBoundingClientRect(),u=i==null?d.left+d.width/2:i,h=a==null?d.top+d.height/2:a,g=u-d.left,m=h-d.top,v=document.createElement("div");v.className="ddc-ripple-veil",v.style.setProperty("--rip-x",`${g}px`),v.style.setProperty("--rip-y",`${m}px`),c.appendChild(v),setTimeout(()=>v.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>this._initCardInteract(a))}_initCardInteract(i){if(!window.interact||i.dataset.placeholder)return;let a=this.gridSize,c=!!this.dragLiveSnap,u=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let h=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});u.push(window.interact.modifiers.snap({targets:[h],range:1/0,offset:"startCoords"}))}window.interact(i).draggable({enabled:this.editMode,inertia:!1,modifiers:u,listeners:{start:h=>{this._selection.has(i)||(!(h!=null&&h.shiftKey)&&!(h!=null&&h.ctrlKey)&&!(h!=null&&h.metaKey)&&this._clearSelection(),this._toggleSelection(i,!0));let g=Array.from(this._selection);this.__groupDrag={leader:i,members:g,startRaw:new Map(g.map(v=>[v,{x:parseFloat(v.getAttribute("data-x-raw"))||parseFloat(v.getAttribute("data-x"))||0,y:parseFloat(v.getAttribute("data-y-raw"))||parseFloat(v.getAttribute("data-y"))||0,w:parseFloat(v.style.width)||v.getBoundingClientRect().width,h:parseFloat(v.style.height)||v.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(v=>{let w=parseFloat(v.getAttribute("data-x-raw"))||parseFloat(v.getAttribute("data-x"))||0,_=parseFloat(v.getAttribute("data-y-raw"))||parseFloat(v.getAttribute("data-y"))||0;this.__collisionOriginals.set(v,{x:w,y:_})}),g.forEach(v=>{v.classList.add("dragging"),v.getAttribute("data-x-raw")===null&&v.setAttribute("data-x-raw",v.getAttribute("data-x")||"0"),v.getAttribute("data-y-raw")===null&&v.setAttribute("data-y-raw",v.getAttribute("data-y")||"0")})},move:h=>{if(!this.__groupDrag)return;let g=this.gridSize,m=!!this.dragLiveSnap,v=this.__groupDrag.leader,w=this.__groupDrag.startRaw.get(v),_=(parseFloat(v.getAttribute("data-x-raw"))||w.x)+h.dx,E=(parseFloat(v.getAttribute("data-y-raw"))||w.y)+h.dy,A=_-w.x,M=E-w.y,I=this.__groupDrag.members.map(R=>{let F=this.__groupDrag.startRaw.get(R),T=F.x+A,W=F.y+M,z=m?Math.round(T/g)*g:T,k=m?Math.round(W/g)*g:W;return{el:R,rawX:T,rawY:W,snapX:z,snapY:k,w:F.w,h:F.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(I,A,M,m,g),v.setAttribute("data-x-raw",String(_)),v.setAttribute("data-y-raw",String(E));for(let R of I)R.el.setAttribute("data-x-raw",String(R.rawX)),R.el.setAttribute("data-y-raw",String(R.rawY)),this._setCardPosition(R.el,R.snapX,R.snapY);this._resizeContainer()},end:h=>{if(!this.__groupDrag)return;let g=this.gridSize,m=this.__groupDrag.members.map(v=>{let w=parseFloat(v.getAttribute("data-x-raw"))||parseFloat(v.getAttribute("data-x"))||0,_=parseFloat(v.getAttribute("data-y-raw"))||parseFloat(v.getAttribute("data-y"))||0,E=Math.round(w/g)*g,A=Math.round(_/g)*g,M=parseFloat(v.style.width)||v.getBoundingClientRect().width,I=parseFloat(v.style.height)||v.getBoundingClientRect().height;return{el:v,rawX:w,rawY:_,snapX:E,snapY:A,w:M,h:I}});this.disableOverlap&&this._pushCardsOutOfTheWay(m,0,0,!1,g);for(let v of m)this._setCardPosition(v.el,v.snapX,v.snapY),v.el.setAttribute("data-x-raw",String(v.snapX)),v.el.setAttribute("data-y-raw",String(v.snapY));for(let v of this.__groupDrag.members)v.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(i).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:h=>{let g=this.gridSize,m=!!this.dragLiveSnap,v=parseFloat(i.style.width)||i.getBoundingClientRect().width,w=parseFloat(i.style.height)||i.getBoundingClientRect().height,{width:_,height:E}=h.rect,A=m?Math.max(g,Math.round(_/g)*g):_,M=m?Math.max(g,Math.round(E/g)*g):E,I=parseFloat(i.getAttribute("data-x"))||0,R=parseFloat(i.getAttribute("data-y"))||0,F=A,T=M;if(this._isContainerFixed()){let{w:z,h:k}=this._getContainerSize();F=Math.min(A,Math.max(this.gridSize,z-I)),T=Math.min(M,Math.max(this.gridSize,k-R))}let W=[this._rectFor(i,I,R,F,T)];this.disableOverlap&&this._anyCollisionFor(W,new Set([i]))||(i.style.width=`${F}px`,i.style.height=`${T}px`,this._resizeContainer())},end:()=>{let h=this.gridSize,g=parseFloat(i.style.width)||i.getBoundingClientRect().width,m=parseFloat(i.style.height)||i.getBoundingClientRect().height,v=Math.max(h,Math.round(g/h)*h),w=Math.max(h,Math.round(m/h)*h),_=parseFloat(i.getAttribute("data-x"))||0,E=parseFloat(i.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:M,h:I}=this._getContainerSize();v=Math.min(v,Math.max(h,M-_)),w=Math.min(w,Math.max(h,I-E))}let A=[this._rectFor(i,_,E,v,w)];this.disableOverlap&&this._anyCollisionFor(A,new Set([i]))||(i.style.width=`${v}px`,i.style.height=`${w}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),i.addEventListener("mousedown",h=>{this.editMode&&(h.target.closest(".resize-handle")||h.target.closest(".chip")||(h.shiftKey||h.ctrlKey||h.metaKey?(h.stopPropagation(),this._toggleSelection(i)):this._selection.has(i)||(this._clearSelection(),this._toggleSelection(i,!0))))})}async _createCard(i){let c=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(i);return c.hass=this.hass,c}_makeWrapper(i){let a=document.createElement("div");a.classList.add("card-wrapper"),this.editMode&&a.classList.add("editing"),a.style.zIndex||(a.style.zIndex=String(this._highestZ()+1));let c=document.createElement("div");c.className="chip",c.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini danger pill" data-act="delete" title="Delete card" aria-label="Delete card">
        <ha-icon icon="mdi:close-thick"></ha-icon>
      </button>
    `,c.addEventListener("click",async h=>{var m,v,w;h.stopPropagation();let g=(w=(v=(m=h.target)==null?void 0:m.closest("button"))==null?void 0:v.dataset)==null?void 0:w.act;if(g){if(g==="delete")this._selection.size>1&&this._selection.has(a)?(Array.from(this._selection).forEach(E=>E.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(a.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(g==="duplicate"||g==="copy"){let _=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];for(let E of _){let A=this._extractCardConfig(E.firstElementChild)||{},M=await this._createCard(A),I=this._makeWrapper(M);I.style.width=E.style.width,I.style.height=E.style.height;let R=(parseFloat(E.getAttribute("data-x"))||0)+this.gridSize,F=(parseFloat(E.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(I,R,F),I.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(I),this._initCardInteract(I)}this._resizeContainer(),this._queueSave("duplicate")}else if(g==="front")this._adjustZ(a,1);else if(g==="back")this._adjustZ(a,-1);else if(g==="edit"){let _=this._extractCardConfig(a.firstElementChild)||{};await this._openSmartPicker("edit",_,async E=>{let A=await this._createCard(E);A.hass=this.hass,a.replaceChild(A,a.firstElementChild),this._queueSave("edit")})}}});let d=document.createElement("div");d.className="shield";let u=document.createElement("div");return u.classList.add("resize-handle"),u.title="Resize",u.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>',a.append(i,d,c,u),a}_makePlaceholderAt(i=0,a=0,c=100,d=100){let u=document.createElement("div");u.classList.add("card-wrapper","ddc-placeholder"),u.dataset.placeholder="1",this.editMode&&u.classList.add("editing"),this._setCardPosition(u,i,a),u.style.width=`${c}px`,u.style.height=`${d}px`,u.style.zIndex=String(this._highestZ()+1);let h=document.createElement("div");h.className="ddc-placeholder-inner",h.setAttribute("aria-hidden","true");let g=document.createElement("div");return g.className="shield",u.append(h,g),u}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let i=this._makePlaceholderAt(0,0,100,100);this.cardContainer.appendChild(i),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(i=>i.remove())}_ensurePlaceholderIfEmpty(){this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),this._syncEmptyStateUI()}_adjustZ(i,a){let d=parseInt(i.style.zIndex||"1",10)+a;d=Math.max(1,Math.min(9999,d)),i.style.zIndex=String(d),this._queueSave("z-change")}_highestZ(){let i=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>{let c=parseInt(a.style.zIndex||"0",10);c>i&&(i=c)}),i}_setCardPosition(i,a,c){let d=Math.round(a),u=Math.round(c);i.style.transform=`translate3d(${d}px, ${u}px, 0)`,i.setAttribute("data-x",String(d)),i.setAttribute("data-y",String(u)),i.setAttribute("data-x-raw",String(d)),i.setAttribute("data-y-raw",String(u))}_resizeContainer(){let i=this.cardContainer;if(!i||this._isContainerFixed())return;let a=Array.from(i.querySelectorAll(".card-wrapper")),c=0,d=0;a.forEach(u=>{let h=u.getBoundingClientRect(),g=i.getBoundingClientRect(),m=h.left-g.left+h.width,v=h.top-g.top+h.height;c=Math.max(c,m),d=Math.max(d,v)}),i.style.width=`${Math.ceil(c/this.gridSize)*this.gridSize||100}px`,i.style.height=`${Math.ceil(d/this.gridSize)*this.gridSize||100}px`}_pushCardsOutOfTheWay(i,a,c,d,u){if(!this.__collisionOriginals)return;let h=new Set(i.map(F=>F.el)),g=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(F=>!F.dataset.placeholder),m=this._isContainerFixed(),{w:v,h:w}=this._getContainerSize();for(let F of g){if(h.has(F))continue;let T=this.__collisionOriginals.get(F);if(T){F.setAttribute("data-x-raw",String(T.x)),F.setAttribute("data-y-raw",String(T.y));let W=d?Math.round(T.x/u)*u:T.x,z=d?Math.round(T.y/u)*u:T.y;this._setCardPosition(F,W,z)}}let _=i.map(F=>({x:F.snapX,y:F.snapY,w:F.w,h:F.h})),E=new Map,A=new Map;for(let F of g){let T=parseFloat(F.style.width)||F.getBoundingClientRect().width,W=parseFloat(F.style.height)||F.getBoundingClientRect().height;A.set(F,{w:T,h:W})}let M=a>0?1:a<0?-1:0,I=c>0?1:c<0?-1:0,R=Math.abs(a)>=Math.abs(c);for(let F of g){if(h.has(F))continue;let T=this.__collisionOriginals.get(F);if(!T)continue;let{x:W,y:z}=T,{w:k,h:ee}=A.get(F),ie=!1;for(let V of _)if(this._rectsOverlap({x:V.x,y:V.y,w:V.w,h:V.h},{x:W,y:z,w:k,h:ee})){ie=!0,R&&M!==0?W=M>0?V.x+V.w:V.x-k:!R&&I!==0?z=I>0?V.y+V.h:V.y-ee:W=V.x+V.w;break}if(ie){let V=0,Se=R?M!==0?M*u:u:0,re=R?0:I!==0?I*u:u;for(;V<100;){let be={x:W,y:z,w:k,h:ee},ce=!1;for(let ye of _)if(this._rectsOverlap(be,ye)){ce=!0;break}if(!ce){for(let[,ye]of E)if(this._rectsOverlap(be,ye)){ce=!0;break}}if(!ce&&m&&(W<0||z<0||W+k>v||z+ee>w)&&(ce=!0),!ce)break;W+=Se,z+=re,V++}m&&(W=Math.max(0,Math.min(W,Math.max(0,v-k))),z=Math.max(0,Math.min(z,Math.max(0,w-ee))))}E.set(F,{x:W,y:z,w:k,h:ee}),_.push({x:W,y:z,w:k,h:ee})}for(let[F,T]of E){F.setAttribute("data-x-raw",String(T.x)),F.setAttribute("data-y-raw",String(T.y));let W=d?Math.round(T.x/u)*u:T.x,z=d?Math.round(T.y/u)*u:T.y;this._setCardPosition(F,W,z)}}_rectFor(i,a=null,c=null,d=null,u=null){let h=a!=null?a:parseFloat(i.getAttribute("data-x"))||0,g=c!=null?c:parseFloat(i.getAttribute("data-y"))||0,m=d!=null?d:parseFloat(i.style.width)||i.getBoundingClientRect().width||0,v=u!=null?u:parseFloat(i.style.height)||i.getBoundingClientRect().height||0;return{x:h,y:g,w:m,h:v,el:i}}_rectsOverlap(i,a,c=.5){return!(i.x+i.w<=a.x+c||a.x+a.w<=i.x+c||i.y+i.h<=a.y+c||a.y+a.h<=i.y+c)}_anyCollisionFor(i,a){let c=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(u=>!a.has(u)&&!u.dataset.placeholder);if(!c.length)return!1;let d=c.map(u=>this._rectFor(u));for(let u of i)for(let h of d)if(this._rectsOverlap(u,h))return!0;return!1}_extractCardConfig(i){return(i==null?void 0:i._config)||(i==null?void 0:i.config)||{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(i,a){try{console.info("[ddc:editor] Requesting editor element",{type:i,cfg:a})}catch{}let c=await this._helpersPromise||await window.loadCardHelpers();try{typeof i=="string"&&i&&!i.startsWith("custom:")&&i!=="custom_card"&&await this._ensureCardModuleLoaded(i,a)}catch{}let d=async()=>{try{return c.getCardElementClass?await c.getCardElementClass(i):null}catch{return null}};try{let v=await d();if(v&&typeof v.getConfigElement=="function"){let w=await v.getConfigElement();if(w){try{console.info("[ddc:editor] Found static class editor",{type:i})}catch{}return w}}}catch{}try{let v;try{v=await this._getStubConfigForType(i)}catch{}let w=v&&typeof v=="object"?{...v}:{type:i},_=c.createCardElement(w);if(_.hass=this.hass,typeof _.getConfigElement=="function"){let E=await _.getConfigElement();if(E){try{console.info("[ddc:editor] Found instance-level editor",{type:i})}catch{}return E}}}catch{}let u=String(i).replace(/^custom:/,""),g=(Array.isArray(window.customCards)?window.customCards:[]).find(v=>(v==null?void 0:v.type)===u||(v==null?void 0:v.type)===i||(v==null?void 0:v.type)===`custom:${u}`),m=[];g!=null&&g.editor&&m.push(g.editor),m.push(`${u}-editor`,`${u}-config-editor`),u&&typeof u=="string"&&m.push(`hui-${u}-card-editor`);for(let v of m)if(!(!v||typeof v!="string"))for(let w of[0,100,300,700])try{if(customElements.get(v)||await Promise.race([customElements.whenDefined(v),new Promise(_=>setTimeout(_,w))]),customElements.get(v)){try{console.info("[ddc:editor] Found editor by tag",{type:i,tag:v})}catch{}return document.createElement(v)}}catch{}return null}async _ensureCardModuleLoaded(i,a){try{let c=await this._helpersPromise||await window.loadCardHelpers();if(c!=null&&c.getCardElementClass){await c.getCardElementClass(i);try{console.info("[ddc:editor] Warmed card module",{type:i})}catch{}}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let i=document.createElement("style");i.setAttribute("data-ddc-overlay-fix",""),i.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(i)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(a=>{var c;return{type:(c=a==null?void 0:a.type)!=null&&c.startsWith("custom:")?a.type:`custom:${a==null?void 0:a.type}`,name:(a==null?void 0:a.name)||(a==null?void 0:a.type)||"Custom card",icon:"mdi:puzzle-outline",description:(a==null?void 0:a.description)||"",editorTag:(a==null?void 0:a.editor)||null}}).filter(a=>typeof a.type=="string"&&a.type.startsWith("custom:"))}_schemaForType(i){let a=d=>d,c=[];return{entities:a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities"}]}),entity:a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity"}]}),sensor:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities (multiselect)"}]}),"picture-glance":a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:a({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:a({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity"}]}),button:a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity (optional)"}]}),iframe:a({fields:[{key:"url",type:"text",label:"URL"}]}),area:a({fields:[{key:"area",type:"text",label:"Area ID"}]})}[i]||{fields:[]}}_shapeBySchema(i,a={}){let c=this._schemaForType(i)||{fields:[]},d={...a,type:i};for(let u of c.fields){let h=d[u.key];if(u.type==="entities"){let m=(Array.isArray(h)?h:h!=null&&h!==""?[h]:[]).filter(Boolean);m.length?d[u.key]=m:delete d[u.key]}else if(u.type==="entity")Array.isArray(h)&&(h=h[0]),h==null||h===""?delete d[u.key]:d[u.key]=String(h);else if(u.type==="number")if(h==null||h==="")delete d[u.key];else{let g=Number(h);Number.isFinite(g)?d[u.key]=g:delete d[u.key]}else(u.type==="select"||u.type==="text"||u.type==="textarea")&&(h==null||h===""?delete d[u.key]:d[u.key]=h)}return d}_statesList(i){var d;let a=Object.keys(((d=this.hass)==null?void 0:d.states)||{});if(!i||!i.length)return a;if(!this.__domainIndex||this.__domainIndex._gen!==a.length){let u={};for(let h of a){let g=h.split(".")[0];(u[g]||(u[g]=[])).push(h)}this.__domainIndex={_gen:a.length,map:u}}let c=[];for(let u of i)this.__domainIndex.map[u]&&c.push(...this.__domainIndex.map[u]);return c}_isNumericEntity(i){var d,u;let a=(u=(d=this.hass)==null?void 0:d.states)==null?void 0:u[i];if(!a)return!1;let c=Number(a.state);return Number.isFinite(c)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(i){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(i)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(i){try{let a=this._getRecent().filter(c=>c!==i);a.unshift(i),a.length>10&&(a.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(a))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let i=document.createElement("link");i.rel="stylesheet",i.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",i.setAttribute("data-cm-core",""),document.head.appendChild(i)}await new Promise(i=>{if(window.CodeMirror)return i();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",a.onload=i,document.head.appendChild(a)}),await new Promise(i=>{var c,d;if((d=(c=window.CodeMirror)==null?void 0:c.mimeModes)!=null&&d.yaml)return i();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",a.onload=i,document.head.appendChild(a)}),this.__cmReady=!0}}async _mountYamlEditor(i,a,c,d){let u=m=>window.jsyaml?window.jsyaml.dump(m):JSON.stringify(m,null,2),h=m=>window.jsyaml?window.jsyaml.load(m):JSON.parse(m);i.innerHTML="";let g=u(a);if(customElements.get("ha-code-editor")){let m=document.createElement("ha-code-editor");m.mode="yaml",m.hass=this.hass,m.value=g,m.style.display="block",m.style.height="260px",i.appendChild(m);let v=!1;return m.addEventListener("value-changed",w=>{var E,A,M;if(v)return;let _=(M=(A=(E=w.detail)==null?void 0:E.value)!=null?A:m.value)!=null?M:"";try{c(h(_))}catch(I){d==null||d(I)}}),{setValue:w=>{var E;let _=u(w);((E=m.value)!=null?E:"")!==_&&(v=!0,m.value=_,v=!1)}}}try{await this._ensureCodeMirror();let m=window.CodeMirror(i,{value:g,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),v=!1;return m.on("change",()=>{if(v)return;let w=m.getValue();try{c(h(w))}catch(_){d==null||d(_)}}),{setValue:w=>{let _=u(w);m.getValue()!==_&&(v=!0,m.setValue(_),v=!1)}}}catch{let m=document.createElement("textarea");return m.style.width="100%",m.style.height="260px",m.value=g,m.addEventListener("input",()=>{try{c(h(m.value))}catch(v){d==null||d(v)}}),i.appendChild(m),{setValue:v=>{let w=u(v);m.value!==w&&(m.value=w)}}}}_createVirtualList({container:i,items:a,rowHeight:c=36,renderRow:d}){i.style.position="relative",i.style.overflow="auto";let u=document.createElement("div");u.style.height=`${a.length*c}px`,i.innerHTML="",i.appendChild(u);let h=new Map,g=()=>{let m=i.scrollTop,v=i.clientHeight,w=Math.max(0,Math.floor(m/c)-6),_=Math.min(a.length-1,Math.ceil((m+v)/c)+6);for(let[E,A]of h)(E<w||E>_)&&(A.remove(),h.delete(E));for(let E=w;E<=_;E++){if(h.has(E))continue;let A=d(a[E],E);A.style.position="absolute",A.style.left="0",A.style.right="0",A.style.top=`${E*c}px`,h.set(E,A),i.appendChild(A)}};return i.addEventListener("scroll",g,{passive:!0}),new ResizeObserver(g).observe(i),g(),{refresh(m){if(m){a=m,u.style.height=`${a.length*c}px`;for(let[,v]of h)v.remove();h.clear()}g()}}}async _openSmartPicker(i="add",a=null,c=null){let d=()=>u.remove(),u=document.createElement("div");u.className="modal",u.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${i==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${i==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${i==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.appendChild(u);let h=u.querySelector("#leftPane"),g=u.querySelector("#addBtn"),m=u.querySelector("#footAdd"),v=u.querySelector("#cancelBtn"),w=u.querySelector("#footCancel"),_=u.querySelector("#search"),E=u.querySelector("#cardHost"),A=u.querySelector("#editorHost"),M=u.querySelector("#editorSpin"),I=u.querySelector("#quickFill"),R=u.querySelector("#yamlHost"),F=u.querySelector("#yamlErr"),T=u.querySelector("#yamlSec"),W=u.querySelector("#tabVisual"),z=u.querySelector("#tabYaml"),k=u.querySelector("#err"),ee=u.querySelector("#previewSpin"),ie=D=>{g.disabled=m.disabled=!D},V=D=>{D?(k.hidden=!1,k.textContent=D):(k.hidden=!0,k.textContent="")},Se=this._getFaves(),re=this._getRecent(),be=this._catalog(),ce=be.find(D=>D.id==="favorites"),ye=be.find(D=>D.id==="recent"),Pe=be.flatMap(D=>D.items||[]);ce.items=Pe.filter(D=>Se.has(D.type)),ye.items=re.map(D=>Pe.find(j=>j.type===D)).filter(Boolean);let He=this._customCardsFromRegistry();He.length&&be.push({id:"custom",name:"Custom (installed)",items:He});let rt="visual",xe=D=>{let j=D==="yaml";W.classList.toggle("active",!j),W.setAttribute("aria-selected",String(!j)),z.classList.toggle("active",j),z.setAttribute("aria-selected",String(j)),A.parentElement.style.display=j?"none":"",T.style.display=j?"":"none",j&&T.scrollIntoView({behavior:"smooth",block:"start"}),rt=j?"yaml":"visual"};W.addEventListener("click",async()=>{var D;if(xe("visual"),!pe)await yt(K);else try{(D=pe.setConfig)==null||D.call(pe,K)}catch{}}),z.addEventListener("click",()=>xe("yaml")),xe("yaml");let Ye=()=>{let D=_.value.trim().toLowerCase();return be.map(j=>({...j,items:(j.items||[]).filter(ne=>!D||ne.name.toLowerCase().includes(D)||ne.type.toLowerCase().includes(D))})).filter(j=>j.items&&j.items.length||j.id==="favorites"||j.id==="recent")},gt=()=>{let D=Ye();h.innerHTML="",D.forEach(j=>{let ne=document.createElement("div");ne.style.padding="12px",ne.style.borderBottom="1px solid var(--divider-color)";let se=document.createElement("h4");if(se.textContent=j.name,se.style.margin="0 0 10px 0",se.style.fontSize=".92rem",se.style.opacity=".85",ne.appendChild(se),!j.items.length&&(j.id==="favorites"||j.id==="recent")){let ae=document.createElement("div");ae.style.opacity=".6",ae.style.fontSize=".85rem",ae.textContent=j.id==="favorites"?"No favorites yet.":"No recent items yet.",ne.appendChild(ae)}else j.items.forEach(ae=>{let de=document.createElement("button");de.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${ae.icon}"></ha-icon><span>${ae.name}</span>
            </span>`,Object.assign(de.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),de.addEventListener("click",async()=>{$t(de),await We(ae.type)}),ne.appendChild(de)});h.appendChild(ne)})},$t=D=>{h.querySelectorAll("button").forEach(j=>j.classList.remove("active")),D==null||D.classList.add("active"),D&&(D.style.background="rgba(0,0,0,.06)")},K=null,Ce=null,oe=null,pe=null,De=0,mt=null,H="",vt=(D,j)=>{var _e;let ne=this._schemaForType(D);if(I.innerHTML="",!ne.fields.length){I.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let se=Object.keys(((_e=this.hass)==null?void 0:_e.states)||{}),ae=document.createElement("div"),de=(q,he,me,Fe)=>{let fe=document.createElement("div");Object.assign(fe.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),fe.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${q}</span>`,he.includes(q)&&(fe.style.background="rgba(3,169,244,.12)",fe.style.borderColor="var(--primary-color)",fe.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),fe.addEventListener("click",async()=>{let Be=he.indexOf(q);Be>=0?he.splice(Be,1):he.push(q);let $e=he.includes(q);fe.style.background=$e?"rgba(3,169,244,.12)":"",fe.style.borderColor=$e?"var(--primary-color)":"var(--divider-color)",fe.querySelector("ha-icon").setAttribute("icon",$e?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),K=this._shapeBySchema(D,{...K,[Fe]:[...he]}),ke(K),oe==null||oe.setValue(K)}),me.appendChild(fe)};ne.fields.forEach(q=>{var Fe,fe,Be,$e,Ot,Mt,ot,Pt,It;let he=document.createElement("div");Object.assign(he.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let me=document.createElement("label");if(me.textContent=q.label||q.key,me.style.minWidth="130px",q.type==="entities"){let te=document.createElement("div");te.style.flex="1";let G=document.createElement("input");Object.assign(G,{placeholder:"Filter entities\u2026"}),Object.assign(G.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let le=document.createElement("div");Object.assign(le.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let Ie=q.domains&&q.domains.length?this._statesList(q.domains):se,Ae=Array.isArray(j[q.key])?[...j[q.key]]:j[q.key]?[j[q.key]]:[],at=je=>{let Ne=document.createElement("div");Object.assign(Ne.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let lt=document.createElement("ha-icon");lt.setAttribute("icon","mdi:checkbox-blank-outline"),lt.style.setProperty("--mdc-icon-size","18px");let ct=document.createElement("span");ct.textContent=je,ct.style.whiteSpace="nowrap",ct.style.overflow="hidden",ct.style.textOverflow="ellipsis",Ne.append(lt,ct);let wt=()=>{let Ke=Ae.includes(je);Ne.style.background=Ke?"rgba(3,169,244,.12)":"",Ne.style.borderColor=Ke?"var(--primary-color)":"var(--divider-color)",lt.setAttribute("icon",Ke?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return wt(),Ne.addEventListener("click",()=>{let Ke=Ae.indexOf(je);Ke>=0?Ae.splice(Ke,1):Ae.push(je),K=this._shapeBySchema(D,{...K,[q.key]:[...Ae]}),ke(K),oe==null||oe.setValue(K),wt()}),Ne},st=Ie;this._createVirtualList({container:le,items:st,rowHeight:36,renderRow:at}),G.addEventListener("input",()=>{let je=G.value.trim().toLowerCase();st=Ie.filter(Ne=>!je||Ne.toLowerCase().includes(je)),this._createVirtualList({container:le,items:st,rowHeight:36,renderRow:at})}),te.append(G,le),he.append(me,te),K=this._shapeBySchema(D,{...j,[q.key]:Ae})}if(q.type==="entity"){let te=document.createElement("div");te.style.flex="1",te.style.position="relative";let G=document.createElement("input");G.setAttribute("list","ddc_entlist_"+q.key),Object.assign(G.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),G.placeholder=`Select ${((Fe=q.label)==null?void 0:Fe.toLowerCase())||"entity"}\u2026`;let le=document.createElement("ha-icon");le.setAttribute("icon","mdi:magnify"),Object.assign(le.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let Ie=document.createElement("datalist");Ie.id="ddc_entlist_"+q.key;let Ae=q.domains&&q.domains.length?this._statesList(q.domains):Object.keys(((fe=this.hass)==null?void 0:fe.states)||{});Ie.innerHTML=Ae.map(at=>`<option value="${at}">`).join(""),G.value=Array.isArray(j[q.key])?j[q.key][0]||"":j[q.key]||"",G.addEventListener("change",async()=>{K=this._shapeBySchema(D,{...K,[q.key]:G.value||void 0}),ke(K),oe==null||oe.setValue(K)}),te.append(le,G,Ie),he.append(me,te)}if(q.type==="number"){let te=document.createElement("div");te.style.flex="1",te.style.position="relative";let G=document.createElement("input");G.type="number",q.step&&(G.step=q.step),Object.assign(G.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let le=document.createElement("ha-icon");le.setAttribute("icon","mdi:counter"),Object.assign(le.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),G.value=($e=(Be=j[q.key])!=null?Be:q.default)!=null?$e:"",G.addEventListener("input",async()=>{let Ie=G.value===""?void 0:Number(G.value);K=this._shapeBySchema(D,{...K,[q.key]:isNaN(Ie)?void 0:Ie}),ke(K),oe==null||oe.setValue(K)}),te.append(le,G),he.append(me,te)}if(q.type==="select"){let te=document.createElement("div");te.style.flex="1",te.style.position="relative";let G=document.createElement("select");Object.assign(G.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let le=document.createElement("ha-icon");le.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(le.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(q.options||[]).forEach(Ie=>{let Ae=document.createElement("option");Ae.value=Ie,G.appendChild(Ae)}),G.value=(ot=(Ot=j[q.key])!=null?Ot:q.default)!=null?ot:((Mt=q.options)==null?void 0:Mt[0])||"",G.addEventListener("change",async()=>{K=this._shapeBySchema(D,{...K,[q.key]:G.value}),ke(K),oe==null||oe.setValue(K)}),te.append(le,G),he.append(me,te)}if(q.type==="text"){let te=document.createElement("div");te.style.flex="1",te.style.position="relative";let G=document.createElement("input");G.type="text",Object.assign(G.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let le=document.createElement("ha-icon");le.setAttribute("icon","mdi:text"),Object.assign(le.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),G.value=(Pt=j[q.key])!=null?Pt:"",G.addEventListener("input",async()=>{K=this._shapeBySchema(D,{...K,[q.key]:G.value||void 0}),ke(K),oe==null||oe.setValue(K)}),te.append(le,G),he.append(me,te)}if(q.type==="textarea"){let te=document.createElement("textarea");Object.assign(te.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),te.value=(It=j[q.key])!=null?It:"",te.addEventListener("input",async()=>{K=this._shapeBySchema(D,{...K,[q.key]:te.value||""}),ke(K),oe==null||oe.setValue(K)}),he.append(me,te)}ae.appendChild(he)}),I.innerHTML="",I.appendChild(ae)},ke=D=>{let j=JSON.stringify(D||{});j!==H&&(H=j,mt&&clearTimeout(mt),mt=setTimeout(async()=>{let ne=++De;ee.hidden=!1,E.innerHTML="",await yr();try{let se=await this._helpersPromise||await window.loadCardHelpers();if(ne!==De)return;let ae=se.createCardElement(D);if(ae.hass=this.hass,ne!==De)return;E.appendChild(ae)}catch{}finally{ne===De&&(ee.hidden=!0)}},150))},yt=async D=>{var ae;let j=++De;if(M.hidden=!1,A.innerHTML="",await sl(),j!==De)return M.hidden=!0,!1;let ne=D.type||Ce,se=await this._getEditorElementForType(ne,D);if(!se){await this._ensureCardModuleLoaded(ne,D);for(let de of[0,120,250,500,900])if(de&&await new Promise(_e=>setTimeout(_e,de)),se=await this._getEditorElementForType(ne,D),se)break}if(!se){let de=document.createElement("div");return de.style.opacity=".7",de.style.fontSize=".9rem",de.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",j===De&&(A.appendChild(de),M.hidden=!0),pe=null,ie(!0),rt!=="visual"&&xe("yaml"),!1}try{se.hass=this.hass,se.isConnected||A.appendChild(se),await Promise.resolve();try{se.setConfig(D)}catch{}try{let _e=await this._helpersPromise||await window.loadCardHelpers(),q=_e.getCardElementClass?await _e.getCardElementClass(D.type||Ce):null;if(q!=null&&q.getStubConfig){let he=Object.keys(((ae=this.hass)==null?void 0:ae.states)||{}),me=fe=>he.filter(Be=>Be.startsWith(fe+".")),Fe=await q.getStubConfig(this.hass,he,me);Fe&&(D=this._shapeBySchema(D.type||Ce,{...Fe}))}}catch{}await Promise.resolve();try{se.setConfig(D)}catch{}pe&&this.__onEditorChange&&(pe.removeEventListener("config-changed",this.__onEditorChange),pe.removeEventListener("value-changed",this.__onEditorChange));let de=async _e=>{var me,Fe,fe;let q=(fe=(me=_e.detail)==null?void 0:me.config)!=null?fe:(Fe=_e.detail)==null?void 0:Fe.value;if(!q)return;let he=q.type||Ce;Ce=he,K=this._shapeBySchema(he,q),V(""),ie(!0),vt(Ce,K),ke(K),oe==null||oe.setValue(K)};return this.__onEditorChange=de,se.addEventListener("config-changed",de),se.addEventListener("value-changed",de),pe=se,rt!=="yaml"&&xe("visual"),ie(!0),!0}finally{j===De&&(M.hidden=!0)}},Tt=async D=>{oe=await this._mountYamlEditor(R,D,async j=>{var ne,se;try{let ae=(j==null?void 0:j.type)||Ce,de=this._shapeBySchema(ae,j||{}),_e=ae!==Ce;if(Ce=ae,K=de,F.hidden=!0,F.textContent="",ie(!0),_e){if(vt(Ce,K),pe){try{(ne=pe.setConfig)==null||ne.call(pe,K)}catch{}rt!=="yaml"&&xe("visual")}}else{try{(se=pe==null?void 0:pe.setConfig)==null||se.call(pe,K)}catch{}ke(K)}}catch(ae){F.hidden=!1,F.textContent=`Invalid config: ${String((ae==null?void 0:ae.message)||ae)}`,ie(!1)}},j=>{F.hidden=!1,F.textContent=`Invalid YAML: ${String((j==null?void 0:j.message)||j)}`,ie(!1)})},bt=async D=>{if(this.__stubCache.has(D))return{...this.__stubCache.get(D)};let j=await this._getStubConfigForType(D);return this.__stubCache.set(D,{...j}),{...j}},We=async D=>{F.hidden=!0,F.textContent="",V(""),Ce=D;let j=i==="edit"&&a&&a.type===D?{...a}:await bt(D);K=this._shapeBySchema(D,j),pe=null,vt(D,K),await Tt(K),await yr(),ke(K),xe("yaml"),ie(!0)},Re=async()=>{if(!K)return;let D=this._shapeBySchema(Ce,K);i==="edit"&&typeof c=="function"?await c(D):(await this._addPickedCardToLayout(D),this._pushRecent((D||{}).type)),d()};v.addEventListener("click",d),w.addEventListener("click",d),g.addEventListener("click",Re),m.addEventListener("click",Re),u.addEventListener("keydown",D=>{D.key==="Escape"&&d(),D.key==="Enter"&&!g.disabled&&Re()});let xt=null;_.addEventListener("input",()=>{xt&&clearTimeout(xt),xt=setTimeout(gt,120)}),gt(),await We((()=>{var ne;return(((ne=this._getRecent)==null?void 0:ne.call(this))||[]).find(Boolean)||"entities"})()),ie(!0),i==="edit"&&a&&(await We(a.type||"entities"),ie(!0))}async _getStubConfigForType(i){var v;let a=await this._helpersPromise||await window.loadCardHelpers(),c=null;if(i==="custom_card")return{type:"custom_card"};try{a.getCardElementClass&&(c=await a.getCardElementClass(i))}catch{}let d=Object.keys(((v=this.hass)==null?void 0:v.states)||{}),u=w=>d.filter(_=>_.startsWith(w+"."));if(c!=null&&c.getStubConfig)try{return await c.getStubConfig(this.hass,d,u)}catch{}let h={type:i},g=d[0],m=u("sensor")[0]||g;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast"].includes(i)&&(h.entity={sensor:m,gauge:u("sensor").find(this._isNumericEntity.bind(this))||m,"media-control":u("media_player")[0]||g,light:u("light")[0]||g,thermostat:u("climate")[0]||g,"alarm-panel":u("alarm_control_panel")[0]||g,"weather-forecast":u("weather")[0]||g}[i]||m||g),["entities","glance","picture-glance","history-graph","statistics-graph","map"].includes(i)){let w=_=>(_!=null&&_.length?d.filter(E=>_.includes(E.split(".")[0])):d).slice(0,3);i==="map"?h.entities=w(["device_tracker","person"]):i==="statistics-graph"?h.entities=w(["sensor","number","input_number"]):h.entities=w()}return i==="iframe"&&(h.url="https://www.home-assistant.io"),i==="markdown"&&(h.content="## New card"),h}_getNextAvailablePosition(){let i=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),a=new Set,c=this.gridSize;i.forEach(h=>{let g=parseFloat(h.getAttribute("data-x"))||0,m=parseFloat(h.getAttribute("data-y"))||0,v=parseFloat(getComputedStyle(h).width)||100,w=parseFloat(getComputedStyle(h).height)||100,_=Math.floor(g/c),E=Math.floor(m/c),A=Math.floor((g+v)/c),M=Math.floor((m+w)/c);for(let I=_;I<A;I++)for(let R=E;R<M;R++)a.add(`${I}-${R}`)});let d=0,u=0;for(;a.has(`${d}-${u}`);)d+=6,d>60&&(d=0,u+=6);return{x:d*c,y:u*c}}async _addPickedCardToLayout(i){this._hideEmptyPlaceholder();let a=await this._createCard(i),c=this._makeWrapper(a),d=this._getNextAvailablePosition();this._setCardPosition(c,d.x,d.y),c.style.width=`${14*this.gridSize}px`,c.style.height=`${10*this.gridSize}px`,c.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(c),this._initCardInteract(c),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI()}_toggleSelection(i,a=null){let c=a==null?!this._selection.has(i):!!a;c?this._selection.add(i):this._selection.delete(i),i.classList.toggle("selected",c)}_clearSelection(){for(let i of this._selection)i.classList.remove("selected");this._selection.clear()}_installSelectionMarquee(){let i=this.cardContainer,a=0,c=0,d=null,u=!1,h=_=>{let E=i.getBoundingClientRect(),A="touches"in _&&_.touches[0]?_.touches[0].clientX:_.clientX,M="touches"in _&&_.touches[0]?_.touches[0].clientY:_.clientY;return{x:A-E.left,y:M-E.top}},g=(_,E)=>{let A=Math.min(_,a),M=Math.max(_,a),I=Math.min(E,c),R=Math.max(E,c);d.style.left=`${A}px`,d.style.top=`${I}px`,d.style.width=`${M-A}px`,d.style.height=`${R-I}px`;let F=d.getBoundingClientRect(),T=i.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),T.forEach(W=>{let z=W.getBoundingClientRect();!(z.right<F.left||z.left>F.right||z.bottom<F.top||z.top>F.bottom)&&this._toggleSelection(W,!0)})},m=_=>{if(!this.editMode||_.target.closest(".card-wrapper"))return;u=!0;let E=h(_);a=E.x,c=E.y,d=document.createElement("div"),d.className="marquee",d.style.left=`${a}px`,d.style.top=`${c}px`,i.appendChild(d),_.preventDefault()},v=_=>{!u||!d||g(h(_).x,h(_).y)},w=()=>{u&&(u=!1,d&&d.remove(),d=null)};i.addEventListener("mousedown",m),window.addEventListener("mousemove",v),window.addEventListener("mouseup",w),i.addEventListener("touchstart",_=>{this.editMode&&(_.target.closest(".card-wrapper")||m(_))},{passive:!1}),window.addEventListener("touchmove",_=>{v(_)},{passive:!1}),window.addEventListener("touchend",w),window.addEventListener("touchcancel",w)}async _openDiagnostics(){var g,m;let i=document.createElement("div");i.className="modal";let a=this.storageKey||"(none)",c=this._backendOK&&!!this.storageKey,d=v=>v.slice(-200).map(w=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${w.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${w.kind}]</b>
        <span style="margin-left:6px">${this._safe(w.msg)}</span>
        ${w.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(w.extra,null,2))}</pre>`:""}
      </div>`).join("");i.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95vw);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((g=this._config)==null?void 0:g.storage_key)||"")}</code> \u2192 <code>${this._safe(a)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${c?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((m=this.cardContainer)==null?void 0:m.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${d(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let u=()=>i.remove();i.querySelector("#closeDiag").addEventListener("click",u),this.appendChild(i);let h=()=>{let v=i.querySelector("#logArea"),w=_=>_.slice(-200).map(E=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${E.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${E.kind}]</b>
          <span style="margin-left:6px">${this._safe(E.msg)}</span>
          ${E.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(E.extra,null,2))}</pre>`:""}
        </div>`).join("");v.innerHTML=w(this._dbgDump()),v.scrollTop=v.scrollHeight};i.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{h()}}),i.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),h()}),i.querySelector("#exportJson").addEventListener("click",()=>{let w=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(M=>{let I=parseFloat(M.getAttribute("data-x"))||0,R=parseFloat(M.getAttribute("data-y"))||0,F=parseFloat(M.style.width)||M.getBoundingClientRect().width,T=parseFloat(M.style.height)||M.getBoundingClientRect().height,W=parseInt(M.style.zIndex||"1",10);return{card:this._extractCardConfig(M.firstElementChild),position:{x:I,y:R},size:{width:F,height:T},z:W}}),_={version:2,options:this._exportableOptions(),cards:w},E=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),A=document.createElement("a");A.href=URL.createObjectURL(E),A.download=`ddc_${this.storageKey||"layout"}.json`,A.click(),URL.revokeObjectURL(A.href)}),i.querySelector("#importJson").addEventListener("click",async()=>{let v=document.createElement("input");v.type="file",v.accept="application/json",v.onchange=async()=>{var A,M,I,R,F,T,W,z,k,ee;let w=(A=v.files)==null?void 0:A[0];if(!w)return;let _=await w.text();try{let ie=JSON.parse(_);if(this._dbgPush("import","Loaded file",{bytes:_.length}),this.cardContainer.innerHTML="",(M=ie.cards)!=null&&M.length)for(let V of ie.cards)if(!(V!=null&&V.card)||typeof V.card=="object"&&Object.keys(V.card).length===0){let Se=this._makePlaceholderAt(((I=V.position)==null?void 0:I.x)||0,((R=V.position)==null?void 0:R.y)||0,((F=V.size)==null?void 0:F.width)||100,((T=V.size)==null?void 0:T.height)||100);this.cardContainer.appendChild(Se)}else{let Se=await this._createCard(V.card),re=this._makeWrapper(Se);this._setCardPosition(re,((W=V.position)==null?void 0:W.x)||0,((z=V.position)==null?void 0:z.y)||0),re.style.width=`${((k=V.size)==null?void 0:k.width)||140}px`,re.style.height=`${((ee=V.size)==null?void 0:ee.height)||100}px`,this.cardContainer.appendChild(re),this._initCardInteract(re)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1)}catch(ie){this._dbgPush("import","Parse failed",{error:String(ie)})}let E=new Event("ddc-logrefresh");window.dispatchEvent(E)},v.click()}),i.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),h();let v=(this.storageKey||"ddc_test")+"_selftest",w={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(v,w);let _=await this._loadLayoutFromBackend(v);this._dbgPush("test","Round-trip result",{wrote:w,read:_})}catch(_){this._dbgPush("test","Round-trip failed",{error:String(_)})}h()}),h()}_exportableOptions(){var a,c;let i={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(a=this.containerFixedWidth)!=null?a:void 0,container_fixed_height:(c=this.containerFixedHeight)!=null?c:void 0,container_preset:this.containerPreset};return Object.keys(i).forEach(d=>i[d]===void 0&&delete i[d]),i}_applyImportedOptions(i={},a=!0){var c,d,u;this._config={...this._config||{},...i},"storage_key"in i&&(this.storageKey=i.storage_key||void 0),"grid"in i&&(this.gridSize=Number(i.grid)||10),"drag_live_snap"in i&&(this.dragLiveSnap=!!i.drag_live_snap),"auto_save"in i&&(this.autoSave=!!i.auto_save),"auto_save_debounce"in i&&(this.autoSaveDebounce=Number(i.auto_save_debounce)||800),"container_background"in i&&(this.containerBackground=(c=i.container_background)!=null?c:"transparent"),"card_background"in i&&(this.cardBackground=(d=i.card_background)!=null?d:"var(--ha-card-background, var(--card-background-color))"),"debug"in i&&(this.debug=!!i.debug),"disable_overlap"in i&&(this.disableOverlap=!!i.disable_overlap),"container_size_mode"in i&&(this.containerSizeMode=i.container_size_mode||"dynamic"),"container_fixed_width"in i&&(this.containerFixedWidth=Number(i.container_fixed_width)||null),"container_fixed_height"in i&&(this.containerFixedHeight=Number(i.container_fixed_height)||null),"container_preset"in i&&(this.containerPreset=i.container_preset||"fhd"),"container_preset_orientation"in i&&(this.containerPresetOrient=i.container_preset_orientation||"auto"),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),a&&(this._applyContainerSizingFromConfig(!0),this._resizeContainer(),(u=this._updateStoreBadge)==null||u.call(this))}_exportDesign(){let a=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(g=>{let m=parseFloat(g.getAttribute("data-x"))||0,v=parseFloat(g.getAttribute("data-y"))||0,w=parseFloat(g.style.width)||g.getBoundingClientRect().width,_=parseFloat(g.style.height)||g.getBoundingClientRect().height,E=parseInt(g.style.zIndex||"1",10);return{card:this._extractCardConfig(g.firstElementChild),position:{x:m,y:v},size:{width:w,height:_},z:E}}),c={version:2,options:this._exportableOptions(),cards:a},d=`ddc_design_${this.storageKey||"layout"}.json`,u=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(u),h.download=d,h.click(),URL.revokeObjectURL(h.href),this._toast("Design exported.")}_importDesign(){let i=document.createElement("input");i.type="file",i.accept="application/json",i.onchange=async()=>{var d,u,h,g,m,v,w,_,E,A;let a=(d=i.files)==null?void 0:d[0];if(!a)return;let c=await a.text();try{let M=JSON.parse(c);if(M.options?this._applyImportedOptions(M.options,!0):typeof M.grid=="number"&&this._applyImportedOptions({grid:M.grid},!0),this.cardContainer.innerHTML="",(u=M.cards)!=null&&u.length)for(let I of M.cards)if(!(I!=null&&I.card)||typeof I.card=="object"&&Object.keys(I.card).length===0){let R=this._makePlaceholderAt(((h=I.position)==null?void 0:h.x)||0,((g=I.position)==null?void 0:g.y)||0,((m=I.size)==null?void 0:m.width)||100,((v=I.size)==null?void 0:v.height)||100);this.cardContainer.appendChild(R)}else{let R=await this._createCard(I.card),F=this._makeWrapper(R);this._setCardPosition(F,((w=I.position)==null?void 0:w.x)||0,((_=I.position)==null?void 0:_.y)||0),F.style.width=`${((E=I.size)==null?void 0:E.width)||140}px`,F.style.height=`${((A=I.size)==null?void 0:A.height)||100}px`,I.z!=null&&(F.style.zIndex=String(I.z)),this.cardContainer.appendChild(F),this._initCardInteract(F)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1),this._toast("Design imported.")}catch(M){console.error("Import failed",M),this._toast("Import failed \u2014 invalid file.")}},i.click()}_queueSave(i="auto"){this.autoSave&&(this._dbgPush("autosave","Queued",{reason:i,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce))}async _saveLayout(i=!0){let c=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(u=>{let h=parseFloat(u.getAttribute("data-x"))||0,g=parseFloat(u.getAttribute("data-y"))||0,m=parseFloat(u.style.width)||u.getBoundingClientRect().width,v=parseFloat(u.style.height)||u.getBoundingClientRect().height,w=parseInt(u.style.zIndex||"1",10);return{card:this._extractCardConfig(u.firstElementChild),position:{x:h,y:g},size:{width:m,height:v},z:w}}),d={version:2,options:this._exportableOptions(),cards:c};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(d))}catch{}if(!this.storageKey){i||this._toast("Saved locally (no storage_key set).");return}try{await this._saveLayoutToBackend(this.storageKey,d),i||this._toast("Layout saved.")}catch(u){console.error("Backend save failed",u),this._dbgPush("save","Backend save failed",{error:String(u)}),i||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let i=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let a=await this.hass.callApi("get","dragdrop_storage"),c=Math.round(performance.now()-i);this._dbgPush("probe",`OK (${c} ms)`,a),this._backendOK=!!a}catch(a){let c=Math.round(performance.now()-i);this._dbgPush("probe",`FAILED (${c} ms)`,{error:String(a)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(i){let a=`dragdrop_storage/${encodeURIComponent(i)}`,c=performance.now();try{this._dbgPush("load",`GET /api/${a}`);let d=await this.hass.callApi("get",a),u=Math.round(performance.now()-c);return this._dbgPush("load",`OK (${u} ms)`,{bytes:JSON.stringify(d||"").length}),d}catch(d){let u=Math.round(performance.now()-c);return this._dbgPush("load",`FAILED (${u} ms)`,{error:String(d)}),null}}async _saveLayoutToBackend(i,a){let c=`dragdrop_storage/${encodeURIComponent(i)}`,d=JSON.stringify(a).length,u=performance.now();try{this._dbgPush("save",`POST /api/${c}`,{bytes:d});let h=await this.hass.callApi("post",c,a),g=Math.round(performance.now()-u);return this._dbgPush("save",`OK (${g} ms)`,h),h}catch(h){let g=Math.round(performance.now()-u);throw this._dbgPush("save",`FAILED (${g} ms)`,{error:String(h),bytes:d}),h}}_updateStoreBadge(){let i=this.storeBadge;if(!i)return;let a=this._backendOK&&!!this.storageKey;i.textContent=a?"storage: backend":"storage: local",i.style.background=a?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",i.style.borderColor=a?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(i){let a=new Event("hass-notification");a.detail={message:i},window.dispatchEvent(a)}_huiRoot(){var i,a,c,d,u,h;try{let g=document.querySelector("home-assistant"),m=(i=g==null?void 0:g.shadowRoot)==null?void 0:i.querySelector("home-assistant-main"),v=((a=m==null?void 0:m.shadowRoot)==null?void 0:a.querySelector("ha-drawer"))||m,w=((c=v==null?void 0:v.shadowRoot)==null?void 0:c.querySelector("partial-panel-resolver"))||v,_=((d=w==null?void 0:w.shadowRoot)==null?void 0:d.querySelector("ha-panel-lovelace"))||((u=v==null?void 0:v.shadowRoot)==null?void 0:u.querySelector("ha-panel-lovelace"));return((h=_==null?void 0:_.shadowRoot)==null?void 0:h.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",zn);(()=>{try{let e=window.customCards=window.customCards||[];e.some(i=>i.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!0})}catch{}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
