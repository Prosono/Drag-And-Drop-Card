var Io=Object.create;var Si=Object.defineProperty;var zo=Object.getOwnPropertyDescriptor;var Lo=Object.getOwnPropertyNames;var Do=Object.getPrototypeOf,Fo=Object.prototype.hasOwnProperty;var Ro=(e,p,n)=>p in e?Si(e,p,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[p]=n;var Bo=(e,p)=>()=>(p||e((p={exports:{}}).exports,p),p.exports);var No=(e,p,n,o)=>{if(p&&typeof p=="object"||typeof p=="function")for(let s of Lo(p))!Fo.call(e,s)&&s!==n&&Si(e,s,{get:()=>p[s],enumerable:!(o=zo(p,s))||o.enumerable});return e};var Ho=(e,p,n)=>(n=e!=null?Io(Do(e)):{},No(p||!e||!e.__esModule?Si(n,"default",{value:e,enumerable:!0}):n,e));var bn=(e,p,n)=>Ro(e,typeof p!="symbol"?p+"":p,n);var _n=Bo((Ci,kt)=>{(function(e,p){typeof Ci=="object"&&typeof kt!="undefined"?kt.exports=p():typeof define=="function"&&define.amd?define(p):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=p()})(Ci,(function(){"use strict";function e(i,t){var r=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);t&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable}))),r.push.apply(r,a)}return r}function p(i){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e(Object(r),!0).forEach((function(a){c(i,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(r,a))}))}return i}function n(i){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(i)}function o(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function s(i,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,O(a.key),a)}}function u(i,t,r){return t&&s(i.prototype,t),r&&s(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function c(i,t,r){return(t=O(t))in i?Object.defineProperty(i,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[t]=r,i}function d(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&x(i,t)}function g(i){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(i)}function x(i,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},x(i,t)}function y(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function v(i){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var r,a=g(i);if(t){var l=g(this).constructor;r=Reflect.construct(a,arguments,l)}else r=a.apply(this,arguments);return(function(h,f){if(f&&(typeof f=="object"||typeof f=="function"))return f;if(f!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y(h)})(this,r)}}function S(){return S=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(i,t,r){var a=(function(h,f){for(;!Object.prototype.hasOwnProperty.call(h,f)&&(h=g(h))!==null;);return h})(i,t);if(a){var l=Object.getOwnPropertyDescriptor(a,t);return l.get?l.get.call(arguments.length<3?i:r):l.value}},S.apply(this,arguments)}function O(i){var t=(function(r,a){if(typeof r!="object"||r===null)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var h=l.call(r,a||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)})(i,"string");return typeof t=="symbol"?t:t+""}var z=function(i){return!(!i||!i.Window)&&i instanceof i.Window},E=void 0,P=void 0;function I(i){E=i;var t=i.document.createTextNode("");t.ownerDocument!==i.document&&typeof i.wrap=="function"&&i.wrap(t)===t&&(i=i.wrap(i)),P=i}function k(i){return z(i)?i:(i.ownerDocument||i).defaultView||P.window}typeof window!="undefined"&&window&&I(window);var M=function(i){return!!i&&n(i)==="object"},T=function(i){return typeof i=="function"},b={window:function(i){return i===P||z(i)},docFrag:function(i){return M(i)&&i.nodeType===11},object:M,func:T,number:function(i){return typeof i=="number"},bool:function(i){return typeof i=="boolean"},string:function(i){return typeof i=="string"},element:function(i){if(!i||n(i)!=="object")return!1;var t=k(i)||P;return/object|function/.test(typeof Element=="undefined"?"undefined":n(Element))?i instanceof Element||i instanceof t.Element:i.nodeType===1&&typeof i.nodeName=="string"},plainObject:function(i){return M(i)&&!!i.constructor&&/function Object\b/.test(i.constructor.toString())},array:function(i){return M(i)&&i.length!==void 0&&T(i.splice)}};function D(i){var t=i.interaction;if(t.prepared.name==="drag"){var r=t.prepared.axis;r==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):r==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function F(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="drag"){var a=r.prepared.axis;if(a==="x"||a==="y"){var l=a==="x"?"y":"x";t.page[l]=r.coords.start.page[l],t.client[l]=r.coords.start.client[l],t.delta[l]=0}}}var U={id:"actions/drag",install:function(i){var t=i.actions,r=i.Interactable,a=i.defaults;r.prototype.draggable=U.draggable,t.map.drag=U,t.methodDict.drag="draggable",a.actions.drag=U.defaults},listeners:{"interactions:before-action-move":D,"interactions:action-resume":D,"interactions:action-move":F,"auto-start:check":function(i){var t=i.interaction,r=i.interactable,a=i.buttons,l=r.options.drag;if(l&&l.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(a&r.options.drag.mouseButtons)!=0))return i.action={name:"drag",axis:l.lockAxis==="start"?l.startAxis:l.lockAxis},!1}},draggable:function(i){return b.object(i)?(this.options.drag.enabled=i.enabled!==!1,this.setPerAction("drag",i),this.setOnEvents("drag",i),/^(xy|x|y|start)$/.test(i.lockAxis)&&(this.options.drag.lockAxis=i.lockAxis),/^(xy|x|y)$/.test(i.startAxis)&&(this.options.drag.startAxis=i.startAxis),this):b.bool(i)?(this.options.drag.enabled=i,this):this.options.drag},beforeMove:D,move:F,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(i){return i.search("drag")===0}},R=U,K={init:function(i){var t=i;K.document=t.document,K.DocumentFragment=t.DocumentFragment||W,K.SVGElement=t.SVGElement||W,K.SVGSVGElement=t.SVGSVGElement||W,K.SVGElementInstance=t.SVGElementInstance||W,K.Element=t.Element||W,K.HTMLElement=t.HTMLElement||K.Element,K.Event=t.Event,K.Touch=t.Touch||W,K.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function W(){}var Y=K,Q={init:function(i){var t=Y.Element,r=i.navigator||{};Q.supportsTouch="ontouchstart"in i||b.func(i.DocumentTouch)&&Y.document instanceof i.DocumentTouch,Q.supportsPointerEvent=r.pointerEnabled!==!1&&!!Y.PointerEvent,Q.isIOS=/iP(hone|od|ad)/.test(r.platform),Q.isIOS7=/iP(hone|od|ad)/.test(r.platform)&&/OS 7[^\d]/.test(r.appVersion),Q.isIe9=/MSIE 9/.test(r.userAgent),Q.isOperaMobile=r.appName==="Opera"&&Q.supportsTouch&&/Presto/.test(r.userAgent),Q.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",Q.pEventTypes=Q.supportsPointerEvent?Y.PointerEvent===i.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,Q.wheelEvent=Y.document&&"onmousewheel"in Y.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},se=Q;function pe(i,t){if(i.contains)return i.contains(t);for(;t;){if(t===i)return!0;t=t.parentNode}return!1}function Ae(i,t){for(;b.element(i);){if(be(i,t))return i;i=xe(i)}return null}function xe(i){var t=i.parentNode;if(b.docFrag(t)){for(;(t=t.host)&&b.docFrag(t););return t}return t}function be(i,t){return P!==E&&(t=t.replace(/\/deep\//g," ")),i[se.prefixedMatchesSelector](t)}var me=function(i){return i.parentNode||i.host};function ae(i,t){for(var r,a=[],l=i;(r=me(l))&&l!==t&&r!==l.ownerDocument;)a.unshift(l),l=r;return a}function Je(i,t,r){for(;b.element(i);){if(be(i,t))return!0;if((i=xe(i))===r)return be(i,t)}return!1}function We(i){return i.correspondingUseElement||i}function ze(i){var t=i instanceof Y.SVGElement?i.getBoundingClientRect():i.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function Me(i){var t,r=ze(i);if(!se.isIOS7&&r){var a={x:(t=(t=k(i))||P).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};r.left+=a.x,r.right+=a.x,r.top+=a.y,r.bottom+=a.y}return r}function Qe(i){for(var t=[];i;)t.push(i),i=xe(i);return t}function Be(i){return!!b.string(i)&&(Y.document.querySelector(i),!0)}function X(i,t){for(var r in t)i[r]=t[r];return i}function te(i,t,r){return i==="parent"?xe(r):i==="self"?t.getRect(r):Ae(r,i)}function ge(i,t,r,a){var l=i;return b.string(l)?l=te(l,t,r):b.func(l)&&(l=l.apply(void 0,a)),b.element(l)&&(l=Me(l)),l}function ee(i){return i&&{x:"x"in i?i.x:i.left,y:"y"in i?i.y:i.top}}function fe(i){return!i||"x"in i&&"y"in i||((i=X({},i)).x=i.left||0,i.y=i.top||0,i.width=i.width||(i.right||0)-i.x,i.height=i.height||(i.bottom||0)-i.y),i}function we(i,t,r){i.left&&(t.left+=r.x),i.right&&(t.right+=r.x),i.top&&(t.top+=r.y),i.bottom&&(t.bottom+=r.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function Fe(i,t,r){var a=r&&i.options[r];return ee(ge(a&&a.origin||i.options.origin,i,t,[i&&t]))||{x:0,y:0}}function Ue(i,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(_){return!0},a=arguments.length>3?arguments[3]:void 0;if(a=a||{},b.string(i)&&i.search(" ")!==-1&&(i=lt(i)),b.array(i))return i.forEach((function(_){return Ue(_,t,r,a)})),a;if(b.object(i)&&(t=i,i=""),b.func(t)&&r(i))a[i]=a[i]||[],a[i].push(t);else if(b.array(t))for(var l=0,h=t;l<h.length;l++){var f=h[l];Ue(i,f,r,a)}else if(b.object(t))for(var m in t)Ue(lt(m).map((function(_){return"".concat(i).concat(_)})),t[m],r,a);return a}function lt(i){return i.trim().split(/ +/)}var tt=function(i,t){return Math.sqrt(i*i+t*t)},Ne=["webkit","moz"];function ct(i,t){i.__set||(i.__set={});var r=function(l){if(Ne.some((function(h){return l.indexOf(h)===0})))return 1;typeof i[l]!="function"&&l!=="__set"&&Object.defineProperty(i,l,{get:function(){return l in i.__set?i.__set[l]:i.__set[l]=t[l]},set:function(h){i.__set[l]=h},configurable:!0})};for(var a in t)r(a);return i}function dt(i,t){i.page=i.page||{},i.page.x=t.page.x,i.page.y=t.page.y,i.client=i.client||{},i.client.x=t.client.x,i.client.y=t.client.y,i.timeStamp=t.timeStamp}function Ce(i){i.page.x=0,i.page.y=0,i.client.x=0,i.client.y=0}function xt(i){return i instanceof Y.Event||i instanceof Y.Touch}function ot(i,t,r){return i=i||"page",(r=r||{}).x=t[i+"X"],r.y=t[i+"Y"],r}function ht(i,t){return t=t||{x:0,y:0},se.isOperaMobile&&xt(i)?(ot("screen",i,t),t.x+=window.scrollX,t.y+=window.scrollY):ot("page",i,t),t}function it(i){return b.number(i.pointerId)?i.pointerId:i.identifier}function j(i,t,r){var a=t.length>1?ye(t):t[0];ht(a,i.page),(function(l,h){h=h||{},se.isOperaMobile&&xt(l)?ot("screen",l,h):ot("client",l,h)})(a,i.client),i.timeStamp=r}function q(i){var t=[];return b.array(i)?(t[0]=i[0],t[1]=i[1]):i.type==="touchend"?i.touches.length===1?(t[0]=i.touches[0],t[1]=i.changedTouches[0]):i.touches.length===0&&(t[0]=i.changedTouches[0],t[1]=i.changedTouches[1]):(t[0]=i.touches[0],t[1]=i.touches[1]),t}function ye(i){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},r=0;r<i.length;r++){var a=i[r];for(var l in t)t[l]+=a[l]}for(var h in t)t[h]/=i.length;return t}function G(i){if(!i.length)return null;var t=q(i),r=Math.min(t[0].pageX,t[1].pageX),a=Math.min(t[0].pageY,t[1].pageY),l=Math.max(t[0].pageX,t[1].pageX),h=Math.max(t[0].pageY,t[1].pageY);return{x:r,y:a,left:r,top:a,right:l,bottom:h,width:l-r,height:h-a}}function J(i,t){var r=t+"X",a=t+"Y",l=q(i),h=l[0][r]-l[1][r],f=l[0][a]-l[1][a];return tt(h,f)}function ue(i,t){var r=t+"X",a=t+"Y",l=q(i),h=l[1][r]-l[0][r],f=l[1][a]-l[0][a];return 180*Math.atan2(f,h)/Math.PI}function ke(i){return b.string(i.pointerType)?i.pointerType:b.number(i.pointerType)?[void 0,void 0,"touch","pen","mouse"][i.pointerType]:/touch/.test(i.type||"")||i instanceof Y.Touch?"touch":"mouse"}function Z(i){var t=b.func(i.composedPath)?i.composedPath():i.path;return[We(t?t[0]:i.target),We(i.currentTarget)]}var Se=(function(){function i(t){o(this,i),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return u(i,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),i})();Object.defineProperty(Se.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var Oe=function(i,t){for(var r=0;r<t.length;r++){var a=t[r];i.push(a)}return i},Ve=function(i){return Oe([],i)},_e=function(i,t){for(var r=0;r<i.length;r++)if(t(i[r],r,i))return r;return-1},Xe=function(i,t){return i[_e(i,t)]},Ze=(function(i){d(r,i);var t=v(r);function r(a,l,h){var f;o(this,r),(f=t.call(this,l._interaction)).dropzone=void 0,f.dragEvent=void 0,f.relatedTarget=void 0,f.draggable=void 0,f.propagationStopped=!1,f.immediatePropagationStopped=!1;var m=h==="dragleave"?a.prev:a.cur,_=m.element,C=m.dropzone;return f.type=h,f.target=_,f.currentTarget=_,f.dropzone=C,f.dragEvent=l,f.relatedTarget=l.target,f.draggable=l.interactable,f.timeStamp=l.timeStamp,f}return u(r,[{key:"reject",value:function(){var a=this,l=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&l.cur.dropzone===this.dropzone&&l.cur.element===this.target)if(l.prev.dropzone=this.dropzone,l.prev.element=this.target,l.rejected=!0,l.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var h=l.activeDrops,f=_e(h,(function(_){var C=_.dropzone,w=_.element;return C===a.dropzone&&w===a.target}));l.activeDrops.splice(f,1);var m=new r(l,this.dragEvent,"dropdeactivate");m.dropzone=this.dropzone,m.target=this.target,this.dropzone.fire(m)}else this.dropzone.fire(new r(l,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),r})(Se);function Dt(i,t){for(var r=0,a=i.slice();r<a.length;r++){var l=a[r],h=l.dropzone,f=l.element;t.dropzone=h,t.target=f,h.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function Et(i,t){for(var r=(function(h,f){for(var m=[],_=0,C=h.interactables.list;_<C.length;_++){var w=C[_];if(w.options.drop.enabled){var A=w.options.drop.accept;if(!(b.element(A)&&A!==f||b.string(A)&&!be(f,A)||b.func(A)&&!A({dropzone:w,draggableElement:f})))for(var L=0,N=w.getAllElements();L<N.length;L++){var B=N[L];B!==f&&m.push({dropzone:w,element:B,rect:w.getRect(B)})}}}return m})(i,t),a=0;a<r.length;a++){var l=r[a];l.rect=l.dropzone.getRect(l.element)}return r}function Ft(i,t,r){for(var a=i.dropState,l=i.interactable,h=i.element,f=[],m=0,_=a.activeDrops;m<_.length;m++){var C=_[m],w=C.dropzone,A=C.element,L=C.rect,N=w.dropCheck(t,r,l,h,A,L);f.push(N?A:null)}var B=(function(H){for(var V,$,ie,le=[],he=0;he<H.length;he++){var re=H[he],ce=H[V];if(re&&he!==V)if(ce){var Ye=me(re),Ee=me(ce);if(Ye!==re.ownerDocument)if(Ee!==re.ownerDocument)if(Ye!==Ee){le=le.length?le:ae(ce);var et=void 0;if(ce instanceof Y.HTMLElement&&re instanceof Y.SVGElement&&!(re instanceof Y.SVGSVGElement)){if(re===Ee)continue;et=re.ownerSVGElement}else et=re;for(var rt=ae(et,ce.ownerDocument),ut=0;rt[ut]&&rt[ut]===le[ut];)ut++;var ri=[rt[ut-1],rt[ut],le[ut]];if(ri[0])for(var Kt=ri[0].lastChild;Kt;){if(Kt===ri[1]){V=he,le=rt;break}if(Kt===ri[2])break;Kt=Kt.previousSibling}}else ie=ce,(parseInt(k($=re).getComputedStyle($).zIndex,10)||0)>=(parseInt(k(ie).getComputedStyle(ie).zIndex,10)||0)&&(V=he);else V=he}else V=he}return V})(f);return a.activeDrops[B]||null}function At(i,t,r){var a=i.dropState,l={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return r.type==="dragstart"&&(l.activate=new Ze(a,r,"dropactivate"),l.activate.target=null,l.activate.dropzone=null),r.type==="dragend"&&(l.deactivate=new Ze(a,r,"dropdeactivate"),l.deactivate.target=null,l.deactivate.dropzone=null),a.rejected||(a.cur.element!==a.prev.element&&(a.prev.dropzone&&(l.leave=new Ze(a,r,"dragleave"),r.dragLeave=l.leave.target=a.prev.element,r.prevDropzone=l.leave.dropzone=a.prev.dropzone),a.cur.dropzone&&(l.enter=new Ze(a,r,"dragenter"),r.dragEnter=a.cur.element,r.dropzone=a.cur.dropzone)),r.type==="dragend"&&a.cur.dropzone&&(l.drop=new Ze(a,r,"drop"),r.dropzone=a.cur.dropzone,r.relatedTarget=a.cur.element),r.type==="dragmove"&&a.cur.dropzone&&(l.move=new Ze(a,r,"dropmove"),r.dropzone=a.cur.dropzone)),l}function Ot(i,t){var r=i.dropState,a=r.activeDrops,l=r.cur,h=r.prev;t.leave&&h.dropzone.fire(t.leave),t.enter&&l.dropzone.fire(t.enter),t.move&&l.dropzone.fire(t.move),t.drop&&l.dropzone.fire(t.drop),t.deactivate&&Dt(a,t.deactivate),r.prev.dropzone=l.dropzone,r.prev.element=l.element}function ve(i,t){var r=i.interaction,a=i.iEvent,l=i.event;if(a.type==="dragmove"||a.type==="dragend"){var h=r.dropState;t.dynamicDrop&&(h.activeDrops=Et(t,r.element));var f=a,m=Ft(r,f,l);h.rejected=h.rejected&&!!m&&m.dropzone===h.cur.dropzone&&m.element===h.cur.element,h.cur.dropzone=m&&m.dropzone,h.cur.element=m&&m.element,h.events=At(r,0,f)}}var de={id:"actions/drop",install:function(i){var t=i.actions,r=i.interactStatic,a=i.Interactable,l=i.defaults;i.usePlugin(R),a.prototype.dropzone=function(h){return(function(f,m){if(b.object(m)){if(f.options.drop.enabled=m.enabled!==!1,m.listeners){var _=Ue(m.listeners),C=Object.keys(_).reduce((function(A,L){return A[/^(enter|leave)/.test(L)?"drag".concat(L):/^(activate|deactivate|move)/.test(L)?"drop".concat(L):L]=_[L],A}),{}),w=f.options.drop.listeners;w&&f.off(w),f.on(C),f.options.drop.listeners=C}return b.func(m.ondrop)&&f.on("drop",m.ondrop),b.func(m.ondropactivate)&&f.on("dropactivate",m.ondropactivate),b.func(m.ondropdeactivate)&&f.on("dropdeactivate",m.ondropdeactivate),b.func(m.ondragenter)&&f.on("dragenter",m.ondragenter),b.func(m.ondragleave)&&f.on("dragleave",m.ondragleave),b.func(m.ondropmove)&&f.on("dropmove",m.ondropmove),/^(pointer|center)$/.test(m.overlap)?f.options.drop.overlap=m.overlap:b.number(m.overlap)&&(f.options.drop.overlap=Math.max(Math.min(1,m.overlap),0)),"accept"in m&&(f.options.drop.accept=m.accept),"checker"in m&&(f.options.drop.checker=m.checker),f}return b.bool(m)?(f.options.drop.enabled=m,f):f.options.drop})(this,h)},a.prototype.dropCheck=function(h,f,m,_,C,w){return(function(A,L,N,B,H,V,$){var ie=!1;if(!($=$||A.getRect(V)))return!!A.options.drop.checker&&A.options.drop.checker(L,N,ie,A,V,B,H);var le=A.options.drop.overlap;if(le==="pointer"){var he=Fe(B,H,"drag"),re=ht(L);re.x+=he.x,re.y+=he.y;var ce=re.x>$.left&&re.x<$.right,Ye=re.y>$.top&&re.y<$.bottom;ie=ce&&Ye}var Ee=B.getRect(H);if(Ee&&le==="center"){var et=Ee.left+Ee.width/2,rt=Ee.top+Ee.height/2;ie=et>=$.left&&et<=$.right&&rt>=$.top&&rt<=$.bottom}return Ee&&b.number(le)&&(ie=Math.max(0,Math.min($.right,Ee.right)-Math.max($.left,Ee.left))*Math.max(0,Math.min($.bottom,Ee.bottom)-Math.max($.top,Ee.top))/(Ee.width*Ee.height)>=le),A.options.drop.checker&&(ie=A.options.drop.checker(L,N,ie,A,V,B,H)),ie})(this,h,f,m,_,C,w)},r.dynamicDrop=function(h){return b.bool(h)?(i.dynamicDrop=h,r):i.dynamicDrop},X(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",i.dynamicDrop=!1,l.actions.drop=de.defaults},listeners:{"interactions:before-action-start":function(i){var t=i.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(i,t){var r=i.interaction,a=(i.event,i.iEvent);if(r.prepared.name==="drag"){var l=r.dropState;l.activeDrops=[],l.events={},l.activeDrops=Et(t,r.element),l.events=At(r,0,a),l.events.activate&&(Dt(l.activeDrops,l.events.activate),t.fire("actions/drop:start",{interaction:r,dragEvent:a}))}},"interactions:action-move":ve,"interactions:after-action-move":function(i,t){var r=i.interaction,a=i.iEvent;if(r.prepared.name==="drag"){var l=r.dropState;Ot(r,l.events),t.fire("actions/drop:move",{interaction:r,dragEvent:a}),l.events={}}},"interactions:action-end":function(i,t){if(i.interaction.prepared.name==="drag"){var r=i.interaction,a=i.iEvent;ve(i,t),Ot(r,r.dropState.events),t.fire("actions/drop:end",{interaction:r,dragEvent:a})}},"interactions:stop":function(i){var t=i.interaction;if(t.prepared.name==="drag"){var r=t.dropState;r&&(r.activeDrops=null,r.events=null,r.cur.dropzone=null,r.cur.element=null,r.prev.dropzone=null,r.prev.element=null,r.rejected=!1)}}},getActiveDrops:Et,getDrop:Ft,getDropEvents:At,fireDropEvents:Ot,filterEventType:function(i){return i.search("drag")===0||i.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},Te=de;function He(i){var t=i.interaction,r=i.iEvent,a=i.phase;if(t.prepared.name==="gesture"){var l=t.pointers.map((function(C){return C.pointer})),h=a==="start",f=a==="end",m=t.interactable.options.deltaSource;if(r.touches=[l[0],l[1]],h)r.distance=J(l,m),r.box=G(l),r.scale=1,r.ds=0,r.angle=ue(l,m),r.da=0,t.gesture.startDistance=r.distance,t.gesture.startAngle=r.angle;else if(f||t.pointers.length<2){var _=t.prevEvent;r.distance=_.distance,r.box=_.box,r.scale=_.scale,r.ds=0,r.angle=_.angle,r.da=0}else r.distance=J(l,m),r.box=G(l),r.scale=r.distance/t.gesture.startDistance,r.angle=ue(l,m),r.ds=r.scale-t.gesture.scale,r.da=r.angle-t.gesture.angle;t.gesture.distance=r.distance,t.gesture.angle=r.angle,b.number(r.scale)&&r.scale!==1/0&&!isNaN(r.scale)&&(t.gesture.scale=r.scale)}}var je={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(i){var t=i.actions,r=i.Interactable,a=i.defaults;r.prototype.gesturable=function(l){return b.object(l)?(this.options.gesture.enabled=l.enabled!==!1,this.setPerAction("gesture",l),this.setOnEvents("gesture",l),this):b.bool(l)?(this.options.gesture.enabled=l,this):this.options.gesture},t.map.gesture=je,t.methodDict.gesture="gesturable",a.actions.gesture=je.defaults},listeners:{"interactions:action-start":He,"interactions:action-move":He,"interactions:action-end":He,"interactions:new":function(i){i.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(i){if(!(i.interaction.pointers.length<2)){var t=i.interactable.options.gesture;if(t&&t.enabled)return i.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(i){return i.search("gesture")===0}},Tt=je;function Rt(i,t,r,a,l,h,f){if(!t)return!1;if(t===!0){var m=b.number(h.width)?h.width:h.right-h.left,_=b.number(h.height)?h.height:h.bottom-h.top;if(f=Math.min(f,Math.abs((i==="left"||i==="right"?m:_)/2)),m<0&&(i==="left"?i="right":i==="right"&&(i="left")),_<0&&(i==="top"?i="bottom":i==="bottom"&&(i="top")),i==="left"){var C=m>=0?h.left:h.right;return r.x<C+f}if(i==="top"){var w=_>=0?h.top:h.bottom;return r.y<w+f}if(i==="right")return r.x>(m>=0?h.right:h.left)-f;if(i==="bottom")return r.y>(_>=0?h.bottom:h.top)-f}return!!b.element(a)&&(b.element(t)?t===a:Je(a,t,l))}function at(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="resize"&&r.resizeAxes){var a=t;r.interactable.options.resize.square?(r.resizeAxes==="y"?a.delta.x=a.delta.y:a.delta.y=a.delta.x,a.axes="xy"):(a.axes=r.resizeAxes,r.resizeAxes==="x"?a.delta.y=0:r.resizeAxes==="y"&&(a.delta.x=0))}}var Le,nt,qe={id:"actions/resize",before:["actions/drag"],install:function(i){var t=i.actions,r=i.browser,a=i.Interactable,l=i.defaults;qe.cursors=(function(h){return h.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(r),qe.defaultMargin=r.supportsTouch||r.supportsPointerEvent?20:10,a.prototype.resizable=function(h){return(function(f,m,_){return b.object(m)?(f.options.resize.enabled=m.enabled!==!1,f.setPerAction("resize",m),f.setOnEvents("resize",m),b.string(m.axis)&&/^x$|^y$|^xy$/.test(m.axis)?f.options.resize.axis=m.axis:m.axis===null&&(f.options.resize.axis=_.defaults.actions.resize.axis),b.bool(m.preserveAspectRatio)?f.options.resize.preserveAspectRatio=m.preserveAspectRatio:b.bool(m.square)&&(f.options.resize.square=m.square),f):b.bool(m)?(f.options.resize.enabled=m,f):f.options.resize})(this,h,i)},t.map.resize=qe,t.methodDict.resize="resizable",l.actions.resize=qe.defaults},listeners:{"interactions:new":function(i){i.interaction.resizeAxes="xy"},"interactions:action-start":function(i){(function(t){var r=t.iEvent,a=t.interaction;if(a.prepared.name==="resize"&&a.prepared.edges){var l=r,h=a.rect;a._rects={start:X({},h),corrected:X({},h),previous:X({},h),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},l.edges=a.prepared.edges,l.rect=a._rects.corrected,l.deltaRect=a._rects.delta}})(i),at(i)},"interactions:action-move":function(i){(function(t){var r=t.iEvent,a=t.interaction;if(a.prepared.name==="resize"&&a.prepared.edges){var l=r,h=a.interactable.options.resize.invert,f=h==="reposition"||h==="negate",m=a.rect,_=a._rects,C=_.start,w=_.corrected,A=_.delta,L=_.previous;if(X(L,w),f){if(X(w,m),h==="reposition"){if(w.top>w.bottom){var N=w.top;w.top=w.bottom,w.bottom=N}if(w.left>w.right){var B=w.left;w.left=w.right,w.right=B}}}else w.top=Math.min(m.top,C.bottom),w.bottom=Math.max(m.bottom,C.top),w.left=Math.min(m.left,C.right),w.right=Math.max(m.right,C.left);for(var H in w.width=w.right-w.left,w.height=w.bottom-w.top,w)A[H]=w[H]-L[H];l.edges=a.prepared.edges,l.rect=w,l.deltaRect=A}})(i),at(i)},"interactions:action-end":function(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="resize"&&r.prepared.edges){var a=t;a.edges=r.prepared.edges,a.rect=r._rects.corrected,a.deltaRect=r._rects.delta}},"auto-start:check":function(i){var t=i.interaction,r=i.interactable,a=i.element,l=i.rect,h=i.buttons;if(l){var f=X({},t.coords.cur.page),m=r.options.resize;if(m&&m.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(h&m.mouseButtons)!=0)){if(b.object(m.edges)){var _={left:!1,right:!1,top:!1,bottom:!1};for(var C in _)_[C]=Rt(C,m.edges[C],f,t._latestPointer.eventTarget,a,l,m.margin||qe.defaultMargin);_.left=_.left&&!_.right,_.top=_.top&&!_.bottom,(_.left||_.right||_.top||_.bottom)&&(i.action={name:"resize",edges:_})}else{var w=m.axis!=="y"&&f.x>l.right-qe.defaultMargin,A=m.axis!=="x"&&f.y>l.bottom-qe.defaultMargin;(w||A)&&(i.action={name:"resize",axes:(w?"x":"")+(A?"y":"")})}return!i.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(i){var t=i.edges,r=i.axis,a=i.name,l=qe.cursors,h=null;if(r)h=l[a+r];else if(t){for(var f="",m=0,_=["top","bottom","left","right"];m<_.length;m++){var C=_[m];t[C]&&(f+=C)}h=l[f]}return h},filterEventType:function(i){return i.search("resize")===0},defaultMargin:null},Xt=qe,ft={id:"actions",install:function(i){i.usePlugin(Tt),i.usePlugin(Xt),i.usePlugin(R),i.usePlugin(Te)}},qi=0,gt={request:function(i){return Le(i)},cancel:function(i){return nt(i)},init:function(i){if(Le=i.requestAnimationFrame,nt=i.cancelAnimationFrame,!Le)for(var t=["ms","moz","webkit","o"],r=0;r<t.length;r++){var a=t[r];Le=i["".concat(a,"RequestAnimationFrame")],nt=i["".concat(a,"CancelAnimationFrame")]||i["".concat(a,"CancelRequestAnimationFrame")]}Le=Le&&Le.bind(i),nt=nt&&nt.bind(i),Le||(Le=function(l){var h=Date.now(),f=Math.max(0,16-(h-qi)),m=i.setTimeout((function(){l(h+f)}),f);return qi=h+f,m},nt=function(l){return clearTimeout(l)})}},oe={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(i){oe.isScrolling=!0,gt.cancel(oe.i),i.autoScroll=oe,oe.interaction=i,oe.prevTime=oe.now(),oe.i=gt.request(oe.scroll)},stop:function(){oe.isScrolling=!1,oe.interaction&&(oe.interaction.autoScroll=null),gt.cancel(oe.i)},scroll:function(){var i=oe.interaction,t=i.interactable,r=i.element,a=i.prepared.name,l=t.options[a].autoScroll,h=Ki(l.container,t,r),f=oe.now(),m=(f-oe.prevTime)/1e3,_=l.speed*m;if(_>=1){var C={x:oe.x*_,y:oe.y*_};if(C.x||C.y){var w=Yi(h);b.window(h)?h.scrollBy(C.x,C.y):h&&(h.scrollLeft+=C.x,h.scrollTop+=C.y);var A=Yi(h),L={x:A.x-w.x,y:A.y-w.y};(L.x||L.y)&&t.fire({type:"autoscroll",target:r,interactable:t,delta:L,interaction:i,container:h})}oe.prevTime=f}oe.isScrolling&&(gt.cancel(oe.i),oe.i=gt.request(oe.scroll))},check:function(i,t){var r;return(r=i.options[t].autoScroll)==null?void 0:r.enabled},onInteractionMove:function(i){var t=i.interaction,r=i.pointer;if(t.interacting()&&oe.check(t.interactable,t.prepared.name))if(t.simulation)oe.x=oe.y=0;else{var a,l,h,f,m=t.interactable,_=t.element,C=t.prepared.name,w=m.options[C].autoScroll,A=Ki(w.container,m,_);if(b.window(A))f=r.clientX<oe.margin,a=r.clientY<oe.margin,l=r.clientX>A.innerWidth-oe.margin,h=r.clientY>A.innerHeight-oe.margin;else{var L=ze(A);f=r.clientX<L.left+oe.margin,a=r.clientY<L.top+oe.margin,l=r.clientX>L.right-oe.margin,h=r.clientY>L.bottom-oe.margin}oe.x=l?1:f?-1:0,oe.y=h?1:a?-1:0,oe.isScrolling||(oe.margin=w.margin,oe.speed=w.speed,oe.start(t))}}};function Ki(i,t,r){return(b.string(i)?te(i,t,r):i)||k(r)}function Yi(i){return b.window(i)&&(i=window.document.body),{x:i.scrollLeft,y:i.scrollTop}}var Cr={id:"auto-scroll",install:function(i){var t=i.defaults,r=i.actions;i.autoScroll=oe,oe.now=function(){return i.now()},r.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=oe.defaults},listeners:{"interactions:new":function(i){i.interaction.autoScroll=null},"interactions:destroy":function(i){i.interaction.autoScroll=null,oe.stop(),oe.interaction&&(oe.interaction=null)},"interactions:stop":oe.stop,"interactions:action-move":function(i){return oe.onInteractionMove(i)}}},Er=Cr;function Bt(i,t){var r=!1;return function(){return r||(P.console.warn(t),r=!0),i.apply(this,arguments)}}function ui(i,t){return i.name=t.name,i.axis=t.axis,i.edges=t.edges,i}function Ar(i){return b.bool(i)?(this.options.styleCursor=i,this):i===null?(delete this.options.styleCursor,this):this.options.styleCursor}function Or(i){return b.func(i)?(this.options.actionChecker=i,this):i===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Tr={id:"auto-start/interactableMethods",install:function(i){var t=i.Interactable;t.prototype.getAction=function(r,a,l,h){var f=(function(m,_,C,w,A){var L=m.getRect(w),N=_.buttons||{0:1,1:4,3:8,4:16}[_.button],B={action:null,interactable:m,interaction:C,element:w,rect:L,buttons:N};return A.fire("auto-start:check",B),B.action})(this,a,l,h,i);return this.options.actionChecker?this.options.actionChecker(r,a,f,this,h,l):f},t.prototype.ignoreFrom=Bt((function(r){return this._backCompatOption("ignoreFrom",r)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=Bt((function(r){return this._backCompatOption("allowFrom",r)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Or,t.prototype.styleCursor=Ar}};function $i(i,t,r,a,l){return t.testIgnoreAllow(t.options[i.name],r,a)&&t.options[i.name].enabled&&Gt(t,r,i,l)?i:null}function Mr(i,t,r,a,l,h,f){for(var m=0,_=a.length;m<_;m++){var C=a[m],w=l[m],A=C.getAction(t,r,i,w);if(A){var L=$i(A,C,w,h,f);if(L)return{action:L,interactable:C,element:w}}}return{action:null,interactable:null,element:null}}function Wi(i,t,r,a,l){var h=[],f=[],m=a;function _(w){h.push(w),f.push(m)}for(;b.element(m);){h=[],f=[],l.interactables.forEachMatch(m,_);var C=Mr(i,t,r,h,f,a,l);if(C.action&&!C.interactable.options[C.action.name].manualStart)return C;m=xe(m)}return{action:null,interactable:null,element:null}}function Ui(i,t,r){var a=t.action,l=t.interactable,h=t.element;a=a||{name:null},i.interactable=l,i.element=h,ui(i.prepared,a),i.rect=l&&a.name?l.getRect(h):null,Xi(i,r),r.fire("autoStart:prepared",{interaction:i})}function Gt(i,t,r,a){var l=i.options,h=l[r.name].max,f=l[r.name].maxPerElement,m=a.autoStart.maxInteractions,_=0,C=0,w=0;if(!(h&&f&&m))return!1;for(var A=0,L=a.interactions.list;A<L.length;A++){var N=L[A],B=N.prepared.name;if(N.interacting()&&(++_>=m||N.interactable===i&&((C+=B===r.name?1:0)>=h||N.element===t&&(w++,B===r.name&&w>=f))))return!1}return m>0}function Vi(i,t){return b.number(i)?(t.autoStart.maxInteractions=i,this):t.autoStart.maxInteractions}function pi(i,t,r){var a=r.autoStart.cursorElement;a&&a!==i&&(a.style.cursor=""),i.ownerDocument.documentElement.style.cursor=t,i.style.cursor=t,r.autoStart.cursorElement=t?i:null}function Xi(i,t){var r=i.interactable,a=i.element,l=i.prepared;if(i.pointerType==="mouse"&&r&&r.options.styleCursor){var h="";if(l.name){var f=r.options[l.name].cursorChecker;h=b.func(f)?f(l,r,a,i._interacting):t.actions.map[l.name].getCursor(l)}pi(i.element,h||"",t)}else t.autoStart.cursorElement&&pi(t.autoStart.cursorElement,"",t)}var Pr={id:"auto-start/base",before:["actions"],install:function(i){var t=i.interactStatic,r=i.defaults;i.usePlugin(Tr),r.base.actionChecker=null,r.base.styleCursor=!0,X(r.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(a){return Vi(a,i)},i.autoStart={maxInteractions:1/0,withinInteractionLimit:Gt,cursorElement:null}},listeners:{"interactions:down":function(i,t){var r=i.interaction,a=i.pointer,l=i.event,h=i.eventTarget;r.interacting()||Ui(r,Wi(r,a,l,h,t),t)},"interactions:move":function(i,t){(function(r,a){var l=r.interaction,h=r.pointer,f=r.event,m=r.eventTarget;l.pointerType!=="mouse"||l.pointerIsDown||l.interacting()||Ui(l,Wi(l,h,f,m,a),a)})(i,t),(function(r,a){var l=r.interaction;if(l.pointerIsDown&&!l.interacting()&&l.pointerWasMoved&&l.prepared.name){a.fire("autoStart:before-start",r);var h=l.interactable,f=l.prepared.name;f&&h&&(h.options[f].manualStart||!Gt(h,l.element,l.prepared,a)?l.stop():(l.start(l.prepared,h,l.element),Xi(l,a)))}})(i,t)},"interactions:stop":function(i,t){var r=i.interaction,a=r.interactable;a&&a.options.styleCursor&&pi(r.element,"",t)}},maxInteractions:Vi,withinInteractionLimit:Gt,validateAction:$i},hi=Pr,Ir={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(i,t){var r=i.interaction,a=i.eventTarget,l=i.dx,h=i.dy;if(r.prepared.name==="drag"){var f=Math.abs(l),m=Math.abs(h),_=r.interactable.options.drag,C=_.startAxis,w=f>m?"x":f<m?"y":"xy";if(r.prepared.axis=_.lockAxis==="start"?w[0]:_.lockAxis,w!=="xy"&&C!=="xy"&&C!==w){r.prepared.name=null;for(var A=a,L=function(B){if(B!==r.interactable){var H=r.interactable.options.drag;if(!H.manualStart&&B.testIgnoreAllow(H,A,a)){var V=B.getAction(r.downPointer,r.downEvent,r,A);if(V&&V.name==="drag"&&(function($,ie){if(!ie)return!1;var le=ie.options.drag.startAxis;return $==="xy"||le==="xy"||le===$})(w,B)&&hi.validateAction(V,B,A,a,t))return B}}};b.element(A);){var N=t.interactables.forEachMatch(A,L);if(N){r.prepared.name="drag",r.interactable=N,r.element=A;break}A=xe(A)}}}}}};function fi(i){var t=i.prepared&&i.prepared.name;if(!t)return null;var r=i.interactable.options;return r[t].hold||r[t].delay}var zr={id:"auto-start/hold",install:function(i){var t=i.defaults;i.usePlugin(hi),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(i){i.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(i){var t=i.interaction,r=fi(t);r>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),r))},"interactions:move":function(i){var t=i.interaction,r=i.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!r&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(i){var t=i.interaction;fi(t)>0&&(t.prepared.name=null)}},getHoldDuration:fi},Lr=zr,Dr={id:"auto-start",install:function(i){i.usePlugin(hi),i.usePlugin(Lr),i.usePlugin(Ir)}},Fr=function(i){return/^(always|never|auto)$/.test(i)?(this.options.preventDefault=i,this):b.bool(i)?(this.options.preventDefault=i?"always":"never",this):this.options.preventDefault};function Rr(i){var t=i.interaction,r=i.event;t.interactable&&t.interactable.checkAndPreventDefault(r)}var Gi={id:"core/interactablePreventDefault",install:function(i){var t=i.Interactable;t.prototype.preventDefault=Fr,t.prototype.checkAndPreventDefault=function(r){return(function(a,l,h){var f=a.options.preventDefault;if(f!=="never")if(f!=="always"){if(l.events.supportsPassive&&/^touch(start|move)$/.test(h.type)){var m=k(h.target).document,_=l.getDocOptions(m);if(!_||!_.events||_.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(h.type)||b.element(h.target)&&be(h.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||h.preventDefault()}else h.preventDefault()})(this,i,r)},i.interactions.docEvents.push({type:"dragstart",listener:function(r){for(var a=0,l=i.interactions.list;a<l.length;a++){var h=l[a];if(h.element&&(h.element===r.target||pe(h.element,r.target)))return void h.interactable.checkAndPreventDefault(r)}}})},listeners:["down","move","up","cancel"].reduce((function(i,t){return i["interactions:".concat(t)]=Rr,i}),{})};function Jt(i,t){if(t.phaselessTypes[i])return!0;for(var r in t.map)if(i.indexOf(r)===0&&i.substr(r.length)in t.phases)return!0;return!1}function Mt(i){var t={};for(var r in i){var a=i[r];b.plainObject(a)?t[r]=Mt(a):b.array(a)?t[r]=Ve(a):t[r]=a}return t}var gi=(function(){function i(t){o(this,i),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=Qt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return u(i,[{key:"start",value:function(t,r){var a,l,h=t.phase,f=this.interaction,m=(function(C){var w=C.interactable.options[C.prepared.name],A=w.modifiers;return A&&A.length?A:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(L){var N=w[L];return N&&N.enabled&&{options:N,methods:N._methods}})).filter((function(L){return!!L}))})(f);this.prepareStates(m),this.startEdges=X({},f.edges),this.edges=X({},this.startEdges),this.startOffset=(a=f.rect,l=r,a?{left:l.x-a.left,top:l.y-a.top,right:a.right-l.x,bottom:a.bottom-l.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var _=this.fillArg({phase:h,pageCoords:r,preEnd:!1});return this.result=Qt(),this.startAll(_),this.result=this.setAll(_)}},{key:"fillArg",value:function(t){var r=this.interaction;return t.interaction=r,t.interactable=r.interactable,t.element=r.element,t.rect||(t.rect=r.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var r=0,a=this.states;r<a.length;r++){var l=a[r];l.methods.start&&(t.state=l,l.methods.start(t))}}},{key:"setAll",value:function(t){var r=t.phase,a=t.preEnd,l=t.skipModifiers,h=t.rect,f=t.edges;t.coords=X({},t.pageCoords),t.rect=X({},h),t.edges=X({},f);for(var m=l?this.states.slice(l):this.states,_=Qt(t.coords,t.rect),C=0;C<m.length;C++){var w,A=m[C],L=A.options,N=X({},t.coords),B=null;(w=A.methods)!=null&&w.set&&this.shouldDo(L,a,r)&&(t.state=A,B=A.methods.set(t),we(t.edges,t.rect,{x:t.coords.x-N.x,y:t.coords.y-N.y})),_.eventProps.push(B)}X(this.edges,t.edges),_.delta.x=t.coords.x-t.pageCoords.x,_.delta.y=t.coords.y-t.pageCoords.y,_.rectDelta.left=t.rect.left-h.left,_.rectDelta.right=t.rect.right-h.right,_.rectDelta.top=t.rect.top-h.top,_.rectDelta.bottom=t.rect.bottom-h.bottom;var H=this.result.coords,V=this.result.rect;if(H&&V){var $=_.rect.left!==V.left||_.rect.right!==V.right||_.rect.top!==V.top||_.rect.bottom!==V.bottom;_.changed=$||H.x!==_.coords.x||H.y!==_.coords.y}return _}},{key:"applyToInteraction",value:function(t){var r=this.interaction,a=t.phase,l=r.coords.cur,h=r.coords.start,f=this.result,m=this.startDelta,_=f.delta;a==="start"&&X(this.startDelta,f.delta);for(var C=0,w=[[h,m],[l,_]];C<w.length;C++){var A=w[C],L=A[0],N=A[1];L.page.x+=N.x,L.page.y+=N.y,L.client.x+=N.x,L.client.y+=N.y}var B=this.result.rectDelta,H=t.rect||r.rect;H.left+=B.left,H.right+=B.right,H.top+=B.top,H.bottom+=B.bottom,H.width=H.right-H.left,H.height=H.bottom-H.top}},{key:"setAndApply",value:function(t){var r=this.interaction,a=t.phase,l=t.preEnd,h=t.skipModifiers,f=this.setAll(this.fillArg({preEnd:l,phase:a,pageCoords:t.modifiedCoords||r.coords.cur.page}));if(this.result=f,!f.changed&&(!h||h<this.states.length)&&r.interacting())return!1;if(t.modifiedCoords){var m=r.coords.cur.page,_={x:t.modifiedCoords.x-m.x,y:t.modifiedCoords.y-m.y};f.coords.x+=_.x,f.coords.y+=_.y,f.delta.x+=_.x,f.delta.y+=_.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var r=t.interaction,a=t.event,l=this.states;if(l&&l.length){for(var h=!1,f=0;f<l.length;f++){var m=l[f];t.state=m;var _=m.options,C=m.methods,w=C.beforeEnd&&C.beforeEnd(t);if(w)return this.endResult=w,!1;h=h||!h&&this.shouldDo(_,!0,t.phase,!0)}h&&r.move({event:a,preEnd:!0})}}},{key:"stop",value:function(t){var r=t.interaction;if(this.states&&this.states.length){var a=X({states:this.states,interactable:r.interactable,element:r.element,rect:null},t);this.fillArg(a);for(var l=0,h=this.states;l<h.length;l++){var f=h[l];a.state=f,f.methods.stop&&f.methods.stop(a)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var r=0;r<t.length;r++){var a=t[r],l=a.options,h=a.methods,f=a.name;this.states.push({options:l,methods:h,index:r,name:f})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var r=t.interaction,a=r.coords,l=r.rect,h=r.modification;if(h.result){for(var f=h.startDelta,m=h.result,_=m.delta,C=m.rectDelta,w=0,A=[[a.start,f],[a.cur,_]];w<A.length;w++){var L=A[w],N=L[0],B=L[1];N.page.x-=B.x,N.page.y-=B.y,N.client.x-=B.x,N.client.y-=B.y}l.left-=C.left,l.right-=C.right,l.top-=C.top,l.bottom-=C.bottom}}},{key:"shouldDo",value:function(t,r,a,l){return!(!t||t.enabled===!1||l&&!t.endOnly||t.endOnly&&!r||a==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(r){return Mt(r)})),this.result=Qt(X({},t.result.coords),X({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),i})();function Qt(i,t){return{rect:t,coords:i,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function mt(i,t){var r=i.defaults,a={start:i.start,set:i.set,beforeEnd:i.beforeEnd,stop:i.stop},l=function(h){var f=h||{};for(var m in f.enabled=f.enabled!==!1,r)m in f||(f[m]=r[m]);var _={options:f,methods:a,name:t,enable:function(){return f.enabled=!0,_},disable:function(){return f.enabled=!1,_}};return _};return t&&typeof t=="string"&&(l._defaults=r,l._methods=a),l}function Nt(i){var t=i.iEvent,r=i.interaction.modification.result;r&&(t.modifiers=r.eventProps)}var Br={id:"modifiers/base",before:["actions"],install:function(i){i.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(i){var t=i.interaction;t.modification=new gi(t)},"interactions:before-action-start":function(i){var t=i.interaction,r=i.interaction.modification;r.start(i,t.coords.start.page),t.edges=r.edges,r.applyToInteraction(i)},"interactions:before-action-move":function(i){var t=i.interaction,r=t.modification,a=r.setAndApply(i);return t.edges=r.edges,a},"interactions:before-action-end":function(i){var t=i.interaction,r=t.modification,a=r.beforeEnd(i);return t.edges=r.startEdges,a},"interactions:action-start":Nt,"interactions:action-move":Nt,"interactions:action-end":Nt,"interactions:after-action-start":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-move":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:stop":function(i){return i.interaction.modification.stop(i)}}},Ji=Br,Qi={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},mi=(function(i){d(r,i);var t=v(r);function r(a,l,h,f,m,_,C){var w;o(this,r),(w=t.call(this,a)).relatedTarget=null,w.screenX=void 0,w.screenY=void 0,w.button=void 0,w.buttons=void 0,w.ctrlKey=void 0,w.shiftKey=void 0,w.altKey=void 0,w.metaKey=void 0,w.page=void 0,w.client=void 0,w.delta=void 0,w.rect=void 0,w.x0=void 0,w.y0=void 0,w.t0=void 0,w.dt=void 0,w.duration=void 0,w.clientX0=void 0,w.clientY0=void 0,w.velocity=void 0,w.speed=void 0,w.swipe=void 0,w.axes=void 0,w.preEnd=void 0,m=m||a.element;var A=a.interactable,L=(A&&A.options||Qi).deltaSource,N=Fe(A,m,h),B=f==="start",H=f==="end",V=B?y(w):a.prevEvent,$=B?a.coords.start:H?{page:V.page,client:V.client,timeStamp:a.coords.cur.timeStamp}:a.coords.cur;return w.page=X({},$.page),w.client=X({},$.client),w.rect=X({},a.rect),w.timeStamp=$.timeStamp,H||(w.page.x-=N.x,w.page.y-=N.y,w.client.x-=N.x,w.client.y-=N.y),w.ctrlKey=l.ctrlKey,w.altKey=l.altKey,w.shiftKey=l.shiftKey,w.metaKey=l.metaKey,w.button=l.button,w.buttons=l.buttons,w.target=m,w.currentTarget=m,w.preEnd=_,w.type=C||h+(f||""),w.interactable=A,w.t0=B?a.pointers[a.pointers.length-1].downTime:V.t0,w.x0=a.coords.start.page.x-N.x,w.y0=a.coords.start.page.y-N.y,w.clientX0=a.coords.start.client.x-N.x,w.clientY0=a.coords.start.client.y-N.y,w.delta=B||H?{x:0,y:0}:{x:w[L].x-V[L].x,y:w[L].y-V[L].y},w.dt=a.coords.delta.timeStamp,w.duration=w.timeStamp-w.t0,w.velocity=X({},a.coords.velocity[L]),w.speed=tt(w.velocity.x,w.velocity.y),w.swipe=H||f==="inertiastart"?w.getSwipe():null,w}return u(r,[{key:"getSwipe",value:function(){var a=this._interaction;if(a.prevEvent.speed<600||this.timeStamp-a.prevEvent.timeStamp>150)return null;var l=180*Math.atan2(a.prevEvent.velocityY,a.prevEvent.velocityX)/Math.PI;l<0&&(l+=360);var h=112.5<=l&&l<247.5,f=202.5<=l&&l<337.5;return{up:f,down:!f&&22.5<=l&&l<157.5,left:h,right:!h&&(292.5<=l||l<67.5),angle:l,speed:a.prevEvent.speed,velocity:{x:a.prevEvent.velocityX,y:a.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),r})(Se);Object.defineProperties(mi.prototype,{pageX:{get:function(){return this.page.x},set:function(i){this.page.x=i}},pageY:{get:function(){return this.page.y},set:function(i){this.page.y=i}},clientX:{get:function(){return this.client.x},set:function(i){this.client.x=i}},clientY:{get:function(){return this.client.y},set:function(i){this.client.y=i}},dx:{get:function(){return this.delta.x},set:function(i){this.delta.x=i}},dy:{get:function(){return this.delta.y},set:function(i){this.delta.y=i}},velocityX:{get:function(){return this.velocity.x},set:function(i){this.velocity.x=i}},velocityY:{get:function(){return this.velocity.y},set:function(i){this.velocity.y=i}}});var Nr=u((function i(t,r,a,l,h){o(this,i),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=r,this.event=a,this.downTime=l,this.downTarget=h})),Hr=(function(i){return i.interactable="",i.element="",i.prepared="",i.pointerIsDown="",i.pointerWasMoved="",i._proxy="",i})({}),Zi=(function(i){return i.start="",i.move="",i.end="",i.stop="",i.interacting="",i})({}),jr=0,qr=(function(){function i(t){var r=this,a=t.pointerType,l=t.scopeFire;o(this,i),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Bt((function(w){this.move(w)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=jr++,this._scopeFire=l,this.pointerType=a;var h=this;this._proxy={};var f=function(w){Object.defineProperty(r._proxy,w,{get:function(){return h[w]}})};for(var m in Hr)f(m);var _=function(w){Object.defineProperty(r._proxy,w,{value:function(){return h[w].apply(h,arguments)}})};for(var C in Zi)_(C);this._scopeFire("interactions:new",{interaction:this})}return u(i,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,r,a){var l=this.updatePointer(t,r,a,!0),h=this.pointers[l];this._scopeFire("interactions:down",{pointer:t,event:r,eventTarget:a,pointerIndex:l,pointerInfo:h,type:"down",interaction:this})}},{key:"start",value:function(t,r,a){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!r.options[t.name].enabled)&&(ui(this.prepared,t),this.interactable=r,this.element=a,this.rect=r.getRect(a),this.edges=this.prepared.edges?X({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,r,a){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,r,a,!1);var l,h,f=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(l=this.coords.cur.client.x-this.coords.start.client.x,h=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=tt(l,h)>this.pointerMoveTolerance);var m,_,C,w=this.getPointerIndex(t),A={pointer:t,pointerIndex:w,pointerInfo:this.pointers[w],event:r,type:"move",eventTarget:a,dx:l,dy:h,duplicate:f,interaction:this};f||(m=this.coords.velocity,_=this.coords.delta,C=Math.max(_.timeStamp/1e3,.001),m.page.x=_.page.x/C,m.page.y=_.page.y/C,m.client.x=_.client.x/C,m.client.y=_.client.y/C,m.timeStamp=C),this._scopeFire("interactions:move",A),f||this.simulation||(this.interacting()&&(A.type=null,this.move(A)),this.pointerWasMoved&&dt(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||Ce(this.coords.delta),(t=X({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,r,a,l){var h=this.getPointerIndex(t);h===-1&&(h=this.updatePointer(t,r,a,!1));var f=/cancel$/i.test(r.type)?"cancel":"up";this._scopeFire("interactions:".concat(f),{pointer:t,pointerIndex:h,pointerInfo:this.pointers[h],event:r,eventTarget:a,type:f,curEventTarget:l,interaction:this}),this.simulation||this.end(r),this.removePointer(t,r)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var r;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(r=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,r===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var r=it(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:_e(this.pointers,(function(a){return a.id===r}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,r,a,l){var h,f,m,_=it(t),C=this.getPointerIndex(t),w=this.pointers[C];return l=l!==!1&&(l||/(down|start)$/i.test(r.type)),w?w.pointer=t:(w=new Nr(_,t,r,null,null),C=this.pointers.length,this.pointers.push(w)),j(this.coords.cur,this.pointers.map((function(A){return A.pointer})),this._now()),h=this.coords.delta,f=this.coords.prev,m=this.coords.cur,h.page.x=m.page.x-f.page.x,h.page.y=m.page.y-f.page.y,h.client.x=m.client.x-f.client.x,h.client.y=m.client.y-f.client.y,h.timeStamp=m.timeStamp-f.timeStamp,l&&(this.pointerIsDown=!0,w.downTime=this.coords.cur.timeStamp,w.downTarget=a,ct(this.downPointer,t),this.interacting()||(dt(this.coords.start,this.coords.cur),dt(this.coords.prev,this.coords.cur),this.downEvent=r,this.pointerWasMoved=!1)),this._updateLatestPointer(t,r,a),this._scopeFire("interactions:update-pointer",{pointer:t,event:r,eventTarget:a,down:l,pointerInfo:w,pointerIndex:C,interaction:this}),C}},{key:"removePointer",value:function(t,r){var a=this.getPointerIndex(t);if(a!==-1){var l=this.pointers[a];this._scopeFire("interactions:remove-pointer",{pointer:t,event:r,eventTarget:null,pointerIndex:a,pointerInfo:l,interaction:this}),this.pointers.splice(a,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,r,a){this._latestPointer.pointer=t,this._latestPointer.event=r,this._latestPointer.eventTarget=a}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,r,a,l){return new mi(this,t,this.prepared.name,r,this.element,a,l)}},{key:"_fireEvent",value:function(t){var r;(r=this.interactable)==null||r.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var r=t.event,a=t.phase,l=t.preEnd,h=t.type,f=this.rect;if(f&&a==="move"&&(we(this.edges,f,this.coords.delta[this.interactable.options.deltaSource]),f.width=f.right-f.left,f.height=f.bottom-f.top),this._scopeFire("interactions:before-action-".concat(a),t)===!1)return!1;var m=t.iEvent=this._createPreparedEvent(r,a,l,h);return this._scopeFire("interactions:action-".concat(a),t),a==="start"&&(this.prevEvent=m),this._fireEvent(m),this._scopeFire("interactions:after-action-".concat(a),t),!0}},{key:"_now",value:function(){return Date.now()}}]),i})();function en(i){tn(i.interaction)}function tn(i){if(!(function(r){return!(!r.offset.pending.x&&!r.offset.pending.y)})(i))return!1;var t=i.offset.pending;return yi(i.coords.cur,t),yi(i.coords.delta,t),we(i.edges,i.rect,t),t.x=0,t.y=0,!0}function Kr(i){var t=i.x,r=i.y;this.offset.pending.x+=t,this.offset.pending.y+=r,this.offset.total.x+=t,this.offset.total.y+=r}function yi(i,t){var r=i.page,a=i.client,l=t.x,h=t.y;r.x+=l,r.y+=h,a.x+=l,a.y+=h}Zi.offsetBy="";var Yr={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(i){i.Interaction.prototype.offsetBy=Kr},listeners:{"interactions:new":function(i){i.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(i){return(function(t){t.pointerIsDown&&(yi(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(i.interaction)},"interactions:before-action-start":en,"interactions:before-action-move":en,"interactions:before-action-end":function(i){var t=i.interaction;if(tn(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(i){var t=i.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},nn=Yr,$r=(function(){function i(t){o(this,i),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return u(i,[{key:"start",value:function(t){var r=this.interaction,a=Zt(r);if(!a||!a.enabled)return!1;var l=r.coords.velocity.client,h=tt(l.x,l.y),f=this.modification||(this.modification=new gi(r));if(f.copyFrom(r.modification),this.t0=r._now(),this.allowResume=a.allowResume,this.v0=h,this.currentOffset={x:0,y:0},this.startCoords=r.coords.cur.page,this.modifierArg=f.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-r.coords.cur.timeStamp<50&&h>a.minSpeed&&h>a.endSpeed)this.startInertia();else{if(f.result=f.setAll(this.modifierArg),!f.result.changed)return!1;this.startSmoothEnd()}return r.modification.result.rect=null,r.offsetBy(this.targetOffset),r._doPhase({interaction:r,event:t,phase:"inertiastart"}),r.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),r.modification.result.rect=null,this.active=!0,r.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,r=this.interaction.coords.velocity.client,a=Zt(this.interaction),l=a.resistance,h=-Math.log(a.endSpeed/this.v0)/l;this.targetOffset={x:(r.x-h)/l,y:(r.y-h)/l},this.te=h,this.lambda_v0=l/this.v0,this.one_ve_v0=1-a.endSpeed/this.v0;var f=this.modification,m=this.modifierArg;m.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},f.result=f.setAll(m),f.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+f.result.delta.x,y:this.targetOffset.y+f.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var r=this;this.timeout=gt.request((function(){r.active&&t()}))}},{key:"inertiaTick",value:function(){var t,r,a,l,h,f,m,_=this,C=this.interaction,w=Zt(C).resistance,A=(C._now()-this.t0)/1e3;if(A<this.te){var L,N=1-(Math.exp(-w*A)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,r=0,a=this.targetOffset.x,l=this.targetOffset.y,h=this.modifiedOffset.x,f=this.modifiedOffset.y,L={x:rn(m=N,t,a,h),y:rn(m,r,l,f)}):L={x:this.targetOffset.x*N,y:this.targetOffset.y*N};var B={x:L.x-this.currentOffset.x,y:L.y-this.currentOffset.y};this.currentOffset.x+=B.x,this.currentOffset.y+=B.y,C.offsetBy(B),C.move(),this.onNextFrame((function(){return _.inertiaTick()}))}else C.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,r=this.interaction,a=r._now()-this.t0,l=Zt(r).smoothEndDuration;if(a<l){var h={x:on(a,0,this.targetOffset.x,l),y:on(a,0,this.targetOffset.y,l)},f={x:h.x-this.currentOffset.x,y:h.y-this.currentOffset.y};this.currentOffset.x+=f.x,this.currentOffset.y+=f.y,r.offsetBy(f),r.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else r.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var r=t.pointer,a=t.event,l=t.eventTarget,h=this.interaction;h.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),h.updatePointer(r,a,l,!0),h._doPhase({interaction:h,event:a,phase:"resume"}),dt(h.coords.prev,h.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,gt.cancel(this.timeout)}}]),i})();function Zt(i){var t=i.interactable,r=i.prepared;return t&&t.options&&r.name&&t.options[r.name].inertia}var Wr={id:"inertia",before:["modifiers","actions"],install:function(i){var t=i.defaults;i.usePlugin(nn),i.usePlugin(Ji),i.actions.phases.inertiastart=!0,i.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(i){var t=i.interaction;t.inertia=new $r(t)},"interactions:before-action-end":function(i){var t=i.interaction,r=i.event;return(!t._interacting||t.simulation||!t.inertia.start(r))&&null},"interactions:down":function(i){var t=i.interaction,r=i.eventTarget,a=t.inertia;if(a.active)for(var l=r;b.element(l);){if(l===t.element){a.resume(i);break}l=xe(l)}},"interactions:stop":function(i){var t=i.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(i){var t=i.interaction.modification;t.stop(i),t.start(i,i.interaction.coords.cur.page),t.applyToInteraction(i)},"interactions:before-action-inertiastart":function(i){return i.interaction.modification.setAndApply(i)},"interactions:action-resume":Nt,"interactions:action-inertiastart":Nt,"interactions:after-action-inertiastart":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-resume":function(i){return i.interaction.modification.restoreInteractionCoords(i)}}};function rn(i,t,r,a){var l=1-i;return l*l*t+2*l*i*r+i*i*a}function on(i,t,r,a){return-r*(i/=a)*(i-2)+t}var Ur=Wr;function an(i,t){for(var r=0;r<t.length;r++){var a=t[r];if(i.immediatePropagationStopped)break;a(i)}}var sn=(function(){function i(t){o(this,i),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=X({},t||{})}return u(i,[{key:"fire",value:function(t){var r,a=this.global;(r=this.types[t.type])&&an(t,r),!t.propagationStopped&&a&&(r=a[t.type])&&an(t,r)}},{key:"on",value:function(t,r){var a=Ue(t,r);for(t in a)this.types[t]=Oe(this.types[t]||[],a[t])}},{key:"off",value:function(t,r){var a=Ue(t,r);for(t in a){var l=this.types[t];if(l&&l.length)for(var h=0,f=a[t];h<f.length;h++){var m=f[h],_=l.indexOf(m);_!==-1&&l.splice(_,1)}}}},{key:"getRect",value:function(t){return null}}]),i})(),Vr=(function(){function i(t){o(this,i),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,ct(this,t)}return u(i,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),i})();function Ht(i){return b.object(i)?{capture:!!i.capture,passive:!!i.passive}:{capture:!!i,passive:!1}}function ei(i,t){return i===t||(typeof i=="boolean"?!!t.capture===i&&!t.passive:!!i.capture==!!t.capture&&!!i.passive==!!t.passive)}var Xr={id:"events",install:function(i){var t,r=[],a={},l=[],h={add:f,remove:m,addDelegate:function(w,A,L,N,B){var H=Ht(B);if(!a[L]){a[L]=[];for(var V=0;V<l.length;V++){var $=l[V];f($,L,_),f($,L,C,!0)}}var ie=a[L],le=Xe(ie,(function(he){return he.selector===w&&he.context===A}));le||(le={selector:w,context:A,listeners:[]},ie.push(le)),le.listeners.push({func:N,options:H})},removeDelegate:function(w,A,L,N,B){var H,V=Ht(B),$=a[L],ie=!1;if($)for(H=$.length-1;H>=0;H--){var le=$[H];if(le.selector===w&&le.context===A){for(var he=le.listeners,re=he.length-1;re>=0;re--){var ce=he[re];if(ce.func===N&&ei(ce.options,V)){he.splice(re,1),he.length||($.splice(H,1),m(A,L,_),m(A,L,C,!0)),ie=!0;break}}if(ie)break}}},delegateListener:_,delegateUseCapture:C,delegatedEvents:a,documents:l,targets:r,supportsOptions:!1,supportsPassive:!1};function f(w,A,L,N){if(w.addEventListener){var B=Ht(N),H=Xe(r,(function(V){return V.eventTarget===w}));H||(H={eventTarget:w,events:{}},r.push(H)),H.events[A]||(H.events[A]=[]),Xe(H.events[A],(function(V){return V.func===L&&ei(V.options,B)}))||(w.addEventListener(A,L,h.supportsOptions?B:B.capture),H.events[A].push({func:L,options:B}))}}function m(w,A,L,N){if(w.addEventListener&&w.removeEventListener){var B=_e(r,(function(Ye){return Ye.eventTarget===w})),H=r[B];if(H&&H.events)if(A!=="all"){var V=!1,$=H.events[A];if($){if(L==="all"){for(var ie=$.length-1;ie>=0;ie--){var le=$[ie];m(w,A,le.func,le.options)}return}for(var he=Ht(N),re=0;re<$.length;re++){var ce=$[re];if(ce.func===L&&ei(ce.options,he)){w.removeEventListener(A,L,h.supportsOptions?he:he.capture),$.splice(re,1),$.length===0&&(delete H.events[A],V=!0);break}}}V&&!Object.keys(H.events).length&&r.splice(B,1)}else for(A in H.events)H.events.hasOwnProperty(A)&&m(w,A,"all")}}function _(w,A){for(var L=Ht(A),N=new Vr(w),B=a[w.type],H=Z(w)[0],V=H;b.element(V);){for(var $=0;$<B.length;$++){var ie=B[$],le=ie.selector,he=ie.context;if(be(V,le)&&pe(he,H)&&pe(he,V)){var re=ie.listeners;N.currentTarget=V;for(var ce=0;ce<re.length;ce++){var Ye=re[ce];ei(Ye.options,L)&&Ye.func(N)}}}V=xe(V)}}function C(w){return _(w,!0)}return(t=i.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return h.supportsOptions=!0},get passive(){return h.supportsPassive=!0}}),i.events=h,h}},vi={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(i){for(var t=0,r=vi.methodOrder;t<r.length;t++){var a=r[t],l=vi[a](i);if(l)return l}return null},simulationResume:function(i){var t=i.pointerType,r=i.eventType,a=i.eventTarget,l=i.scope;if(!/down|start/i.test(r))return null;for(var h=0,f=l.interactions.list;h<f.length;h++){var m=f[h],_=a;if(m.simulation&&m.simulation.allowResume&&m.pointerType===t)for(;_;){if(_===m.element)return m;_=xe(_)}}return null},mouseOrPen:function(i){var t,r=i.pointerId,a=i.pointerType,l=i.eventType,h=i.scope;if(a!=="mouse"&&a!=="pen")return null;for(var f=0,m=h.interactions.list;f<m.length;f++){var _=m[f];if(_.pointerType===a){if(_.simulation&&!ln(_,r))continue;if(_.interacting())return _;t||(t=_)}}if(t)return t;for(var C=0,w=h.interactions.list;C<w.length;C++){var A=w[C];if(!(A.pointerType!==a||/down/i.test(l)&&A.simulation))return A}return null},hasPointer:function(i){for(var t=i.pointerId,r=0,a=i.scope.interactions.list;r<a.length;r++){var l=a[r];if(ln(l,t))return l}return null},idle:function(i){for(var t=i.pointerType,r=0,a=i.scope.interactions.list;r<a.length;r++){var l=a[r];if(l.pointers.length===1){var h=l.interactable;if(h&&(!h.options.gesture||!h.options.gesture.enabled))continue}else if(l.pointers.length>=2)continue;if(!l.interacting()&&t===l.pointerType)return l}return null}};function ln(i,t){return i.pointers.some((function(r){return r.id===t}))}var Gr=vi,bi=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function cn(i,t){return function(r){var a=t.interactions.list,l=ke(r),h=Z(r),f=h[0],m=h[1],_=[];if(/^touch/.test(r.type)){t.prevTouchTime=t.now();for(var C=0,w=r.changedTouches;C<w.length;C++){var A=w[C],L={pointer:A,pointerId:it(A),pointerType:l,eventType:r.type,eventTarget:f,curEventTarget:m,scope:t},N=dn(L);_.push([L.pointer,L.eventTarget,L.curEventTarget,N])}}else{var B=!1;if(!se.supportsPointerEvent&&/mouse/.test(r.type)){for(var H=0;H<a.length&&!B;H++)B=a[H].pointerType!=="mouse"&&a[H].pointerIsDown;B=B||t.now()-t.prevTouchTime<500||r.timeStamp===0}if(!B){var V={pointer:r,pointerId:it(r),pointerType:l,eventType:r.type,curEventTarget:m,eventTarget:f,scope:t},$=dn(V);_.push([V.pointer,V.eventTarget,V.curEventTarget,$])}}for(var ie=0;ie<_.length;ie++){var le=_[ie],he=le[0],re=le[1],ce=le[2];le[3][i](he,r,re,ce)}}}function dn(i){var t=i.pointerType,r=i.scope,a={interaction:Gr.search(i),searchDetails:i};return r.fire("interactions:find",a),a.interaction||r.interactions.new({pointerType:t})}function _i(i,t){var r=i.doc,a=i.scope,l=i.options,h=a.interactions.docEvents,f=a.events,m=f[t];for(var _ in a.browser.isIOS&&!l.events&&(l.events={passive:!1}),f.delegatedEvents)m(r,_,f.delegateListener),m(r,_,f.delegateUseCapture,!0);for(var C=l&&l.events,w=0;w<h.length;w++){var A=h[w];m(r,A.type,A.listener,C)}}var Jr={id:"core/interactions",install:function(i){for(var t={},r=0;r<bi.length;r++){var a=bi[r];t[a]=cn(a,i)}var l,h=se.pEventTypes;function f(){for(var m=0,_=i.interactions.list;m<_.length;m++){var C=_[m];if(C.pointerIsDown&&C.pointerType==="touch"&&!C._interacting)for(var w=function(){var N=L[A];i.documents.some((function(B){return pe(B.doc,N.downTarget)}))||C.removePointer(N.pointer,N.event)},A=0,L=C.pointers;A<L.length;A++)w()}}(l=Y.PointerEvent?[{type:h.down,listener:f},{type:h.down,listener:t.pointerDown},{type:h.move,listener:t.pointerMove},{type:h.up,listener:t.pointerUp},{type:h.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:f},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(m){for(var _=0,C=i.interactions.list;_<C.length;_++)C[_].documentBlur(m)}}),i.prevTouchTime=0,i.Interaction=(function(m){d(C,m);var _=v(C);function C(){return o(this,C),_.apply(this,arguments)}return u(C,[{key:"pointerMoveTolerance",get:function(){return i.interactions.pointerMoveTolerance},set:function(w){i.interactions.pointerMoveTolerance=w}},{key:"_now",value:function(){return i.now()}}]),C})(qr),i.interactions={list:[],new:function(m){m.scopeFire=function(C,w){return i.fire(C,w)};var _=new i.Interaction(m);return i.interactions.list.push(_),_},listeners:t,docEvents:l,pointerMoveTolerance:1},i.usePlugin(Gi)},listeners:{"scope:add-document":function(i){return _i(i,"add")},"scope:remove-document":function(i){return _i(i,"remove")},"interactable:unset":function(i,t){for(var r=i.interactable,a=t.interactions.list.length-1;a>=0;a--){var l=t.interactions.list[a];l.interactable===r&&(l.stop(),t.fire("interactions:destroy",{interaction:l}),l.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(a,1))}}},onDocSignal:_i,doOnInteractions:cn,methodNames:bi},Qr=Jr,yt=(function(i){return i[i.On=0]="On",i[i.Off=1]="Off",i})(yt||{}),Zr=(function(){function i(t,r,a,l){o(this,i),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new sn,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=r.actions,this.target=t,this._context=r.context||a,this._win=k(Be(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=l,this.set(r)}return u(i,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,r){return b.func(r.onstart)&&this.on("".concat(t,"start"),r.onstart),b.func(r.onmove)&&this.on("".concat(t,"move"),r.onmove),b.func(r.onend)&&this.on("".concat(t,"end"),r.onend),b.func(r.oninertiastart)&&this.on("".concat(t,"inertiastart"),r.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,r,a){var l,h=this,f=(l=this._actions.map[t])==null?void 0:l.filterEventType,m=function(_){return(f==null||f(_))&&Jt(_,h._actions)};(b.array(r)||b.object(r))&&this._onOff(yt.Off,t,r,void 0,m),(b.array(a)||b.object(a))&&this._onOff(yt.On,t,a,void 0,m)}},{key:"setPerAction",value:function(t,r){var a=this._defaults;for(var l in r){var h=l,f=this.options[t],m=r[h];h==="listeners"&&this.updatePerActionListeners(t,f.listeners,m),b.array(m)?f[h]=Ve(m):b.plainObject(m)?(f[h]=X(f[h]||{},Mt(m)),b.object(a.perAction[h])&&"enabled"in a.perAction[h]&&(f[h].enabled=m.enabled!==!1)):b.bool(m)&&b.object(a.perAction[h])?f[h].enabled=m:f[h]=m}}},{key:"getRect",value:function(t){return t=t||(b.element(this.target)?this.target:null),b.string(this.target)&&(t=t||this._context.querySelector(this.target)),Me(t)}},{key:"rectChecker",value:function(t){var r=this;return b.func(t)?(this.getRect=function(a){var l=X({},t.apply(r,a));return"width"in l||(l.width=l.right-l.left,l.height=l.bottom-l.top),l},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,r){if(Be(r)||b.object(r)){for(var a in this.options[t]=r,this._actions.map)this.options[a][t]=r;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return b.string(t)?Array.from(this._context.querySelectorAll(t)):b.func(t)&&t.getAllElements?t.getAllElements():b.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||pe(this._context,t)}},{key:"testIgnoreAllow",value:function(t,r,a){return!this.testIgnore(t.ignoreFrom,r,a)&&this.testAllow(t.allowFrom,r,a)}},{key:"testAllow",value:function(t,r,a){return!t||!!b.element(a)&&(b.string(t)?Je(a,t,r):!!b.element(t)&&pe(t,a))}},{key:"testIgnore",value:function(t,r,a){return!(!t||!b.element(a))&&(b.string(t)?Je(a,t,r):!!b.element(t)&&pe(t,a))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,r,a,l,h){b.object(r)&&!b.array(r)&&(l=a,a=null);var f=Ue(r,a,h);for(var m in f){m==="wheel"&&(m=se.wheelEvent);for(var _=0,C=f[m];_<C.length;_++){var w=C[_];Jt(m,this._actions)?this.events[t===yt.On?"on":"off"](m,w):b.string(this.target)?this._scopeEvents[t===yt.On?"addDelegate":"removeDelegate"](this.target,this._context,m,w,l):this._scopeEvents[t===yt.On?"add":"remove"](this.target,m,w,l)}}return this}},{key:"on",value:function(t,r,a){return this._onOff(yt.On,t,r,a)}},{key:"off",value:function(t,r,a){return this._onOff(yt.Off,t,r,a)}},{key:"set",value:function(t){var r=this._defaults;for(var a in b.object(t)||(t={}),this.options=Mt(r.base),this._actions.methodDict){var l=a,h=this._actions.methodDict[l];this.options[l]={},this.setPerAction(l,X(X({},r.perAction),r.actions[l])),this[h](t[l])}for(var f in t)f!=="getRect"?b.func(this[f])&&this[f](t[f]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(b.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var r=this._scopeEvents.delegatedEvents[t],a=r.length-1;a>=0;a--){var l=r[a],h=l.selector,f=l.context,m=l.listeners;h===this.target&&f===this._context&&r.splice(a,1);for(var _=m.length-1;_>=0;_--)this._scopeEvents.removeDelegate(this.target,this._context,t,m[_][0],m[_][1])}else this._scopeEvents.remove(this.target,"all")}}]),i})(),eo=(function(){function i(t){var r=this;o(this,i),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(a){var l=a.interactable,h=l.target,f=b.string(h)?r.selectorMap[h]:h[r.scope.id],m=_e(f,(function(_){return _===l}));f.splice(m,1)}})}return u(i,[{key:"new",value:function(t,r){r=X(r||{},{actions:this.scope.actions});var a=new this.scope.Interactable(t,r,this.scope.document,this.scope.events);return this.scope.addDocument(a._doc),this.list.push(a),b.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(a)):(a.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(a)),this.scope.fire("interactable:new",{target:t,options:r,interactable:a,win:this.scope._win}),a}},{key:"getExisting",value:function(t,r){var a=r&&r.context||this.scope.document,l=b.string(t),h=l?this.selectorMap[t]:t[this.scope.id];if(h)return Xe(h,(function(f){return f._context===a&&(l||f.inContext(t))}))}},{key:"forEachMatch",value:function(t,r){for(var a=0,l=this.list;a<l.length;a++){var h=l[a],f=void 0;if((b.string(h.target)?b.element(t)&&be(t,h.target):t===h.target)&&h.inContext(t)&&(f=r(h)),f!==void 0)return f}}}]),i})(),to=(function(){function i(){var t=this;o(this,i),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=se,this.defaults=Mt(Qi),this.Eventable=sn,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(a){var l=function h(f,m){var _=a.interactables.getExisting(f,m);return _||((_=a.interactables.new(f,m)).events.global=h.globalEvents),_};return l.getPointerAverage=ye,l.getTouchBBox=G,l.getTouchDistance=J,l.getTouchAngle=ue,l.getElementRect=Me,l.getElementClientRect=ze,l.matchesSelector=be,l.closest=Ae,l.globalEvents={},l.version="1.10.27",l.scope=a,l.use=function(h,f){return this.scope.usePlugin(h,f),this},l.isSet=function(h,f){return!!this.scope.interactables.get(h,f&&f.context)},l.on=Bt((function(h,f,m){if(b.string(h)&&h.search(" ")!==-1&&(h=h.trim().split(/ +/)),b.array(h)){for(var _=0,C=h;_<C.length;_++){var w=C[_];this.on(w,f,m)}return this}if(b.object(h)){for(var A in h)this.on(A,h[A],f);return this}return Jt(h,this.scope.actions)?this.globalEvents[h]?this.globalEvents[h].push(f):this.globalEvents[h]=[f]:this.scope.events.add(this.scope.document,h,f,{options:m}),this}),"The interact.on() method is being deprecated"),l.off=Bt((function(h,f,m){if(b.string(h)&&h.search(" ")!==-1&&(h=h.trim().split(/ +/)),b.array(h)){for(var _=0,C=h;_<C.length;_++){var w=C[_];this.off(w,f,m)}return this}if(b.object(h)){for(var A in h)this.off(A,h[A],f);return this}var L;return Jt(h,this.scope.actions)?h in this.globalEvents&&(L=this.globalEvents[h].indexOf(f))!==-1&&this.globalEvents[h].splice(L,1):this.scope.events.remove(this.scope.document,h,f,m),this}),"The interact.off() method is being deprecated"),l.debug=function(){return this.scope},l.supportsTouch=function(){return se.supportsTouch},l.supportsPointerEvent=function(){return se.supportsPointerEvent},l.stop=function(){for(var h=0,f=this.scope.interactions.list;h<f.length;h++)f[h].stop();return this},l.pointerMoveTolerance=function(h){return b.number(h)?(this.scope.interactions.pointerMoveTolerance=h,this):this.scope.interactions.pointerMoveTolerance},l.addDocument=function(h,f){this.scope.addDocument(h,f)},l.removeDocument=function(h){this.scope.removeDocument(h)},l})(this),this.InteractEvent=mi,this.Interactable=void 0,this.interactables=new eo(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(a){return t.removeDocument(a.target)};var r=this;this.Interactable=(function(a){d(h,a);var l=v(h);function h(){return o(this,h),l.apply(this,arguments)}return u(h,[{key:"_defaults",get:function(){return r.defaults}},{key:"set",value:function(f){return S(g(h.prototype),"set",this).call(this,f),r.fire("interactable:set",{options:f,interactable:this}),this}},{key:"unset",value:function(){S(g(h.prototype),"unset",this).call(this);var f=r.interactables.list.indexOf(this);f<0||(r.interactables.list.splice(f,1),r.fire("interactable:unset",{interactable:this}))}}]),h})(Zr)}return u(i,[{key:"addListeners",value:function(t,r){this.listenerMaps.push({id:r,map:t})}},{key:"fire",value:function(t,r){for(var a=0,l=this.listenerMaps;a<l.length;a++){var h=l[a].map[t];if(h&&h(r,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(r,a){return r.isInitialized=!0,b.window(a)&&I(a),Y.init(a),se.init(a),gt.init(a),r.window=a,r.document=a.document,r.usePlugin(Qr),r.usePlugin(Xr),r})(this,t)}},{key:"pluginIsInstalled",value:function(t){var r=t.id;return r?!!this._plugins.map[r]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,r){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,r),t.listeners&&t.before){for(var a=0,l=this.listenerMaps.length,h=t.before.reduce((function(m,_){return m[_]=!0,m[un(_)]=!0,m}),{});a<l;a++){var f=this.listenerMaps[a].id;if(f&&(h[f]||h[un(f)]))break}this.listenerMaps.splice(a,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,r){if(this.getDocIndex(t)!==-1)return!1;var a=k(t);r=r?X({},r):{},this.documents.push({doc:t,options:r}),this.events.documents.push(t),t!==this.document&&this.events.add(a,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:a,scope:this,options:r})}},{key:"removeDocument",value:function(t){var r=this.getDocIndex(t),a=k(t),l=this.documents[r].options;this.events.remove(a,"unload",this.onWindowUnload),this.documents.splice(r,1),this.events.documents.splice(r,1),this.fire("scope:remove-document",{doc:t,window:a,scope:this,options:l})}},{key:"getDocIndex",value:function(t){for(var r=0;r<this.documents.length;r++)if(this.documents[r].doc===t)return r;return-1}},{key:"getDocOptions",value:function(t){var r=this.getDocIndex(t);return r===-1?null:this.documents[r].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),i})();function un(i){return i&&i.replace(/\/.*$/,"")}var pn=new to,Ke=pn.interactStatic,io=typeof globalThis!="undefined"?globalThis:window;pn.init(io);var no=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(i){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(a){var l=a[0],h=a[1];return l in i||h in i})),r=function(a,l){for(var h=i.range,f=i.limits,m=f===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:f,_=i.offset,C=_===void 0?{x:0,y:0}:_,w={range:h,grid:i,x:null,y:null},A=0;A<t.length;A++){var L=t[A],N=L[0],B=L[1],H=Math.round((a-C.x)/i[N]),V=Math.round((l-C.y)/i[B]);w[N]=Math.max(m.left,Math.min(m.right,H*i[N]+C.x)),w[B]=Math.max(m.top,Math.min(m.bottom,V*i[B]+C.y))}return w};return r.grid=i,r.coordFields=t,r}}),ro={id:"snappers",install:function(i){var t=i.interactStatic;t.snappers=X(t.snappers||{},no),t.createSnapGrid=t.snappers.grid}},oo=ro,ao={start:function(i){var t=i.state,r=i.rect,a=i.edges,l=i.pageCoords,h=t.options,f=h.ratio,m=h.enabled,_=t.options,C=_.equalDelta,w=_.modifiers;f==="preserve"&&(f=r.width/r.height),t.startCoords=X({},l),t.startRect=X({},r),t.ratio=f,t.equalDelta=C;var A=t.linkedEdges={top:a.top||a.left&&!a.bottom,left:a.left||a.top&&!a.right,bottom:a.bottom||a.right&&!a.top,right:a.right||a.bottom&&!a.left};if(t.xIsPrimaryAxis=!(!a.left&&!a.right),t.equalDelta){var L=(A.left?1:-1)*(A.top?1:-1);t.edgeSign={x:L,y:L}}else t.edgeSign={x:A.left?-1:1,y:A.top?-1:1};if(m!==!1&&X(a,A),w!=null&&w.length){var N=new gi(i.interaction);N.copyFrom(i.interaction.modification),N.prepareStates(w),t.subModification=N,N.startAll(p({},i))}},set:function(i){var t=i.state,r=i.rect,a=i.coords,l=t.linkedEdges,h=X({},a),f=t.equalDelta?so:lo;if(X(i.edges,l),f(t,t.xIsPrimaryAxis,a,r),!t.subModification)return null;var m=X({},r);we(l,m,{x:a.x-h.x,y:a.y-h.y});var _=t.subModification.setAll(p(p({},i),{},{rect:m,edges:l,pageCoords:a,prevCoords:a,prevRect:m})),C=_.delta;return _.changed&&(f(t,Math.abs(C.x)>Math.abs(C.y),_.coords,_.rect),X(a,_.coords)),_.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function so(i,t,r){var a=i.startCoords,l=i.edgeSign;t?r.y=a.y+(r.x-a.x)*l.y:r.x=a.x+(r.y-a.y)*l.x}function lo(i,t,r,a){var l=i.startRect,h=i.startCoords,f=i.ratio,m=i.edgeSign;if(t){var _=a.width/f;r.y=h.y+(_-l.height)*m.y}else{var C=a.height*f;r.x=h.x+(C-l.width)*m.x}}var co=mt(ao,"aspectRatio"),hn=function(){};hn._defaults={};var ti=hn;function wt(i,t,r){return b.func(i)?ge(i,t.interactable,t.element,[r.x,r.y,t]):ge(i,t.interactable,t.element)}var ii={start:function(i){var t=i.rect,r=i.startOffset,a=i.state,l=i.interaction,h=i.pageCoords,f=a.options,m=f.elementRect,_=X({left:0,top:0,right:0,bottom:0},f.offset||{});if(t&&m){var C=wt(f.restriction,l,h);if(C){var w=C.right-C.left-t.width,A=C.bottom-C.top-t.height;w<0&&(_.left+=w,_.right+=w),A<0&&(_.top+=A,_.bottom+=A)}_.left+=r.left-t.width*m.left,_.top+=r.top-t.height*m.top,_.right+=r.right-t.width*(1-m.right),_.bottom+=r.bottom-t.height*(1-m.bottom)}a.offset=_},set:function(i){var t=i.coords,r=i.interaction,a=i.state,l=a.options,h=a.offset,f=wt(l.restriction,r,t);if(f){var m=(function(_){return!_||"left"in _&&"top"in _||((_=X({},_)).left=_.x||0,_.top=_.y||0,_.right=_.right||_.left+_.width,_.bottom=_.bottom||_.top+_.height),_})(f);t.x=Math.max(Math.min(m.right-h.right,t.x),m.left+h.left),t.y=Math.max(Math.min(m.bottom-h.bottom,t.y),m.top+h.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},uo=mt(ii,"restrict"),fn={top:1/0,left:1/0,bottom:-1/0,right:-1/0},gn={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function mn(i,t){for(var r=0,a=["top","left","bottom","right"];r<a.length;r++){var l=a[r];l in i||(i[l]=t[l])}return i}var jt={noInner:fn,noOuter:gn,start:function(i){var t,r=i.interaction,a=i.startOffset,l=i.state,h=l.options;h&&(t=ee(wt(h.offset,r,r.coords.start.page))),t=t||{x:0,y:0},l.offset={top:t.y+a.top,left:t.x+a.left,bottom:t.y-a.bottom,right:t.x-a.right}},set:function(i){var t=i.coords,r=i.edges,a=i.interaction,l=i.state,h=l.offset,f=l.options;if(r){var m=X({},t),_=wt(f.inner,a,m)||{},C=wt(f.outer,a,m)||{};mn(_,fn),mn(C,gn),r.top?t.y=Math.min(Math.max(C.top+h.top,m.y),_.top+h.top):r.bottom&&(t.y=Math.max(Math.min(C.bottom+h.bottom,m.y),_.bottom+h.bottom)),r.left?t.x=Math.min(Math.max(C.left+h.left,m.x),_.left+h.left):r.right&&(t.x=Math.max(Math.min(C.right+h.right,m.x),_.right+h.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},po=mt(jt,"restrictEdges"),ho=X({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(i){}},ii.defaults),fo=mt({start:ii.start,set:ii.set,defaults:ho},"restrictRect"),go={width:-1/0,height:-1/0},mo={width:1/0,height:1/0},yo=mt({start:function(i){return jt.start(i)},set:function(i){var t=i.interaction,r=i.state,a=i.rect,l=i.edges,h=r.options;if(l){var f=fe(wt(h.min,t,i.coords))||go,m=fe(wt(h.max,t,i.coords))||mo;r.options={endOnly:h.endOnly,inner:X({},jt.noInner),outer:X({},jt.noOuter)},l.top?(r.options.inner.top=a.bottom-f.height,r.options.outer.top=a.bottom-m.height):l.bottom&&(r.options.inner.bottom=a.top+f.height,r.options.outer.bottom=a.top+m.height),l.left?(r.options.inner.left=a.right-f.width,r.options.outer.left=a.right-m.width):l.right&&(r.options.inner.right=a.left+f.width,r.options.outer.right=a.left+m.width),jt.set(i),r.options=h}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),xi={start:function(i){var t,r=i.interaction,a=i.interactable,l=i.element,h=i.rect,f=i.state,m=i.startOffset,_=f.options,C=_.offsetWithOrigin?(function(L){var N=L.interaction.element,B=ee(ge(L.state.options.origin,null,null,[N])),H=B||Fe(L.interactable,N,L.interaction.prepared.name);return H})(i):{x:0,y:0};if(_.offset==="startCoords")t={x:r.coords.start.page.x,y:r.coords.start.page.y};else{var w=ge(_.offset,a,l,[r]);(t=ee(w)||{x:0,y:0}).x+=C.x,t.y+=C.y}var A=_.relativePoints;f.offsets=h&&A&&A.length?A.map((function(L,N){return{index:N,relativePoint:L,x:m.left-h.width*L.x+t.x,y:m.top-h.height*L.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(i){var t=i.interaction,r=i.coords,a=i.state,l=a.options,h=a.offsets,f=Fe(t.interactable,t.element,t.prepared.name),m=X({},r),_=[];l.offsetWithOrigin||(m.x-=f.x,m.y-=f.y);for(var C=0,w=h;C<w.length;C++)for(var A=w[C],L=m.x-A.x,N=m.y-A.y,B=0,H=l.targets.length;B<H;B++){var V=l.targets[B],$=void 0;($=b.func(V)?V(L,N,t._proxy,A,B):V)&&_.push({x:(b.number($.x)?$.x:L)+A.x,y:(b.number($.y)?$.y:N)+A.y,range:b.number($.range)?$.range:l.range,source:V,index:B,offset:A})}for(var ie={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},le=0;le<_.length;le++){var he=_[le],re=he.range,ce=he.x-m.x,Ye=he.y-m.y,Ee=tt(ce,Ye),et=Ee<=re;re===1/0&&ie.inRange&&ie.range!==1/0&&(et=!1),ie.target&&!(et?ie.inRange&&re!==1/0?Ee/re<ie.distance/ie.range:re===1/0&&ie.range!==1/0||Ee<ie.distance:!ie.inRange&&Ee<ie.distance)||(ie.target=he,ie.distance=Ee,ie.range=re,ie.inRange=et,ie.delta.x=ce,ie.delta.y=Ye)}return ie.inRange&&(r.x=ie.target.x,r.y=ie.target.y),a.closest=ie,ie},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},vo=mt(xi,"snap"),ni={start:function(i){var t=i.state,r=i.edges,a=t.options;if(!r)return null;i.state={options:{targets:null,relativePoints:[{x:r.left?0:1,y:r.top?0:1}],offset:a.offset||"self",origin:{x:0,y:0},range:a.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],xi.start(i),t.offsets=i.state.offsets,i.state=t},set:function(i){var t=i.interaction,r=i.state,a=i.coords,l=r.options,h=r.offsets,f={x:a.x-h[0].x,y:a.y-h[0].y};r.options=X({},l),r.options.targets=[];for(var m=0,_=l.targets||[];m<_.length;m++){var C=_[m],w=void 0;if(w=b.func(C)?C(f.x,f.y,t):C){for(var A=0,L=r.targetFields;A<L.length;A++){var N=L[A],B=N[0],H=N[1];if(B in w||H in w){w.x=w[B],w.y=w[H];break}}r.options.targets.push(w)}}var V=xi.set(i);return r.options=l,V},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},bo=mt(ni,"snapSize"),wi={aspectRatio:co,restrictEdges:po,restrict:uo,restrictRect:fo,restrictSize:yo,snapEdges:mt({start:function(i){var t=i.edges;return t?(i.state.targetFields=i.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],ni.start(i)):null},set:ni.set,defaults:X(Mt(ni.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:vo,snapSize:bo,spring:ti,avoid:ti,transform:ti,rubberband:ti},_o={id:"modifiers",install:function(i){var t=i.interactStatic;for(var r in i.usePlugin(Ji),i.usePlugin(oo),t.modifiers=wi,wi){var a=wi[r],l=a._defaults,h=a._methods;l._methods=h,i.defaults.perAction[r]=l}}},xo=_o,yn=(function(i){d(r,i);var t=v(r);function r(a,l,h,f,m,_){var C;if(o(this,r),ct(y(C=t.call(this,m)),h),h!==l&&ct(y(C),l),C.timeStamp=_,C.originalEvent=h,C.type=a,C.pointerId=it(l),C.pointerType=ke(l),C.target=f,C.currentTarget=null,a==="tap"){var w=m.getPointerIndex(l);C.dt=C.timeStamp-m.pointers[w].downTime;var A=C.timeStamp-m.tapTime;C.double=!!m.prevTap&&m.prevTap.type!=="doubletap"&&m.prevTap.target===C.target&&A<500}else a==="doubletap"&&(C.dt=l.timeStamp-m.tapTime,C.double=!0);return C}return u(r,[{key:"_subtractOrigin",value:function(a){var l=a.x,h=a.y;return this.pageX-=l,this.pageY-=h,this.clientX-=l,this.clientY-=h,this}},{key:"_addOrigin",value:function(a){var l=a.x,h=a.y;return this.pageX+=l,this.pageY+=h,this.clientX+=l,this.clientY+=h,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),r})(Se),qt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(i){i.pointerEvents=qt,i.defaults.actions.pointerEvents=qt.defaults,X(i.actions.phaselessTypes,qt.types)},listeners:{"interactions:new":function(i){var t=i.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(i){var t=i.down,r=i.pointerInfo;!t&&r.hold||(r.hold={duration:1/0,timeout:null})},"interactions:move":function(i,t){var r=i.interaction,a=i.pointer,l=i.event,h=i.eventTarget;i.duplicate||r.pointerIsDown&&!r.pointerWasMoved||(r.pointerIsDown&&ki(i),vt({interaction:r,pointer:a,event:l,eventTarget:h,type:"move"},t))},"interactions:down":function(i,t){(function(r,a){for(var l=r.interaction,h=r.pointer,f=r.event,m=r.eventTarget,_=r.pointerIndex,C=l.pointers[_].hold,w=Qe(m),A={interaction:l,pointer:h,event:f,eventTarget:m,type:"hold",targets:[],path:w,node:null},L=0;L<w.length;L++){var N=w[L];A.node=N,a.fire("pointerEvents:collect-targets",A)}if(A.targets.length){for(var B=1/0,H=0,V=A.targets;H<V.length;H++){var $=V[H].eventable.options.holdDuration;$<B&&(B=$)}C.duration=B,C.timeout=setTimeout((function(){vt({interaction:l,eventTarget:m,pointer:h,event:f,type:"hold"},a)}),B)}})(i,t),vt(i,t)},"interactions:up":function(i,t){ki(i),vt(i,t),(function(r,a){var l=r.interaction,h=r.pointer,f=r.event,m=r.eventTarget;l.pointerWasMoved||vt({interaction:l,eventTarget:m,pointer:h,event:f,type:"tap"},a)})(i,t)},"interactions:cancel":function(i,t){ki(i),vt(i,t)}},PointerEvent:yn,fire:vt,collectEventTargets:vn,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function vt(i,t){var r=i.interaction,a=i.pointer,l=i.event,h=i.eventTarget,f=i.type,m=i.targets,_=m===void 0?vn(i,t):m,C=new yn(f,a,l,h,r,t.now());t.fire("pointerEvents:new",{pointerEvent:C});for(var w={interaction:r,pointer:a,event:l,eventTarget:h,targets:_,type:f,pointerEvent:C},A=0;A<_.length;A++){var L=_[A];for(var N in L.props||{})C[N]=L.props[N];var B=Fe(L.eventable,L.node);if(C._subtractOrigin(B),C.eventable=L.eventable,C.currentTarget=L.node,L.eventable.fire(C),C._addOrigin(B),C.immediatePropagationStopped||C.propagationStopped&&A+1<_.length&&_[A+1].node!==C.currentTarget)break}if(t.fire("pointerEvents:fired",w),f==="tap"){var H=C.double?vt({interaction:r,pointer:a,event:l,eventTarget:h,type:"doubletap"},t):C;r.prevTap=H,r.tapTime=H.timeStamp}return C}function vn(i,t){var r=i.interaction,a=i.pointer,l=i.event,h=i.eventTarget,f=i.type,m=r.getPointerIndex(a),_=r.pointers[m];if(f==="tap"&&(r.pointerWasMoved||!_||_.downTarget!==h))return[];for(var C=Qe(h),w={interaction:r,pointer:a,event:l,eventTarget:h,type:f,path:C,targets:[],node:null},A=0;A<C.length;A++){var L=C[A];w.node=L,t.fire("pointerEvents:collect-targets",w)}return f==="hold"&&(w.targets=w.targets.filter((function(N){var B,H;return N.eventable.options.holdDuration===((B=r.pointers[m])==null||(H=B.hold)==null?void 0:H.duration)}))),w.targets}function ki(i){var t=i.interaction,r=i.pointerIndex,a=t.pointers[r].hold;a&&a.timeout&&(clearTimeout(a.timeout),a.timeout=null)}var wo=Object.freeze({__proto__:null,default:qt});function ko(i){var t=i.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var So={id:"pointer-events/holdRepeat",install:function(i){i.usePlugin(qt);var t=i.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=i.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(i,t){return i["pointerEvents:".concat(t)]=ko,i}),{"pointerEvents:new":function(i){var t=i.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(i,t){var r=i.interaction,a=i.pointerEvent,l=i.eventTarget,h=i.targets;if(a.type==="hold"&&h.length){var f=h[0].eventable.options.holdRepeatInterval;f<=0||(r.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:r,eventTarget:l,type:"hold",pointer:a,event:a},t)}),f))}}})},Co=So,Eo={id:"pointer-events/interactableTargets",install:function(i){var t=i.Interactable;t.prototype.pointerEvents=function(a){return X(this.events.options,a),this};var r=t.prototype._backCompatOption;t.prototype._backCompatOption=function(a,l){var h=r.call(this,a,l);return h===this&&(this.events.options[a]=l),h}},listeners:{"pointerEvents:collect-targets":function(i,t){var r=i.targets,a=i.node,l=i.type,h=i.eventTarget;t.interactables.forEachMatch(a,(function(f){var m=f.events,_=m.options;m.types[l]&&m.types[l].length&&f.testIgnoreAllow(_,a,h)&&r.push({node:a,eventable:m,props:{interactable:f}})}))},"interactable:new":function(i){var t=i.interactable;t.events.getRect=function(r){return t.getRect(r)}},"interactable:set":function(i,t){var r=i.interactable,a=i.options;X(r.events.options,t.pointerEvents.defaults),X(r.events.options,a.pointerEvents||{})}}},Ao=Eo,Oo={id:"pointer-events",install:function(i){i.usePlugin(wo),i.usePlugin(Co),i.usePlugin(Ao)}},To=Oo,Mo={id:"reflow",install:function(i){var t=i.Interactable;i.actions.phases.reflow=!0,t.prototype.reflow=function(r){return(function(a,l,h){for(var f=a.getAllElements(),m=h.window.Promise,_=m?[]:null,C=function(){var A=f[w],L=a.getRect(A);if(!L)return 1;var N,B=Xe(h.interactions.list,(function($){return $.interacting()&&$.interactable===a&&$.element===A&&$.prepared.name===l.name}));if(B)B.move(),_&&(N=B._reflowPromise||new m((function($){B._reflowResolve=$})));else{var H=fe(L),V=(function($){return{coords:$,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:H.x,y:H.y},client:{x:H.x,y:H.y},timeStamp:h.now()});N=(function($,ie,le,he,re){var ce=$.interactions.new({pointerType:"reflow"}),Ye={interaction:ce,event:re,pointer:re,eventTarget:le,phase:"reflow"};ce.interactable=ie,ce.element=le,ce.prevEvent=re,ce.updatePointer(re,re,le,!0),Ce(ce.coords.delta),ui(ce.prepared,he),ce._doPhase(Ye);var Ee=$.window,et=Ee.Promise,rt=et?new et((function(ut){ce._reflowResolve=ut})):void 0;return ce._reflowPromise=rt,ce.start(he,ie,le),ce._interacting?(ce.move(Ye),ce.end(re)):(ce.stop(),ce._reflowResolve()),ce.removePointer(re,re),rt})(h,a,A,l,V)}_&&_.push(N)},w=0;w<f.length&&!C();w++);return _&&m.all(_).then((function(){return a}))})(this,r,i)}},listeners:{"interactions:stop":function(i,t){var r=i.interaction;r.pointerType==="reflow"&&(r._reflowResolve&&r._reflowResolve(),(function(a,l){a.splice(a.indexOf(l),1)})(t.interactions.list,r))}}},Po=Mo;if(Ke.use(Gi),Ke.use(nn),Ke.use(To),Ke.use(Ur),Ke.use(xo),Ke.use(Dr),Ke.use(ft),Ke.use(Er),Ke.use(Po),Ke.default=Ke,(typeof kt=="undefined"?"undefined":n(kt))==="object"&&kt)try{kt.exports=Ke}catch{}return Ke.default=Ke,Ke}))});var Sr=Ho(_n(),1);function Fn(e){return typeof e=="undefined"||e===null}function jo(e){return typeof e=="object"&&e!==null}function qo(e){return Array.isArray(e)?e:Fn(e)?[]:[e]}function Ko(e,p){var n,o,s,u;if(p)for(u=Object.keys(p),n=0,o=u.length;n<o;n+=1)s=u[n],e[s]=p[s];return e}function Yo(e,p){var n="",o;for(o=0;o<p;o+=1)n+=e;return n}function $o(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Wo=Fn,Uo=jo,Vo=qo,Xo=Yo,Go=$o,Jo=Ko,Ie={isNothing:Wo,isObject:Uo,toArray:Vo,repeat:Xo,isNegativeZero:Go,extend:Jo};function Rn(e,p){var n="",o=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!p&&e.mark.snippet&&(n+=`

`+e.mark.snippet),o+" "+n):o}function $t(e,p){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=p,this.message=Rn(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}$t.prototype=Object.create(Error.prototype);$t.prototype.constructor=$t;$t.prototype.toString=function(p){return this.name+": "+Rn(this,p)};var $e=$t;function Ei(e,p,n,o,s){var u="",c="",d=Math.floor(s/2)-1;return o-p>d&&(u=" ... ",p=o-d+u.length),n-o>d&&(c=" ...",n=o+d-c.length),{str:u+e.slice(p,n).replace(/\t/g,"\u2192")+c,pos:o-p+u.length}}function Ai(e,p){return Ie.repeat(" ",p-e.length)+e}function Qo(e,p){if(p=Object.create(p||null),!e.buffer)return null;p.maxLength||(p.maxLength=79),typeof p.indent!="number"&&(p.indent=1),typeof p.linesBefore!="number"&&(p.linesBefore=3),typeof p.linesAfter!="number"&&(p.linesAfter=2);for(var n=/\r?\n|\r|\0/g,o=[0],s=[],u,c=-1;u=n.exec(e.buffer);)s.push(u.index),o.push(u.index+u[0].length),e.position<=u.index&&c<0&&(c=o.length-2);c<0&&(c=o.length-1);var d="",g,x,y=Math.min(e.line+p.linesAfter,s.length).toString().length,v=p.maxLength-(p.indent+y+3);for(g=1;g<=p.linesBefore&&!(c-g<0);g++)x=Ei(e.buffer,o[c-g],s[c-g],e.position-(o[c]-o[c-g]),v),d=Ie.repeat(" ",p.indent)+Ai((e.line-g+1).toString(),y)+" | "+x.str+`
`+d;for(x=Ei(e.buffer,o[c],s[c],e.position,v),d+=Ie.repeat(" ",p.indent)+Ai((e.line+1).toString(),y)+" | "+x.str+`
`,d+=Ie.repeat("-",p.indent+y+3+x.pos)+`^
`,g=1;g<=p.linesAfter&&!(c+g>=s.length);g++)x=Ei(e.buffer,o[c+g],s[c+g],e.position-(o[c]-o[c+g]),v),d+=Ie.repeat(" ",p.indent)+Ai((e.line+g+1).toString(),y)+" | "+x.str+`
`;return d.replace(/\n$/,"")}var Zo=Qo,ea=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],ta=["scalar","sequence","mapping"];function ia(e){var p={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(o){p[String(o)]=n})}),p}function na(e,p){if(p=p||{},Object.keys(p).forEach(function(n){if(ea.indexOf(n)===-1)throw new $e('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=p,this.tag=e,this.kind=p.kind||null,this.resolve=p.resolve||function(){return!0},this.construct=p.construct||function(n){return n},this.instanceOf=p.instanceOf||null,this.predicate=p.predicate||null,this.represent=p.represent||null,this.representName=p.representName||null,this.defaultStyle=p.defaultStyle||null,this.multi=p.multi||!1,this.styleAliases=ia(p.styleAliases||null),ta.indexOf(this.kind)===-1)throw new $e('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var De=na;function xn(e,p){var n=[];return e[p].forEach(function(o){var s=n.length;n.forEach(function(u,c){u.tag===o.tag&&u.kind===o.kind&&u.multi===o.multi&&(s=c)}),n[s]=o}),n}function ra(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},p,n;function o(s){s.multi?(e.multi[s.kind].push(s),e.multi.fallback.push(s)):e[s.kind][s.tag]=e.fallback[s.tag]=s}for(p=0,n=arguments.length;p<n;p+=1)arguments[p].forEach(o);return e}function Ti(e){return this.extend(e)}Ti.prototype.extend=function(p){var n=[],o=[];if(p instanceof De)o.push(p);else if(Array.isArray(p))o=o.concat(p);else if(p&&(Array.isArray(p.implicit)||Array.isArray(p.explicit)))p.implicit&&(n=n.concat(p.implicit)),p.explicit&&(o=o.concat(p.explicit));else throw new $e("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(u){if(!(u instanceof De))throw new $e("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(u.loadKind&&u.loadKind!=="scalar")throw new $e("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(u.multi)throw new $e("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),o.forEach(function(u){if(!(u instanceof De))throw new $e("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var s=Object.create(Ti.prototype);return s.implicit=(this.implicit||[]).concat(n),s.explicit=(this.explicit||[]).concat(o),s.compiledImplicit=xn(s,"implicit"),s.compiledExplicit=xn(s,"explicit"),s.compiledTypeMap=ra(s.compiledImplicit,s.compiledExplicit),s};var Bn=Ti,Nn=new De("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Hn=new De("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),jn=new De("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),qn=new Bn({explicit:[Nn,Hn,jn]});function oa(e){if(e===null)return!0;var p=e.length;return p===1&&e==="~"||p===4&&(e==="null"||e==="Null"||e==="NULL")}function aa(){return null}function sa(e){return e===null}var Kn=new De("tag:yaml.org,2002:null",{kind:"scalar",resolve:oa,construct:aa,predicate:sa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function la(e){if(e===null)return!1;var p=e.length;return p===4&&(e==="true"||e==="True"||e==="TRUE")||p===5&&(e==="false"||e==="False"||e==="FALSE")}function ca(e){return e==="true"||e==="True"||e==="TRUE"}function da(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Yn=new De("tag:yaml.org,2002:bool",{kind:"scalar",resolve:la,construct:ca,predicate:da,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ua(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function pa(e){return 48<=e&&e<=55}function ha(e){return 48<=e&&e<=57}function fa(e){if(e===null)return!1;var p=e.length,n=0,o=!1,s;if(!p)return!1;if(s=e[n],(s==="-"||s==="+")&&(s=e[++n]),s==="0"){if(n+1===p)return!0;if(s=e[++n],s==="b"){for(n++;n<p;n++)if(s=e[n],s!=="_"){if(s!=="0"&&s!=="1")return!1;o=!0}return o&&s!=="_"}if(s==="x"){for(n++;n<p;n++)if(s=e[n],s!=="_"){if(!ua(e.charCodeAt(n)))return!1;o=!0}return o&&s!=="_"}if(s==="o"){for(n++;n<p;n++)if(s=e[n],s!=="_"){if(!pa(e.charCodeAt(n)))return!1;o=!0}return o&&s!=="_"}}if(s==="_")return!1;for(;n<p;n++)if(s=e[n],s!=="_"){if(!ha(e.charCodeAt(n)))return!1;o=!0}return!(!o||s==="_")}function ga(e){var p=e,n=1,o;if(p.indexOf("_")!==-1&&(p=p.replace(/_/g,"")),o=p[0],(o==="-"||o==="+")&&(o==="-"&&(n=-1),p=p.slice(1),o=p[0]),p==="0")return 0;if(o==="0"){if(p[1]==="b")return n*parseInt(p.slice(2),2);if(p[1]==="x")return n*parseInt(p.slice(2),16);if(p[1]==="o")return n*parseInt(p.slice(2),8)}return n*parseInt(p,10)}function ma(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!Ie.isNegativeZero(e)}var $n=new De("tag:yaml.org,2002:int",{kind:"scalar",resolve:fa,construct:ga,predicate:ma,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ya=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function va(e){return!(e===null||!ya.test(e)||e[e.length-1]==="_")}function ba(e){var p,n;return p=e.replace(/_/g,"").toLowerCase(),n=p[0]==="-"?-1:1,"+-".indexOf(p[0])>=0&&(p=p.slice(1)),p===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:p===".nan"?NaN:n*parseFloat(p,10)}var _a=/^[-+]?[0-9]+e/;function xa(e,p){var n;if(isNaN(e))switch(p){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(p){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(p){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Ie.isNegativeZero(e))return"-0.0";return n=e.toString(10),_a.test(n)?n.replace("e",".e"):n}function wa(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||Ie.isNegativeZero(e))}var Wn=new De("tag:yaml.org,2002:float",{kind:"scalar",resolve:va,construct:ba,predicate:wa,represent:xa,defaultStyle:"lowercase"}),Un=qn.extend({implicit:[Kn,Yn,$n,Wn]}),Vn=Un,Xn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Gn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function ka(e){return e===null?!1:Xn.exec(e)!==null||Gn.exec(e)!==null}function Sa(e){var p,n,o,s,u,c,d,g=0,x=null,y,v,S;if(p=Xn.exec(e),p===null&&(p=Gn.exec(e)),p===null)throw new Error("Date resolve error");if(n=+p[1],o=+p[2]-1,s=+p[3],!p[4])return new Date(Date.UTC(n,o,s));if(u=+p[4],c=+p[5],d=+p[6],p[7]){for(g=p[7].slice(0,3);g.length<3;)g+="0";g=+g}return p[9]&&(y=+p[10],v=+(p[11]||0),x=(y*60+v)*6e4,p[9]==="-"&&(x=-x)),S=new Date(Date.UTC(n,o,s,u,c,d,g)),x&&S.setTime(S.getTime()-x),S}function Ca(e){return e.toISOString()}var Jn=new De("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:ka,construct:Sa,instanceOf:Date,represent:Ca});function Ea(e){return e==="<<"||e===null}var Qn=new De("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Ea}),Li=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Aa(e){if(e===null)return!1;var p,n,o=0,s=e.length,u=Li;for(n=0;n<s;n++)if(p=u.indexOf(e.charAt(n)),!(p>64)){if(p<0)return!1;o+=6}return o%8===0}function Oa(e){var p,n,o=e.replace(/[\r\n=]/g,""),s=o.length,u=Li,c=0,d=[];for(p=0;p<s;p++)p%4===0&&p&&(d.push(c>>16&255),d.push(c>>8&255),d.push(c&255)),c=c<<6|u.indexOf(o.charAt(p));return n=s%4*6,n===0?(d.push(c>>16&255),d.push(c>>8&255),d.push(c&255)):n===18?(d.push(c>>10&255),d.push(c>>2&255)):n===12&&d.push(c>>4&255),new Uint8Array(d)}function Ta(e){var p="",n=0,o,s,u=e.length,c=Li;for(o=0;o<u;o++)o%3===0&&o&&(p+=c[n>>18&63],p+=c[n>>12&63],p+=c[n>>6&63],p+=c[n&63]),n=(n<<8)+e[o];return s=u%3,s===0?(p+=c[n>>18&63],p+=c[n>>12&63],p+=c[n>>6&63],p+=c[n&63]):s===2?(p+=c[n>>10&63],p+=c[n>>4&63],p+=c[n<<2&63],p+=c[64]):s===1&&(p+=c[n>>2&63],p+=c[n<<4&63],p+=c[64],p+=c[64]),p}function Ma(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Zn=new De("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Aa,construct:Oa,predicate:Ma,represent:Ta}),Pa=Object.prototype.hasOwnProperty,Ia=Object.prototype.toString;function za(e){if(e===null)return!0;var p=[],n,o,s,u,c,d=e;for(n=0,o=d.length;n<o;n+=1){if(s=d[n],c=!1,Ia.call(s)!=="[object Object]")return!1;for(u in s)if(Pa.call(s,u))if(!c)c=!0;else return!1;if(!c)return!1;if(p.indexOf(u)===-1)p.push(u);else return!1}return!0}function La(e){return e!==null?e:[]}var er=new De("tag:yaml.org,2002:omap",{kind:"sequence",resolve:za,construct:La}),Da=Object.prototype.toString;function Fa(e){if(e===null)return!0;var p,n,o,s,u,c=e;for(u=new Array(c.length),p=0,n=c.length;p<n;p+=1){if(o=c[p],Da.call(o)!=="[object Object]"||(s=Object.keys(o),s.length!==1))return!1;u[p]=[s[0],o[s[0]]]}return!0}function Ra(e){if(e===null)return[];var p,n,o,s,u,c=e;for(u=new Array(c.length),p=0,n=c.length;p<n;p+=1)o=c[p],s=Object.keys(o),u[p]=[s[0],o[s[0]]];return u}var tr=new De("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Fa,construct:Ra}),Ba=Object.prototype.hasOwnProperty;function Na(e){if(e===null)return!0;var p,n=e;for(p in n)if(Ba.call(n,p)&&n[p]!==null)return!1;return!0}function Ha(e){return e!==null?e:{}}var ir=new De("tag:yaml.org,2002:set",{kind:"mapping",resolve:Na,construct:Ha}),Di=Vn.extend({implicit:[Jn,Qn],explicit:[Zn,er,tr,ir]}),_t=Object.prototype.hasOwnProperty,oi=1,nr=2,rr=3,ai=4,Oi=1,ja=2,wn=3,qa=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ka=/[\x85\u2028\u2029]/,Ya=/[,\[\]\{\}]/,or=/^(?:!|!!|![a-z\-]+!)$/i,ar=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function kn(e){return Object.prototype.toString.call(e)}function st(e){return e===10||e===13}function Ct(e){return e===9||e===32}function Ge(e){return e===9||e===32||e===10||e===13}function It(e){return e===44||e===91||e===93||e===123||e===125}function $a(e){var p;return 48<=e&&e<=57?e-48:(p=e|32,97<=p&&p<=102?p-97+10:-1)}function Wa(e){return e===120?2:e===117?4:e===85?8:0}function Ua(e){return 48<=e&&e<=57?e-48:-1}function Sn(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Va(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var sr=new Array(256),lr=new Array(256);for(St=0;St<256;St++)sr[St]=Sn(St)?1:0,lr[St]=Sn(St);var St;function Xa(e,p){this.input=e,this.filename=p.filename||null,this.schema=p.schema||Di,this.onWarning=p.onWarning||null,this.legacy=p.legacy||!1,this.json=p.json||!1,this.listener=p.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function cr(e,p){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=Zo(n),new $e(p,n)}function ne(e,p){throw cr(e,p)}function si(e,p){e.onWarning&&e.onWarning.call(null,cr(e,p))}var Cn={YAML:function(p,n,o){var s,u,c;p.version!==null&&ne(p,"duplication of %YAML directive"),o.length!==1&&ne(p,"YAML directive accepts exactly one argument"),s=/^([0-9]+)\.([0-9]+)$/.exec(o[0]),s===null&&ne(p,"ill-formed argument of the YAML directive"),u=parseInt(s[1],10),c=parseInt(s[2],10),u!==1&&ne(p,"unacceptable YAML version of the document"),p.version=o[0],p.checkLineBreaks=c<2,c!==1&&c!==2&&si(p,"unsupported YAML version of the document")},TAG:function(p,n,o){var s,u;o.length!==2&&ne(p,"TAG directive accepts exactly two arguments"),s=o[0],u=o[1],or.test(s)||ne(p,"ill-formed tag handle (first argument) of the TAG directive"),_t.call(p.tagMap,s)&&ne(p,'there is a previously declared suffix for "'+s+'" tag handle'),ar.test(u)||ne(p,"ill-formed tag prefix (second argument) of the TAG directive");try{u=decodeURIComponent(u)}catch{ne(p,"tag prefix is malformed: "+u)}p.tagMap[s]=u}};function bt(e,p,n,o){var s,u,c,d;if(p<n){if(d=e.input.slice(p,n),o)for(s=0,u=d.length;s<u;s+=1)c=d.charCodeAt(s),c===9||32<=c&&c<=1114111||ne(e,"expected valid JSON character");else qa.test(d)&&ne(e,"the stream contains non-printable characters");e.result+=d}}function En(e,p,n,o){var s,u,c,d;for(Ie.isObject(n)||ne(e,"cannot merge mappings; the provided source object is unacceptable"),s=Object.keys(n),c=0,d=s.length;c<d;c+=1)u=s[c],_t.call(p,u)||(p[u]=n[u],o[u]=!0)}function zt(e,p,n,o,s,u,c,d,g){var x,y;if(Array.isArray(s))for(s=Array.prototype.slice.call(s),x=0,y=s.length;x<y;x+=1)Array.isArray(s[x])&&ne(e,"nested arrays are not supported inside keys"),typeof s=="object"&&kn(s[x])==="[object Object]"&&(s[x]="[object Object]");if(typeof s=="object"&&kn(s)==="[object Object]"&&(s="[object Object]"),s=String(s),p===null&&(p={}),o==="tag:yaml.org,2002:merge")if(Array.isArray(u))for(x=0,y=u.length;x<y;x+=1)En(e,p,u[x],n);else En(e,p,u,n);else!e.json&&!_t.call(n,s)&&_t.call(p,s)&&(e.line=c||e.line,e.lineStart=d||e.lineStart,e.position=g||e.position,ne(e,"duplicated mapping key")),s==="__proto__"?Object.defineProperty(p,s,{configurable:!0,enumerable:!0,writable:!0,value:u}):p[s]=u,delete n[s];return p}function Fi(e){var p;p=e.input.charCodeAt(e.position),p===10?e.position++:p===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):ne(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function Pe(e,p,n){for(var o=0,s=e.input.charCodeAt(e.position);s!==0;){for(;Ct(s);)s===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),s=e.input.charCodeAt(++e.position);if(p&&s===35)do s=e.input.charCodeAt(++e.position);while(s!==10&&s!==13&&s!==0);if(st(s))for(Fi(e),s=e.input.charCodeAt(e.position),o++,e.lineIndent=0;s===32;)e.lineIndent++,s=e.input.charCodeAt(++e.position);else break}return n!==-1&&o!==0&&e.lineIndent<n&&si(e,"deficient indentation"),o}function di(e){var p=e.position,n;return n=e.input.charCodeAt(p),!!((n===45||n===46)&&n===e.input.charCodeAt(p+1)&&n===e.input.charCodeAt(p+2)&&(p+=3,n=e.input.charCodeAt(p),n===0||Ge(n)))}function Ri(e,p){p===1?e.result+=" ":p>1&&(e.result+=Ie.repeat(`
`,p-1))}function Ga(e,p,n){var o,s,u,c,d,g,x,y,v=e.kind,S=e.result,O;if(O=e.input.charCodeAt(e.position),Ge(O)||It(O)||O===35||O===38||O===42||O===33||O===124||O===62||O===39||O===34||O===37||O===64||O===96||(O===63||O===45)&&(s=e.input.charCodeAt(e.position+1),Ge(s)||n&&It(s)))return!1;for(e.kind="scalar",e.result="",u=c=e.position,d=!1;O!==0;){if(O===58){if(s=e.input.charCodeAt(e.position+1),Ge(s)||n&&It(s))break}else if(O===35){if(o=e.input.charCodeAt(e.position-1),Ge(o))break}else{if(e.position===e.lineStart&&di(e)||n&&It(O))break;if(st(O))if(g=e.line,x=e.lineStart,y=e.lineIndent,Pe(e,!1,-1),e.lineIndent>=p){d=!0,O=e.input.charCodeAt(e.position);continue}else{e.position=c,e.line=g,e.lineStart=x,e.lineIndent=y;break}}d&&(bt(e,u,c,!1),Ri(e,e.line-g),u=c=e.position,d=!1),Ct(O)||(c=e.position+1),O=e.input.charCodeAt(++e.position)}return bt(e,u,c,!1),e.result?!0:(e.kind=v,e.result=S,!1)}function Ja(e,p){var n,o,s;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,o=s=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(bt(e,o,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)o=e.position,e.position++,s=e.position;else return!0;else st(n)?(bt(e,o,s,!0),Ri(e,Pe(e,!1,p)),o=s=e.position):e.position===e.lineStart&&di(e)?ne(e,"unexpected end of the document within a single quoted scalar"):(e.position++,s=e.position);ne(e,"unexpected end of the stream within a single quoted scalar")}function Qa(e,p){var n,o,s,u,c,d;if(d=e.input.charCodeAt(e.position),d!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=o=e.position;(d=e.input.charCodeAt(e.position))!==0;){if(d===34)return bt(e,n,e.position,!0),e.position++,!0;if(d===92){if(bt(e,n,e.position,!0),d=e.input.charCodeAt(++e.position),st(d))Pe(e,!1,p);else if(d<256&&sr[d])e.result+=lr[d],e.position++;else if((c=Wa(d))>0){for(s=c,u=0;s>0;s--)d=e.input.charCodeAt(++e.position),(c=$a(d))>=0?u=(u<<4)+c:ne(e,"expected hexadecimal character");e.result+=Va(u),e.position++}else ne(e,"unknown escape sequence");n=o=e.position}else st(d)?(bt(e,n,o,!0),Ri(e,Pe(e,!1,p)),n=o=e.position):e.position===e.lineStart&&di(e)?ne(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}ne(e,"unexpected end of the stream within a double quoted scalar")}function Za(e,p){var n=!0,o,s,u,c=e.tag,d,g=e.anchor,x,y,v,S,O,z=Object.create(null),E,P,I,k;if(k=e.input.charCodeAt(e.position),k===91)y=93,O=!1,d=[];else if(k===123)y=125,O=!0,d={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=d),k=e.input.charCodeAt(++e.position);k!==0;){if(Pe(e,!0,p),k=e.input.charCodeAt(e.position),k===y)return e.position++,e.tag=c,e.anchor=g,e.kind=O?"mapping":"sequence",e.result=d,!0;n?k===44&&ne(e,"expected the node content, but found ','"):ne(e,"missed comma between flow collection entries"),P=E=I=null,v=S=!1,k===63&&(x=e.input.charCodeAt(e.position+1),Ge(x)&&(v=S=!0,e.position++,Pe(e,!0,p))),o=e.line,s=e.lineStart,u=e.position,Lt(e,p,oi,!1,!0),P=e.tag,E=e.result,Pe(e,!0,p),k=e.input.charCodeAt(e.position),(S||e.line===o)&&k===58&&(v=!0,k=e.input.charCodeAt(++e.position),Pe(e,!0,p),Lt(e,p,oi,!1,!0),I=e.result),O?zt(e,d,z,P,E,I,o,s,u):v?d.push(zt(e,null,z,P,E,I,o,s,u)):d.push(E),Pe(e,!0,p),k=e.input.charCodeAt(e.position),k===44?(n=!0,k=e.input.charCodeAt(++e.position)):n=!1}ne(e,"unexpected end of the stream within a flow collection")}function es(e,p){var n,o,s=Oi,u=!1,c=!1,d=p,g=0,x=!1,y,v;if(v=e.input.charCodeAt(e.position),v===124)o=!1;else if(v===62)o=!0;else return!1;for(e.kind="scalar",e.result="";v!==0;)if(v=e.input.charCodeAt(++e.position),v===43||v===45)Oi===s?s=v===43?wn:ja:ne(e,"repeat of a chomping mode identifier");else if((y=Ua(v))>=0)y===0?ne(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):c?ne(e,"repeat of an indentation width identifier"):(d=p+y-1,c=!0);else break;if(Ct(v)){do v=e.input.charCodeAt(++e.position);while(Ct(v));if(v===35)do v=e.input.charCodeAt(++e.position);while(!st(v)&&v!==0)}for(;v!==0;){for(Fi(e),e.lineIndent=0,v=e.input.charCodeAt(e.position);(!c||e.lineIndent<d)&&v===32;)e.lineIndent++,v=e.input.charCodeAt(++e.position);if(!c&&e.lineIndent>d&&(d=e.lineIndent),st(v)){g++;continue}if(e.lineIndent<d){s===wn?e.result+=Ie.repeat(`
`,u?1+g:g):s===Oi&&u&&(e.result+=`
`);break}for(o?Ct(v)?(x=!0,e.result+=Ie.repeat(`
`,u?1+g:g)):x?(x=!1,e.result+=Ie.repeat(`
`,g+1)):g===0?u&&(e.result+=" "):e.result+=Ie.repeat(`
`,g):e.result+=Ie.repeat(`
`,u?1+g:g),u=!0,c=!0,g=0,n=e.position;!st(v)&&v!==0;)v=e.input.charCodeAt(++e.position);bt(e,n,e.position,!1)}return!0}function An(e,p){var n,o=e.tag,s=e.anchor,u=[],c,d=!1,g;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),g=e.input.charCodeAt(e.position);g!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ne(e,"tab characters must not be used in indentation")),!(g!==45||(c=e.input.charCodeAt(e.position+1),!Ge(c))));){if(d=!0,e.position++,Pe(e,!0,-1)&&e.lineIndent<=p){u.push(null),g=e.input.charCodeAt(e.position);continue}if(n=e.line,Lt(e,p,rr,!1,!0),u.push(e.result),Pe(e,!0,-1),g=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>p)&&g!==0)ne(e,"bad indentation of a sequence entry");else if(e.lineIndent<p)break}return d?(e.tag=o,e.anchor=s,e.kind="sequence",e.result=u,!0):!1}function ts(e,p,n){var o,s,u,c,d,g,x=e.tag,y=e.anchor,v={},S=Object.create(null),O=null,z=null,E=null,P=!1,I=!1,k;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=v),k=e.input.charCodeAt(e.position);k!==0;){if(!P&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ne(e,"tab characters must not be used in indentation")),o=e.input.charCodeAt(e.position+1),u=e.line,(k===63||k===58)&&Ge(o))k===63?(P&&(zt(e,v,S,O,z,null,c,d,g),O=z=E=null),I=!0,P=!0,s=!0):P?(P=!1,s=!0):ne(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,k=o;else{if(c=e.line,d=e.lineStart,g=e.position,!Lt(e,n,nr,!1,!0))break;if(e.line===u){for(k=e.input.charCodeAt(e.position);Ct(k);)k=e.input.charCodeAt(++e.position);if(k===58)k=e.input.charCodeAt(++e.position),Ge(k)||ne(e,"a whitespace character is expected after the key-value separator within a block mapping"),P&&(zt(e,v,S,O,z,null,c,d,g),O=z=E=null),I=!0,P=!1,s=!1,O=e.tag,z=e.result;else if(I)ne(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=x,e.anchor=y,!0}else if(I)ne(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=x,e.anchor=y,!0}if((e.line===u||e.lineIndent>p)&&(P&&(c=e.line,d=e.lineStart,g=e.position),Lt(e,p,ai,!0,s)&&(P?z=e.result:E=e.result),P||(zt(e,v,S,O,z,E,c,d,g),O=z=E=null),Pe(e,!0,-1),k=e.input.charCodeAt(e.position)),(e.line===u||e.lineIndent>p)&&k!==0)ne(e,"bad indentation of a mapping entry");else if(e.lineIndent<p)break}return P&&zt(e,v,S,O,z,null,c,d,g),I&&(e.tag=x,e.anchor=y,e.kind="mapping",e.result=v),I}function is(e){var p,n=!1,o=!1,s,u,c;if(c=e.input.charCodeAt(e.position),c!==33)return!1;if(e.tag!==null&&ne(e,"duplication of a tag property"),c=e.input.charCodeAt(++e.position),c===60?(n=!0,c=e.input.charCodeAt(++e.position)):c===33?(o=!0,s="!!",c=e.input.charCodeAt(++e.position)):s="!",p=e.position,n){do c=e.input.charCodeAt(++e.position);while(c!==0&&c!==62);e.position<e.length?(u=e.input.slice(p,e.position),c=e.input.charCodeAt(++e.position)):ne(e,"unexpected end of the stream within a verbatim tag")}else{for(;c!==0&&!Ge(c);)c===33&&(o?ne(e,"tag suffix cannot contain exclamation marks"):(s=e.input.slice(p-1,e.position+1),or.test(s)||ne(e,"named tag handle cannot contain such characters"),o=!0,p=e.position+1)),c=e.input.charCodeAt(++e.position);u=e.input.slice(p,e.position),Ya.test(u)&&ne(e,"tag suffix cannot contain flow indicator characters")}u&&!ar.test(u)&&ne(e,"tag name cannot contain such characters: "+u);try{u=decodeURIComponent(u)}catch{ne(e,"tag name is malformed: "+u)}return n?e.tag=u:_t.call(e.tagMap,s)?e.tag=e.tagMap[s]+u:s==="!"?e.tag="!"+u:s==="!!"?e.tag="tag:yaml.org,2002:"+u:ne(e,'undeclared tag handle "'+s+'"'),!0}function ns(e){var p,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&ne(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),p=e.position;n!==0&&!Ge(n)&&!It(n);)n=e.input.charCodeAt(++e.position);return e.position===p&&ne(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(p,e.position),!0}function rs(e){var p,n,o;if(o=e.input.charCodeAt(e.position),o!==42)return!1;for(o=e.input.charCodeAt(++e.position),p=e.position;o!==0&&!Ge(o)&&!It(o);)o=e.input.charCodeAt(++e.position);return e.position===p&&ne(e,"name of an alias node must contain at least one character"),n=e.input.slice(p,e.position),_t.call(e.anchorMap,n)||ne(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],Pe(e,!0,-1),!0}function Lt(e,p,n,o,s){var u,c,d,g=1,x=!1,y=!1,v,S,O,z,E,P;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,u=c=d=ai===n||rr===n,o&&Pe(e,!0,-1)&&(x=!0,e.lineIndent>p?g=1:e.lineIndent===p?g=0:e.lineIndent<p&&(g=-1)),g===1)for(;is(e)||ns(e);)Pe(e,!0,-1)?(x=!0,d=u,e.lineIndent>p?g=1:e.lineIndent===p?g=0:e.lineIndent<p&&(g=-1)):d=!1;if(d&&(d=x||s),(g===1||ai===n)&&(oi===n||nr===n?E=p:E=p+1,P=e.position-e.lineStart,g===1?d&&(An(e,P)||ts(e,P,E))||Za(e,E)?y=!0:(c&&es(e,E)||Ja(e,E)||Qa(e,E)?y=!0:rs(e)?(y=!0,(e.tag!==null||e.anchor!==null)&&ne(e,"alias node should not have any properties")):Ga(e,E,oi===n)&&(y=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):g===0&&(y=d&&An(e,P))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&ne(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),v=0,S=e.implicitTypes.length;v<S;v+=1)if(z=e.implicitTypes[v],z.resolve(e.result)){e.result=z.construct(e.result),e.tag=z.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(_t.call(e.typeMap[e.kind||"fallback"],e.tag))z=e.typeMap[e.kind||"fallback"][e.tag];else for(z=null,O=e.typeMap.multi[e.kind||"fallback"],v=0,S=O.length;v<S;v+=1)if(e.tag.slice(0,O[v].tag.length)===O[v].tag){z=O[v];break}z||ne(e,"unknown tag !<"+e.tag+">"),e.result!==null&&z.kind!==e.kind&&ne(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+z.kind+'", not "'+e.kind+'"'),z.resolve(e.result,e.tag)?(e.result=z.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):ne(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||y}function os(e){var p=e.position,n,o,s,u=!1,c;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(c=e.input.charCodeAt(e.position))!==0&&(Pe(e,!0,-1),c=e.input.charCodeAt(e.position),!(e.lineIndent>0||c!==37));){for(u=!0,c=e.input.charCodeAt(++e.position),n=e.position;c!==0&&!Ge(c);)c=e.input.charCodeAt(++e.position);for(o=e.input.slice(n,e.position),s=[],o.length<1&&ne(e,"directive name must not be less than one character in length");c!==0;){for(;Ct(c);)c=e.input.charCodeAt(++e.position);if(c===35){do c=e.input.charCodeAt(++e.position);while(c!==0&&!st(c));break}if(st(c))break;for(n=e.position;c!==0&&!Ge(c);)c=e.input.charCodeAt(++e.position);s.push(e.input.slice(n,e.position))}c!==0&&Fi(e),_t.call(Cn,o)?Cn[o](e,o,s):si(e,'unknown document directive "'+o+'"')}if(Pe(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,Pe(e,!0,-1)):u&&ne(e,"directives end mark is expected"),Lt(e,e.lineIndent-1,ai,!1,!0),Pe(e,!0,-1),e.checkLineBreaks&&Ka.test(e.input.slice(p,e.position))&&si(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&di(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,Pe(e,!0,-1));return}if(e.position<e.length-1)ne(e,"end of the stream or a document separator is expected");else return}function dr(e,p){e=String(e),p=p||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new Xa(e,p),o=e.indexOf("\0");for(o!==-1&&(n.position=o,ne(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)os(n);return n.documents}function as(e,p,n){p!==null&&typeof p=="object"&&typeof n=="undefined"&&(n=p,p=null);var o=dr(e,n);if(typeof p!="function")return o;for(var s=0,u=o.length;s<u;s+=1)p(o[s])}function ss(e,p){var n=dr(e,p);if(n.length!==0){if(n.length===1)return n[0];throw new $e("expected a single document in the stream, but found more")}}var ls=as,cs=ss,ur={loadAll:ls,load:cs},pr=Object.prototype.toString,hr=Object.prototype.hasOwnProperty,Bi=65279,ds=9,Wt=10,us=13,ps=32,hs=33,fs=34,Mi=35,gs=37,ms=38,ys=39,vs=42,fr=44,bs=45,li=58,_s=61,xs=62,ws=63,ks=64,gr=91,mr=93,Ss=96,yr=123,Cs=124,vr=125,Re={};Re[0]="\\0";Re[7]="\\a";Re[8]="\\b";Re[9]="\\t";Re[10]="\\n";Re[11]="\\v";Re[12]="\\f";Re[13]="\\r";Re[27]="\\e";Re[34]='\\"';Re[92]="\\\\";Re[133]="\\N";Re[160]="\\_";Re[8232]="\\L";Re[8233]="\\P";var Es=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],As=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Os(e,p){var n,o,s,u,c,d,g;if(p===null)return{};for(n={},o=Object.keys(p),s=0,u=o.length;s<u;s+=1)c=o[s],d=String(p[c]),c.slice(0,2)==="!!"&&(c="tag:yaml.org,2002:"+c.slice(2)),g=e.compiledTypeMap.fallback[c],g&&hr.call(g.styleAliases,d)&&(d=g.styleAliases[d]),n[c]=d;return n}function Ts(e){var p,n,o;if(p=e.toString(16).toUpperCase(),e<=255)n="x",o=2;else if(e<=65535)n="u",o=4;else if(e<=4294967295)n="U",o=8;else throw new $e("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+Ie.repeat("0",o-p.length)+p}var Ms=1,Ut=2;function Ps(e){this.schema=e.schema||Di,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=Ie.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Os(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Ut:Ms,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function On(e,p){for(var n=Ie.repeat(" ",p),o=0,s=-1,u="",c,d=e.length;o<d;)s=e.indexOf(`
`,o),s===-1?(c=e.slice(o),o=d):(c=e.slice(o,s+1),o=s+1),c.length&&c!==`
`&&(u+=n),u+=c;return u}function Pi(e,p){return`
`+Ie.repeat(" ",e.indent*p)}function Is(e,p){var n,o,s;for(n=0,o=e.implicitTypes.length;n<o;n+=1)if(s=e.implicitTypes[n],s.resolve(p))return!0;return!1}function ci(e){return e===ps||e===ds}function Vt(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Bi||65536<=e&&e<=1114111}function Tn(e){return Vt(e)&&e!==Bi&&e!==us&&e!==Wt}function Mn(e,p,n){var o=Tn(e),s=o&&!ci(e);return(n?o:o&&e!==fr&&e!==gr&&e!==mr&&e!==yr&&e!==vr)&&e!==Mi&&!(p===li&&!s)||Tn(p)&&!ci(p)&&e===Mi||p===li&&s}function zs(e){return Vt(e)&&e!==Bi&&!ci(e)&&e!==bs&&e!==ws&&e!==li&&e!==fr&&e!==gr&&e!==mr&&e!==yr&&e!==vr&&e!==Mi&&e!==ms&&e!==vs&&e!==hs&&e!==Cs&&e!==_s&&e!==xs&&e!==ys&&e!==fs&&e!==gs&&e!==ks&&e!==Ss}function Ls(e){return!ci(e)&&e!==li}function Yt(e,p){var n=e.charCodeAt(p),o;return n>=55296&&n<=56319&&p+1<e.length&&(o=e.charCodeAt(p+1),o>=56320&&o<=57343)?(n-55296)*1024+o-56320+65536:n}function br(e){var p=/^\n* /;return p.test(e)}var _r=1,Ii=2,xr=3,wr=4,Pt=5;function Ds(e,p,n,o,s,u,c,d){var g,x=0,y=null,v=!1,S=!1,O=o!==-1,z=-1,E=zs(Yt(e,0))&&Ls(Yt(e,e.length-1));if(p||c)for(g=0;g<e.length;x>=65536?g+=2:g++){if(x=Yt(e,g),!Vt(x))return Pt;E=E&&Mn(x,y,d),y=x}else{for(g=0;g<e.length;x>=65536?g+=2:g++){if(x=Yt(e,g),x===Wt)v=!0,O&&(S=S||g-z-1>o&&e[z+1]!==" ",z=g);else if(!Vt(x))return Pt;E=E&&Mn(x,y,d),y=x}S=S||O&&g-z-1>o&&e[z+1]!==" "}return!v&&!S?E&&!c&&!s(e)?_r:u===Ut?Pt:Ii:n>9&&br(e)?Pt:c?u===Ut?Pt:Ii:S?wr:xr}function Fs(e,p,n,o,s){e.dump=(function(){if(p.length===0)return e.quotingType===Ut?'""':"''";if(!e.noCompatMode&&(Es.indexOf(p)!==-1||As.test(p)))return e.quotingType===Ut?'"'+p+'"':"'"+p+"'";var u=e.indent*Math.max(1,n),c=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-u),d=o||e.flowLevel>-1&&n>=e.flowLevel;function g(x){return Is(e,x)}switch(Ds(p,d,e.indent,c,g,e.quotingType,e.forceQuotes&&!o,s)){case _r:return p;case Ii:return"'"+p.replace(/'/g,"''")+"'";case xr:return"|"+Pn(p,e.indent)+In(On(p,u));case wr:return">"+Pn(p,e.indent)+In(On(Rs(p,c),u));case Pt:return'"'+Bs(p)+'"';default:throw new $e("impossible error: invalid scalar style")}})()}function Pn(e,p){var n=br(e)?String(p):"",o=e[e.length-1]===`
`,s=o&&(e[e.length-2]===`
`||e===`
`),u=s?"+":o?"":"-";return n+u+`
`}function In(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Rs(e,p){for(var n=/(\n+)([^\n]*)/g,o=(function(){var x=e.indexOf(`
`);return x=x!==-1?x:e.length,n.lastIndex=x,zn(e.slice(0,x),p)})(),s=e[0]===`
`||e[0]===" ",u,c;c=n.exec(e);){var d=c[1],g=c[2];u=g[0]===" ",o+=d+(!s&&!u&&g!==""?`
`:"")+zn(g,p),s=u}return o}function zn(e,p){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,o,s=0,u,c=0,d=0,g="";o=n.exec(e);)d=o.index,d-s>p&&(u=c>s?c:d,g+=`
`+e.slice(s,u),s=u+1),c=d;return g+=`
`,e.length-s>p&&c>s?g+=e.slice(s,c)+`
`+e.slice(c+1):g+=e.slice(s),g.slice(1)}function Bs(e){for(var p="",n=0,o,s=0;s<e.length;n>=65536?s+=2:s++)n=Yt(e,s),o=Re[n],!o&&Vt(n)?(p+=e[s],n>=65536&&(p+=e[s+1])):p+=o||Ts(n);return p}function Ns(e,p,n){var o="",s=e.tag,u,c,d;for(u=0,c=n.length;u<c;u+=1)d=n[u],e.replacer&&(d=e.replacer.call(n,String(u),d)),(pt(e,p,d,!1,!1)||typeof d=="undefined"&&pt(e,p,null,!1,!1))&&(o!==""&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=s,e.dump="["+o+"]"}function Ln(e,p,n,o){var s="",u=e.tag,c,d,g;for(c=0,d=n.length;c<d;c+=1)g=n[c],e.replacer&&(g=e.replacer.call(n,String(c),g)),(pt(e,p+1,g,!0,!0,!1,!0)||typeof g=="undefined"&&pt(e,p+1,null,!0,!0,!1,!0))&&((!o||s!=="")&&(s+=Pi(e,p)),e.dump&&Wt===e.dump.charCodeAt(0)?s+="-":s+="- ",s+=e.dump);e.tag=u,e.dump=s||"[]"}function Hs(e,p,n){var o="",s=e.tag,u=Object.keys(n),c,d,g,x,y;for(c=0,d=u.length;c<d;c+=1)y="",o!==""&&(y+=", "),e.condenseFlow&&(y+='"'),g=u[c],x=n[g],e.replacer&&(x=e.replacer.call(n,g,x)),pt(e,p,g,!1,!1)&&(e.dump.length>1024&&(y+="? "),y+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),pt(e,p,x,!1,!1)&&(y+=e.dump,o+=y));e.tag=s,e.dump="{"+o+"}"}function js(e,p,n,o){var s="",u=e.tag,c=Object.keys(n),d,g,x,y,v,S;if(e.sortKeys===!0)c.sort();else if(typeof e.sortKeys=="function")c.sort(e.sortKeys);else if(e.sortKeys)throw new $e("sortKeys must be a boolean or a function");for(d=0,g=c.length;d<g;d+=1)S="",(!o||s!=="")&&(S+=Pi(e,p)),x=c[d],y=n[x],e.replacer&&(y=e.replacer.call(n,x,y)),pt(e,p+1,x,!0,!0,!0)&&(v=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,v&&(e.dump&&Wt===e.dump.charCodeAt(0)?S+="?":S+="? "),S+=e.dump,v&&(S+=Pi(e,p)),pt(e,p+1,y,!0,v)&&(e.dump&&Wt===e.dump.charCodeAt(0)?S+=":":S+=": ",S+=e.dump,s+=S));e.tag=u,e.dump=s||"{}"}function Dn(e,p,n){var o,s,u,c,d,g;for(s=n?e.explicitTypes:e.implicitTypes,u=0,c=s.length;u<c;u+=1)if(d=s[u],(d.instanceOf||d.predicate)&&(!d.instanceOf||typeof p=="object"&&p instanceof d.instanceOf)&&(!d.predicate||d.predicate(p))){if(n?d.multi&&d.representName?e.tag=d.representName(p):e.tag=d.tag:e.tag="?",d.represent){if(g=e.styleMap[d.tag]||d.defaultStyle,pr.call(d.represent)==="[object Function]")o=d.represent(p,g);else if(hr.call(d.represent,g))o=d.represent[g](p,g);else throw new $e("!<"+d.tag+'> tag resolver accepts not "'+g+'" style');e.dump=o}return!0}return!1}function pt(e,p,n,o,s,u,c){e.tag=null,e.dump=n,Dn(e,n,!1)||Dn(e,n,!0);var d=pr.call(e.dump),g=o,x;o&&(o=e.flowLevel<0||e.flowLevel>p);var y=d==="[object Object]"||d==="[object Array]",v,S;if(y&&(v=e.duplicates.indexOf(n),S=v!==-1),(e.tag!==null&&e.tag!=="?"||S||e.indent!==2&&p>0)&&(s=!1),S&&e.usedDuplicates[v])e.dump="*ref_"+v;else{if(y&&S&&!e.usedDuplicates[v]&&(e.usedDuplicates[v]=!0),d==="[object Object]")o&&Object.keys(e.dump).length!==0?(js(e,p,e.dump,s),S&&(e.dump="&ref_"+v+e.dump)):(Hs(e,p,e.dump),S&&(e.dump="&ref_"+v+" "+e.dump));else if(d==="[object Array]")o&&e.dump.length!==0?(e.noArrayIndent&&!c&&p>0?Ln(e,p-1,e.dump,s):Ln(e,p,e.dump,s),S&&(e.dump="&ref_"+v+e.dump)):(Ns(e,p,e.dump),S&&(e.dump="&ref_"+v+" "+e.dump));else if(d==="[object String]")e.tag!=="?"&&Fs(e,e.dump,p,u,g);else{if(d==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new $e("unacceptable kind of an object to dump "+d)}e.tag!==null&&e.tag!=="?"&&(x=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?x="!"+x:x.slice(0,18)==="tag:yaml.org,2002:"?x="!!"+x.slice(18):x="!<"+x+">",e.dump=x+" "+e.dump)}return!0}function qs(e,p){var n=[],o=[],s,u;for(zi(e,n,o),s=0,u=o.length;s<u;s+=1)p.duplicates.push(n[o[s]]);p.usedDuplicates=new Array(u)}function zi(e,p,n){var o,s,u;if(e!==null&&typeof e=="object")if(s=p.indexOf(e),s!==-1)n.indexOf(s)===-1&&n.push(s);else if(p.push(e),Array.isArray(e))for(s=0,u=e.length;s<u;s+=1)zi(e[s],p,n);else for(o=Object.keys(e),s=0,u=o.length;s<u;s+=1)zi(e[o[s]],p,n)}function Ks(e,p){p=p||{};var n=new Ps(p);n.noRefs||qs(e,n);var o=e;return n.replacer&&(o=n.replacer.call({"":o},"",o)),pt(n,0,o,!0,!0)?n.dump+`
`:""}var Ys=Ks,$s={dump:Ys};function Ni(e,p){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+p+" instead, which is now safe by default.")}}var Ws=De,Us=Bn,Vs=qn,Xs=Un,Gs=Vn,Js=Di,Qs=ur.load,Zs=ur.loadAll,el=$s.dump,tl=$e,il={binary:Zn,float:Wn,map:jn,null:Kn,pairs:tr,set:ir,timestamp:Jn,bool:Yn,int:$n,merge:Qn,omap:er,seq:Hn,str:Nn},nl=Ni("safeLoad","load"),rl=Ni("safeLoadAll","loadAll"),ol=Ni("safeDump","dump"),al={Type:Ws,Schema:Us,FAILSAFE_SCHEMA:Vs,JSON_SCHEMA:Xs,CORE_SCHEMA:Gs,DEFAULT_SCHEMA:Js,load:Qs,loadAll:Zs,dump:el,YAMLException:tl,types:il,safeLoad:nl,safeLoadAll:rl,safeDump:ol},kr=al;window.interact||(window.interact=Sr.default);window.jsyaml||(window.jsyaml=kr);var sl="0.9.5";console.info(`%c drag-and-drop-card %c v${sl} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var ll=(e,...p)=>console.debug(`[drag-and-drop-card] ${e}`,...p);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var Hi=()=>new Promise(e=>requestAnimationFrame(()=>e())),cl=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),ji=class e extends HTMLElement{constructor(){super();bn(this,"__booting",!1);this.shadowRoot||this.attachShadow({mode:"open"}),this.__rebuiltCards=new WeakSet}_updateTabsA11y_(){var s;let n=this.tabsBar;if(!n)return;n.setAttribute("role","tablist"),n.querySelectorAll(".ddc-tab").forEach((u,c)=>{let d=u.classList.contains("active");u.setAttribute("role","tab"),u.setAttribute("aria-selected",String(d)),u.setAttribute("tabindex",d?"0":"-1"),u.dataset.index=String(c)}),this.__tabsKeyHandler||(this.__tabsKeyHandler=u=>{if(!["ArrowLeft","ArrowRight","Home","End"].includes(u.key))return;let d=Array.from(n.querySelectorAll(".ddc-tab"));if(!d.length)return;u.preventDefault();let g=d.findIndex(S=>S===document.activeElement),x=d.findIndex(S=>S.classList.contains("active")),y=g>=0?g:x>=0?x:0;u.key==="ArrowRight"&&(y=Math.min(d.length-1,y+1)),u.key==="ArrowLeft"&&(y=Math.max(0,y-1)),u.key==="Home"&&(y=0),u.key==="End"&&(y=d.length-1);let v=d[y];if(v){try{v.focus({preventScroll:!1})}catch{}v.click()}},n.addEventListener("keydown",this.__tabsKeyHandler)),this.__tabsScrollHandler||(this.__tabsScrollHandler=()=>{var u;return(u=this._updateTabOverflowShadows_)==null?void 0:u.call(this)},n.addEventListener("scroll",this.__tabsScrollHandler,{passive:!0})),(s=this._updateTabOverflowShadows_)==null||s.call(this)}_setHeaderVisible_(n=!0){var o,s,u,c,d;try{(((o=this._deepQueryAll)==null?void 0:o.call(this,"app-header, ha-top-app-bar, ha-top-app-bar-fixed, mwc-top-app-bar-fixed, ha-header-bar, app-toolbar"))||[]).forEach(v=>{v&&(v.dataset.ddcPrevDisplayHeader===void 0&&(v.dataset.ddcPrevDisplayHeader=v.style.display||"",v.dataset.ddcPrevMinH=v.style.minHeight||"",v.dataset.ddcPrevH=v.style.height||"",v.dataset.ddcPrevVis=v.style.visibility||""),n?(v.style.display=v.dataset.ddcPrevDisplayHeader||"",v.style.minHeight=v.dataset.ddcPrevMinH||"",v.style.height=v.dataset.ddcPrevH||"",v.style.visibility=v.dataset.ddcPrevVis||"",v.removeAttribute("hidden")):(v.style.display="none",v.style.minHeight="0",v.style.height="0",v.style.visibility="hidden",v.setAttribute("hidden","")))}),[...((s=this._deepQueryAll)==null?void 0:s.call(this,"home-assistant-main"))||[],...((u=this._deepQueryAll)==null?void 0:u.call(this,"ha-panel-lovelace"))||[],...((c=this._deepQueryAll)==null?void 0:c.call(this,"hui-root"))||[]].forEach(v=>{if(v)if(v.dataset.ddcPrevHdrVars===void 0&&(v.dataset.ddcPrevHdrVars=JSON.stringify({mdc:v.style.getPropertyValue("--mdc-top-app-bar-height")||"",app:v.style.getPropertyValue("--app-header-height")||"",hdr:v.style.getPropertyValue("--header-height")||""})),n)try{let S=JSON.parse(v.dataset.ddcPrevHdrVars||"{}");v.style.setProperty("--mdc-top-app-bar-height",S.mdc||""),v.style.setProperty("--app-header-height",S.app||""),v.style.setProperty("--header-height",S.hdr||"")}catch{}else v.style.setProperty("--mdc-top-app-bar-height","0px"),v.style.setProperty("--app-header-height","0px"),v.style.setProperty("--header-height","0px")}),(((d=this._deepQueryAll)==null?void 0:d.call(this,"hui-root app-header, hui-root ha-top-app-bar, hui-root mwc-top-app-bar-fixed, hui-root ha-header-bar"))||[]).forEach(v=>{v&&(v.dataset.ddcPrevDisplayHeader2===void 0&&(v.dataset.ddcPrevDisplayHeader2=v.style.display||""),v.style.display=n?v.dataset.ddcPrevDisplayHeader2||"":"none")})}catch{}}_setSidebarVisible_(n=!0){var o,s;try{(((o=this._deepQueryAll)==null?void 0:o.call(this,"ha-sidebar"))||[]).forEach(d=>{d&&(d.dataset.ddcPrevDisplaySidebar===void 0&&(d.dataset.ddcPrevDisplaySidebar=d.style.display||""),d.style.display=n?d.dataset.ddcPrevDisplaySidebar||"":"none")}),(((s=this._deepQueryAll)==null?void 0:s.call(this,"ha-drawer"))||[]).forEach(d=>{if(d){d.dataset.ddcPrevDrawerWidth===void 0&&(d.dataset.ddcPrevDrawerWidth=d.style.getPropertyValue("--mdc-drawer-width")||""),n?d.style.setProperty("--mdc-drawer-width",d.dataset.ddcPrevDrawerWidth||""):d.style.setProperty("--mdc-drawer-width","0px");try{!n&&typeof d.close=="function"&&d.close()}catch{}}})}catch{}}_applyHaChromeVisibility_(){var n;try{let o=!!this.editMode||((n=this._isInHaEditorPreview)==null?void 0:n.call(this));o||!this.hideHaHeader?this._setHeaderVisible_(!0):this._setHeaderVisible_(!1),o||!this.hideHaSidebar?this._setSidebarVisible_(!0):this._setSidebarVisible_(!1)}catch{}}_applyBackgroundImageFromConfig(){var u;let n=this._config||{},o=n.background_image||n.bg_image||null,s=this.cardContainer;if(s)if(o&&o.src){let c=String(o.src).trim(),d=o.repeat===!0||o.repeat==="repeat"?"repeat":"no-repeat",g=Math.max(0,Math.min(1,Number((u=o.opacity)!=null?u:1))),x=o.size||"cover",y=o.position||"center center",v=o.attachment||"scroll",S=o.filter||"none";s.style.setProperty("--ddc-bg-image",c?`url("${c.replace(/"/g,'"')}")`:"none"),s.style.setProperty("--ddc-bg-repeat",d),s.style.setProperty("--ddc-bg-opacity",String(g)),s.style.setProperty("--ddc-bg-size",x),s.style.setProperty("--ddc-bg-position",y),s.style.setProperty("--ddc-bg-attachment",v),s.style.setProperty("--ddc-bg-filter",S),s.classList.add("has-bg-image")}else s.style.removeProperty("--ddc-bg-image"),s.style.removeProperty("--ddc-bg-repeat"),s.style.removeProperty("--ddc-bg-opacity"),s.style.removeProperty("--ddc-bg-size"),s.style.removeProperty("--ddc-bg-position"),s.style.removeProperty("--ddc-bg-attachment"),s.style.removeProperty("--ddc-bg-filter"),s.classList.remove("has-bg-image")}async _onKeyDown_(n){var d,g,x,y,v,S,O,z,E,P;if(!this.editMode||this._isTypingTarget_(n.target))return;let o=Number(this.gridSize||10),s=n.altKey?1:n.shiftKey?o*5:o,u=0,c=0;switch(n.key){case"ArrowLeft":u=-s;break;case"ArrowRight":u=s;break;case"ArrowUp":c=-s;break;case"ArrowDown":c=s;break}if(u||c){n.preventDefault(),this._moveSelectionBy_(u,c,{liveSnap:!n.altKey});return}if(n.key==="Delete"||n.key==="Backspace"){let I=this._selection&&this._selection.size?Array.from(this._selection):[];if(!I.length)return;n.preventDefault(),I.forEach(k=>k.remove()),(d=this._clearSelection)==null||d.call(this),(g=this._resizeContainer)==null||g.call(this),(x=this._queueSave)==null||x.call(this,"delete-key"),(y=this._ensurePlaceholderIfEmpty)==null||y.call(this);return}if((n.ctrlKey||n.metaKey)&&(n.key==="d"||n.key==="D")){n.preventDefault(),await this._duplicateSelection_();return}if((n.ctrlKey||n.metaKey)&&n.key==="]"){n.preventDefault(),this._selection&&((S=(v=this._selection).forEach)==null||S.call(v,I=>{var k;return(k=this._adjustZ)==null?void 0:k.call(this,I,1)})),(O=this._queueSave)==null||O.call(this,"z-up");return}if((n.ctrlKey||n.metaKey)&&n.key==="["){n.preventDefault(),this._selection&&((E=(z=this._selection).forEach)==null||E.call(z,I=>{var k;return(k=this._adjustZ)==null?void 0:k.call(this,I,-1)})),(P=this._queueSave)==null||P.call(this,"z-down");return}}async _duplicateSelection_(){var o,s,u,c,d,g,x,y,v,S,O,z;if(!this._selection||!this._selection.size)return;let n=Array.from(this._selection);for(let E of n)try{let P=((o=this._extractCardConfig)==null?void 0:o.call(this,E.firstElementChild))||{},I=await((s=this._createCard)==null?void 0:s.call(this,P)),k=(u=this._makeWrapper)==null?void 0:u.call(this,I);if(!I||!k)continue;k.style.width=E.style.width,k.style.height=E.style.height;let M=Number(this.gridSize||10),T=(parseFloat(E.getAttribute("data-x"))||0)+M,b=(parseFloat(E.getAttribute("data-y"))||0)+M;(c=this._setCardPosition)==null||c.call(this,k,T,b),k.style.zIndex=String((((d=this._highestZ)==null?void 0:d.call(this))||0)+1);try{let D=(g=E.dataset)==null?void 0:g.tabId;D&&(k.dataset.tabId=D)}catch{}(x=this.cardContainer)==null||x.appendChild(k);try{(y=this._addTabSelectorToChip)==null||y.call(this,k,k.dataset.tabId)}catch{}try{(v=this._rebuildOnce)==null||v.call(this,k.firstElementChild)}catch{}try{(S=this._initCardInteract)==null||S.call(this,k)}catch{}}catch{}try{(O=this._resizeContainer)==null||O.call(this)}catch{}try{(z=this._queueSave)==null||z.call(this,"duplicate")}catch{}}_moveSelectionBy_(n,o,{liveSnap:s=!0}={}){var y,v,S,O,z;if(!this._selection||!this._selection.size)return;let u=Array.from(this._selection),c=Number(this.gridSize||10),d=(y=this._isContainerFixed)==null?void 0:y.call(this),g=((v=this._getContainerSize)==null?void 0:v.call(this))||{w:1/0,h:1/0},x=u.map(E=>{let P=parseFloat(E.getAttribute("data-x-raw"))||parseFloat(E.getAttribute("data-x"))||0,I=parseFloat(E.getAttribute("data-y-raw"))||parseFloat(E.getAttribute("data-y"))||0,k=parseFloat(E.style.width)||E.getBoundingClientRect().width,M=parseFloat(E.style.height)||E.getBoundingClientRect().height,T=P+n,b=I+o;d&&(T=Math.max(0,Math.min(T,Math.max(0,g.w-k))),b=Math.max(0,Math.min(b,Math.max(0,g.h-M))));let D=s?Math.round(T/c)*c:T,F=s?Math.round(b/c)*c:b;return{el:E,rawX:T,rawY:b,snapX:D,snapY:F,w:k,h:M}});if(this.disableOverlap&&typeof this._pushCardsOutOfTheWay=="function")try{this._pushCardsOutOfTheWay(x,n,o,s,c)}catch{}for(let E of x){E.el.setAttribute("data-x-raw",String(E.rawX)),E.el.setAttribute("data-y-raw",String(E.rawY));try{(S=this._setCardPosition)==null||S.call(this,E.el,E.snapX,E.snapY)}catch{}}try{(O=this._resizeContainer)==null||O.call(this)}catch{}try{(z=this._queueSave)==null||z.call(this,"nudge")}catch{}}_syncTabsWidth_(){try{let n=this.tabsBar;if(!n)return;if(this.tabsPosition==="left"){n.style.width="",n.style.maxWidth="";return}let o=this.cardContainer||this.__scaleOuter;if(!o)return;let s=0;try{let u=o.getBoundingClientRect();s=u&&u.width?u.width:0}catch{}if(s<=0&&this.__scaleOuter&&this.__scaleOuter!==o)try{let u=this.__scaleOuter.getBoundingClientRect();s=u&&u.width?u.width:0}catch{}s>0&&(n.style.width=`${s}px`,n.style.maxWidth=`${s}px`)}catch{}}_isTypingTarget_(n){var u,c,d,g;if(!n||n===window||n===document)return!1;let o=(u=n.closest)==null?void 0:u.call(n,'input, textarea, [contenteditable="true"], ha-textfield, mwc-textfield');if(!o)return!1;let s=((d=(c=o.tagName)==null?void 0:c.toLowerCase)==null?void 0:d.call(c))||"";return s==="input"||s==="textarea"||((g=o.hasAttribute)==null?void 0:g.call(o,"contenteditable"))}_scheduleReflowAndScale(){this.__reflowRAF||(this.__reflowRAF=requestAnimationFrame(()=>{var n,o;this.__reflowRAF=null;try{(this.containerSizeMode||this.container_size_mode||"dynamic").toLowerCase()==="dynamic"&&((n=this._resizeContainer)==null||n.call(this))}catch{}try{(o=this._applyAutoScale)==null||o.call(this)}catch{}}))}__ddcBindPointerListeners(){if(!this.__ddcPtrBound){this.__ddcPtrBound=!0,this.__onDDCPointerDown=n=>{var o,s;try{if(n.button!==void 0&&n.button!==0)return;let u=((o=n.composedPath)==null?void 0:o.call(n))||[],c=null;for(let d of u)if(d&&d.classList&&d.classList.contains("card-wrapper")){c=d;break}if(!c)return;this.__ddcDragging=!0,this.__scaleOuter&&(this.__prevOverflow=this.__scaleOuter.style.overflow,this.__scaleOuter.style.overflow="visible"),(s=this._scheduleReflowAndScale)==null||s.call(this)}catch{}},this.__onDDCPointerMove=n=>{var o;try{if(!this.__ddcDragging)return;(o=this._scheduleReflowAndScale)==null||o.call(this)}catch{}},this.__onDDCPointerUp=n=>{var o;try{if(!this.__ddcDragging)return;this.__ddcDragging=!1,this.__scaleOuter&&(this.__scaleOuter.style.overflow=this.__prevOverflow||"");try{(o=this._applyAutoScale)==null||o.call(this)}catch{}}catch{}};try{this.addEventListener("pointerdown",this.__onDDCPointerDown,{passive:!0})}catch{}try{this.addEventListener("pointermove",this.__onDDCPointerMove,{passive:!0})}catch{}try{window.addEventListener("pointerup",this.__onDDCPointerUp,{passive:!0})}catch{}try{window.addEventListener("pointercancel",this.__onDDCPointerUp,{passive:!0})}catch{}}}_ensureScaleWrapper(){let n=this.cardContainer;if(!n||this.__scaleOuter&&this.__scaleOuter.contains(n))return;let o=document.createElement("div");o.className="ddc-scale-outer",Object.assign(o.style,{position:"relative",width:"100%",overflow:"hidden"}),n.parentNode&&(n.parentNode.insertBefore(o,n),o.appendChild(n)),Object.assign(n.style,{position:"absolute",top:"0",left:"0",transformOrigin:"top left"}),this.__scaleOuter=o}_hasCardModDeep(n){try{if(!n||typeof n!="object")return!1;if(n.card_mod||n.type==="custom:mod-card")return!0;if(n.card)return this._hasCardModDeep(n.card);if(Array.isArray(n.cards)){for(let o of n.cards)if(this._hasCardModDeep(o))return!0}return!1}catch{return!1}}_rebuildOnce(n){try{if(!n||(this.__rebuiltCards||(this.__rebuiltCards=new WeakSet),this.__rebuiltCards.has(n)))return;this.__rebuiltCards.add(n),n.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}}_deepQueryAll(n,o=document){let s=[],u=c=>{if(!c)return;if(c.querySelectorAll)try{c.querySelectorAll(n).forEach(x=>s.push(x))}catch{}let d=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,null),g=c;for(;g;){let x=g.shadowRoot;x&&u(x),g=d.nextNode()}};return u(o),s}_syncEditorsStorageKey(){try{let n=this.storageKey||"";this._deepQueryAll("#storage_key").forEach(s=>{try{s&&s.tagName==="INPUT"&&s.value!==n&&(s.value=n,s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}})}catch{}}static _genKey(){var o,s;return`layout_${((s=(o=globalThis.crypto)==null?void 0:o.randomUUID)==null?void 0:s.call(o))||`${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}`}static getStubConfig(){return{type:"custom:drag-and-drop-card",storage_key:this._genKey(),grid:10,drag_live_snap:!1,auto_save:!0,auto_save_debounce:800,container_size_mode:"dynamic",hero_image:"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png"}}static getConfigElement(){let n=document.createElement("div");n.innerHTML=`
    <style>
      :host, .ddc-editor { font-family: var(--paper-font-body1_-_font-family, Roboto, system-ui, sans-serif); color: var(--primary-text-color); }

      .ddc-editor { display: grid; grid-template-columns: 220px 1fr; gap: 10px 16px; align-items: center; box-sizing: border-box; padding: 8px 4px; }
      .section { grid-column: 1 / -1; margin: 10px 0 2px; font-weight: 600; opacity: 0.9; }
      .row-spacer { grid-column: 1 / -1; height: 2px; background: var(--divider-color); opacity: .2; border-radius: 2px; }

      .label { align-self: flex-start; padding-top: 6px; font-weight: 600; opacity: .9; }
      .helper { grid-column: 2 / 3; font-size: .85rem; opacity: .7; margin-top: -6px; }

      .inline { display: inline-flex; align-items: center; gap: 8px; }
      .two-col { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }

      .actions { grid-column: 1 / -1; display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px; }
      .actions ha-button[disabled] { opacity: .6; }

      /* Subtle pulse for enabled Apply button */
      @keyframes ddcPulse {
        0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0,0,0,0); }
        50% { transform: scale(1.035); box-shadow: 0 0 12px 2px rgba(255,255,255,.22); }
      }
      #applyBtn:not([disabled]) { animation: ddcPulse 1.8s ease-in-out infinite; }

      /* Make HA inputs fill width nicely */
      ha-textfield, ha-select { width: 100%; }

      /* Checkbox rows: keep left column reserved so alignment stays consistent */
      .left-empty { visibility: hidden; }

</style>

     <div class="ddc-editor">
      <div class="section">Layout & Behavior</div>

      <div class="label">Storage key</div>
      <ha-textfield id="storage_key" label="Storage key" placeholder="my_unique_layout_key"></ha-textfield>
      <div class="helper">Unique key for saving layout positions. Auto-generated if empty.</div>

      <div class="label">Grid size</div>
      <ha-textfield id="grid" label="Grid (px)" type="number" min="4" max="32" step="1" value="10"></ha-textfield>
      <div class="helper">Pixel size of each grid cell. Affects snap and default card size.</div>

      <div class="label">Snap while dragging</div>
      <ha-formfield label="Snap to grid during drag (live)">
        <ha-checkbox id="liveSnap"></ha-checkbox>
      </ha-formfield>
      <div class="helper">If on, elements snap to grid while dragging. If off, snap occurs on drop.</div>

      <div class="label">Auto-save</div>
      <div class="two-col">
        <ha-formfield label="Auto-save changes">
          <ha-checkbox id="autoSave"></ha-checkbox>
        </ha-formfield>
        <ha-textfield id="autoSaveDebounce" label="Debounce (ms)" type="number" min="0" step="50" value="800"></ha-textfield>
      </div>
      <div class="helper">When enabled, layout changes are saved automatically after a short delay.</div>

      <div class="row-spacer"></div>
      <div class="section">Appearance</div>

      <div class="label">Container background</div>
      <ha-textfield id="containerBg" label="CSS color/gradient" placeholder="transparent, #232f3e, linear-gradient(...)" helper=""></ha-textfield>
      <div class="helper">Examples: <code>transparent</code>, <code>#232f3e</code>, <code>linear-gradient(...)</code>.</div>

      <div class="label">Card background</div>
      <ha-textfield id="cardBg" label="CSS color/gradient" placeholder="var(--ha-card-background) or #ffffffcc"></ha-textfield>
      <div class="helper">Background for each card in the layout; can use theme vars.</div>

      <div class="label">Debug logs</div>
      <ha-formfield label="Enable console debug">
        <ha-checkbox id="debug"></ha-checkbox>
      </ha-formfield>

      <div class="label">Disable overlap</div>
      <ha-formfield label="Prevent cards from overlapping">
        <ha-checkbox id="noOverlap"></ha-checkbox>
      </ha-formfield>

      <div class="label">Auto-resize cards</div>
      <ha-formfield label="Scale layout to fit parent (view mode)">
        <ha-checkbox id="autoResize"></ha-checkbox>
      </ha-formfield>


      <div class="row-spacer"></div>
      <div class="section">Container Size</div>

      <div class="label">Mode</div>
      <ha-select id="sizeMode" label="Container size mode">
        <mwc-list-item value="dynamic">Dynamic (auto)</mwc-list-item>
        <mwc-list-item value="fixed_custom">Fixed (custom)</mwc-list-item>
        <mwc-list-item value="preset">Preset</mwc-list-item>
      </ha-select>

      <div class="label">Fixed size</div>
      <div class="inline" id="sizeCustom" style="display:none">
        <ha-textfield id="sizeW" type="number" label="W" min="100" step="10"></ha-textfield>
        <ha-textfield id="sizeH" type="number" label="H" min="100" step="10"></ha-textfield>
      </div>

      <div class="label">Preset</div>
      <div class="inline" id="sizePresetWrap" style="display:none">
        <ha-select id="sizePreset" label="Preset"></ha-select>
        <ha-select id="sizeOrientation" label="Orientation">
          <mwc-list-item value="auto">Auto</mwc-list-item>
          <mwc-list-item value="landscape">Landscape</mwc-list-item>
          <mwc-list-item value="portrait">Portrait</mwc-list-item>
        </ha-select>
      </div>

      <div class="actions">
        <ha-button id="revertBtn">Revert</ha-button>
        <ha-button id="applyBtn" raised disabled>Apply</ha-button>
      </div>
    </div>
  `;let o=()=>{let y=g();c.disabled=!y},s=()=>{let y=n.getConfig();n.dispatchEvent(new CustomEvent("config-changed",{detail:{config:y}})),o()},u=()=>{let y=n.querySelector("#sizeMode").value;n.querySelector("#sizeCustom").style.display=y==="fixed_custom"?"inline-flex":"none",n.querySelector("#sizePresetWrap").style.display=y==="preset"?"inline-flex":"none"},c=n.querySelector("#applyBtn"),d=n.querySelector("#revertBtn");["#sizeMode","#sizePreset","#sizeOrientation"].forEach(y=>{let v=n.querySelector(y);if(v){try{v.fixedMenuPosition=!0}catch{}v.addEventListener("closed",S=>S.stopPropagation())}}),n.setConfig=(y={})=>{var S,O,z,E,P,I,k,M;n._config={type:y.type||"custom:drag-and-drop-card",...y},n._config.storage_key||(n._config.storage_key=`layout_${((S=crypto==null?void 0:crypto.randomUUID)==null?void 0:S.call(crypto))||Date.now().toString(36)}`,n.__autokeyPending=!0),n.querySelector("#storage_key").value=n._config.storage_key||"",n.querySelector("#grid").value=(O=n._config.grid)!=null?O:10,n.querySelector("#liveSnap").checked=!!n._config.drag_live_snap,n.querySelector("#autoSave").checked=n._config.auto_save!==!1,n.querySelector("#autoSaveDebounce").value=(z=n._config.auto_save_debounce)!=null?z:800,n.querySelector("#containerBg").value=(E=n._config.container_background)!=null?E:"transparent",n.querySelector("#cardBg").value=(P=n._config.card_background)!=null?P:"var(--ha-card-background, var(--card-background-color))",n.querySelector("#debug").checked=!!n._config.debug,n.querySelector("#noOverlap").checked=!!n._config.disable_overlap,n.querySelector("#autoResize").checked=!!n._config.auto_resize_cards,n.querySelector("#sizeMode").value=n._config.container_size_mode||"dynamic",n.querySelector("#sizeW").value=(I=n._config.container_fixed_width)!=null?I:"",n.querySelector("#sizeH").value=(k=n._config.container_fixed_height)!=null?k:"",n.querySelector("#sizeOrientation").value=n._config.container_preset_orientation||"auto";let v=n.querySelector("#sizePreset");if(!v.__filled){let T=(((M=this._sizePresets)==null?void 0:M.call(this))||[]).reduce((b,D)=>{var F;return(b[F=D.group||"other"]||(b[F]=[])).push(D),b},{});v.innerHTML="";for(let[b,D]of Object.entries(T)){let F=document.createElement("optgroup");F.label=b.replace(/(^.|-.?)/g,R=>R.toUpperCase()),D.forEach(R=>{let K=document.createElement("mwc-list-item");K.value=R.key,K.textContent=`${R.label} (${R.w}\xD7${R.h})`,F.appendChild(K)});let U=document.createElement("mwc-list-item");U.setAttribute("disabled",""),U.textContent=`\u2014 ${F.label} \u2014`,v.appendChild(U),Array.from(F.children).forEach(R=>v.appendChild(R))}v.__filled=!0}n._config.container_preset&&(v.value=n._config.container_preset),u(),o(),n.__autokeyPending&&(n.__autokeyPending=!1,s())},n.getConfig=()=>{let y={...n._config||{}};return y.storage_key=n.querySelector("#storage_key").value||"",y.grid=Number(n.querySelector("#grid").value||10),y.drag_live_snap=!!n.querySelector("#liveSnap").checked,y.auto_save=!!n.querySelector("#autoSave").checked,y.auto_save_debounce=Number(n.querySelector("#autoSaveDebounce").value||800),y.container_background=n.querySelector("#containerBg").value||"transparent",y.card_background=n.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",y.debug=!!n.querySelector("#debug").checked,y.disable_overlap=!!n.querySelector("#noOverlap").checked,y.auto_resize_cards=!!n.querySelector("#autoResize").checked,y.container_size_mode=n.querySelector("#sizeMode").value,y.container_fixed_width=Number(n.querySelector("#sizeW").value||0)||void 0,y.container_fixed_height=Number(n.querySelector("#sizeH").value||0)||void 0,y.container_preset=n.querySelector("#sizePreset").value||void 0,y.container_preset_orientation=n.querySelector("#sizeOrientation").value||"auto",y};let g=()=>{let y=n.getConfig(),v=n._config||{};try{return JSON.stringify(y)!==JSON.stringify(v)}catch{return!0}},x=(y,v="input")=>{var S;return(S=n.querySelector(y))==null?void 0:S.addEventListener(v,()=>{y==="#sizeMode"&&u(),o()})};return x("#storage_key"),x("#grid"),x("#liveSnap","change"),x("#autoSave","change"),x("#autoSaveDebounce"),x("#containerBg"),x("#cardBg"),x("#debug","change"),x("#noOverlap","change"),x("#autoResize","change"),x("#sizeMode","change"),x("#sizeW"),x("#sizeH"),x("#sizePreset","selected"),x("#sizeOrientation","selected"),c==null||c.addEventListener("click",()=>{s()}),d==null||d.addEventListener("click",()=>n.setConfig(n._config)),n}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let n=Math.max(100,Number(this.containerFixedWidth||0)),o=Math.max(100,Number(this.containerFixedHeight||0));return{w:n,h:o}}if(this.containerSizeMode==="preset"){let n=e._sizePresets().find(u=>u.key===this.containerPreset)||e._sizePresets().find(u=>u.key==="fhd");if(!n)return{w:1920,h:1080};let o=n.w,s=n.h;return this.containerPresetOrient==="portrait"&&o>s&&([o,s]=[s,o]),this.containerPresetOrient==="landscape"&&s>o&&([o,s]=[s,o]),{w:o,h:s}}return null}_applyContainerSizingFromConfig(n=!1){var s,u;let o=this.cardContainer;if(o)if(this._isContainerFixed()){let{w:c,h:d}=this._resolveFixedSize();o.style.width=`${c}px`,o.style.height=`${d}px`,o.style.overflow="hidden",n||(s=this._dbgPush)==null||s.call(this,"size","Applied fixed size",{w:c,h:d,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else o.style.overflow="hidden",n||(u=this._dbgPush)==null||u.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let n=this.cardContainer;if(!n)return{w:0,h:0};let o=parseFloat(getComputedStyle(n).width)||n.getBoundingClientRect().width,s=parseFloat(getComputedStyle(n).height)||n.getBoundingClientRect().height;return{w:o,h:s}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:n,h:o}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(u=>{let c=parseFloat(u.getAttribute("data-x"))||0,d=parseFloat(u.getAttribute("data-y"))||0,g=parseFloat(u.style.width)||u.getBoundingClientRect().width,x=parseFloat(u.style.height)||u.getBoundingClientRect().height,y=Math.max(0,Math.min(c,Math.max(0,n-g))),v=Math.max(0,Math.min(d,Math.max(0,o-x))),S=Math.min(g,n),O=Math.min(x,o);(S!==g||O!==x)&&(u.style.width=`${S}px`,u.style.height=`${O}px`);let z=Math.max(0,Math.min(y,Math.max(0,n-S))),E=Math.max(0,Math.min(v,Math.max(0,o-O)));this._setCardPosition(u,z,E)})}_applyGridVars(){var o;let n=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",n),(o=this.cardContainer)==null||o.style.setProperty("--ddc-grid-size",n)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(n,o,s=null){let u={t:new Date().toISOString(),kind:n,msg:o,extra:s};this._dbgBuffer.push(u),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${n}]%c ${o}`,"color:#03a9f4","color:unset",s!=null?s:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(n){return String(n).replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o])}setConfig(n={}){var u,c,d,g,x,y,v,S,O,z,E,P,I,k,M,T,b,D,F,U,R,K;let o=this.storageKey;this.config={...n},(!this.config.storage_key||this.config.storage_key==="")&&(this.config.storage_key=this.constructor._genKey()),this.storageKey=this.config.storage_key,n.storage_key||(this.storageKey?n={...n,storage_key:this.storageKey}:(this.storageKey=`layout_${((u=crypto==null?void 0:crypto.randomUUID)==null?void 0:u.call(crypto))||Date.now().toString(36)}`,n={...n,storage_key:this.storageKey})),this._config=n,this.storageKey=n.storage_key,this._syncEditorsStorageKey(),this.storageKey=n.storage_key||void 0,this._syncEditorsStorageKey(),this.gridSize=Number((c=n.grid)!=null?c:10),this.dragLiveSnap=!!n.drag_live_snap,this.autoSave=n.auto_save!==!1,this.autoSaveDebounce=Number((d=n.auto_save_debounce)!=null?d:800),this.containerBackground=(g=n.container_background)!=null?g:"transparent",this.cardBackground=(x=n.card_background)!=null?x:"var(--ha-card-background, var(--card-background-color))",this.hideHaHeader=!!((v=(y=n.hide_HA_Header)!=null?y:n.hide_ha_header)!=null&&v),this.hideHaSidebar=!!((O=(S=n.hide_HA_Sidebar)!=null?S:n.hide_ha_sidebar)!=null&&O),this.debug=!!n.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!n.disable_overlap,this.containerSizeMode=n.container_size_mode||"dynamic",this.autoResizeCards=!!n.auto_resize_cards,this.autoResizeCards?(z=this._startScaleWatch)==null||z.call(this):(E=this._stopScaleWatch)==null||E.call(this),(P=this._applyAutoScale)==null||P.call(this),this.containerFixedWidth=Number((I=n.container_fixed_width)!=null?I:0)||null,this.containerFixedHeight=Number((k=n.container_fixed_height)!=null?k:0)||null,this.containerPreset=n.container_preset||"fullhd",this.containerPresetOrient=n.container_preset_orientation||"auto",this.heroImage=(n==null?void 0:n.hero_image)||"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png",this.tabs=Array.isArray(n.tabs)?n.tabs:[],this.tabsPosition=n.tabs_position==="left"?"left":"top",this.defaultTab=n.default_tab||((T=(M=this.tabs[0])==null?void 0:M.id)!=null?T:"default"),this.hideTabsWhenSingle=n.hide_tabs_when_single!==!1,this.activeTab=this.defaultTab;try{let W=localStorage.getItem(`ddc_lasttab_${this.storageKey}`);W&&this.tabs.some(Y=>Y.id===W)&&(this.activeTab=W)}catch{}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left"),this.cardContainer&&this._applyContainerSizingFromConfig(!1);let s=o!==this.storageKey;if(this.editMode&&!this.__booting&&!s)try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._applyGridVars();try{(b=this._applyBackgroundImageFromConfig)==null||b.call(this)}catch{}try{(D=this._applyHaChromeVisibility_)==null||D.call(this)}catch{}if(this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:n.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let W=document.createElement("script");W.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(W)}if(!window.interact){let W=document.createElement("script");W.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",W.onload=()=>this._initInteract(),document.head.appendChild(W)}if(this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),!this._built){this._built=!0,this.shadowRoot.innerHTML=`
        <style>
          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            transform-origin: top left;
            padding: 10px;
            border: 1px solid var(--divider-color);
            background: var(--ddc-bg, transparent);
            width: auto; height: auto; border-radius: 12px; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }
          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:1;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }
          /* background image layer (always behind grid and cards) */
          .card-container::after{
            content:'';
            position:absolute; inset:0;
            pointer-events:none;
            z-index:0;
            opacity: var(--ddc-bg-opacity, 1);
            background-image: var(--ddc-bg-image, none);
            background-repeat: var(--ddc-bg-repeat, no-repeat);
            background-size: var(--ddc-bg-size, cover);
            background-position: var(--ddc-bg-position, center center);
            background-attachment: var(--ddc-bg-attachment, scroll);
            filter: var(--ddc-bg-filter, none);
          }
    

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab;
            /* ensure buttons and resize handles remain visible on very small cards */
            overflow:auto;
            border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:2;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
        .chip{
            position:absolute;
            top:8px;
            right:8px;
            display:flex;
            gap:6px;
            flex-wrap:wrap;             /* allow chip buttons to wrap when space is limited */
            opacity:0;
            transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .chip .mini{
            display:inline-flex;align-items:center;gap:6px;
            background:rgba(28,28,30,.78);color:#fff;border:1px solid rgba(255,255,255,.18);
            border-radius:999px;padding:6px 10px;font-size:.76rem;cursor:pointer;letter-spacing:.2px;
            box-shadow:0 2px 6px rgba(0,0,0,.25); transition:transform .08s, background .12s, box-shadow .12s
          }
          .chip .mini:hover{transform:translateY(-1px); background:rgba(28,28,30,.95); box-shadow:0 3px 10px rgba(0,0,0,.35)}
          .chip .mini ha-icon{--mdc-icon-size:18px;width:18px;height:18px}
          .chip .mini.danger{background:rgba(220, 38, 38, .9);border-color:rgba(255,255,255,.22)}
          .chip .mini.danger:hover{background:rgba(220, 38, 38, 1)}
          .chip .mini.pill{padding:6px}

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:none;                 /* shown in edit mode via your existing rule */
            position:absolute;
            bottom:8px;                   /* move INSIDE the wrapper bounds */
            right:8px;                    /* so it can't be clipped by overflow */
            width:28px;
            height:28px;
            border-radius:50%;
            background:var(--primary-color);
            color:#fff;
            border:1px solid rgba(255,255,255,.25);
            cursor:se-resize;
            z-index:999;                  /* above the card content */
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            align-items:center;
            justify-content:center;
          }
          .resize-handle:hover{transform:scale(1.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{--mdc-icon-size:18px;width:18px;height:18px;pointer-events:none}

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96%);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{
            border-right:1px solid var(--divider-color);
            overflow:auto;
            background:var(--primary-background-color);
            /*
             * Remove contain:content so that fixed-position menus from
             * custom card editors can correctly position themselves
             * relative to the viewport. CSS containment can interfere
             * with anchoring of overlays.
             */
            contain:none;
          }
          /*
           * Allow content like dropdown menus from custom card editors to
           * overflow the right pane without being clipped. Using overflow
           * visible instead of hidden prevents menus from being positioned
           * far away or requiring excessive scrolling when they open.
           */
          #rightPane{
            /* Allow the right-hand editor pane to scroll vertically when
             * content from custom card editors exceeds the available space.
             * We hide horizontal overflow to avoid layout shifts. */
            overflow-y:auto;
            overflow-x:hidden;
            background:var(--primary-background-color);
          }
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{
            border:1px solid var(--divider-color);
            border-radius:12px;
            background:var(--card-background-color);
            overflow:visible;
            position:relative;
            /* Remove content containment on sections to prevent the
             * creation of an artificial containing block which can
             * disrupt dropdown positioning. */
            contain:none;
          }
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}
          .cm-editor{height: 100%}
          /* --- FIX: YAML/Visual editor: ensure the entire content is visible --- */
          /*
           * The YAML editor previously had a fixed height which caused the
           * bottom of longer configurations to be clipped. Removing the fixed
           * height allows the section to flex based on available space within
           * the grid row. A min-height of zero lets it collapse when there
           * isn't much content, while overflow:auto enables scrolling when
           * content exceeds the visible area.
           */
          #yamlSec {
            min-height: 0;
            height: auto !important;
            overflow: auto;
          }
          #yamlSec .bd {
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            overflow: auto;
            max-height: none;
            /* Fill the available grid row height (1fr) so that scrolling
             * happens inside this section rather than expanding the editor
             * beyond the modal boundary. A min-height of zero ensures the
             * section can shrink when little content is present. */
            height: 100%;
            min-height: 0;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec {
            min-height: 0;
            overflow: auto;
          }
          #optionsSec .bd {
            position: relative;
            overflow: auto;
            height: auto;
            max-height: none;
            min-height: 0;
          }
          #editorHost {
            display: block;
            min-height: 0;
          }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: allow growth but set a sensible minimum
           * so that very short snippets don't collapse. Using min-height
           * instead of a fixed height allows the editor to expand when the
           * parent container grows. The !important flag ensures that the
           * component\u2019s inline styles from HA won\u2019t override this sizing.
           */
          ha-code-editor {
            display: block;
            min-height: 260px;
            height: auto !important;
          }
          .CodeMirror {
            min-height: 260px;
            height: auto !important;
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            overflow: visible; 
            height: auto;
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            position: relative;
            display:flex; align-items:center; justify-content:center;
            width:100%; height:100%;
            border-radius:16px;
            overflow: hidden;
            /* cool gradient derived from HA primary color */
            background:
              radial-gradient(120% 120% at 100% 0%,
                color-mix(in srgb, var(--primary-color) 18%, #000 0%) 0%,
                transparent 60%),
              linear-gradient(135deg,
                color-mix(in srgb, var(--primary-color) 70%, #000 0%) 0%,
                color-mix(in srgb, var(--primary-color) 35%, #000 0%) 100%);
          }

          /* subtle shine */
          .ddc-placeholder-inner::after{
            content:"";
            position:absolute; inset:0;
            background: radial-gradient(120% 90% at 0% 100%, rgba(255,255,255,.15), transparent 60%);
            pointer-events:none;
          }

          /* center stack */
          .ddc-hero{
            position:absolute; inset:0;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            gap:16px; text-align:center; padding:24px;
            color:rgba(255,255,255,.98);
            text-shadow:0 1px 2px rgba(0,0,0,.35);
            user-select:none; pointer-events:none; /* click goes to shield below */
          }

          .ddc-hero img{
            width:128px; height:128px; object-fit:contain; opacity:.95; filter: drop-shadow(0 4px 14px rgba(0,0,0,.25));
          }

          .ddc-hero .ddc-title{
            font-weight:800; font-size:1.25rem; letter-spacing:.2px;
          }

          .ddc-hero .ddc-sub{
            font-weight:600; opacity:.95;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }

                /* --- Tabs bar (DDC) --- */
          /* --- WILD DDC Tabs (drop in and replace your block) --- */

          /* --- DDC Tabs \u2014 Chrome-style, no backdrop, mobile-friendly --- */

          /* --- DDC Tabs \u2014 Chrome-style, fills width, steady hover (no bounce), stronger active shadow --- */

          /* Tabs bar (transparent, no backdrop) */
 /* --- DDC Tabs \u2014 Chrome-style, centered content, smooth tab-change, faint inactive outline --- */

        /* Tabs bar (transparent, no backdrop; fills width) */
        .ddc-tabs{
          position: relative;
          display: flex; flex-wrap: wrap;
          align-items: flex-end; /* Chrome-like baseline */
          gap: 6px;
          padding: 6px 10px;
          width: 100%;
          overflow-x: hidden;
          overflow-y: hidden;
          -webkit-overflow-scrolling: touch;
          scroll-snap-type: x proximity;
          background: transparent;
          border-bottom: 1px solid var(--divider-color, rgba(0,0,0,.12));
          scrollbar-width: thin;
          scrollbar-color: color-mix(in oklab, var(--primary-text-color) 35%, transparent) transparent;
        }
        .ddc-tabs::-webkit-scrollbar { height: 8px; }
        .ddc-tabs::-webkit-scrollbar-thumb {
          background: color-mix(in oklab, var(--primary-text-color) 35%, transparent);
          border-radius: 9999px;
        }
        .ddc-tabs::-webkit-scrollbar-track { background: transparent; }

        /* Tab: fills available width, centered icon+text, no hover bounce */
        .ddc-tab{
          -webkit-tap-highlight-color: transparent;
          position: relative;
          z-index: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;             /* 1) center content */
          text-align: center;                  /* 1) center label text */
          gap: 8px;
          padding: 8px 12px;
          font: 500 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
          letter-spacing: .2px;
          color: color-mix(in oklab, var(--primary-text-color) 75%, #000 0%);
          cursor: pointer;

          /* fill width but remain scrollable when crowded */
          flex: 1 1 clamp(120px, 18%, 280px);
          min-width: clamp(120px, 18%, 280px);
          max-width: 100%;
          scroll-snap-align: start;

          margin: 0;                           /* no overlap for steady layout */
          border: 0;
          background: transparent;

          /* 2&3) keep motion minimal; animate only color/shadow/line */
          transition: color .18s ease, filter .18s ease, box-shadow .18s ease, border-color .18s ease;
        }
        .ddc-tab ha-icon{ --mdc-icon-size:18px; }
        .ddc-tab .ddc-tab-label{ max-width: 100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

        /* 3) Inactive tabs have a faint outline */
        .ddc-tab::before{
          content:"";
          position:absolute;
          inset: 0;
          border-top-left-radius: 14px;
          border-top-right-radius: 14px;
          border: 1px solid color-mix(in oklab, var(--primary-text-color) 12%, transparent); /* faint */
          border-bottom: none;
          background: transparent;
          pointer-events: none;
          z-index: -1;
        }

        /* Subtle hover: clearer text only (no movement) */
        .ddc-tab:hover{
          color: var(--primary-text-color);
          filter: saturate(1.05);
        }

        /* Active tab: elevated, stronger shadow */
        .ddc-tab.active{
          color: var(--primary-text-color);
          z-index: 2;
        }
        .ddc-tab.active::before{
          background: var(--card-background-color, #fff);
          border-color: var(--divider-color, rgba(0,0,0,.18));
          box-shadow:
            0 10px 24px rgba(0,0,0,.16),
            0 4px 10px rgba(0,0,0,.10),
            0 0 0 1px color-mix(in oklab, var(--primary-text-color) 10%, transparent);
          animation: ddc-pop .18s ease-out;  /* quick, pleasing shadow pop */
        }

        /* 2) Animated TOP line \u2013 appears quickly when tab becomes active */
        .ddc-tab::after{
          content:"";
          position:absolute;
          top: -2px; left: 10px; right: 10px;
          height: 0;                            /* hidden by default */
          border-radius: 3px 3px 0 0;
          background: linear-gradient(90deg, var(--primary-color), #ff4ecd, #00e0ff, var(--primary-color));
          background-size: 300% 100%;
          opacity: 0;
          transform: scaleX(0);                  /* prepare for quick reveal */
          transform-origin: 50% 50%;
          transition: transform .16s ease-out, height .16s ease-out, opacity .16s ease-out;
          pointer-events: none;
        }
        .ddc-tab.active::after{
          height: 3px;
          opacity: 1;
          transform: scaleX(1);
          animation: ddc-rainbow 4s linear infinite;
        }

        /* Pressed: keep still (no bounce) */
        .ddc-tab:active{ box-shadow: 0 1px 0 rgba(0,0,0,0); }

        /* Focus ring without motion */
        .ddc-tab:focus-visible{
          outline: none;
          box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary-color) 45%, transparent);
        }

        /* Mobile scaling \u2014 smaller min width & tighter paddings */
        @media (max-width: 640px){
          .ddc-tabs{ gap: 4px; padding: 6px 8px; }
          .ddc-tab{
            flex: 1 1 clamp(96px, 34%, 200px);
            min-width: clamp(96px, 34%, 200px);
            padding: 6px 10px;
            font-size: 12px;
          }
          .ddc-tab::after{ left: 8px; right: 8px; }
        }

        /* Vertical tabs rail (transparent) \u2014 centered content too */
        .ddc-tabs-left{
          display:flex;
          flex-direction:column;
          align-items: stretch;
          width: clamp(150px, 28%, 220px);
          padding: 8px 6px;
          gap: 6px;
          overflow-y: auto;
          overflow-x: hidden;
          border-right: 1px solid var(--divider-color, rgba(0,0,0,.12));
          border-bottom: none;
          background: transparent;
        }
        .ddc-tabs-left .ddc-tab{
          justify-content: center;             /* 1) center in vertical list as well */
          margin: 0;
          border: 1px solid color-mix(in oklab, var(--primary-text-color) 12%, transparent);
          border-radius: 10px;
          padding: 8px 10px;
          flex: 0 0 auto;
        }
        .ddc-tabs-left .ddc-tab::before{ display:none; }
        .ddc-tabs-left .ddc-tab.active{
          background: var(--card-background-color, #fff);
          box-shadow: 0 4px 12px rgba(0,0,0,.12);
        }
        .ddc-tabs-left .ddc-tab.active::after{ display:none; } /* top line is only for horizontal */

        /* Animations */
        @keyframes ddc-rainbow{
          0% { background-position: 0% 50%; }
          100% { background-position: 300% 50%; }
        }
        @keyframes ddc-pop{
          0% { box-shadow: 0 0 0 rgba(0,0,0,0); }
          100% {
            box-shadow:
              0 10px 24px rgba(0,0,0,.16),
              0 4px 10px rgba(0,0,0,.10),
              0 0 0 1px color-mix(in oklab, var(--primary-text-color) 10%, transparent);
          }
        }

      
        </style>
        <div class="ddc-root">
          <div class="toolbar">
            <button class="btn" id="addCardBtn" style="display:none">
              <ha-icon icon="mdi:plus"></ha-icon>
              <span style="margin-left:6px">Add Card</span>
            </button>
            <button class="btn secondary" id="reloadBtn" style="display:none">
              <ha-icon icon="mdi:refresh"></ha-icon>
              <span style="margin-left:6px">Reload</span>
            </button>
            <button class="btn secondary" id="diagBtn" style="display:none">
              <ha-icon icon="mdi:play-circle-outline"></ha-icon>
              <span style="margin-left:6px">Diagnostics</span>
            </button>
            <button class="btn secondary" id="exportBtn" style="display:none">
              <ha-icon icon="mdi:download"></ha-icon>
              <span style="margin-left:6px">Export Design</span>
            </button>
            <button class="btn secondary" id="importBtn" style="display:none">
              <ha-icon icon="mdi:upload"></ha-icon>
              <span style="margin-left:6px">Import Design</span>
            </button>
            <button class="btn" id="applyLayoutBtn" style="display:none">
              <ha-icon icon="mdi:content-save"></ha-icon>
              <span style="margin-left:6px">Apply</span>
            </button>
            <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
              <ha-icon icon="mdi:storefront-outline"></ha-icon>
              <span>Open HADS</span>
            </button>
            <button class="btn warning" id="exitEditBtn" style="display:none">
              <ha-icon icon="mdi:exit-run"></ha-icon>
              <span>Exit edit mode</span>
            </button>
            <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
          </div>
          <div class="ddc-tabs" id="tabsBar" style="display:none"></div>
          <div class="card-container" id="cardContainer"></div>
        </div>
      `,this.cardContainer=this.shadowRoot.querySelector("#cardContainer");try{(F=this._applyBackgroundImageFromConfig)==null||F.call(this)}catch{}this.addButton=this.shadowRoot.querySelector("#addCardBtn"),this.reloadBtn=this.shadowRoot.querySelector("#reloadBtn"),this.diagBtn=this.shadowRoot.querySelector("#diagBtn"),this.exitEditBtn=this.shadowRoot.querySelector("#exitEditBtn"),this.storeBadge=this.shadowRoot.querySelector("#storeBadge"),this.exportBtn=this.shadowRoot.querySelector("#exportBtn"),this.importBtn=this.shadowRoot.querySelector("#importBtn"),this.exploreBtn=this.shadowRoot.querySelector("#exploreBtn"),this.applyLayoutBtn=this.shadowRoot.querySelector("#applyLayoutBtn"),this.tabsBar=this.shadowRoot.querySelector("#tabsBar"),this.rootEl=this.shadowRoot.querySelector(".ddc-root");try{this._renderTabs(),this._applyActiveTab()}catch{}this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.applyLayoutBtn.addEventListener("click",()=>this._saveLayout(!1)),window.addEventListener("keydown",W=>{var Y;if(this.editMode){if((W.ctrlKey||W.metaKey)&&(W.key==="s"||W.key==="S")&&(W.preventDefault(),this._saveLayout(!1)),!this.__ddcResizeObs&&this.autoResizeCards){this.__ddcResizeObs=new ResizeObserver(()=>{var Q;return(Q=this._applyAutoScale)==null?void 0:Q.call(this)});try{this.__ddcResizeObs.observe(this)}catch{}try{this.__ddcResizeObs.observe(this.cardContainer)}catch{}try{this.parentElement&&this.__ddcResizeObs.observe(this.parentElement)}catch{}try{this.offsetParent&&this.__ddcResizeObs.observe(this.offsetParent)}catch{}window.addEventListener("resize",this.__ddcOnWinResize=()=>{var Q;return(Q=this._applyAutoScale)==null?void 0:Q.call(this)})}(Y=this._applyAutoScale)==null||Y.call(this)}}),this.exploreBtn.addEventListener("click",()=>window.open("https://hads.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),(U=this._applyAutoScale)==null||U.call(this),this._installLongPressToEnterEdit(),(R=this._startScaleWatch)==null||R.call(this),window.addEventListener("keydown",W=>{var Y;W.key==="Escape"&&this.editMode&&this._toggleEditMode(!1),this.__ddcResizeObs||(this.__ddcResizeObs=new ResizeObserver(()=>{var Q;return(Q=this._applyAutoScale)==null?void 0:Q.call(this)}),this.__ddcResizeObs.observe(this),this.__ddcResizeObs.observe(this.cardContainer),window.addEventListener("resize",this.__ddcOnWinResize=()=>{var Q;return(Q=this._applyAutoScale)==null?void 0:Q.call(this)})),(Y=this._applyAutoScale)==null||Y.call(this)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",W=>{this.editMode&&(W.target.closest(".card-wrapper")||!W.shiftKey&&!W.ctrlKey&&!W.metaKey&&this._clearSelection())})}try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),this.__cfgReady=!0,s&&this.__booted?this._initialLoad(!0):!this.__booted&&this.__probed?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),(K=this._applyAutoScale)==null||K.call(this),this._resizeContainer())}connectedCallback(){var n,o;try{(n=this._applyHaChromeVisibility_)==null||n.call(this)}catch{}if(this.__keyHandlerBound||(this.__keyHandler=s=>this._onKeyDown_(s),window.addEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!0),this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1),!this.__visObs){let s=new IntersectionObserver(u=>{u.some(c=>c.isIntersecting)&&requestAnimationFrame(()=>this._applyAutoScale&&this._applyAutoScale())},{root:null,threshold:0});s.observe(this),this.__visObs=s}this.__ddcOnWinResize=this.__ddcOnWinResize||(()=>this._applyAutoScale&&this._applyAutoScale()),window.addEventListener("resize",this.__ddcOnWinResize);try{(o=this.__ddcBindPointerListeners)==null||o.call(this)}catch{}}disconnectedCallback(){var n,o,s,u,c;try{(n=this._setHeaderVisible_)==null||n.call(this,!0),(o=this._setSidebarVisible_)==null||o.call(this,!0)}catch{}try{(s=this._applyHaChromeVisibility_)==null||s.call(this)}catch{}this.__keyHandlerBound&&this.__keyHandler&&(window.removeEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!1,this.__keyHandler=null),this.__keyHandlerBound||(this.__keyHandler=d=>this._onKeyDown_(d),window.addEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!0),window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis);try{(u=this.__ddcResizeObs)==null||u.disconnect()}catch{}if(this.__ddcResizeObs=null,(c=this._stopScaleWatch)==null||c.call(this),this.__ddcOnWinResize&&(window.removeEventListener("resize",this.__ddcOnWinResize),this.__ddcOnWinResize=null),this.__lpInstalled&&this.__lpHandlers){let d=this.cardContainer;d==null||d.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),d==null||d.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}try{this.__visObs&&this.__visObs.disconnect()}catch{}this.__visObs=null,this.__ddcOnWinResize&&window.removeEventListener("resize",this.__ddcOnWinResize);try{this.__ddcPtrBound&&(this.removeEventListener("pointerdown",this.__onDDCPointerDown),this.removeEventListener("pointermove",this.__onDDCPointerMove),window.removeEventListener("pointerup",this.__onDDCPointerUp),window.removeEventListener("pointercancel",this.__onDDCPointerUp),this.__ddcPtrBound=!1)}catch{}}set hass(n){var s;this._hass=n,ll("set hass"),!this.__probed&&n&&(this.__probed=!0,this._probeBackend().then(()=>{this.__probed=!0,!this.__booted&&this.__cfgReady&&(this.__booted=!0,this._initialLoad(!0))}));let o=((s=this.cardContainer)==null?void 0:s.children)||[];for(let u of o){let c=u.firstElementChild;c&&c.hass!==n&&(c.hass=n)}}get hass(){return this._hass}async _initialLoad(n=!1){var o,s,u,c,d,g,x,y,v,S,O,z,E,P,I,k;if(!this.__booting){this.__booting=!0;try{this._loading=!0,n&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:n});let M=[],T=null;if(this._backendOK&&this.storageKey)try{T=await this._loadLayoutFromBackend(this.storageKey)}catch(R){this._dbgPush("boot","Backend load failed",{error:String(R)})}if(!T&&this.storageKey){let R=null;try{R=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(R)if(this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(R).length}),this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,R),this._dbgPush("boot","Migrated local -> backend"),T=R}catch(K){this._dbgPush("boot","Migration failed, staying local",{error:String(K)}),T=R}else T=R}!T&&((s=(o=this._config)==null?void 0:o.cards)!=null&&s.length)&&(this._dbgPush("boot","Using embedded config"),T={cards:this._config.cards});let b={...this._config||{}};if(T!=null&&T.options){let{storage_key:R,...K}=T.options;this._applyImportedOptions(K,!0)}else typeof(T==null?void 0:T.grid)=="number"&&this._applyImportedOptions({grid:T.grid},!0);let D=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","auto_resize_cards"],F={};for(let R of D)b[R]!==void 0&&(F[R]=b[R]);Object.keys(F).length&&this._applyImportedOptions(F,!0);let U=!1;if((u=T==null?void 0:T.cards)!=null&&u.length){for(let R of T.cards){if(!(R!=null&&R.card)||typeof R.card=="object"&&Object.keys(R.card).length===0){let Y=this._makePlaceholderAt(((c=R.position)==null?void 0:c.x)||0,((d=R.position)==null?void 0:d.y)||0,((g=R.size)==null?void 0:g.width)||200,((x=R.size)==null?void 0:x.height)||200);this.cardContainer.appendChild(Y);try{this._rebuildOnce(Y.firstElementChild)}catch{}U=!0;continue}let K=await this._createCard(R.card),W=this._makeWrapper(K);this.editMode&&W.classList.add("editing"),W.dataset.tabId=this._normalizeTabId(R.tabId||R.tab_id||this.defaultTab),this._setCardPosition(W,((y=R.position)==null?void 0:y.x)||0,((v=R.position)==null?void 0:v.y)||0),W.style.width=`${(O=(S=R.size)==null?void 0:S.width)!=null?O:14*this.gridSize}px`,W.style.height=`${(E=(z=R.size)==null?void 0:z.height)!=null?E:10*this.gridSize}px`,R.z!=null&&(W.style.zIndex=String(R.z)),this.cardContainer.appendChild(W);try{this._rebuildOnce(W.firstElementChild)}catch{}this._initCardInteract(W),U=!0}this._resizeContainer(),(P=this._applyAutoScale)==null||P.call(this),this._dbgPush("boot","Layout applied",{count:T.cards.length})}U||(this._showEmptyPlaceholder(),(I=this._applyAutoScale)==null||I.call(this),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI(),n&&(this._cardModProcessed=!1),setTimeout(()=>{this._processCardModOnce()},100);try{M.forEach(R=>{try{R.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}})}catch{}}finally{this._loading=!1,this.__booting=!1,this.__dirty=!1,(k=this._updateApplyBtn)==null||k.call(this);try{this._renderTabs(),this._applyActiveTab()}catch{}}}}_normalizeTabId(n){let o=Array.isArray(this.tabs)?this.tabs.map(s=>s.id):[];return o.length?n&&o.includes(n)?n:this.defaultTab||o[0]:this.defaultTab||"default"}_renderTabs(){var s,u,c;let n=this.tabsBar;if(!n)return;let o=Array.isArray(this.tabs)?this.tabs:[];if(!o.length||o.length===1&&this.hideTabsWhenSingle){n.style.display="none";return}n.style.display="",n.className="ddc-tabs "+(this.tabsPosition==="left"?"ddc-tabs-left":""),n.innerHTML="";for(let d of o){let g=document.createElement("button");g.className="ddc-tab"+(d.id===this.activeTab?" active":""),g.dataset.tabId=d.id,g.title=d.label||d.id,g.innerHTML=`${d.icon?`<ha-icon icon="${d.icon}"></ha-icon>`:""}<span class="ddc-tab-label">${(s=d.label)!=null?s:d.id}</span>`,g.addEventListener("click",()=>{if(this.activeTab!==d.id){this.activeTab=d.id;try{localStorage.setItem(`ddc_lasttab_${this.storageKey}`,d.id)}catch{}this._applyActiveTab(),this._renderTabs()}}),n.appendChild(g)}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left");try{(u=this._updateTabsA11y_)==null||u.call(this)}catch{}try{(c=this._syncTabsWidth_)==null||c.call(this)}catch{}}_applyActiveTab(){var s,u;let n=this._normalizeTabId(this.activeTab);(((u=(s=this.cardContainer)==null?void 0:s.querySelectorAll)==null?void 0:u.call(s,".card-wrapper"))||[]).forEach(c=>{var g;let d=c.dataset.tabId?this._normalizeTabId(c.dataset.tabId):this.defaultTab;if(!this.tabs||!this.tabs.length){c.style.display="",c.inert=!1,c.classList.remove("ddc-hidden");return}d===n?(c.style.display="",c.inert=!1,c.classList.remove("ddc-hidden")):(c.style.display="none",c.inert=!0,c.classList.add("ddc-hidden"),c.classList.remove("ddc-selected"),(g=this._applyAutoScale)==null||g.call(this))});try{this._clearSelection()}catch{}}_addTabSelectorToChip(n,o=null){if(!this.tabs||!this.tabs.length)return;let s=n.querySelector(".chip");if(!s)return;let u=s.querySelector("select.ddc-chip-tab");u||(u=document.createElement("select"),u.className="ddc-chip-tab",u.style.marginLeft="6px",u.title="Assign to tab",s.appendChild(u)),u.innerHTML="";for(let d of this.tabs){let g=document.createElement("option");g.value=d.id,g.textContent=d.label||d.id,u.appendChild(g)}let c=this._normalizeTabId(o||n.dataset.tabId||this.activeTab||this.defaultTab);u.value=c,n.dataset.tabId=c,u.onchange=()=>{n.dataset.tabId=this._normalizeTabId(u.value),this._applyActiveTab();try{this._queueSave("tab-change")}catch{}}}_toggleEditMode(n=null){var c,d,g,x,y;try{(c=this.__clearPressTimer)==null||c.call(this)}catch{}let o=n===null?!this.editMode:!!n,s=!this.editMode&&o;if(this.editMode=o,this.editMode=o,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this.applyLayoutBtn.style.display=this.editMode?"inline-block":"none",this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(v=>{v.classList.toggle("editing",this.editMode);let S=v.querySelector(".resize-handle");S&&(S.style.display=this.editMode?"flex":"none"),!v.dataset.placeholder&&window.interact&&window.interact(v).draggable(this.editMode).resizable(this.editMode),v.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(d=this.cardContainer)==null||d.querySelectorAll(".card-wrapper.dragging").forEach(v=>v.classList.remove("dragging")),s){let v=(g=this.__lastHoldX)!=null?g:null,S=(x=this.__lastHoldY)!=null?x:null;this._playEditRipple(v,S)}try{(y=this._applyHaChromeVisibility_)==null||y.call(this)}catch{}}_isInHaEditorPreview(){let n=this;for(;n;){let o=n.nodeType===1&&n.localName?n.localName.toLowerCase():"";if(o==="hui-card-editor"||o==="hui-dialog-edit-card"||o==="hui-card-preview"||o==="ha-dialog"||o==="mwc-dialog")return!0;let s=n.getRootNode&&n.getRootNode();n=n.parentElement||s&&s.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let n=this.cardContainer;if(!n)return;let o=800,s=18,u=b=>!!b&&typeof b=="object"&&b.nodeType===1,c=(b,D)=>{try{return!!(b&&D&&typeof b.contains=="function"&&u(D)&&b.contains(D))}catch{return!1}},d=b=>c(this.cardContainer,b),g=b=>{var U,R,K;let D=(R=(U=b.target)==null?void 0:U.closest)==null?void 0:R.call(U,".card-wrapper");if(u(D)&&d(D)&&!D.classList.contains("ddc-placeholder"))return!0;let F=typeof b.composedPath=="function"?b.composedPath():[];for(let W of F)if(u(W)&&d(W)&&(K=W.classList)!=null&&K.contains("card-wrapper")&&!W.classList.contains("ddc-placeholder"))return!0;return!1},x=(b,D)=>{let F=document.createElement("div");F.className="ddc-press-ring",document.body.appendChild(F),Object.assign(F.style,{position:"fixed",left:`${b}px`,top:`${D}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),F.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let U=F.querySelector(".pr-fg"),R=18,K=2*Math.PI*R;return U.style.strokeDasharray=`${K}`,U.style.strokeDashoffset=`${K}`,requestAnimationFrame(()=>{U.style.transition=`stroke-dashoffset ${o}ms linear`,U.style.strokeDashoffset="0"}),{el:F,move(W,Y){F.style.left=`${W}px`,F.style.top=`${Y}px`},remove(){try{F.remove()}catch{}}}},y=null,v=null,S=0,O=0,z=null,E=()=>{y&&clearTimeout(y),y=null,v==null||v.remove(),v=null};this.__clearPressTimer=E;let P=b=>{b.pointerType==="mouse"&&b.button!==0||this._isInHaEditorPreview()||!d(b.target)||g(b)||(z=b.pointerId,S=b.clientX,O=b.clientY,this.__lastHoldX=S,this.__lastHoldY=O,v=x(S,O),y=setTimeout(()=>{var F;E();let D=!this.editMode;this._toggleEditMode(D),(F=this._toast)==null||F.call(this,`Edit mode ${D?"enabled":"disabled"}`)},o))},I=b=>{y==null||b.pointerId!==z||(v==null||v.move(b.clientX,b.clientY),(Math.abs(b.clientX-S)>s||Math.abs(b.clientY-O)>s)&&E())},k=b=>{b.pointerId===z&&(E(),z=null)},M=b=>{if(y)return b.preventDefault(),b.stopPropagation(),!1},T=b=>{var F;if(this._isInHaEditorPreview()||!d(b.target)||g(b))return;let D=!this.editMode;this._toggleEditMode(D),(F=this._toast)==null||F.call(this,`Edit mode ${D?"enabled":"disabled"}`)};n.addEventListener("pointerdown",P),window.addEventListener("pointermove",I,{passive:!0}),window.addEventListener("pointerup",k,{passive:!0}),window.addEventListener("pointercancel",k,{passive:!0}),window.addEventListener("contextmenu",M),n.addEventListener("dblclick",T),this.__lpHandlers={onPointerDown:P,onPointerMove:I,onPointerUpOrCancel:k,onContextMenu:M,onDblClick:T}}_isLayoutEmpty(){let n=this.cardContainer;return n?n.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let n=this._isLayoutEmpty();if(this.addButton){let s=this.editMode||n;this.addButton.style.display=s?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&n)}let o=s=>s&&(s.style.display=this.editMode?"inline-block":"none");o(this.reloadBtn),o(this.diagBtn),o(this.exitEditBtn),o(this.exportBtn),o(this.importBtn),o(this.exploreBtn),o(this.storeBadge),o(this.applyLayoutBtn)}_updateApplyBtn(){this.applyLayoutBtn&&(this.applyLayoutBtn.disabled=!this.__dirty)}_markDirty(n=""){var o;this.__dirty=!0,this._updateApplyBtn(),(o=this._dbgPush)==null||o.call(this,"dirty","Marked dirty",{reason:n})}_playEditRipple(n=null,o=null){let s=this.cardContainer;if(!s)return;let u=s.getBoundingClientRect(),c=n==null?u.left+u.width/2:n,d=o==null?u.top+u.height/2:o,g=c-u.left,x=d-u.top,y=document.createElement("div");y.className="ddc-ripple-veil",y.style.setProperty("--rip-x",`${g}px`),y.style.setProperty("--rip-y",`${x}px`),s.appendChild(y),setTimeout(()=>y.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(o=>this._initCardInteract(o))}_initCardInteract(n){if(!window.interact||n.dataset.placeholder)return;let o=this.gridSize,s=!!this.dragLiveSnap,c=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let d=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});c.push(window.interact.modifiers.snap({targets:[d],range:1/0,offset:"startCoords"}))}window.interact(n).draggable({enabled:this.editMode,inertia:!1,modifiers:c,listeners:{start:d=>{this._selection.has(n)||(!(d!=null&&d.shiftKey)&&!(d!=null&&d.ctrlKey)&&!(d!=null&&d.metaKey)&&this._clearSelection(),this._toggleSelection(n,!0));let g=Array.from(this._selection);this.__groupDrag={leader:n,members:g,startRaw:new Map(g.map(y=>[y,{x:parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,y:parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0,w:parseFloat(y.style.width)||y.getBoundingClientRect().width,h:parseFloat(y.style.height)||y.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(y=>{let v=parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,S=parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0;this.__collisionOriginals.set(y,{x:v,y:S})}),g.forEach(y=>{y.classList.add("dragging"),y.getAttribute("data-x-raw")===null&&y.setAttribute("data-x-raw",y.getAttribute("data-x")||"0"),y.getAttribute("data-y-raw")===null&&y.setAttribute("data-y-raw",y.getAttribute("data-y")||"0")})},move:d=>{if(!this.__groupDrag)return;let g=this.gridSize,x=!!this.dragLiveSnap,y=this.__groupDrag.leader,v=this.__groupDrag.startRaw.get(y),S=(parseFloat(y.getAttribute("data-x-raw"))||v.x)+d.dx,O=(parseFloat(y.getAttribute("data-y-raw"))||v.y)+d.dy,z=S-v.x,E=O-v.y,P=this.__groupDrag.members.map(I=>{let k=this.__groupDrag.startRaw.get(I),M=k.x+z,T=k.y+E,b=x?Math.round(M/g)*g:M,D=x?Math.round(T/g)*g:T;return{el:I,rawX:M,rawY:T,snapX:b,snapY:D,w:k.w,h:k.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(P,z,E,x,g),y.setAttribute("data-x-raw",String(S)),y.setAttribute("data-y-raw",String(O));for(let I of P)I.el.setAttribute("data-x-raw",String(I.rawX)),I.el.setAttribute("data-y-raw",String(I.rawY)),this._setCardPosition(I.el,I.snapX,I.snapY);this._resizeContainer()},end:d=>{if(!this.__groupDrag)return;let g=this.gridSize,x=this.__groupDrag.members.map(y=>{let v=parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,S=parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0,O=Math.round(v/g)*g,z=Math.round(S/g)*g,E=parseFloat(y.style.width)||y.getBoundingClientRect().width,P=parseFloat(y.style.height)||y.getBoundingClientRect().height;return{el:y,rawX:v,rawY:S,snapX:O,snapY:z,w:E,h:P}});this.disableOverlap&&this._pushCardsOutOfTheWay(x,0,0,!1,g);for(let y of x)this._setCardPosition(y.el,y.snapX,y.snapY),y.el.setAttribute("data-x-raw",String(y.snapX)),y.el.setAttribute("data-y-raw",String(y.snapY));for(let y of this.__groupDrag.members)y.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(n).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:d=>{let g=this.gridSize,x=!!this.dragLiveSnap,y=parseFloat(n.style.width)||n.getBoundingClientRect().width,v=parseFloat(n.style.height)||n.getBoundingClientRect().height,{width:S,height:O}=d.rect,z=x?Math.max(g,Math.round(S/g)*g):S,E=x?Math.max(g,Math.round(O/g)*g):O,P=parseFloat(n.getAttribute("data-x"))||0,I=parseFloat(n.getAttribute("data-y"))||0,k=z,M=E;if(this._isContainerFixed()){let{w:b,h:D}=this._getContainerSize();k=Math.min(z,Math.max(this.gridSize,b-P)),M=Math.min(E,Math.max(this.gridSize,D-I))}let T=[this._rectFor(n,P,I,k,M)];this.disableOverlap&&this._anyCollisionFor(T,new Set([n]))||(n.style.width=`${k}px`,n.style.height=`${M}px`,this._resizeContainer())},end:()=>{let d=this.gridSize,g=parseFloat(n.style.width)||n.getBoundingClientRect().width,x=parseFloat(n.style.height)||n.getBoundingClientRect().height,y=Math.max(d,Math.round(g/d)*d),v=Math.max(d,Math.round(x/d)*d),S=parseFloat(n.getAttribute("data-x"))||0,O=parseFloat(n.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:E,h:P}=this._getContainerSize();y=Math.min(y,Math.max(d,E-S)),v=Math.min(v,Math.max(d,P-O))}let z=[this._rectFor(n,S,O,y,v)];this.disableOverlap&&this._anyCollisionFor(z,new Set([n]))||(n.style.width=`${y}px`,n.style.height=`${v}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),n.addEventListener("mousedown",d=>{this.editMode&&(d.target.closest(".resize-handle")||d.target.closest(".chip")||(d.shiftKey||d.ctrlKey||d.metaKey?(d.stopPropagation(),this._toggleSelection(n)):this._selection.has(n)||(this._clearSelection(),this._toggleSelection(n,!0))))})}async _createCard(n){let s=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(n);if(s.hass=this.hass,n.type==="custom:mod-card"&&(await new Promise(u=>setTimeout(u,0)),s.setConfig&&typeof s.setConfig=="function"))try{s.setConfig(n)}catch{}return s}_makeWrapper(n){let o=document.createElement("div");o.classList.add("card-wrapper"),o.dataset.tabId=this._normalizeTabId(this.activeTab||this.defaultTab),this.editMode&&o.classList.add("editing"),o.style.zIndex||(o.style.zIndex=String(this._highestZ()+1));let s=document.createElement("div");s.className="chip",s.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini danger pill" data-act="delete" title="Delete card" aria-label="Delete card">
        <ha-icon icon="mdi:close-thick"></ha-icon>
      </button>
    `;try{this._addTabSelectorToChip(o,o.dataset.tabId)}catch{}s.addEventListener("click",async d=>{var x,y,v,S,O;d.stopPropagation();let g=(v=(y=(x=d.target)==null?void 0:x.closest("button"))==null?void 0:y.dataset)==null?void 0:v.act;if(g){if(g==="delete")this._selection.size>1&&this._selection.has(o)?(Array.from(this._selection).forEach(E=>E.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(o.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(g==="duplicate"||g==="copy"){let z=this._selection.size>1&&this._selection.has(o)?Array.from(this._selection):[o];for(let E of z){let P=this._extractCardConfig(E.firstElementChild)||{},I=await this._createCard(P),k=this._makeWrapper(I);k.style.width=E.style.width,k.style.height=E.style.height;let M=(parseFloat(E.getAttribute("data-x"))||0)+this.gridSize,T=(parseFloat(E.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(k,M,T),k.style.zIndex=String(this._highestZ()+1);try{let b=(S=E.dataset)==null?void 0:S.tabId;b&&(k.dataset.tabId=b)}catch{}this.cardContainer.appendChild(k);try{(O=this._addTabSelectorToChip)==null||O.call(this,k,k.dataset.tabId)}catch{}try{this._rebuildOnce(k.firstElementChild)}catch{}this._initCardInteract(k)}this._resizeContainer(),this._queueSave("duplicate")}else if(g==="front")this._adjustZ(o,1);else if(g==="back")this._adjustZ(o,-1);else if(g==="edit"){let z=this._extractCardConfig(o.firstElementChild)||{};await this._openSmartPicker("edit",z,async E=>{var k,M,T;let P=o.firstElementChild,I=await this._createCard(E);try{o.dataset.cfg=JSON.stringify(E),(k=this._hasCardModDeep)!=null&&k.call(this,E)?o.dataset.needsCardMod="true":delete o.dataset.needsCardMod}catch{}o.replaceChild(I,P),await Hi();try{if(I.hass=this.hass,(M=I.requestUpdate)==null||M.call(I),I.updateComplete)try{await I.updateComplete}catch{}}catch{}try{this._rebuildOnce(I)}catch{}try{I.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}(T=this._resizeContainer)==null||T.call(this);try{clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(b){console.warn("Save before reload failed",b)}window.location.reload()})}}});let u=document.createElement("div");u.className="shield";let c=document.createElement("div");c.classList.add("resize-handle"),this.editMode||(c.style.display="none"),c.title="Resize",c.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>';try{let d=n._config||n.config;d&&typeof d=="object"&&Object.keys(d).length&&(o.dataset.cfg=JSON.stringify(d),this._hasCardModDeep(d)&&(o.dataset.needsCardMod="true"))}catch{}o.append(n,u,s,c);try{this._rebuildOnce(n)}catch{}return o}_makePlaceholderAt(n=0,o=0,s=400,u=400){let c=document.createElement("div");c.classList.add("card-wrapper","ddc-placeholder"),c.dataset.placeholder="1",this.editMode&&c.classList.add("editing"),this._setCardPosition(c,n,o),c.style.width=`${s}px`,c.style.height=`${u}px`,c.style.zIndex=String(this._highestZ()+1);let d=document.createElement("div");d.className="ddc-placeholder-inner",d.setAttribute("aria-hidden","true");let g=document.createElement("div");g.className="ddc-hero";let x=this.heroImage;if(x){let O=document.createElement("img");O.src=x,O.alt="",g.appendChild(O)}let y=document.createElement("div");y.className="ddc-title",y.textContent="Drag & Drop Card";let v=document.createElement("div");v.className="ddc-sub",v.textContent="Hold me / double click me to enter Edit mode",g.append(y,v),d.appendChild(g),c.addEventListener("dblclick",O=>{O.stopPropagation(),this._toggleEditMode(!0)});let S=document.createElement("div");return S.className="shield",c.append(d,S),c}_processCardModOnce(){var o;if(this._cardModProcessed)return;this._cardModProcessed=!0,(((o=this.cardContainer)==null?void 0:o.querySelectorAll('[data-needs-card-mod="true"]'))||[]).forEach(s=>{let u=s.firstElementChild;if(!u)return;let c=u._config||u.config;if(c){if(c.type==="custom:mod-card")setTimeout(()=>{if(u.updateComplete)u.updateComplete.then(()=>{u.requestUpdate()});else if(u.setConfig)try{u.setConfig({...c})}catch{}},100);else if(c.card_mod&&u.setConfig)try{u.setConfig({...c})}catch{}}})}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let n=this._makePlaceholderAt(0,0,200,200);this.cardContainer.appendChild(n),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(n=>n.remove())}_ensurePlaceholderIfEmpty(){var o;this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),(o=this._applyAutoScale)==null||o.call(this),this._syncEmptyStateUI()}_adjustZ(n,o){let u=parseInt(n.style.zIndex||"1",10)+o;u=Math.max(1,Math.min(9999,u)),n.style.zIndex=String(u),this._queueSave("z-change")}_highestZ(){let n=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(o=>{let s=parseInt(o.style.zIndex||"0",10);s>n&&(n=s)}),n}_setCardPosition(n,o,s){let u=Math.round(o),c=Math.round(s);n.style.transform=`translate3d(${u}px, ${c}px, 0)`,n.setAttribute("data-x",String(u)),n.setAttribute("data-y",String(c)),n.setAttribute("data-x-raw",String(u)),n.setAttribute("data-y-raw",String(c))}_computeDesignSize(){let n=this.cardContainer;if(!n)return{w:1,h:1};if(this._isContainerFixed()){let{w:d,h:g}=this._resolveFixedSize();return{w:Math.max(1,d),h:Math.max(1,g)}}let o=0,s=0,u=Array.from(n.querySelectorAll(".card-wrapper"));if(!u.length){let d=n.getBoundingClientRect();return{w:Math.max(1,d.width||1),h:Math.max(1,d.height||1)}}for(let d of u){let g=parseFloat(d.getAttribute("data-x-raw")||d.getAttribute("data-x")||"0")||0,x=parseFloat(d.getAttribute("data-y-raw")||d.getAttribute("data-y")||"0")||0,y=parseFloat(d.style.width)||d.getBoundingClientRect().width||0,v=parseFloat(d.style.height)||d.getBoundingClientRect().height||0,S=g+y,O=x+v;S>o&&(o=S),O>s&&(s=O)}let c=Math.max(1,this.gridSize||10);return o=Math.ceil(o/c)*c,s=Math.ceil(s/c)*c,{w:Math.max(1,o),h:Math.max(1,s)}}_startScaleWatch(){if(!this.autoResizeCards||this.__scaleRAF)return;let n=()=>{var u;if(!this.autoResizeCards){this.__scaleRAF=null;return}let o=this.getBoundingClientRect(),s=Math.max(1,o.width||0);s!==this.__lastScaleW&&(this.__lastScaleW=s,(u=this._applyAutoScale)==null||u.call(this)),this.__scaleRAF=requestAnimationFrame(n)};this.__scaleRAF=requestAnimationFrame(n)}_stopScaleWatch(){if(this.__scaleRAF){try{cancelAnimationFrame(this.__scaleRAF)}catch{}this.__scaleRAF=null}}_applyAutoScale(){var d,g,x,y,v,S,O,z,E,P;let n=this.cardContainer;if(!n)return;if(typeof this._ensureScaleWrapper=="function"&&this._ensureScaleWrapper(),!this.autoResizeCards){let I=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:n.offsetWidth||1,h:n.offsetHeight||1};if(n.style.width=`${I.w}px`,n.style.height=`${I.h}px`,n.style.transform="scale(1)",n.style.transformOrigin="top left",n.style.position="absolute",n.style.top="0",n.style.left="0",this.__scaleOuter){let k=this.parentElement&&((g=(d=this.parentElement).getBoundingClientRect)==null?void 0:g.call(d).width)||this.offsetParent&&((y=(x=this.offsetParent).getBoundingClientRect)==null?void 0:y.call(x).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||I.w;this.__scaleOuter.style.width=`${Math.max(1,k)}px`,this.__scaleOuter.style.height=`${Math.max(1,I.h)}px`}try{(v=this._syncTabsWidth_)==null||v.call(this)}catch{}return}let o=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:n.offsetWidth||1,h:n.offsetHeight||1},s=this.parentElement&&((O=(S=this.parentElement).getBoundingClientRect)==null?void 0:O.call(S).width)||this.offsetParent&&((E=(z=this.offsetParent).getBoundingClientRect)==null?void 0:E.call(z).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||o.w,u=Math.max(1,s),c=Math.min(u/Math.max(1,o.w),1);this.__scaleOuter&&(this.__scaleOuter.style.width=`${u}px`,this.__scaleOuter.style.height=`${Math.max(1,o.h*c)}px`),n.style.width=`${o.w}px`,n.style.height=`${o.h}px`,n.style.transform=`scale(${c})`,n.style.transformOrigin="top left",n.style.position="absolute",n.style.top="0",n.style.left="0";try{(P=this._syncTabsWidth_)==null||P.call(this)}catch{}}_resizeContainer(){var c;let n=this.cardContainer;if(!n||this._isContainerFixed())return;let o=Array.from(n.querySelectorAll(".card-wrapper")),s=0,u=0;o.forEach(d=>{let g=d.getBoundingClientRect(),x=n.getBoundingClientRect(),y=g.left-x.left+g.width,v=g.top-x.top+g.height;s=Math.max(s,y),u=Math.max(u,v)}),n.style.width=`${Math.ceil(s/this.gridSize)*this.gridSize||100}px`,n.style.height=`${Math.ceil(u/this.gridSize)*this.gridSize||100}px`;try{(c=this._syncTabsWidth_)==null||c.call(this)}catch{}}_pushCardsOutOfTheWay(n,o,s,u,c){if(!this.__collisionOriginals)return;let d=new Set(n.map(k=>k.el)),g=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(k=>!k.dataset.placeholder),x=this._isContainerFixed(),{w:y,h:v}=this._getContainerSize();for(let k of g){if(d.has(k))continue;let M=this.__collisionOriginals.get(k);if(M){k.setAttribute("data-x-raw",String(M.x)),k.setAttribute("data-y-raw",String(M.y));let T=u?Math.round(M.x/c)*c:M.x,b=u?Math.round(M.y/c)*c:M.y;this._setCardPosition(k,T,b)}}let S=n.map(k=>({x:k.snapX,y:k.snapY,w:k.w,h:k.h})),O=new Map,z=new Map;for(let k of g){let M=parseFloat(k.style.width)||k.getBoundingClientRect().width,T=parseFloat(k.style.height)||k.getBoundingClientRect().height;z.set(k,{w:M,h:T})}let E=o>0?1:o<0?-1:0,P=s>0?1:s<0?-1:0,I=Math.abs(o)>=Math.abs(s);for(let k of g){if(d.has(k))continue;let M=this.__collisionOriginals.get(k);if(!M)continue;let{x:T,y:b}=M,{w:D,h:F}=z.get(k),U=!1;for(let R of S)if(this._rectsOverlap({x:R.x,y:R.y,w:R.w,h:R.h},{x:T,y:b,w:D,h:F})){U=!0,I&&E!==0?T=E>0?R.x+R.w:R.x-D:!I&&P!==0?b=P>0?R.y+R.h:R.y-F:T=R.x+R.w;break}if(U){let R=0,K=I?E!==0?E*c:c:0,W=I?0:P!==0?P*c:c;for(;R<100;){let Y={x:T,y:b,w:D,h:F},Q=!1;for(let se of S)if(this._rectsOverlap(Y,se)){Q=!0;break}if(!Q){for(let[,se]of O)if(this._rectsOverlap(Y,se)){Q=!0;break}}if(!Q&&x&&(T<0||b<0||T+D>y||b+F>v)&&(Q=!0),!Q)break;T+=K,b+=W,R++}x&&(T=Math.max(0,Math.min(T,Math.max(0,y-D))),b=Math.max(0,Math.min(b,Math.max(0,v-F))))}O.set(k,{x:T,y:b,w:D,h:F}),S.push({x:T,y:b,w:D,h:F})}for(let[k,M]of O){k.setAttribute("data-x-raw",String(M.x)),k.setAttribute("data-y-raw",String(M.y));let T=u?Math.round(M.x/c)*c:M.x,b=u?Math.round(M.y/c)*c:M.y;this._setCardPosition(k,T,b)}}_rectFor(n,o=null,s=null,u=null,c=null){let d=o!=null?o:parseFloat(n.getAttribute("data-x"))||0,g=s!=null?s:parseFloat(n.getAttribute("data-y"))||0,x=u!=null?u:parseFloat(n.style.width)||n.getBoundingClientRect().width||0,y=c!=null?c:parseFloat(n.style.height)||n.getBoundingClientRect().height||0;return{x:d,y:g,w:x,h:y,el:n}}_rectsOverlap(n,o,s=.5){return!(n.x+n.w<=o.x+s||o.x+o.w<=n.x+s||n.y+n.h<=o.y+s||o.y+o.h<=n.y+s)}_anyCollisionFor(n,o){let s=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(c=>!o.has(c)&&!c.dataset.placeholder);if(!s.length)return!1;let u=s.map(c=>this._rectFor(c));for(let c of n)for(let d of u)if(this._rectsOverlap(c,d))return!0;return!1}_extractCardConfig(n){var s;if(!n)return{};let o=n._config||n.config;if(o&&typeof o=="object"&&Object.keys(o).length)return o;try{let u=n.closest?n.closest(".card-wrapper"):null,c=(s=u==null?void 0:u.dataset)==null?void 0:s.cfg;if(c){let d=JSON.parse(c);if(d&&typeof d=="object")return d}}catch{}return{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(n,o){try{console.info("[ddc:editor] Requesting editor element",{type:n,cfg:o})}catch{}let s=await this._helpersPromise||await window.loadCardHelpers();try{typeof n=="string"&&n&&!n.startsWith("custom:")&&n!=="custom_card"&&await this._ensureCardModuleLoaded(n,o)}catch{}let u=async()=>{try{if(s.getCardElementClass)return await s.getCardElementClass(n);let y;if(o&&typeof o=="object")y={type:n,...o};else{let S;try{S=await this._getStubConfigForType(n)}catch{}y=S&&typeof S=="object"?{...S}:{type:n}}let v=s.createCardElement(y);return(v==null?void 0:v.constructor)||null}catch{return null}};try{let y=await u();if(y&&typeof y.getConfigElement=="function"){let v=await y.getConfigElement();if(v){try{console.info("[ddc:editor] Found static class editor",{type:n})}catch{}return v}}}catch{}if(typeof n=="string"&&(n.startsWith("custom:")||n==="custom_card"||n==="entity"))try{let y;try{y=await this._getStubConfigForType(n)}catch{}let v=y&&typeof y=="object"?{...y}:{type:n},S=s.createCardElement(v);if(S.hass=this.hass,typeof S.getConfigElement=="function"){let O=await S.getConfigElement();if(O){try{console.info("[ddc:editor] Found instance-level editor",{type:n})}catch{}return O}}}catch{}let c=String(n).replace(/^custom:/,""),g=(Array.isArray(window.customCards)?window.customCards:[]).find(y=>(y==null?void 0:y.type)===c||(y==null?void 0:y.type)===n||(y==null?void 0:y.type)===`custom:${c}`),x=[];g!=null&&g.editor&&x.push(g.editor),x.push(`${c}-editor`,`${c}-config-editor`),c&&typeof c=="string"&&x.push(`hui-${c}-card-editor`);for(let y of x)if(!(!y||typeof y!="string"))for(let v of[0,100,300,700,1500,3e3])try{if(customElements.get(y)||await Promise.race([customElements.whenDefined(y),new Promise(S=>setTimeout(S,v))]),customElements.get(y)){try{console.info("[ddc:editor] Found editor by tag",{type:n,tag:y})}catch{}return document.createElement(y)}}catch{}return null}async _ensureCardModuleLoaded(n,o){try{let s=await this._helpersPromise||await window.loadCardHelpers(),u;if(o&&typeof o=="object")u={type:n,...o};else{let g;try{g=await this._getStubConfigForType(n)}catch{}u=g&&typeof g=="object"?{...g}:{type:n}}let c=s.createCardElement(u);c.hass=this.hass;let d=document.createElement("div");d.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;",d.appendChild(c),document.body.appendChild(d),await new Promise(g=>requestAnimationFrame(g)),d.remove();try{console.info("[ddc:editor] Warmed card module",{type:n})}catch{}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let n=document.createElement("style");n.setAttribute("data-ddc-overlay-fix",""),n.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(n)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(o=>{var s;return{type:(s=o==null?void 0:o.type)!=null&&s.startsWith("custom:")?o.type:`custom:${o==null?void 0:o.type}`,name:(o==null?void 0:o.name)||(o==null?void 0:o.type)||"Custom card",icon:"mdi:puzzle-outline",description:(o==null?void 0:o.description)||"",editorTag:(o==null?void 0:o.editor)||null}}).filter(o=>typeof o.type=="string"&&o.type.startsWith("custom:"))}_schemaForType(n){let o=u=>u,s=[];return{entities:o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities"}]}),entity:o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"}]}),sensor:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":o({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"}]}),"picture-glance":o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":o({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:o({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":o({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":o({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:o({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"}]}),button:o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity (optional)"}]}),iframe:o({fields:[{key:"url",type:"text",label:"URL"}]}),area:o({fields:[{key:"area",type:"text",label:"Area ID"}]})}[n]||{fields:[]}}_shapeBySchema(n,o={}){let s=this._schemaForType(n)||{fields:[]},u={...o,type:n};for(let c of s.fields){let d=u[c.key];if(c.type==="entities"){let x=(Array.isArray(d)?d:d!=null&&d!==""?[d]:[]).filter(Boolean);x.length?u[c.key]=x:delete u[c.key]}else if(c.type==="entity")Array.isArray(d)&&(d=d[0]),d==null||d===""?delete u[c.key]:u[c.key]=String(d);else if(c.type==="number")if(d==null||d==="")delete u[c.key];else{let g=Number(d);Number.isFinite(g)?u[c.key]=g:delete u[c.key]}else(c.type==="select"||c.type==="text"||c.type==="textarea")&&(d==null||d===""?delete u[c.key]:u[c.key]=d)}return u}_statesList(n){var u;let o=Object.keys(((u=this.hass)==null?void 0:u.states)||{});if(!n||!n.length)return o;if(!this.__domainIndex||this.__domainIndex._gen!==o.length){let c={};for(let d of o){let g=d.split(".")[0];(c[g]||(c[g]=[])).push(d)}this.__domainIndex={_gen:o.length,map:c}}let s=[];for(let c of n)this.__domainIndex.map[c]&&s.push(...this.__domainIndex.map[c]);return s}_isNumericEntity(n){var u,c;let o=(c=(u=this.hass)==null?void 0:u.states)==null?void 0:c[n];if(!o)return!1;let s=Number(o.state);return Number.isFinite(s)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(n){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(n)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(n){try{let o=this._getRecent().filter(s=>s!==n);o.unshift(n),o.length>10&&(o.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(o))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let n=document.createElement("link");n.rel="stylesheet",n.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",n.setAttribute("data-cm-core",""),document.head.appendChild(n)}await new Promise(n=>{if(window.CodeMirror)return n();let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",o.onload=n,document.head.appendChild(o)}),await new Promise(n=>{var s,u;if((u=(s=window.CodeMirror)==null?void 0:s.mimeModes)!=null&&u.yaml)return n();let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",o.onload=n,document.head.appendChild(o)}),this.__cmReady=!0}}async _mountYamlEditor(n,o,s,u){let c=x=>window.jsyaml?window.jsyaml.dump(x):JSON.stringify(x,null,2),d=x=>window.jsyaml?window.jsyaml.load(x):JSON.parse(x);n.innerHTML="";let g=c(o);if(customElements.get("ha-code-editor")){let x=document.createElement("ha-code-editor");x.mode="yaml",x.hass=this.hass,x.value=g,x.style.display="block",x.style.height="260px",n.appendChild(x);let y=!1;return x.addEventListener("value-changed",v=>{var O,z,E;if(y)return;let S=(E=(z=(O=v.detail)==null?void 0:O.value)!=null?z:x.value)!=null?E:"";try{s(d(S))}catch(P){u==null||u(P)}}),{setValue:v=>{var O;let S=c(v);((O=x.value)!=null?O:"")!==S&&(y=!0,x.value=S,y=!1)}}}try{await this._ensureCodeMirror();let x=window.CodeMirror(n,{value:g,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),y=!1;return x.on("change",()=>{if(y)return;let v=x.getValue();try{s(d(v))}catch(S){u==null||u(S)}}),{setValue:v=>{let S=c(v);x.getValue()!==S&&(y=!0,x.setValue(S),y=!1)}}}catch{let x=document.createElement("textarea");return x.style.width="100%",x.style.height="260px",x.value=g,x.addEventListener("input",()=>{try{s(d(x.value))}catch(y){u==null||u(y)}}),n.appendChild(x),{setValue:y=>{let v=c(y);x.value!==v&&(x.value=v)}}}}_createVirtualList({container:n,items:o,rowHeight:s=36,renderRow:u}){n.style.position="relative",n.style.overflow="auto";let c=document.createElement("div");c.style.height=`${o.length*s}px`,n.innerHTML="",n.appendChild(c);let d=new Map,g=()=>{let x=n.scrollTop,y=n.clientHeight,v=Math.max(0,Math.floor(x/s)-6),S=Math.min(o.length-1,Math.ceil((x+y)/s)+6);for(let[O,z]of d)(O<v||O>S)&&(z.remove(),d.delete(O));for(let O=v;O<=S;O++){if(d.has(O))continue;let z=u(o[O],O);z.style.position="absolute",z.style.left="0",z.style.right="0",z.style.top=`${O*s}px`,d.set(O,z),n.appendChild(z)}};return n.addEventListener("scroll",g,{passive:!0}),new ResizeObserver(g).observe(n),g(),{refresh(x){if(x){o=x,c.style.height=`${o.length*s}px`;for(let[,y]of d)y.remove();d.clear()}g()}}}async _openSmartPicker(n="add",o=null,s=null){let u=()=>c.remove(),c=document.createElement("div");c.className="modal",c.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${n==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${n==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${n==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.shadowRoot.appendChild(c);let d=c.querySelector("#leftPane"),g=c.querySelector("#addBtn"),x=c.querySelector("#footAdd"),y=c.querySelector("#cancelBtn"),v=c.querySelector("#footCancel"),S=c.querySelector("#search"),O=c.querySelector("#cardHost"),z=c.querySelector("#editorHost"),E=c.querySelector("#editorSpin"),P=c.querySelector("#quickFill"),I=c.querySelector("#yamlHost"),k=c.querySelector("#yamlErr"),M=c.querySelector("#yamlSec"),T=c.querySelector("#tabVisual"),b=c.querySelector("#tabYaml"),D=c.querySelector("#err"),F=c.querySelector("#previewSpin"),U=j=>{g.disabled=x.disabled=!j},R=j=>{j?(D.hidden=!1,D.textContent=j):(D.hidden=!0,D.textContent="")},K=this._getFaves(),W=this._getRecent(),Y=this._catalog(),Q=Y.find(j=>j.id==="favorites"),se=Y.find(j=>j.id==="recent"),pe=Y.flatMap(j=>j.items||[]);Q.items=pe.filter(j=>K.has(j.type)),se.items=W.map(j=>pe.find(q=>q.type===j)).filter(Boolean);let Ae=this._customCardsFromRegistry();Ae.length&&Y.push({id:"custom",name:"Custom (installed)",items:Ae});let xe=c.querySelector("#quickFillSec");xe&&(xe.style.display="none");let be=c.querySelector("#optionsSec .hd"),me,ae,Je=()=>{if(!ae)return;let j=ge&&K.has(ge),q=ae.querySelector("ha-icon");q&&q.setAttribute("icon",j?"mdi:star":"mdi:star-outline")},We=j=>{if(me){let q=pe.find(G=>G.type===j),ye=q?q.name:j||"";me.textContent=ye}Je()};if(be&&!be.querySelector(".sel-info")){let j=be.querySelector("span");j&&(j.style.display="none"),me=document.createElement("span"),me.className="sel-info",me.style.flex="1",me.style.fontWeight="bold",me.style.paddingRight="8px",be.insertBefore(me,be.firstChild),ae=document.createElement("button"),ae.className="icon-btn",ae.setAttribute("title","Favorite"),Object.assign(ae.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--primary-background-color)",padding:"0",marginLeft:"4px",cursor:"pointer"}),ae.innerHTML='<ha-icon icon="mdi:star-outline"></ha-icon>',be.appendChild(ae),ae.addEventListener("click",q=>{q.stopPropagation(),ge&&(K.has(ge)?K.delete(ge):K.add(ge),this._setFaves(K),Je(),Be())})}let ze="visual",Me=j=>{let q=j==="yaml";T.classList.toggle("active",!q),T.setAttribute("aria-selected",String(!q)),b.classList.toggle("active",q),b.setAttribute("aria-selected",String(q)),z.parentElement.style.display=q?"none":"",M.style.display=q?"":"none",q&&M.scrollIntoView({behavior:"smooth",block:"start"}),ze=q?"yaml":"visual"};T.addEventListener("click",async()=>{var j;if(Me("visual"),!fe)await ct(te);else try{(j=fe.setConfig)==null||j.call(fe,te)}catch{}}),b.addEventListener("click",()=>Me("yaml")),Me("visual");let Qe=()=>{let j=S.value.trim().toLowerCase();return Y.map(q=>({...q,items:(q.items||[]).filter(ye=>!j||ye.name.toLowerCase().includes(j)||ye.type.toLowerCase().includes(j))})).filter(q=>q.items&&q.items.length||q.id==="favorites"||q.id==="recent")},Be=()=>{let j=Qe();d.innerHTML="",j.forEach(q=>{let ye=document.createElement("div");ye.style.padding="12px",ye.style.borderBottom="1px solid var(--divider-color)";let G=document.createElement("h4");if(G.textContent=q.name,G.style.margin="0 0 10px 0",G.style.fontSize=".92rem",G.style.opacity=".85",ye.appendChild(G),!q.items.length&&(q.id==="favorites"||q.id==="recent")){let J=document.createElement("div");J.style.opacity=".6",J.style.fontSize=".85rem",J.textContent=q.id==="favorites"?"No favorites yet.":"No recent items yet.",ye.appendChild(J)}else q.items.forEach(J=>{let ue=document.createElement("button");ue.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${J.icon}"></ha-icon><span>${J.name}</span>
            </span>`,Object.assign(ue.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),ue.addEventListener("click",async()=>{X(ue),await xt(J.type)}),ye.appendChild(ue)});d.appendChild(ye)})},X=j=>{d.querySelectorAll("button").forEach(q=>{q.classList.remove("active"),q.style.background="transparent",q.style.color=""}),j&&(j.classList.add("active"),j.style.background="rgba(3,169,244,.12)",j.style.color="var(--primary-color)")},te=null,ge=null,ee=null,fe=null,we=null,Fe=0,Ue=null,lt="",tt=(j,q)=>{var ke;let ye=this._schemaForType(j);if(P.innerHTML="",!ye.fields.length){P.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let G=Object.keys(((ke=this.hass)==null?void 0:ke.states)||{}),J=document.createElement("div"),ue=(Z,Se,Oe,Ve)=>{let _e=document.createElement("div");Object.assign(_e.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),_e.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${Z}</span>`,Se.includes(Z)&&(_e.style.background="rgba(3,169,244,.12)",_e.style.borderColor="var(--primary-color)",_e.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),_e.addEventListener("click",async()=>{let Xe=Se.indexOf(Z);Xe>=0?Se.splice(Xe,1):Se.push(Z);let Ze=Se.includes(Z);_e.style.background=Ze?"rgba(3,169,244,.12)":"",_e.style.borderColor=Ze?"var(--primary-color)":"var(--divider-color)",_e.querySelector("ha-icon").setAttribute("icon",Ze?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),te=this._shapeBySchema(j,{...te,[Ve]:[...Se]}),Ne(te),ee==null||ee.setValue(te)}),Oe.appendChild(_e)};ye.fields.forEach(Z=>{var Ve,_e,Xe,Ze,Dt,Et,Ft,At,Ot;let Se=document.createElement("div");Object.assign(Se.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let Oe=document.createElement("label");if(Oe.textContent=Z.label||Z.key,Oe.style.minWidth="130px",Z.type==="entities"){let ve=document.createElement("div");ve.style.flex="1";let de=document.createElement("input");Object.assign(de,{placeholder:"Filter entities\u2026"}),Object.assign(de.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let Te=document.createElement("div");Object.assign(Te.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let He=Z.domains&&Z.domains.length?this._statesList(Z.domains):G,je=Array.isArray(q[Z.key])?[...q[Z.key]]:q[Z.key]?[q[Z.key]]:[],Tt=at=>{let Le=document.createElement("div");Object.assign(Le.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let nt=document.createElement("ha-icon");nt.setAttribute("icon","mdi:checkbox-blank-outline"),nt.style.setProperty("--mdc-icon-size","18px");let qe=document.createElement("span");qe.textContent=at,qe.style.whiteSpace="nowrap",qe.style.overflow="hidden",qe.style.textOverflow="ellipsis",Le.append(nt,qe);let Xt=()=>{let ft=je.includes(at);Le.style.background=ft?"rgba(3,169,244,.12)":"",Le.style.borderColor=ft?"var(--primary-color)":"var(--divider-color)",nt.setAttribute("icon",ft?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return Xt(),Le.addEventListener("click",()=>{let ft=je.indexOf(at);ft>=0?je.splice(ft,1):je.push(at),te=this._shapeBySchema(j,{...te,[Z.key]:[...je]}),Ne(te),ee==null||ee.setValue(te),Xt()}),Le},Rt=He;this._createVirtualList({container:Te,items:Rt,rowHeight:36,renderRow:Tt}),de.addEventListener("input",()=>{let at=de.value.trim().toLowerCase();Rt=He.filter(Le=>!at||Le.toLowerCase().includes(at)),this._createVirtualList({container:Te,items:Rt,rowHeight:36,renderRow:Tt})}),ve.append(de,Te),Se.append(Oe,ve),te=this._shapeBySchema(j,{...q,[Z.key]:je})}if(Z.type==="entity"){let ve=document.createElement("div");ve.style.flex="1",ve.style.position="relative";let de=document.createElement("input");de.setAttribute("list","ddc_entlist_"+Z.key),Object.assign(de.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),de.placeholder=`Select ${((Ve=Z.label)==null?void 0:Ve.toLowerCase())||"entity"}\u2026`;let Te=document.createElement("ha-icon");Te.setAttribute("icon","mdi:magnify"),Object.assign(Te.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let He=document.createElement("datalist");He.id="ddc_entlist_"+Z.key;let je=Z.domains&&Z.domains.length?this._statesList(Z.domains):Object.keys(((_e=this.hass)==null?void 0:_e.states)||{});He.innerHTML=je.map(Tt=>`<option value="${Tt}">`).join(""),de.value=Array.isArray(q[Z.key])?q[Z.key][0]||"":q[Z.key]||"",de.addEventListener("change",async()=>{te=this._shapeBySchema(j,{...te,[Z.key]:de.value||void 0}),Ne(te),ee==null||ee.setValue(te)}),ve.append(Te,de,He),Se.append(Oe,ve)}if(Z.type==="number"){let ve=document.createElement("div");ve.style.flex="1",ve.style.position="relative";let de=document.createElement("input");de.type="number",Z.step&&(de.step=Z.step),Object.assign(de.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let Te=document.createElement("ha-icon");Te.setAttribute("icon","mdi:counter"),Object.assign(Te.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),de.value=(Ze=(Xe=q[Z.key])!=null?Xe:Z.default)!=null?Ze:"",de.addEventListener("input",async()=>{let He=de.value===""?void 0:Number(de.value);te=this._shapeBySchema(j,{...te,[Z.key]:isNaN(He)?void 0:He}),Ne(te),ee==null||ee.setValue(te)}),ve.append(Te,de),Se.append(Oe,ve)}if(Z.type==="select"){let ve=document.createElement("div");ve.style.flex="1",ve.style.position="relative";let de=document.createElement("select");Object.assign(de.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let Te=document.createElement("ha-icon");Te.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(Te.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(Z.options||[]).forEach(He=>{let je=document.createElement("option");je.value=He,de.appendChild(je)}),de.value=(Ft=(Dt=q[Z.key])!=null?Dt:Z.default)!=null?Ft:((Et=Z.options)==null?void 0:Et[0])||"",de.addEventListener("change",async()=>{te=this._shapeBySchema(j,{...te,[Z.key]:de.value}),Ne(te),ee==null||ee.setValue(te)}),ve.append(Te,de),Se.append(Oe,ve)}if(Z.type==="text"){let ve=document.createElement("div");ve.style.flex="1",ve.style.position="relative";let de=document.createElement("input");de.type="text",Object.assign(de.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let Te=document.createElement("ha-icon");Te.setAttribute("icon","mdi:text"),Object.assign(Te.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),de.value=(At=q[Z.key])!=null?At:"",de.addEventListener("input",async()=>{te=this._shapeBySchema(j,{...te,[Z.key]:de.value||void 0}),Ne(te),ee==null||ee.setValue(te)}),ve.append(Te,de),Se.append(Oe,ve)}if(Z.type==="textarea"){let ve=document.createElement("textarea");Object.assign(ve.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),ve.value=(Ot=q[Z.key])!=null?Ot:"",ve.addEventListener("input",async()=>{te=this._shapeBySchema(j,{...te,[Z.key]:ve.value||""}),Ne(te),ee==null||ee.setValue(te)}),Se.append(Oe,ve)}J.appendChild(Se)}),P.innerHTML="",P.appendChild(J)},Ne=j=>{if(((j==null?void 0:j.type)||"")==="custom_card"){lt=JSON.stringify(j||{}),O.innerHTML='<div style="opacity:.6;font-size:.9rem;padding:8px">Preview not available for the custom card placeholder. Use the YAML editor.</div>',F.hidden=!0;return}let q=JSON.stringify(j||{});q!==lt&&(lt=q,Ue&&clearTimeout(Ue),Ue=setTimeout(async()=>{let ye=++Fe;F.hidden=!1,O.innerHTML="",await Hi();try{let G=await this._helpersPromise||await window.loadCardHelpers();if(ye!==Fe)return;let J=G.createCardElement(j);if(J.hass=this.hass,ye!==Fe)return;O.appendChild(J)}catch{}finally{ye===Fe&&(F.hidden=!0)}},150))},ct=async j=>{var G;let q=++Fe;E.hidden=!1,z.innerHTML="",await cl();let ye=j.type||ge;if(we=await this._getEditorElementForType(ye,j),ye==="custom_card"){let J=document.createElement("div");return J.style.opacity=".7",J.style.fontSize=".9rem",J.textContent="Custom card placeholder: use the YAML editor to paste the card type and options.",z.appendChild(J),fe=null,ze!=="yaml"&&Me("yaml"),U(!0),E.hidden=!0,!1}if(!we){let J=document.createElement("div");return J.style.opacity=".7",J.style.fontSize=".9rem",J.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",q===Fe&&(z.appendChild(J),E.hidden=!0),fe=null,U(!0),ze!=="visual"&&Me("yaml"),!1}try{we.hass=this.hass,we.isConnected||z.appendChild(we),await Promise.resolve();try{we.setConfig(j)}catch{}try{let ue=await this._helpersPromise||await window.loadCardHelpers(),ke=ue.getCardElementClass?await ue.getCardElementClass(j.type||ge):null;if(ke!=null&&ke.getStubConfig){let Z=Object.keys(((G=this.hass)==null?void 0:G.states)||{}),Se=Ve=>Z.filter(_e=>_e.startsWith(Ve+".")),Oe=await ke.getStubConfig(this.hass,Z,Se);Oe&&(j=this._shapeBySchema(j.type||ge,{...Oe}))}}catch{}await Promise.resolve();try{we.setConfig(j)}catch{}fe&&this.__onEditorChange&&(fe.removeEventListener("config-changed",this.__onEditorChange),fe.removeEventListener("value-changed",this.__onEditorChange));let J=async ue=>{var Se,Oe,Ve;let ke=(Ve=(Se=ue.detail)==null?void 0:Se.config)!=null?Ve:(Oe=ue.detail)==null?void 0:Oe.value;if(!ke)return;let Z=ke.type||ge;ge=Z,te=this._shapeBySchema(Z,ke),R(""),U(!0),tt(ge,te),Ne(te),ee==null||ee.setValue(te)};return this.__onEditorChange=J,we.addEventListener("config-changed",J),we.addEventListener("value-changed",J),fe=we,ze!=="yaml"&&Me("visual"),U(!0),!0}finally{q===Fe&&(E.hidden=!0)}},dt=async j=>{ee=await this._mountYamlEditor(I,j,async q=>{var ye,G;try{let J=(q==null?void 0:q.type)||ge,ue=this._shapeBySchema(J,q||{}),ke=J!==ge;if(ge=J,te=ue,k.hidden=!0,k.textContent="",U(!0),ke){if(tt(ge,te),fe){try{(ye=fe.setConfig)==null||ye.call(fe,te)}catch{}ze!=="yaml"&&Me("visual")}}else{try{(G=fe==null?void 0:fe.setConfig)==null||G.call(fe,te)}catch{}Ne(te)}}catch(J){k.hidden=!1,k.textContent=`Invalid config: ${String((J==null?void 0:J.message)||J)}`,U(!1)}},q=>{k.hidden=!1,k.textContent=`Invalid YAML: ${String((q==null?void 0:q.message)||q)}`,U(!1)})},Ce=async j=>{if(this.__stubCache.has(j))return{...this.__stubCache.get(j)};let q=await this._getStubConfigForType(j);return this.__stubCache.set(j,{...q}),{...q}},xt=async j=>{k.hidden=!0,k.textContent="",R(""),ge=j;try{typeof We=="function"&&We(j)}catch{}let q=n==="edit"&&o&&o.type===j?{...o}:await Ce(j);te=this._shapeBySchema(j,q),fe=null,tt(j,te),await dt(te),await Hi(),Ne(te),Me("yaml"),U(!0)},ot=async()=>{if(!te)return;let j=this._shapeBySchema(ge,te);n==="edit"&&typeof s=="function"?await s(j):(await this._addPickedCardToLayout(j),this._pushRecent((j||{}).type)),u()};y.addEventListener("click",u),v.addEventListener("click",u),g.addEventListener("click",ot),x.addEventListener("click",ot),c.addEventListener("keydown",j=>{j.key==="Escape"&&u(),j.key==="Enter"&&!g.disabled&&ot()});let ht=null;S.addEventListener("input",()=>{ht&&clearTimeout(ht),ht=setTimeout(Be,120)}),Be(),await xt((()=>{var ye;return(((ye=this._getRecent)==null?void 0:ye.call(this))||[]).find(Boolean)||"entities"})()),U(!0),n==="edit"&&o&&(await xt(o.type||"entities"),U(!0))}async _getStubConfigForType(n){var y;let o=await this._helpersPromise||await window.loadCardHelpers(),s=null;if(n==="custom_card")return null;try{o.getCardElementClass&&(s=await o.getCardElementClass(n))}catch{}let u=Object.keys(((y=this.hass)==null?void 0:y.states)||{}),c=v=>u.filter(S=>S.startsWith(v+".")),d={type:n};if(s!=null&&s.getStubConfig)try{let v=await s.getStubConfig(this.hass,u,c);if(n!=="entity")return v;v&&typeof v=="object"&&(d={...d,...v})}catch{}let g=u[0],x=c("sensor")[0]||g;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast","map"].includes(n)){let v={sensor:x,gauge:c("sensor").find(this._isNumericEntity.bind(this))||x,"media-control":c("media_player")[0]||g,light:c("light")[0]||g,thermostat:c("climate")[0]||g,"alarm-panel":c("alarm_control_panel")[0]||g,"weather-forecast":c("weather")[0]||g,map:c("device_tracker")[0]||c("person")[0]||g}[n]||x||g;["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity"].includes(n)?d.entity=v:n==="weather-forecast"?(d.entity=v,d.show_current=!0,d.show_forecast=!0,d.forecast_type="daily"):n==="map"&&(d.entities=[v].filter(Boolean),d.theme_mode="auto")}if(["entities","glance","picture-glance","history-graph","statistics-graph"].includes(n)){let v=S=>(S!=null&&S.length?u.filter(O=>S.includes(O.split(".")[0])):u).slice(0,3);n==="statistics-graph"?d.entities=v(["sensor","number","input_number"]):d.entities=v()}if(n==="markdown"&&(d.content="Markdown card"),n==="sensor"&&(d.graph="line"),n==="button"&&(d.show_name=!0,d.show_icon=!0),n==="tile"&&(d.features_position="bottom",d.vertical=!1),n==="picture-glance"&&(d.title=d.title||"Glance",d.image=d.image||"https://demo.home-assistant.io/stub_config/kitchen.png"),n==="picture-entity"&&(d.image=d.image||"https://demo.home-assistant.io/stub_config/bedroom.png"),n==="iframe"&&(d.url=d.url||"https://www.home-assistant.io",d.aspect_ratio=d.aspect_ratio||"50%"),n==="alarm-panel"&&(d.states=d.states||["arm_home","arm_away"]),n==="area")try{let v=this.hass&&this.hass.areas?Object.values(this.hass.areas):[];v.length?d.area=v[0].area_id||v[0].name||v[0].id:d.area=g?g.split(".")[0]:"default_area",d.display_type="picture",d.alert_classes=d.alert_classes||["moisture","motion"],d.sensor_classes=d.sensor_classes||["temperature","humidity"],d.features_position="bottom"}catch{}return d}_getNextAvailablePosition(){let n=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),o=new Set,s=this.gridSize;n.forEach(d=>{let g=parseFloat(d.getAttribute("data-x"))||0,x=parseFloat(d.getAttribute("data-y"))||0,y=parseFloat(getComputedStyle(d).width)||100,v=parseFloat(getComputedStyle(d).height)||100,S=Math.floor(g/s),O=Math.floor(x/s),z=Math.floor((g+y)/s),E=Math.floor((x+v)/s);for(let P=S;P<z;P++)for(let I=O;I<E;I++)o.add(`${P}-${I}`)});let u=0,c=0;for(;o.has(`${u}-${c}`);)u+=6,u>60&&(u=0,c+=6);return{x:u*s,y:c*s}}async _addPickedCardToLayout(n){this._hideEmptyPlaceholder();let o=await this._createCard(n),s=this._makeWrapper(o),u=this._getNextAvailablePosition();this._setCardPosition(s,u.x,u.y),s.style.width=`${14*this.gridSize}px`,s.style.height=`${10*this.gridSize}px`,s.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(s);try{this._rebuildOnce(s.firstElementChild)}catch{}this._initCardInteract(s),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI()}_toggleSelection(n,o=null){let s=o==null?!this._selection.has(n):!!o;s?this._selection.add(n):this._selection.delete(n),n.classList.toggle("selected",s)}_clearSelection(){for(let n of this._selection)n.classList.remove("selected");this._selection.clear()}_installSelectionMarquee(){let n=this.cardContainer,o=0,s=0,u=null,c=!1,d=S=>{let O=n.getBoundingClientRect(),z="touches"in S&&S.touches[0]?S.touches[0].clientX:S.clientX,E="touches"in S&&S.touches[0]?S.touches[0].clientY:S.clientY;return{x:z-O.left,y:E-O.top}},g=(S,O)=>{let z=Math.min(S,o),E=Math.max(S,o),P=Math.min(O,s),I=Math.max(O,s);u.style.left=`${z}px`,u.style.top=`${P}px`,u.style.width=`${E-z}px`,u.style.height=`${I-P}px`;let k=u.getBoundingClientRect(),M=n.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),M.forEach(T=>{let b=T.getBoundingClientRect();!(b.right<k.left||b.left>k.right||b.bottom<k.top||b.top>k.bottom)&&this._toggleSelection(T,!0)})},x=S=>{if(!this.editMode||S.target.closest(".card-wrapper"))return;c=!0;let O=d(S);o=O.x,s=O.y,u=document.createElement("div"),u.className="marquee",u.style.left=`${o}px`,u.style.top=`${s}px`,n.appendChild(u),S.preventDefault()},y=S=>{!c||!u||g(d(S).x,d(S).y)},v=()=>{c&&(c=!1,u&&u.remove(),u=null)};n.addEventListener("mousedown",x),window.addEventListener("mousemove",y),window.addEventListener("mouseup",v),n.addEventListener("touchstart",S=>{this.editMode&&(S.target.closest(".card-wrapper")||x(S))},{passive:!1}),window.addEventListener("touchmove",S=>{y(S)},{passive:!1}),window.addEventListener("touchend",v),window.addEventListener("touchcancel",v)}async _openDiagnostics(){var g,x;let n=document.createElement("div");n.className="modal";let o=this.storageKey||"(none)",s=this._backendOK&&!!this.storageKey,u=y=>y.slice(-200).map(v=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${v.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${v.kind}]</b>
        <span style="margin-left:6px">${this._safe(v.msg)}</span>
        ${v.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(v.extra,null,2))}</pre>`:""}
      </div>`).join("");n.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95%);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((g=this._config)==null?void 0:g.storage_key)||"")}</code> \u2192 <code>${this._safe(o)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${s?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((x=this.cardContainer)==null?void 0:x.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${u(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let c=()=>n.remove();n.querySelector("#closeDiag").addEventListener("click",c),this.shadowRoot.appendChild(n);let d=()=>{let y=n.querySelector("#logArea"),v=S=>S.slice(-200).map(O=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${O.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${O.kind}]</b>
          <span style="margin-left:6px">${this._safe(O.msg)}</span>
          ${O.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(O.extra,null,2))}</pre>`:""}
        </div>`).join("");y.innerHTML=v(this._dbgDump()),y.scrollTop=y.scrollHeight};n.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{d()}}),n.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),d()}),n.querySelector("#exportJson").addEventListener("click",()=>{let v=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(E=>{let P=parseFloat(E.getAttribute("data-x"))||0,I=parseFloat(E.getAttribute("data-y"))||0,k=parseFloat(E.style.width)||E.getBoundingClientRect().width,M=parseFloat(E.style.height)||E.getBoundingClientRect().height,T=parseInt(E.style.zIndex||"1",10),b=this._extractCardConfig(E.firstElementChild),D=E.dataset.tabId||this.defaultTab;return{card:b,position:{x:P,y:I},size:{width:k,height:M},z:T,tabId:D}}),S={version:2,options:this._exportableOptions(),cards:v},O=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),z=document.createElement("a");z.href=URL.createObjectURL(O),z.download=`ddc_${this.storageKey||"layout"}.json`,z.click(),URL.revokeObjectURL(z.href)}),n.querySelector("#importJson").addEventListener("click",async()=>{let y=document.createElement("input");y.type="file",y.accept="application/json",y.onchange=async()=>{var z,E,P,I,k,M,T,b,D,F,U,R,K;let v=(z=y.files)==null?void 0:z[0];if(!v)return;let S=await v.text();try{let W=JSON.parse(S);if(this._dbgPush("import","Loaded file",{bytes:S.length}),this.cardContainer.innerHTML="",(E=W.cards)!=null&&E.length)for(let Y of W.cards)if(!(Y!=null&&Y.card)||typeof Y.card=="object"&&Object.keys(Y.card).length===0){let Q=this._makePlaceholderAt(((P=Y.position)==null?void 0:P.x)||0,((I=Y.position)==null?void 0:I.y)||0,((k=Y.size)==null?void 0:k.width)||200,((M=Y.size)==null?void 0:M.height)||200);this.cardContainer.appendChild(Q)}else{let Q=await this._createCard(Y.card),se=this._makeWrapper(Q);this._setCardPosition(se,((T=Y.position)==null?void 0:T.x)||0,((b=Y.position)==null?void 0:b.y)||0),se.dataset.tabId=this._normalizeTabId(Y.tabId||Y.tab_id||this.defaultTab),this._setCardPosition(se,((D=Y.position)==null?void 0:D.x)||0,((F=Y.position)==null?void 0:F.y)||0),se.style.width=`${((U=Y.size)==null?void 0:U.width)||140}px`,se.style.height=`${((R=Y.size)==null?void 0:R.height)||100}px`,this.cardContainer.appendChild(se);try{this._rebuildOnce(se.firstElementChild)}catch{}this._initCardInteract(se)}else this._showEmptyPlaceholder(),(K=this._applyAutoScale)==null||K.call(this);this._resizeContainer(),await this._saveLayout(!1)}catch(W){this._dbgPush("import","Parse failed",{error:String(W)})}let O=new Event("ddc-logrefresh");window.dispatchEvent(O)},y.click()}),n.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),d();let y=(this.storageKey||"ddc_test")+"_selftest",v={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(y,v);let S=await this._loadLayoutFromBackend(y);this._dbgPush("test","Round-trip result",{wrote:v,read:S})}catch(S){this._dbgPush("test","Round-trip failed",{error:String(S)})}d()}),d()}_exportableOptions(){var o,s;let n={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(o=this.containerFixedWidth)!=null?o:void 0,container_fixed_height:(s=this.containerFixedHeight)!=null?s:void 0,container_preset:this.containerPreset,tabs:this.tabs,tabs_position:this.tabsPosition,default_tab:this.defaultTab,hide_tabs_when_single:!!this.hideTabsWhenSingle,auto_resize_cards:!!this.autoResizeCards};return Object.keys(n).forEach(u=>n[u]===void 0&&delete n[u]),n}_applyImportedOptions(n={},o=!0){var s,u,c,d,g,x,y,v;if(n&&Object.prototype.hasOwnProperty.call(n,"storage_key")&&this._isInHaEditorPreview())try{let S={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:S},bubbles:!0,composed:!0}))}catch{}this._config={...this._config||{},...n},"storage_key"in n&&(this.storageKey=n.storage_key||void 0),this._syncEditorsStorageKey(),"grid"in n&&(this.gridSize=Number(n.grid)||10),"drag_live_snap"in n&&(this.dragLiveSnap=!!n.drag_live_snap),"auto_save"in n&&(this.autoSave=!!n.auto_save),"auto_save_debounce"in n&&(this.autoSaveDebounce=Number(n.auto_save_debounce)||800),"container_background"in n&&(this.containerBackground=(s=n.container_background)!=null?s:"transparent"),"card_background"in n&&(this.cardBackground=(u=n.card_background)!=null?u:"var(--ha-card-background, var(--card-background-color))"),"debug"in n&&(this.debug=!!n.debug),"disable_overlap"in n&&(this.disableOverlap=!!n.disable_overlap),"container_size_mode"in n&&(this.containerSizeMode=n.container_size_mode||"dynamic"),"container_fixed_width"in n&&(this.containerFixedWidth=Number(n.container_fixed_width)||null),"container_fixed_height"in n&&(this.containerFixedHeight=Number(n.container_fixed_height)||null),"container_preset"in n&&(this.containerPreset=n.container_preset||"fhd"),"container_preset_orientation"in n&&(this.containerPresetOrient=n.container_preset_orientation||"auto"),"auto_resize_cards"in n&&(this.autoResizeCards=!!n.auto_resize_cards,this.autoResizeCards?(c=this._startScaleWatch)==null||c.call(this):(d=this._stopScaleWatch)==null||d.call(this),(g=this._applyAutoScale)==null||g.call(this)),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),o&&(this._applyContainerSizingFromConfig(!0),(x=this._applyAutoScale)==null||x.call(this),this._resizeContainer(),(y=this._updateStoreBadge)==null||y.call(this),(v=this._applyAutoScale)==null||v.call(this))}_exportDesign(){let o=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(g=>{let x=parseFloat(g.getAttribute("data-x"))||0,y=parseFloat(g.getAttribute("data-y"))||0,v=parseFloat(g.style.width)||g.getBoundingClientRect().width,S=parseFloat(g.style.height)||g.getBoundingClientRect().height,O=parseInt(g.style.zIndex||"1",10),z=this._extractCardConfig(g.firstElementChild),E=g.dataset.tabId||this.defaultTab;return{card:z,position:{x,y},size:{width:v,height:S},z:O,tabId:E}}),s={version:2,options:this._exportableOptions(),cards:o};this._config&&this._config.card_mod&&(s.options=s.options||{},s.options.card_mod=this._config.card_mod);let u=`DragAndDrop_Design_${this.storageKey||"layout"}.json`,c=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(c),d.download=u,d.click(),URL.revokeObjectURL(d.href),this._toast("Design exported.")}_importDesign(){let n=document.createElement("input");n.type="file",n.accept="application/json";let o=!0,s=!1,u=["grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","card_mod","storage_key"];n.onchange=async()=>{var g,x,y,v,S,O,z,E,P,I,k,M,T,b,D,F,U,R,K,W,Y,Q,se,pe,Ae,xe,be,me,ae,Je,We,ze,Me,Qe,Be,X,te,ge,ee,fe,we,Fe,Ue,lt,tt,Ne,ct,dt;let c=(g=n.files)==null?void 0:g[0];if(!c)return;let d=await c.text();try{let Ce=JSON.parse(d),xt=this.storageKey||((x=this._config)==null?void 0:x.storage_key)||null,ot=!!(Ce.options&&Array.isArray(Ce.options.tabs)),ht=Array.isArray(Ce.cards)&&Ce.cards.some(G=>(G==null?void 0:G.tabId)||(G==null?void 0:G.tab_id)),it=[];ot?it=Ce.options.tabs:ht?it=Array.from(new Set(Ce.cards.map(J=>(J==null?void 0:J.tabId)||(J==null?void 0:J.tab_id)).filter(Boolean))).map(J=>({id:J,label:J})):it=[{id:"default",label:"Layout"}];let j=((y=Ce.options)==null?void 0:y.tabs_position)==="left"?"left":this.tabsPosition||"top",q=((v=Ce.options)==null?void 0:v.default_tab)||((S=it[0])==null?void 0:S.id)||"default",ye=((O=Ce.options)==null?void 0:O.hide_tabs_when_single)!==void 0?!!Ce.options.hide_tabs_when_single:!0;if(Ce.options){let G={...Ce.options};if(s||delete G.storage_key,o){let J=this._config||{type:"custom:drag-and-drop-card"};for(let ue of u)ue==="storage_key"&&!s||!(ue in G)&&ue in J&&delete J[ue];try{this.cardContainer&&(this.cardContainer.style.background="",this.cardContainer.style.width="",this.cardContainer.style.height=""),(E=(z=this.style)==null?void 0:z.removeProperty)==null||E.call(z,"--ddc-container-bg"),(I=(P=this.style)==null?void 0:P.removeProperty)==null||I.call(P,"--ddc-card-bg")}catch{}if(this._config={...J,...G},"card_mod"in G||delete this._config.card_mod,s&&G.storage_key&&(this.storageKey=G.storage_key),this._opts){this._opts={...this._opts,...G};for(let ue of u)ue in G||delete this._opts[ue]}(k=this._applyOptionsToDom)==null||k.call(this,this._config),(M=this.requestUpdate)==null||M.call(this)}else this._applyImportedOptions(G,!0),G.card_mod!==void 0&&(this._config=this._config||{},this._config.card_mod=G.card_mod,(T=this.requestUpdate)==null||T.call(this))}else if(typeof Ce.grid=="number"){let G={grid:Ce.grid};o?this._config={...this._config||{},...G}:this._applyImportedOptions(G,!0),(b=this.requestUpdate)==null||b.call(this)}(!Array.isArray(this.tabs)||!this.tabs.length)&&(this.tabs=it),this.tabsPosition||(this.tabsPosition=j),this.defaultTab||(this.defaultTab=q),this.hideTabsWhenSingle===void 0&&(this.hideTabsWhenSingle=ye),(U=(F=(D=this.rootEl)==null?void 0:D.classList)==null?void 0:F.toggle)==null||U.call(F,"ddc-tabs-left-layout",this.tabsPosition==="left");try{let G=((R=this._config)==null?void 0:R.storage_key)||this.storageKey||null,J=(K=Ce.options)!=null?K:typeof Ce.grid=="number"?{grid:Ce.grid}:{},ue={...J,tabs:(Y=(W=J.tabs)!=null?W:this.tabs)!=null?Y:[],tabs_position:(se=(Q=J.tabs_position)!=null?Q:this.tabsPosition)!=null?se:"top",default_tab:(ae=(pe=J.default_tab)!=null?pe:this.defaultTab)!=null?ae:((xe=(Ae=J.tabs)==null?void 0:Ae[0])==null?void 0:xe.id)||((me=(be=this.tabs)==null?void 0:be[0])==null?void 0:me.id)||"default",hide_tabs_when_single:(We=J.hide_tabs_when_single)!=null?We:(Je=this.hideTabsWhenSingle)!=null?Je:!0};if(s||delete ue.storage_key,!G)console.warn("[ddc:import] No storage_key on this card; aborting YAML persist.");else{let ke=await((ze=this._persistOptionsToYaml)==null?void 0:ze.call(this,ue,{forceTargetKey:String(G),noDownload:!0,replace:!0,wipeUnknownKeys:!0})),Z=!!(ke&&ke.yamlSaved);(Me=console.debug)==null||Me.call(console,"[ddc:import] YAML persist result:",Z)}try{let ke={type:"custom:drag-and-drop-card",...this._config||{}};ke.tabs=ue.tabs,ke.tabs_position=ue.tabs_position,ke.default_tab=ue.default_tab,ke.hide_tabs_when_single=!!ue.hide_tabs_when_single,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:ke},bubbles:!0,composed:!0}))}catch{}}catch(G){console.warn("[ddc:import] YAML persist failed:",G)}if(this.cardContainer.innerHTML="",Array.isArray(Ce.cards)&&Ce.cards.length)for(let G of Ce.cards){let J=((Qe=G.position)==null?void 0:Qe.x)||0,ue=((Be=G.position)==null?void 0:Be.y)||0,ke=((X=G.size)==null?void 0:X.width)||140,Z=((te=G.size)==null?void 0:te.height)||100,Se=G.z,Oe=this._normalizeTabId(G.tabId||G.tab_id||this.defaultTab);if(!(G!=null&&G.card)||typeof G.card=="object"&&!Object.keys(G.card).length){let Xe=this._makePlaceholderAt(J,ue,ke,Z);Xe.dataset.tabId=Oe,this.cardContainer.appendChild(Xe);continue}let Ve=await this._createCard(G.card),_e=this._makeWrapper(Ve);_e.dataset.tabId=Oe,this._setCardPosition(_e,J,ue),_e.style.width=`${ke}px`,_e.style.height=`${Z}px`,Se!=null&&(_e.style.zIndex=String(Se)),this.cardContainer.appendChild(_e);try{this._rebuildOnce(_e.firstElementChild)}catch{}this._initCardInteract(_e)}else this._showEmptyPlaceholder(),(ge=this._applyAutoScale)==null||ge.call(this);(ee=this._applyOptionsToDom)==null||ee.call(this,this._config),this._resizeContainer();try{(Fe=(we=(fe=this.rootEl)==null?void 0:fe.classList)==null?void 0:we.toggle)==null||Fe.call(we,"ddc-tabs-left-layout",this.tabsPosition==="left"),(Ue=this._renderTabs)==null||Ue.call(this),(lt=this._applyActiveTab)==null||lt.call(this)}catch{}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0),(tt=this._toast)==null||tt.call(this,"Design imported & saved. Reloading..."),window.location.reload()}catch(G){console.warn("[ddc:import] saveLayout failed",G),(Ne=this._markDirty)==null||Ne.call(this,"import"),(ct=this._toast)==null||ct.call(this,"Design imported \u2014 click Apply to save.")}}catch(Ce){console.error("Import failed",Ce),(dt=this._toast)==null||dt.call(this,"Import failed \u2014 invalid file.")}},n.click()}_getLovelace(){var c,d;let n=0,o=this;for(;o&&n++<20;){let g=(c=o.getRootNode)==null?void 0:c.call(o),x=g==null?void 0:g.host;if((x==null?void 0:x.tagName)==="HUI-ROOT")return x.lovelace;o=x||o.parentElement}let s=new Set,u=[document];for(;u.length;){let g=u.shift();if(!(!g||s.has(g))){if(s.add(g),((d=g.host)==null?void 0:d.tagName)==="HUI-ROOT")return g.host.lovelace;if(g.tagName==="HUI-ROOT")return g.lovelace;if(g.shadowRoot&&u.push(g.shadowRoot),g.children)for(let x of g.children)u.push(x)}}}_scanDdcCards(n){let o=[],s=(c,d,g)=>{(g==null?void 0:g.type)==="custom:drag-and-drop-card"&&o.push({view:c,path:[...d],card:g})},u=(c,d,g)=>{if(c){if(Array.isArray(c)){c.forEach((x,y)=>u(x,d,g.concat(y)));return}if(typeof c=="object"){"type"in c&&s(d,g,c);for(let[x,y]of Object.entries(c))x==="views"&&Array.isArray(y)?y.forEach((v,S)=>u(v,S,["views",S])):(Array.isArray(y)||y&&typeof y=="object")&&u(y,d,g.concat(x))}}};return u(n,-1,[]),o}async _persistOptionsToYaml(n,{prevKey:o=null,patchAllInCurrentViewIfNoKey:s=!1}={}){var u,c,d,g,x,y,v,S,O;try{let z=this._getLovelace();if(!z)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof z.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let E=JSON.parse(JSON.stringify(z.config)),P=this._scanDdcCards(E),I=(u=z.current_view)!=null?u:0;console.debug("[ddc:import] persist: found DDC cards",P.map(D=>({view:D.view,path:D.path.join("."),storage_key:D.card.storage_key||null})));let k=(c=n==null?void 0:n.storage_key)!=null?c:null,M=[];o&&M.push(o),k&&M.push(k),this.storageKey&&M.push(this.storageKey),(d=this._config)!=null&&d.storage_key&&M.push(this._config.storage_key);let T=P.filter(D=>D.card.storage_key&&M.includes(D.card.storage_key));if(!T.length){let D=P.filter(F=>F.view===I);D.length===1&&(T=D)}if(!T.length&&P.length===1&&(T=P),!T.length)return console.debug("[ddc:import] persist: no target. Provide a unique storage_key on this card and import again.",{prevKey:o,newKey:k,storageKey:this.storageKey}),!1;let b={type:"custom:drag-and-drop-card",...n};"storage_key"in b&&delete b.storage_key,"storageKey"in b&&delete b.storageKey;for(let D of T){let F=E;for(let K of D.path)F=F[K];let U=(O=(S=(y=(g=F==null?void 0:F.storage_key)!=null?g:F==null?void 0:F.storageKey)!=null?y:(x=F==null?void 0:F.options)==null?void 0:x.storage_key)!=null?S:(v=F==null?void 0:F.options)==null?void 0:v.storageKey)!=null?O:null,R=!!(o&&k&&U===o&&k!==o);Object.assign(F,b),R?F.storage_key=String(k):U&&(F.storage_key=String(U)),"storageKey"in F&&delete F.storageKey}return console.debug("[ddc:import] persist \u2192 saving",{patched:T.length,keysTried:M,patch}),await z.saveConfig(E),!0}catch(z){return console.warn("[ddc:import] persist error",z),!1}}_queueSave(n="auto"){this._markDirty(n),this.autoSave&&(this._loading||this.editMode&&(this._dbgPush("autosave","Queued",{reason:n,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce)))}async _saveLayout(n=!0){let s=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(c=>{let d=parseFloat(c.getAttribute("data-x"))||0,g=parseFloat(c.getAttribute("data-y"))||0,x=parseFloat(c.style.width)||c.getBoundingClientRect().width,y=parseFloat(c.style.height)||c.getBoundingClientRect().height,v=parseInt(c.style.zIndex||"1",10),S=this._extractCardConfig(c.firstElementChild),O=c.dataset.tabId||this.defaultTab;return{card:S,position:{x:d,y:g},size:{width:x,height:y},z:v,tabId:O}}),u={version:2,options:this._exportableOptions(),cards:s};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(u))}catch{}if(!this.storageKey){n||this._toast("Saved locally (no storage_key set)."),this.__dirty=!1,this._updateApplyBtn();return}try{await this._saveLayoutToBackend(this.storageKey,u),n||this._toast("Layout saved."),this.__dirty=!1,this._updateApplyBtn()}catch(c){console.error("Backend save failed",c),this._dbgPush("save","Backend save failed",{error:String(c)}),n||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let n=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let o=await this.hass.callApi("get","dragdrop_storage"),s=Math.round(performance.now()-n);this._dbgPush("probe",`OK (${s} ms)`,o),this._backendOK=!!o}catch(o){let s=Math.round(performance.now()-n);this._dbgPush("probe",`FAILED (${s} ms)`,{error:String(o)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(n){let o=`dragdrop_storage/${encodeURIComponent(n)}`,s=performance.now();try{this._dbgPush("load",`GET /api/${o}`);let u=await this.hass.callApi("get",o),c=Math.round(performance.now()-s);return this._dbgPush("load",`OK (${c} ms)`,{bytes:JSON.stringify(u||"").length}),u}catch(u){let c=Math.round(performance.now()-s);return this._dbgPush("load",`FAILED (${c} ms)`,{error:String(u)}),null}}async _saveLayoutToBackend(n,o){let s=`dragdrop_storage/${encodeURIComponent(n)}`,u=JSON.stringify(o).length,c=performance.now();try{this._dbgPush("save",`POST /api/${s}`,{bytes:u});let d=await this.hass.callApi("post",s,o),g=Math.round(performance.now()-c);return this._dbgPush("save",`OK (${g} ms)`,d),d}catch(d){let g=Math.round(performance.now()-c);throw this._dbgPush("save",`FAILED (${g} ms)`,{error:String(d),bytes:u}),d}}_updateStoreBadge(){let n=this.storeBadge;if(!n)return;let o=this._backendOK&&!!this.storageKey;n.textContent=o?"storage: backend - OK":"storage: local. Your Changes are NOT being SAVED. You need to download the Drag and Drop Card backend integration",n.style.background=o?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",n.style.borderColor=o?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(n){let o=new Event("hass-notification");o.detail={message:n},window.dispatchEvent(o)}_huiRoot(){var n,o,s,u,c,d;try{let g=document.querySelector("home-assistant"),x=(n=g==null?void 0:g.shadowRoot)==null?void 0:n.querySelector("home-assistant-main"),y=((o=x==null?void 0:x.shadowRoot)==null?void 0:o.querySelector("ha-drawer"))||x,v=((s=y==null?void 0:y.shadowRoot)==null?void 0:s.querySelector("partial-panel-resolver"))||y,S=((u=v==null?void 0:v.shadowRoot)==null?void 0:u.querySelector("ha-panel-lovelace"))||((c=y==null?void 0:y.shadowRoot)==null?void 0:c.querySelector("ha-panel-lovelace"));return((d=S==null?void 0:S.shadowRoot)==null?void 0:d.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",ji);(()=>{try{let e=window.customCards=window.customCards||[];e.some(p=>p.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!1})}catch{}})();(()=>{let e=new WeakSet,p=c=>{try{if(!(c instanceof Element))return!1;let d=c.localName||"";return d?!!(d==="ha-card"||d.endsWith("-card")):!1}catch{return!1}},n=c=>{try{if(!c||e.has(c))return;e.add(c),c.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}},o=c=>{var d,g;try{if(!c)return;c instanceof Element&&p(c)&&n(c);let x=(g=(d=(c instanceof ShadowRoot,c)).querySelectorAll)==null?void 0:g.call(d,"*");if(!x)return;for(let y of x){p(y)&&n(y);let v=y.shadowRoot;if(v)try{o(v)}catch{}}}catch{}},s=c=>{try{if(!c||c.__ddcCardModIntegrated)return;c.__ddcCardModIntegrated=!0;let d=c.shadowRoot||c;o(d);let g=new MutationObserver(x=>{for(let y of x)if(!(!y.addedNodes||!y.addedNodes.length))for(let v of y.addedNodes)(v instanceof Element||v instanceof ShadowRoot)&&o(v)});g.observe(d,{childList:!0,subtree:!0}),c.__ddcCardModIntegratedObserver=g,setTimeout(()=>{try{o(d)}catch{}},250),setTimeout(()=>{try{o(d)}catch{}},1e3)}catch{}},u=()=>{try{document.querySelectorAll("drag-and-drop-card").forEach(s)}catch{}};if(window.customElements&&window.customElements.whenDefined)window.customElements.whenDefined("drag-and-drop-card").then(()=>{u();let c=window.customElements.get("drag-and-drop-card");if(c&&c.prototype){let g=c.prototype.connectedCallback;c.prototype.connectedCallback=function(){try{g&&g.call(this)}finally{s(this)}}}new MutationObserver(()=>u()).observe(document.documentElement,{childList:!0,subtree:!0})});else{let c=setInterval(u,1e3);setTimeout(()=>clearInterval(c),1e4)}})();(function(){let e="drag-and-drop-card",p=customElements.get(e);if(!p){console.warn("[ddc:augment] Could not find custom element",e);return}function n(){var E,P;try{let I=0,k=this;for(;k&&I++<20;){let b=(E=k.getRootNode)==null?void 0:E.call(k),D=b==null?void 0:b.host;if((D==null?void 0:D.tagName)==="HUI-ROOT")return D.lovelace;k=D||k.parentElement}let M=new Set,T=[document];for(;T.length;){let b=T.shift();if(!(!b||M.has(b))){if(M.add(b),((P=b.host)==null?void 0:P.tagName)==="HUI-ROOT")return b.host.lovelace;if(b.tagName==="HUI-ROOT")return b.lovelace;if(b.shadowRoot&&T.push(b.shadowRoot),b.children)for(let D of b.children)T.push(D)}}}catch{}}function o(E){let P=[],I=(M,T,b)=>{(b==null?void 0:b.type)==="custom:drag-and-drop-card"&&P.push({view:M,path:[...T],card:b})},k=(M,T,b)=>{if(M){if(Array.isArray(M)){M.forEach((D,F)=>k(D,T,b.concat(F)));return}if(typeof M=="object"){"type"in M&&I(T,b,M);for(let[D,F]of Object.entries(M))D==="views"&&Array.isArray(F)?F.forEach((U,R)=>k(U,R,["views",R])):(Array.isArray(F)||F&&typeof F=="object")&&k(F,T,b.concat(D))}}};return k(E,-1,[]),P}function s(E,P,I){let k=new Date().toISOString().replace(/[:.]/g,"-"),M=P.map(b=>{let D=E;for(let F of b.path)D=D[F];return{view:b.view,path:b.path,storage_key:D&&D.storage_key||null,before:D,patch:I}}),T={kind:"ddc-import-backup",created_at:k,count:M.length,items:M};try{let b=`ddc.backup.${k}`;localStorage.setItem(b,JSON.stringify(T));let D=Object.keys(localStorage).filter(F=>F.startsWith("ddc.backup.")).sort().reverse();for(let F of D.slice(10))localStorage.removeItem(F)}catch{}return{name:`ddc_backup_${k}.json`,data:T}}function u(E,P){try{let I=new Blob([JSON.stringify(P,null,2)],{type:"application/json"}),k=URL.createObjectURL(I),M=document.createElement("a");M.href=k,M.download=E,document.body.appendChild(M),M.click(),M.remove(),setTimeout(()=>URL.revokeObjectURL(k),1500)}catch(I){console.warn("[ddc:backup] download failed",I)}}function c(E){if(E)try{let P="ddc.recent.keys",I=JSON.parse(localStorage.getItem(P)||"[]");I.includes(E)||I.unshift(E),localStorage.setItem(P,JSON.stringify(I.slice(0,20)))}catch{}}function d(){try{return JSON.parse(localStorage.getItem("ddc.recent.keys")||"[]")}catch{return[]}}function g(){var P,I;let E=new Set;try{let k=Object.keys(localStorage).filter(M=>M.startsWith("ddc.backup.")).sort().reverse();for(let M of k)try{let T=JSON.parse(localStorage.getItem(M)||"null");if(T&&T.items)for(let b of T.items){let D=((P=b==null?void 0:b.before)==null?void 0:P.storage_key)||((I=b==null?void 0:b.patch)==null?void 0:I.storage_key);D&&E.add(D)}}catch{}}catch{}return Array.from(E)}async function x(E,{forceTargetKey:P=null,onlyThisCard:I=!1,prevKey:k,noDownload:M}={}){var pe,Ae,xe,be,me;let T=((pe=this._getLovelace)==null?void 0:pe.call(this))||n.call(this);if(!T)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof T.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let b=ae=>typeof ae=="string"?ae.trim():null,D=b(P)||b((Ae=this==null?void 0:this._config)==null?void 0:Ae.storage_key)||b(this==null?void 0:this.storageKey)||b(k);if(!D)return console.warn("[ddc:import] persist: missing target storage_key on this card; aborting"),!1;let F=JSON.parse(JSON.stringify(T.config)),U=(this._scanDdcCards||o)(F);console.debug("[ddc:import] persist: found DDC cards",U.map(ae=>({view:ae.view,path:ae.path.join("."),storage_key:ae.card&&(ae.card.storage_key||ae.card.storageKey)||null})));let R=U.filter(ae=>{var We,ze,Me,Qe,Be,X,te,ge,ee;return((ee=(X=(Me=b((We=ae.card)==null?void 0:We.storage_key))!=null?Me:b((ze=ae.card)==null?void 0:ze.storageKey))!=null?X:b((Be=(Qe=ae.card)==null?void 0:Qe.options)==null?void 0:Be.storage_key))!=null?ee:b((ge=(te=ae.card)==null?void 0:te.options)==null?void 0:ge.storageKey))===D});if(R.length!==1)return console.warn("[ddc:import] persist: expected exactly one target with key, got",R.length,{myKey:D}),!1;let K={type:"custom:drag-and-drop-card",...E||{}};"storage_key"in K&&delete K.storage_key,"storageKey"in K&&delete K.storageKey,K!=null&&K.options&&("storage_key"in K.options&&delete K.options.storage_key,"storageKey"in K.options&&delete K.options.storageKey);let W=Array.isArray(K.cards)?K.cards:null;delete K.cards;try{let ae=s==null?void 0:s(T.config,R,K);ae&&(console.debug("[ddc:import] backup created",{file:ae.name,items:(xe=ae.data)==null?void 0:xe.count}),!M&&typeof u=="function"&&u(ae.name,ae.data))}catch(ae){console.debug("[ddc:import] backup skipped/error:",(ae==null?void 0:ae.message)||ae)}let Y=R[0],Q=F;for(let ae of Y.path)Q=Q[ae];let se=(me=(be=b(Q==null?void 0:Q.storage_key))!=null?be:b(Q==null?void 0:Q.storageKey))!=null?me:null;return Object.assign(Q,K),se?Q.storage_key=se:Q.storage_key=D,"storageKey"in Q&&delete Q.storageKey,console.debug("[ddc:import] persist \u2192 saving",{patched:1,into_key:Q.storage_key,ignored_file_key:b(E==null?void 0:E.storage_key)||b(E==null?void 0:E.storageKey)||null}),await T.saveConfig(F),{yamlSaved:!0,cardsForStorage:W}}async function y(){var I;let E=k=>{if(!k)return[];if(Array.isArray(k))return k;if(Array.isArray(k==null?void 0:k.keys))return k.keys;if(Array.isArray(k==null?void 0:k.dashboards))return k.dashboards;if(Array.isArray(k==null?void 0:k.entries))return k.entries.map(M=>M.key||M.id||M.name).filter(Boolean);if(Array.isArray(k==null?void 0:k.items))return k.items.map(M=>M.key||M.id||M.name).filter(Boolean);if(typeof k=="object"){for(let M of Object.values(k))if(Array.isArray(M)&&M.every(T=>typeof T=="string"))return M}return[]};try{if((I=this==null?void 0:this.hass)!=null&&I.callApi){let k=await this.hass.callApi("get","dragdrop_storage"),M=E(k);if(M.length)return M}}catch(k){console.debug("[ddc:switcher] hass.callApi dragdrop_storage failed",k)}let P=["/api/dragdrop_storage","/api/dragdrop_storage/keys","/api/dragdrop_storage/list","/api/dragdrop_storage?all=1"];for(let k of P)try{let T=await(await fetch(k,{cache:"no-store"})).json(),b=E(T);if(b.length)return b}catch{}return[]}async function v(E){let P=T=>{if(!T)return null;if(T.options||T.cards)return T;if(typeof T.design=="object")return T.design;if(typeof T.payload=="object")return T.payload;try{if(typeof T=="string")return JSON.parse(T)}catch{}return null},I=async(T,b,D)=>{var F;try{if((F=this==null?void 0:this.hass)!=null&&F.callApi){let U=await this.hass.callApi(T,b,D),R=P(U);if(R)return R}}catch{}return null},k=async T=>{try{let b=await fetch(T,{cache:"no-store"}),D=b.headers.get("content-type")||"";if(D.includes("application/json")||D.includes("text/plain")){let F=await b.json().catch(()=>null)||await b.text().catch(()=>null),U=P(F);if(U)return U}}catch{}return null},M=encodeURIComponent(E);return await(I("get",`dragdrop_storage/${M}`)||k(`/api/dragdrop_storage/${M}`)||k(`/api/dragdrop_storage?key=${M}`)||I("post","dragdrop_storage/get",{key:E})||null)}async function S(E,{source:P="switcher",newKey:I=null}={}){var T,b,D,F,U,R,K,W,Y,Q,se,pe,Ae,xe,be,me,ae,Je,We,ze,Me,Qe,Be,X,te,ge;if(!E||typeof E!="object")throw new Error("Invalid design payload");let k=this.storageKey||((T=this._config)==null?void 0:T.storage_key)||null;try{(b=this._dbgInit)==null||b.call(this),(D=this._dbgPush)==null||D.call(this,"import","Begin import (programmatic)",{source:P,newKey:I})}catch{}if(E.options){let{storage_key:ee,...fe}=E.options;(F=this._applyImportedOptions)==null||F.call(this,fe,!0)}else typeof E.grid=="number"&&((U=this._applyImportedOptions)==null||U.call(this,{grid:E.grid},!0));let M=I||((R=E==null?void 0:E.options)==null?void 0:R.storage_key)||k;if(M){this.storageKey=M,this._config={...this._config||{},storage_key:M};try{(K=this._syncEditorsStorageKey)==null||K.call(this)}catch{}}try{let ee=(W=E.options)!=null?W:typeof E.grid=="number"?{grid:E.grid}:{};await((Y=this._persistOptionsToYaml)==null?void 0:Y.call(this,{...ee,storage_key:M},{prevKey:k,noDownload:P==="switcher"}))}catch(ee){console.warn("[ddc:apply] persist failed",ee)}try{if(this.cardContainer.innerHTML="",Array.isArray(E.cards)&&E.cards.length)for(let ee of E.cards)if(!(ee!=null&&ee.card)||typeof ee.card=="object"&&Object.keys(ee.card).length===0){let fe=(xe=this._makePlaceholderAt)==null?void 0:xe.call(this,((Q=ee.position)==null?void 0:Q.x)||0,((se=ee.position)==null?void 0:se.y)||0,((pe=ee.size)==null?void 0:pe.width)||200,((Ae=ee.size)==null?void 0:Ae.height)||200);fe&&this.cardContainer.appendChild(fe)}else{let fe=await this._createCard(ee.card),we=this._makeWrapper(fe);(ae=this._setCardPosition)==null||ae.call(this,we,((be=ee.position)==null?void 0:be.x)||0,((me=ee.position)==null?void 0:me.y)||0),we.style.width=`${((Je=ee.size)==null?void 0:Je.width)||140}px`,we.style.height=`${((We=ee.size)==null?void 0:We.height)||100}px`,ee.z!=null&&(we.style.zIndex=String(ee.z)),this.cardContainer.appendChild(we);try{(ze=this._rebuildOnce)==null||ze.call(this,we.firstElementChild)}catch{}(Me=this._initCardInteract)==null||Me.call(this,we)}else(Qe=this._showEmptyPlaceholder)==null||Qe.call(this);(Be=this._resizeContainer)==null||Be.call(this),(X=this._markDirty)==null||X.call(this,"import"),(te=this._toast)==null||te.call(this,P==="switcher"?`Loaded layout "${M}"`:"Design imported")}catch(ee){console.error("[ddc:apply] rebuild failed",ee),(ge=this._toast)==null||ge.call(this,"Import failed during rebuild.")}}function O(){var E,P;try{let I=this.shadowRoot||this.renderRoot||this,k=I.querySelector(".ddc-switcher-inline");if(!k)return;let M=((E=this._getLovelace)==null?void 0:E.call(this))||n.call(this),T=!1;try{let b=(P=I.getRootNode&&I.getRootNode())==null?void 0:P.host;T=!!(M&&(M.editMode===!0||b&&b.editMode===!0))}catch{}k.style.display=T?"inline-flex":"none"}catch{}}function z(){try{if(this._ddcSwitcherInstalled)return;let P=(this.shadowRoot||this.renderRoot||this).querySelector(".toolbar");if(!P)return;let I=document.createElement("div");I.className="ddc-switcher-inline",Object.assign(I.style,{display:"inline-flex",gap:"6px",alignItems:"center",marginLeft:"auto"});let k=document.createElement("span");k.textContent="Layout:",k.style.fontSize="12px",k.style.opacity="0.8";let M=document.createElement("select");Object.assign(M.style,{fontSize:"12px",padding:"4px 6px",borderRadius:"8px",border:"1px solid var(--divider-color, #999)",background:"var(--card-background-color, #fff)"}),M.title="Select stored layout (storage_key)",M.id="ddcKeySelect";let T=document.createElement("button");T.className="btn secondary",T.type="button",T.style.padding="6px 10px",T.innerHTML='<ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh</span>',I.appendChild(k),I.appendChild(M),I.appendChild(T),P.appendChild(I),this._ddcSwitcherInstalled=!0;let b=async()=>{let D=this.storageKey||this._config&&this._config.storage_key||"",F=await y.call(this),U=g(),R=d(),K=pe=>Array.from(new Set(pe.filter(Boolean))),W=K(F),Y=K(U),Q=K(R);if(M.innerHTML="",D&&!W.includes(D)&&!Y.includes(D)&&!Q.includes(D)){let pe=document.createElement("option");pe.value=D,pe.textContent=`${D} (current)`,pe.selected=!0,M.appendChild(pe)}let se=(pe,Ae)=>{if(!Ae.length)return;let xe=document.createElement("optgroup");xe.label=pe,Ae.forEach(be=>{let me=document.createElement("option");me.value=be,me.textContent=be,be===D&&(me.selected=!0),xe.appendChild(me)}),M.appendChild(xe)};if(se("Server",W),se("Backups",Y),se("Recent",Q),!M.children.length){let pe=document.createElement("option");pe.value="",pe.textContent="\u2014 none \u2014",pe.selected=!0,M.appendChild(pe)}O.call(this)};b(),T.addEventListener("click",b),M.addEventListener("change",async D=>{var U,R,K,W,Y,Q,se,pe;let F=String(D.target.value||"");if(F&&!this._ddcLoadingFromKey){this._ddcLoadingFromKey=!0;try{let Ae=await v.call(this,F);if(!Ae){(U=this._toast)==null||U.call(this,`No layout found for "${F}"`);return}await S.call(this,Ae,{source:"switcher",newKey:F}),(R=this._resizeContainer)==null||R.call(this),(K=this._toast)==null||K.call(this,`Loaded layout "${F}"`);let xe=String(((W=this._config)==null?void 0:W.storage_key)||this.storageKey||""),be=!1;try{let me=xe?{forceTargetKey:xe,noDownload:!0}:{noDownload:!0};be=await this._persistOptionsToYaml({storage_key:F},me)}catch(me){console.warn("[ddc:switcher] failed to persist storage_key to YAML",me),(Y=this._toast)==null||Y.call(this,"Failed to persist selected layout. Keeping current.");return}if(this.storageKey=F,this._config&&(this._config.storage_key=F),!be){console.warn("[ddc:switcher] persist returned false (likely YAML mode). Skipping reload.");return}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(me){console.warn("[ddc:switcher] saveLayout failed",me),(Q=this._markDirty)==null||Q.call(this,"switcher"),(se=this._toast)==null||se.call(this,"Layout loaded \u2014 click Apply to save.");return}window.location.reload(),window.location.reload()}catch(Ae){console.warn("[ddc:switcher] load/apply failed",Ae),(pe=this._toast)==null||pe.call(this,"Failed to load layout.")}finally{this._ddcLoadingFromKey=!1}}}),this._ddcVisTimer&&clearInterval(this._ddcVisTimer),this._ddcVisTimer=setInterval(()=>O.call(this),800),O.call(this)}catch(E){console.warn("[ddc:switcher] inline install failed",E)}}p.prototype._getLovelace||(p.prototype._getLovelace=n),p.prototype._scanDdcCards||(p.prototype._scanDdcCards=o),p.prototype._persistOptionsToYaml=x,p.prototype._applyDesignObject||(p.prototype._applyDesignObject=S);try{let E=Object.getOwnPropertyDescriptor(p.prototype,"hass");if(E&&(E.set||E.get)){let P=E.set;Object.defineProperty(p.prototype,"hass",{configurable:!0,enumerable:!0,set(I){P&&P.call(this,I);try{z.call(this)}catch{}},get:E.get||function(){return this._hass}})}else if(typeof p.prototype.setHass=="function"){let P=p.prototype.setHass;p.prototype.setHass=function(I){P&&P.call(this,I);try{z.call(this)}catch{}}}else{let P=p.prototype.updated||p.prototype.firstUpdated;p.prototype.updated=function(...I){P&&P.apply(this,I);try{z.call(this)}catch{}}}}catch(E){console.warn("[ddc:switcher] wrap hass setter failed",E)}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
