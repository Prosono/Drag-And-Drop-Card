var Io=Object.create;var En=Object.defineProperty;var Fo=Object.getOwnPropertyDescriptor;var Lo=Object.getOwnPropertyNames;var zo=Object.getPrototypeOf,Do=Object.prototype.hasOwnProperty;var Ro=(e,u,r)=>u in e?En(e,u,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[u]=r;var Bo=(e,u)=>()=>(u||e((u={exports:{}}).exports,u),u.exports);var No=(e,u,r,s)=>{if(u&&typeof u=="object"||typeof u=="function")for(let l of Lo(u))!Do.call(e,l)&&l!==r&&En(e,l,{get:()=>u[l],enumerable:!(s=Fo(u,l))||s.enumerable});return e};var jo=(e,u,r)=>(r=e!=null?Io(zo(e)):{},No(u||!e||!e.__esModule?En(r,"default",{value:e,enumerable:!0}):r,e));var yi=(e,u,r)=>Ro(e,typeof u!="symbol"?u+"":u,r);var bi=Bo((Cn,pt)=>{(function(e,u){typeof Cn=="object"&&typeof pt!="undefined"?pt.exports=u():typeof define=="function"&&define.amd?define(u):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=u()})(Cn,(function(){"use strict";function e(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable}))),i.push.apply(i,o)}return i}function u(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?e(Object(i),!0).forEach((function(o){c(n,o,i[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(i,o))}))}return n}function r(n){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(n)}function s(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function l(n,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,C(o.key),o)}}function p(n,t,i){return t&&l(n.prototype,t),i&&l(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function c(n,t,i){return(t=C(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function h(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&x(n,t)}function m(n){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(n)}function x(n,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},x(n,t)}function b(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _(n){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var i,o=m(n);if(t){var a=m(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return(function(d,f){if(f&&(typeof f=="object"||typeof f=="function"))return f;if(f!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return b(d)})(this,i)}}function k(){return k=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(n,t,i){var o=(function(d,f){for(;!Object.prototype.hasOwnProperty.call(d,f)&&(d=m(d))!==null;);return d})(n,t);if(o){var a=Object.getOwnPropertyDescriptor(o,t);return a.get?a.get.call(arguments.length<3?n:i):a.value}},k.apply(this,arguments)}function C(n){var t=(function(i,o){if(typeof i!="object"||i===null)return i;var a=i[Symbol.toPrimitive];if(a!==void 0){var d=a.call(i,o||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)})(n,"string");return typeof t=="symbol"?t:t+""}var T=function(n){return!(!n||!n.Window)&&n instanceof n.Window},z=void 0,L=void 0;function I(n){z=n;var t=n.document.createTextNode("");t.ownerDocument!==n.document&&typeof n.wrap=="function"&&n.wrap(t)===t&&(n=n.wrap(n)),L=n}function O(n){return T(n)?n:(n.ownerDocument||n).defaultView||L.window}typeof window!="undefined"&&window&&I(window);var K=function(n){return!!n&&r(n)==="object"},V=function(n){return typeof n=="function"},S={window:function(n){return n===L||T(n)},docFrag:function(n){return K(n)&&n.nodeType===11},object:K,func:V,number:function(n){return typeof n=="number"},bool:function(n){return typeof n=="boolean"},string:function(n){return typeof n=="string"},element:function(n){if(!n||r(n)!=="object")return!1;var t=O(n)||L;return/object|function/.test(typeof Element=="undefined"?"undefined":r(Element))?n instanceof Element||n instanceof t.Element:n.nodeType===1&&typeof n.nodeName=="string"},plainObject:function(n){return K(n)&&!!n.constructor&&/function Object\b/.test(n.constructor.toString())},array:function(n){return K(n)&&n.length!==void 0&&V(n.splice)}};function B(n){var t=n.interaction;if(t.prepared.name==="drag"){var i=t.prepared.axis;i==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):i==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function ee(n){var t=n.iEvent,i=n.interaction;if(i.prepared.name==="drag"){var o=i.prepared.axis;if(o==="x"||o==="y"){var a=o==="x"?"y":"x";t.page[a]=i.coords.start.page[a],t.client[a]=i.coords.start.client[a],t.delta[a]=0}}}var Q={id:"actions/drag",install:function(n){var t=n.actions,i=n.Interactable,o=n.defaults;i.prototype.draggable=Q.draggable,t.map.drag=Q,t.methodDict.drag="draggable",o.actions.drag=Q.defaults},listeners:{"interactions:before-action-move":B,"interactions:action-resume":B,"interactions:action-move":ee,"auto-start:check":function(n){var t=n.interaction,i=n.interactable,o=n.buttons,a=i.options.drag;if(a&&a.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(o&i.options.drag.mouseButtons)!=0))return n.action={name:"drag",axis:a.lockAxis==="start"?a.startAxis:a.lockAxis},!1}},draggable:function(n){return S.object(n)?(this.options.drag.enabled=n.enabled!==!1,this.setPerAction("drag",n),this.setOnEvents("drag",n),/^(xy|x|y|start)$/.test(n.lockAxis)&&(this.options.drag.lockAxis=n.lockAxis),/^(xy|x|y)$/.test(n.startAxis)&&(this.options.drag.startAxis=n.startAxis),this):S.bool(n)?(this.options.drag.enabled=n,this):this.options.drag},beforeMove:B,move:ee,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(n){return n.search("drag")===0}},G=Q,oe={init:function(n){var t=n;oe.document=t.document,oe.DocumentFragment=t.DocumentFragment||ue,oe.SVGElement=t.SVGElement||ue,oe.SVGSVGElement=t.SVGSVGElement||ue,oe.SVGElementInstance=t.SVGElementInstance||ue,oe.Element=t.Element||ue,oe.HTMLElement=t.HTMLElement||oe.Element,oe.Event=t.Event,oe.Touch=t.Touch||ue,oe.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function ue(){}var ce=oe,ye={init:function(n){var t=ce.Element,i=n.navigator||{};ye.supportsTouch="ontouchstart"in n||S.func(n.DocumentTouch)&&ce.document instanceof n.DocumentTouch,ye.supportsPointerEvent=i.pointerEnabled!==!1&&!!ce.PointerEvent,ye.isIOS=/iP(hone|od|ad)/.test(i.platform),ye.isIOS7=/iP(hone|od|ad)/.test(i.platform)&&/OS 7[^\d]/.test(i.appVersion),ye.isIe9=/MSIE 9/.test(i.userAgent),ye.isOperaMobile=i.appName==="Opera"&&ye.supportsTouch&&/Presto/.test(i.userAgent),ye.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",ye.pEventTypes=ye.supportsPointerEvent?ce.PointerEvent===n.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,ye.wheelEvent=ce.document&&"onmousewheel"in ce.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},we=ye;function Ye(n,t){if(n.contains)return n.contains(t);for(;t;){if(t===n)return!0;t=t.parentNode}return!1}function It(n,t){for(;S.element(n);){if($e(n,t))return n;n=je(n)}return null}function je(n){var t=n.parentNode;if(S.docFrag(t)){for(;(t=t.host)&&S.docFrag(t););return t}return t}function $e(n,t){return L!==z&&(t=t.replace(/\/deep\//g," ")),n[we.prefixedMatchesSelector](t)}var gt=function(n){return n.parentNode||n.host};function Xe(n,t){for(var i,o=[],a=n;(i=gt(a))&&a!==t&&i!==a.ownerDocument;)o.unshift(a),a=i;return o}function qe(n,t,i){for(;S.element(n);){if($e(n,t))return!0;if((n=je(n))===i)return $e(n,t)}return!1}function He(n){return n.correspondingUseElement||n}function mt(n){var t=n instanceof ce.SVGElement?n.getBoundingClientRect():n.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function vt(n){var t,i=mt(n);if(!we.isIOS7&&i){var o={x:(t=(t=O(n))||L).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};i.left+=o.x,i.right+=o.x,i.top+=o.y,i.bottom+=o.y}return i}function lt(n){for(var t=[];n;)t.push(n),n=je(n);return t}function Ue(n){return!!S.string(n)&&(ce.document.querySelector(n),!0)}function Y(n,t){for(var i in t)n[i]=t[i];return n}function yt(n,t,i){return n==="parent"?je(i):n==="self"?t.getRect(i):It(i,n)}function ct(n,t,i,o){var a=n;return S.string(a)?a=yt(a,t,i):S.func(a)&&(a=a.apply(void 0,o)),S.element(a)&&(a=vt(a)),a}function U(n){return n&&{x:"x"in n?n.x:n.left,y:"y"in n?n.y:n.top}}function ve(n){return!n||"x"in n&&"y"in n||((n=Y({},n)).x=n.left||0,n.y=n.top||0,n.width=n.width||(n.right||0)-n.x,n.height=n.height||(n.bottom||0)-n.y),n}function se(n,t,i){n.left&&(t.left+=i.x),n.right&&(t.right+=i.x),n.top&&(t.top+=i.y),n.bottom&&(t.bottom+=i.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function de(n,t,i){var o=i&&n.options[i];return U(ct(o&&o.origin||n.options.origin,n,t,[n&&t]))||{x:0,y:0}}function Ce(n,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(v){return!0},o=arguments.length>3?arguments[3]:void 0;if(o=o||{},S.string(n)&&n.search(" ")!==-1&&(n=bt(n)),S.array(n))return n.forEach((function(v){return Ce(v,t,i,o)})),o;if(S.object(n)&&(t=n,n=""),S.func(t)&&i(n))o[n]=o[n]||[],o[n].push(t);else if(S.array(t))for(var a=0,d=t;a<d.length;a++){var f=d[a];Ce(n,f,i,o)}else if(S.object(t))for(var g in t)Ce(bt(g).map((function(v){return"".concat(n).concat(v)})),t[g],i,o);return o}function bt(n){return n.trim().split(/ +/)}var et=function(n,t){return Math.sqrt(n*n+t*t)},Ft=["webkit","moz"];function Me(n,t){n.__set||(n.__set={});var i=function(a){if(Ft.some((function(d){return a.indexOf(d)===0})))return 1;typeof n[a]!="function"&&a!=="__set"&&Object.defineProperty(n,a,{get:function(){return a in n.__set?n.__set[a]:n.__set[a]=t[a]},set:function(d){n.__set[a]=d},configurable:!0})};for(var o in t)i(o);return n}function xt(n,t){n.page=n.page||{},n.page.x=t.page.x,n.page.y=t.page.y,n.client=n.client||{},n.client.x=t.client.x,n.client.y=t.client.y,n.timeStamp=t.timeStamp}function Wt(n){n.page.x=0,n.page.y=0,n.client.x=0,n.client.y=0}function Xt(n){return n instanceof ce.Event||n instanceof ce.Touch}function tt(n,t,i){return n=n||"page",(i=i||{}).x=t[n+"X"],i.y=t[n+"Y"],i}function _t(n,t){return t=t||{x:0,y:0},we.isOperaMobile&&Xt(n)?(tt("screen",n,t),t.x+=window.scrollX,t.y+=window.scrollY):tt("page",n,t),t}function Ve(n){return S.number(n.pointerId)?n.pointerId:n.identifier}function Hn(n,t,i){var o=t.length>1?R(t):t[0];_t(o,n.page),(function(a,d){d=d||{},we.isOperaMobile&&Xt(a)?tt("screen",a,d):tt("client",a,d)})(o,n.client),n.timeStamp=i}function D(n){var t=[];return S.array(n)?(t[0]=n[0],t[1]=n[1]):n.type==="touchend"?n.touches.length===1?(t[0]=n.touches[0],t[1]=n.changedTouches[0]):n.touches.length===0&&(t[0]=n.changedTouches[0],t[1]=n.changedTouches[1]):(t[0]=n.touches[0],t[1]=n.touches[1]),t}function R(n){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},i=0;i<n.length;i++){var o=n[i];for(var a in t)t[a]+=o[a]}for(var d in t)t[d]/=n.length;return t}function ie(n){if(!n.length)return null;var t=D(n),i=Math.min(t[0].pageX,t[1].pageX),o=Math.min(t[0].pageY,t[1].pageY),a=Math.max(t[0].pageX,t[1].pageX),d=Math.max(t[0].pageY,t[1].pageY);return{x:i,y:o,left:i,top:o,right:a,bottom:d,width:a-i,height:d-o}}function ae(n,t){var i=t+"X",o=t+"Y",a=D(n),d=a[0][i]-a[1][i],f=a[0][o]-a[1][o];return et(d,f)}function le(n,t){var i=t+"X",o=t+"Y",a=D(n),d=a[1][i]-a[0][i],f=a[1][o]-a[0][o];return 180*Math.atan2(f,d)/Math.PI}function me(n){return S.string(n.pointerType)?n.pointerType:S.number(n.pointerType)?[void 0,void 0,"touch","pen","mouse"][n.pointerType]:/touch/.test(n.type||"")||n instanceof ce.Touch?"touch":"mouse"}function Se(n){var t=S.func(n.composedPath)?n.composedPath():n.path;return[He(t?t[0]:n.target),He(n.currentTarget)]}var q=(function(){function n(t){s(this,n),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return p(n,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n})();Object.defineProperty(q.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var pe=function(n,t){for(var i=0;i<t.length;i++){var o=t[i];n.push(o)}return n},_e=function(n){return pe([],n)},Ae=function(n,t){for(var i=0;i<n.length;i++)if(t(n[i],i,n))return i;return-1},he=function(n,t){return n[Ae(n,t)]},ze=(function(n){h(i,n);var t=_(i);function i(o,a,d){var f;s(this,i),(f=t.call(this,a._interaction)).dropzone=void 0,f.dragEvent=void 0,f.relatedTarget=void 0,f.draggable=void 0,f.propagationStopped=!1,f.immediatePropagationStopped=!1;var g=d==="dragleave"?o.prev:o.cur,v=g.element,w=g.dropzone;return f.type=d,f.target=v,f.currentTarget=v,f.dropzone=w,f.dragEvent=a,f.relatedTarget=a.target,f.draggable=a.interactable,f.timeStamp=a.timeStamp,f}return p(i,[{key:"reject",value:function(){var o=this,a=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&a.cur.dropzone===this.dropzone&&a.cur.element===this.target)if(a.prev.dropzone=this.dropzone,a.prev.element=this.target,a.rejected=!0,a.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var d=a.activeDrops,f=Ae(d,(function(v){var w=v.dropzone,y=v.element;return w===o.dropzone&&y===o.target}));a.activeDrops.splice(f,1);var g=new i(a,this.dragEvent,"dropdeactivate");g.dropzone=this.dropzone,g.target=this.target,this.dropzone.fire(g)}else this.dropzone.fire(new i(a,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),i})(q);function Ge(n,t){for(var i=0,o=n.slice();i<o.length;i++){var a=o[i],d=a.dropzone,f=a.element;t.dropzone=d,t.target=f,d.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function wt(n,t){for(var i=(function(d,f){for(var g=[],v=0,w=d.interactables.list;v<w.length;v++){var y=w[v];if(y.options.drop.enabled){var E=y.options.drop.accept;if(!(S.element(E)&&E!==f||S.string(E)&&!$e(f,E)||S.func(E)&&!E({dropzone:y,draggableElement:f})))for(var A=0,P=y.getAllElements();A<P.length;A++){var M=P[A];M!==f&&g.push({dropzone:y,element:M,rect:y.getRect(M)})}}}return g})(n,t),o=0;o<i.length;o++){var a=i[o];a.rect=a.dropzone.getRect(a.element)}return i}function Lt(n,t,i){for(var o=n.dropState,a=n.interactable,d=n.element,f=[],g=0,v=o.activeDrops;g<v.length;g++){var w=v[g],y=w.dropzone,E=w.element,A=w.rect,P=y.dropCheck(t,i,a,d,E,A);f.push(P?E:null)}var M=(function(F){for(var j,N,H,J=[],ne=0;ne<F.length;ne++){var W=F[ne],Z=F[j];if(W&&ne!==j)if(Z){var Fe=gt(W),ge=gt(Z);if(Fe!==W.ownerDocument)if(ge!==W.ownerDocument)if(Fe!==ge){J=J.length?J:Xe(Z);var Ne=void 0;if(Z instanceof ce.HTMLElement&&W instanceof ce.SVGElement&&!(W instanceof ce.SVGSVGElement)){if(W===ge)continue;Ne=W.ownerSVGElement}else Ne=W;for(var Ke=Xe(Ne,Z.ownerDocument),Qe=0;Ke[Qe]&&Ke[Qe]===J[Qe];)Qe++;var on=[Ke[Qe-1],Ke[Qe],J[Qe]];if(on[0])for(var qt=on[0].lastChild;qt;){if(qt===on[1]){j=ne,J=Ke;break}if(qt===on[2])break;qt=qt.previousSibling}}else H=Z,(parseInt(O(N=W).getComputedStyle(N).zIndex,10)||0)>=(parseInt(O(H).getComputedStyle(H).zIndex,10)||0)&&(j=ne);else j=ne}else j=ne}return j})(f);return o.activeDrops[M]||null}function St(n,t,i){var o=n.dropState,a={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return i.type==="dragstart"&&(a.activate=new ze(o,i,"dropactivate"),a.activate.target=null,a.activate.dropzone=null),i.type==="dragend"&&(a.deactivate=new ze(o,i,"dropdeactivate"),a.deactivate.target=null,a.deactivate.dropzone=null),o.rejected||(o.cur.element!==o.prev.element&&(o.prev.dropzone&&(a.leave=new ze(o,i,"dragleave"),i.dragLeave=a.leave.target=o.prev.element,i.prevDropzone=a.leave.dropzone=o.prev.dropzone),o.cur.dropzone&&(a.enter=new ze(o,i,"dragenter"),i.dragEnter=o.cur.element,i.dropzone=o.cur.dropzone)),i.type==="dragend"&&o.cur.dropzone&&(a.drop=new ze(o,i,"drop"),i.dropzone=o.cur.dropzone,i.relatedTarget=o.cur.element),i.type==="dragmove"&&o.cur.dropzone&&(a.move=new ze(o,i,"dropmove"),i.dropzone=o.cur.dropzone)),a}function kt(n,t){var i=n.dropState,o=i.activeDrops,a=i.cur,d=i.prev;t.leave&&d.dropzone.fire(t.leave),t.enter&&a.dropzone.fire(t.enter),t.move&&a.dropzone.fire(t.move),t.drop&&a.dropzone.fire(t.drop),t.deactivate&&Ge(o,t.deactivate),i.prev.dropzone=a.dropzone,i.prev.element=a.element}function zt(n,t){var i=n.interaction,o=n.iEvent,a=n.event;if(o.type==="dragmove"||o.type==="dragend"){var d=i.dropState;t.dynamicDrop&&(d.activeDrops=wt(t,i.element));var f=o,g=Lt(i,f,a);d.rejected=d.rejected&&!!g&&g.dropzone===d.cur.dropzone&&g.element===d.cur.element,d.cur.dropzone=g&&g.dropzone,d.cur.element=g&&g.element,d.events=St(i,0,f)}}var re={id:"actions/drop",install:function(n){var t=n.actions,i=n.interactStatic,o=n.Interactable,a=n.defaults;n.usePlugin(G),o.prototype.dropzone=function(d){return(function(f,g){if(S.object(g)){if(f.options.drop.enabled=g.enabled!==!1,g.listeners){var v=Ce(g.listeners),w=Object.keys(v).reduce((function(E,A){return E[/^(enter|leave)/.test(A)?"drag".concat(A):/^(activate|deactivate|move)/.test(A)?"drop".concat(A):A]=v[A],E}),{}),y=f.options.drop.listeners;y&&f.off(y),f.on(w),f.options.drop.listeners=w}return S.func(g.ondrop)&&f.on("drop",g.ondrop),S.func(g.ondropactivate)&&f.on("dropactivate",g.ondropactivate),S.func(g.ondropdeactivate)&&f.on("dropdeactivate",g.ondropdeactivate),S.func(g.ondragenter)&&f.on("dragenter",g.ondragenter),S.func(g.ondragleave)&&f.on("dragleave",g.ondragleave),S.func(g.ondropmove)&&f.on("dropmove",g.ondropmove),/^(pointer|center)$/.test(g.overlap)?f.options.drop.overlap=g.overlap:S.number(g.overlap)&&(f.options.drop.overlap=Math.max(Math.min(1,g.overlap),0)),"accept"in g&&(f.options.drop.accept=g.accept),"checker"in g&&(f.options.drop.checker=g.checker),f}return S.bool(g)?(f.options.drop.enabled=g,f):f.options.drop})(this,d)},o.prototype.dropCheck=function(d,f,g,v,w,y){return(function(E,A,P,M,F,j,N){var H=!1;if(!(N=N||E.getRect(j)))return!!E.options.drop.checker&&E.options.drop.checker(A,P,H,E,j,M,F);var J=E.options.drop.overlap;if(J==="pointer"){var ne=de(M,F,"drag"),W=_t(A);W.x+=ne.x,W.y+=ne.y;var Z=W.x>N.left&&W.x<N.right,Fe=W.y>N.top&&W.y<N.bottom;H=Z&&Fe}var ge=M.getRect(F);if(ge&&J==="center"){var Ne=ge.left+ge.width/2,Ke=ge.top+ge.height/2;H=Ne>=N.left&&Ne<=N.right&&Ke>=N.top&&Ke<=N.bottom}return ge&&S.number(J)&&(H=Math.max(0,Math.min(N.right,ge.right)-Math.max(N.left,ge.left))*Math.max(0,Math.min(N.bottom,ge.bottom)-Math.max(N.top,ge.top))/(ge.width*ge.height)>=J),E.options.drop.checker&&(H=E.options.drop.checker(A,P,H,E,j,M,F)),H})(this,d,f,g,v,w,y)},i.dynamicDrop=function(d){return S.bool(d)?(n.dynamicDrop=d,i):n.dynamicDrop},Y(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",n.dynamicDrop=!1,a.actions.drop=re.defaults},listeners:{"interactions:before-action-start":function(n){var t=n.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(n,t){var i=n.interaction,o=(n.event,n.iEvent);if(i.prepared.name==="drag"){var a=i.dropState;a.activeDrops=[],a.events={},a.activeDrops=wt(t,i.element),a.events=St(i,0,o),a.events.activate&&(Ge(a.activeDrops,a.events.activate),t.fire("actions/drop:start",{interaction:i,dragEvent:o}))}},"interactions:action-move":zt,"interactions:after-action-move":function(n,t){var i=n.interaction,o=n.iEvent;if(i.prepared.name==="drag"){var a=i.dropState;kt(i,a.events),t.fire("actions/drop:move",{interaction:i,dragEvent:o}),a.events={}}},"interactions:action-end":function(n,t){if(n.interaction.prepared.name==="drag"){var i=n.interaction,o=n.iEvent;zt(n,t),kt(i,i.dropState.events),t.fire("actions/drop:end",{interaction:i,dragEvent:o})}},"interactions:stop":function(n){var t=n.interaction;if(t.prepared.name==="drag"){var i=t.dropState;i&&(i.activeDrops=null,i.events=null,i.cur.dropzone=null,i.cur.element=null,i.prev.dropzone=null,i.prev.element=null,i.rejected=!1)}}},getActiveDrops:wt,getDrop:Lt,getDropEvents:St,fireDropEvents:kt,filterEventType:function(n){return n.search("drag")===0||n.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},te=re;function fe(n){var t=n.interaction,i=n.iEvent,o=n.phase;if(t.prepared.name==="gesture"){var a=t.pointers.map((function(w){return w.pointer})),d=o==="start",f=o==="end",g=t.interactable.options.deltaSource;if(i.touches=[a[0],a[1]],d)i.distance=ae(a,g),i.box=ie(a),i.scale=1,i.ds=0,i.angle=le(a,g),i.da=0,t.gesture.startDistance=i.distance,t.gesture.startAngle=i.angle;else if(f||t.pointers.length<2){var v=t.prevEvent;i.distance=v.distance,i.box=v.box,i.scale=v.scale,i.ds=0,i.angle=v.angle,i.da=0}else i.distance=ae(a,g),i.box=ie(a),i.scale=i.distance/t.gesture.startDistance,i.angle=le(a,g),i.ds=i.scale-t.gesture.scale,i.da=i.angle-t.gesture.angle;t.gesture.distance=i.distance,t.gesture.angle=i.angle,S.number(i.scale)&&i.scale!==1/0&&!isNaN(i.scale)&&(t.gesture.scale=i.scale)}}var Pe={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(n){var t=n.actions,i=n.Interactable,o=n.defaults;i.prototype.gesturable=function(a){return S.object(a)?(this.options.gesture.enabled=a.enabled!==!1,this.setPerAction("gesture",a),this.setOnEvents("gesture",a),this):S.bool(a)?(this.options.gesture.enabled=a,this):this.options.gesture},t.map.gesture=Pe,t.methodDict.gesture="gesturable",o.actions.gesture=Pe.defaults},listeners:{"interactions:action-start":fe,"interactions:action-move":fe,"interactions:action-end":fe,"interactions:new":function(n){n.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(n){if(!(n.interaction.pointers.length<2)){var t=n.interactable.options.gesture;if(t&&t.enabled)return n.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(n){return n.search("gesture")===0}},Be=Pe;function Et(n,t,i,o,a,d,f){if(!t)return!1;if(t===!0){var g=S.number(d.width)?d.width:d.right-d.left,v=S.number(d.height)?d.height:d.bottom-d.top;if(f=Math.min(f,Math.abs((n==="left"||n==="right"?g:v)/2)),g<0&&(n==="left"?n="right":n==="right"&&(n="left")),v<0&&(n==="top"?n="bottom":n==="bottom"&&(n="top")),n==="left"){var w=g>=0?d.left:d.right;return i.x<w+f}if(n==="top"){var y=v>=0?d.top:d.bottom;return i.y<y+f}if(n==="right")return i.x>(g>=0?d.right:d.left)-f;if(n==="bottom")return i.y>(v>=0?d.bottom:d.top)-f}return!!S.element(o)&&(S.element(t)?t===o:qe(o,t,a))}function Ct(n){var t=n.iEvent,i=n.interaction;if(i.prepared.name==="resize"&&i.resizeAxes){var o=t;i.interactable.options.resize.square?(i.resizeAxes==="y"?o.delta.x=o.delta.y:o.delta.y=o.delta.x,o.axes="xy"):(o.axes=i.resizeAxes,i.resizeAxes==="x"?o.delta.y=0:i.resizeAxes==="y"&&(o.delta.x=0))}}var ke,Oe,De={id:"actions/resize",before:["actions/drag"],install:function(n){var t=n.actions,i=n.browser,o=n.Interactable,a=n.defaults;De.cursors=(function(d){return d.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(i),De.defaultMargin=i.supportsTouch||i.supportsPointerEvent?20:10,o.prototype.resizable=function(d){return(function(f,g,v){return S.object(g)?(f.options.resize.enabled=g.enabled!==!1,f.setPerAction("resize",g),f.setOnEvents("resize",g),S.string(g.axis)&&/^x$|^y$|^xy$/.test(g.axis)?f.options.resize.axis=g.axis:g.axis===null&&(f.options.resize.axis=v.defaults.actions.resize.axis),S.bool(g.preserveAspectRatio)?f.options.resize.preserveAspectRatio=g.preserveAspectRatio:S.bool(g.square)&&(f.options.resize.square=g.square),f):S.bool(g)?(f.options.resize.enabled=g,f):f.options.resize})(this,d,n)},t.map.resize=De,t.methodDict.resize="resizable",a.actions.resize=De.defaults},listeners:{"interactions:new":function(n){n.interaction.resizeAxes="xy"},"interactions:action-start":function(n){(function(t){var i=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var a=i,d=o.rect;o._rects={start:Y({},d),corrected:Y({},d),previous:Y({},d),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},a.edges=o.prepared.edges,a.rect=o._rects.corrected,a.deltaRect=o._rects.delta}})(n),Ct(n)},"interactions:action-move":function(n){(function(t){var i=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var a=i,d=o.interactable.options.resize.invert,f=d==="reposition"||d==="negate",g=o.rect,v=o._rects,w=v.start,y=v.corrected,E=v.delta,A=v.previous;if(Y(A,y),f){if(Y(y,g),d==="reposition"){if(y.top>y.bottom){var P=y.top;y.top=y.bottom,y.bottom=P}if(y.left>y.right){var M=y.left;y.left=y.right,y.right=M}}}else y.top=Math.min(g.top,w.bottom),y.bottom=Math.max(g.bottom,w.top),y.left=Math.min(g.left,w.right),y.right=Math.max(g.right,w.left);for(var F in y.width=y.right-y.left,y.height=y.bottom-y.top,y)E[F]=y[F]-A[F];a.edges=o.prepared.edges,a.rect=y,a.deltaRect=E}})(n),Ct(n)},"interactions:action-end":function(n){var t=n.iEvent,i=n.interaction;if(i.prepared.name==="resize"&&i.prepared.edges){var o=t;o.edges=i.prepared.edges,o.rect=i._rects.corrected,o.deltaRect=i._rects.delta}},"auto-start:check":function(n){var t=n.interaction,i=n.interactable,o=n.element,a=n.rect,d=n.buttons;if(a){var f=Y({},t.coords.cur.page),g=i.options.resize;if(g&&g.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(d&g.mouseButtons)!=0)){if(S.object(g.edges)){var v={left:!1,right:!1,top:!1,bottom:!1};for(var w in v)v[w]=Et(w,g.edges[w],f,t._latestPointer.eventTarget,o,a,g.margin||De.defaultMargin);v.left=v.left&&!v.right,v.top=v.top&&!v.bottom,(v.left||v.right||v.top||v.bottom)&&(n.action={name:"resize",edges:v})}else{var y=g.axis!=="y"&&f.x>a.right-De.defaultMargin,E=g.axis!=="x"&&f.y>a.bottom-De.defaultMargin;(y||E)&&(n.action={name:"resize",axes:(y?"x":"")+(E?"y":"")})}return!n.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(n){var t=n.edges,i=n.axis,o=n.name,a=De.cursors,d=null;if(i)d=a[o+i];else if(t){for(var f="",g=0,v=["top","bottom","left","right"];g<v.length;g++){var w=v[g];t[w]&&(f+=w)}d=a[f]}return d},filterEventType:function(n){return n.search("resize")===0},defaultMargin:null},dt=De,Vt={id:"actions",install:function(n){n.usePlugin(Be),n.usePlugin(dt),n.usePlugin(G),n.usePlugin(te)}},Je=0,nt={request:function(n){return ke(n)},cancel:function(n){return Oe(n)},init:function(n){if(ke=n.requestAnimationFrame,Oe=n.cancelAnimationFrame,!ke)for(var t=["ms","moz","webkit","o"],i=0;i<t.length;i++){var o=t[i];ke=n["".concat(o,"RequestAnimationFrame")],Oe=n["".concat(o,"CancelAnimationFrame")]||n["".concat(o,"CancelRequestAnimationFrame")]}ke=ke&&ke.bind(n),Oe=Oe&&Oe.bind(n),ke||(ke=function(a){var d=Date.now(),f=Math.max(0,16-(d-Je)),g=n.setTimeout((function(){a(d+f)}),f);return Je=d+f,g},Oe=function(a){return clearTimeout(a)})}},X={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(n){X.isScrolling=!0,nt.cancel(X.i),n.autoScroll=X,X.interaction=n,X.prevTime=X.now(),X.i=nt.request(X.scroll)},stop:function(){X.isScrolling=!1,X.interaction&&(X.interaction.autoScroll=null),nt.cancel(X.i)},scroll:function(){var n=X.interaction,t=n.interactable,i=n.element,o=n.prepared.name,a=t.options[o].autoScroll,d=Yn(a.container,t,i),f=X.now(),g=(f-X.prevTime)/1e3,v=a.speed*g;if(v>=1){var w={x:X.x*v,y:X.y*v};if(w.x||w.y){var y=$n(d);S.window(d)?d.scrollBy(w.x,w.y):d&&(d.scrollLeft+=w.x,d.scrollTop+=w.y);var E=$n(d),A={x:E.x-y.x,y:E.y-y.y};(A.x||A.y)&&t.fire({type:"autoscroll",target:i,interactable:t,delta:A,interaction:n,container:d})}X.prevTime=f}X.isScrolling&&(nt.cancel(X.i),X.i=nt.request(X.scroll))},check:function(n,t){var i;return(i=n.options[t].autoScroll)==null?void 0:i.enabled},onInteractionMove:function(n){var t=n.interaction,i=n.pointer;if(t.interacting()&&X.check(t.interactable,t.prepared.name))if(t.simulation)X.x=X.y=0;else{var o,a,d,f,g=t.interactable,v=t.element,w=t.prepared.name,y=g.options[w].autoScroll,E=Yn(y.container,g,v);if(S.window(E))f=i.clientX<X.margin,o=i.clientY<X.margin,a=i.clientX>E.innerWidth-X.margin,d=i.clientY>E.innerHeight-X.margin;else{var A=mt(E);f=i.clientX<A.left+X.margin,o=i.clientY<A.top+X.margin,a=i.clientX>A.right-X.margin,d=i.clientY>A.bottom-X.margin}X.x=a?1:f?-1:0,X.y=d?1:o?-1:0,X.isScrolling||(X.margin=y.margin,X.speed=y.speed,X.start(t))}}};function Yn(n,t,i){return(S.string(n)?yt(n,t,i):n)||O(i)}function $n(n){return S.window(n)&&(n=window.document.body),{x:n.scrollLeft,y:n.scrollTop}}var Er={id:"auto-scroll",install:function(n){var t=n.defaults,i=n.actions;n.autoScroll=X,X.now=function(){return n.now()},i.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=X.defaults},listeners:{"interactions:new":function(n){n.interaction.autoScroll=null},"interactions:destroy":function(n){n.interaction.autoScroll=null,X.stop(),X.interaction&&(X.interaction=null)},"interactions:stop":X.stop,"interactions:action-move":function(n){return X.onInteractionMove(n)}}},Cr=Er;function Dt(n,t){var i=!1;return function(){return i||(L.console.warn(t),i=!0),n.apply(this,arguments)}}function pn(n,t){return n.name=t.name,n.axis=t.axis,n.edges=t.edges,n}function Ar(n){return S.bool(n)?(this.options.styleCursor=n,this):n===null?(delete this.options.styleCursor,this):this.options.styleCursor}function Or(n){return S.func(n)?(this.options.actionChecker=n,this):n===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Tr={id:"auto-start/interactableMethods",install:function(n){var t=n.Interactable;t.prototype.getAction=function(i,o,a,d){var f=(function(g,v,w,y,E){var A=g.getRect(y),P=v.buttons||{0:1,1:4,3:8,4:16}[v.button],M={action:null,interactable:g,interaction:w,element:y,rect:A,buttons:P};return E.fire("auto-start:check",M),M.action})(this,o,a,d,n);return this.options.actionChecker?this.options.actionChecker(i,o,f,this,d,a):f},t.prototype.ignoreFrom=Dt((function(i){return this._backCompatOption("ignoreFrom",i)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=Dt((function(i){return this._backCompatOption("allowFrom",i)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Or,t.prototype.styleCursor=Ar}};function Kn(n,t,i,o,a){return t.testIgnoreAllow(t.options[n.name],i,o)&&t.options[n.name].enabled&&Gt(t,i,n,a)?n:null}function Mr(n,t,i,o,a,d,f){for(var g=0,v=o.length;g<v;g++){var w=o[g],y=a[g],E=w.getAction(t,i,n,y);if(E){var A=Kn(E,w,y,d,f);if(A)return{action:A,interactable:w,element:y}}}return{action:null,interactable:null,element:null}}function Un(n,t,i,o,a){var d=[],f=[],g=o;function v(y){d.push(y),f.push(g)}for(;S.element(g);){d=[],f=[],a.interactables.forEachMatch(g,v);var w=Mr(n,t,i,d,f,o,a);if(w.action&&!w.interactable.options[w.action.name].manualStart)return w;g=je(g)}return{action:null,interactable:null,element:null}}function Wn(n,t,i){var o=t.action,a=t.interactable,d=t.element;o=o||{name:null},n.interactable=a,n.element=d,pn(n.prepared,o),n.rect=a&&o.name?a.getRect(d):null,Vn(n,i),i.fire("autoStart:prepared",{interaction:n})}function Gt(n,t,i,o){var a=n.options,d=a[i.name].max,f=a[i.name].maxPerElement,g=o.autoStart.maxInteractions,v=0,w=0,y=0;if(!(d&&f&&g))return!1;for(var E=0,A=o.interactions.list;E<A.length;E++){var P=A[E],M=P.prepared.name;if(P.interacting()&&(++v>=g||P.interactable===n&&((w+=M===i.name?1:0)>=d||P.element===t&&(y++,M===i.name&&y>=f))))return!1}return g>0}function Xn(n,t){return S.number(n)?(t.autoStart.maxInteractions=n,this):t.autoStart.maxInteractions}function hn(n,t,i){var o=i.autoStart.cursorElement;o&&o!==n&&(o.style.cursor=""),n.ownerDocument.documentElement.style.cursor=t,n.style.cursor=t,i.autoStart.cursorElement=t?n:null}function Vn(n,t){var i=n.interactable,o=n.element,a=n.prepared;if(n.pointerType==="mouse"&&i&&i.options.styleCursor){var d="";if(a.name){var f=i.options[a.name].cursorChecker;d=S.func(f)?f(a,i,o,n._interacting):t.actions.map[a.name].getCursor(a)}hn(n.element,d||"",t)}else t.autoStart.cursorElement&&hn(t.autoStart.cursorElement,"",t)}var Pr={id:"auto-start/base",before:["actions"],install:function(n){var t=n.interactStatic,i=n.defaults;n.usePlugin(Tr),i.base.actionChecker=null,i.base.styleCursor=!0,Y(i.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(o){return Xn(o,n)},n.autoStart={maxInteractions:1/0,withinInteractionLimit:Gt,cursorElement:null}},listeners:{"interactions:down":function(n,t){var i=n.interaction,o=n.pointer,a=n.event,d=n.eventTarget;i.interacting()||Wn(i,Un(i,o,a,d,t),t)},"interactions:move":function(n,t){(function(i,o){var a=i.interaction,d=i.pointer,f=i.event,g=i.eventTarget;a.pointerType!=="mouse"||a.pointerIsDown||a.interacting()||Wn(a,Un(a,d,f,g,o),o)})(n,t),(function(i,o){var a=i.interaction;if(a.pointerIsDown&&!a.interacting()&&a.pointerWasMoved&&a.prepared.name){o.fire("autoStart:before-start",i);var d=a.interactable,f=a.prepared.name;f&&d&&(d.options[f].manualStart||!Gt(d,a.element,a.prepared,o)?a.stop():(a.start(a.prepared,d,a.element),Vn(a,o)))}})(n,t)},"interactions:stop":function(n,t){var i=n.interaction,o=i.interactable;o&&o.options.styleCursor&&hn(i.element,"",t)}},maxInteractions:Xn,withinInteractionLimit:Gt,validateAction:Kn},fn=Pr,Ir={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(n,t){var i=n.interaction,o=n.eventTarget,a=n.dx,d=n.dy;if(i.prepared.name==="drag"){var f=Math.abs(a),g=Math.abs(d),v=i.interactable.options.drag,w=v.startAxis,y=f>g?"x":f<g?"y":"xy";if(i.prepared.axis=v.lockAxis==="start"?y[0]:v.lockAxis,y!=="xy"&&w!=="xy"&&w!==y){i.prepared.name=null;for(var E=o,A=function(M){if(M!==i.interactable){var F=i.interactable.options.drag;if(!F.manualStart&&M.testIgnoreAllow(F,E,o)){var j=M.getAction(i.downPointer,i.downEvent,i,E);if(j&&j.name==="drag"&&(function(N,H){if(!H)return!1;var J=H.options.drag.startAxis;return N==="xy"||J==="xy"||J===N})(y,M)&&fn.validateAction(j,M,E,o,t))return M}}};S.element(E);){var P=t.interactables.forEachMatch(E,A);if(P){i.prepared.name="drag",i.interactable=P,i.element=E;break}E=je(E)}}}}}};function gn(n){var t=n.prepared&&n.prepared.name;if(!t)return null;var i=n.interactable.options;return i[t].hold||i[t].delay}var Fr={id:"auto-start/hold",install:function(n){var t=n.defaults;n.usePlugin(fn),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(n){n.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(n){var t=n.interaction,i=gn(t);i>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),i))},"interactions:move":function(n){var t=n.interaction,i=n.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!i&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(n){var t=n.interaction;gn(t)>0&&(t.prepared.name=null)}},getHoldDuration:gn},Lr=Fr,zr={id:"auto-start",install:function(n){n.usePlugin(fn),n.usePlugin(Lr),n.usePlugin(Ir)}},Dr=function(n){return/^(always|never|auto)$/.test(n)?(this.options.preventDefault=n,this):S.bool(n)?(this.options.preventDefault=n?"always":"never",this):this.options.preventDefault};function Rr(n){var t=n.interaction,i=n.event;t.interactable&&t.interactable.checkAndPreventDefault(i)}var Gn={id:"core/interactablePreventDefault",install:function(n){var t=n.Interactable;t.prototype.preventDefault=Dr,t.prototype.checkAndPreventDefault=function(i){return(function(o,a,d){var f=o.options.preventDefault;if(f!=="never")if(f!=="always"){if(a.events.supportsPassive&&/^touch(start|move)$/.test(d.type)){var g=O(d.target).document,v=a.getDocOptions(g);if(!v||!v.events||v.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(d.type)||S.element(d.target)&&$e(d.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||d.preventDefault()}else d.preventDefault()})(this,n,i)},n.interactions.docEvents.push({type:"dragstart",listener:function(i){for(var o=0,a=n.interactions.list;o<a.length;o++){var d=a[o];if(d.element&&(d.element===i.target||Ye(d.element,i.target)))return void d.interactable.checkAndPreventDefault(i)}}})},listeners:["down","move","up","cancel"].reduce((function(n,t){return n["interactions:".concat(t)]=Rr,n}),{})};function Jt(n,t){if(t.phaselessTypes[n])return!0;for(var i in t.map)if(n.indexOf(i)===0&&n.substr(i.length)in t.phases)return!0;return!1}function At(n){var t={};for(var i in n){var o=n[i];S.plainObject(o)?t[i]=At(o):S.array(o)?t[i]=_e(o):t[i]=o}return t}var mn=(function(){function n(t){s(this,n),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=Qt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return p(n,[{key:"start",value:function(t,i){var o,a,d=t.phase,f=this.interaction,g=(function(w){var y=w.interactable.options[w.prepared.name],E=y.modifiers;return E&&E.length?E:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(A){var P=y[A];return P&&P.enabled&&{options:P,methods:P._methods}})).filter((function(A){return!!A}))})(f);this.prepareStates(g),this.startEdges=Y({},f.edges),this.edges=Y({},this.startEdges),this.startOffset=(o=f.rect,a=i,o?{left:a.x-o.left,top:a.y-o.top,right:o.right-a.x,bottom:o.bottom-a.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var v=this.fillArg({phase:d,pageCoords:i,preEnd:!1});return this.result=Qt(),this.startAll(v),this.result=this.setAll(v)}},{key:"fillArg",value:function(t){var i=this.interaction;return t.interaction=i,t.interactable=i.interactable,t.element=i.element,t.rect||(t.rect=i.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var i=0,o=this.states;i<o.length;i++){var a=o[i];a.methods.start&&(t.state=a,a.methods.start(t))}}},{key:"setAll",value:function(t){var i=t.phase,o=t.preEnd,a=t.skipModifiers,d=t.rect,f=t.edges;t.coords=Y({},t.pageCoords),t.rect=Y({},d),t.edges=Y({},f);for(var g=a?this.states.slice(a):this.states,v=Qt(t.coords,t.rect),w=0;w<g.length;w++){var y,E=g[w],A=E.options,P=Y({},t.coords),M=null;(y=E.methods)!=null&&y.set&&this.shouldDo(A,o,i)&&(t.state=E,M=E.methods.set(t),se(t.edges,t.rect,{x:t.coords.x-P.x,y:t.coords.y-P.y})),v.eventProps.push(M)}Y(this.edges,t.edges),v.delta.x=t.coords.x-t.pageCoords.x,v.delta.y=t.coords.y-t.pageCoords.y,v.rectDelta.left=t.rect.left-d.left,v.rectDelta.right=t.rect.right-d.right,v.rectDelta.top=t.rect.top-d.top,v.rectDelta.bottom=t.rect.bottom-d.bottom;var F=this.result.coords,j=this.result.rect;if(F&&j){var N=v.rect.left!==j.left||v.rect.right!==j.right||v.rect.top!==j.top||v.rect.bottom!==j.bottom;v.changed=N||F.x!==v.coords.x||F.y!==v.coords.y}return v}},{key:"applyToInteraction",value:function(t){var i=this.interaction,o=t.phase,a=i.coords.cur,d=i.coords.start,f=this.result,g=this.startDelta,v=f.delta;o==="start"&&Y(this.startDelta,f.delta);for(var w=0,y=[[d,g],[a,v]];w<y.length;w++){var E=y[w],A=E[0],P=E[1];A.page.x+=P.x,A.page.y+=P.y,A.client.x+=P.x,A.client.y+=P.y}var M=this.result.rectDelta,F=t.rect||i.rect;F.left+=M.left,F.right+=M.right,F.top+=M.top,F.bottom+=M.bottom,F.width=F.right-F.left,F.height=F.bottom-F.top}},{key:"setAndApply",value:function(t){var i=this.interaction,o=t.phase,a=t.preEnd,d=t.skipModifiers,f=this.setAll(this.fillArg({preEnd:a,phase:o,pageCoords:t.modifiedCoords||i.coords.cur.page}));if(this.result=f,!f.changed&&(!d||d<this.states.length)&&i.interacting())return!1;if(t.modifiedCoords){var g=i.coords.cur.page,v={x:t.modifiedCoords.x-g.x,y:t.modifiedCoords.y-g.y};f.coords.x+=v.x,f.coords.y+=v.y,f.delta.x+=v.x,f.delta.y+=v.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var i=t.interaction,o=t.event,a=this.states;if(a&&a.length){for(var d=!1,f=0;f<a.length;f++){var g=a[f];t.state=g;var v=g.options,w=g.methods,y=w.beforeEnd&&w.beforeEnd(t);if(y)return this.endResult=y,!1;d=d||!d&&this.shouldDo(v,!0,t.phase,!0)}d&&i.move({event:o,preEnd:!0})}}},{key:"stop",value:function(t){var i=t.interaction;if(this.states&&this.states.length){var o=Y({states:this.states,interactable:i.interactable,element:i.element,rect:null},t);this.fillArg(o);for(var a=0,d=this.states;a<d.length;a++){var f=d[a];o.state=f,f.methods.stop&&f.methods.stop(o)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var i=0;i<t.length;i++){var o=t[i],a=o.options,d=o.methods,f=o.name;this.states.push({options:a,methods:d,index:i,name:f})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var i=t.interaction,o=i.coords,a=i.rect,d=i.modification;if(d.result){for(var f=d.startDelta,g=d.result,v=g.delta,w=g.rectDelta,y=0,E=[[o.start,f],[o.cur,v]];y<E.length;y++){var A=E[y],P=A[0],M=A[1];P.page.x-=M.x,P.page.y-=M.y,P.client.x-=M.x,P.client.y-=M.y}a.left-=w.left,a.right-=w.right,a.top-=w.top,a.bottom-=w.bottom}}},{key:"shouldDo",value:function(t,i,o,a){return!(!t||t.enabled===!1||a&&!t.endOnly||t.endOnly&&!i||o==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(i){return At(i)})),this.result=Qt(Y({},t.result.coords),Y({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),n})();function Qt(n,t){return{rect:t,coords:n,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function it(n,t){var i=n.defaults,o={start:n.start,set:n.set,beforeEnd:n.beforeEnd,stop:n.stop},a=function(d){var f=d||{};for(var g in f.enabled=f.enabled!==!1,i)g in f||(f[g]=i[g]);var v={options:f,methods:o,name:t,enable:function(){return f.enabled=!0,v},disable:function(){return f.enabled=!1,v}};return v};return t&&typeof t=="string"&&(a._defaults=i,a._methods=o),a}function Rt(n){var t=n.iEvent,i=n.interaction.modification.result;i&&(t.modifiers=i.eventProps)}var Br={id:"modifiers/base",before:["actions"],install:function(n){n.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(n){var t=n.interaction;t.modification=new mn(t)},"interactions:before-action-start":function(n){var t=n.interaction,i=n.interaction.modification;i.start(n,t.coords.start.page),t.edges=i.edges,i.applyToInteraction(n)},"interactions:before-action-move":function(n){var t=n.interaction,i=t.modification,o=i.setAndApply(n);return t.edges=i.edges,o},"interactions:before-action-end":function(n){var t=n.interaction,i=t.modification,o=i.beforeEnd(n);return t.edges=i.startEdges,o},"interactions:action-start":Rt,"interactions:action-move":Rt,"interactions:action-end":Rt,"interactions:after-action-start":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-move":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:stop":function(n){return n.interaction.modification.stop(n)}}},Jn=Br,Qn={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},vn=(function(n){h(i,n);var t=_(i);function i(o,a,d,f,g,v,w){var y;s(this,i),(y=t.call(this,o)).relatedTarget=null,y.screenX=void 0,y.screenY=void 0,y.button=void 0,y.buttons=void 0,y.ctrlKey=void 0,y.shiftKey=void 0,y.altKey=void 0,y.metaKey=void 0,y.page=void 0,y.client=void 0,y.delta=void 0,y.rect=void 0,y.x0=void 0,y.y0=void 0,y.t0=void 0,y.dt=void 0,y.duration=void 0,y.clientX0=void 0,y.clientY0=void 0,y.velocity=void 0,y.speed=void 0,y.swipe=void 0,y.axes=void 0,y.preEnd=void 0,g=g||o.element;var E=o.interactable,A=(E&&E.options||Qn).deltaSource,P=de(E,g,d),M=f==="start",F=f==="end",j=M?b(y):o.prevEvent,N=M?o.coords.start:F?{page:j.page,client:j.client,timeStamp:o.coords.cur.timeStamp}:o.coords.cur;return y.page=Y({},N.page),y.client=Y({},N.client),y.rect=Y({},o.rect),y.timeStamp=N.timeStamp,F||(y.page.x-=P.x,y.page.y-=P.y,y.client.x-=P.x,y.client.y-=P.y),y.ctrlKey=a.ctrlKey,y.altKey=a.altKey,y.shiftKey=a.shiftKey,y.metaKey=a.metaKey,y.button=a.button,y.buttons=a.buttons,y.target=g,y.currentTarget=g,y.preEnd=v,y.type=w||d+(f||""),y.interactable=E,y.t0=M?o.pointers[o.pointers.length-1].downTime:j.t0,y.x0=o.coords.start.page.x-P.x,y.y0=o.coords.start.page.y-P.y,y.clientX0=o.coords.start.client.x-P.x,y.clientY0=o.coords.start.client.y-P.y,y.delta=M||F?{x:0,y:0}:{x:y[A].x-j[A].x,y:y[A].y-j[A].y},y.dt=o.coords.delta.timeStamp,y.duration=y.timeStamp-y.t0,y.velocity=Y({},o.coords.velocity[A]),y.speed=et(y.velocity.x,y.velocity.y),y.swipe=F||f==="inertiastart"?y.getSwipe():null,y}return p(i,[{key:"getSwipe",value:function(){var o=this._interaction;if(o.prevEvent.speed<600||this.timeStamp-o.prevEvent.timeStamp>150)return null;var a=180*Math.atan2(o.prevEvent.velocityY,o.prevEvent.velocityX)/Math.PI;a<0&&(a+=360);var d=112.5<=a&&a<247.5,f=202.5<=a&&a<337.5;return{up:f,down:!f&&22.5<=a&&a<157.5,left:d,right:!d&&(292.5<=a||a<67.5),angle:a,speed:o.prevEvent.speed,velocity:{x:o.prevEvent.velocityX,y:o.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),i})(q);Object.defineProperties(vn.prototype,{pageX:{get:function(){return this.page.x},set:function(n){this.page.x=n}},pageY:{get:function(){return this.page.y},set:function(n){this.page.y=n}},clientX:{get:function(){return this.client.x},set:function(n){this.client.x=n}},clientY:{get:function(){return this.client.y},set:function(n){this.client.y=n}},dx:{get:function(){return this.delta.x},set:function(n){this.delta.x=n}},dy:{get:function(){return this.delta.y},set:function(n){this.delta.y=n}},velocityX:{get:function(){return this.velocity.x},set:function(n){this.velocity.x=n}},velocityY:{get:function(){return this.velocity.y},set:function(n){this.velocity.y=n}}});var Nr=p((function n(t,i,o,a,d){s(this,n),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=i,this.event=o,this.downTime=a,this.downTarget=d})),jr=(function(n){return n.interactable="",n.element="",n.prepared="",n.pointerIsDown="",n.pointerWasMoved="",n._proxy="",n})({}),Zn=(function(n){return n.start="",n.move="",n.end="",n.stop="",n.interacting="",n})({}),qr=0,Hr=(function(){function n(t){var i=this,o=t.pointerType,a=t.scopeFire;s(this,n),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Dt((function(y){this.move(y)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=qr++,this._scopeFire=a,this.pointerType=o;var d=this;this._proxy={};var f=function(y){Object.defineProperty(i._proxy,y,{get:function(){return d[y]}})};for(var g in jr)f(g);var v=function(y){Object.defineProperty(i._proxy,y,{value:function(){return d[y].apply(d,arguments)}})};for(var w in Zn)v(w);this._scopeFire("interactions:new",{interaction:this})}return p(n,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,i,o){var a=this.updatePointer(t,i,o,!0),d=this.pointers[a];this._scopeFire("interactions:down",{pointer:t,event:i,eventTarget:o,pointerIndex:a,pointerInfo:d,type:"down",interaction:this})}},{key:"start",value:function(t,i,o){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!i.options[t.name].enabled)&&(pn(this.prepared,t),this.interactable=i,this.element=o,this.rect=i.getRect(o),this.edges=this.prepared.edges?Y({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,i,o){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,i,o,!1);var a,d,f=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(a=this.coords.cur.client.x-this.coords.start.client.x,d=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=et(a,d)>this.pointerMoveTolerance);var g,v,w,y=this.getPointerIndex(t),E={pointer:t,pointerIndex:y,pointerInfo:this.pointers[y],event:i,type:"move",eventTarget:o,dx:a,dy:d,duplicate:f,interaction:this};f||(g=this.coords.velocity,v=this.coords.delta,w=Math.max(v.timeStamp/1e3,.001),g.page.x=v.page.x/w,g.page.y=v.page.y/w,g.client.x=v.client.x/w,g.client.y=v.client.y/w,g.timeStamp=w),this._scopeFire("interactions:move",E),f||this.simulation||(this.interacting()&&(E.type=null,this.move(E)),this.pointerWasMoved&&xt(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||Wt(this.coords.delta),(t=Y({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,i,o,a){var d=this.getPointerIndex(t);d===-1&&(d=this.updatePointer(t,i,o,!1));var f=/cancel$/i.test(i.type)?"cancel":"up";this._scopeFire("interactions:".concat(f),{pointer:t,pointerIndex:d,pointerInfo:this.pointers[d],event:i,eventTarget:o,type:f,curEventTarget:a,interaction:this}),this.simulation||this.end(i),this.removePointer(t,i)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var i;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(i=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,i===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var i=Ve(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:Ae(this.pointers,(function(o){return o.id===i}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,i,o,a){var d,f,g,v=Ve(t),w=this.getPointerIndex(t),y=this.pointers[w];return a=a!==!1&&(a||/(down|start)$/i.test(i.type)),y?y.pointer=t:(y=new Nr(v,t,i,null,null),w=this.pointers.length,this.pointers.push(y)),Hn(this.coords.cur,this.pointers.map((function(E){return E.pointer})),this._now()),d=this.coords.delta,f=this.coords.prev,g=this.coords.cur,d.page.x=g.page.x-f.page.x,d.page.y=g.page.y-f.page.y,d.client.x=g.client.x-f.client.x,d.client.y=g.client.y-f.client.y,d.timeStamp=g.timeStamp-f.timeStamp,a&&(this.pointerIsDown=!0,y.downTime=this.coords.cur.timeStamp,y.downTarget=o,Me(this.downPointer,t),this.interacting()||(xt(this.coords.start,this.coords.cur),xt(this.coords.prev,this.coords.cur),this.downEvent=i,this.pointerWasMoved=!1)),this._updateLatestPointer(t,i,o),this._scopeFire("interactions:update-pointer",{pointer:t,event:i,eventTarget:o,down:a,pointerInfo:y,pointerIndex:w,interaction:this}),w}},{key:"removePointer",value:function(t,i){var o=this.getPointerIndex(t);if(o!==-1){var a=this.pointers[o];this._scopeFire("interactions:remove-pointer",{pointer:t,event:i,eventTarget:null,pointerIndex:o,pointerInfo:a,interaction:this}),this.pointers.splice(o,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,i,o){this._latestPointer.pointer=t,this._latestPointer.event=i,this._latestPointer.eventTarget=o}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,i,o,a){return new vn(this,t,this.prepared.name,i,this.element,o,a)}},{key:"_fireEvent",value:function(t){var i;(i=this.interactable)==null||i.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var i=t.event,o=t.phase,a=t.preEnd,d=t.type,f=this.rect;if(f&&o==="move"&&(se(this.edges,f,this.coords.delta[this.interactable.options.deltaSource]),f.width=f.right-f.left,f.height=f.bottom-f.top),this._scopeFire("interactions:before-action-".concat(o),t)===!1)return!1;var g=t.iEvent=this._createPreparedEvent(i,o,a,d);return this._scopeFire("interactions:action-".concat(o),t),o==="start"&&(this.prevEvent=g),this._fireEvent(g),this._scopeFire("interactions:after-action-".concat(o),t),!0}},{key:"_now",value:function(){return Date.now()}}]),n})();function ei(n){ti(n.interaction)}function ti(n){if(!(function(i){return!(!i.offset.pending.x&&!i.offset.pending.y)})(n))return!1;var t=n.offset.pending;return yn(n.coords.cur,t),yn(n.coords.delta,t),se(n.edges,n.rect,t),t.x=0,t.y=0,!0}function Yr(n){var t=n.x,i=n.y;this.offset.pending.x+=t,this.offset.pending.y+=i,this.offset.total.x+=t,this.offset.total.y+=i}function yn(n,t){var i=n.page,o=n.client,a=t.x,d=t.y;i.x+=a,i.y+=d,o.x+=a,o.y+=d}Zn.offsetBy="";var $r={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(n){n.Interaction.prototype.offsetBy=Yr},listeners:{"interactions:new":function(n){n.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(n){return(function(t){t.pointerIsDown&&(yn(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(n.interaction)},"interactions:before-action-start":ei,"interactions:before-action-move":ei,"interactions:before-action-end":function(n){var t=n.interaction;if(ti(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(n){var t=n.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},ni=$r,Kr=(function(){function n(t){s(this,n),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return p(n,[{key:"start",value:function(t){var i=this.interaction,o=Zt(i);if(!o||!o.enabled)return!1;var a=i.coords.velocity.client,d=et(a.x,a.y),f=this.modification||(this.modification=new mn(i));if(f.copyFrom(i.modification),this.t0=i._now(),this.allowResume=o.allowResume,this.v0=d,this.currentOffset={x:0,y:0},this.startCoords=i.coords.cur.page,this.modifierArg=f.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-i.coords.cur.timeStamp<50&&d>o.minSpeed&&d>o.endSpeed)this.startInertia();else{if(f.result=f.setAll(this.modifierArg),!f.result.changed)return!1;this.startSmoothEnd()}return i.modification.result.rect=null,i.offsetBy(this.targetOffset),i._doPhase({interaction:i,event:t,phase:"inertiastart"}),i.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),i.modification.result.rect=null,this.active=!0,i.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,i=this.interaction.coords.velocity.client,o=Zt(this.interaction),a=o.resistance,d=-Math.log(o.endSpeed/this.v0)/a;this.targetOffset={x:(i.x-d)/a,y:(i.y-d)/a},this.te=d,this.lambda_v0=a/this.v0,this.one_ve_v0=1-o.endSpeed/this.v0;var f=this.modification,g=this.modifierArg;g.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},f.result=f.setAll(g),f.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+f.result.delta.x,y:this.targetOffset.y+f.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var i=this;this.timeout=nt.request((function(){i.active&&t()}))}},{key:"inertiaTick",value:function(){var t,i,o,a,d,f,g,v=this,w=this.interaction,y=Zt(w).resistance,E=(w._now()-this.t0)/1e3;if(E<this.te){var A,P=1-(Math.exp(-y*E)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,i=0,o=this.targetOffset.x,a=this.targetOffset.y,d=this.modifiedOffset.x,f=this.modifiedOffset.y,A={x:ii(g=P,t,o,d),y:ii(g,i,a,f)}):A={x:this.targetOffset.x*P,y:this.targetOffset.y*P};var M={x:A.x-this.currentOffset.x,y:A.y-this.currentOffset.y};this.currentOffset.x+=M.x,this.currentOffset.y+=M.y,w.offsetBy(M),w.move(),this.onNextFrame((function(){return v.inertiaTick()}))}else w.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,i=this.interaction,o=i._now()-this.t0,a=Zt(i).smoothEndDuration;if(o<a){var d={x:ri(o,0,this.targetOffset.x,a),y:ri(o,0,this.targetOffset.y,a)},f={x:d.x-this.currentOffset.x,y:d.y-this.currentOffset.y};this.currentOffset.x+=f.x,this.currentOffset.y+=f.y,i.offsetBy(f),i.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else i.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var i=t.pointer,o=t.event,a=t.eventTarget,d=this.interaction;d.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),d.updatePointer(i,o,a,!0),d._doPhase({interaction:d,event:o,phase:"resume"}),xt(d.coords.prev,d.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,nt.cancel(this.timeout)}}]),n})();function Zt(n){var t=n.interactable,i=n.prepared;return t&&t.options&&i.name&&t.options[i.name].inertia}var Ur={id:"inertia",before:["modifiers","actions"],install:function(n){var t=n.defaults;n.usePlugin(ni),n.usePlugin(Jn),n.actions.phases.inertiastart=!0,n.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(n){var t=n.interaction;t.inertia=new Kr(t)},"interactions:before-action-end":function(n){var t=n.interaction,i=n.event;return(!t._interacting||t.simulation||!t.inertia.start(i))&&null},"interactions:down":function(n){var t=n.interaction,i=n.eventTarget,o=t.inertia;if(o.active)for(var a=i;S.element(a);){if(a===t.element){o.resume(n);break}a=je(a)}},"interactions:stop":function(n){var t=n.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(n){var t=n.interaction.modification;t.stop(n),t.start(n,n.interaction.coords.cur.page),t.applyToInteraction(n)},"interactions:before-action-inertiastart":function(n){return n.interaction.modification.setAndApply(n)},"interactions:action-resume":Rt,"interactions:action-inertiastart":Rt,"interactions:after-action-inertiastart":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-resume":function(n){return n.interaction.modification.restoreInteractionCoords(n)}}};function ii(n,t,i,o){var a=1-n;return a*a*t+2*a*n*i+n*n*o}function ri(n,t,i,o){return-i*(n/=o)*(n-2)+t}var Wr=Ur;function oi(n,t){for(var i=0;i<t.length;i++){var o=t[i];if(n.immediatePropagationStopped)break;o(n)}}var ai=(function(){function n(t){s(this,n),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=Y({},t||{})}return p(n,[{key:"fire",value:function(t){var i,o=this.global;(i=this.types[t.type])&&oi(t,i),!t.propagationStopped&&o&&(i=o[t.type])&&oi(t,i)}},{key:"on",value:function(t,i){var o=Ce(t,i);for(t in o)this.types[t]=pe(this.types[t]||[],o[t])}},{key:"off",value:function(t,i){var o=Ce(t,i);for(t in o){var a=this.types[t];if(a&&a.length)for(var d=0,f=o[t];d<f.length;d++){var g=f[d],v=a.indexOf(g);v!==-1&&a.splice(v,1)}}}},{key:"getRect",value:function(t){return null}}]),n})(),Xr=(function(){function n(t){s(this,n),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,Me(this,t)}return p(n,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),n})();function Bt(n){return S.object(n)?{capture:!!n.capture,passive:!!n.passive}:{capture:!!n,passive:!1}}function en(n,t){return n===t||(typeof n=="boolean"?!!t.capture===n&&!t.passive:!!n.capture==!!t.capture&&!!n.passive==!!t.passive)}var Vr={id:"events",install:function(n){var t,i=[],o={},a=[],d={add:f,remove:g,addDelegate:function(y,E,A,P,M){var F=Bt(M);if(!o[A]){o[A]=[];for(var j=0;j<a.length;j++){var N=a[j];f(N,A,v),f(N,A,w,!0)}}var H=o[A],J=he(H,(function(ne){return ne.selector===y&&ne.context===E}));J||(J={selector:y,context:E,listeners:[]},H.push(J)),J.listeners.push({func:P,options:F})},removeDelegate:function(y,E,A,P,M){var F,j=Bt(M),N=o[A],H=!1;if(N)for(F=N.length-1;F>=0;F--){var J=N[F];if(J.selector===y&&J.context===E){for(var ne=J.listeners,W=ne.length-1;W>=0;W--){var Z=ne[W];if(Z.func===P&&en(Z.options,j)){ne.splice(W,1),ne.length||(N.splice(F,1),g(E,A,v),g(E,A,w,!0)),H=!0;break}}if(H)break}}},delegateListener:v,delegateUseCapture:w,delegatedEvents:o,documents:a,targets:i,supportsOptions:!1,supportsPassive:!1};function f(y,E,A,P){if(y.addEventListener){var M=Bt(P),F=he(i,(function(j){return j.eventTarget===y}));F||(F={eventTarget:y,events:{}},i.push(F)),F.events[E]||(F.events[E]=[]),he(F.events[E],(function(j){return j.func===A&&en(j.options,M)}))||(y.addEventListener(E,A,d.supportsOptions?M:M.capture),F.events[E].push({func:A,options:M}))}}function g(y,E,A,P){if(y.addEventListener&&y.removeEventListener){var M=Ae(i,(function(Fe){return Fe.eventTarget===y})),F=i[M];if(F&&F.events)if(E!=="all"){var j=!1,N=F.events[E];if(N){if(A==="all"){for(var H=N.length-1;H>=0;H--){var J=N[H];g(y,E,J.func,J.options)}return}for(var ne=Bt(P),W=0;W<N.length;W++){var Z=N[W];if(Z.func===A&&en(Z.options,ne)){y.removeEventListener(E,A,d.supportsOptions?ne:ne.capture),N.splice(W,1),N.length===0&&(delete F.events[E],j=!0);break}}}j&&!Object.keys(F.events).length&&i.splice(M,1)}else for(E in F.events)F.events.hasOwnProperty(E)&&g(y,E,"all")}}function v(y,E){for(var A=Bt(E),P=new Xr(y),M=o[y.type],F=Se(y)[0],j=F;S.element(j);){for(var N=0;N<M.length;N++){var H=M[N],J=H.selector,ne=H.context;if($e(j,J)&&Ye(ne,F)&&Ye(ne,j)){var W=H.listeners;P.currentTarget=j;for(var Z=0;Z<W.length;Z++){var Fe=W[Z];en(Fe.options,A)&&Fe.func(P)}}}j=je(j)}}function w(y){return v(y,!0)}return(t=n.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return d.supportsOptions=!0},get passive(){return d.supportsPassive=!0}}),n.events=d,d}},bn={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(n){for(var t=0,i=bn.methodOrder;t<i.length;t++){var o=i[t],a=bn[o](n);if(a)return a}return null},simulationResume:function(n){var t=n.pointerType,i=n.eventType,o=n.eventTarget,a=n.scope;if(!/down|start/i.test(i))return null;for(var d=0,f=a.interactions.list;d<f.length;d++){var g=f[d],v=o;if(g.simulation&&g.simulation.allowResume&&g.pointerType===t)for(;v;){if(v===g.element)return g;v=je(v)}}return null},mouseOrPen:function(n){var t,i=n.pointerId,o=n.pointerType,a=n.eventType,d=n.scope;if(o!=="mouse"&&o!=="pen")return null;for(var f=0,g=d.interactions.list;f<g.length;f++){var v=g[f];if(v.pointerType===o){if(v.simulation&&!si(v,i))continue;if(v.interacting())return v;t||(t=v)}}if(t)return t;for(var w=0,y=d.interactions.list;w<y.length;w++){var E=y[w];if(!(E.pointerType!==o||/down/i.test(a)&&E.simulation))return E}return null},hasPointer:function(n){for(var t=n.pointerId,i=0,o=n.scope.interactions.list;i<o.length;i++){var a=o[i];if(si(a,t))return a}return null},idle:function(n){for(var t=n.pointerType,i=0,o=n.scope.interactions.list;i<o.length;i++){var a=o[i];if(a.pointers.length===1){var d=a.interactable;if(d&&(!d.options.gesture||!d.options.gesture.enabled))continue}else if(a.pointers.length>=2)continue;if(!a.interacting()&&t===a.pointerType)return a}return null}};function si(n,t){return n.pointers.some((function(i){return i.id===t}))}var Gr=bn,xn=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function li(n,t){return function(i){var o=t.interactions.list,a=me(i),d=Se(i),f=d[0],g=d[1],v=[];if(/^touch/.test(i.type)){t.prevTouchTime=t.now();for(var w=0,y=i.changedTouches;w<y.length;w++){var E=y[w],A={pointer:E,pointerId:Ve(E),pointerType:a,eventType:i.type,eventTarget:f,curEventTarget:g,scope:t},P=ci(A);v.push([A.pointer,A.eventTarget,A.curEventTarget,P])}}else{var M=!1;if(!we.supportsPointerEvent&&/mouse/.test(i.type)){for(var F=0;F<o.length&&!M;F++)M=o[F].pointerType!=="mouse"&&o[F].pointerIsDown;M=M||t.now()-t.prevTouchTime<500||i.timeStamp===0}if(!M){var j={pointer:i,pointerId:Ve(i),pointerType:a,eventType:i.type,curEventTarget:g,eventTarget:f,scope:t},N=ci(j);v.push([j.pointer,j.eventTarget,j.curEventTarget,N])}}for(var H=0;H<v.length;H++){var J=v[H],ne=J[0],W=J[1],Z=J[2];J[3][n](ne,i,W,Z)}}}function ci(n){var t=n.pointerType,i=n.scope,o={interaction:Gr.search(n),searchDetails:n};return i.fire("interactions:find",o),o.interaction||i.interactions.new({pointerType:t})}function _n(n,t){var i=n.doc,o=n.scope,a=n.options,d=o.interactions.docEvents,f=o.events,g=f[t];for(var v in o.browser.isIOS&&!a.events&&(a.events={passive:!1}),f.delegatedEvents)g(i,v,f.delegateListener),g(i,v,f.delegateUseCapture,!0);for(var w=a&&a.events,y=0;y<d.length;y++){var E=d[y];g(i,E.type,E.listener,w)}}var Jr={id:"core/interactions",install:function(n){for(var t={},i=0;i<xn.length;i++){var o=xn[i];t[o]=li(o,n)}var a,d=we.pEventTypes;function f(){for(var g=0,v=n.interactions.list;g<v.length;g++){var w=v[g];if(w.pointerIsDown&&w.pointerType==="touch"&&!w._interacting)for(var y=function(){var P=A[E];n.documents.some((function(M){return Ye(M.doc,P.downTarget)}))||w.removePointer(P.pointer,P.event)},E=0,A=w.pointers;E<A.length;E++)y()}}(a=ce.PointerEvent?[{type:d.down,listener:f},{type:d.down,listener:t.pointerDown},{type:d.move,listener:t.pointerMove},{type:d.up,listener:t.pointerUp},{type:d.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:f},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(g){for(var v=0,w=n.interactions.list;v<w.length;v++)w[v].documentBlur(g)}}),n.prevTouchTime=0,n.Interaction=(function(g){h(w,g);var v=_(w);function w(){return s(this,w),v.apply(this,arguments)}return p(w,[{key:"pointerMoveTolerance",get:function(){return n.interactions.pointerMoveTolerance},set:function(y){n.interactions.pointerMoveTolerance=y}},{key:"_now",value:function(){return n.now()}}]),w})(Hr),n.interactions={list:[],new:function(g){g.scopeFire=function(w,y){return n.fire(w,y)};var v=new n.Interaction(g);return n.interactions.list.push(v),v},listeners:t,docEvents:a,pointerMoveTolerance:1},n.usePlugin(Gn)},listeners:{"scope:add-document":function(n){return _n(n,"add")},"scope:remove-document":function(n){return _n(n,"remove")},"interactable:unset":function(n,t){for(var i=n.interactable,o=t.interactions.list.length-1;o>=0;o--){var a=t.interactions.list[o];a.interactable===i&&(a.stop(),t.fire("interactions:destroy",{interaction:a}),a.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(o,1))}}},onDocSignal:_n,doOnInteractions:li,methodNames:xn},Qr=Jr,rt=(function(n){return n[n.On=0]="On",n[n.Off=1]="Off",n})(rt||{}),Zr=(function(){function n(t,i,o,a){s(this,n),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new ai,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=i.actions,this.target=t,this._context=i.context||o,this._win=O(Ue(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=a,this.set(i)}return p(n,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,i){return S.func(i.onstart)&&this.on("".concat(t,"start"),i.onstart),S.func(i.onmove)&&this.on("".concat(t,"move"),i.onmove),S.func(i.onend)&&this.on("".concat(t,"end"),i.onend),S.func(i.oninertiastart)&&this.on("".concat(t,"inertiastart"),i.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,i,o){var a,d=this,f=(a=this._actions.map[t])==null?void 0:a.filterEventType,g=function(v){return(f==null||f(v))&&Jt(v,d._actions)};(S.array(i)||S.object(i))&&this._onOff(rt.Off,t,i,void 0,g),(S.array(o)||S.object(o))&&this._onOff(rt.On,t,o,void 0,g)}},{key:"setPerAction",value:function(t,i){var o=this._defaults;for(var a in i){var d=a,f=this.options[t],g=i[d];d==="listeners"&&this.updatePerActionListeners(t,f.listeners,g),S.array(g)?f[d]=_e(g):S.plainObject(g)?(f[d]=Y(f[d]||{},At(g)),S.object(o.perAction[d])&&"enabled"in o.perAction[d]&&(f[d].enabled=g.enabled!==!1)):S.bool(g)&&S.object(o.perAction[d])?f[d].enabled=g:f[d]=g}}},{key:"getRect",value:function(t){return t=t||(S.element(this.target)?this.target:null),S.string(this.target)&&(t=t||this._context.querySelector(this.target)),vt(t)}},{key:"rectChecker",value:function(t){var i=this;return S.func(t)?(this.getRect=function(o){var a=Y({},t.apply(i,o));return"width"in a||(a.width=a.right-a.left,a.height=a.bottom-a.top),a},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,i){if(Ue(i)||S.object(i)){for(var o in this.options[t]=i,this._actions.map)this.options[o][t]=i;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return S.string(t)?Array.from(this._context.querySelectorAll(t)):S.func(t)&&t.getAllElements?t.getAllElements():S.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||Ye(this._context,t)}},{key:"testIgnoreAllow",value:function(t,i,o){return!this.testIgnore(t.ignoreFrom,i,o)&&this.testAllow(t.allowFrom,i,o)}},{key:"testAllow",value:function(t,i,o){return!t||!!S.element(o)&&(S.string(t)?qe(o,t,i):!!S.element(t)&&Ye(t,o))}},{key:"testIgnore",value:function(t,i,o){return!(!t||!S.element(o))&&(S.string(t)?qe(o,t,i):!!S.element(t)&&Ye(t,o))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,i,o,a,d){S.object(i)&&!S.array(i)&&(a=o,o=null);var f=Ce(i,o,d);for(var g in f){g==="wheel"&&(g=we.wheelEvent);for(var v=0,w=f[g];v<w.length;v++){var y=w[v];Jt(g,this._actions)?this.events[t===rt.On?"on":"off"](g,y):S.string(this.target)?this._scopeEvents[t===rt.On?"addDelegate":"removeDelegate"](this.target,this._context,g,y,a):this._scopeEvents[t===rt.On?"add":"remove"](this.target,g,y,a)}}return this}},{key:"on",value:function(t,i,o){return this._onOff(rt.On,t,i,o)}},{key:"off",value:function(t,i,o){return this._onOff(rt.Off,t,i,o)}},{key:"set",value:function(t){var i=this._defaults;for(var o in S.object(t)||(t={}),this.options=At(i.base),this._actions.methodDict){var a=o,d=this._actions.methodDict[a];this.options[a]={},this.setPerAction(a,Y(Y({},i.perAction),i.actions[a])),this[d](t[a])}for(var f in t)f!=="getRect"?S.func(this[f])&&this[f](t[f]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(S.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var i=this._scopeEvents.delegatedEvents[t],o=i.length-1;o>=0;o--){var a=i[o],d=a.selector,f=a.context,g=a.listeners;d===this.target&&f===this._context&&i.splice(o,1);for(var v=g.length-1;v>=0;v--)this._scopeEvents.removeDelegate(this.target,this._context,t,g[v][0],g[v][1])}else this._scopeEvents.remove(this.target,"all")}}]),n})(),eo=(function(){function n(t){var i=this;s(this,n),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(o){var a=o.interactable,d=a.target,f=S.string(d)?i.selectorMap[d]:d[i.scope.id],g=Ae(f,(function(v){return v===a}));f.splice(g,1)}})}return p(n,[{key:"new",value:function(t,i){i=Y(i||{},{actions:this.scope.actions});var o=new this.scope.Interactable(t,i,this.scope.document,this.scope.events);return this.scope.addDocument(o._doc),this.list.push(o),S.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(o)):(o.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(o)),this.scope.fire("interactable:new",{target:t,options:i,interactable:o,win:this.scope._win}),o}},{key:"getExisting",value:function(t,i){var o=i&&i.context||this.scope.document,a=S.string(t),d=a?this.selectorMap[t]:t[this.scope.id];if(d)return he(d,(function(f){return f._context===o&&(a||f.inContext(t))}))}},{key:"forEachMatch",value:function(t,i){for(var o=0,a=this.list;o<a.length;o++){var d=a[o],f=void 0;if((S.string(d.target)?S.element(t)&&$e(t,d.target):t===d.target)&&d.inContext(t)&&(f=i(d)),f!==void 0)return f}}}]),n})(),to=(function(){function n(){var t=this;s(this,n),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=we,this.defaults=At(Qn),this.Eventable=ai,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(o){var a=function d(f,g){var v=o.interactables.getExisting(f,g);return v||((v=o.interactables.new(f,g)).events.global=d.globalEvents),v};return a.getPointerAverage=R,a.getTouchBBox=ie,a.getTouchDistance=ae,a.getTouchAngle=le,a.getElementRect=vt,a.getElementClientRect=mt,a.matchesSelector=$e,a.closest=It,a.globalEvents={},a.version="1.10.27",a.scope=o,a.use=function(d,f){return this.scope.usePlugin(d,f),this},a.isSet=function(d,f){return!!this.scope.interactables.get(d,f&&f.context)},a.on=Dt((function(d,f,g){if(S.string(d)&&d.search(" ")!==-1&&(d=d.trim().split(/ +/)),S.array(d)){for(var v=0,w=d;v<w.length;v++){var y=w[v];this.on(y,f,g)}return this}if(S.object(d)){for(var E in d)this.on(E,d[E],f);return this}return Jt(d,this.scope.actions)?this.globalEvents[d]?this.globalEvents[d].push(f):this.globalEvents[d]=[f]:this.scope.events.add(this.scope.document,d,f,{options:g}),this}),"The interact.on() method is being deprecated"),a.off=Dt((function(d,f,g){if(S.string(d)&&d.search(" ")!==-1&&(d=d.trim().split(/ +/)),S.array(d)){for(var v=0,w=d;v<w.length;v++){var y=w[v];this.off(y,f,g)}return this}if(S.object(d)){for(var E in d)this.off(E,d[E],f);return this}var A;return Jt(d,this.scope.actions)?d in this.globalEvents&&(A=this.globalEvents[d].indexOf(f))!==-1&&this.globalEvents[d].splice(A,1):this.scope.events.remove(this.scope.document,d,f,g),this}),"The interact.off() method is being deprecated"),a.debug=function(){return this.scope},a.supportsTouch=function(){return we.supportsTouch},a.supportsPointerEvent=function(){return we.supportsPointerEvent},a.stop=function(){for(var d=0,f=this.scope.interactions.list;d<f.length;d++)f[d].stop();return this},a.pointerMoveTolerance=function(d){return S.number(d)?(this.scope.interactions.pointerMoveTolerance=d,this):this.scope.interactions.pointerMoveTolerance},a.addDocument=function(d,f){this.scope.addDocument(d,f)},a.removeDocument=function(d){this.scope.removeDocument(d)},a})(this),this.InteractEvent=vn,this.Interactable=void 0,this.interactables=new eo(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(o){return t.removeDocument(o.target)};var i=this;this.Interactable=(function(o){h(d,o);var a=_(d);function d(){return s(this,d),a.apply(this,arguments)}return p(d,[{key:"_defaults",get:function(){return i.defaults}},{key:"set",value:function(f){return k(m(d.prototype),"set",this).call(this,f),i.fire("interactable:set",{options:f,interactable:this}),this}},{key:"unset",value:function(){k(m(d.prototype),"unset",this).call(this);var f=i.interactables.list.indexOf(this);f<0||(i.interactables.list.splice(f,1),i.fire("interactable:unset",{interactable:this}))}}]),d})(Zr)}return p(n,[{key:"addListeners",value:function(t,i){this.listenerMaps.push({id:i,map:t})}},{key:"fire",value:function(t,i){for(var o=0,a=this.listenerMaps;o<a.length;o++){var d=a[o].map[t];if(d&&d(i,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(i,o){return i.isInitialized=!0,S.window(o)&&I(o),ce.init(o),we.init(o),nt.init(o),i.window=o,i.document=o.document,i.usePlugin(Qr),i.usePlugin(Vr),i})(this,t)}},{key:"pluginIsInstalled",value:function(t){var i=t.id;return i?!!this._plugins.map[i]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,i){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,i),t.listeners&&t.before){for(var o=0,a=this.listenerMaps.length,d=t.before.reduce((function(g,v){return g[v]=!0,g[di(v)]=!0,g}),{});o<a;o++){var f=this.listenerMaps[o].id;if(f&&(d[f]||d[di(f)]))break}this.listenerMaps.splice(o,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,i){if(this.getDocIndex(t)!==-1)return!1;var o=O(t);i=i?Y({},i):{},this.documents.push({doc:t,options:i}),this.events.documents.push(t),t!==this.document&&this.events.add(o,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:o,scope:this,options:i})}},{key:"removeDocument",value:function(t){var i=this.getDocIndex(t),o=O(t),a=this.documents[i].options;this.events.remove(o,"unload",this.onWindowUnload),this.documents.splice(i,1),this.events.documents.splice(i,1),this.fire("scope:remove-document",{doc:t,window:o,scope:this,options:a})}},{key:"getDocIndex",value:function(t){for(var i=0;i<this.documents.length;i++)if(this.documents[i].doc===t)return i;return-1}},{key:"getDocOptions",value:function(t){var i=this.getDocIndex(t);return i===-1?null:this.documents[i].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),n})();function di(n){return n&&n.replace(/\/.*$/,"")}var ui=new to,Ie=ui.interactStatic,no=typeof globalThis!="undefined"?globalThis:window;ui.init(no);var io=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(n){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(o){var a=o[0],d=o[1];return a in n||d in n})),i=function(o,a){for(var d=n.range,f=n.limits,g=f===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:f,v=n.offset,w=v===void 0?{x:0,y:0}:v,y={range:d,grid:n,x:null,y:null},E=0;E<t.length;E++){var A=t[E],P=A[0],M=A[1],F=Math.round((o-w.x)/n[P]),j=Math.round((a-w.y)/n[M]);y[P]=Math.max(g.left,Math.min(g.right,F*n[P]+w.x)),y[M]=Math.max(g.top,Math.min(g.bottom,j*n[M]+w.y))}return y};return i.grid=n,i.coordFields=t,i}}),ro={id:"snappers",install:function(n){var t=n.interactStatic;t.snappers=Y(t.snappers||{},io),t.createSnapGrid=t.snappers.grid}},oo=ro,ao={start:function(n){var t=n.state,i=n.rect,o=n.edges,a=n.pageCoords,d=t.options,f=d.ratio,g=d.enabled,v=t.options,w=v.equalDelta,y=v.modifiers;f==="preserve"&&(f=i.width/i.height),t.startCoords=Y({},a),t.startRect=Y({},i),t.ratio=f,t.equalDelta=w;var E=t.linkedEdges={top:o.top||o.left&&!o.bottom,left:o.left||o.top&&!o.right,bottom:o.bottom||o.right&&!o.top,right:o.right||o.bottom&&!o.left};if(t.xIsPrimaryAxis=!(!o.left&&!o.right),t.equalDelta){var A=(E.left?1:-1)*(E.top?1:-1);t.edgeSign={x:A,y:A}}else t.edgeSign={x:E.left?-1:1,y:E.top?-1:1};if(g!==!1&&Y(o,E),y!=null&&y.length){var P=new mn(n.interaction);P.copyFrom(n.interaction.modification),P.prepareStates(y),t.subModification=P,P.startAll(u({},n))}},set:function(n){var t=n.state,i=n.rect,o=n.coords,a=t.linkedEdges,d=Y({},o),f=t.equalDelta?so:lo;if(Y(n.edges,a),f(t,t.xIsPrimaryAxis,o,i),!t.subModification)return null;var g=Y({},i);se(a,g,{x:o.x-d.x,y:o.y-d.y});var v=t.subModification.setAll(u(u({},n),{},{rect:g,edges:a,pageCoords:o,prevCoords:o,prevRect:g})),w=v.delta;return v.changed&&(f(t,Math.abs(w.x)>Math.abs(w.y),v.coords,v.rect),Y(o,v.coords)),v.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function so(n,t,i){var o=n.startCoords,a=n.edgeSign;t?i.y=o.y+(i.x-o.x)*a.y:i.x=o.x+(i.y-o.y)*a.x}function lo(n,t,i,o){var a=n.startRect,d=n.startCoords,f=n.ratio,g=n.edgeSign;if(t){var v=o.width/f;i.y=d.y+(v-a.height)*g.y}else{var w=o.height*f;i.x=d.x+(w-a.width)*g.x}}var co=it(ao,"aspectRatio"),pi=function(){};pi._defaults={};var tn=pi;function ut(n,t,i){return S.func(n)?ct(n,t.interactable,t.element,[i.x,i.y,t]):ct(n,t.interactable,t.element)}var nn={start:function(n){var t=n.rect,i=n.startOffset,o=n.state,a=n.interaction,d=n.pageCoords,f=o.options,g=f.elementRect,v=Y({left:0,top:0,right:0,bottom:0},f.offset||{});if(t&&g){var w=ut(f.restriction,a,d);if(w){var y=w.right-w.left-t.width,E=w.bottom-w.top-t.height;y<0&&(v.left+=y,v.right+=y),E<0&&(v.top+=E,v.bottom+=E)}v.left+=i.left-t.width*g.left,v.top+=i.top-t.height*g.top,v.right+=i.right-t.width*(1-g.right),v.bottom+=i.bottom-t.height*(1-g.bottom)}o.offset=v},set:function(n){var t=n.coords,i=n.interaction,o=n.state,a=o.options,d=o.offset,f=ut(a.restriction,i,t);if(f){var g=(function(v){return!v||"left"in v&&"top"in v||((v=Y({},v)).left=v.x||0,v.top=v.y||0,v.right=v.right||v.left+v.width,v.bottom=v.bottom||v.top+v.height),v})(f);t.x=Math.max(Math.min(g.right-d.right,t.x),g.left+d.left),t.y=Math.max(Math.min(g.bottom-d.bottom,t.y),g.top+d.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},uo=it(nn,"restrict"),hi={top:1/0,left:1/0,bottom:-1/0,right:-1/0},fi={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function gi(n,t){for(var i=0,o=["top","left","bottom","right"];i<o.length;i++){var a=o[i];a in n||(n[a]=t[a])}return n}var Nt={noInner:hi,noOuter:fi,start:function(n){var t,i=n.interaction,o=n.startOffset,a=n.state,d=a.options;d&&(t=U(ut(d.offset,i,i.coords.start.page))),t=t||{x:0,y:0},a.offset={top:t.y+o.top,left:t.x+o.left,bottom:t.y-o.bottom,right:t.x-o.right}},set:function(n){var t=n.coords,i=n.edges,o=n.interaction,a=n.state,d=a.offset,f=a.options;if(i){var g=Y({},t),v=ut(f.inner,o,g)||{},w=ut(f.outer,o,g)||{};gi(v,hi),gi(w,fi),i.top?t.y=Math.min(Math.max(w.top+d.top,g.y),v.top+d.top):i.bottom&&(t.y=Math.max(Math.min(w.bottom+d.bottom,g.y),v.bottom+d.bottom)),i.left?t.x=Math.min(Math.max(w.left+d.left,g.x),v.left+d.left):i.right&&(t.x=Math.max(Math.min(w.right+d.right,g.x),v.right+d.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},po=it(Nt,"restrictEdges"),ho=Y({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(n){}},nn.defaults),fo=it({start:nn.start,set:nn.set,defaults:ho},"restrictRect"),go={width:-1/0,height:-1/0},mo={width:1/0,height:1/0},vo=it({start:function(n){return Nt.start(n)},set:function(n){var t=n.interaction,i=n.state,o=n.rect,a=n.edges,d=i.options;if(a){var f=ve(ut(d.min,t,n.coords))||go,g=ve(ut(d.max,t,n.coords))||mo;i.options={endOnly:d.endOnly,inner:Y({},Nt.noInner),outer:Y({},Nt.noOuter)},a.top?(i.options.inner.top=o.bottom-f.height,i.options.outer.top=o.bottom-g.height):a.bottom&&(i.options.inner.bottom=o.top+f.height,i.options.outer.bottom=o.top+g.height),a.left?(i.options.inner.left=o.right-f.width,i.options.outer.left=o.right-g.width):a.right&&(i.options.inner.right=o.left+f.width,i.options.outer.right=o.left+g.width),Nt.set(n),i.options=d}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),wn={start:function(n){var t,i=n.interaction,o=n.interactable,a=n.element,d=n.rect,f=n.state,g=n.startOffset,v=f.options,w=v.offsetWithOrigin?(function(A){var P=A.interaction.element,M=U(ct(A.state.options.origin,null,null,[P])),F=M||de(A.interactable,P,A.interaction.prepared.name);return F})(n):{x:0,y:0};if(v.offset==="startCoords")t={x:i.coords.start.page.x,y:i.coords.start.page.y};else{var y=ct(v.offset,o,a,[i]);(t=U(y)||{x:0,y:0}).x+=w.x,t.y+=w.y}var E=v.relativePoints;f.offsets=d&&E&&E.length?E.map((function(A,P){return{index:P,relativePoint:A,x:g.left-d.width*A.x+t.x,y:g.top-d.height*A.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(n){var t=n.interaction,i=n.coords,o=n.state,a=o.options,d=o.offsets,f=de(t.interactable,t.element,t.prepared.name),g=Y({},i),v=[];a.offsetWithOrigin||(g.x-=f.x,g.y-=f.y);for(var w=0,y=d;w<y.length;w++)for(var E=y[w],A=g.x-E.x,P=g.y-E.y,M=0,F=a.targets.length;M<F;M++){var j=a.targets[M],N=void 0;(N=S.func(j)?j(A,P,t._proxy,E,M):j)&&v.push({x:(S.number(N.x)?N.x:A)+E.x,y:(S.number(N.y)?N.y:P)+E.y,range:S.number(N.range)?N.range:a.range,source:j,index:M,offset:E})}for(var H={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},J=0;J<v.length;J++){var ne=v[J],W=ne.range,Z=ne.x-g.x,Fe=ne.y-g.y,ge=et(Z,Fe),Ne=ge<=W;W===1/0&&H.inRange&&H.range!==1/0&&(Ne=!1),H.target&&!(Ne?H.inRange&&W!==1/0?ge/W<H.distance/H.range:W===1/0&&H.range!==1/0||ge<H.distance:!H.inRange&&ge<H.distance)||(H.target=ne,H.distance=ge,H.range=W,H.inRange=Ne,H.delta.x=Z,H.delta.y=Fe)}return H.inRange&&(i.x=H.target.x,i.y=H.target.y),o.closest=H,H},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},yo=it(wn,"snap"),rn={start:function(n){var t=n.state,i=n.edges,o=t.options;if(!i)return null;n.state={options:{targets:null,relativePoints:[{x:i.left?0:1,y:i.top?0:1}],offset:o.offset||"self",origin:{x:0,y:0},range:o.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],wn.start(n),t.offsets=n.state.offsets,n.state=t},set:function(n){var t=n.interaction,i=n.state,o=n.coords,a=i.options,d=i.offsets,f={x:o.x-d[0].x,y:o.y-d[0].y};i.options=Y({},a),i.options.targets=[];for(var g=0,v=a.targets||[];g<v.length;g++){var w=v[g],y=void 0;if(y=S.func(w)?w(f.x,f.y,t):w){for(var E=0,A=i.targetFields;E<A.length;E++){var P=A[E],M=P[0],F=P[1];if(M in y||F in y){y.x=y[M],y.y=y[F];break}}i.options.targets.push(y)}}var j=wn.set(n);return i.options=a,j},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},bo=it(rn,"snapSize"),Sn={aspectRatio:co,restrictEdges:po,restrict:uo,restrictRect:fo,restrictSize:vo,snapEdges:it({start:function(n){var t=n.edges;return t?(n.state.targetFields=n.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],rn.start(n)):null},set:rn.set,defaults:Y(At(rn.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:yo,snapSize:bo,spring:tn,avoid:tn,transform:tn,rubberband:tn},xo={id:"modifiers",install:function(n){var t=n.interactStatic;for(var i in n.usePlugin(Jn),n.usePlugin(oo),t.modifiers=Sn,Sn){var o=Sn[i],a=o._defaults,d=o._methods;a._methods=d,n.defaults.perAction[i]=a}}},_o=xo,mi=(function(n){h(i,n);var t=_(i);function i(o,a,d,f,g,v){var w;if(s(this,i),Me(b(w=t.call(this,g)),d),d!==a&&Me(b(w),a),w.timeStamp=v,w.originalEvent=d,w.type=o,w.pointerId=Ve(a),w.pointerType=me(a),w.target=f,w.currentTarget=null,o==="tap"){var y=g.getPointerIndex(a);w.dt=w.timeStamp-g.pointers[y].downTime;var E=w.timeStamp-g.tapTime;w.double=!!g.prevTap&&g.prevTap.type!=="doubletap"&&g.prevTap.target===w.target&&E<500}else o==="doubletap"&&(w.dt=a.timeStamp-g.tapTime,w.double=!0);return w}return p(i,[{key:"_subtractOrigin",value:function(o){var a=o.x,d=o.y;return this.pageX-=a,this.pageY-=d,this.clientX-=a,this.clientY-=d,this}},{key:"_addOrigin",value:function(o){var a=o.x,d=o.y;return this.pageX+=a,this.pageY+=d,this.clientX+=a,this.clientY+=d,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),i})(q),jt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(n){n.pointerEvents=jt,n.defaults.actions.pointerEvents=jt.defaults,Y(n.actions.phaselessTypes,jt.types)},listeners:{"interactions:new":function(n){var t=n.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(n){var t=n.down,i=n.pointerInfo;!t&&i.hold||(i.hold={duration:1/0,timeout:null})},"interactions:move":function(n,t){var i=n.interaction,o=n.pointer,a=n.event,d=n.eventTarget;n.duplicate||i.pointerIsDown&&!i.pointerWasMoved||(i.pointerIsDown&&kn(n),ot({interaction:i,pointer:o,event:a,eventTarget:d,type:"move"},t))},"interactions:down":function(n,t){(function(i,o){for(var a=i.interaction,d=i.pointer,f=i.event,g=i.eventTarget,v=i.pointerIndex,w=a.pointers[v].hold,y=lt(g),E={interaction:a,pointer:d,event:f,eventTarget:g,type:"hold",targets:[],path:y,node:null},A=0;A<y.length;A++){var P=y[A];E.node=P,o.fire("pointerEvents:collect-targets",E)}if(E.targets.length){for(var M=1/0,F=0,j=E.targets;F<j.length;F++){var N=j[F].eventable.options.holdDuration;N<M&&(M=N)}w.duration=M,w.timeout=setTimeout((function(){ot({interaction:a,eventTarget:g,pointer:d,event:f,type:"hold"},o)}),M)}})(n,t),ot(n,t)},"interactions:up":function(n,t){kn(n),ot(n,t),(function(i,o){var a=i.interaction,d=i.pointer,f=i.event,g=i.eventTarget;a.pointerWasMoved||ot({interaction:a,eventTarget:g,pointer:d,event:f,type:"tap"},o)})(n,t)},"interactions:cancel":function(n,t){kn(n),ot(n,t)}},PointerEvent:mi,fire:ot,collectEventTargets:vi,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function ot(n,t){var i=n.interaction,o=n.pointer,a=n.event,d=n.eventTarget,f=n.type,g=n.targets,v=g===void 0?vi(n,t):g,w=new mi(f,o,a,d,i,t.now());t.fire("pointerEvents:new",{pointerEvent:w});for(var y={interaction:i,pointer:o,event:a,eventTarget:d,targets:v,type:f,pointerEvent:w},E=0;E<v.length;E++){var A=v[E];for(var P in A.props||{})w[P]=A.props[P];var M=de(A.eventable,A.node);if(w._subtractOrigin(M),w.eventable=A.eventable,w.currentTarget=A.node,A.eventable.fire(w),w._addOrigin(M),w.immediatePropagationStopped||w.propagationStopped&&E+1<v.length&&v[E+1].node!==w.currentTarget)break}if(t.fire("pointerEvents:fired",y),f==="tap"){var F=w.double?ot({interaction:i,pointer:o,event:a,eventTarget:d,type:"doubletap"},t):w;i.prevTap=F,i.tapTime=F.timeStamp}return w}function vi(n,t){var i=n.interaction,o=n.pointer,a=n.event,d=n.eventTarget,f=n.type,g=i.getPointerIndex(o),v=i.pointers[g];if(f==="tap"&&(i.pointerWasMoved||!v||v.downTarget!==d))return[];for(var w=lt(d),y={interaction:i,pointer:o,event:a,eventTarget:d,type:f,path:w,targets:[],node:null},E=0;E<w.length;E++){var A=w[E];y.node=A,t.fire("pointerEvents:collect-targets",y)}return f==="hold"&&(y.targets=y.targets.filter((function(P){var M,F;return P.eventable.options.holdDuration===((M=i.pointers[g])==null||(F=M.hold)==null?void 0:F.duration)}))),y.targets}function kn(n){var t=n.interaction,i=n.pointerIndex,o=t.pointers[i].hold;o&&o.timeout&&(clearTimeout(o.timeout),o.timeout=null)}var wo=Object.freeze({__proto__:null,default:jt});function So(n){var t=n.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var ko={id:"pointer-events/holdRepeat",install:function(n){n.usePlugin(jt);var t=n.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=n.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(n,t){return n["pointerEvents:".concat(t)]=So,n}),{"pointerEvents:new":function(n){var t=n.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(n,t){var i=n.interaction,o=n.pointerEvent,a=n.eventTarget,d=n.targets;if(o.type==="hold"&&d.length){var f=d[0].eventable.options.holdRepeatInterval;f<=0||(i.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:i,eventTarget:a,type:"hold",pointer:o,event:o},t)}),f))}}})},Eo=ko,Co={id:"pointer-events/interactableTargets",install:function(n){var t=n.Interactable;t.prototype.pointerEvents=function(o){return Y(this.events.options,o),this};var i=t.prototype._backCompatOption;t.prototype._backCompatOption=function(o,a){var d=i.call(this,o,a);return d===this&&(this.events.options[o]=a),d}},listeners:{"pointerEvents:collect-targets":function(n,t){var i=n.targets,o=n.node,a=n.type,d=n.eventTarget;t.interactables.forEachMatch(o,(function(f){var g=f.events,v=g.options;g.types[a]&&g.types[a].length&&f.testIgnoreAllow(v,o,d)&&i.push({node:o,eventable:g,props:{interactable:f}})}))},"interactable:new":function(n){var t=n.interactable;t.events.getRect=function(i){return t.getRect(i)}},"interactable:set":function(n,t){var i=n.interactable,o=n.options;Y(i.events.options,t.pointerEvents.defaults),Y(i.events.options,o.pointerEvents||{})}}},Ao=Co,Oo={id:"pointer-events",install:function(n){n.usePlugin(wo),n.usePlugin(Eo),n.usePlugin(Ao)}},To=Oo,Mo={id:"reflow",install:function(n){var t=n.Interactable;n.actions.phases.reflow=!0,t.prototype.reflow=function(i){return(function(o,a,d){for(var f=o.getAllElements(),g=d.window.Promise,v=g?[]:null,w=function(){var E=f[y],A=o.getRect(E);if(!A)return 1;var P,M=he(d.interactions.list,(function(N){return N.interacting()&&N.interactable===o&&N.element===E&&N.prepared.name===a.name}));if(M)M.move(),v&&(P=M._reflowPromise||new g((function(N){M._reflowResolve=N})));else{var F=ve(A),j=(function(N){return{coords:N,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:F.x,y:F.y},client:{x:F.x,y:F.y},timeStamp:d.now()});P=(function(N,H,J,ne,W){var Z=N.interactions.new({pointerType:"reflow"}),Fe={interaction:Z,event:W,pointer:W,eventTarget:J,phase:"reflow"};Z.interactable=H,Z.element=J,Z.prevEvent=W,Z.updatePointer(W,W,J,!0),Wt(Z.coords.delta),pn(Z.prepared,ne),Z._doPhase(Fe);var ge=N.window,Ne=ge.Promise,Ke=Ne?new Ne((function(Qe){Z._reflowResolve=Qe})):void 0;return Z._reflowPromise=Ke,Z.start(ne,H,J),Z._interacting?(Z.move(Fe),Z.end(W)):(Z.stop(),Z._reflowResolve()),Z.removePointer(W,W),Ke})(d,o,E,a,j)}v&&v.push(P)},y=0;y<f.length&&!w();y++);return v&&g.all(v).then((function(){return o}))})(this,i,n)}},listeners:{"interactions:stop":function(n,t){var i=n.interaction;i.pointerType==="reflow"&&(i._reflowResolve&&i._reflowResolve(),(function(o,a){o.splice(o.indexOf(a),1)})(t.interactions.list,i))}}},Po=Mo;if(Ie.use(Gn),Ie.use(ni),Ie.use(To),Ie.use(Wr),Ie.use(_o),Ie.use(zr),Ie.use(Vt),Ie.use(Cr),Ie.use(Po),Ie.default=Ie,(typeof pt=="undefined"?"undefined":r(pt))==="object"&&pt)try{pt.exports=Ie}catch{}return Ie.default=Ie,Ie}))});var kr=jo(bi(),1);function zi(e){return typeof e=="undefined"||e===null}function qo(e){return typeof e=="object"&&e!==null}function Ho(e){return Array.isArray(e)?e:zi(e)?[]:[e]}function Yo(e,u){var r,s,l,p;if(u)for(p=Object.keys(u),r=0,s=p.length;r<s;r+=1)l=p[r],e[l]=u[l];return e}function $o(e,u){var r="",s;for(s=0;s<u;s+=1)r+=e;return r}function Ko(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Uo=zi,Wo=qo,Xo=Ho,Vo=$o,Go=Ko,Jo=Yo,xe={isNothing:Uo,isObject:Wo,toArray:Xo,repeat:Vo,isNegativeZero:Go,extend:Jo};function Di(e,u){var r="",s=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!u&&e.mark.snippet&&(r+=`

`+e.mark.snippet),s+" "+r):s}function Yt(e,u){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=u,this.message=Di(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Yt.prototype=Object.create(Error.prototype);Yt.prototype.constructor=Yt;Yt.prototype.toString=function(u){return this.name+": "+Di(this,u)};var Le=Yt;function An(e,u,r,s,l){var p="",c="",h=Math.floor(l/2)-1;return s-u>h&&(p=" ... ",u=s-h+p.length),r-s>h&&(c=" ...",r=s+h-c.length),{str:p+e.slice(u,r).replace(/\t/g,"\u2192")+c,pos:s-u+p.length}}function On(e,u){return xe.repeat(" ",u-e.length)+e}function Qo(e,u){if(u=Object.create(u||null),!e.buffer)return null;u.maxLength||(u.maxLength=79),typeof u.indent!="number"&&(u.indent=1),typeof u.linesBefore!="number"&&(u.linesBefore=3),typeof u.linesAfter!="number"&&(u.linesAfter=2);for(var r=/\r?\n|\r|\0/g,s=[0],l=[],p,c=-1;p=r.exec(e.buffer);)l.push(p.index),s.push(p.index+p[0].length),e.position<=p.index&&c<0&&(c=s.length-2);c<0&&(c=s.length-1);var h="",m,x,b=Math.min(e.line+u.linesAfter,l.length).toString().length,_=u.maxLength-(u.indent+b+3);for(m=1;m<=u.linesBefore&&!(c-m<0);m++)x=An(e.buffer,s[c-m],l[c-m],e.position-(s[c]-s[c-m]),_),h=xe.repeat(" ",u.indent)+On((e.line-m+1).toString(),b)+" | "+x.str+`
`+h;for(x=An(e.buffer,s[c],l[c],e.position,_),h+=xe.repeat(" ",u.indent)+On((e.line+1).toString(),b)+" | "+x.str+`
`,h+=xe.repeat("-",u.indent+b+3+x.pos)+`^
`,m=1;m<=u.linesAfter&&!(c+m>=l.length);m++)x=An(e.buffer,s[c+m],l[c+m],e.position-(s[c]-s[c+m]),_),h+=xe.repeat(" ",u.indent)+On((e.line+m+1).toString(),b)+" | "+x.str+`
`;return h.replace(/\n$/,"")}var Zo=Qo,ea=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],ta=["scalar","sequence","mapping"];function na(e){var u={};return e!==null&&Object.keys(e).forEach(function(r){e[r].forEach(function(s){u[String(s)]=r})}),u}function ia(e,u){if(u=u||{},Object.keys(u).forEach(function(r){if(ea.indexOf(r)===-1)throw new Le('Unknown option "'+r+'" is met in definition of "'+e+'" YAML type.')}),this.options=u,this.tag=e,this.kind=u.kind||null,this.resolve=u.resolve||function(){return!0},this.construct=u.construct||function(r){return r},this.instanceOf=u.instanceOf||null,this.predicate=u.predicate||null,this.represent=u.represent||null,this.representName=u.representName||null,this.defaultStyle=u.defaultStyle||null,this.multi=u.multi||!1,this.styleAliases=na(u.styleAliases||null),ta.indexOf(this.kind)===-1)throw new Le('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var Ee=ia;function xi(e,u){var r=[];return e[u].forEach(function(s){var l=r.length;r.forEach(function(p,c){p.tag===s.tag&&p.kind===s.kind&&p.multi===s.multi&&(l=c)}),r[l]=s}),r}function ra(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},u,r;function s(l){l.multi?(e.multi[l.kind].push(l),e.multi.fallback.push(l)):e[l.kind][l.tag]=e.fallback[l.tag]=l}for(u=0,r=arguments.length;u<r;u+=1)arguments[u].forEach(s);return e}function Mn(e){return this.extend(e)}Mn.prototype.extend=function(u){var r=[],s=[];if(u instanceof Ee)s.push(u);else if(Array.isArray(u))s=s.concat(u);else if(u&&(Array.isArray(u.implicit)||Array.isArray(u.explicit)))u.implicit&&(r=r.concat(u.implicit)),u.explicit&&(s=s.concat(u.explicit));else throw new Le("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(p){if(!(p instanceof Ee))throw new Le("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(p.loadKind&&p.loadKind!=="scalar")throw new Le("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(p.multi)throw new Le("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),s.forEach(function(p){if(!(p instanceof Ee))throw new Le("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var l=Object.create(Mn.prototype);return l.implicit=(this.implicit||[]).concat(r),l.explicit=(this.explicit||[]).concat(s),l.compiledImplicit=xi(l,"implicit"),l.compiledExplicit=xi(l,"explicit"),l.compiledTypeMap=ra(l.compiledImplicit,l.compiledExplicit),l};var Ri=Mn,Bi=new Ee("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Ni=new Ee("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),ji=new Ee("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),qi=new Ri({explicit:[Bi,Ni,ji]});function oa(e){if(e===null)return!0;var u=e.length;return u===1&&e==="~"||u===4&&(e==="null"||e==="Null"||e==="NULL")}function aa(){return null}function sa(e){return e===null}var Hi=new Ee("tag:yaml.org,2002:null",{kind:"scalar",resolve:oa,construct:aa,predicate:sa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function la(e){if(e===null)return!1;var u=e.length;return u===4&&(e==="true"||e==="True"||e==="TRUE")||u===5&&(e==="false"||e==="False"||e==="FALSE")}function ca(e){return e==="true"||e==="True"||e==="TRUE"}function da(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Yi=new Ee("tag:yaml.org,2002:bool",{kind:"scalar",resolve:la,construct:ca,predicate:da,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ua(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function pa(e){return 48<=e&&e<=55}function ha(e){return 48<=e&&e<=57}function fa(e){if(e===null)return!1;var u=e.length,r=0,s=!1,l;if(!u)return!1;if(l=e[r],(l==="-"||l==="+")&&(l=e[++r]),l==="0"){if(r+1===u)return!0;if(l=e[++r],l==="b"){for(r++;r<u;r++)if(l=e[r],l!=="_"){if(l!=="0"&&l!=="1")return!1;s=!0}return s&&l!=="_"}if(l==="x"){for(r++;r<u;r++)if(l=e[r],l!=="_"){if(!ua(e.charCodeAt(r)))return!1;s=!0}return s&&l!=="_"}if(l==="o"){for(r++;r<u;r++)if(l=e[r],l!=="_"){if(!pa(e.charCodeAt(r)))return!1;s=!0}return s&&l!=="_"}}if(l==="_")return!1;for(;r<u;r++)if(l=e[r],l!=="_"){if(!ha(e.charCodeAt(r)))return!1;s=!0}return!(!s||l==="_")}function ga(e){var u=e,r=1,s;if(u.indexOf("_")!==-1&&(u=u.replace(/_/g,"")),s=u[0],(s==="-"||s==="+")&&(s==="-"&&(r=-1),u=u.slice(1),s=u[0]),u==="0")return 0;if(s==="0"){if(u[1]==="b")return r*parseInt(u.slice(2),2);if(u[1]==="x")return r*parseInt(u.slice(2),16);if(u[1]==="o")return r*parseInt(u.slice(2),8)}return r*parseInt(u,10)}function ma(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!xe.isNegativeZero(e)}var $i=new Ee("tag:yaml.org,2002:int",{kind:"scalar",resolve:fa,construct:ga,predicate:ma,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),va=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function ya(e){return!(e===null||!va.test(e)||e[e.length-1]==="_")}function ba(e){var u,r;return u=e.replace(/_/g,"").toLowerCase(),r=u[0]==="-"?-1:1,"+-".indexOf(u[0])>=0&&(u=u.slice(1)),u===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:u===".nan"?NaN:r*parseFloat(u,10)}var xa=/^[-+]?[0-9]+e/;function _a(e,u){var r;if(isNaN(e))switch(u){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(u){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(u){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(xe.isNegativeZero(e))return"-0.0";return r=e.toString(10),xa.test(r)?r.replace("e",".e"):r}function wa(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||xe.isNegativeZero(e))}var Ki=new Ee("tag:yaml.org,2002:float",{kind:"scalar",resolve:ya,construct:ba,predicate:wa,represent:_a,defaultStyle:"lowercase"}),Ui=qi.extend({implicit:[Hi,Yi,$i,Ki]}),Wi=Ui,Xi=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Vi=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Sa(e){return e===null?!1:Xi.exec(e)!==null||Vi.exec(e)!==null}function ka(e){var u,r,s,l,p,c,h,m=0,x=null,b,_,k;if(u=Xi.exec(e),u===null&&(u=Vi.exec(e)),u===null)throw new Error("Date resolve error");if(r=+u[1],s=+u[2]-1,l=+u[3],!u[4])return new Date(Date.UTC(r,s,l));if(p=+u[4],c=+u[5],h=+u[6],u[7]){for(m=u[7].slice(0,3);m.length<3;)m+="0";m=+m}return u[9]&&(b=+u[10],_=+(u[11]||0),x=(b*60+_)*6e4,u[9]==="-"&&(x=-x)),k=new Date(Date.UTC(r,s,l,p,c,h,m)),x&&k.setTime(k.getTime()-x),k}function Ea(e){return e.toISOString()}var Gi=new Ee("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:Sa,construct:ka,instanceOf:Date,represent:Ea});function Ca(e){return e==="<<"||e===null}var Ji=new Ee("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Ca}),zn=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Aa(e){if(e===null)return!1;var u,r,s=0,l=e.length,p=zn;for(r=0;r<l;r++)if(u=p.indexOf(e.charAt(r)),!(u>64)){if(u<0)return!1;s+=6}return s%8===0}function Oa(e){var u,r,s=e.replace(/[\r\n=]/g,""),l=s.length,p=zn,c=0,h=[];for(u=0;u<l;u++)u%4===0&&u&&(h.push(c>>16&255),h.push(c>>8&255),h.push(c&255)),c=c<<6|p.indexOf(s.charAt(u));return r=l%4*6,r===0?(h.push(c>>16&255),h.push(c>>8&255),h.push(c&255)):r===18?(h.push(c>>10&255),h.push(c>>2&255)):r===12&&h.push(c>>4&255),new Uint8Array(h)}function Ta(e){var u="",r=0,s,l,p=e.length,c=zn;for(s=0;s<p;s++)s%3===0&&s&&(u+=c[r>>18&63],u+=c[r>>12&63],u+=c[r>>6&63],u+=c[r&63]),r=(r<<8)+e[s];return l=p%3,l===0?(u+=c[r>>18&63],u+=c[r>>12&63],u+=c[r>>6&63],u+=c[r&63]):l===2?(u+=c[r>>10&63],u+=c[r>>4&63],u+=c[r<<2&63],u+=c[64]):l===1&&(u+=c[r>>2&63],u+=c[r<<4&63],u+=c[64],u+=c[64]),u}function Ma(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Qi=new Ee("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Aa,construct:Oa,predicate:Ma,represent:Ta}),Pa=Object.prototype.hasOwnProperty,Ia=Object.prototype.toString;function Fa(e){if(e===null)return!0;var u=[],r,s,l,p,c,h=e;for(r=0,s=h.length;r<s;r+=1){if(l=h[r],c=!1,Ia.call(l)!=="[object Object]")return!1;for(p in l)if(Pa.call(l,p))if(!c)c=!0;else return!1;if(!c)return!1;if(u.indexOf(p)===-1)u.push(p);else return!1}return!0}function La(e){return e!==null?e:[]}var Zi=new Ee("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Fa,construct:La}),za=Object.prototype.toString;function Da(e){if(e===null)return!0;var u,r,s,l,p,c=e;for(p=new Array(c.length),u=0,r=c.length;u<r;u+=1){if(s=c[u],za.call(s)!=="[object Object]"||(l=Object.keys(s),l.length!==1))return!1;p[u]=[l[0],s[l[0]]]}return!0}function Ra(e){if(e===null)return[];var u,r,s,l,p,c=e;for(p=new Array(c.length),u=0,r=c.length;u<r;u+=1)s=c[u],l=Object.keys(s),p[u]=[l[0],s[l[0]]];return p}var er=new Ee("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Da,construct:Ra}),Ba=Object.prototype.hasOwnProperty;function Na(e){if(e===null)return!0;var u,r=e;for(u in r)if(Ba.call(r,u)&&r[u]!==null)return!1;return!0}function ja(e){return e!==null?e:{}}var tr=new Ee("tag:yaml.org,2002:set",{kind:"mapping",resolve:Na,construct:ja}),Dn=Wi.extend({implicit:[Gi,Ji],explicit:[Qi,Zi,er,tr]}),st=Object.prototype.hasOwnProperty,an=1,nr=2,ir=3,sn=4,Tn=1,qa=2,_i=3,Ha=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ya=/[\x85\u2028\u2029]/,$a=/[,\[\]\{\}]/,rr=/^(?:!|!!|![a-z\-]+!)$/i,or=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function wi(e){return Object.prototype.toString.call(e)}function We(e){return e===10||e===13}function ft(e){return e===9||e===32}function Re(e){return e===9||e===32||e===10||e===13}function Tt(e){return e===44||e===91||e===93||e===123||e===125}function Ka(e){var u;return 48<=e&&e<=57?e-48:(u=e|32,97<=u&&u<=102?u-97+10:-1)}function Ua(e){return e===120?2:e===117?4:e===85?8:0}function Wa(e){return 48<=e&&e<=57?e-48:-1}function Si(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Xa(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var ar=new Array(256),sr=new Array(256);for(ht=0;ht<256;ht++)ar[ht]=Si(ht)?1:0,sr[ht]=Si(ht);var ht;function Va(e,u){this.input=e,this.filename=u.filename||null,this.schema=u.schema||Dn,this.onWarning=u.onWarning||null,this.legacy=u.legacy||!1,this.json=u.json||!1,this.listener=u.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function lr(e,u){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=Zo(r),new Le(u,r)}function $(e,u){throw lr(e,u)}function ln(e,u){e.onWarning&&e.onWarning.call(null,lr(e,u))}var ki={YAML:function(u,r,s){var l,p,c;u.version!==null&&$(u,"duplication of %YAML directive"),s.length!==1&&$(u,"YAML directive accepts exactly one argument"),l=/^([0-9]+)\.([0-9]+)$/.exec(s[0]),l===null&&$(u,"ill-formed argument of the YAML directive"),p=parseInt(l[1],10),c=parseInt(l[2],10),p!==1&&$(u,"unacceptable YAML version of the document"),u.version=s[0],u.checkLineBreaks=c<2,c!==1&&c!==2&&ln(u,"unsupported YAML version of the document")},TAG:function(u,r,s){var l,p;s.length!==2&&$(u,"TAG directive accepts exactly two arguments"),l=s[0],p=s[1],rr.test(l)||$(u,"ill-formed tag handle (first argument) of the TAG directive"),st.call(u.tagMap,l)&&$(u,'there is a previously declared suffix for "'+l+'" tag handle'),or.test(p)||$(u,"ill-formed tag prefix (second argument) of the TAG directive");try{p=decodeURIComponent(p)}catch{$(u,"tag prefix is malformed: "+p)}u.tagMap[l]=p}};function at(e,u,r,s){var l,p,c,h;if(u<r){if(h=e.input.slice(u,r),s)for(l=0,p=h.length;l<p;l+=1)c=h.charCodeAt(l),c===9||32<=c&&c<=1114111||$(e,"expected valid JSON character");else Ha.test(h)&&$(e,"the stream contains non-printable characters");e.result+=h}}function Ei(e,u,r,s){var l,p,c,h;for(xe.isObject(r)||$(e,"cannot merge mappings; the provided source object is unacceptable"),l=Object.keys(r),c=0,h=l.length;c<h;c+=1)p=l[c],st.call(u,p)||(u[p]=r[p],s[p]=!0)}function Mt(e,u,r,s,l,p,c,h,m){var x,b;if(Array.isArray(l))for(l=Array.prototype.slice.call(l),x=0,b=l.length;x<b;x+=1)Array.isArray(l[x])&&$(e,"nested arrays are not supported inside keys"),typeof l=="object"&&wi(l[x])==="[object Object]"&&(l[x]="[object Object]");if(typeof l=="object"&&wi(l)==="[object Object]"&&(l="[object Object]"),l=String(l),u===null&&(u={}),s==="tag:yaml.org,2002:merge")if(Array.isArray(p))for(x=0,b=p.length;x<b;x+=1)Ei(e,u,p[x],r);else Ei(e,u,p,r);else!e.json&&!st.call(r,l)&&st.call(u,l)&&(e.line=c||e.line,e.lineStart=h||e.lineStart,e.position=m||e.position,$(e,"duplicated mapping key")),l==="__proto__"?Object.defineProperty(u,l,{configurable:!0,enumerable:!0,writable:!0,value:p}):u[l]=p,delete r[l];return u}function Rn(e){var u;u=e.input.charCodeAt(e.position),u===10?e.position++:u===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):$(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function be(e,u,r){for(var s=0,l=e.input.charCodeAt(e.position);l!==0;){for(;ft(l);)l===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),l=e.input.charCodeAt(++e.position);if(u&&l===35)do l=e.input.charCodeAt(++e.position);while(l!==10&&l!==13&&l!==0);if(We(l))for(Rn(e),l=e.input.charCodeAt(e.position),s++,e.lineIndent=0;l===32;)e.lineIndent++,l=e.input.charCodeAt(++e.position);else break}return r!==-1&&s!==0&&e.lineIndent<r&&ln(e,"deficient indentation"),s}function un(e){var u=e.position,r;return r=e.input.charCodeAt(u),!!((r===45||r===46)&&r===e.input.charCodeAt(u+1)&&r===e.input.charCodeAt(u+2)&&(u+=3,r=e.input.charCodeAt(u),r===0||Re(r)))}function Bn(e,u){u===1?e.result+=" ":u>1&&(e.result+=xe.repeat(`
`,u-1))}function Ga(e,u,r){var s,l,p,c,h,m,x,b,_=e.kind,k=e.result,C;if(C=e.input.charCodeAt(e.position),Re(C)||Tt(C)||C===35||C===38||C===42||C===33||C===124||C===62||C===39||C===34||C===37||C===64||C===96||(C===63||C===45)&&(l=e.input.charCodeAt(e.position+1),Re(l)||r&&Tt(l)))return!1;for(e.kind="scalar",e.result="",p=c=e.position,h=!1;C!==0;){if(C===58){if(l=e.input.charCodeAt(e.position+1),Re(l)||r&&Tt(l))break}else if(C===35){if(s=e.input.charCodeAt(e.position-1),Re(s))break}else{if(e.position===e.lineStart&&un(e)||r&&Tt(C))break;if(We(C))if(m=e.line,x=e.lineStart,b=e.lineIndent,be(e,!1,-1),e.lineIndent>=u){h=!0,C=e.input.charCodeAt(e.position);continue}else{e.position=c,e.line=m,e.lineStart=x,e.lineIndent=b;break}}h&&(at(e,p,c,!1),Bn(e,e.line-m),p=c=e.position,h=!1),ft(C)||(c=e.position+1),C=e.input.charCodeAt(++e.position)}return at(e,p,c,!1),e.result?!0:(e.kind=_,e.result=k,!1)}function Ja(e,u){var r,s,l;if(r=e.input.charCodeAt(e.position),r!==39)return!1;for(e.kind="scalar",e.result="",e.position++,s=l=e.position;(r=e.input.charCodeAt(e.position))!==0;)if(r===39)if(at(e,s,e.position,!0),r=e.input.charCodeAt(++e.position),r===39)s=e.position,e.position++,l=e.position;else return!0;else We(r)?(at(e,s,l,!0),Bn(e,be(e,!1,u)),s=l=e.position):e.position===e.lineStart&&un(e)?$(e,"unexpected end of the document within a single quoted scalar"):(e.position++,l=e.position);$(e,"unexpected end of the stream within a single quoted scalar")}function Qa(e,u){var r,s,l,p,c,h;if(h=e.input.charCodeAt(e.position),h!==34)return!1;for(e.kind="scalar",e.result="",e.position++,r=s=e.position;(h=e.input.charCodeAt(e.position))!==0;){if(h===34)return at(e,r,e.position,!0),e.position++,!0;if(h===92){if(at(e,r,e.position,!0),h=e.input.charCodeAt(++e.position),We(h))be(e,!1,u);else if(h<256&&ar[h])e.result+=sr[h],e.position++;else if((c=Ua(h))>0){for(l=c,p=0;l>0;l--)h=e.input.charCodeAt(++e.position),(c=Ka(h))>=0?p=(p<<4)+c:$(e,"expected hexadecimal character");e.result+=Xa(p),e.position++}else $(e,"unknown escape sequence");r=s=e.position}else We(h)?(at(e,r,s,!0),Bn(e,be(e,!1,u)),r=s=e.position):e.position===e.lineStart&&un(e)?$(e,"unexpected end of the document within a double quoted scalar"):(e.position++,s=e.position)}$(e,"unexpected end of the stream within a double quoted scalar")}function Za(e,u){var r=!0,s,l,p,c=e.tag,h,m=e.anchor,x,b,_,k,C,T=Object.create(null),z,L,I,O;if(O=e.input.charCodeAt(e.position),O===91)b=93,C=!1,h=[];else if(O===123)b=125,C=!0,h={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=h),O=e.input.charCodeAt(++e.position);O!==0;){if(be(e,!0,u),O=e.input.charCodeAt(e.position),O===b)return e.position++,e.tag=c,e.anchor=m,e.kind=C?"mapping":"sequence",e.result=h,!0;r?O===44&&$(e,"expected the node content, but found ','"):$(e,"missed comma between flow collection entries"),L=z=I=null,_=k=!1,O===63&&(x=e.input.charCodeAt(e.position+1),Re(x)&&(_=k=!0,e.position++,be(e,!0,u))),s=e.line,l=e.lineStart,p=e.position,Pt(e,u,an,!1,!0),L=e.tag,z=e.result,be(e,!0,u),O=e.input.charCodeAt(e.position),(k||e.line===s)&&O===58&&(_=!0,O=e.input.charCodeAt(++e.position),be(e,!0,u),Pt(e,u,an,!1,!0),I=e.result),C?Mt(e,h,T,L,z,I,s,l,p):_?h.push(Mt(e,null,T,L,z,I,s,l,p)):h.push(z),be(e,!0,u),O=e.input.charCodeAt(e.position),O===44?(r=!0,O=e.input.charCodeAt(++e.position)):r=!1}$(e,"unexpected end of the stream within a flow collection")}function es(e,u){var r,s,l=Tn,p=!1,c=!1,h=u,m=0,x=!1,b,_;if(_=e.input.charCodeAt(e.position),_===124)s=!1;else if(_===62)s=!0;else return!1;for(e.kind="scalar",e.result="";_!==0;)if(_=e.input.charCodeAt(++e.position),_===43||_===45)Tn===l?l=_===43?_i:qa:$(e,"repeat of a chomping mode identifier");else if((b=Wa(_))>=0)b===0?$(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):c?$(e,"repeat of an indentation width identifier"):(h=u+b-1,c=!0);else break;if(ft(_)){do _=e.input.charCodeAt(++e.position);while(ft(_));if(_===35)do _=e.input.charCodeAt(++e.position);while(!We(_)&&_!==0)}for(;_!==0;){for(Rn(e),e.lineIndent=0,_=e.input.charCodeAt(e.position);(!c||e.lineIndent<h)&&_===32;)e.lineIndent++,_=e.input.charCodeAt(++e.position);if(!c&&e.lineIndent>h&&(h=e.lineIndent),We(_)){m++;continue}if(e.lineIndent<h){l===_i?e.result+=xe.repeat(`
`,p?1+m:m):l===Tn&&p&&(e.result+=`
`);break}for(s?ft(_)?(x=!0,e.result+=xe.repeat(`
`,p?1+m:m)):x?(x=!1,e.result+=xe.repeat(`
`,m+1)):m===0?p&&(e.result+=" "):e.result+=xe.repeat(`
`,m):e.result+=xe.repeat(`
`,p?1+m:m),p=!0,c=!0,m=0,r=e.position;!We(_)&&_!==0;)_=e.input.charCodeAt(++e.position);at(e,r,e.position,!1)}return!0}function Ci(e,u){var r,s=e.tag,l=e.anchor,p=[],c,h=!1,m;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=p),m=e.input.charCodeAt(e.position);m!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,$(e,"tab characters must not be used in indentation")),!(m!==45||(c=e.input.charCodeAt(e.position+1),!Re(c))));){if(h=!0,e.position++,be(e,!0,-1)&&e.lineIndent<=u){p.push(null),m=e.input.charCodeAt(e.position);continue}if(r=e.line,Pt(e,u,ir,!1,!0),p.push(e.result),be(e,!0,-1),m=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>u)&&m!==0)$(e,"bad indentation of a sequence entry");else if(e.lineIndent<u)break}return h?(e.tag=s,e.anchor=l,e.kind="sequence",e.result=p,!0):!1}function ts(e,u,r){var s,l,p,c,h,m,x=e.tag,b=e.anchor,_={},k=Object.create(null),C=null,T=null,z=null,L=!1,I=!1,O;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=_),O=e.input.charCodeAt(e.position);O!==0;){if(!L&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,$(e,"tab characters must not be used in indentation")),s=e.input.charCodeAt(e.position+1),p=e.line,(O===63||O===58)&&Re(s))O===63?(L&&(Mt(e,_,k,C,T,null,c,h,m),C=T=z=null),I=!0,L=!0,l=!0):L?(L=!1,l=!0):$(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,O=s;else{if(c=e.line,h=e.lineStart,m=e.position,!Pt(e,r,nr,!1,!0))break;if(e.line===p){for(O=e.input.charCodeAt(e.position);ft(O);)O=e.input.charCodeAt(++e.position);if(O===58)O=e.input.charCodeAt(++e.position),Re(O)||$(e,"a whitespace character is expected after the key-value separator within a block mapping"),L&&(Mt(e,_,k,C,T,null,c,h,m),C=T=z=null),I=!0,L=!1,l=!1,C=e.tag,T=e.result;else if(I)$(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=x,e.anchor=b,!0}else if(I)$(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=x,e.anchor=b,!0}if((e.line===p||e.lineIndent>u)&&(L&&(c=e.line,h=e.lineStart,m=e.position),Pt(e,u,sn,!0,l)&&(L?T=e.result:z=e.result),L||(Mt(e,_,k,C,T,z,c,h,m),C=T=z=null),be(e,!0,-1),O=e.input.charCodeAt(e.position)),(e.line===p||e.lineIndent>u)&&O!==0)$(e,"bad indentation of a mapping entry");else if(e.lineIndent<u)break}return L&&Mt(e,_,k,C,T,null,c,h,m),I&&(e.tag=x,e.anchor=b,e.kind="mapping",e.result=_),I}function ns(e){var u,r=!1,s=!1,l,p,c;if(c=e.input.charCodeAt(e.position),c!==33)return!1;if(e.tag!==null&&$(e,"duplication of a tag property"),c=e.input.charCodeAt(++e.position),c===60?(r=!0,c=e.input.charCodeAt(++e.position)):c===33?(s=!0,l="!!",c=e.input.charCodeAt(++e.position)):l="!",u=e.position,r){do c=e.input.charCodeAt(++e.position);while(c!==0&&c!==62);e.position<e.length?(p=e.input.slice(u,e.position),c=e.input.charCodeAt(++e.position)):$(e,"unexpected end of the stream within a verbatim tag")}else{for(;c!==0&&!Re(c);)c===33&&(s?$(e,"tag suffix cannot contain exclamation marks"):(l=e.input.slice(u-1,e.position+1),rr.test(l)||$(e,"named tag handle cannot contain such characters"),s=!0,u=e.position+1)),c=e.input.charCodeAt(++e.position);p=e.input.slice(u,e.position),$a.test(p)&&$(e,"tag suffix cannot contain flow indicator characters")}p&&!or.test(p)&&$(e,"tag name cannot contain such characters: "+p);try{p=decodeURIComponent(p)}catch{$(e,"tag name is malformed: "+p)}return r?e.tag=p:st.call(e.tagMap,l)?e.tag=e.tagMap[l]+p:l==="!"?e.tag="!"+p:l==="!!"?e.tag="tag:yaml.org,2002:"+p:$(e,'undeclared tag handle "'+l+'"'),!0}function is(e){var u,r;if(r=e.input.charCodeAt(e.position),r!==38)return!1;for(e.anchor!==null&&$(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),u=e.position;r!==0&&!Re(r)&&!Tt(r);)r=e.input.charCodeAt(++e.position);return e.position===u&&$(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(u,e.position),!0}function rs(e){var u,r,s;if(s=e.input.charCodeAt(e.position),s!==42)return!1;for(s=e.input.charCodeAt(++e.position),u=e.position;s!==0&&!Re(s)&&!Tt(s);)s=e.input.charCodeAt(++e.position);return e.position===u&&$(e,"name of an alias node must contain at least one character"),r=e.input.slice(u,e.position),st.call(e.anchorMap,r)||$(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],be(e,!0,-1),!0}function Pt(e,u,r,s,l){var p,c,h,m=1,x=!1,b=!1,_,k,C,T,z,L;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,p=c=h=sn===r||ir===r,s&&be(e,!0,-1)&&(x=!0,e.lineIndent>u?m=1:e.lineIndent===u?m=0:e.lineIndent<u&&(m=-1)),m===1)for(;ns(e)||is(e);)be(e,!0,-1)?(x=!0,h=p,e.lineIndent>u?m=1:e.lineIndent===u?m=0:e.lineIndent<u&&(m=-1)):h=!1;if(h&&(h=x||l),(m===1||sn===r)&&(an===r||nr===r?z=u:z=u+1,L=e.position-e.lineStart,m===1?h&&(Ci(e,L)||ts(e,L,z))||Za(e,z)?b=!0:(c&&es(e,z)||Ja(e,z)||Qa(e,z)?b=!0:rs(e)?(b=!0,(e.tag!==null||e.anchor!==null)&&$(e,"alias node should not have any properties")):Ga(e,z,an===r)&&(b=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m===0&&(b=h&&Ci(e,L))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&$(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),_=0,k=e.implicitTypes.length;_<k;_+=1)if(T=e.implicitTypes[_],T.resolve(e.result)){e.result=T.construct(e.result),e.tag=T.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(st.call(e.typeMap[e.kind||"fallback"],e.tag))T=e.typeMap[e.kind||"fallback"][e.tag];else for(T=null,C=e.typeMap.multi[e.kind||"fallback"],_=0,k=C.length;_<k;_+=1)if(e.tag.slice(0,C[_].tag.length)===C[_].tag){T=C[_];break}T||$(e,"unknown tag !<"+e.tag+">"),e.result!==null&&T.kind!==e.kind&&$(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+T.kind+'", not "'+e.kind+'"'),T.resolve(e.result,e.tag)?(e.result=T.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):$(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||b}function os(e){var u=e.position,r,s,l,p=!1,c;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(c=e.input.charCodeAt(e.position))!==0&&(be(e,!0,-1),c=e.input.charCodeAt(e.position),!(e.lineIndent>0||c!==37));){for(p=!0,c=e.input.charCodeAt(++e.position),r=e.position;c!==0&&!Re(c);)c=e.input.charCodeAt(++e.position);for(s=e.input.slice(r,e.position),l=[],s.length<1&&$(e,"directive name must not be less than one character in length");c!==0;){for(;ft(c);)c=e.input.charCodeAt(++e.position);if(c===35){do c=e.input.charCodeAt(++e.position);while(c!==0&&!We(c));break}if(We(c))break;for(r=e.position;c!==0&&!Re(c);)c=e.input.charCodeAt(++e.position);l.push(e.input.slice(r,e.position))}c!==0&&Rn(e),st.call(ki,s)?ki[s](e,s,l):ln(e,'unknown document directive "'+s+'"')}if(be(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,be(e,!0,-1)):p&&$(e,"directives end mark is expected"),Pt(e,e.lineIndent-1,sn,!1,!0),be(e,!0,-1),e.checkLineBreaks&&Ya.test(e.input.slice(u,e.position))&&ln(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&un(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,be(e,!0,-1));return}if(e.position<e.length-1)$(e,"end of the stream or a document separator is expected");else return}function cr(e,u){e=String(e),u=u||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var r=new Va(e,u),s=e.indexOf("\0");for(s!==-1&&(r.position=s,$(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)os(r);return r.documents}function as(e,u,r){u!==null&&typeof u=="object"&&typeof r=="undefined"&&(r=u,u=null);var s=cr(e,r);if(typeof u!="function")return s;for(var l=0,p=s.length;l<p;l+=1)u(s[l])}function ss(e,u){var r=cr(e,u);if(r.length!==0){if(r.length===1)return r[0];throw new Le("expected a single document in the stream, but found more")}}var ls=as,cs=ss,dr={loadAll:ls,load:cs},ur=Object.prototype.toString,pr=Object.prototype.hasOwnProperty,Nn=65279,ds=9,$t=10,us=13,ps=32,hs=33,fs=34,Pn=35,gs=37,ms=38,vs=39,ys=42,hr=44,bs=45,cn=58,xs=61,_s=62,ws=63,Ss=64,fr=91,gr=93,ks=96,mr=123,Es=124,vr=125,Te={};Te[0]="\\0";Te[7]="\\a";Te[8]="\\b";Te[9]="\\t";Te[10]="\\n";Te[11]="\\v";Te[12]="\\f";Te[13]="\\r";Te[27]="\\e";Te[34]='\\"';Te[92]="\\\\";Te[133]="\\N";Te[160]="\\_";Te[8232]="\\L";Te[8233]="\\P";var Cs=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],As=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Os(e,u){var r,s,l,p,c,h,m;if(u===null)return{};for(r={},s=Object.keys(u),l=0,p=s.length;l<p;l+=1)c=s[l],h=String(u[c]),c.slice(0,2)==="!!"&&(c="tag:yaml.org,2002:"+c.slice(2)),m=e.compiledTypeMap.fallback[c],m&&pr.call(m.styleAliases,h)&&(h=m.styleAliases[h]),r[c]=h;return r}function Ts(e){var u,r,s;if(u=e.toString(16).toUpperCase(),e<=255)r="x",s=2;else if(e<=65535)r="u",s=4;else if(e<=4294967295)r="U",s=8;else throw new Le("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+r+xe.repeat("0",s-u.length)+u}var Ms=1,Kt=2;function Ps(e){this.schema=e.schema||Dn,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=xe.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Os(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Kt:Ms,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Ai(e,u){for(var r=xe.repeat(" ",u),s=0,l=-1,p="",c,h=e.length;s<h;)l=e.indexOf(`
`,s),l===-1?(c=e.slice(s),s=h):(c=e.slice(s,l+1),s=l+1),c.length&&c!==`
`&&(p+=r),p+=c;return p}function In(e,u){return`
`+xe.repeat(" ",e.indent*u)}function Is(e,u){var r,s,l;for(r=0,s=e.implicitTypes.length;r<s;r+=1)if(l=e.implicitTypes[r],l.resolve(u))return!0;return!1}function dn(e){return e===ps||e===ds}function Ut(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Nn||65536<=e&&e<=1114111}function Oi(e){return Ut(e)&&e!==Nn&&e!==us&&e!==$t}function Ti(e,u,r){var s=Oi(e),l=s&&!dn(e);return(r?s:s&&e!==hr&&e!==fr&&e!==gr&&e!==mr&&e!==vr)&&e!==Pn&&!(u===cn&&!l)||Oi(u)&&!dn(u)&&e===Pn||u===cn&&l}function Fs(e){return Ut(e)&&e!==Nn&&!dn(e)&&e!==bs&&e!==ws&&e!==cn&&e!==hr&&e!==fr&&e!==gr&&e!==mr&&e!==vr&&e!==Pn&&e!==ms&&e!==ys&&e!==hs&&e!==Es&&e!==xs&&e!==_s&&e!==vs&&e!==fs&&e!==gs&&e!==Ss&&e!==ks}function Ls(e){return!dn(e)&&e!==cn}function Ht(e,u){var r=e.charCodeAt(u),s;return r>=55296&&r<=56319&&u+1<e.length&&(s=e.charCodeAt(u+1),s>=56320&&s<=57343)?(r-55296)*1024+s-56320+65536:r}function yr(e){var u=/^\n* /;return u.test(e)}var br=1,Fn=2,xr=3,_r=4,Ot=5;function zs(e,u,r,s,l,p,c,h){var m,x=0,b=null,_=!1,k=!1,C=s!==-1,T=-1,z=Fs(Ht(e,0))&&Ls(Ht(e,e.length-1));if(u||c)for(m=0;m<e.length;x>=65536?m+=2:m++){if(x=Ht(e,m),!Ut(x))return Ot;z=z&&Ti(x,b,h),b=x}else{for(m=0;m<e.length;x>=65536?m+=2:m++){if(x=Ht(e,m),x===$t)_=!0,C&&(k=k||m-T-1>s&&e[T+1]!==" ",T=m);else if(!Ut(x))return Ot;z=z&&Ti(x,b,h),b=x}k=k||C&&m-T-1>s&&e[T+1]!==" "}return!_&&!k?z&&!c&&!l(e)?br:p===Kt?Ot:Fn:r>9&&yr(e)?Ot:c?p===Kt?Ot:Fn:k?_r:xr}function Ds(e,u,r,s,l){e.dump=(function(){if(u.length===0)return e.quotingType===Kt?'""':"''";if(!e.noCompatMode&&(Cs.indexOf(u)!==-1||As.test(u)))return e.quotingType===Kt?'"'+u+'"':"'"+u+"'";var p=e.indent*Math.max(1,r),c=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-p),h=s||e.flowLevel>-1&&r>=e.flowLevel;function m(x){return Is(e,x)}switch(zs(u,h,e.indent,c,m,e.quotingType,e.forceQuotes&&!s,l)){case br:return u;case Fn:return"'"+u.replace(/'/g,"''")+"'";case xr:return"|"+Mi(u,e.indent)+Pi(Ai(u,p));case _r:return">"+Mi(u,e.indent)+Pi(Ai(Rs(u,c),p));case Ot:return'"'+Bs(u)+'"';default:throw new Le("impossible error: invalid scalar style")}})()}function Mi(e,u){var r=yr(e)?String(u):"",s=e[e.length-1]===`
`,l=s&&(e[e.length-2]===`
`||e===`
`),p=l?"+":s?"":"-";return r+p+`
`}function Pi(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Rs(e,u){for(var r=/(\n+)([^\n]*)/g,s=(function(){var x=e.indexOf(`
`);return x=x!==-1?x:e.length,r.lastIndex=x,Ii(e.slice(0,x),u)})(),l=e[0]===`
`||e[0]===" ",p,c;c=r.exec(e);){var h=c[1],m=c[2];p=m[0]===" ",s+=h+(!l&&!p&&m!==""?`
`:"")+Ii(m,u),l=p}return s}function Ii(e,u){if(e===""||e[0]===" ")return e;for(var r=/ [^ ]/g,s,l=0,p,c=0,h=0,m="";s=r.exec(e);)h=s.index,h-l>u&&(p=c>l?c:h,m+=`
`+e.slice(l,p),l=p+1),c=h;return m+=`
`,e.length-l>u&&c>l?m+=e.slice(l,c)+`
`+e.slice(c+1):m+=e.slice(l),m.slice(1)}function Bs(e){for(var u="",r=0,s,l=0;l<e.length;r>=65536?l+=2:l++)r=Ht(e,l),s=Te[r],!s&&Ut(r)?(u+=e[l],r>=65536&&(u+=e[l+1])):u+=s||Ts(r);return u}function Ns(e,u,r){var s="",l=e.tag,p,c,h;for(p=0,c=r.length;p<c;p+=1)h=r[p],e.replacer&&(h=e.replacer.call(r,String(p),h)),(Ze(e,u,h,!1,!1)||typeof h=="undefined"&&Ze(e,u,null,!1,!1))&&(s!==""&&(s+=","+(e.condenseFlow?"":" ")),s+=e.dump);e.tag=l,e.dump="["+s+"]"}function Fi(e,u,r,s){var l="",p=e.tag,c,h,m;for(c=0,h=r.length;c<h;c+=1)m=r[c],e.replacer&&(m=e.replacer.call(r,String(c),m)),(Ze(e,u+1,m,!0,!0,!1,!0)||typeof m=="undefined"&&Ze(e,u+1,null,!0,!0,!1,!0))&&((!s||l!=="")&&(l+=In(e,u)),e.dump&&$t===e.dump.charCodeAt(0)?l+="-":l+="- ",l+=e.dump);e.tag=p,e.dump=l||"[]"}function js(e,u,r){var s="",l=e.tag,p=Object.keys(r),c,h,m,x,b;for(c=0,h=p.length;c<h;c+=1)b="",s!==""&&(b+=", "),e.condenseFlow&&(b+='"'),m=p[c],x=r[m],e.replacer&&(x=e.replacer.call(r,m,x)),Ze(e,u,m,!1,!1)&&(e.dump.length>1024&&(b+="? "),b+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Ze(e,u,x,!1,!1)&&(b+=e.dump,s+=b));e.tag=l,e.dump="{"+s+"}"}function qs(e,u,r,s){var l="",p=e.tag,c=Object.keys(r),h,m,x,b,_,k;if(e.sortKeys===!0)c.sort();else if(typeof e.sortKeys=="function")c.sort(e.sortKeys);else if(e.sortKeys)throw new Le("sortKeys must be a boolean or a function");for(h=0,m=c.length;h<m;h+=1)k="",(!s||l!=="")&&(k+=In(e,u)),x=c[h],b=r[x],e.replacer&&(b=e.replacer.call(r,x,b)),Ze(e,u+1,x,!0,!0,!0)&&(_=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,_&&(e.dump&&$t===e.dump.charCodeAt(0)?k+="?":k+="? "),k+=e.dump,_&&(k+=In(e,u)),Ze(e,u+1,b,!0,_)&&(e.dump&&$t===e.dump.charCodeAt(0)?k+=":":k+=": ",k+=e.dump,l+=k));e.tag=p,e.dump=l||"{}"}function Li(e,u,r){var s,l,p,c,h,m;for(l=r?e.explicitTypes:e.implicitTypes,p=0,c=l.length;p<c;p+=1)if(h=l[p],(h.instanceOf||h.predicate)&&(!h.instanceOf||typeof u=="object"&&u instanceof h.instanceOf)&&(!h.predicate||h.predicate(u))){if(r?h.multi&&h.representName?e.tag=h.representName(u):e.tag=h.tag:e.tag="?",h.represent){if(m=e.styleMap[h.tag]||h.defaultStyle,ur.call(h.represent)==="[object Function]")s=h.represent(u,m);else if(pr.call(h.represent,m))s=h.represent[m](u,m);else throw new Le("!<"+h.tag+'> tag resolver accepts not "'+m+'" style');e.dump=s}return!0}return!1}function Ze(e,u,r,s,l,p,c){e.tag=null,e.dump=r,Li(e,r,!1)||Li(e,r,!0);var h=ur.call(e.dump),m=s,x;s&&(s=e.flowLevel<0||e.flowLevel>u);var b=h==="[object Object]"||h==="[object Array]",_,k;if(b&&(_=e.duplicates.indexOf(r),k=_!==-1),(e.tag!==null&&e.tag!=="?"||k||e.indent!==2&&u>0)&&(l=!1),k&&e.usedDuplicates[_])e.dump="*ref_"+_;else{if(b&&k&&!e.usedDuplicates[_]&&(e.usedDuplicates[_]=!0),h==="[object Object]")s&&Object.keys(e.dump).length!==0?(qs(e,u,e.dump,l),k&&(e.dump="&ref_"+_+e.dump)):(js(e,u,e.dump),k&&(e.dump="&ref_"+_+" "+e.dump));else if(h==="[object Array]")s&&e.dump.length!==0?(e.noArrayIndent&&!c&&u>0?Fi(e,u-1,e.dump,l):Fi(e,u,e.dump,l),k&&(e.dump="&ref_"+_+e.dump)):(Ns(e,u,e.dump),k&&(e.dump="&ref_"+_+" "+e.dump));else if(h==="[object String]")e.tag!=="?"&&Ds(e,e.dump,u,p,m);else{if(h==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new Le("unacceptable kind of an object to dump "+h)}e.tag!==null&&e.tag!=="?"&&(x=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?x="!"+x:x.slice(0,18)==="tag:yaml.org,2002:"?x="!!"+x.slice(18):x="!<"+x+">",e.dump=x+" "+e.dump)}return!0}function Hs(e,u){var r=[],s=[],l,p;for(Ln(e,r,s),l=0,p=s.length;l<p;l+=1)u.duplicates.push(r[s[l]]);u.usedDuplicates=new Array(p)}function Ln(e,u,r){var s,l,p;if(e!==null&&typeof e=="object")if(l=u.indexOf(e),l!==-1)r.indexOf(l)===-1&&r.push(l);else if(u.push(e),Array.isArray(e))for(l=0,p=e.length;l<p;l+=1)Ln(e[l],u,r);else for(s=Object.keys(e),l=0,p=s.length;l<p;l+=1)Ln(e[s[l]],u,r)}function Ys(e,u){u=u||{};var r=new Ps(u);r.noRefs||Hs(e,r);var s=e;return r.replacer&&(s=r.replacer.call({"":s},"",s)),Ze(r,0,s,!0,!0)?r.dump+`
`:""}var $s=Ys,Ks={dump:$s};function jn(e,u){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+u+" instead, which is now safe by default.")}}var Us=Ee,Ws=Ri,Xs=qi,Vs=Ui,Gs=Wi,Js=Dn,Qs=dr.load,Zs=dr.loadAll,el=Ks.dump,tl=Le,nl={binary:Qi,float:Ki,map:ji,null:Hi,pairs:er,set:tr,timestamp:Gi,bool:Yi,int:$i,merge:Ji,omap:Zi,seq:Ni,str:Bi},il=jn("safeLoad","load"),rl=jn("safeLoadAll","loadAll"),ol=jn("safeDump","dump"),al={Type:Us,Schema:Ws,FAILSAFE_SCHEMA:Xs,JSON_SCHEMA:Vs,CORE_SCHEMA:Gs,DEFAULT_SCHEMA:Js,load:Qs,loadAll:Zs,dump:el,YAMLException:tl,types:nl,safeLoad:il,safeLoadAll:rl,safeDump:ol},wr=al;window.interact||(window.interact=kr.default);window.jsyaml||(window.jsyaml=wr);var sl="0.1.128";console.info(`%c drag-and-drop-card %c v${sl} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var ll=(e,...u)=>console.debug(`[drag-and-drop-card] ${e}`,...u);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var Sr=()=>new Promise(e=>requestAnimationFrame(()=>e())),cl=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),qn=class e extends HTMLElement{constructor(){super();yi(this,"__booting",!1);this.shadowRoot||this.attachShadow({mode:"open"}),this.__rebuiltCards=new WeakSet}_hasCardModDeep(r){try{if(!r||typeof r!="object")return!1;if(r.card_mod||r.type==="custom:mod-card")return!0;if(r.card)return this._hasCardModDeep(r.card);if(Array.isArray(r.cards)){for(let s of r.cards)if(this._hasCardModDeep(s))return!0}return!1}catch{return!1}}_rebuildOnce(r){try{if(!r||(this.__rebuiltCards||(this.__rebuiltCards=new WeakSet),this.__rebuiltCards.has(r)))return;this.__rebuiltCards.add(r),r.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}}_deepQueryAll(r,s=document){let l=[],p=c=>{if(!c)return;if(c.querySelectorAll)try{c.querySelectorAll(r).forEach(x=>l.push(x))}catch{}let h=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,null),m=c;for(;m;){let x=m.shadowRoot;x&&p(x),m=h.nextNode()}};return p(s),l}_syncEditorsStorageKey(){try{let r=this.storageKey||"";this._deepQueryAll("#storage_key").forEach(l=>{try{l&&l.tagName==="INPUT"&&l.value!==r&&(l.value=r,l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}})}catch{}}static getConfigElement(){let r=document.createElement("div");r.innerHTML=`
      <style>
        .cfg-row{display:flex;gap:12px;align-items:center;margin:8px 0;flex-wrap:wrap}
        input[type="text"],input[type="number"],select{
          padding:6px;border-radius:8px;border:1px solid var(--divider-color);
          background:var(--primary-background-color);color:var(--primary-text-color)
        }
        label{font-weight:600;min-width:130px}
        .inline{display:inline-flex;gap:8px;align-items:center}
        .hint{opacity:.65;font-size:.85rem}
      </style>
  
      <div class="cfg-row">
        <label>Storage key</label>
        <input type="text" id="storage_key" placeholder="e.g. livingroom_layout">
      </div>
  
      <div class="cfg-row">
        <label>Grid (px)</label>
        <input type="number" id="grid" min="5" step="1" value="10">
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="liveSnap"> Snap while dragging (live)</label>
      </div>
  
      <div class="cfg-row">
        <label>Auto-save</label>
        <input type="checkbox" id="autoSave" checked>
        <span style="margin-left:auto">Debounce (ms)</span>
        <input type="number" id="autoSaveDebounce" min="0" step="50" value="800" style="width:90px">
      </div>
  
      <div class="cfg-row">
        <label>Container Baxckground</label>
        <input type="text" id="containerBg"
          placeholder="transparent or css e.g. linear-gradient(...)"
          title="Try: transparent, #232f3e, linear-gradient(to right, #1a2a6c, #b21f1f, #fdbb2d), radial-gradient(circle, #4e54c8, #8f94fb)" />
      </div>
  
      <div class="cfg-row">
        <label>Card Background</label>
        <input type="text" id="cardBg"
          placeholder="var(--ha-card-background) or css e.g. #ffffffcc"
          title="Try: transparent, #151515aa, linear-gradient(135deg, #667eea 0%, #764ba2 100%)" />
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="debug"> Debug logs</label>
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="noOverlap">
          Disable overlapping <small style="opacity:.6">(Experimental)</small>
        </label>
      </div>
  
      <!-- NEW: container sizing -->
      <div class="cfg-row">
        <label>Container size</label>
        <select id="sizeMode">
          <option value="dynamic">Dynamic (auto)</option>
          <option value="fixed_custom">User preference (px)</option>
          <option value="preset">Preset</option>
        </select>
  
        <span id="sizeCustom" class="inline" style="display:none">
          W <input type="number" id="sizeW" min="100" step="10" style="width:110px">
          H <input type="number" id="sizeH" min="100" step="10" style="width:110px">
        </span>
  
        <span id="sizePresetWrap" class="inline" style="display:none">
          <select id="sizePreset" style="min-width:240px"></select>
          <select id="sizeOrientation">
            <option value="auto">Auto</option>
            <option value="portrait">Portrait</option>
            <option value="landscape">Landscape</option>
          </select>
        </span>
        <span class="hint">In fixed mode, cards cannot leave the box.</span>
      </div>
    `;let s=e._sizePresets(),l=r.querySelector("#sizePreset"),p=(x,b)=>{let _=document.createElement("optgroup");_.label=x,b.forEach(k=>{let C=document.createElement("option");C.value=k.key,C.textContent=`${k.label} (${k.w}\xD7${k.h})`,l.appendChild(C)}),l.appendChild(_)};[["Phones",s.filter(x=>x.group==="phone")],["Tablets",s.filter(x=>x.group==="tablet")],["Desktop",s.filter(x=>x.group==="desktop")]].forEach(([x,b])=>{if(!b.length)return;let _=document.createElement("optgroup");_.label=x,b.forEach(k=>{let C=document.createElement("option");C.value=k.key,C.textContent=`${k.label} (${k.w}\xD7${k.h})`,_.appendChild(C)}),l.appendChild(_)});let c=()=>{let x=r.querySelector("#sizeMode").value;r.querySelector("#sizeCustom").style.display=x==="fixed_custom"?"inline-flex":"none",r.querySelector("#sizePresetWrap").style.display=x==="preset"?"inline-flex":"none"};r.setConfig=(x={})=>{var b,_,k,C,T,z;r._config={type:x.type||"custom:drag-and-drop-card",...x},r.querySelector("#storage_key").value=x.storage_key||"",r.querySelector("#grid").value=(b=x.grid)!=null?b:10,r.querySelector("#liveSnap").checked=!!x.drag_live_snap,r.querySelector("#autoSave").checked=x.auto_save!==!1,r.querySelector("#autoSaveDebounce").value=(_=x.auto_save_debounce)!=null?_:800,r.querySelector("#containerBg").value=(k=x.container_background)!=null?k:"transparent",r.querySelector("#cardBg").value=(C=x.card_background)!=null?C:"var(--ha-card-background, var(--card-background-color))",r.querySelector("#debug").checked=!!x.debug,r.querySelector("#noOverlap").checked=!!x.disable_overlap,r.querySelector("#sizeMode").value=x.container_size_mode||"dynamic",r.querySelector("#sizeW").value=(T=x.container_fixed_width)!=null?T:"",r.querySelector("#sizeH").value=(z=x.container_fixed_height)!=null?z:"",r.querySelector("#sizePreset").value=x.container_preset||"fullhd",r.querySelector("#sizeOrientation").value=x.container_preset_orientation||"auto",c()},r.getConfig=()=>{let x={...r._config||{type:"custom:drag-and-drop-card"}};return x.type=x.type||"custom:drag-and-drop-card",x.storage_key=r.querySelector("#storage_key").value||void 0,x.grid=Number(r.querySelector("#grid").value||10),x.drag_live_snap=!!r.querySelector("#liveSnap").checked,x.auto_save=!!r.querySelector("#autoSave").checked,x.auto_save_debounce=Number(r.querySelector("#autoSaveDebounce").value||800),x.container_background=r.querySelector("#containerBg").value||"transparent",x.card_background=r.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",x.debug=!!r.querySelector("#debug").checked,x.disable_overlap=!!r.querySelector("#noOverlap").checked,x.container_size_mode=r.querySelector("#sizeMode").value,x.container_fixed_width=Number(r.querySelector("#sizeW").value||0)||void 0,x.container_fixed_height=Number(r.querySelector("#sizeH").value||0)||void 0,x.container_preset=r.querySelector("#sizePreset").value||void 0,x.container_preset_orientation=r.querySelector("#sizeOrientation").value||"auto",x};let h=()=>{r.dispatchEvent(new CustomEvent("config-changed",{detail:{config:r.getConfig()}}))},m=(x,b="input")=>{var _;return(_=r.querySelector(x))==null?void 0:_.addEventListener(b,()=>{x==="#sizeMode"&&c(),h()})};return m("#storage_key"),m("#grid"),m("#liveSnap","change"),m("#autoSave","change"),m("#autoSaveDebounce"),m("#containerBg"),m("#cardBg"),m("#debug","change"),m("#noOverlap","change"),m("#sizeMode","change"),m("#sizeW"),m("#sizeH"),m("#sizePreset","change"),m("#sizeOrientation","change"),r}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let r=Math.max(100,Number(this.containerFixedWidth||0)),s=Math.max(100,Number(this.containerFixedHeight||0));return{w:r,h:s}}if(this.containerSizeMode==="preset"){let r=e._sizePresets().find(p=>p.key===this.containerPreset)||e._sizePresets().find(p=>p.key==="fhd");if(!r)return{w:1920,h:1080};let s=r.w,l=r.h;return this.containerPresetOrient==="portrait"&&s>l&&([s,l]=[l,s]),this.containerPresetOrient==="landscape"&&l>s&&([s,l]=[l,s]),{w:s,h:l}}return null}_applyContainerSizingFromConfig(r=!1){var l,p;let s=this.cardContainer;if(s)if(this._isContainerFixed()){let{w:c,h}=this._resolveFixedSize();s.style.width=`${c}px`,s.style.height=`${h}px`,s.style.overflow="hidden",r||(l=this._dbgPush)==null||l.call(this,"size","Applied fixed size",{w:c,h,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else s.style.overflow="hidden",r||(p=this._dbgPush)==null||p.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let r=this.cardContainer;if(!r)return{w:0,h:0};let s=parseFloat(getComputedStyle(r).width)||r.getBoundingClientRect().width,l=parseFloat(getComputedStyle(r).height)||r.getBoundingClientRect().height;return{w:s,h:l}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:r,h:s}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(p=>{let c=parseFloat(p.getAttribute("data-x"))||0,h=parseFloat(p.getAttribute("data-y"))||0,m=parseFloat(p.style.width)||p.getBoundingClientRect().width,x=parseFloat(p.style.height)||p.getBoundingClientRect().height,b=Math.max(0,Math.min(c,Math.max(0,r-m))),_=Math.max(0,Math.min(h,Math.max(0,s-x))),k=Math.min(m,r),C=Math.min(x,s);(k!==m||C!==x)&&(p.style.width=`${k}px`,p.style.height=`${C}px`);let T=Math.max(0,Math.min(b,Math.max(0,r-k))),z=Math.max(0,Math.min(_,Math.max(0,s-C)));this._setCardPosition(p,T,z)})}_applyGridVars(){var s;let r=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",r),(s=this.cardContainer)==null||s.style.setProperty("--ddc-grid-size",r)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(r,s,l=null){let p={t:new Date().toISOString(),kind:r,msg:s,extra:l};this._dbgBuffer.push(p),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${r}]%c ${s}`,"color:#03a9f4","color:unset",l!=null?l:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(r){return String(r).replace(/[&<>"']/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[s])}setConfig(r={}){var l,p,c,h,m,x,b;r.storage_key||(this.storageKey||(this.storageKey=`layout_${((l=crypto==null?void 0:crypto.randomUUID)==null?void 0:l.call(crypto))||Date.now().toString(36)}`),r={...r,storage_key:this.storageKey});let s=this.storageKey;if(this._config=r,this.storageKey=r.storage_key,this._config=r,this.storageKey=r.storage_key||void 0,this._syncEditorsStorageKey(),this.gridSize=Number((p=r.grid)!=null?p:10),this.dragLiveSnap=!!r.drag_live_snap,this.autoSave=r.auto_save!==!1,this.autoSaveDebounce=Number((c=r.auto_save_debounce)!=null?c:800),this.containerBackground=(h=r.container_background)!=null?h:"transparent",this.cardBackground=(m=r.card_background)!=null?m:"var(--ha-card-background, var(--card-background-color))",this.debug=!!r.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!r.disable_overlap,this.containerSizeMode=r.container_size_mode||"dynamic",this.containerFixedWidth=Number((x=r.container_fixed_width)!=null?x:0)||null,this.containerFixedHeight=Number((b=r.container_fixed_height)!=null?b:0)||null,this.containerPreset=r.container_preset||"fullhd",this.containerPresetOrient=r.container_preset_orientation||"auto",this.cardContainer&&this._applyContainerSizingFromConfig(!1),this._applyGridVars(),this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:r.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let _=document.createElement("script");_.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(_)}if(!window.interact){let _=document.createElement("script");_.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",_.onload=()=>this._initInteract(),document.head.appendChild(_)}this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),this._built||(this._built=!0,this.shadowRoot.innerHTML=`
        <style>
          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            padding: 10px;
            border: 1px solid var(--divider-color);
            background: var(--ddc-bg, transparent);
            width: auto; height: auto; border-radius: 12px; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }
          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:0;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab;
            /* ensure buttons and resize handles remain visible on very small cards */
            overflow:auto;
            border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:1;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
        .chip{
            position:absolute;
            top:8px;
            right:8px;
            display:flex;
            gap:6px;
            flex-wrap:wrap;             /* allow chip buttons to wrap when space is limited */
            opacity:0;
            transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .chip .mini{
            display:inline-flex;align-items:center;gap:6px;
            background:rgba(28,28,30,.78);color:#fff;border:1px solid rgba(255,255,255,.18);
            border-radius:999px;padding:6px 10px;font-size:.76rem;cursor:pointer;letter-spacing:.2px;
            box-shadow:0 2px 6px rgba(0,0,0,.25); transition:transform .08s, background .12s, box-shadow .12s
          }
          .chip .mini:hover{transform:translateY(-1px); background:rgba(28,28,30,.95); box-shadow:0 3px 10px rgba(0,0,0,.35)}
          .chip .mini ha-icon{--mdc-icon-size:18px;width:18px;height:18px}
          .chip .mini.danger{background:rgba(220, 38, 38, .9);border-color:rgba(255,255,255,.22)}
          .chip .mini.danger:hover{background:rgba(220, 38, 38, 1)}
          .chip .mini.pill{padding:6px}

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:flex;                 /* shown in edit mode via your existing rule */
            position:absolute;
            bottom:8px;                   /* move INSIDE the wrapper bounds */
            right:8px;                    /* so it can't be clipped by overflow */
            width:28px;
            height:28px;
            border-radius:50%;
            background:var(--primary-color);
            color:#fff;
            border:1px solid rgba(255,255,255,.25);
            cursor:se-resize;
            z-index:999;                  /* above the card content */
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            align-items:center;
            justify-content:center;
          }
          .resize-handle:hover{transform:scale(1.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{--mdc-icon-size:18px;width:18px;height:18px;pointer-events:none}

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96vw);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{border-right:1px solid var(--divider-color);overflow:auto;background:var(--primary-background-color);contain:content}
          #rightPane{overflow:hidden;background:var(--primary-background-color)}
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);overflow:visible;position:relative;contain:content}
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}

          /* --- FIX: YAML editor should scroll and not overflow --- */
          #yamlSec { min-height: 0; }
          #yamlSec .bd { 
            overflow: auto;        /* allow scrolling inside the YAML section */
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec { min-height: 0; }
          #optionsSec .bd {
            overflow: auto;        /* scroll inside the Visual editor section */
            /* allow the visual editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          #editorHost { display:block; min-height: 0; }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: fixed and scroll inside */
          ha-code-editor { 
            display: block; 
            height: 260px !important; 
          }
          .CodeMirror { 
            height: 260px !important; 
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            max-height: 260px; 
            overflow: auto; 
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            display:flex;align-items:center;justify-content:center;width:100%;height:100%;
            background:repeating-conic-gradient(from 45deg, rgba(0,0,0,.05) 0% 25%, transparent 0% 50%) 50% / 14px 14px;pointer-events: none;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }
        </style>
        <div class="ddc-root">
          <div class="toolbar">
            <button class="btn" id="addCardBtn" style="display:none">
              <ha-icon icon="mdi:plus"></ha-icon>
              <span style="margin-left:6px">Add Card</span>
            </button>
            <button class="btn secondary" id="reloadBtn" style="display:none">
              <ha-icon icon="mdi:refresh"></ha-icon>
              <span style="margin-left:6px">Reload</span>
            </button>
            <button class="btn secondary" id="diagBtn" style="display:none">
              <ha-icon icon="mdi:play-circle-outline"></ha-icon>
              <span style="margin-left:6px">Diagnostics</span>
            </button>
            <button class="btn secondary" id="exportBtn" style="display:none">
              <ha-icon icon="mdi:download"></ha-icon>
              <span style="margin-left:6px">Export Design</span>
            </button>
            <button class="btn secondary" id="importBtn" style="display:none">
              <ha-icon icon="mdi:upload"></ha-icon>
              <span style="margin-left:6px">Import Design</span>
            </button>
            <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
              <ha-icon icon="mdi:storefront-outline"></ha-icon>
              <span>Open HADS</span>
            </button>
            <button class="btn warning" id="exitEditBtn" style="display:none">
              <ha-icon icon="mdi:exit-run"></ha-icon>
              <span>Exit edit mode</span>
            </button>
            <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
          </div>
          <div class="card-container" id="cardContainer"></div>
        </div>
      `,this.cardContainer=this.shadowRoot.querySelector("#cardContainer"),this.addButton=this.shadowRoot.querySelector("#addCardBtn"),this.reloadBtn=this.shadowRoot.querySelector("#reloadBtn"),this.diagBtn=this.shadowRoot.querySelector("#diagBtn"),this.exitEditBtn=this.shadowRoot.querySelector("#exitEditBtn"),this.storeBadge=this.shadowRoot.querySelector("#storeBadge"),this.exportBtn=this.shadowRoot.querySelector("#exportBtn"),this.importBtn=this.shadowRoot.querySelector("#importBtn"),this.exploreBtn=this.shadowRoot.querySelector("#exploreBtn"),this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.exploreBtn.addEventListener("click",()=>window.open("https://cardstore.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),this._installLongPressToEnterEdit(),window.addEventListener("keydown",_=>{_.key==="Escape"&&this.editMode&&this._toggleEditMode(!1)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",_=>{this.editMode&&(_.target.closest(".card-wrapper")||!_.shiftKey&&!_.ctrlKey&&!_.metaKey&&this._clearSelection())}));try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),this.__cfgReady=!0,s!==this.storageKey&&this.__booted?this._initialLoad(!0):!this.__booted&&this.__probed?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),this._resizeContainer())}connectedCallback(){this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1)}disconnectedCallback(){if(window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis),this.__lpInstalled&&this.__lpHandlers){let r=this.cardContainer;r==null||r.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),r==null||r.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}}set hass(r){var l;this._hass=r,ll("set hass"),!this.__probed&&r&&(this.__probed=!0,this._probeBackend().then(()=>{this.__probed=!0,!this.__booted&&this.__cfgReady&&(this.__booted=!0,this._initialLoad(!0))}));let s=((l=this.cardContainer)==null?void 0:l.children)||[];for(let p of s){let c=p.firstElementChild;c&&c.hass!==r&&(c.hass=r)}}get hass(){return this._hass}async _initialLoad(r=!1){var s,l,p,c,h,m,x,b,_,k,C,T,z;if(!this.__booting){this.__booting=!0;try{this._loading=!0,r&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:r});let L=[],I=null;if(this._backendOK&&this.storageKey)try{I=await this._loadLayoutFromBackend(this.storageKey)}catch(B){this._dbgPush("boot","Backend load failed",{error:String(B)})}if(!I&&this.storageKey){let B=null;try{B=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(B)if(this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(B).length}),this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,B),this._dbgPush("boot","Migrated local -> backend"),I=B}catch(ee){this._dbgPush("boot","Migration failed, staying local",{error:String(ee)}),I=B}else I=B}!I&&((l=(s=this._config)==null?void 0:s.cards)!=null&&l.length)&&(this._dbgPush("boot","Using embedded config"),I={cards:this._config.cards});let O={...this._config||{}};I!=null&&I.options?this._applyImportedOptions(I.options,!0):typeof(I==null?void 0:I.grid)=="number"&&this._applyImportedOptions({grid:I.grid},!0);let K=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation"],V={};for(let B of K)O[B]!==void 0&&(V[B]=O[B]);Object.keys(V).length&&this._applyImportedOptions(V,!0);let S=!1;if((p=I==null?void 0:I.cards)!=null&&p.length){for(let B of I.cards){if(!(B!=null&&B.card)||typeof B.card=="object"&&Object.keys(B.card).length===0){let G=this._makePlaceholderAt(((c=B.position)==null?void 0:c.x)||0,((h=B.position)==null?void 0:h.y)||0,((m=B.size)==null?void 0:m.width)||100,((x=B.size)==null?void 0:x.height)||100);this.cardContainer.appendChild(G);try{this._rebuildOnce(G.firstElementChild)}catch{}S=!0;continue}let ee=await this._createCard(B.card),Q=this._makeWrapper(ee);this.editMode&&Q.classList.add("editing"),this._setCardPosition(Q,((b=B.position)==null?void 0:b.x)||0,((_=B.position)==null?void 0:_.y)||0),Q.style.width=`${(C=(k=B.size)==null?void 0:k.width)!=null?C:14*this.gridSize}px`,Q.style.height=`${(z=(T=B.size)==null?void 0:T.height)!=null?z:10*this.gridSize}px`,B.z!=null&&(Q.style.zIndex=String(B.z)),this.cardContainer.appendChild(Q);try{this._rebuildOnce(Q.firstElementChild)}catch{}this._initCardInteract(Q),S=!0}this._resizeContainer(),this._dbgPush("boot","Layout applied",{count:I.cards.length})}S||(this._showEmptyPlaceholder(),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI(),r&&(this._cardModProcessed=!1),setTimeout(()=>{this._processCardModOnce()},100);try{L.forEach(B=>{try{B.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}})}catch{}}finally{this._loading=!1,this.__booting=!1}}}_toggleEditMode(r=null){var c,h,m,x;try{(c=this.__clearPressTimer)==null||c.call(this)}catch{}let s=r===null?!this.editMode:!!r,l=!this.editMode&&s;if(this.editMode=s,this.editMode=s,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(b=>{b.classList.toggle("editing",this.editMode);let _=b.querySelector(".resize-handle");_&&(_.style.display=this.editMode?"flex":"none"),!b.dataset.placeholder&&window.interact&&window.interact(b).draggable(this.editMode).resizable(this.editMode),b.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(h=this.cardContainer)==null||h.querySelectorAll(".card-wrapper.dragging").forEach(b=>b.classList.remove("dragging")),l){let b=(m=this.__lastHoldX)!=null?m:null,_=(x=this.__lastHoldY)!=null?x:null;this._playEditRipple(b,_)}}_isInHaEditorPreview(){let r=this;for(;r;){let s=r.nodeType===1&&r.localName?r.localName.toLowerCase():"";if(s==="hui-card-editor"||s==="hui-dialog-edit-card"||s==="hui-card-preview"||s==="ha-dialog"||s==="mwc-dialog")return!0;let l=r.getRootNode&&r.getRootNode();r=r.parentElement||l&&l.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let r=this.cardContainer;if(!r)return;let s=800,l=18,p=S=>!!S&&typeof S=="object"&&S.nodeType===1,c=(S,B)=>{try{return!!(S&&B&&typeof S.contains=="function"&&p(B)&&S.contains(B))}catch{return!1}},h=S=>c(this.cardContainer,S),m=S=>{var Q,G,oe;let B=(G=(Q=S.target)==null?void 0:Q.closest)==null?void 0:G.call(Q,".card-wrapper");if(p(B)&&h(B)&&!B.classList.contains("ddc-placeholder"))return!0;let ee=typeof S.composedPath=="function"?S.composedPath():[];for(let ue of ee)if(p(ue)&&h(ue)&&(oe=ue.classList)!=null&&oe.contains("card-wrapper")&&!ue.classList.contains("ddc-placeholder"))return!0;return!1},x=(S,B)=>{let ee=document.createElement("div");ee.className="ddc-press-ring",document.body.appendChild(ee),Object.assign(ee.style,{position:"fixed",left:`${S}px`,top:`${B}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),ee.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let Q=ee.querySelector(".pr-fg"),G=18,oe=2*Math.PI*G;return Q.style.strokeDasharray=`${oe}`,Q.style.strokeDashoffset=`${oe}`,requestAnimationFrame(()=>{Q.style.transition=`stroke-dashoffset ${s}ms linear`,Q.style.strokeDashoffset="0"}),{el:ee,move(ue,ce){ee.style.left=`${ue}px`,ee.style.top=`${ce}px`},remove(){try{ee.remove()}catch{}}}},b=null,_=null,k=0,C=0,T=null,z=()=>{b&&clearTimeout(b),b=null,_==null||_.remove(),_=null};this.__clearPressTimer=z;let L=S=>{S.pointerType==="mouse"&&S.button!==0||this._isInHaEditorPreview()||!h(S.target)||m(S)||(T=S.pointerId,k=S.clientX,C=S.clientY,this.__lastHoldX=k,this.__lastHoldY=C,_=x(k,C),b=setTimeout(()=>{var ee;z();let B=!this.editMode;this._toggleEditMode(B),(ee=this._toast)==null||ee.call(this,`Edit mode ${B?"enabled":"disabled"}`)},s))},I=S=>{b==null||S.pointerId!==T||(_==null||_.move(S.clientX,S.clientY),(Math.abs(S.clientX-k)>l||Math.abs(S.clientY-C)>l)&&z())},O=S=>{S.pointerId===T&&(z(),T=null)},K=S=>{if(b)return S.preventDefault(),S.stopPropagation(),!1},V=S=>{var ee;if(this._isInHaEditorPreview()||!h(S.target)||m(S))return;let B=!this.editMode;this._toggleEditMode(B),(ee=this._toast)==null||ee.call(this,`Edit mode ${B?"enabled":"disabled"}`)};r.addEventListener("pointerdown",L),window.addEventListener("pointermove",I,{passive:!0}),window.addEventListener("pointerup",O,{passive:!0}),window.addEventListener("pointercancel",O,{passive:!0}),window.addEventListener("contextmenu",K),r.addEventListener("dblclick",V),this.__lpHandlers={onPointerDown:L,onPointerMove:I,onPointerUpOrCancel:O,onContextMenu:K,onDblClick:V}}_isLayoutEmpty(){let r=this.cardContainer;return r?r.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let r=this._isLayoutEmpty();if(this.addButton){let l=this.editMode||r;this.addButton.style.display=l?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&r)}let s=l=>l&&(l.style.display=this.editMode?"inline-block":"none");s(this.reloadBtn),s(this.diagBtn),s(this.exitEditBtn),s(this.exportBtn),s(this.importBtn),s(this.exploreBtn),s(this.storeBadge)}_playEditRipple(r=null,s=null){let l=this.cardContainer;if(!l)return;let p=l.getBoundingClientRect(),c=r==null?p.left+p.width/2:r,h=s==null?p.top+p.height/2:s,m=c-p.left,x=h-p.top,b=document.createElement("div");b.className="ddc-ripple-veil",b.style.setProperty("--rip-x",`${m}px`),b.style.setProperty("--rip-y",`${x}px`),l.appendChild(b),setTimeout(()=>b.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(s=>this._initCardInteract(s))}_initCardInteract(r){if(!window.interact||r.dataset.placeholder)return;let s=this.gridSize,l=!!this.dragLiveSnap,c=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let h=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});c.push(window.interact.modifiers.snap({targets:[h],range:1/0,offset:"startCoords"}))}window.interact(r).draggable({enabled:this.editMode,inertia:!1,modifiers:c,listeners:{start:h=>{this._selection.has(r)||(!(h!=null&&h.shiftKey)&&!(h!=null&&h.ctrlKey)&&!(h!=null&&h.metaKey)&&this._clearSelection(),this._toggleSelection(r,!0));let m=Array.from(this._selection);this.__groupDrag={leader:r,members:m,startRaw:new Map(m.map(b=>[b,{x:parseFloat(b.getAttribute("data-x-raw"))||parseFloat(b.getAttribute("data-x"))||0,y:parseFloat(b.getAttribute("data-y-raw"))||parseFloat(b.getAttribute("data-y"))||0,w:parseFloat(b.style.width)||b.getBoundingClientRect().width,h:parseFloat(b.style.height)||b.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(b=>{let _=parseFloat(b.getAttribute("data-x-raw"))||parseFloat(b.getAttribute("data-x"))||0,k=parseFloat(b.getAttribute("data-y-raw"))||parseFloat(b.getAttribute("data-y"))||0;this.__collisionOriginals.set(b,{x:_,y:k})}),m.forEach(b=>{b.classList.add("dragging"),b.getAttribute("data-x-raw")===null&&b.setAttribute("data-x-raw",b.getAttribute("data-x")||"0"),b.getAttribute("data-y-raw")===null&&b.setAttribute("data-y-raw",b.getAttribute("data-y")||"0")})},move:h=>{if(!this.__groupDrag)return;let m=this.gridSize,x=!!this.dragLiveSnap,b=this.__groupDrag.leader,_=this.__groupDrag.startRaw.get(b),k=(parseFloat(b.getAttribute("data-x-raw"))||_.x)+h.dx,C=(parseFloat(b.getAttribute("data-y-raw"))||_.y)+h.dy,T=k-_.x,z=C-_.y,L=this.__groupDrag.members.map(I=>{let O=this.__groupDrag.startRaw.get(I),K=O.x+T,V=O.y+z,S=x?Math.round(K/m)*m:K,B=x?Math.round(V/m)*m:V;return{el:I,rawX:K,rawY:V,snapX:S,snapY:B,w:O.w,h:O.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(L,T,z,x,m),b.setAttribute("data-x-raw",String(k)),b.setAttribute("data-y-raw",String(C));for(let I of L)I.el.setAttribute("data-x-raw",String(I.rawX)),I.el.setAttribute("data-y-raw",String(I.rawY)),this._setCardPosition(I.el,I.snapX,I.snapY);this._resizeContainer()},end:h=>{if(!this.__groupDrag)return;let m=this.gridSize,x=this.__groupDrag.members.map(b=>{let _=parseFloat(b.getAttribute("data-x-raw"))||parseFloat(b.getAttribute("data-x"))||0,k=parseFloat(b.getAttribute("data-y-raw"))||parseFloat(b.getAttribute("data-y"))||0,C=Math.round(_/m)*m,T=Math.round(k/m)*m,z=parseFloat(b.style.width)||b.getBoundingClientRect().width,L=parseFloat(b.style.height)||b.getBoundingClientRect().height;return{el:b,rawX:_,rawY:k,snapX:C,snapY:T,w:z,h:L}});this.disableOverlap&&this._pushCardsOutOfTheWay(x,0,0,!1,m);for(let b of x)this._setCardPosition(b.el,b.snapX,b.snapY),b.el.setAttribute("data-x-raw",String(b.snapX)),b.el.setAttribute("data-y-raw",String(b.snapY));for(let b of this.__groupDrag.members)b.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(r).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:h=>{let m=this.gridSize,x=!!this.dragLiveSnap,b=parseFloat(r.style.width)||r.getBoundingClientRect().width,_=parseFloat(r.style.height)||r.getBoundingClientRect().height,{width:k,height:C}=h.rect,T=x?Math.max(m,Math.round(k/m)*m):k,z=x?Math.max(m,Math.round(C/m)*m):C,L=parseFloat(r.getAttribute("data-x"))||0,I=parseFloat(r.getAttribute("data-y"))||0,O=T,K=z;if(this._isContainerFixed()){let{w:S,h:B}=this._getContainerSize();O=Math.min(T,Math.max(this.gridSize,S-L)),K=Math.min(z,Math.max(this.gridSize,B-I))}let V=[this._rectFor(r,L,I,O,K)];this.disableOverlap&&this._anyCollisionFor(V,new Set([r]))||(r.style.width=`${O}px`,r.style.height=`${K}px`,this._resizeContainer())},end:()=>{let h=this.gridSize,m=parseFloat(r.style.width)||r.getBoundingClientRect().width,x=parseFloat(r.style.height)||r.getBoundingClientRect().height,b=Math.max(h,Math.round(m/h)*h),_=Math.max(h,Math.round(x/h)*h),k=parseFloat(r.getAttribute("data-x"))||0,C=parseFloat(r.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:z,h:L}=this._getContainerSize();b=Math.min(b,Math.max(h,z-k)),_=Math.min(_,Math.max(h,L-C))}let T=[this._rectFor(r,k,C,b,_)];this.disableOverlap&&this._anyCollisionFor(T,new Set([r]))||(r.style.width=`${b}px`,r.style.height=`${_}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),r.addEventListener("mousedown",h=>{this.editMode&&(h.target.closest(".resize-handle")||h.target.closest(".chip")||(h.shiftKey||h.ctrlKey||h.metaKey?(h.stopPropagation(),this._toggleSelection(r)):this._selection.has(r)||(this._clearSelection(),this._toggleSelection(r,!0))))})}async _createCard(r){let l=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(r);if(l.hass=this.hass,r.type==="custom:mod-card"&&(await new Promise(p=>setTimeout(p,0)),l.setConfig&&typeof l.setConfig=="function"))try{l.setConfig(r)}catch{}return l}_makeWrapper(r){let s=document.createElement("div");s.classList.add("card-wrapper"),this.editMode&&s.classList.add("editing"),s.style.zIndex||(s.style.zIndex=String(this._highestZ()+1));let l=document.createElement("div");l.className="chip",l.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini danger pill" data-act="delete" title="Delete card" aria-label="Delete card">
        <ha-icon icon="mdi:close-thick"></ha-icon>
      </button>
    `,l.addEventListener("click",async h=>{var x,b,_;h.stopPropagation();let m=(_=(b=(x=h.target)==null?void 0:x.closest("button"))==null?void 0:b.dataset)==null?void 0:_.act;if(m){if(m==="delete")this._selection.size>1&&this._selection.has(s)?(Array.from(this._selection).forEach(C=>C.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(s.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(m==="duplicate"||m==="copy"){let k=this._selection.size>1&&this._selection.has(s)?Array.from(this._selection):[s];for(let C of k){let T=this._extractCardConfig(C.firstElementChild)||{},z=await this._createCard(T),L=this._makeWrapper(z);L.style.width=C.style.width,L.style.height=C.style.height;let I=(parseFloat(C.getAttribute("data-x"))||0)+this.gridSize,O=(parseFloat(C.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(L,I,O),L.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(L);try{this._rebuildOnce(L.firstElementChild)}catch{}this._initCardInteract(L)}this._resizeContainer(),this._queueSave("duplicate")}else if(m==="front")this._adjustZ(s,1);else if(m==="back")this._adjustZ(s,-1);else if(m==="edit"){let k=this._extractCardConfig(s.firstElementChild)||{};await this._openSmartPicker("edit",k,async C=>{let T=await this._createCard(C);T.hass=this.hass;try{s.dataset.cfg=JSON.stringify(C)}catch{}s.replaceChild(T,s.firstElementChild);try{this._rebuildOnce(T)}catch{}this._queueSave("edit")})}}});let p=document.createElement("div");p.className="shield";let c=document.createElement("div");c.classList.add("resize-handle"),c.title="Resize",c.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>';try{let h=r._config||r.config;h&&typeof h=="object"&&Object.keys(h).length&&(s.dataset.cfg=JSON.stringify(h),this._hasCardModDeep(h)&&(s.dataset.needsCardMod="true"))}catch{}s.append(r,p,l,c);try{this._rebuildOnce(r)}catch{}return s}_makePlaceholderAt(r=0,s=0,l=100,p=100){let c=document.createElement("div");c.classList.add("card-wrapper","ddc-placeholder"),c.dataset.placeholder="1",this.editMode&&c.classList.add("editing"),this._setCardPosition(c,r,s),c.style.width=`${l}px`,c.style.height=`${p}px`,c.style.zIndex=String(this._highestZ()+1);let h=document.createElement("div");h.className="ddc-placeholder-inner",h.setAttribute("aria-hidden","true");let m=document.createElement("div");return m.className="shield",c.append(h,m),c}_processCardModOnce(){var s;if(this._cardModProcessed)return;this._cardModProcessed=!0,(((s=this.cardContainer)==null?void 0:s.querySelectorAll('[data-needs-card-mod="true"]'))||[]).forEach(l=>{let p=l.firstElementChild;if(!p)return;let c=p._config||p.config;if(c){if(c.type==="custom:mod-card")setTimeout(()=>{if(p.updateComplete)p.updateComplete.then(()=>{p.requestUpdate()});else if(p.setConfig)try{p.setConfig({...c})}catch{}},100);else if(c.card_mod&&p.setConfig)try{p.setConfig({...c})}catch{}}})}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let r=this._makePlaceholderAt(0,0,100,100);this.cardContainer.appendChild(r),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(r=>r.remove())}_ensurePlaceholderIfEmpty(){this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),this._syncEmptyStateUI()}_adjustZ(r,s){let p=parseInt(r.style.zIndex||"1",10)+s;p=Math.max(1,Math.min(9999,p)),r.style.zIndex=String(p),this._queueSave("z-change")}_highestZ(){let r=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(s=>{let l=parseInt(s.style.zIndex||"0",10);l>r&&(r=l)}),r}_setCardPosition(r,s,l){let p=Math.round(s),c=Math.round(l);r.style.transform=`translate3d(${p}px, ${c}px, 0)`,r.setAttribute("data-x",String(p)),r.setAttribute("data-y",String(c)),r.setAttribute("data-x-raw",String(p)),r.setAttribute("data-y-raw",String(c))}_resizeContainer(){let r=this.cardContainer;if(!r||this._isContainerFixed())return;let s=Array.from(r.querySelectorAll(".card-wrapper")),l=0,p=0;s.forEach(c=>{let h=c.getBoundingClientRect(),m=r.getBoundingClientRect(),x=h.left-m.left+h.width,b=h.top-m.top+h.height;l=Math.max(l,x),p=Math.max(p,b)}),r.style.width=`${Math.ceil(l/this.gridSize)*this.gridSize||100}px`,r.style.height=`${Math.ceil(p/this.gridSize)*this.gridSize||100}px`}_pushCardsOutOfTheWay(r,s,l,p,c){if(!this.__collisionOriginals)return;let h=new Set(r.map(O=>O.el)),m=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(O=>!O.dataset.placeholder),x=this._isContainerFixed(),{w:b,h:_}=this._getContainerSize();for(let O of m){if(h.has(O))continue;let K=this.__collisionOriginals.get(O);if(K){O.setAttribute("data-x-raw",String(K.x)),O.setAttribute("data-y-raw",String(K.y));let V=p?Math.round(K.x/c)*c:K.x,S=p?Math.round(K.y/c)*c:K.y;this._setCardPosition(O,V,S)}}let k=r.map(O=>({x:O.snapX,y:O.snapY,w:O.w,h:O.h})),C=new Map,T=new Map;for(let O of m){let K=parseFloat(O.style.width)||O.getBoundingClientRect().width,V=parseFloat(O.style.height)||O.getBoundingClientRect().height;T.set(O,{w:K,h:V})}let z=s>0?1:s<0?-1:0,L=l>0?1:l<0?-1:0,I=Math.abs(s)>=Math.abs(l);for(let O of m){if(h.has(O))continue;let K=this.__collisionOriginals.get(O);if(!K)continue;let{x:V,y:S}=K,{w:B,h:ee}=T.get(O),Q=!1;for(let G of k)if(this._rectsOverlap({x:G.x,y:G.y,w:G.w,h:G.h},{x:V,y:S,w:B,h:ee})){Q=!0,I&&z!==0?V=z>0?G.x+G.w:G.x-B:!I&&L!==0?S=L>0?G.y+G.h:G.y-ee:V=G.x+G.w;break}if(Q){let G=0,oe=I?z!==0?z*c:c:0,ue=I?0:L!==0?L*c:c;for(;G<100;){let ce={x:V,y:S,w:B,h:ee},ye=!1;for(let we of k)if(this._rectsOverlap(ce,we)){ye=!0;break}if(!ye){for(let[,we]of C)if(this._rectsOverlap(ce,we)){ye=!0;break}}if(!ye&&x&&(V<0||S<0||V+B>b||S+ee>_)&&(ye=!0),!ye)break;V+=oe,S+=ue,G++}x&&(V=Math.max(0,Math.min(V,Math.max(0,b-B))),S=Math.max(0,Math.min(S,Math.max(0,_-ee))))}C.set(O,{x:V,y:S,w:B,h:ee}),k.push({x:V,y:S,w:B,h:ee})}for(let[O,K]of C){O.setAttribute("data-x-raw",String(K.x)),O.setAttribute("data-y-raw",String(K.y));let V=p?Math.round(K.x/c)*c:K.x,S=p?Math.round(K.y/c)*c:K.y;this._setCardPosition(O,V,S)}}_rectFor(r,s=null,l=null,p=null,c=null){let h=s!=null?s:parseFloat(r.getAttribute("data-x"))||0,m=l!=null?l:parseFloat(r.getAttribute("data-y"))||0,x=p!=null?p:parseFloat(r.style.width)||r.getBoundingClientRect().width||0,b=c!=null?c:parseFloat(r.style.height)||r.getBoundingClientRect().height||0;return{x:h,y:m,w:x,h:b,el:r}}_rectsOverlap(r,s,l=.5){return!(r.x+r.w<=s.x+l||s.x+s.w<=r.x+l||r.y+r.h<=s.y+l||s.y+s.h<=r.y+l)}_anyCollisionFor(r,s){let l=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(c=>!s.has(c)&&!c.dataset.placeholder);if(!l.length)return!1;let p=l.map(c=>this._rectFor(c));for(let c of r)for(let h of p)if(this._rectsOverlap(c,h))return!0;return!1}_extractCardConfig(r){var l;if(!r)return{};let s=r._config||r.config;if(s&&typeof s=="object"&&Object.keys(s).length)return s;try{let p=r.closest?r.closest(".card-wrapper"):null,c=(l=p==null?void 0:p.dataset)==null?void 0:l.cfg;if(c){let h=JSON.parse(c);if(h&&typeof h=="object")return h}}catch{}return{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(r,s){try{console.info("[ddc:editor] Requesting editor element",{type:r,cfg:s})}catch{}let l=await this._helpersPromise||await window.loadCardHelpers();try{typeof r=="string"&&r&&!r.startsWith("custom:")&&r!=="custom_card"&&await this._ensureCardModuleLoaded(r,s)}catch{}let p=async()=>{try{if(l.getCardElementClass)return await l.getCardElementClass(r);let b;if(s&&typeof s=="object")b={type:r,...s};else{let k;try{k=await this._getStubConfigForType(r)}catch{}b=k&&typeof k=="object"?{...k}:{type:r}}let _=l.createCardElement(b);return(_==null?void 0:_.constructor)||null}catch{return null}};try{let b=await p();if(b&&typeof b.getConfigElement=="function"){let _=await b.getConfigElement();if(_){try{console.info("[ddc:editor] Found static class editor",{type:r})}catch{}return _}}}catch{}if(typeof r=="string"&&(r.startsWith("custom:")||r==="custom_card"||r==="entity"))try{let b;try{b=await this._getStubConfigForType(r)}catch{}let _=b&&typeof b=="object"?{...b}:{type:r},k=l.createCardElement(_);if(k.hass=this.hass,typeof k.getConfigElement=="function"){let C=await k.getConfigElement();if(C){try{console.info("[ddc:editor] Found instance-level editor",{type:r})}catch{}return C}}}catch{}let c=String(r).replace(/^custom:/,""),m=(Array.isArray(window.customCards)?window.customCards:[]).find(b=>(b==null?void 0:b.type)===c||(b==null?void 0:b.type)===r||(b==null?void 0:b.type)===`custom:${c}`),x=[];m!=null&&m.editor&&x.push(m.editor),x.push(`${c}-editor`,`${c}-config-editor`),c&&typeof c=="string"&&x.push(`hui-${c}-card-editor`);for(let b of x)if(!(!b||typeof b!="string"))for(let _ of[0,100,300,700,1500,3e3])try{if(customElements.get(b)||await Promise.race([customElements.whenDefined(b),new Promise(k=>setTimeout(k,_))]),customElements.get(b)){try{console.info("[ddc:editor] Found editor by tag",{type:r,tag:b})}catch{}return document.createElement(b)}}catch{}return null}async _ensureCardModuleLoaded(r,s){try{let l=await this._helpersPromise||await window.loadCardHelpers(),p;if(s&&typeof s=="object")p={type:r,...s};else{let m;try{m=await this._getStubConfigForType(r)}catch{}p=m&&typeof m=="object"?{...m}:{type:r}}let c=l.createCardElement(p);c.hass=this.hass;let h=document.createElement("div");h.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;",h.appendChild(c),document.body.appendChild(h),await new Promise(m=>requestAnimationFrame(m)),h.remove();try{console.info("[ddc:editor] Warmed card module",{type:r})}catch{}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let r=document.createElement("style");r.setAttribute("data-ddc-overlay-fix",""),r.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(r)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(s=>{var l;return{type:(l=s==null?void 0:s.type)!=null&&l.startsWith("custom:")?s.type:`custom:${s==null?void 0:s.type}`,name:(s==null?void 0:s.name)||(s==null?void 0:s.type)||"Custom card",icon:"mdi:puzzle-outline",description:(s==null?void 0:s.description)||"",editorTag:(s==null?void 0:s.editor)||null}}).filter(s=>typeof s.type=="string"&&s.type.startsWith("custom:"))}_schemaForType(r){let s=p=>p,l=[];return{entities:s({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities"}]}),entity:s({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity"}]}),sensor:s({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:s({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":s({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":s({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:s({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities (multiselect)"}]}),"picture-glance":s({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":s({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":s({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:s({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":s({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:s({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:s({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":s({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:s({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:s({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity"}]}),button:s({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity (optional)"}]}),iframe:s({fields:[{key:"url",type:"text",label:"URL"}]}),area:s({fields:[{key:"area",type:"text",label:"Area ID"}]})}[r]||{fields:[]}}_shapeBySchema(r,s={}){let l=this._schemaForType(r)||{fields:[]},p={...s,type:r};for(let c of l.fields){let h=p[c.key];if(c.type==="entities"){let x=(Array.isArray(h)?h:h!=null&&h!==""?[h]:[]).filter(Boolean);x.length?p[c.key]=x:delete p[c.key]}else if(c.type==="entity")Array.isArray(h)&&(h=h[0]),h==null||h===""?delete p[c.key]:p[c.key]=String(h);else if(c.type==="number")if(h==null||h==="")delete p[c.key];else{let m=Number(h);Number.isFinite(m)?p[c.key]=m:delete p[c.key]}else(c.type==="select"||c.type==="text"||c.type==="textarea")&&(h==null||h===""?delete p[c.key]:p[c.key]=h)}return p}_statesList(r){var p;let s=Object.keys(((p=this.hass)==null?void 0:p.states)||{});if(!r||!r.length)return s;if(!this.__domainIndex||this.__domainIndex._gen!==s.length){let c={};for(let h of s){let m=h.split(".")[0];(c[m]||(c[m]=[])).push(h)}this.__domainIndex={_gen:s.length,map:c}}let l=[];for(let c of r)this.__domainIndex.map[c]&&l.push(...this.__domainIndex.map[c]);return l}_isNumericEntity(r){var p,c;let s=(c=(p=this.hass)==null?void 0:p.states)==null?void 0:c[r];if(!s)return!1;let l=Number(s.state);return Number.isFinite(l)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(r){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(r)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(r){try{let s=this._getRecent().filter(l=>l!==r);s.unshift(r),s.length>10&&(s.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(s))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let r=document.createElement("link");r.rel="stylesheet",r.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",r.setAttribute("data-cm-core",""),document.head.appendChild(r)}await new Promise(r=>{if(window.CodeMirror)return r();let s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",s.onload=r,document.head.appendChild(s)}),await new Promise(r=>{var l,p;if((p=(l=window.CodeMirror)==null?void 0:l.mimeModes)!=null&&p.yaml)return r();let s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",s.onload=r,document.head.appendChild(s)}),this.__cmReady=!0}}async _mountYamlEditor(r,s,l,p){let c=x=>window.jsyaml?window.jsyaml.dump(x):JSON.stringify(x,null,2),h=x=>window.jsyaml?window.jsyaml.load(x):JSON.parse(x);r.innerHTML="";let m=c(s);if(customElements.get("ha-code-editor")){let x=document.createElement("ha-code-editor");x.mode="yaml",x.hass=this.hass,x.value=m,x.style.display="block",x.style.height="260px",r.appendChild(x);let b=!1;return x.addEventListener("value-changed",_=>{var C,T,z;if(b)return;let k=(z=(T=(C=_.detail)==null?void 0:C.value)!=null?T:x.value)!=null?z:"";try{l(h(k))}catch(L){p==null||p(L)}}),{setValue:_=>{var C;let k=c(_);((C=x.value)!=null?C:"")!==k&&(b=!0,x.value=k,b=!1)}}}try{await this._ensureCodeMirror();let x=window.CodeMirror(r,{value:m,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),b=!1;return x.on("change",()=>{if(b)return;let _=x.getValue();try{l(h(_))}catch(k){p==null||p(k)}}),{setValue:_=>{let k=c(_);x.getValue()!==k&&(b=!0,x.setValue(k),b=!1)}}}catch{let x=document.createElement("textarea");return x.style.width="100%",x.style.height="260px",x.value=m,x.addEventListener("input",()=>{try{l(h(x.value))}catch(b){p==null||p(b)}}),r.appendChild(x),{setValue:b=>{let _=c(b);x.value!==_&&(x.value=_)}}}}_createVirtualList({container:r,items:s,rowHeight:l=36,renderRow:p}){r.style.position="relative",r.style.overflow="auto";let c=document.createElement("div");c.style.height=`${s.length*l}px`,r.innerHTML="",r.appendChild(c);let h=new Map,m=()=>{let x=r.scrollTop,b=r.clientHeight,_=Math.max(0,Math.floor(x/l)-6),k=Math.min(s.length-1,Math.ceil((x+b)/l)+6);for(let[C,T]of h)(C<_||C>k)&&(T.remove(),h.delete(C));for(let C=_;C<=k;C++){if(h.has(C))continue;let T=p(s[C],C);T.style.position="absolute",T.style.left="0",T.style.right="0",T.style.top=`${C*l}px`,h.set(C,T),r.appendChild(T)}};return r.addEventListener("scroll",m,{passive:!0}),new ResizeObserver(m).observe(r),m(),{refresh(x){if(x){s=x,c.style.height=`${s.length*l}px`;for(let[,b]of h)b.remove();h.clear()}m()}}}async _openSmartPicker(r="add",s=null,l=null){let p=()=>c.remove(),c=document.createElement("div");c.className="modal",c.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${r==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${r==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${r==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.shadowRoot.appendChild(c);let h=c.querySelector("#leftPane"),m=c.querySelector("#addBtn"),x=c.querySelector("#footAdd"),b=c.querySelector("#cancelBtn"),_=c.querySelector("#footCancel"),k=c.querySelector("#search"),C=c.querySelector("#cardHost"),T=c.querySelector("#editorHost"),z=c.querySelector("#editorSpin"),L=c.querySelector("#quickFill"),I=c.querySelector("#yamlHost"),O=c.querySelector("#yamlErr"),K=c.querySelector("#yamlSec"),V=c.querySelector("#tabVisual"),S=c.querySelector("#tabYaml"),B=c.querySelector("#err"),ee=c.querySelector("#previewSpin"),Q=D=>{m.disabled=x.disabled=!D},G=D=>{D?(B.hidden=!1,B.textContent=D):(B.hidden=!0,B.textContent="")},oe=this._getFaves(),ue=this._getRecent(),ce=this._catalog(),ye=ce.find(D=>D.id==="favorites"),we=ce.find(D=>D.id==="recent"),Ye=ce.flatMap(D=>D.items||[]);ye.items=Ye.filter(D=>oe.has(D.type)),we.items=ue.map(D=>Ye.find(R=>R.type===D)).filter(Boolean);let It=this._customCardsFromRegistry();It.length&&ce.push({id:"custom",name:"Custom (installed)",items:It});let je=c.querySelector("#quickFillSec");je&&(je.style.display="none");let $e=c.querySelector("#optionsSec"),gt=c.querySelector("#yamlSec");$e&&($e.style.gridRow="1"),gt&&(gt.style.gridRow="2");let Xe=c.querySelector("#optionsSec .hd"),qe,He,mt=()=>{if(!He)return;let D=ve&&oe.has(ve),R=He.querySelector("ha-icon");R&&R.setAttribute("icon",D?"mdi:star":"mdi:star-outline")},vt=D=>{if(qe){let R=Ye.find(ae=>ae.type===D),ie=R?R.name:D||"";qe.textContent=ie}mt()};if(Xe&&!Xe.querySelector(".sel-info")){let D=Xe.querySelector("span");D&&(D.style.display="none"),qe=document.createElement("span"),qe.className="sel-info",qe.style.flex="1",qe.style.fontWeight="bold",qe.style.paddingRight="8px",Xe.insertBefore(qe,Xe.firstChild),He=document.createElement("button"),He.className="icon-btn",He.setAttribute("title","Favorite"),Object.assign(He.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--primary-background-color)",padding:"0",marginLeft:"4px",cursor:"pointer"}),He.innerHTML='<ha-icon icon="mdi:star-outline"></ha-icon>',Xe.appendChild(He),He.addEventListener("click",R=>{R.stopPropagation(),ve&&(oe.has(ve)?oe.delete(ve):oe.add(ve),this._setFaves(oe),mt(),yt())})}let lt="visual",Ue=D=>{let R=D==="yaml";V.classList.toggle("active",!R),V.setAttribute("aria-selected",String(!R)),S.classList.toggle("active",R),S.setAttribute("aria-selected",String(R)),T.parentElement.style.display=R?"none":"",K.style.display=R?"":"none",R&&K.scrollIntoView({behavior:"smooth",block:"start"}),lt=R?"yaml":"visual"};V.addEventListener("click",async()=>{var D;if(Ue("visual"),!de)await xt(U);else try{(D=de.setConfig)==null||D.call(de,U)}catch{}}),S.addEventListener("click",()=>Ue("yaml")),Ue("yaml");let Y=()=>{let D=k.value.trim().toLowerCase();return ce.map(R=>({...R,items:(R.items||[]).filter(ie=>!D||ie.name.toLowerCase().includes(D)||ie.type.toLowerCase().includes(D))})).filter(R=>R.items&&R.items.length||R.id==="favorites"||R.id==="recent")},yt=()=>{let D=Y();h.innerHTML="",D.forEach(R=>{let ie=document.createElement("div");ie.style.padding="12px",ie.style.borderBottom="1px solid var(--divider-color)";let ae=document.createElement("h4");if(ae.textContent=R.name,ae.style.margin="0 0 10px 0",ae.style.fontSize=".92rem",ae.style.opacity=".85",ie.appendChild(ae),!R.items.length&&(R.id==="favorites"||R.id==="recent")){let le=document.createElement("div");le.style.opacity=".6",le.style.fontSize=".85rem",le.textContent=R.id==="favorites"?"No favorites yet.":"No recent items yet.",ie.appendChild(le)}else R.items.forEach(le=>{let me=document.createElement("button");me.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${le.icon}"></ha-icon><span>${le.name}</span>
            </span>`,Object.assign(me.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),me.addEventListener("click",async()=>{ct(me),await tt(le.type)}),ie.appendChild(me)});h.appendChild(ie)})},ct=D=>{h.querySelectorAll("button").forEach(R=>{R.classList.remove("active"),R.style.background="transparent",R.style.color=""}),D&&(D.classList.add("active"),D.style.background="rgba(3,169,244,.12)",D.style.color="var(--primary-color)")},U=null,ve=null,se=null,de=null,Ce=0,bt=null,et="",Ft=(D,R)=>{var Se;let ie=this._schemaForType(D);if(L.innerHTML="",!ie.fields.length){L.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let ae=Object.keys(((Se=this.hass)==null?void 0:Se.states)||{}),le=document.createElement("div"),me=(q,pe,_e,Ae)=>{let he=document.createElement("div");Object.assign(he.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),he.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${q}</span>`,pe.includes(q)&&(he.style.background="rgba(3,169,244,.12)",he.style.borderColor="var(--primary-color)",he.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),he.addEventListener("click",async()=>{let ze=pe.indexOf(q);ze>=0?pe.splice(ze,1):pe.push(q);let Ge=pe.includes(q);he.style.background=Ge?"rgba(3,169,244,.12)":"",he.style.borderColor=Ge?"var(--primary-color)":"var(--divider-color)",he.querySelector("ha-icon").setAttribute("icon",Ge?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),U=this._shapeBySchema(D,{...U,[Ae]:[...pe]}),Me(U),se==null||se.setValue(U)}),_e.appendChild(he)};ie.fields.forEach(q=>{var Ae,he,ze,Ge,wt,Lt,St,kt,zt;let pe=document.createElement("div");Object.assign(pe.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let _e=document.createElement("label");if(_e.textContent=q.label||q.key,_e.style.minWidth="130px",q.type==="entities"){let re=document.createElement("div");re.style.flex="1";let te=document.createElement("input");Object.assign(te,{placeholder:"Filter entities\u2026"}),Object.assign(te.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let fe=document.createElement("div");Object.assign(fe.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let Pe=q.domains&&q.domains.length?this._statesList(q.domains):ae,Be=Array.isArray(R[q.key])?[...R[q.key]]:R[q.key]?[R[q.key]]:[],Et=ke=>{let Oe=document.createElement("div");Object.assign(Oe.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let De=document.createElement("ha-icon");De.setAttribute("icon","mdi:checkbox-blank-outline"),De.style.setProperty("--mdc-icon-size","18px");let dt=document.createElement("span");dt.textContent=ke,dt.style.whiteSpace="nowrap",dt.style.overflow="hidden",dt.style.textOverflow="ellipsis",Oe.append(De,dt);let Vt=()=>{let Je=Be.includes(ke);Oe.style.background=Je?"rgba(3,169,244,.12)":"",Oe.style.borderColor=Je?"var(--primary-color)":"var(--divider-color)",De.setAttribute("icon",Je?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return Vt(),Oe.addEventListener("click",()=>{let Je=Be.indexOf(ke);Je>=0?Be.splice(Je,1):Be.push(ke),U=this._shapeBySchema(D,{...U,[q.key]:[...Be]}),Me(U),se==null||se.setValue(U),Vt()}),Oe},Ct=Pe;this._createVirtualList({container:fe,items:Ct,rowHeight:36,renderRow:Et}),te.addEventListener("input",()=>{let ke=te.value.trim().toLowerCase();Ct=Pe.filter(Oe=>!ke||Oe.toLowerCase().includes(ke)),this._createVirtualList({container:fe,items:Ct,rowHeight:36,renderRow:Et})}),re.append(te,fe),pe.append(_e,re),U=this._shapeBySchema(D,{...R,[q.key]:Be})}if(q.type==="entity"){let re=document.createElement("div");re.style.flex="1",re.style.position="relative";let te=document.createElement("input");te.setAttribute("list","ddc_entlist_"+q.key),Object.assign(te.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),te.placeholder=`Select ${((Ae=q.label)==null?void 0:Ae.toLowerCase())||"entity"}\u2026`;let fe=document.createElement("ha-icon");fe.setAttribute("icon","mdi:magnify"),Object.assign(fe.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let Pe=document.createElement("datalist");Pe.id="ddc_entlist_"+q.key;let Be=q.domains&&q.domains.length?this._statesList(q.domains):Object.keys(((he=this.hass)==null?void 0:he.states)||{});Pe.innerHTML=Be.map(Et=>`<option value="${Et}">`).join(""),te.value=Array.isArray(R[q.key])?R[q.key][0]||"":R[q.key]||"",te.addEventListener("change",async()=>{U=this._shapeBySchema(D,{...U,[q.key]:te.value||void 0}),Me(U),se==null||se.setValue(U)}),re.append(fe,te,Pe),pe.append(_e,re)}if(q.type==="number"){let re=document.createElement("div");re.style.flex="1",re.style.position="relative";let te=document.createElement("input");te.type="number",q.step&&(te.step=q.step),Object.assign(te.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let fe=document.createElement("ha-icon");fe.setAttribute("icon","mdi:counter"),Object.assign(fe.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),te.value=(Ge=(ze=R[q.key])!=null?ze:q.default)!=null?Ge:"",te.addEventListener("input",async()=>{let Pe=te.value===""?void 0:Number(te.value);U=this._shapeBySchema(D,{...U,[q.key]:isNaN(Pe)?void 0:Pe}),Me(U),se==null||se.setValue(U)}),re.append(fe,te),pe.append(_e,re)}if(q.type==="select"){let re=document.createElement("div");re.style.flex="1",re.style.position="relative";let te=document.createElement("select");Object.assign(te.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let fe=document.createElement("ha-icon");fe.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(fe.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(q.options||[]).forEach(Pe=>{let Be=document.createElement("option");Be.value=Pe,te.appendChild(Be)}),te.value=(St=(wt=R[q.key])!=null?wt:q.default)!=null?St:((Lt=q.options)==null?void 0:Lt[0])||"",te.addEventListener("change",async()=>{U=this._shapeBySchema(D,{...U,[q.key]:te.value}),Me(U),se==null||se.setValue(U)}),re.append(fe,te),pe.append(_e,re)}if(q.type==="text"){let re=document.createElement("div");re.style.flex="1",re.style.position="relative";let te=document.createElement("input");te.type="text",Object.assign(te.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let fe=document.createElement("ha-icon");fe.setAttribute("icon","mdi:text"),Object.assign(fe.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),te.value=(kt=R[q.key])!=null?kt:"",te.addEventListener("input",async()=>{U=this._shapeBySchema(D,{...U,[q.key]:te.value||void 0}),Me(U),se==null||se.setValue(U)}),re.append(fe,te),pe.append(_e,re)}if(q.type==="textarea"){let re=document.createElement("textarea");Object.assign(re.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),re.value=(zt=R[q.key])!=null?zt:"",re.addEventListener("input",async()=>{U=this._shapeBySchema(D,{...U,[q.key]:re.value||""}),Me(U),se==null||se.setValue(U)}),pe.append(_e,re)}le.appendChild(pe)}),L.innerHTML="",L.appendChild(le)},Me=D=>{let R=JSON.stringify(D||{});R!==et&&(et=R,bt&&clearTimeout(bt),bt=setTimeout(async()=>{let ie=++Ce;ee.hidden=!1,C.innerHTML="",await Sr();try{let ae=await this._helpersPromise||await window.loadCardHelpers();if(ie!==Ce)return;let le=ae.createCardElement(D);if(le.hass=this.hass,ie!==Ce)return;C.appendChild(le)}catch{}finally{ie===Ce&&(ee.hidden=!0)}},150))},xt=async D=>{var le;let R=++Ce;if(z.hidden=!1,T.innerHTML="",await cl(),R!==Ce)return z.hidden=!0,!1;let ie=D.type||ve,ae=await this._getEditorElementForType(ie,D);if(!ae){await this._ensureCardModuleLoaded(ie,D);for(let me of[0,120,250,500,900,2e3,4e3])if(me&&await new Promise(Se=>setTimeout(Se,me)),ae=await this._getEditorElementForType(ie,D),ae)break}if(!ae){let me=document.createElement("div");return me.style.opacity=".7",me.style.fontSize=".9rem",me.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",R===Ce&&(T.appendChild(me),z.hidden=!0),de=null,Q(!0),lt!=="visual"&&Ue("yaml"),!1}try{ae.hass=this.hass,ae.isConnected||T.appendChild(ae),await Promise.resolve();try{ae.setConfig(D)}catch{}try{let Se=await this._helpersPromise||await window.loadCardHelpers(),q=Se.getCardElementClass?await Se.getCardElementClass(D.type||ve):null;if(q!=null&&q.getStubConfig){let pe=Object.keys(((le=this.hass)==null?void 0:le.states)||{}),_e=he=>pe.filter(ze=>ze.startsWith(he+".")),Ae=await q.getStubConfig(this.hass,pe,_e);Ae&&(D=this._shapeBySchema(D.type||ve,{...Ae}))}}catch{}await Promise.resolve();try{ae.setConfig(D)}catch{}de&&this.__onEditorChange&&(de.removeEventListener("config-changed",this.__onEditorChange),de.removeEventListener("value-changed",this.__onEditorChange));let me=async Se=>{var _e,Ae,he;let q=(he=(_e=Se.detail)==null?void 0:_e.config)!=null?he:(Ae=Se.detail)==null?void 0:Ae.value;if(!q)return;let pe=q.type||ve;ve=pe,U=this._shapeBySchema(pe,q),G(""),Q(!0),Ft(ve,U),Me(U),se==null||se.setValue(U)};return this.__onEditorChange=me,ae.addEventListener("config-changed",me),ae.addEventListener("value-changed",me),de=ae,lt!=="yaml"&&Ue("visual"),Q(!0),!0}finally{R===Ce&&(z.hidden=!0)}},Wt=async D=>{se=await this._mountYamlEditor(I,D,async R=>{var ie,ae;try{let le=(R==null?void 0:R.type)||ve,me=this._shapeBySchema(le,R||{}),Se=le!==ve;if(ve=le,U=me,O.hidden=!0,O.textContent="",Q(!0),Se){if(Ft(ve,U),de){try{(ie=de.setConfig)==null||ie.call(de,U)}catch{}lt!=="yaml"&&Ue("visual")}}else{try{(ae=de==null?void 0:de.setConfig)==null||ae.call(de,U)}catch{}Me(U)}}catch(le){O.hidden=!1,O.textContent=`Invalid config: ${String((le==null?void 0:le.message)||le)}`,Q(!1)}},R=>{O.hidden=!1,O.textContent=`Invalid YAML: ${String((R==null?void 0:R.message)||R)}`,Q(!1)})},Xt=async D=>{if(this.__stubCache.has(D))return{...this.__stubCache.get(D)};let R=await this._getStubConfigForType(D);return this.__stubCache.set(D,{...R}),{...R}},tt=async D=>{O.hidden=!0,O.textContent="",G(""),ve=D;try{typeof vt=="function"&&vt(D)}catch{}let R=r==="edit"&&s&&s.type===D?{...s}:await Xt(D);U=this._shapeBySchema(D,R),de=null,Ft(D,U),await Wt(U),await Sr(),Me(U),Ue("yaml"),Q(!0)},_t=async()=>{if(!U)return;let D=this._shapeBySchema(ve,U);r==="edit"&&typeof l=="function"?await l(D):(await this._addPickedCardToLayout(D),this._pushRecent((D||{}).type)),p()};b.addEventListener("click",p),_.addEventListener("click",p),m.addEventListener("click",_t),x.addEventListener("click",_t),c.addEventListener("keydown",D=>{D.key==="Escape"&&p(),D.key==="Enter"&&!m.disabled&&_t()});let Ve=null;k.addEventListener("input",()=>{Ve&&clearTimeout(Ve),Ve=setTimeout(yt,120)}),yt(),await tt((()=>{var ie;return(((ie=this._getRecent)==null?void 0:ie.call(this))||[]).find(Boolean)||"entities"})()),Q(!0),r==="edit"&&s&&(await tt(s.type||"entities"),Q(!0))}async _getStubConfigForType(r){var b;let s=await this._helpersPromise||await window.loadCardHelpers(),l=null;if(r==="custom_card")return{type:"custom_card"};try{s.getCardElementClass&&(l=await s.getCardElementClass(r))}catch{}let p=Object.keys(((b=this.hass)==null?void 0:b.states)||{}),c=_=>p.filter(k=>k.startsWith(_+"."));if(l!=null&&l.getStubConfig)try{return await l.getStubConfig(this.hass,p,c)}catch{}let h={type:r},m=p[0],x=c("sensor")[0]||m;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast","map"].includes(r)){let _={sensor:x,gauge:c("sensor").find(this._isNumericEntity.bind(this))||x,"media-control":c("media_player")[0]||m,light:c("light")[0]||m,thermostat:c("climate")[0]||m,"alarm-panel":c("alarm_control_panel")[0]||m,"weather-forecast":c("weather")[0]||m,map:c("device_tracker")[0]||c("person")[0]||m}[r]||x||m;["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity"].includes(r)?h.entity=_:r==="weather-forecast"?(h.entity=_,h.show_current=!0,h.show_forecast=!0,h.forecast_type="daily"):r==="map"&&(h.entities=[_].filter(Boolean),h.theme_mode="auto")}if(["entities","glance","picture-glance","history-graph","statistics-graph"].includes(r)){let _=k=>(k!=null&&k.length?p.filter(C=>k.includes(C.split(".")[0])):p).slice(0,3);r==="statistics-graph"?h.entities=_(["sensor","number","input_number"]):h.entities=_()}if(r==="markdown"&&(h.content="Markdown card"),r==="sensor"&&(h.graph="line"),r==="button"&&(h.show_name=!0,h.show_icon=!0),r==="tile"&&(h.features_position="bottom",h.vertical=!1),r==="picture-glance"&&(h.title=h.title||"Glance",h.image=h.image||"https://demo.home-assistant.io/stub_config/kitchen.png"),r==="picture-entity"&&(h.image=h.image||"https://demo.home-assistant.io/stub_config/bedroom.png"),r==="iframe"&&(h.url=h.url||"https://www.home-assistant.io",h.aspect_ratio=h.aspect_ratio||"50%"),r==="alarm-panel"&&(h.states=h.states||["arm_home","arm_away"]),r==="area")try{let _=this.hass&&this.hass.areas?Object.values(this.hass.areas):[];_.length?h.area=_[0].area_id||_[0].name||_[0].id:h.area=m?m.split(".")[0]:"default_area",h.display_type="picture",h.alert_classes=h.alert_classes||["moisture","motion"],h.sensor_classes=h.sensor_classes||["temperature","humidity"],h.features_position="bottom"}catch{}return h}_getNextAvailablePosition(){let r=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),s=new Set,l=this.gridSize;r.forEach(h=>{let m=parseFloat(h.getAttribute("data-x"))||0,x=parseFloat(h.getAttribute("data-y"))||0,b=parseFloat(getComputedStyle(h).width)||100,_=parseFloat(getComputedStyle(h).height)||100,k=Math.floor(m/l),C=Math.floor(x/l),T=Math.floor((m+b)/l),z=Math.floor((x+_)/l);for(let L=k;L<T;L++)for(let I=C;I<z;I++)s.add(`${L}-${I}`)});let p=0,c=0;for(;s.has(`${p}-${c}`);)p+=6,p>60&&(p=0,c+=6);return{x:p*l,y:c*l}}async _addPickedCardToLayout(r){this._hideEmptyPlaceholder();let s=await this._createCard(r),l=this._makeWrapper(s),p=this._getNextAvailablePosition();this._setCardPosition(l,p.x,p.y),l.style.width=`${14*this.gridSize}px`,l.style.height=`${10*this.gridSize}px`,l.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(l);try{this._rebuildOnce(l.firstElementChild)}catch{}this._initCardInteract(l),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI()}_toggleSelection(r,s=null){let l=s==null?!this._selection.has(r):!!s;l?this._selection.add(r):this._selection.delete(r),r.classList.toggle("selected",l)}_clearSelection(){for(let r of this._selection)r.classList.remove("selected");this._selection.clear()}_installSelectionMarquee(){let r=this.cardContainer,s=0,l=0,p=null,c=!1,h=k=>{let C=r.getBoundingClientRect(),T="touches"in k&&k.touches[0]?k.touches[0].clientX:k.clientX,z="touches"in k&&k.touches[0]?k.touches[0].clientY:k.clientY;return{x:T-C.left,y:z-C.top}},m=(k,C)=>{let T=Math.min(k,s),z=Math.max(k,s),L=Math.min(C,l),I=Math.max(C,l);p.style.left=`${T}px`,p.style.top=`${L}px`,p.style.width=`${z-T}px`,p.style.height=`${I-L}px`;let O=p.getBoundingClientRect(),K=r.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),K.forEach(V=>{let S=V.getBoundingClientRect();!(S.right<O.left||S.left>O.right||S.bottom<O.top||S.top>O.bottom)&&this._toggleSelection(V,!0)})},x=k=>{if(!this.editMode||k.target.closest(".card-wrapper"))return;c=!0;let C=h(k);s=C.x,l=C.y,p=document.createElement("div"),p.className="marquee",p.style.left=`${s}px`,p.style.top=`${l}px`,r.appendChild(p),k.preventDefault()},b=k=>{!c||!p||m(h(k).x,h(k).y)},_=()=>{c&&(c=!1,p&&p.remove(),p=null)};r.addEventListener("mousedown",x),window.addEventListener("mousemove",b),window.addEventListener("mouseup",_),r.addEventListener("touchstart",k=>{this.editMode&&(k.target.closest(".card-wrapper")||x(k))},{passive:!1}),window.addEventListener("touchmove",k=>{b(k)},{passive:!1}),window.addEventListener("touchend",_),window.addEventListener("touchcancel",_)}async _openDiagnostics(){var m,x;let r=document.createElement("div");r.className="modal";let s=this.storageKey||"(none)",l=this._backendOK&&!!this.storageKey,p=b=>b.slice(-200).map(_=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${_.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${_.kind}]</b>
        <span style="margin-left:6px">${this._safe(_.msg)}</span>
        ${_.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(_.extra,null,2))}</pre>`:""}
      </div>`).join("");r.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95vw);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((m=this._config)==null?void 0:m.storage_key)||"")}</code> \u2192 <code>${this._safe(s)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${l?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((x=this.cardContainer)==null?void 0:x.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${p(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let c=()=>r.remove();r.querySelector("#closeDiag").addEventListener("click",c),this.shadowRoot.appendChild(r);let h=()=>{let b=r.querySelector("#logArea"),_=k=>k.slice(-200).map(C=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${C.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${C.kind}]</b>
          <span style="margin-left:6px">${this._safe(C.msg)}</span>
          ${C.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(C.extra,null,2))}</pre>`:""}
        </div>`).join("");b.innerHTML=_(this._dbgDump()),b.scrollTop=b.scrollHeight};r.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{h()}}),r.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),h()}),r.querySelector("#exportJson").addEventListener("click",()=>{let _=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(z=>{let L=parseFloat(z.getAttribute("data-x"))||0,I=parseFloat(z.getAttribute("data-y"))||0,O=parseFloat(z.style.width)||z.getBoundingClientRect().width,K=parseFloat(z.style.height)||z.getBoundingClientRect().height,V=parseInt(z.style.zIndex||"1",10);return{card:this._extractCardConfig(z.firstElementChild),position:{x:L,y:I},size:{width:O,height:K},z:V}}),k={version:2,options:this._exportableOptions(),cards:_},C=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),T=document.createElement("a");T.href=URL.createObjectURL(C),T.download=`ddc_${this.storageKey||"layout"}.json`,T.click(),URL.revokeObjectURL(T.href)}),r.querySelector("#importJson").addEventListener("click",async()=>{let b=document.createElement("input");b.type="file",b.accept="application/json",b.onchange=async()=>{var T,z,L,I,O,K,V,S,B,ee;let _=(T=b.files)==null?void 0:T[0];if(!_)return;let k=await _.text();try{let Q=JSON.parse(k);if(this._dbgPush("import","Loaded file",{bytes:k.length}),this.cardContainer.innerHTML="",(z=Q.cards)!=null&&z.length)for(let G of Q.cards)if(!(G!=null&&G.card)||typeof G.card=="object"&&Object.keys(G.card).length===0){let oe=this._makePlaceholderAt(((L=G.position)==null?void 0:L.x)||0,((I=G.position)==null?void 0:I.y)||0,((O=G.size)==null?void 0:O.width)||100,((K=G.size)==null?void 0:K.height)||100);this.cardContainer.appendChild(oe)}else{let oe=await this._createCard(G.card),ue=this._makeWrapper(oe);this._setCardPosition(ue,((V=G.position)==null?void 0:V.x)||0,((S=G.position)==null?void 0:S.y)||0),ue.style.width=`${((B=G.size)==null?void 0:B.width)||140}px`,ue.style.height=`${((ee=G.size)==null?void 0:ee.height)||100}px`,this.cardContainer.appendChild(ue);try{this._rebuildOnce(ue.firstElementChild)}catch{}this._initCardInteract(ue)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1)}catch(Q){this._dbgPush("import","Parse failed",{error:String(Q)})}let C=new Event("ddc-logrefresh");window.dispatchEvent(C)},b.click()}),r.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),h();let b=(this.storageKey||"ddc_test")+"_selftest",_={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(b,_);let k=await this._loadLayoutFromBackend(b);this._dbgPush("test","Round-trip result",{wrote:_,read:k})}catch(k){this._dbgPush("test","Round-trip failed",{error:String(k)})}h()}),h()}_exportableOptions(){var s,l;let r={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(s=this.containerFixedWidth)!=null?s:void 0,container_fixed_height:(l=this.containerFixedHeight)!=null?l:void 0,container_preset:this.containerPreset};return Object.keys(r).forEach(p=>r[p]===void 0&&delete r[p]),r}_applyImportedOptions(r={},s=!0){var l,p,c;if(r&&Object.prototype.hasOwnProperty.call(r,"storage_key"))try{let h={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:h}}))}catch{}this._config={...this._config||{},...r},"storage_key"in r&&(this.storageKey=r.storage_key||void 0),this._syncEditorsStorageKey(),"grid"in r&&(this.gridSize=Number(r.grid)||10),"drag_live_snap"in r&&(this.dragLiveSnap=!!r.drag_live_snap),"auto_save"in r&&(this.autoSave=!!r.auto_save),"auto_save_debounce"in r&&(this.autoSaveDebounce=Number(r.auto_save_debounce)||800),"container_background"in r&&(this.containerBackground=(l=r.container_background)!=null?l:"transparent"),"card_background"in r&&(this.cardBackground=(p=r.card_background)!=null?p:"var(--ha-card-background, var(--card-background-color))"),"debug"in r&&(this.debug=!!r.debug),"disable_overlap"in r&&(this.disableOverlap=!!r.disable_overlap),"container_size_mode"in r&&(this.containerSizeMode=r.container_size_mode||"dynamic"),"container_fixed_width"in r&&(this.containerFixedWidth=Number(r.container_fixed_width)||null),"container_fixed_height"in r&&(this.containerFixedHeight=Number(r.container_fixed_height)||null),"container_preset"in r&&(this.containerPreset=r.container_preset||"fhd"),"container_preset_orientation"in r&&(this.containerPresetOrient=r.container_preset_orientation||"auto"),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),s&&(this._applyContainerSizingFromConfig(!0),this._resizeContainer(),(c=this._updateStoreBadge)==null||c.call(this))}_exportDesign(){let s=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(m=>{let x=parseFloat(m.getAttribute("data-x"))||0,b=parseFloat(m.getAttribute("data-y"))||0,_=parseFloat(m.style.width)||m.getBoundingClientRect().width,k=parseFloat(m.style.height)||m.getBoundingClientRect().height,C=parseInt(m.style.zIndex||"1",10);return{card:this._extractCardConfig(m.firstElementChild),position:{x,y:b},size:{width:_,height:k},z:C}}),l={version:2,options:this._exportableOptions(),cards:s},p=`ddc_design_${this.storageKey||"layout"}.json`,c=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(c),h.download=p,h.click(),URL.revokeObjectURL(h.href),this._toast("Design exported.")}_importDesign(){let r=document.createElement("input");r.type="file",r.accept="application/json",r.onchange=async()=>{var p,c,h,m,x,b,_,k,C,T,z;let s=(p=r.files)==null?void 0:p[0];if(!s)return;let l=await s.text();try{let L=JSON.parse(l);if(L.options?this._applyImportedOptions(L.options,!0):typeof L.grid=="number"&&this._applyImportedOptions({grid:L.grid},!0),(c=L==null?void 0:L.options)!=null&&c.storage_key){let I=L.options.storage_key;this._config={...this._config||{},storage_key:I},this.storageKey=I,this._syncEditorsStorageKey();try{let O={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:O}}))}catch{}}if(this.cardContainer.innerHTML="",(h=L.cards)!=null&&h.length)for(let I of L.cards)if(!(I!=null&&I.card)||typeof I.card=="object"&&Object.keys(I.card).length===0){let O=this._makePlaceholderAt(((m=I.position)==null?void 0:m.x)||0,((x=I.position)==null?void 0:x.y)||0,((b=I.size)==null?void 0:b.width)||100,((_=I.size)==null?void 0:_.height)||100);this.cardContainer.appendChild(O)}else{let O=await this._createCard(I.card),K=this._makeWrapper(O);this._setCardPosition(K,((k=I.position)==null?void 0:k.x)||0,((C=I.position)==null?void 0:C.y)||0),K.style.width=`${((T=I.size)==null?void 0:T.width)||140}px`,K.style.height=`${((z=I.size)==null?void 0:z.height)||100}px`,I.z!=null&&(K.style.zIndex=String(I.z)),this.cardContainer.appendChild(K);try{this._rebuildOnce(K.firstElementChild)}catch{}this._initCardInteract(K)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1),this._toast("Design imported.")}catch(L){console.error("Import failed",L),this._toast("Import failed \u2014 invalid file.")}},r.click()}_queueSave(r="auto"){this.autoSave&&(this._loading||this.editMode&&(this._dbgPush("autosave","Queued",{reason:r,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce)))}async _saveLayout(r=!0){let l=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(c=>{let h=parseFloat(c.getAttribute("data-x"))||0,m=parseFloat(c.getAttribute("data-y"))||0,x=parseFloat(c.style.width)||c.getBoundingClientRect().width,b=parseFloat(c.style.height)||c.getBoundingClientRect().height,_=parseInt(c.style.zIndex||"1",10);return{card:this._extractCardConfig(c.firstElementChild),position:{x:h,y:m},size:{width:x,height:b},z:_}}),p={version:2,options:this._exportableOptions(),cards:l};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(p))}catch{}if(!this.storageKey){r||this._toast("Saved locally (no storage_key set).");return}try{await this._saveLayoutToBackend(this.storageKey,p),r||this._toast("Layout saved.")}catch(c){console.error("Backend save failed",c),this._dbgPush("save","Backend save failed",{error:String(c)}),r||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let r=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let s=await this.hass.callApi("get","dragdrop_storage"),l=Math.round(performance.now()-r);this._dbgPush("probe",`OK (${l} ms)`,s),this._backendOK=!!s}catch(s){let l=Math.round(performance.now()-r);this._dbgPush("probe",`FAILED (${l} ms)`,{error:String(s)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(r){let s=`dragdrop_storage/${encodeURIComponent(r)}`,l=performance.now();try{this._dbgPush("load",`GET /api/${s}`);let p=await this.hass.callApi("get",s),c=Math.round(performance.now()-l);return this._dbgPush("load",`OK (${c} ms)`,{bytes:JSON.stringify(p||"").length}),p}catch(p){let c=Math.round(performance.now()-l);return this._dbgPush("load",`FAILED (${c} ms)`,{error:String(p)}),null}}async _saveLayoutToBackend(r,s){let l=`dragdrop_storage/${encodeURIComponent(r)}`,p=JSON.stringify(s).length,c=performance.now();try{this._dbgPush("save",`POST /api/${l}`,{bytes:p});let h=await this.hass.callApi("post",l,s),m=Math.round(performance.now()-c);return this._dbgPush("save",`OK (${m} ms)`,h),h}catch(h){let m=Math.round(performance.now()-c);throw this._dbgPush("save",`FAILED (${m} ms)`,{error:String(h),bytes:p}),h}}_updateStoreBadge(){let r=this.storeBadge;if(!r)return;let s=this._backendOK&&!!this.storageKey;r.textContent=s?"storage: backend":"storage: local",r.style.background=s?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",r.style.borderColor=s?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(r){let s=new Event("hass-notification");s.detail={message:r},window.dispatchEvent(s)}_huiRoot(){var r,s,l,p,c,h;try{let m=document.querySelector("home-assistant"),x=(r=m==null?void 0:m.shadowRoot)==null?void 0:r.querySelector("home-assistant-main"),b=((s=x==null?void 0:x.shadowRoot)==null?void 0:s.querySelector("ha-drawer"))||x,_=((l=b==null?void 0:b.shadowRoot)==null?void 0:l.querySelector("partial-panel-resolver"))||b,k=((p=_==null?void 0:_.shadowRoot)==null?void 0:p.querySelector("ha-panel-lovelace"))||((c=b==null?void 0:b.shadowRoot)==null?void 0:c.querySelector("ha-panel-lovelace"));return((h=k==null?void 0:k.shadowRoot)==null?void 0:h.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",qn);(()=>{try{let e=window.customCards=window.customCards||[];e.some(u=>u.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!0})}catch{}})();(()=>{let e=new WeakSet,u=c=>{try{if(!(c instanceof Element))return!1;let h=c.localName||"";return h?!!(h==="ha-card"||h.endsWith("-card")):!1}catch{return!1}},r=c=>{try{if(!c||e.has(c))return;e.add(c),c.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}},s=c=>{var h,m;try{if(!c)return;c instanceof Element&&u(c)&&r(c);let x=(m=(h=(c instanceof ShadowRoot,c)).querySelectorAll)==null?void 0:m.call(h,"*");if(!x)return;for(let b of x){u(b)&&r(b);let _=b.shadowRoot;if(_)try{s(_)}catch{}}}catch{}},l=c=>{try{if(!c||c.__ddcCardModIntegrated)return;c.__ddcCardModIntegrated=!0;let h=c.shadowRoot||c;s(h);let m=new MutationObserver(x=>{for(let b of x)if(!(!b.addedNodes||!b.addedNodes.length))for(let _ of b.addedNodes)(_ instanceof Element||_ instanceof ShadowRoot)&&s(_)});m.observe(h,{childList:!0,subtree:!0}),c.__ddcCardModIntegratedObserver=m,setTimeout(()=>{try{s(h)}catch{}},250),setTimeout(()=>{try{s(h)}catch{}},1e3)}catch{}},p=()=>{try{document.querySelectorAll("drag-and-drop-card").forEach(l)}catch{}};if(window.customElements&&window.customElements.whenDefined)window.customElements.whenDefined("drag-and-drop-card").then(()=>{p();let c=window.customElements.get("drag-and-drop-card");if(c&&c.prototype){let m=c.prototype.connectedCallback;c.prototype.connectedCallback=function(){try{m&&m.call(this)}finally{l(this)}}}new MutationObserver(()=>p()).observe(document.documentElement,{childList:!0,subtree:!0})});else{let c=setInterval(p,1e3);setTimeout(()=>clearInterval(c),1e4)}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
