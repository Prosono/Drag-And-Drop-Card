var Io=Object.create;var yi=Object.defineProperty;var Fo=Object.getOwnPropertyDescriptor;var Lo=Object.getOwnPropertyNames;var zo=Object.getPrototypeOf,Do=Object.prototype.hasOwnProperty;var Ro=(e,i)=>()=>(i||e((i={exports:{}}).exports,i),i.exports);var Bo=(e,i,a,l)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of Lo(i))!Do.call(e,c)&&c!==a&&yi(e,c,{get:()=>i[c],enumerable:!(l=Fo(i,c))||l.enumerable});return e};var jo=(e,i,a)=>(a=e!=null?Io(zo(e)):{},Bo(i||!e||!e.__esModule?yi(a,"default",{value:e,enumerable:!0}):a,e));var bi=Ro((Cn,pt)=>{(function(e,i){typeof Cn=="object"&&typeof pt!="undefined"?pt.exports=i():typeof define=="function"&&define.amd?define(i):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=i()})(Cn,(function(){"use strict";function e(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),r.push.apply(r,o)}return r}function i(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e(Object(r),!0).forEach((function(o){p(n,o,r[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(r,o))}))}return n}function a(n){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(n)}function l(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function c(n,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,T(o.key),o)}}function u(n,t,r){return t&&c(n.prototype,t),r&&c(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function p(n,t,r){return(t=T(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function m(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&y(n,t)}function v(n){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(n)}function y(n,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},y(n,t)}function S(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _(n){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var r,o=v(n);if(t){var s=v(this).constructor;r=Reflect.construct(o,arguments,s)}else r=o.apply(this,arguments);return(function(d,f){if(f&&(typeof f=="object"||typeof f=="function"))return f;if(f!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S(d)})(this,r)}}function E(){return E=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(n,t,r){var o=(function(d,f){for(;!Object.prototype.hasOwnProperty.call(d,f)&&(d=v(d))!==null;);return d})(n,t);if(o){var s=Object.getOwnPropertyDescriptor(o,t);return s.get?s.get.call(arguments.length<3?n:r):s.value}},E.apply(this,arguments)}function T(n){var t=(function(r,o){if(typeof r!="object"||r===null)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var d=s.call(r,o||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)})(n,"string");return typeof t=="symbol"?t:t+""}var F=function(n){return!(!n||!n.Window)&&n instanceof n.Window},L=void 0,M=void 0;function D(n){L=n;var t=n.document.createTextNode("");t.ownerDocument!==n.document&&typeof n.wrap=="function"&&n.wrap(t)===t&&(n=n.wrap(n)),M=n}function O(n){return F(n)?n:(n.ownerDocument||n).defaultView||M.window}typeof window!="undefined"&&window&&D(window);var X=function(n){return!!n&&a(n)==="object"},B=function(n){return typeof n=="function"},C={window:function(n){return n===M||F(n)},docFrag:function(n){return X(n)&&n.nodeType===11},object:X,func:B,number:function(n){return typeof n=="number"},bool:function(n){return typeof n=="boolean"},string:function(n){return typeof n=="string"},element:function(n){if(!n||a(n)!=="object")return!1;var t=O(n)||M;return/object|function/.test(typeof Element=="undefined"?"undefined":a(Element))?n instanceof Element||n instanceof t.Element:n.nodeType===1&&typeof n.nodeName=="string"},plainObject:function(n){return X(n)&&!!n.constructor&&/function Object\b/.test(n.constructor.toString())},array:function(n){return X(n)&&n.length!==void 0&&B(n.splice)}};function te(n){var t=n.interaction;if(t.prepared.name==="drag"){var r=t.prepared.axis;r==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):r==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function oe(n){var t=n.iEvent,r=n.interaction;if(r.prepared.name==="drag"){var o=r.prepared.axis;if(o==="x"||o==="y"){var s=o==="x"?"y":"x";t.page[s]=r.coords.start.page[s],t.client[s]=r.coords.start.client[s],t.delta[s]=0}}}var G={id:"actions/drag",install:function(n){var t=n.actions,r=n.Interactable,o=n.defaults;r.prototype.draggable=G.draggable,t.map.drag=G,t.methodDict.drag="draggable",o.actions.drag=G.defaults},listeners:{"interactions:before-action-move":te,"interactions:action-resume":te,"interactions:action-move":oe,"auto-start:check":function(n){var t=n.interaction,r=n.interactable,o=n.buttons,s=r.options.drag;if(s&&s.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(o&r.options.drag.mouseButtons)!=0))return n.action={name:"drag",axis:s.lockAxis==="start"?s.startAxis:s.lockAxis},!1}},draggable:function(n){return C.object(n)?(this.options.drag.enabled=n.enabled!==!1,this.setPerAction("drag",n),this.setOnEvents("drag",n),/^(xy|x|y|start)$/.test(n.lockAxis)&&(this.options.drag.lockAxis=n.lockAxis),/^(xy|x|y)$/.test(n.startAxis)&&(this.options.drag.startAxis=n.startAxis),this):C.bool(n)?(this.options.drag.enabled=n,this):this.options.drag},beforeMove:te,move:oe,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(n){return n.search("drag")===0}},ve=G,se={init:function(n){var t=n;se.document=t.document,se.DocumentFragment=t.DocumentFragment||Se,se.SVGElement=t.SVGElement||Se,se.SVGSVGElement=t.SVGSVGElement||Se,se.SVGElementInstance=t.SVGElementInstance||Se,se.Element=t.Element||Se,se.HTMLElement=t.HTMLElement||se.Element,se.Event=t.Event,se.Touch=t.Touch||Se,se.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function Se(){}var de=se,xe={init:function(n){var t=de.Element,r=n.navigator||{};xe.supportsTouch="ontouchstart"in n||C.func(n.DocumentTouch)&&de.document instanceof n.DocumentTouch,xe.supportsPointerEvent=r.pointerEnabled!==!1&&!!de.PointerEvent,xe.isIOS=/iP(hone|od|ad)/.test(r.platform),xe.isIOS7=/iP(hone|od|ad)/.test(r.platform)&&/OS 7[^\d]/.test(r.appVersion),xe.isIe9=/MSIE 9/.test(r.userAgent),xe.isOperaMobile=r.appName==="Opera"&&xe.supportsTouch&&/Presto/.test(r.userAgent),xe.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",xe.pEventTypes=xe.supportsPointerEvent?de.PointerEvent===n.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,xe.wheelEvent=de.document&&"onmousewheel"in de.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},Ae=xe;function Xe(n,t){if(n.contains)return n.contains(t);for(;t;){if(t===n)return!0;t=t.parentNode}return!1}function Mt(n,t){for(;C.element(n);){if($e(n,t))return n;n=qe(n)}return null}function qe(n){var t=n.parentNode;if(C.docFrag(t)){for(;(t=t.host)&&C.docFrag(t););return t}return t}function $e(n,t){return M!==L&&(t=t.replace(/\/deep\//g," ")),n[Ae.prefixedMatchesSelector](t)}var Ve=function(n){return n.parentNode||n.host};function Ke(n,t){for(var r,o=[],s=n;(r=Ve(s))&&s!==t&&r!==s.ownerDocument;)o.unshift(s),s=r;return o}function De(n,t,r){for(;C.element(n);){if($e(n,t))return!0;if((n=qe(n))===r)return $e(n,t)}return!1}function Pt(n){return n.correspondingUseElement||n}function gt(n){var t=n instanceof de.SVGElement?n.getBoundingClientRect():n.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function nt(n){var t,r=gt(n);if(!Ae.isIOS7&&r){var o={x:(t=(t=O(n))||M).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};r.left+=o.x,r.right+=o.x,r.top+=o.y,r.bottom+=o.y}return r}function Ge(n){for(var t=[];n;)t.push(n),n=qe(n);return t}function Wt(n){return!!C.string(n)&&(de.document.querySelector(n),!0)}function Y(n,t){for(var r in t)n[r]=t[r];return n}function Xt(n,t,r){return n==="parent"?qe(r):n==="self"?t.getRect(r):Mt(r,n)}function U(n,t,r,o){var s=n;return C.string(s)?s=Xt(s,t,r):C.func(s)&&(s=s.apply(void 0,o)),C.element(s)&&(s=nt(s)),s}function ge(n){return n&&{x:"x"in n?n.x:n.left,y:"y"in n?n.y:n.top}}function le(n){return!n||"x"in n&&"y"in n||((n=Y({},n)).x=n.left||0,n.y=n.top||0,n.width=n.width||(n.right||0)-n.x,n.height=n.height||(n.bottom||0)-n.y),n}function ue(n,t,r){n.left&&(t.left+=r.x),n.right&&(t.right+=r.x),n.top&&(t.top+=r.y),n.bottom&&(t.bottom+=r.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function Le(n,t,r){var o=r&&n.options[r];return ge(U(o&&o.origin||n.options.origin,n,t,[n&&t]))||{x:0,y:0}}function Ue(n,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(b){return!0},o=arguments.length>3?arguments[3]:void 0;if(o=o||{},C.string(n)&&n.search(" ")!==-1&&(n=It(n)),C.array(n))return n.forEach((function(b){return Ue(b,t,r,o)})),o;if(C.object(n)&&(t=n,n=""),C.func(t)&&r(n))o[n]=o[n]||[],o[n].push(t);else if(C.array(t))for(var s=0,d=t;s<d.length;s++){var f=d[s];Ue(n,f,r,o)}else if(C.object(t))for(var g in t)Ue(It(g).map((function(b){return"".concat(n).concat(b)})),t[g],r,o);return o}function It(n){return n.trim().split(/ +/)}var Ze=function(n,t){return Math.sqrt(n*n+t*t)},He=["webkit","moz"];function mt(n,t){n.__set||(n.__set={});var r=function(s){if(He.some((function(d){return s.indexOf(d)===0})))return 1;typeof n[s]!="function"&&s!=="__set"&&Object.defineProperty(n,s,{get:function(){return s in n.__set?n.__set[s]:n.__set[s]=t[s]},set:function(d){n.__set[s]=d},configurable:!0})};for(var o in t)r(o);return n}function vt(n,t){n.page=n.page||{},n.page.x=t.page.x,n.page.y=t.page.y,n.client=n.client||{},n.client.x=t.client.x,n.client.y=t.client.y,n.timeStamp=t.timeStamp}function Vt(n){n.page.x=0,n.page.y=0,n.client.x=0,n.client.y=0}function yt(n){return n instanceof de.Event||n instanceof de.Touch}function it(n,t,r){return n=n||"page",(r=r||{}).x=t[n+"X"],r.y=t[n+"Y"],r}function bt(n,t){return t=t||{x:0,y:0},Ae.isOperaMobile&&yt(n)?(it("screen",n,t),t.x+=window.scrollX,t.y+=window.scrollY):it("page",n,t),t}function xt(n){return C.number(n.pointerId)?n.pointerId:n.identifier}function R(n,t,r){var o=t.length>1?ie(t):t[0];bt(o,n.page),(function(s,d){d=d||{},Ae.isOperaMobile&&yt(s)?it("screen",s,d):it("client",s,d)})(o,n.client),n.timeStamp=r}function j(n){var t=[];return C.array(n)?(t[0]=n[0],t[1]=n[1]):n.type==="touchend"?n.touches.length===1?(t[0]=n.touches[0],t[1]=n.changedTouches[0]):n.touches.length===0&&(t[0]=n.changedTouches[0],t[1]=n.changedTouches[1]):(t[0]=n.touches[0],t[1]=n.touches[1]),t}function ie(n){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},r=0;r<n.length;r++){var o=n[r];for(var s in t)t[s]+=o[s]}for(var d in t)t[d]/=n.length;return t}function re(n){if(!n.length)return null;var t=j(n),r=Math.min(t[0].pageX,t[1].pageX),o=Math.min(t[0].pageY,t[1].pageY),s=Math.max(t[0].pageX,t[1].pageX),d=Math.max(t[0].pageY,t[1].pageY);return{x:r,y:o,left:r,top:o,right:s,bottom:d,width:s-r,height:d-o}}function ae(n,t){var r=t+"X",o=t+"Y",s=j(n),d=s[0][r]-s[1][r],f=s[0][o]-s[1][o];return Ze(d,f)}function pe(n,t){var r=t+"X",o=t+"Y",s=j(n),d=s[1][r]-s[0][r],f=s[1][o]-s[0][o];return 180*Math.atan2(f,d)/Math.PI}function ke(n){return C.string(n.pointerType)?n.pointerType:C.number(n.pointerType)?[void 0,void 0,"touch","pen","mouse"][n.pointerType]:/touch/.test(n.type||"")||n instanceof de.Touch?"touch":"mouse"}function H(n){var t=C.func(n.composedPath)?n.composedPath():n.path;return[Pt(t?t[0]:n.target),Pt(n.currentTarget)]}var ce=(function(){function n(t){l(this,n),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return u(n,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n})();Object.defineProperty(ce.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var _e=function(n,t){for(var r=0;r<t.length;r++){var o=t[r];n.push(o)}return n},Re=function(n){return _e([],n)},he=function(n,t){for(var r=0;r<n.length;r++)if(t(n[r],r,n))return r;return-1},Be=function(n,t){return n[he(n,t)]},je=(function(n){m(r,n);var t=_(r);function r(o,s,d){var f;l(this,r),(f=t.call(this,s._interaction)).dropzone=void 0,f.dragEvent=void 0,f.relatedTarget=void 0,f.draggable=void 0,f.propagationStopped=!1,f.immediatePropagationStopped=!1;var g=d==="dragleave"?o.prev:o.cur,b=g.element,w=g.dropzone;return f.type=d,f.target=b,f.currentTarget=b,f.dropzone=w,f.dragEvent=s,f.relatedTarget=s.target,f.draggable=s.interactable,f.timeStamp=s.timeStamp,f}return u(r,[{key:"reject",value:function(){var o=this,s=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&s.cur.dropzone===this.dropzone&&s.cur.element===this.target)if(s.prev.dropzone=this.dropzone,s.prev.element=this.target,s.rejected=!0,s.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var d=s.activeDrops,f=he(d,(function(b){var w=b.dropzone,x=b.element;return w===o.dropzone&&x===o.target}));s.activeDrops.splice(f,1);var g=new r(s,this.dragEvent,"dropdeactivate");g.dropzone=this.dropzone,g.target=this.target,this.dropzone.fire(g)}else this.dropzone.fire(new r(s,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),r})(ce);function Ft(n,t){for(var r=0,o=n.slice();r<o.length;r++){var s=o[r],d=s.dropzone,f=s.element;t.dropzone=d,t.target=f,d.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function _t(n,t){for(var r=(function(d,f){for(var g=[],b=0,w=d.interactables.list;b<w.length;b++){var x=w[b];if(x.options.drop.enabled){var k=x.options.drop.accept;if(!(C.element(k)&&k!==f||C.string(k)&&!$e(f,k)||C.func(k)&&!k({dropzone:x,draggableElement:f})))for(var A=0,I=x.getAllElements();A<I.length;A++){var P=I[A];P!==f&&g.push({dropzone:x,element:P,rect:x.getRect(P)})}}}return g})(n,t),o=0;o<r.length;o++){var s=r[o];s.rect=s.dropzone.getRect(s.element)}return r}function Lt(n,t,r){for(var o=n.dropState,s=n.interactable,d=n.element,f=[],g=0,b=o.activeDrops;g<b.length;g++){var w=b[g],x=w.dropzone,k=w.element,A=w.rect,I=x.dropCheck(t,r,s,d,k,A);f.push(I?k:null)}var P=(function(z){for(var q,N,$,J=[],ee=0;ee<z.length;ee++){var W=z[ee],Q=z[q];if(W&&ee!==q)if(Q){var Ie=Ve(W),fe=Ve(Q);if(Ie!==W.ownerDocument)if(fe!==W.ownerDocument)if(Ie!==fe){J=J.length?J:Ke(Q);var Ne=void 0;if(Q instanceof de.HTMLElement&&W instanceof de.SVGElement&&!(W instanceof de.SVGSVGElement)){if(W===fe)continue;Ne=W.ownerSVGElement}else Ne=W;for(var We=Ke(Ne,Q.ownerDocument),et=0;We[et]&&We[et]===J[et];)et++;var an=[We[et-1],We[et],J[et]];if(an[0])for(var qt=an[0].lastChild;qt;){if(qt===an[1]){q=ee,J=We;break}if(qt===an[2])break;qt=qt.previousSibling}}else $=Q,(parseInt(O(N=W).getComputedStyle(N).zIndex,10)||0)>=(parseInt(O($).getComputedStyle($).zIndex,10)||0)&&(q=ee);else q=ee}else q=ee}return q})(f);return o.activeDrops[P]||null}function wt(n,t,r){var o=n.dropState,s={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return r.type==="dragstart"&&(s.activate=new je(o,r,"dropactivate"),s.activate.target=null,s.activate.dropzone=null),r.type==="dragend"&&(s.deactivate=new je(o,r,"dropdeactivate"),s.deactivate.target=null,s.deactivate.dropzone=null),o.rejected||(o.cur.element!==o.prev.element&&(o.prev.dropzone&&(s.leave=new je(o,r,"dragleave"),r.dragLeave=s.leave.target=o.prev.element,r.prevDropzone=s.leave.dropzone=o.prev.dropzone),o.cur.dropzone&&(s.enter=new je(o,r,"dragenter"),r.dragEnter=o.cur.element,r.dropzone=o.cur.dropzone)),r.type==="dragend"&&o.cur.dropzone&&(s.drop=new je(o,r,"drop"),r.dropzone=o.cur.dropzone,r.relatedTarget=o.cur.element),r.type==="dragmove"&&o.cur.dropzone&&(s.move=new je(o,r,"dropmove"),r.dropzone=o.cur.dropzone)),s}function St(n,t){var r=n.dropState,o=r.activeDrops,s=r.cur,d=r.prev;t.leave&&d.dropzone.fire(t.leave),t.enter&&s.dropzone.fire(t.enter),t.move&&s.dropzone.fire(t.move),t.drop&&s.dropzone.fire(t.drop),t.deactivate&&Ft(o,t.deactivate),r.prev.dropzone=s.dropzone,r.prev.element=s.element}function ne(n,t){var r=n.interaction,o=n.iEvent,s=n.event;if(o.type==="dragmove"||o.type==="dragend"){var d=r.dropState;t.dynamicDrop&&(d.activeDrops=_t(t,r.element));var f=o,g=Lt(r,f,s);d.rejected=d.rejected&&!!g&&g.dropzone===d.cur.dropzone&&g.element===d.cur.element,d.cur.dropzone=g&&g.dropzone,d.cur.element=g&&g.element,d.events=wt(r,0,f)}}var Z={id:"actions/drop",install:function(n){var t=n.actions,r=n.interactStatic,o=n.Interactable,s=n.defaults;n.usePlugin(ve),o.prototype.dropzone=function(d){return(function(f,g){if(C.object(g)){if(f.options.drop.enabled=g.enabled!==!1,g.listeners){var b=Ue(g.listeners),w=Object.keys(b).reduce((function(k,A){return k[/^(enter|leave)/.test(A)?"drag".concat(A):/^(activate|deactivate|move)/.test(A)?"drop".concat(A):A]=b[A],k}),{}),x=f.options.drop.listeners;x&&f.off(x),f.on(w),f.options.drop.listeners=w}return C.func(g.ondrop)&&f.on("drop",g.ondrop),C.func(g.ondropactivate)&&f.on("dropactivate",g.ondropactivate),C.func(g.ondropdeactivate)&&f.on("dropdeactivate",g.ondropdeactivate),C.func(g.ondragenter)&&f.on("dragenter",g.ondragenter),C.func(g.ondragleave)&&f.on("dragleave",g.ondragleave),C.func(g.ondropmove)&&f.on("dropmove",g.ondropmove),/^(pointer|center)$/.test(g.overlap)?f.options.drop.overlap=g.overlap:C.number(g.overlap)&&(f.options.drop.overlap=Math.max(Math.min(1,g.overlap),0)),"accept"in g&&(f.options.drop.accept=g.accept),"checker"in g&&(f.options.drop.checker=g.checker),f}return C.bool(g)?(f.options.drop.enabled=g,f):f.options.drop})(this,d)},o.prototype.dropCheck=function(d,f,g,b,w,x){return(function(k,A,I,P,z,q,N){var $=!1;if(!(N=N||k.getRect(q)))return!!k.options.drop.checker&&k.options.drop.checker(A,I,$,k,q,P,z);var J=k.options.drop.overlap;if(J==="pointer"){var ee=Le(P,z,"drag"),W=bt(A);W.x+=ee.x,W.y+=ee.y;var Q=W.x>N.left&&W.x<N.right,Ie=W.y>N.top&&W.y<N.bottom;$=Q&&Ie}var fe=P.getRect(z);if(fe&&J==="center"){var Ne=fe.left+fe.width/2,We=fe.top+fe.height/2;$=Ne>=N.left&&Ne<=N.right&&We>=N.top&&We<=N.bottom}return fe&&C.number(J)&&($=Math.max(0,Math.min(N.right,fe.right)-Math.max(N.left,fe.left))*Math.max(0,Math.min(N.bottom,fe.bottom)-Math.max(N.top,fe.top))/(fe.width*fe.height)>=J),k.options.drop.checker&&($=k.options.drop.checker(A,I,$,k,q,P,z)),$})(this,d,f,g,b,w,x)},r.dynamicDrop=function(d){return C.bool(d)?(n.dynamicDrop=d,r):n.dynamicDrop},Y(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",n.dynamicDrop=!1,s.actions.drop=Z.defaults},listeners:{"interactions:before-action-start":function(n){var t=n.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(n,t){var r=n.interaction,o=(n.event,n.iEvent);if(r.prepared.name==="drag"){var s=r.dropState;s.activeDrops=[],s.events={},s.activeDrops=_t(t,r.element),s.events=wt(r,0,o),s.events.activate&&(Ft(s.activeDrops,s.events.activate),t.fire("actions/drop:start",{interaction:r,dragEvent:o}))}},"interactions:action-move":ne,"interactions:after-action-move":function(n,t){var r=n.interaction,o=n.iEvent;if(r.prepared.name==="drag"){var s=r.dropState;St(r,s.events),t.fire("actions/drop:move",{interaction:r,dragEvent:o}),s.events={}}},"interactions:action-end":function(n,t){if(n.interaction.prepared.name==="drag"){var r=n.interaction,o=n.iEvent;ne(n,t),St(r,r.dropState.events),t.fire("actions/drop:end",{interaction:r,dragEvent:o})}},"interactions:stop":function(n){var t=n.interaction;if(t.prepared.name==="drag"){var r=t.dropState;r&&(r.activeDrops=null,r.events=null,r.cur.dropzone=null,r.cur.element=null,r.prev.dropzone=null,r.prev.element=null,r.rejected=!1)}}},getActiveDrops:_t,getDrop:Lt,getDropEvents:wt,fireDropEvents:St,filterEventType:function(n){return n.search("drag")===0||n.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},me=Z;function Te(n){var t=n.interaction,r=n.iEvent,o=n.phase;if(t.prepared.name==="gesture"){var s=t.pointers.map((function(w){return w.pointer})),d=o==="start",f=o==="end",g=t.interactable.options.deltaSource;if(r.touches=[s[0],s[1]],d)r.distance=ae(s,g),r.box=re(s),r.scale=1,r.ds=0,r.angle=pe(s,g),r.da=0,t.gesture.startDistance=r.distance,t.gesture.startAngle=r.angle;else if(f||t.pointers.length<2){var b=t.prevEvent;r.distance=b.distance,r.box=b.box,r.scale=b.scale,r.ds=0,r.angle=b.angle,r.da=0}else r.distance=ae(s,g),r.box=re(s),r.scale=r.distance/t.gesture.startDistance,r.angle=pe(s,g),r.ds=r.scale-t.gesture.scale,r.da=r.angle-t.gesture.angle;t.gesture.distance=r.distance,t.gesture.angle=r.angle,C.number(r.scale)&&r.scale!==1/0&&!isNaN(r.scale)&&(t.gesture.scale=r.scale)}}var Oe={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(n){var t=n.actions,r=n.Interactable,o=n.defaults;r.prototype.gesturable=function(s){return C.object(s)?(this.options.gesture.enabled=s.enabled!==!1,this.setPerAction("gesture",s),this.setOnEvents("gesture",s),this):C.bool(s)?(this.options.gesture.enabled=s,this):this.options.gesture},t.map.gesture=Oe,t.methodDict.gesture="gesturable",o.actions.gesture=Oe.defaults},listeners:{"interactions:action-start":Te,"interactions:action-move":Te,"interactions:action-end":Te,"interactions:new":function(n){n.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(n){if(!(n.interaction.pointers.length<2)){var t=n.interactable.options.gesture;if(t&&t.enabled)return n.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(n){return n.search("gesture")===0}},kt=Oe;function zt(n,t,r,o,s,d,f){if(!t)return!1;if(t===!0){var g=C.number(d.width)?d.width:d.right-d.left,b=C.number(d.height)?d.height:d.bottom-d.top;if(f=Math.min(f,Math.abs((n==="left"||n==="right"?g:b)/2)),g<0&&(n==="left"?n="right":n==="right"&&(n="left")),b<0&&(n==="top"?n="bottom":n==="bottom"&&(n="top")),n==="left"){var w=g>=0?d.left:d.right;return r.x<w+f}if(n==="top"){var x=b>=0?d.top:d.bottom;return r.y<x+f}if(n==="right")return r.x>(g>=0?d.right:d.left)-f;if(n==="bottom")return r.y>(b>=0?d.bottom:d.top)-f}return!!C.element(o)&&(C.element(t)?t===o:De(o,t,s))}function Je(n){var t=n.iEvent,r=n.interaction;if(r.prepared.name==="resize"&&r.resizeAxes){var o=t;r.interactable.options.resize.square?(r.resizeAxes==="y"?o.delta.x=o.delta.y:o.delta.y=o.delta.x,o.axes="xy"):(o.axes=r.resizeAxes,r.resizeAxes==="x"?o.delta.y=0:r.resizeAxes==="y"&&(o.delta.x=0))}}var we,Ye,Me={id:"actions/resize",before:["actions/drag"],install:function(n){var t=n.actions,r=n.browser,o=n.Interactable,s=n.defaults;Me.cursors=(function(d){return d.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(r),Me.defaultMargin=r.supportsTouch||r.supportsPointerEvent?20:10,o.prototype.resizable=function(d){return(function(f,g,b){return C.object(g)?(f.options.resize.enabled=g.enabled!==!1,f.setPerAction("resize",g),f.setOnEvents("resize",g),C.string(g.axis)&&/^x$|^y$|^xy$/.test(g.axis)?f.options.resize.axis=g.axis:g.axis===null&&(f.options.resize.axis=b.defaults.actions.resize.axis),C.bool(g.preserveAspectRatio)?f.options.resize.preserveAspectRatio=g.preserveAspectRatio:C.bool(g.square)&&(f.options.resize.square=g.square),f):C.bool(g)?(f.options.resize.enabled=g,f):f.options.resize})(this,d,n)},t.map.resize=Me,t.methodDict.resize="resizable",s.actions.resize=Me.defaults},listeners:{"interactions:new":function(n){n.interaction.resizeAxes="xy"},"interactions:action-start":function(n){(function(t){var r=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=r,d=o.rect;o._rects={start:Y({},d),corrected:Y({},d),previous:Y({},d),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},s.edges=o.prepared.edges,s.rect=o._rects.corrected,s.deltaRect=o._rects.delta}})(n),Je(n)},"interactions:action-move":function(n){(function(t){var r=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=r,d=o.interactable.options.resize.invert,f=d==="reposition"||d==="negate",g=o.rect,b=o._rects,w=b.start,x=b.corrected,k=b.delta,A=b.previous;if(Y(A,x),f){if(Y(x,g),d==="reposition"){if(x.top>x.bottom){var I=x.top;x.top=x.bottom,x.bottom=I}if(x.left>x.right){var P=x.left;x.left=x.right,x.right=P}}}else x.top=Math.min(g.top,w.bottom),x.bottom=Math.max(g.bottom,w.top),x.left=Math.min(g.left,w.right),x.right=Math.max(g.right,w.left);for(var z in x.width=x.right-x.left,x.height=x.bottom-x.top,x)k[z]=x[z]-A[z];s.edges=o.prepared.edges,s.rect=x,s.deltaRect=k}})(n),Je(n)},"interactions:action-end":function(n){var t=n.iEvent,r=n.interaction;if(r.prepared.name==="resize"&&r.prepared.edges){var o=t;o.edges=r.prepared.edges,o.rect=r._rects.corrected,o.deltaRect=r._rects.delta}},"auto-start:check":function(n){var t=n.interaction,r=n.interactable,o=n.element,s=n.rect,d=n.buttons;if(s){var f=Y({},t.coords.cur.page),g=r.options.resize;if(g&&g.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(d&g.mouseButtons)!=0)){if(C.object(g.edges)){var b={left:!1,right:!1,top:!1,bottom:!1};for(var w in b)b[w]=zt(w,g.edges[w],f,t._latestPointer.eventTarget,o,s,g.margin||Me.defaultMargin);b.left=b.left&&!b.right,b.top=b.top&&!b.bottom,(b.left||b.right||b.top||b.bottom)&&(n.action={name:"resize",edges:b})}else{var x=g.axis!=="y"&&f.x>s.right-Me.defaultMargin,k=g.axis!=="x"&&f.y>s.bottom-Me.defaultMargin;(x||k)&&(n.action={name:"resize",axes:(x?"x":"")+(k?"y":"")})}return!n.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(n){var t=n.edges,r=n.axis,o=n.name,s=Me.cursors,d=null;if(r)d=s[o+r];else if(t){for(var f="",g=0,b=["top","bottom","left","right"];g<b.length;g++){var w=b[g];t[w]&&(f+=w)}d=s[f]}return d},filterEventType:function(n){return n.search("resize")===0},defaultMargin:null},Gt=Me,rt={id:"actions",install:function(n){n.usePlugin(kt),n.usePlugin(Gt),n.usePlugin(ve),n.usePlugin(me)}},Hn=0,ot={request:function(n){return we(n)},cancel:function(n){return Ye(n)},init:function(n){if(we=n.requestAnimationFrame,Ye=n.cancelAnimationFrame,!we)for(var t=["ms","moz","webkit","o"],r=0;r<t.length;r++){var o=t[r];we=n["".concat(o,"RequestAnimationFrame")],Ye=n["".concat(o,"CancelAnimationFrame")]||n["".concat(o,"CancelRequestAnimationFrame")]}we=we&&we.bind(n),Ye=Ye&&Ye.bind(n),we||(we=function(s){var d=Date.now(),f=Math.max(0,16-(d-Hn)),g=n.setTimeout((function(){s(d+f)}),f);return Hn=d+f,g},Ye=function(s){return clearTimeout(s)})}},V={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(n){V.isScrolling=!0,ot.cancel(V.i),n.autoScroll=V,V.interaction=n,V.prevTime=V.now(),V.i=ot.request(V.scroll)},stop:function(){V.isScrolling=!1,V.interaction&&(V.interaction.autoScroll=null),ot.cancel(V.i)},scroll:function(){var n=V.interaction,t=n.interactable,r=n.element,o=n.prepared.name,s=t.options[o].autoScroll,d=Yn(s.container,t,r),f=V.now(),g=(f-V.prevTime)/1e3,b=s.speed*g;if(b>=1){var w={x:V.x*b,y:V.y*b};if(w.x||w.y){var x=$n(d);C.window(d)?d.scrollBy(w.x,w.y):d&&(d.scrollLeft+=w.x,d.scrollTop+=w.y);var k=$n(d),A={x:k.x-x.x,y:k.y-x.y};(A.x||A.y)&&t.fire({type:"autoscroll",target:r,interactable:t,delta:A,interaction:n,container:d})}V.prevTime=f}V.isScrolling&&(ot.cancel(V.i),V.i=ot.request(V.scroll))},check:function(n,t){var r;return(r=n.options[t].autoScroll)==null?void 0:r.enabled},onInteractionMove:function(n){var t=n.interaction,r=n.pointer;if(t.interacting()&&V.check(t.interactable,t.prepared.name))if(t.simulation)V.x=V.y=0;else{var o,s,d,f,g=t.interactable,b=t.element,w=t.prepared.name,x=g.options[w].autoScroll,k=Yn(x.container,g,b);if(C.window(k))f=r.clientX<V.margin,o=r.clientY<V.margin,s=r.clientX>k.innerWidth-V.margin,d=r.clientY>k.innerHeight-V.margin;else{var A=gt(k);f=r.clientX<A.left+V.margin,o=r.clientY<A.top+V.margin,s=r.clientX>A.right-V.margin,d=r.clientY>A.bottom-V.margin}V.x=s?1:f?-1:0,V.y=d?1:o?-1:0,V.isScrolling||(V.margin=x.margin,V.speed=x.speed,V.start(t))}}};function Yn(n,t,r){return(C.string(n)?Xt(n,t,r):n)||O(r)}function $n(n){return C.window(n)&&(n=window.document.body),{x:n.scrollLeft,y:n.scrollTop}}var Er={id:"auto-scroll",install:function(n){var t=n.defaults,r=n.actions;n.autoScroll=V,V.now=function(){return n.now()},r.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=V.defaults},listeners:{"interactions:new":function(n){n.interaction.autoScroll=null},"interactions:destroy":function(n){n.interaction.autoScroll=null,V.stop(),V.interaction&&(V.interaction=null)},"interactions:stop":V.stop,"interactions:action-move":function(n){return V.onInteractionMove(n)}}},Cr=Er;function Dt(n,t){var r=!1;return function(){return r||(M.console.warn(t),r=!0),n.apply(this,arguments)}}function hn(n,t){return n.name=t.name,n.axis=t.axis,n.edges=t.edges,n}function Ar(n){return C.bool(n)?(this.options.styleCursor=n,this):n===null?(delete this.options.styleCursor,this):this.options.styleCursor}function Tr(n){return C.func(n)?(this.options.actionChecker=n,this):n===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Or={id:"auto-start/interactableMethods",install:function(n){var t=n.Interactable;t.prototype.getAction=function(r,o,s,d){var f=(function(g,b,w,x,k){var A=g.getRect(x),I=b.buttons||{0:1,1:4,3:8,4:16}[b.button],P={action:null,interactable:g,interaction:w,element:x,rect:A,buttons:I};return k.fire("auto-start:check",P),P.action})(this,o,s,d,n);return this.options.actionChecker?this.options.actionChecker(r,o,f,this,d,s):f},t.prototype.ignoreFrom=Dt((function(r){return this._backCompatOption("ignoreFrom",r)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=Dt((function(r){return this._backCompatOption("allowFrom",r)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Tr,t.prototype.styleCursor=Ar}};function Kn(n,t,r,o,s){return t.testIgnoreAllow(t.options[n.name],r,o)&&t.options[n.name].enabled&&Jt(t,r,n,s)?n:null}function Mr(n,t,r,o,s,d,f){for(var g=0,b=o.length;g<b;g++){var w=o[g],x=s[g],k=w.getAction(t,r,n,x);if(k){var A=Kn(k,w,x,d,f);if(A)return{action:A,interactable:w,element:x}}}return{action:null,interactable:null,element:null}}function Un(n,t,r,o,s){var d=[],f=[],g=o;function b(x){d.push(x),f.push(g)}for(;C.element(g);){d=[],f=[],s.interactables.forEachMatch(g,b);var w=Mr(n,t,r,d,f,o,s);if(w.action&&!w.interactable.options[w.action.name].manualStart)return w;g=qe(g)}return{action:null,interactable:null,element:null}}function Wn(n,t,r){var o=t.action,s=t.interactable,d=t.element;o=o||{name:null},n.interactable=s,n.element=d,hn(n.prepared,o),n.rect=s&&o.name?s.getRect(d):null,Vn(n,r),r.fire("autoStart:prepared",{interaction:n})}function Jt(n,t,r,o){var s=n.options,d=s[r.name].max,f=s[r.name].maxPerElement,g=o.autoStart.maxInteractions,b=0,w=0,x=0;if(!(d&&f&&g))return!1;for(var k=0,A=o.interactions.list;k<A.length;k++){var I=A[k],P=I.prepared.name;if(I.interacting()&&(++b>=g||I.interactable===n&&((w+=P===r.name?1:0)>=d||I.element===t&&(x++,P===r.name&&x>=f))))return!1}return g>0}function Xn(n,t){return C.number(n)?(t.autoStart.maxInteractions=n,this):t.autoStart.maxInteractions}function fn(n,t,r){var o=r.autoStart.cursorElement;o&&o!==n&&(o.style.cursor=""),n.ownerDocument.documentElement.style.cursor=t,n.style.cursor=t,r.autoStart.cursorElement=t?n:null}function Vn(n,t){var r=n.interactable,o=n.element,s=n.prepared;if(n.pointerType==="mouse"&&r&&r.options.styleCursor){var d="";if(s.name){var f=r.options[s.name].cursorChecker;d=C.func(f)?f(s,r,o,n._interacting):t.actions.map[s.name].getCursor(s)}fn(n.element,d||"",t)}else t.autoStart.cursorElement&&fn(t.autoStart.cursorElement,"",t)}var Pr={id:"auto-start/base",before:["actions"],install:function(n){var t=n.interactStatic,r=n.defaults;n.usePlugin(Or),r.base.actionChecker=null,r.base.styleCursor=!0,Y(r.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(o){return Xn(o,n)},n.autoStart={maxInteractions:1/0,withinInteractionLimit:Jt,cursorElement:null}},listeners:{"interactions:down":function(n,t){var r=n.interaction,o=n.pointer,s=n.event,d=n.eventTarget;r.interacting()||Wn(r,Un(r,o,s,d,t),t)},"interactions:move":function(n,t){(function(r,o){var s=r.interaction,d=r.pointer,f=r.event,g=r.eventTarget;s.pointerType!=="mouse"||s.pointerIsDown||s.interacting()||Wn(s,Un(s,d,f,g,o),o)})(n,t),(function(r,o){var s=r.interaction;if(s.pointerIsDown&&!s.interacting()&&s.pointerWasMoved&&s.prepared.name){o.fire("autoStart:before-start",r);var d=s.interactable,f=s.prepared.name;f&&d&&(d.options[f].manualStart||!Jt(d,s.element,s.prepared,o)?s.stop():(s.start(s.prepared,d,s.element),Vn(s,o)))}})(n,t)},"interactions:stop":function(n,t){var r=n.interaction,o=r.interactable;o&&o.options.styleCursor&&fn(r.element,"",t)}},maxInteractions:Xn,withinInteractionLimit:Jt,validateAction:Kn},gn=Pr,Ir={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(n,t){var r=n.interaction,o=n.eventTarget,s=n.dx,d=n.dy;if(r.prepared.name==="drag"){var f=Math.abs(s),g=Math.abs(d),b=r.interactable.options.drag,w=b.startAxis,x=f>g?"x":f<g?"y":"xy";if(r.prepared.axis=b.lockAxis==="start"?x[0]:b.lockAxis,x!=="xy"&&w!=="xy"&&w!==x){r.prepared.name=null;for(var k=o,A=function(P){if(P!==r.interactable){var z=r.interactable.options.drag;if(!z.manualStart&&P.testIgnoreAllow(z,k,o)){var q=P.getAction(r.downPointer,r.downEvent,r,k);if(q&&q.name==="drag"&&(function(N,$){if(!$)return!1;var J=$.options.drag.startAxis;return N==="xy"||J==="xy"||J===N})(x,P)&&gn.validateAction(q,P,k,o,t))return P}}};C.element(k);){var I=t.interactables.forEachMatch(k,A);if(I){r.prepared.name="drag",r.interactable=I,r.element=k;break}k=qe(k)}}}}}};function mn(n){var t=n.prepared&&n.prepared.name;if(!t)return null;var r=n.interactable.options;return r[t].hold||r[t].delay}var Fr={id:"auto-start/hold",install:function(n){var t=n.defaults;n.usePlugin(gn),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(n){n.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(n){var t=n.interaction,r=mn(t);r>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),r))},"interactions:move":function(n){var t=n.interaction,r=n.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!r&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(n){var t=n.interaction;mn(t)>0&&(t.prepared.name=null)}},getHoldDuration:mn},Lr=Fr,zr={id:"auto-start",install:function(n){n.usePlugin(gn),n.usePlugin(Lr),n.usePlugin(Ir)}},Dr=function(n){return/^(always|never|auto)$/.test(n)?(this.options.preventDefault=n,this):C.bool(n)?(this.options.preventDefault=n?"always":"never",this):this.options.preventDefault};function Rr(n){var t=n.interaction,r=n.event;t.interactable&&t.interactable.checkAndPreventDefault(r)}var Gn={id:"core/interactablePreventDefault",install:function(n){var t=n.Interactable;t.prototype.preventDefault=Dr,t.prototype.checkAndPreventDefault=function(r){return(function(o,s,d){var f=o.options.preventDefault;if(f!=="never")if(f!=="always"){if(s.events.supportsPassive&&/^touch(start|move)$/.test(d.type)){var g=O(d.target).document,b=s.getDocOptions(g);if(!b||!b.events||b.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(d.type)||C.element(d.target)&&$e(d.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||d.preventDefault()}else d.preventDefault()})(this,n,r)},n.interactions.docEvents.push({type:"dragstart",listener:function(r){for(var o=0,s=n.interactions.list;o<s.length;o++){var d=s[o];if(d.element&&(d.element===r.target||Xe(d.element,r.target)))return void d.interactable.checkAndPreventDefault(r)}}})},listeners:["down","move","up","cancel"].reduce((function(n,t){return n["interactions:".concat(t)]=Rr,n}),{})};function Qt(n,t){if(t.phaselessTypes[n])return!0;for(var r in t.map)if(n.indexOf(r)===0&&n.substr(r.length)in t.phases)return!0;return!1}function Et(n){var t={};for(var r in n){var o=n[r];C.plainObject(o)?t[r]=Et(o):C.array(o)?t[r]=Re(o):t[r]=o}return t}var vn=(function(){function n(t){l(this,n),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=Zt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return u(n,[{key:"start",value:function(t,r){var o,s,d=t.phase,f=this.interaction,g=(function(w){var x=w.interactable.options[w.prepared.name],k=x.modifiers;return k&&k.length?k:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(A){var I=x[A];return I&&I.enabled&&{options:I,methods:I._methods}})).filter((function(A){return!!A}))})(f);this.prepareStates(g),this.startEdges=Y({},f.edges),this.edges=Y({},this.startEdges),this.startOffset=(o=f.rect,s=r,o?{left:s.x-o.left,top:s.y-o.top,right:o.right-s.x,bottom:o.bottom-s.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var b=this.fillArg({phase:d,pageCoords:r,preEnd:!1});return this.result=Zt(),this.startAll(b),this.result=this.setAll(b)}},{key:"fillArg",value:function(t){var r=this.interaction;return t.interaction=r,t.interactable=r.interactable,t.element=r.element,t.rect||(t.rect=r.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var r=0,o=this.states;r<o.length;r++){var s=o[r];s.methods.start&&(t.state=s,s.methods.start(t))}}},{key:"setAll",value:function(t){var r=t.phase,o=t.preEnd,s=t.skipModifiers,d=t.rect,f=t.edges;t.coords=Y({},t.pageCoords),t.rect=Y({},d),t.edges=Y({},f);for(var g=s?this.states.slice(s):this.states,b=Zt(t.coords,t.rect),w=0;w<g.length;w++){var x,k=g[w],A=k.options,I=Y({},t.coords),P=null;(x=k.methods)!=null&&x.set&&this.shouldDo(A,o,r)&&(t.state=k,P=k.methods.set(t),ue(t.edges,t.rect,{x:t.coords.x-I.x,y:t.coords.y-I.y})),b.eventProps.push(P)}Y(this.edges,t.edges),b.delta.x=t.coords.x-t.pageCoords.x,b.delta.y=t.coords.y-t.pageCoords.y,b.rectDelta.left=t.rect.left-d.left,b.rectDelta.right=t.rect.right-d.right,b.rectDelta.top=t.rect.top-d.top,b.rectDelta.bottom=t.rect.bottom-d.bottom;var z=this.result.coords,q=this.result.rect;if(z&&q){var N=b.rect.left!==q.left||b.rect.right!==q.right||b.rect.top!==q.top||b.rect.bottom!==q.bottom;b.changed=N||z.x!==b.coords.x||z.y!==b.coords.y}return b}},{key:"applyToInteraction",value:function(t){var r=this.interaction,o=t.phase,s=r.coords.cur,d=r.coords.start,f=this.result,g=this.startDelta,b=f.delta;o==="start"&&Y(this.startDelta,f.delta);for(var w=0,x=[[d,g],[s,b]];w<x.length;w++){var k=x[w],A=k[0],I=k[1];A.page.x+=I.x,A.page.y+=I.y,A.client.x+=I.x,A.client.y+=I.y}var P=this.result.rectDelta,z=t.rect||r.rect;z.left+=P.left,z.right+=P.right,z.top+=P.top,z.bottom+=P.bottom,z.width=z.right-z.left,z.height=z.bottom-z.top}},{key:"setAndApply",value:function(t){var r=this.interaction,o=t.phase,s=t.preEnd,d=t.skipModifiers,f=this.setAll(this.fillArg({preEnd:s,phase:o,pageCoords:t.modifiedCoords||r.coords.cur.page}));if(this.result=f,!f.changed&&(!d||d<this.states.length)&&r.interacting())return!1;if(t.modifiedCoords){var g=r.coords.cur.page,b={x:t.modifiedCoords.x-g.x,y:t.modifiedCoords.y-g.y};f.coords.x+=b.x,f.coords.y+=b.y,f.delta.x+=b.x,f.delta.y+=b.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var r=t.interaction,o=t.event,s=this.states;if(s&&s.length){for(var d=!1,f=0;f<s.length;f++){var g=s[f];t.state=g;var b=g.options,w=g.methods,x=w.beforeEnd&&w.beforeEnd(t);if(x)return this.endResult=x,!1;d=d||!d&&this.shouldDo(b,!0,t.phase,!0)}d&&r.move({event:o,preEnd:!0})}}},{key:"stop",value:function(t){var r=t.interaction;if(this.states&&this.states.length){var o=Y({states:this.states,interactable:r.interactable,element:r.element,rect:null},t);this.fillArg(o);for(var s=0,d=this.states;s<d.length;s++){var f=d[s];o.state=f,f.methods.stop&&f.methods.stop(o)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var r=0;r<t.length;r++){var o=t[r],s=o.options,d=o.methods,f=o.name;this.states.push({options:s,methods:d,index:r,name:f})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var r=t.interaction,o=r.coords,s=r.rect,d=r.modification;if(d.result){for(var f=d.startDelta,g=d.result,b=g.delta,w=g.rectDelta,x=0,k=[[o.start,f],[o.cur,b]];x<k.length;x++){var A=k[x],I=A[0],P=A[1];I.page.x-=P.x,I.page.y-=P.y,I.client.x-=P.x,I.client.y-=P.y}s.left-=w.left,s.right-=w.right,s.top-=w.top,s.bottom-=w.bottom}}},{key:"shouldDo",value:function(t,r,o,s){return!(!t||t.enabled===!1||s&&!t.endOnly||t.endOnly&&!r||o==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(r){return Et(r)})),this.result=Zt(Y({},t.result.coords),Y({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),n})();function Zt(n,t){return{rect:t,coords:n,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function at(n,t){var r=n.defaults,o={start:n.start,set:n.set,beforeEnd:n.beforeEnd,stop:n.stop},s=function(d){var f=d||{};for(var g in f.enabled=f.enabled!==!1,r)g in f||(f[g]=r[g]);var b={options:f,methods:o,name:t,enable:function(){return f.enabled=!0,b},disable:function(){return f.enabled=!1,b}};return b};return t&&typeof t=="string"&&(s._defaults=r,s._methods=o),s}function Rt(n){var t=n.iEvent,r=n.interaction.modification.result;r&&(t.modifiers=r.eventProps)}var Br={id:"modifiers/base",before:["actions"],install:function(n){n.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(n){var t=n.interaction;t.modification=new vn(t)},"interactions:before-action-start":function(n){var t=n.interaction,r=n.interaction.modification;r.start(n,t.coords.start.page),t.edges=r.edges,r.applyToInteraction(n)},"interactions:before-action-move":function(n){var t=n.interaction,r=t.modification,o=r.setAndApply(n);return t.edges=r.edges,o},"interactions:before-action-end":function(n){var t=n.interaction,r=t.modification,o=r.beforeEnd(n);return t.edges=r.startEdges,o},"interactions:action-start":Rt,"interactions:action-move":Rt,"interactions:action-end":Rt,"interactions:after-action-start":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-move":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:stop":function(n){return n.interaction.modification.stop(n)}}},Jn=Br,Qn={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},yn=(function(n){m(r,n);var t=_(r);function r(o,s,d,f,g,b,w){var x;l(this,r),(x=t.call(this,o)).relatedTarget=null,x.screenX=void 0,x.screenY=void 0,x.button=void 0,x.buttons=void 0,x.ctrlKey=void 0,x.shiftKey=void 0,x.altKey=void 0,x.metaKey=void 0,x.page=void 0,x.client=void 0,x.delta=void 0,x.rect=void 0,x.x0=void 0,x.y0=void 0,x.t0=void 0,x.dt=void 0,x.duration=void 0,x.clientX0=void 0,x.clientY0=void 0,x.velocity=void 0,x.speed=void 0,x.swipe=void 0,x.axes=void 0,x.preEnd=void 0,g=g||o.element;var k=o.interactable,A=(k&&k.options||Qn).deltaSource,I=Le(k,g,d),P=f==="start",z=f==="end",q=P?S(x):o.prevEvent,N=P?o.coords.start:z?{page:q.page,client:q.client,timeStamp:o.coords.cur.timeStamp}:o.coords.cur;return x.page=Y({},N.page),x.client=Y({},N.client),x.rect=Y({},o.rect),x.timeStamp=N.timeStamp,z||(x.page.x-=I.x,x.page.y-=I.y,x.client.x-=I.x,x.client.y-=I.y),x.ctrlKey=s.ctrlKey,x.altKey=s.altKey,x.shiftKey=s.shiftKey,x.metaKey=s.metaKey,x.button=s.button,x.buttons=s.buttons,x.target=g,x.currentTarget=g,x.preEnd=b,x.type=w||d+(f||""),x.interactable=k,x.t0=P?o.pointers[o.pointers.length-1].downTime:q.t0,x.x0=o.coords.start.page.x-I.x,x.y0=o.coords.start.page.y-I.y,x.clientX0=o.coords.start.client.x-I.x,x.clientY0=o.coords.start.client.y-I.y,x.delta=P||z?{x:0,y:0}:{x:x[A].x-q[A].x,y:x[A].y-q[A].y},x.dt=o.coords.delta.timeStamp,x.duration=x.timeStamp-x.t0,x.velocity=Y({},o.coords.velocity[A]),x.speed=Ze(x.velocity.x,x.velocity.y),x.swipe=z||f==="inertiastart"?x.getSwipe():null,x}return u(r,[{key:"getSwipe",value:function(){var o=this._interaction;if(o.prevEvent.speed<600||this.timeStamp-o.prevEvent.timeStamp>150)return null;var s=180*Math.atan2(o.prevEvent.velocityY,o.prevEvent.velocityX)/Math.PI;s<0&&(s+=360);var d=112.5<=s&&s<247.5,f=202.5<=s&&s<337.5;return{up:f,down:!f&&22.5<=s&&s<157.5,left:d,right:!d&&(292.5<=s||s<67.5),angle:s,speed:o.prevEvent.speed,velocity:{x:o.prevEvent.velocityX,y:o.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),r})(ce);Object.defineProperties(yn.prototype,{pageX:{get:function(){return this.page.x},set:function(n){this.page.x=n}},pageY:{get:function(){return this.page.y},set:function(n){this.page.y=n}},clientX:{get:function(){return this.client.x},set:function(n){this.client.x=n}},clientY:{get:function(){return this.client.y},set:function(n){this.client.y=n}},dx:{get:function(){return this.delta.x},set:function(n){this.delta.x=n}},dy:{get:function(){return this.delta.y},set:function(n){this.delta.y=n}},velocityX:{get:function(){return this.velocity.x},set:function(n){this.velocity.x=n}},velocityY:{get:function(){return this.velocity.y},set:function(n){this.velocity.y=n}}});var jr=u((function n(t,r,o,s,d){l(this,n),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=r,this.event=o,this.downTime=s,this.downTarget=d})),Nr=(function(n){return n.interactable="",n.element="",n.prepared="",n.pointerIsDown="",n.pointerWasMoved="",n._proxy="",n})({}),Zn=(function(n){return n.start="",n.move="",n.end="",n.stop="",n.interacting="",n})({}),qr=0,Hr=(function(){function n(t){var r=this,o=t.pointerType,s=t.scopeFire;l(this,n),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Dt((function(x){this.move(x)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=qr++,this._scopeFire=s,this.pointerType=o;var d=this;this._proxy={};var f=function(x){Object.defineProperty(r._proxy,x,{get:function(){return d[x]}})};for(var g in Nr)f(g);var b=function(x){Object.defineProperty(r._proxy,x,{value:function(){return d[x].apply(d,arguments)}})};for(var w in Zn)b(w);this._scopeFire("interactions:new",{interaction:this})}return u(n,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,r,o){var s=this.updatePointer(t,r,o,!0),d=this.pointers[s];this._scopeFire("interactions:down",{pointer:t,event:r,eventTarget:o,pointerIndex:s,pointerInfo:d,type:"down",interaction:this})}},{key:"start",value:function(t,r,o){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!r.options[t.name].enabled)&&(hn(this.prepared,t),this.interactable=r,this.element=o,this.rect=r.getRect(o),this.edges=this.prepared.edges?Y({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,r,o){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,r,o,!1);var s,d,f=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(s=this.coords.cur.client.x-this.coords.start.client.x,d=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=Ze(s,d)>this.pointerMoveTolerance);var g,b,w,x=this.getPointerIndex(t),k={pointer:t,pointerIndex:x,pointerInfo:this.pointers[x],event:r,type:"move",eventTarget:o,dx:s,dy:d,duplicate:f,interaction:this};f||(g=this.coords.velocity,b=this.coords.delta,w=Math.max(b.timeStamp/1e3,.001),g.page.x=b.page.x/w,g.page.y=b.page.y/w,g.client.x=b.client.x/w,g.client.y=b.client.y/w,g.timeStamp=w),this._scopeFire("interactions:move",k),f||this.simulation||(this.interacting()&&(k.type=null,this.move(k)),this.pointerWasMoved&&vt(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||Vt(this.coords.delta),(t=Y({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,r,o,s){var d=this.getPointerIndex(t);d===-1&&(d=this.updatePointer(t,r,o,!1));var f=/cancel$/i.test(r.type)?"cancel":"up";this._scopeFire("interactions:".concat(f),{pointer:t,pointerIndex:d,pointerInfo:this.pointers[d],event:r,eventTarget:o,type:f,curEventTarget:s,interaction:this}),this.simulation||this.end(r),this.removePointer(t,r)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var r;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(r=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,r===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var r=xt(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:he(this.pointers,(function(o){return o.id===r}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,r,o,s){var d,f,g,b=xt(t),w=this.getPointerIndex(t),x=this.pointers[w];return s=s!==!1&&(s||/(down|start)$/i.test(r.type)),x?x.pointer=t:(x=new jr(b,t,r,null,null),w=this.pointers.length,this.pointers.push(x)),R(this.coords.cur,this.pointers.map((function(k){return k.pointer})),this._now()),d=this.coords.delta,f=this.coords.prev,g=this.coords.cur,d.page.x=g.page.x-f.page.x,d.page.y=g.page.y-f.page.y,d.client.x=g.client.x-f.client.x,d.client.y=g.client.y-f.client.y,d.timeStamp=g.timeStamp-f.timeStamp,s&&(this.pointerIsDown=!0,x.downTime=this.coords.cur.timeStamp,x.downTarget=o,mt(this.downPointer,t),this.interacting()||(vt(this.coords.start,this.coords.cur),vt(this.coords.prev,this.coords.cur),this.downEvent=r,this.pointerWasMoved=!1)),this._updateLatestPointer(t,r,o),this._scopeFire("interactions:update-pointer",{pointer:t,event:r,eventTarget:o,down:s,pointerInfo:x,pointerIndex:w,interaction:this}),w}},{key:"removePointer",value:function(t,r){var o=this.getPointerIndex(t);if(o!==-1){var s=this.pointers[o];this._scopeFire("interactions:remove-pointer",{pointer:t,event:r,eventTarget:null,pointerIndex:o,pointerInfo:s,interaction:this}),this.pointers.splice(o,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,r,o){this._latestPointer.pointer=t,this._latestPointer.event=r,this._latestPointer.eventTarget=o}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,r,o,s){return new yn(this,t,this.prepared.name,r,this.element,o,s)}},{key:"_fireEvent",value:function(t){var r;(r=this.interactable)==null||r.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var r=t.event,o=t.phase,s=t.preEnd,d=t.type,f=this.rect;if(f&&o==="move"&&(ue(this.edges,f,this.coords.delta[this.interactable.options.deltaSource]),f.width=f.right-f.left,f.height=f.bottom-f.top),this._scopeFire("interactions:before-action-".concat(o),t)===!1)return!1;var g=t.iEvent=this._createPreparedEvent(r,o,s,d);return this._scopeFire("interactions:action-".concat(o),t),o==="start"&&(this.prevEvent=g),this._fireEvent(g),this._scopeFire("interactions:after-action-".concat(o),t),!0}},{key:"_now",value:function(){return Date.now()}}]),n})();function ei(n){ti(n.interaction)}function ti(n){if(!(function(r){return!(!r.offset.pending.x&&!r.offset.pending.y)})(n))return!1;var t=n.offset.pending;return bn(n.coords.cur,t),bn(n.coords.delta,t),ue(n.edges,n.rect,t),t.x=0,t.y=0,!0}function Yr(n){var t=n.x,r=n.y;this.offset.pending.x+=t,this.offset.pending.y+=r,this.offset.total.x+=t,this.offset.total.y+=r}function bn(n,t){var r=n.page,o=n.client,s=t.x,d=t.y;r.x+=s,r.y+=d,o.x+=s,o.y+=d}Zn.offsetBy="";var $r={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(n){n.Interaction.prototype.offsetBy=Yr},listeners:{"interactions:new":function(n){n.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(n){return(function(t){t.pointerIsDown&&(bn(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(n.interaction)},"interactions:before-action-start":ei,"interactions:before-action-move":ei,"interactions:before-action-end":function(n){var t=n.interaction;if(ti(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(n){var t=n.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},ni=$r,Kr=(function(){function n(t){l(this,n),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return u(n,[{key:"start",value:function(t){var r=this.interaction,o=en(r);if(!o||!o.enabled)return!1;var s=r.coords.velocity.client,d=Ze(s.x,s.y),f=this.modification||(this.modification=new vn(r));if(f.copyFrom(r.modification),this.t0=r._now(),this.allowResume=o.allowResume,this.v0=d,this.currentOffset={x:0,y:0},this.startCoords=r.coords.cur.page,this.modifierArg=f.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-r.coords.cur.timeStamp<50&&d>o.minSpeed&&d>o.endSpeed)this.startInertia();else{if(f.result=f.setAll(this.modifierArg),!f.result.changed)return!1;this.startSmoothEnd()}return r.modification.result.rect=null,r.offsetBy(this.targetOffset),r._doPhase({interaction:r,event:t,phase:"inertiastart"}),r.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),r.modification.result.rect=null,this.active=!0,r.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,r=this.interaction.coords.velocity.client,o=en(this.interaction),s=o.resistance,d=-Math.log(o.endSpeed/this.v0)/s;this.targetOffset={x:(r.x-d)/s,y:(r.y-d)/s},this.te=d,this.lambda_v0=s/this.v0,this.one_ve_v0=1-o.endSpeed/this.v0;var f=this.modification,g=this.modifierArg;g.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},f.result=f.setAll(g),f.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+f.result.delta.x,y:this.targetOffset.y+f.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var r=this;this.timeout=ot.request((function(){r.active&&t()}))}},{key:"inertiaTick",value:function(){var t,r,o,s,d,f,g,b=this,w=this.interaction,x=en(w).resistance,k=(w._now()-this.t0)/1e3;if(k<this.te){var A,I=1-(Math.exp(-x*k)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,r=0,o=this.targetOffset.x,s=this.targetOffset.y,d=this.modifiedOffset.x,f=this.modifiedOffset.y,A={x:ii(g=I,t,o,d),y:ii(g,r,s,f)}):A={x:this.targetOffset.x*I,y:this.targetOffset.y*I};var P={x:A.x-this.currentOffset.x,y:A.y-this.currentOffset.y};this.currentOffset.x+=P.x,this.currentOffset.y+=P.y,w.offsetBy(P),w.move(),this.onNextFrame((function(){return b.inertiaTick()}))}else w.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,r=this.interaction,o=r._now()-this.t0,s=en(r).smoothEndDuration;if(o<s){var d={x:ri(o,0,this.targetOffset.x,s),y:ri(o,0,this.targetOffset.y,s)},f={x:d.x-this.currentOffset.x,y:d.y-this.currentOffset.y};this.currentOffset.x+=f.x,this.currentOffset.y+=f.y,r.offsetBy(f),r.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else r.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var r=t.pointer,o=t.event,s=t.eventTarget,d=this.interaction;d.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),d.updatePointer(r,o,s,!0),d._doPhase({interaction:d,event:o,phase:"resume"}),vt(d.coords.prev,d.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,ot.cancel(this.timeout)}}]),n})();function en(n){var t=n.interactable,r=n.prepared;return t&&t.options&&r.name&&t.options[r.name].inertia}var Ur={id:"inertia",before:["modifiers","actions"],install:function(n){var t=n.defaults;n.usePlugin(ni),n.usePlugin(Jn),n.actions.phases.inertiastart=!0,n.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(n){var t=n.interaction;t.inertia=new Kr(t)},"interactions:before-action-end":function(n){var t=n.interaction,r=n.event;return(!t._interacting||t.simulation||!t.inertia.start(r))&&null},"interactions:down":function(n){var t=n.interaction,r=n.eventTarget,o=t.inertia;if(o.active)for(var s=r;C.element(s);){if(s===t.element){o.resume(n);break}s=qe(s)}},"interactions:stop":function(n){var t=n.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(n){var t=n.interaction.modification;t.stop(n),t.start(n,n.interaction.coords.cur.page),t.applyToInteraction(n)},"interactions:before-action-inertiastart":function(n){return n.interaction.modification.setAndApply(n)},"interactions:action-resume":Rt,"interactions:action-inertiastart":Rt,"interactions:after-action-inertiastart":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-resume":function(n){return n.interaction.modification.restoreInteractionCoords(n)}}};function ii(n,t,r,o){var s=1-n;return s*s*t+2*s*n*r+n*n*o}function ri(n,t,r,o){return-r*(n/=o)*(n-2)+t}var Wr=Ur;function oi(n,t){for(var r=0;r<t.length;r++){var o=t[r];if(n.immediatePropagationStopped)break;o(n)}}var ai=(function(){function n(t){l(this,n),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=Y({},t||{})}return u(n,[{key:"fire",value:function(t){var r,o=this.global;(r=this.types[t.type])&&oi(t,r),!t.propagationStopped&&o&&(r=o[t.type])&&oi(t,r)}},{key:"on",value:function(t,r){var o=Ue(t,r);for(t in o)this.types[t]=_e(this.types[t]||[],o[t])}},{key:"off",value:function(t,r){var o=Ue(t,r);for(t in o){var s=this.types[t];if(s&&s.length)for(var d=0,f=o[t];d<f.length;d++){var g=f[d],b=s.indexOf(g);b!==-1&&s.splice(b,1)}}}},{key:"getRect",value:function(t){return null}}]),n})(),Xr=(function(){function n(t){l(this,n),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,mt(this,t)}return u(n,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),n})();function Bt(n){return C.object(n)?{capture:!!n.capture,passive:!!n.passive}:{capture:!!n,passive:!1}}function tn(n,t){return n===t||(typeof n=="boolean"?!!t.capture===n&&!t.passive:!!n.capture==!!t.capture&&!!n.passive==!!t.passive)}var Vr={id:"events",install:function(n){var t,r=[],o={},s=[],d={add:f,remove:g,addDelegate:function(x,k,A,I,P){var z=Bt(P);if(!o[A]){o[A]=[];for(var q=0;q<s.length;q++){var N=s[q];f(N,A,b),f(N,A,w,!0)}}var $=o[A],J=Be($,(function(ee){return ee.selector===x&&ee.context===k}));J||(J={selector:x,context:k,listeners:[]},$.push(J)),J.listeners.push({func:I,options:z})},removeDelegate:function(x,k,A,I,P){var z,q=Bt(P),N=o[A],$=!1;if(N)for(z=N.length-1;z>=0;z--){var J=N[z];if(J.selector===x&&J.context===k){for(var ee=J.listeners,W=ee.length-1;W>=0;W--){var Q=ee[W];if(Q.func===I&&tn(Q.options,q)){ee.splice(W,1),ee.length||(N.splice(z,1),g(k,A,b),g(k,A,w,!0)),$=!0;break}}if($)break}}},delegateListener:b,delegateUseCapture:w,delegatedEvents:o,documents:s,targets:r,supportsOptions:!1,supportsPassive:!1};function f(x,k,A,I){if(x.addEventListener){var P=Bt(I),z=Be(r,(function(q){return q.eventTarget===x}));z||(z={eventTarget:x,events:{}},r.push(z)),z.events[k]||(z.events[k]=[]),Be(z.events[k],(function(q){return q.func===A&&tn(q.options,P)}))||(x.addEventListener(k,A,d.supportsOptions?P:P.capture),z.events[k].push({func:A,options:P}))}}function g(x,k,A,I){if(x.addEventListener&&x.removeEventListener){var P=he(r,(function(Ie){return Ie.eventTarget===x})),z=r[P];if(z&&z.events)if(k!=="all"){var q=!1,N=z.events[k];if(N){if(A==="all"){for(var $=N.length-1;$>=0;$--){var J=N[$];g(x,k,J.func,J.options)}return}for(var ee=Bt(I),W=0;W<N.length;W++){var Q=N[W];if(Q.func===A&&tn(Q.options,ee)){x.removeEventListener(k,A,d.supportsOptions?ee:ee.capture),N.splice(W,1),N.length===0&&(delete z.events[k],q=!0);break}}}q&&!Object.keys(z.events).length&&r.splice(P,1)}else for(k in z.events)z.events.hasOwnProperty(k)&&g(x,k,"all")}}function b(x,k){for(var A=Bt(k),I=new Xr(x),P=o[x.type],z=H(x)[0],q=z;C.element(q);){for(var N=0;N<P.length;N++){var $=P[N],J=$.selector,ee=$.context;if($e(q,J)&&Xe(ee,z)&&Xe(ee,q)){var W=$.listeners;I.currentTarget=q;for(var Q=0;Q<W.length;Q++){var Ie=W[Q];tn(Ie.options,A)&&Ie.func(I)}}}q=qe(q)}}function w(x){return b(x,!0)}return(t=n.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return d.supportsOptions=!0},get passive(){return d.supportsPassive=!0}}),n.events=d,d}},xn={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(n){for(var t=0,r=xn.methodOrder;t<r.length;t++){var o=r[t],s=xn[o](n);if(s)return s}return null},simulationResume:function(n){var t=n.pointerType,r=n.eventType,o=n.eventTarget,s=n.scope;if(!/down|start/i.test(r))return null;for(var d=0,f=s.interactions.list;d<f.length;d++){var g=f[d],b=o;if(g.simulation&&g.simulation.allowResume&&g.pointerType===t)for(;b;){if(b===g.element)return g;b=qe(b)}}return null},mouseOrPen:function(n){var t,r=n.pointerId,o=n.pointerType,s=n.eventType,d=n.scope;if(o!=="mouse"&&o!=="pen")return null;for(var f=0,g=d.interactions.list;f<g.length;f++){var b=g[f];if(b.pointerType===o){if(b.simulation&&!si(b,r))continue;if(b.interacting())return b;t||(t=b)}}if(t)return t;for(var w=0,x=d.interactions.list;w<x.length;w++){var k=x[w];if(!(k.pointerType!==o||/down/i.test(s)&&k.simulation))return k}return null},hasPointer:function(n){for(var t=n.pointerId,r=0,o=n.scope.interactions.list;r<o.length;r++){var s=o[r];if(si(s,t))return s}return null},idle:function(n){for(var t=n.pointerType,r=0,o=n.scope.interactions.list;r<o.length;r++){var s=o[r];if(s.pointers.length===1){var d=s.interactable;if(d&&(!d.options.gesture||!d.options.gesture.enabled))continue}else if(s.pointers.length>=2)continue;if(!s.interacting()&&t===s.pointerType)return s}return null}};function si(n,t){return n.pointers.some((function(r){return r.id===t}))}var Gr=xn,_n=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function li(n,t){return function(r){var o=t.interactions.list,s=ke(r),d=H(r),f=d[0],g=d[1],b=[];if(/^touch/.test(r.type)){t.prevTouchTime=t.now();for(var w=0,x=r.changedTouches;w<x.length;w++){var k=x[w],A={pointer:k,pointerId:xt(k),pointerType:s,eventType:r.type,eventTarget:f,curEventTarget:g,scope:t},I=ci(A);b.push([A.pointer,A.eventTarget,A.curEventTarget,I])}}else{var P=!1;if(!Ae.supportsPointerEvent&&/mouse/.test(r.type)){for(var z=0;z<o.length&&!P;z++)P=o[z].pointerType!=="mouse"&&o[z].pointerIsDown;P=P||t.now()-t.prevTouchTime<500||r.timeStamp===0}if(!P){var q={pointer:r,pointerId:xt(r),pointerType:s,eventType:r.type,curEventTarget:g,eventTarget:f,scope:t},N=ci(q);b.push([q.pointer,q.eventTarget,q.curEventTarget,N])}}for(var $=0;$<b.length;$++){var J=b[$],ee=J[0],W=J[1],Q=J[2];J[3][n](ee,r,W,Q)}}}function ci(n){var t=n.pointerType,r=n.scope,o={interaction:Gr.search(n),searchDetails:n};return r.fire("interactions:find",o),o.interaction||r.interactions.new({pointerType:t})}function wn(n,t){var r=n.doc,o=n.scope,s=n.options,d=o.interactions.docEvents,f=o.events,g=f[t];for(var b in o.browser.isIOS&&!s.events&&(s.events={passive:!1}),f.delegatedEvents)g(r,b,f.delegateListener),g(r,b,f.delegateUseCapture,!0);for(var w=s&&s.events,x=0;x<d.length;x++){var k=d[x];g(r,k.type,k.listener,w)}}var Jr={id:"core/interactions",install:function(n){for(var t={},r=0;r<_n.length;r++){var o=_n[r];t[o]=li(o,n)}var s,d=Ae.pEventTypes;function f(){for(var g=0,b=n.interactions.list;g<b.length;g++){var w=b[g];if(w.pointerIsDown&&w.pointerType==="touch"&&!w._interacting)for(var x=function(){var I=A[k];n.documents.some((function(P){return Xe(P.doc,I.downTarget)}))||w.removePointer(I.pointer,I.event)},k=0,A=w.pointers;k<A.length;k++)x()}}(s=de.PointerEvent?[{type:d.down,listener:f},{type:d.down,listener:t.pointerDown},{type:d.move,listener:t.pointerMove},{type:d.up,listener:t.pointerUp},{type:d.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:f},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(g){for(var b=0,w=n.interactions.list;b<w.length;b++)w[b].documentBlur(g)}}),n.prevTouchTime=0,n.Interaction=(function(g){m(w,g);var b=_(w);function w(){return l(this,w),b.apply(this,arguments)}return u(w,[{key:"pointerMoveTolerance",get:function(){return n.interactions.pointerMoveTolerance},set:function(x){n.interactions.pointerMoveTolerance=x}},{key:"_now",value:function(){return n.now()}}]),w})(Hr),n.interactions={list:[],new:function(g){g.scopeFire=function(w,x){return n.fire(w,x)};var b=new n.Interaction(g);return n.interactions.list.push(b),b},listeners:t,docEvents:s,pointerMoveTolerance:1},n.usePlugin(Gn)},listeners:{"scope:add-document":function(n){return wn(n,"add")},"scope:remove-document":function(n){return wn(n,"remove")},"interactable:unset":function(n,t){for(var r=n.interactable,o=t.interactions.list.length-1;o>=0;o--){var s=t.interactions.list[o];s.interactable===r&&(s.stop(),t.fire("interactions:destroy",{interaction:s}),s.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(o,1))}}},onDocSignal:wn,doOnInteractions:li,methodNames:_n},Qr=Jr,st=(function(n){return n[n.On=0]="On",n[n.Off=1]="Off",n})(st||{}),Zr=(function(){function n(t,r,o,s){l(this,n),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new ai,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=r.actions,this.target=t,this._context=r.context||o,this._win=O(Wt(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=s,this.set(r)}return u(n,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,r){return C.func(r.onstart)&&this.on("".concat(t,"start"),r.onstart),C.func(r.onmove)&&this.on("".concat(t,"move"),r.onmove),C.func(r.onend)&&this.on("".concat(t,"end"),r.onend),C.func(r.oninertiastart)&&this.on("".concat(t,"inertiastart"),r.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,r,o){var s,d=this,f=(s=this._actions.map[t])==null?void 0:s.filterEventType,g=function(b){return(f==null||f(b))&&Qt(b,d._actions)};(C.array(r)||C.object(r))&&this._onOff(st.Off,t,r,void 0,g),(C.array(o)||C.object(o))&&this._onOff(st.On,t,o,void 0,g)}},{key:"setPerAction",value:function(t,r){var o=this._defaults;for(var s in r){var d=s,f=this.options[t],g=r[d];d==="listeners"&&this.updatePerActionListeners(t,f.listeners,g),C.array(g)?f[d]=Re(g):C.plainObject(g)?(f[d]=Y(f[d]||{},Et(g)),C.object(o.perAction[d])&&"enabled"in o.perAction[d]&&(f[d].enabled=g.enabled!==!1)):C.bool(g)&&C.object(o.perAction[d])?f[d].enabled=g:f[d]=g}}},{key:"getRect",value:function(t){return t=t||(C.element(this.target)?this.target:null),C.string(this.target)&&(t=t||this._context.querySelector(this.target)),nt(t)}},{key:"rectChecker",value:function(t){var r=this;return C.func(t)?(this.getRect=function(o){var s=Y({},t.apply(r,o));return"width"in s||(s.width=s.right-s.left,s.height=s.bottom-s.top),s},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,r){if(Wt(r)||C.object(r)){for(var o in this.options[t]=r,this._actions.map)this.options[o][t]=r;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return C.string(t)?Array.from(this._context.querySelectorAll(t)):C.func(t)&&t.getAllElements?t.getAllElements():C.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||Xe(this._context,t)}},{key:"testIgnoreAllow",value:function(t,r,o){return!this.testIgnore(t.ignoreFrom,r,o)&&this.testAllow(t.allowFrom,r,o)}},{key:"testAllow",value:function(t,r,o){return!t||!!C.element(o)&&(C.string(t)?De(o,t,r):!!C.element(t)&&Xe(t,o))}},{key:"testIgnore",value:function(t,r,o){return!(!t||!C.element(o))&&(C.string(t)?De(o,t,r):!!C.element(t)&&Xe(t,o))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,r,o,s,d){C.object(r)&&!C.array(r)&&(s=o,o=null);var f=Ue(r,o,d);for(var g in f){g==="wheel"&&(g=Ae.wheelEvent);for(var b=0,w=f[g];b<w.length;b++){var x=w[b];Qt(g,this._actions)?this.events[t===st.On?"on":"off"](g,x):C.string(this.target)?this._scopeEvents[t===st.On?"addDelegate":"removeDelegate"](this.target,this._context,g,x,s):this._scopeEvents[t===st.On?"add":"remove"](this.target,g,x,s)}}return this}},{key:"on",value:function(t,r,o){return this._onOff(st.On,t,r,o)}},{key:"off",value:function(t,r,o){return this._onOff(st.Off,t,r,o)}},{key:"set",value:function(t){var r=this._defaults;for(var o in C.object(t)||(t={}),this.options=Et(r.base),this._actions.methodDict){var s=o,d=this._actions.methodDict[s];this.options[s]={},this.setPerAction(s,Y(Y({},r.perAction),r.actions[s])),this[d](t[s])}for(var f in t)f!=="getRect"?C.func(this[f])&&this[f](t[f]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(C.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var r=this._scopeEvents.delegatedEvents[t],o=r.length-1;o>=0;o--){var s=r[o],d=s.selector,f=s.context,g=s.listeners;d===this.target&&f===this._context&&r.splice(o,1);for(var b=g.length-1;b>=0;b--)this._scopeEvents.removeDelegate(this.target,this._context,t,g[b][0],g[b][1])}else this._scopeEvents.remove(this.target,"all")}}]),n})(),eo=(function(){function n(t){var r=this;l(this,n),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(o){var s=o.interactable,d=s.target,f=C.string(d)?r.selectorMap[d]:d[r.scope.id],g=he(f,(function(b){return b===s}));f.splice(g,1)}})}return u(n,[{key:"new",value:function(t,r){r=Y(r||{},{actions:this.scope.actions});var o=new this.scope.Interactable(t,r,this.scope.document,this.scope.events);return this.scope.addDocument(o._doc),this.list.push(o),C.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(o)):(o.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(o)),this.scope.fire("interactable:new",{target:t,options:r,interactable:o,win:this.scope._win}),o}},{key:"getExisting",value:function(t,r){var o=r&&r.context||this.scope.document,s=C.string(t),d=s?this.selectorMap[t]:t[this.scope.id];if(d)return Be(d,(function(f){return f._context===o&&(s||f.inContext(t))}))}},{key:"forEachMatch",value:function(t,r){for(var o=0,s=this.list;o<s.length;o++){var d=s[o],f=void 0;if((C.string(d.target)?C.element(t)&&$e(t,d.target):t===d.target)&&d.inContext(t)&&(f=r(d)),f!==void 0)return f}}}]),n})(),to=(function(){function n(){var t=this;l(this,n),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=Ae,this.defaults=Et(Qn),this.Eventable=ai,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(o){var s=function d(f,g){var b=o.interactables.getExisting(f,g);return b||((b=o.interactables.new(f,g)).events.global=d.globalEvents),b};return s.getPointerAverage=ie,s.getTouchBBox=re,s.getTouchDistance=ae,s.getTouchAngle=pe,s.getElementRect=nt,s.getElementClientRect=gt,s.matchesSelector=$e,s.closest=Mt,s.globalEvents={},s.version="1.10.27",s.scope=o,s.use=function(d,f){return this.scope.usePlugin(d,f),this},s.isSet=function(d,f){return!!this.scope.interactables.get(d,f&&f.context)},s.on=Dt((function(d,f,g){if(C.string(d)&&d.search(" ")!==-1&&(d=d.trim().split(/ +/)),C.array(d)){for(var b=0,w=d;b<w.length;b++){var x=w[b];this.on(x,f,g)}return this}if(C.object(d)){for(var k in d)this.on(k,d[k],f);return this}return Qt(d,this.scope.actions)?this.globalEvents[d]?this.globalEvents[d].push(f):this.globalEvents[d]=[f]:this.scope.events.add(this.scope.document,d,f,{options:g}),this}),"The interact.on() method is being deprecated"),s.off=Dt((function(d,f,g){if(C.string(d)&&d.search(" ")!==-1&&(d=d.trim().split(/ +/)),C.array(d)){for(var b=0,w=d;b<w.length;b++){var x=w[b];this.off(x,f,g)}return this}if(C.object(d)){for(var k in d)this.off(k,d[k],f);return this}var A;return Qt(d,this.scope.actions)?d in this.globalEvents&&(A=this.globalEvents[d].indexOf(f))!==-1&&this.globalEvents[d].splice(A,1):this.scope.events.remove(this.scope.document,d,f,g),this}),"The interact.off() method is being deprecated"),s.debug=function(){return this.scope},s.supportsTouch=function(){return Ae.supportsTouch},s.supportsPointerEvent=function(){return Ae.supportsPointerEvent},s.stop=function(){for(var d=0,f=this.scope.interactions.list;d<f.length;d++)f[d].stop();return this},s.pointerMoveTolerance=function(d){return C.number(d)?(this.scope.interactions.pointerMoveTolerance=d,this):this.scope.interactions.pointerMoveTolerance},s.addDocument=function(d,f){this.scope.addDocument(d,f)},s.removeDocument=function(d){this.scope.removeDocument(d)},s})(this),this.InteractEvent=yn,this.Interactable=void 0,this.interactables=new eo(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(o){return t.removeDocument(o.target)};var r=this;this.Interactable=(function(o){m(d,o);var s=_(d);function d(){return l(this,d),s.apply(this,arguments)}return u(d,[{key:"_defaults",get:function(){return r.defaults}},{key:"set",value:function(f){return E(v(d.prototype),"set",this).call(this,f),r.fire("interactable:set",{options:f,interactable:this}),this}},{key:"unset",value:function(){E(v(d.prototype),"unset",this).call(this);var f=r.interactables.list.indexOf(this);f<0||(r.interactables.list.splice(f,1),r.fire("interactable:unset",{interactable:this}))}}]),d})(Zr)}return u(n,[{key:"addListeners",value:function(t,r){this.listenerMaps.push({id:r,map:t})}},{key:"fire",value:function(t,r){for(var o=0,s=this.listenerMaps;o<s.length;o++){var d=s[o].map[t];if(d&&d(r,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(r,o){return r.isInitialized=!0,C.window(o)&&D(o),de.init(o),Ae.init(o),ot.init(o),r.window=o,r.document=o.document,r.usePlugin(Qr),r.usePlugin(Vr),r})(this,t)}},{key:"pluginIsInstalled",value:function(t){var r=t.id;return r?!!this._plugins.map[r]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,r){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,r),t.listeners&&t.before){for(var o=0,s=this.listenerMaps.length,d=t.before.reduce((function(g,b){return g[b]=!0,g[di(b)]=!0,g}),{});o<s;o++){var f=this.listenerMaps[o].id;if(f&&(d[f]||d[di(f)]))break}this.listenerMaps.splice(o,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,r){if(this.getDocIndex(t)!==-1)return!1;var o=O(t);r=r?Y({},r):{},this.documents.push({doc:t,options:r}),this.events.documents.push(t),t!==this.document&&this.events.add(o,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:o,scope:this,options:r})}},{key:"removeDocument",value:function(t){var r=this.getDocIndex(t),o=O(t),s=this.documents[r].options;this.events.remove(o,"unload",this.onWindowUnload),this.documents.splice(r,1),this.events.documents.splice(r,1),this.fire("scope:remove-document",{doc:t,window:o,scope:this,options:s})}},{key:"getDocIndex",value:function(t){for(var r=0;r<this.documents.length;r++)if(this.documents[r].doc===t)return r;return-1}},{key:"getDocOptions",value:function(t){var r=this.getDocIndex(t);return r===-1?null:this.documents[r].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),n})();function di(n){return n&&n.replace(/\/.*$/,"")}var ui=new to,Pe=ui.interactStatic,no=typeof globalThis!="undefined"?globalThis:window;ui.init(no);var io=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(n){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(o){var s=o[0],d=o[1];return s in n||d in n})),r=function(o,s){for(var d=n.range,f=n.limits,g=f===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:f,b=n.offset,w=b===void 0?{x:0,y:0}:b,x={range:d,grid:n,x:null,y:null},k=0;k<t.length;k++){var A=t[k],I=A[0],P=A[1],z=Math.round((o-w.x)/n[I]),q=Math.round((s-w.y)/n[P]);x[I]=Math.max(g.left,Math.min(g.right,z*n[I]+w.x)),x[P]=Math.max(g.top,Math.min(g.bottom,q*n[P]+w.y))}return x};return r.grid=n,r.coordFields=t,r}}),ro={id:"snappers",install:function(n){var t=n.interactStatic;t.snappers=Y(t.snappers||{},io),t.createSnapGrid=t.snappers.grid}},oo=ro,ao={start:function(n){var t=n.state,r=n.rect,o=n.edges,s=n.pageCoords,d=t.options,f=d.ratio,g=d.enabled,b=t.options,w=b.equalDelta,x=b.modifiers;f==="preserve"&&(f=r.width/r.height),t.startCoords=Y({},s),t.startRect=Y({},r),t.ratio=f,t.equalDelta=w;var k=t.linkedEdges={top:o.top||o.left&&!o.bottom,left:o.left||o.top&&!o.right,bottom:o.bottom||o.right&&!o.top,right:o.right||o.bottom&&!o.left};if(t.xIsPrimaryAxis=!(!o.left&&!o.right),t.equalDelta){var A=(k.left?1:-1)*(k.top?1:-1);t.edgeSign={x:A,y:A}}else t.edgeSign={x:k.left?-1:1,y:k.top?-1:1};if(g!==!1&&Y(o,k),x!=null&&x.length){var I=new vn(n.interaction);I.copyFrom(n.interaction.modification),I.prepareStates(x),t.subModification=I,I.startAll(i({},n))}},set:function(n){var t=n.state,r=n.rect,o=n.coords,s=t.linkedEdges,d=Y({},o),f=t.equalDelta?so:lo;if(Y(n.edges,s),f(t,t.xIsPrimaryAxis,o,r),!t.subModification)return null;var g=Y({},r);ue(s,g,{x:o.x-d.x,y:o.y-d.y});var b=t.subModification.setAll(i(i({},n),{},{rect:g,edges:s,pageCoords:o,prevCoords:o,prevRect:g})),w=b.delta;return b.changed&&(f(t,Math.abs(w.x)>Math.abs(w.y),b.coords,b.rect),Y(o,b.coords)),b.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function so(n,t,r){var o=n.startCoords,s=n.edgeSign;t?r.y=o.y+(r.x-o.x)*s.y:r.x=o.x+(r.y-o.y)*s.x}function lo(n,t,r,o){var s=n.startRect,d=n.startCoords,f=n.ratio,g=n.edgeSign;if(t){var b=o.width/f;r.y=d.y+(b-s.height)*g.y}else{var w=o.height*f;r.x=d.x+(w-s.width)*g.x}}var co=at(ao,"aspectRatio"),pi=function(){};pi._defaults={};var nn=pi;function ut(n,t,r){return C.func(n)?U(n,t.interactable,t.element,[r.x,r.y,t]):U(n,t.interactable,t.element)}var rn={start:function(n){var t=n.rect,r=n.startOffset,o=n.state,s=n.interaction,d=n.pageCoords,f=o.options,g=f.elementRect,b=Y({left:0,top:0,right:0,bottom:0},f.offset||{});if(t&&g){var w=ut(f.restriction,s,d);if(w){var x=w.right-w.left-t.width,k=w.bottom-w.top-t.height;x<0&&(b.left+=x,b.right+=x),k<0&&(b.top+=k,b.bottom+=k)}b.left+=r.left-t.width*g.left,b.top+=r.top-t.height*g.top,b.right+=r.right-t.width*(1-g.right),b.bottom+=r.bottom-t.height*(1-g.bottom)}o.offset=b},set:function(n){var t=n.coords,r=n.interaction,o=n.state,s=o.options,d=o.offset,f=ut(s.restriction,r,t);if(f){var g=(function(b){return!b||"left"in b&&"top"in b||((b=Y({},b)).left=b.x||0,b.top=b.y||0,b.right=b.right||b.left+b.width,b.bottom=b.bottom||b.top+b.height),b})(f);t.x=Math.max(Math.min(g.right-d.right,t.x),g.left+d.left),t.y=Math.max(Math.min(g.bottom-d.bottom,t.y),g.top+d.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},uo=at(rn,"restrict"),hi={top:1/0,left:1/0,bottom:-1/0,right:-1/0},fi={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function gi(n,t){for(var r=0,o=["top","left","bottom","right"];r<o.length;r++){var s=o[r];s in n||(n[s]=t[s])}return n}var jt={noInner:hi,noOuter:fi,start:function(n){var t,r=n.interaction,o=n.startOffset,s=n.state,d=s.options;d&&(t=ge(ut(d.offset,r,r.coords.start.page))),t=t||{x:0,y:0},s.offset={top:t.y+o.top,left:t.x+o.left,bottom:t.y-o.bottom,right:t.x-o.right}},set:function(n){var t=n.coords,r=n.edges,o=n.interaction,s=n.state,d=s.offset,f=s.options;if(r){var g=Y({},t),b=ut(f.inner,o,g)||{},w=ut(f.outer,o,g)||{};gi(b,hi),gi(w,fi),r.top?t.y=Math.min(Math.max(w.top+d.top,g.y),b.top+d.top):r.bottom&&(t.y=Math.max(Math.min(w.bottom+d.bottom,g.y),b.bottom+d.bottom)),r.left?t.x=Math.min(Math.max(w.left+d.left,g.x),b.left+d.left):r.right&&(t.x=Math.max(Math.min(w.right+d.right,g.x),b.right+d.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},po=at(jt,"restrictEdges"),ho=Y({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(n){}},rn.defaults),fo=at({start:rn.start,set:rn.set,defaults:ho},"restrictRect"),go={width:-1/0,height:-1/0},mo={width:1/0,height:1/0},vo=at({start:function(n){return jt.start(n)},set:function(n){var t=n.interaction,r=n.state,o=n.rect,s=n.edges,d=r.options;if(s){var f=le(ut(d.min,t,n.coords))||go,g=le(ut(d.max,t,n.coords))||mo;r.options={endOnly:d.endOnly,inner:Y({},jt.noInner),outer:Y({},jt.noOuter)},s.top?(r.options.inner.top=o.bottom-f.height,r.options.outer.top=o.bottom-g.height):s.bottom&&(r.options.inner.bottom=o.top+f.height,r.options.outer.bottom=o.top+g.height),s.left?(r.options.inner.left=o.right-f.width,r.options.outer.left=o.right-g.width):s.right&&(r.options.inner.right=o.left+f.width,r.options.outer.right=o.left+g.width),jt.set(n),r.options=d}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),Sn={start:function(n){var t,r=n.interaction,o=n.interactable,s=n.element,d=n.rect,f=n.state,g=n.startOffset,b=f.options,w=b.offsetWithOrigin?(function(A){var I=A.interaction.element,P=ge(U(A.state.options.origin,null,null,[I])),z=P||Le(A.interactable,I,A.interaction.prepared.name);return z})(n):{x:0,y:0};if(b.offset==="startCoords")t={x:r.coords.start.page.x,y:r.coords.start.page.y};else{var x=U(b.offset,o,s,[r]);(t=ge(x)||{x:0,y:0}).x+=w.x,t.y+=w.y}var k=b.relativePoints;f.offsets=d&&k&&k.length?k.map((function(A,I){return{index:I,relativePoint:A,x:g.left-d.width*A.x+t.x,y:g.top-d.height*A.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(n){var t=n.interaction,r=n.coords,o=n.state,s=o.options,d=o.offsets,f=Le(t.interactable,t.element,t.prepared.name),g=Y({},r),b=[];s.offsetWithOrigin||(g.x-=f.x,g.y-=f.y);for(var w=0,x=d;w<x.length;w++)for(var k=x[w],A=g.x-k.x,I=g.y-k.y,P=0,z=s.targets.length;P<z;P++){var q=s.targets[P],N=void 0;(N=C.func(q)?q(A,I,t._proxy,k,P):q)&&b.push({x:(C.number(N.x)?N.x:A)+k.x,y:(C.number(N.y)?N.y:I)+k.y,range:C.number(N.range)?N.range:s.range,source:q,index:P,offset:k})}for(var $={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},J=0;J<b.length;J++){var ee=b[J],W=ee.range,Q=ee.x-g.x,Ie=ee.y-g.y,fe=Ze(Q,Ie),Ne=fe<=W;W===1/0&&$.inRange&&$.range!==1/0&&(Ne=!1),$.target&&!(Ne?$.inRange&&W!==1/0?fe/W<$.distance/$.range:W===1/0&&$.range!==1/0||fe<$.distance:!$.inRange&&fe<$.distance)||($.target=ee,$.distance=fe,$.range=W,$.inRange=Ne,$.delta.x=Q,$.delta.y=Ie)}return $.inRange&&(r.x=$.target.x,r.y=$.target.y),o.closest=$,$},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},yo=at(Sn,"snap"),on={start:function(n){var t=n.state,r=n.edges,o=t.options;if(!r)return null;n.state={options:{targets:null,relativePoints:[{x:r.left?0:1,y:r.top?0:1}],offset:o.offset||"self",origin:{x:0,y:0},range:o.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],Sn.start(n),t.offsets=n.state.offsets,n.state=t},set:function(n){var t=n.interaction,r=n.state,o=n.coords,s=r.options,d=r.offsets,f={x:o.x-d[0].x,y:o.y-d[0].y};r.options=Y({},s),r.options.targets=[];for(var g=0,b=s.targets||[];g<b.length;g++){var w=b[g],x=void 0;if(x=C.func(w)?w(f.x,f.y,t):w){for(var k=0,A=r.targetFields;k<A.length;k++){var I=A[k],P=I[0],z=I[1];if(P in x||z in x){x.x=x[P],x.y=x[z];break}}r.options.targets.push(x)}}var q=Sn.set(n);return r.options=s,q},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},bo=at(on,"snapSize"),kn={aspectRatio:co,restrictEdges:po,restrict:uo,restrictRect:fo,restrictSize:vo,snapEdges:at({start:function(n){var t=n.edges;return t?(n.state.targetFields=n.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],on.start(n)):null},set:on.set,defaults:Y(Et(on.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:yo,snapSize:bo,spring:nn,avoid:nn,transform:nn,rubberband:nn},xo={id:"modifiers",install:function(n){var t=n.interactStatic;for(var r in n.usePlugin(Jn),n.usePlugin(oo),t.modifiers=kn,kn){var o=kn[r],s=o._defaults,d=o._methods;s._methods=d,n.defaults.perAction[r]=s}}},_o=xo,mi=(function(n){m(r,n);var t=_(r);function r(o,s,d,f,g,b){var w;if(l(this,r),mt(S(w=t.call(this,g)),d),d!==s&&mt(S(w),s),w.timeStamp=b,w.originalEvent=d,w.type=o,w.pointerId=xt(s),w.pointerType=ke(s),w.target=f,w.currentTarget=null,o==="tap"){var x=g.getPointerIndex(s);w.dt=w.timeStamp-g.pointers[x].downTime;var k=w.timeStamp-g.tapTime;w.double=!!g.prevTap&&g.prevTap.type!=="doubletap"&&g.prevTap.target===w.target&&k<500}else o==="doubletap"&&(w.dt=s.timeStamp-g.tapTime,w.double=!0);return w}return u(r,[{key:"_subtractOrigin",value:function(o){var s=o.x,d=o.y;return this.pageX-=s,this.pageY-=d,this.clientX-=s,this.clientY-=d,this}},{key:"_addOrigin",value:function(o){var s=o.x,d=o.y;return this.pageX+=s,this.pageY+=d,this.clientX+=s,this.clientY+=d,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),r})(ce),Nt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(n){n.pointerEvents=Nt,n.defaults.actions.pointerEvents=Nt.defaults,Y(n.actions.phaselessTypes,Nt.types)},listeners:{"interactions:new":function(n){var t=n.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(n){var t=n.down,r=n.pointerInfo;!t&&r.hold||(r.hold={duration:1/0,timeout:null})},"interactions:move":function(n,t){var r=n.interaction,o=n.pointer,s=n.event,d=n.eventTarget;n.duplicate||r.pointerIsDown&&!r.pointerWasMoved||(r.pointerIsDown&&En(n),lt({interaction:r,pointer:o,event:s,eventTarget:d,type:"move"},t))},"interactions:down":function(n,t){(function(r,o){for(var s=r.interaction,d=r.pointer,f=r.event,g=r.eventTarget,b=r.pointerIndex,w=s.pointers[b].hold,x=Ge(g),k={interaction:s,pointer:d,event:f,eventTarget:g,type:"hold",targets:[],path:x,node:null},A=0;A<x.length;A++){var I=x[A];k.node=I,o.fire("pointerEvents:collect-targets",k)}if(k.targets.length){for(var P=1/0,z=0,q=k.targets;z<q.length;z++){var N=q[z].eventable.options.holdDuration;N<P&&(P=N)}w.duration=P,w.timeout=setTimeout((function(){lt({interaction:s,eventTarget:g,pointer:d,event:f,type:"hold"},o)}),P)}})(n,t),lt(n,t)},"interactions:up":function(n,t){En(n),lt(n,t),(function(r,o){var s=r.interaction,d=r.pointer,f=r.event,g=r.eventTarget;s.pointerWasMoved||lt({interaction:s,eventTarget:g,pointer:d,event:f,type:"tap"},o)})(n,t)},"interactions:cancel":function(n,t){En(n),lt(n,t)}},PointerEvent:mi,fire:lt,collectEventTargets:vi,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function lt(n,t){var r=n.interaction,o=n.pointer,s=n.event,d=n.eventTarget,f=n.type,g=n.targets,b=g===void 0?vi(n,t):g,w=new mi(f,o,s,d,r,t.now());t.fire("pointerEvents:new",{pointerEvent:w});for(var x={interaction:r,pointer:o,event:s,eventTarget:d,targets:b,type:f,pointerEvent:w},k=0;k<b.length;k++){var A=b[k];for(var I in A.props||{})w[I]=A.props[I];var P=Le(A.eventable,A.node);if(w._subtractOrigin(P),w.eventable=A.eventable,w.currentTarget=A.node,A.eventable.fire(w),w._addOrigin(P),w.immediatePropagationStopped||w.propagationStopped&&k+1<b.length&&b[k+1].node!==w.currentTarget)break}if(t.fire("pointerEvents:fired",x),f==="tap"){var z=w.double?lt({interaction:r,pointer:o,event:s,eventTarget:d,type:"doubletap"},t):w;r.prevTap=z,r.tapTime=z.timeStamp}return w}function vi(n,t){var r=n.interaction,o=n.pointer,s=n.event,d=n.eventTarget,f=n.type,g=r.getPointerIndex(o),b=r.pointers[g];if(f==="tap"&&(r.pointerWasMoved||!b||b.downTarget!==d))return[];for(var w=Ge(d),x={interaction:r,pointer:o,event:s,eventTarget:d,type:f,path:w,targets:[],node:null},k=0;k<w.length;k++){var A=w[k];x.node=A,t.fire("pointerEvents:collect-targets",x)}return f==="hold"&&(x.targets=x.targets.filter((function(I){var P,z;return I.eventable.options.holdDuration===((P=r.pointers[g])==null||(z=P.hold)==null?void 0:z.duration)}))),x.targets}function En(n){var t=n.interaction,r=n.pointerIndex,o=t.pointers[r].hold;o&&o.timeout&&(clearTimeout(o.timeout),o.timeout=null)}var wo=Object.freeze({__proto__:null,default:Nt});function So(n){var t=n.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var ko={id:"pointer-events/holdRepeat",install:function(n){n.usePlugin(Nt);var t=n.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=n.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(n,t){return n["pointerEvents:".concat(t)]=So,n}),{"pointerEvents:new":function(n){var t=n.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(n,t){var r=n.interaction,o=n.pointerEvent,s=n.eventTarget,d=n.targets;if(o.type==="hold"&&d.length){var f=d[0].eventable.options.holdRepeatInterval;f<=0||(r.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:r,eventTarget:s,type:"hold",pointer:o,event:o},t)}),f))}}})},Eo=ko,Co={id:"pointer-events/interactableTargets",install:function(n){var t=n.Interactable;t.prototype.pointerEvents=function(o){return Y(this.events.options,o),this};var r=t.prototype._backCompatOption;t.prototype._backCompatOption=function(o,s){var d=r.call(this,o,s);return d===this&&(this.events.options[o]=s),d}},listeners:{"pointerEvents:collect-targets":function(n,t){var r=n.targets,o=n.node,s=n.type,d=n.eventTarget;t.interactables.forEachMatch(o,(function(f){var g=f.events,b=g.options;g.types[s]&&g.types[s].length&&f.testIgnoreAllow(b,o,d)&&r.push({node:o,eventable:g,props:{interactable:f}})}))},"interactable:new":function(n){var t=n.interactable;t.events.getRect=function(r){return t.getRect(r)}},"interactable:set":function(n,t){var r=n.interactable,o=n.options;Y(r.events.options,t.pointerEvents.defaults),Y(r.events.options,o.pointerEvents||{})}}},Ao=Co,To={id:"pointer-events",install:function(n){n.usePlugin(wo),n.usePlugin(Eo),n.usePlugin(Ao)}},Oo=To,Mo={id:"reflow",install:function(n){var t=n.Interactable;n.actions.phases.reflow=!0,t.prototype.reflow=function(r){return(function(o,s,d){for(var f=o.getAllElements(),g=d.window.Promise,b=g?[]:null,w=function(){var k=f[x],A=o.getRect(k);if(!A)return 1;var I,P=Be(d.interactions.list,(function(N){return N.interacting()&&N.interactable===o&&N.element===k&&N.prepared.name===s.name}));if(P)P.move(),b&&(I=P._reflowPromise||new g((function(N){P._reflowResolve=N})));else{var z=le(A),q=(function(N){return{coords:N,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:z.x,y:z.y},client:{x:z.x,y:z.y},timeStamp:d.now()});I=(function(N,$,J,ee,W){var Q=N.interactions.new({pointerType:"reflow"}),Ie={interaction:Q,event:W,pointer:W,eventTarget:J,phase:"reflow"};Q.interactable=$,Q.element=J,Q.prevEvent=W,Q.updatePointer(W,W,J,!0),Vt(Q.coords.delta),hn(Q.prepared,ee),Q._doPhase(Ie);var fe=N.window,Ne=fe.Promise,We=Ne?new Ne((function(et){Q._reflowResolve=et})):void 0;return Q._reflowPromise=We,Q.start(ee,$,J),Q._interacting?(Q.move(Ie),Q.end(W)):(Q.stop(),Q._reflowResolve()),Q.removePointer(W,W),We})(d,o,k,s,q)}b&&b.push(I)},x=0;x<f.length&&!w();x++);return b&&g.all(b).then((function(){return o}))})(this,r,n)}},listeners:{"interactions:stop":function(n,t){var r=n.interaction;r.pointerType==="reflow"&&(r._reflowResolve&&r._reflowResolve(),(function(o,s){o.splice(o.indexOf(s),1)})(t.interactions.list,r))}}},Po=Mo;if(Pe.use(Gn),Pe.use(ni),Pe.use(Oo),Pe.use(Wr),Pe.use(_o),Pe.use(zr),Pe.use(rt),Pe.use(Cr),Pe.use(Po),Pe.default=Pe,(typeof pt=="undefined"?"undefined":a(pt))==="object"&&pt)try{pt.exports=Pe}catch{}return Pe.default=Pe,Pe}))});var kr=jo(bi(),1);function zi(e){return typeof e=="undefined"||e===null}function No(e){return typeof e=="object"&&e!==null}function qo(e){return Array.isArray(e)?e:zi(e)?[]:[e]}function Ho(e,i){var a,l,c,u;if(i)for(u=Object.keys(i),a=0,l=u.length;a<l;a+=1)c=u[a],e[c]=i[c];return e}function Yo(e,i){var a="",l;for(l=0;l<i;l+=1)a+=e;return a}function $o(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Ko=zi,Uo=No,Wo=qo,Xo=Yo,Vo=$o,Go=Ho,be={isNothing:Ko,isObject:Uo,toArray:Wo,repeat:Xo,isNegativeZero:Vo,extend:Go};function Di(e,i){var a="",l=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(a+='in "'+e.mark.name+'" '),a+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!i&&e.mark.snippet&&(a+=`

`+e.mark.snippet),l+" "+a):l}function Yt(e,i){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=i,this.message=Di(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Yt.prototype=Object.create(Error.prototype);Yt.prototype.constructor=Yt;Yt.prototype.toString=function(i){return this.name+": "+Di(this,i)};var Fe=Yt;function An(e,i,a,l,c){var u="",p="",m=Math.floor(c/2)-1;return l-i>m&&(u=" ... ",i=l-m+u.length),a-l>m&&(p=" ...",a=l+m-p.length),{str:u+e.slice(i,a).replace(/\t/g,"\u2192")+p,pos:l-i+u.length}}function Tn(e,i){return be.repeat(" ",i-e.length)+e}function Jo(e,i){if(i=Object.create(i||null),!e.buffer)return null;i.maxLength||(i.maxLength=79),typeof i.indent!="number"&&(i.indent=1),typeof i.linesBefore!="number"&&(i.linesBefore=3),typeof i.linesAfter!="number"&&(i.linesAfter=2);for(var a=/\r?\n|\r|\0/g,l=[0],c=[],u,p=-1;u=a.exec(e.buffer);)c.push(u.index),l.push(u.index+u[0].length),e.position<=u.index&&p<0&&(p=l.length-2);p<0&&(p=l.length-1);var m="",v,y,S=Math.min(e.line+i.linesAfter,c.length).toString().length,_=i.maxLength-(i.indent+S+3);for(v=1;v<=i.linesBefore&&!(p-v<0);v++)y=An(e.buffer,l[p-v],c[p-v],e.position-(l[p]-l[p-v]),_),m=be.repeat(" ",i.indent)+Tn((e.line-v+1).toString(),S)+" | "+y.str+`
`+m;for(y=An(e.buffer,l[p],c[p],e.position,_),m+=be.repeat(" ",i.indent)+Tn((e.line+1).toString(),S)+" | "+y.str+`
`,m+=be.repeat("-",i.indent+S+3+y.pos)+`^
`,v=1;v<=i.linesAfter&&!(p+v>=c.length);v++)y=An(e.buffer,l[p+v],c[p+v],e.position-(l[p]-l[p+v]),_),m+=be.repeat(" ",i.indent)+Tn((e.line+v+1).toString(),S)+" | "+y.str+`
`;return m.replace(/\n$/,"")}var Qo=Jo,Zo=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],ea=["scalar","sequence","mapping"];function ta(e){var i={};return e!==null&&Object.keys(e).forEach(function(a){e[a].forEach(function(l){i[String(l)]=a})}),i}function na(e,i){if(i=i||{},Object.keys(i).forEach(function(a){if(Zo.indexOf(a)===-1)throw new Fe('Unknown option "'+a+'" is met in definition of "'+e+'" YAML type.')}),this.options=i,this.tag=e,this.kind=i.kind||null,this.resolve=i.resolve||function(){return!0},this.construct=i.construct||function(a){return a},this.instanceOf=i.instanceOf||null,this.predicate=i.predicate||null,this.represent=i.represent||null,this.representName=i.representName||null,this.defaultStyle=i.defaultStyle||null,this.multi=i.multi||!1,this.styleAliases=ta(i.styleAliases||null),ea.indexOf(this.kind)===-1)throw new Fe('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var Ee=na;function xi(e,i){var a=[];return e[i].forEach(function(l){var c=a.length;a.forEach(function(u,p){u.tag===l.tag&&u.kind===l.kind&&u.multi===l.multi&&(c=p)}),a[c]=l}),a}function ia(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},i,a;function l(c){c.multi?(e.multi[c.kind].push(c),e.multi.fallback.push(c)):e[c.kind][c.tag]=e.fallback[c.tag]=c}for(i=0,a=arguments.length;i<a;i+=1)arguments[i].forEach(l);return e}function Mn(e){return this.extend(e)}Mn.prototype.extend=function(i){var a=[],l=[];if(i instanceof Ee)l.push(i);else if(Array.isArray(i))l=l.concat(i);else if(i&&(Array.isArray(i.implicit)||Array.isArray(i.explicit)))i.implicit&&(a=a.concat(i.implicit)),i.explicit&&(l=l.concat(i.explicit));else throw new Fe("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");a.forEach(function(u){if(!(u instanceof Ee))throw new Fe("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(u.loadKind&&u.loadKind!=="scalar")throw new Fe("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(u.multi)throw new Fe("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),l.forEach(function(u){if(!(u instanceof Ee))throw new Fe("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var c=Object.create(Mn.prototype);return c.implicit=(this.implicit||[]).concat(a),c.explicit=(this.explicit||[]).concat(l),c.compiledImplicit=xi(c,"implicit"),c.compiledExplicit=xi(c,"explicit"),c.compiledTypeMap=ia(c.compiledImplicit,c.compiledExplicit),c};var Ri=Mn,Bi=new Ee("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),ji=new Ee("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Ni=new Ee("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),qi=new Ri({explicit:[Bi,ji,Ni]});function ra(e){if(e===null)return!0;var i=e.length;return i===1&&e==="~"||i===4&&(e==="null"||e==="Null"||e==="NULL")}function oa(){return null}function aa(e){return e===null}var Hi=new Ee("tag:yaml.org,2002:null",{kind:"scalar",resolve:ra,construct:oa,predicate:aa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function sa(e){if(e===null)return!1;var i=e.length;return i===4&&(e==="true"||e==="True"||e==="TRUE")||i===5&&(e==="false"||e==="False"||e==="FALSE")}function la(e){return e==="true"||e==="True"||e==="TRUE"}function ca(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Yi=new Ee("tag:yaml.org,2002:bool",{kind:"scalar",resolve:sa,construct:la,predicate:ca,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function da(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function ua(e){return 48<=e&&e<=55}function pa(e){return 48<=e&&e<=57}function ha(e){if(e===null)return!1;var i=e.length,a=0,l=!1,c;if(!i)return!1;if(c=e[a],(c==="-"||c==="+")&&(c=e[++a]),c==="0"){if(a+1===i)return!0;if(c=e[++a],c==="b"){for(a++;a<i;a++)if(c=e[a],c!=="_"){if(c!=="0"&&c!=="1")return!1;l=!0}return l&&c!=="_"}if(c==="x"){for(a++;a<i;a++)if(c=e[a],c!=="_"){if(!da(e.charCodeAt(a)))return!1;l=!0}return l&&c!=="_"}if(c==="o"){for(a++;a<i;a++)if(c=e[a],c!=="_"){if(!ua(e.charCodeAt(a)))return!1;l=!0}return l&&c!=="_"}}if(c==="_")return!1;for(;a<i;a++)if(c=e[a],c!=="_"){if(!pa(e.charCodeAt(a)))return!1;l=!0}return!(!l||c==="_")}function fa(e){var i=e,a=1,l;if(i.indexOf("_")!==-1&&(i=i.replace(/_/g,"")),l=i[0],(l==="-"||l==="+")&&(l==="-"&&(a=-1),i=i.slice(1),l=i[0]),i==="0")return 0;if(l==="0"){if(i[1]==="b")return a*parseInt(i.slice(2),2);if(i[1]==="x")return a*parseInt(i.slice(2),16);if(i[1]==="o")return a*parseInt(i.slice(2),8)}return a*parseInt(i,10)}function ga(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!be.isNegativeZero(e)}var $i=new Ee("tag:yaml.org,2002:int",{kind:"scalar",resolve:ha,construct:fa,predicate:ga,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ma=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function va(e){return!(e===null||!ma.test(e)||e[e.length-1]==="_")}function ya(e){var i,a;return i=e.replace(/_/g,"").toLowerCase(),a=i[0]==="-"?-1:1,"+-".indexOf(i[0])>=0&&(i=i.slice(1)),i===".inf"?a===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:i===".nan"?NaN:a*parseFloat(i,10)}var ba=/^[-+]?[0-9]+e/;function xa(e,i){var a;if(isNaN(e))switch(i){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(i){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(i){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(be.isNegativeZero(e))return"-0.0";return a=e.toString(10),ba.test(a)?a.replace("e",".e"):a}function _a(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||be.isNegativeZero(e))}var Ki=new Ee("tag:yaml.org,2002:float",{kind:"scalar",resolve:va,construct:ya,predicate:_a,represent:xa,defaultStyle:"lowercase"}),Ui=qi.extend({implicit:[Hi,Yi,$i,Ki]}),Wi=Ui,Xi=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Vi=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function wa(e){return e===null?!1:Xi.exec(e)!==null||Vi.exec(e)!==null}function Sa(e){var i,a,l,c,u,p,m,v=0,y=null,S,_,E;if(i=Xi.exec(e),i===null&&(i=Vi.exec(e)),i===null)throw new Error("Date resolve error");if(a=+i[1],l=+i[2]-1,c=+i[3],!i[4])return new Date(Date.UTC(a,l,c));if(u=+i[4],p=+i[5],m=+i[6],i[7]){for(v=i[7].slice(0,3);v.length<3;)v+="0";v=+v}return i[9]&&(S=+i[10],_=+(i[11]||0),y=(S*60+_)*6e4,i[9]==="-"&&(y=-y)),E=new Date(Date.UTC(a,l,c,u,p,m,v)),y&&E.setTime(E.getTime()-y),E}function ka(e){return e.toISOString()}var Gi=new Ee("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:wa,construct:Sa,instanceOf:Date,represent:ka});function Ea(e){return e==="<<"||e===null}var Ji=new Ee("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Ea}),zn=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Ca(e){if(e===null)return!1;var i,a,l=0,c=e.length,u=zn;for(a=0;a<c;a++)if(i=u.indexOf(e.charAt(a)),!(i>64)){if(i<0)return!1;l+=6}return l%8===0}function Aa(e){var i,a,l=e.replace(/[\r\n=]/g,""),c=l.length,u=zn,p=0,m=[];for(i=0;i<c;i++)i%4===0&&i&&(m.push(p>>16&255),m.push(p>>8&255),m.push(p&255)),p=p<<6|u.indexOf(l.charAt(i));return a=c%4*6,a===0?(m.push(p>>16&255),m.push(p>>8&255),m.push(p&255)):a===18?(m.push(p>>10&255),m.push(p>>2&255)):a===12&&m.push(p>>4&255),new Uint8Array(m)}function Ta(e){var i="",a=0,l,c,u=e.length,p=zn;for(l=0;l<u;l++)l%3===0&&l&&(i+=p[a>>18&63],i+=p[a>>12&63],i+=p[a>>6&63],i+=p[a&63]),a=(a<<8)+e[l];return c=u%3,c===0?(i+=p[a>>18&63],i+=p[a>>12&63],i+=p[a>>6&63],i+=p[a&63]):c===2?(i+=p[a>>10&63],i+=p[a>>4&63],i+=p[a<<2&63],i+=p[64]):c===1&&(i+=p[a>>2&63],i+=p[a<<4&63],i+=p[64],i+=p[64]),i}function Oa(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Qi=new Ee("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Ca,construct:Aa,predicate:Oa,represent:Ta}),Ma=Object.prototype.hasOwnProperty,Pa=Object.prototype.toString;function Ia(e){if(e===null)return!0;var i=[],a,l,c,u,p,m=e;for(a=0,l=m.length;a<l;a+=1){if(c=m[a],p=!1,Pa.call(c)!=="[object Object]")return!1;for(u in c)if(Ma.call(c,u))if(!p)p=!0;else return!1;if(!p)return!1;if(i.indexOf(u)===-1)i.push(u);else return!1}return!0}function Fa(e){return e!==null?e:[]}var Zi=new Ee("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Ia,construct:Fa}),La=Object.prototype.toString;function za(e){if(e===null)return!0;var i,a,l,c,u,p=e;for(u=new Array(p.length),i=0,a=p.length;i<a;i+=1){if(l=p[i],La.call(l)!=="[object Object]"||(c=Object.keys(l),c.length!==1))return!1;u[i]=[c[0],l[c[0]]]}return!0}function Da(e){if(e===null)return[];var i,a,l,c,u,p=e;for(u=new Array(p.length),i=0,a=p.length;i<a;i+=1)l=p[i],c=Object.keys(l),u[i]=[c[0],l[c[0]]];return u}var er=new Ee("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:za,construct:Da}),Ra=Object.prototype.hasOwnProperty;function Ba(e){if(e===null)return!0;var i,a=e;for(i in a)if(Ra.call(a,i)&&a[i]!==null)return!1;return!0}function ja(e){return e!==null?e:{}}var tr=new Ee("tag:yaml.org,2002:set",{kind:"mapping",resolve:Ba,construct:ja}),Dn=Wi.extend({implicit:[Gi,Ji],explicit:[Qi,Zi,er,tr]}),dt=Object.prototype.hasOwnProperty,sn=1,nr=2,ir=3,ln=4,On=1,Na=2,_i=3,qa=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ha=/[\x85\u2028\u2029]/,Ya=/[,\[\]\{\}]/,rr=/^(?:!|!!|![a-z\-]+!)$/i,or=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function wi(e){return Object.prototype.toString.call(e)}function Qe(e){return e===10||e===13}function ft(e){return e===9||e===32}function ze(e){return e===9||e===32||e===10||e===13}function At(e){return e===44||e===91||e===93||e===123||e===125}function $a(e){var i;return 48<=e&&e<=57?e-48:(i=e|32,97<=i&&i<=102?i-97+10:-1)}function Ka(e){return e===120?2:e===117?4:e===85?8:0}function Ua(e){return 48<=e&&e<=57?e-48:-1}function Si(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Wa(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var ar=new Array(256),sr=new Array(256);for(ht=0;ht<256;ht++)ar[ht]=Si(ht)?1:0,sr[ht]=Si(ht);var ht;function Xa(e,i){this.input=e,this.filename=i.filename||null,this.schema=i.schema||Dn,this.onWarning=i.onWarning||null,this.legacy=i.legacy||!1,this.json=i.json||!1,this.listener=i.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function lr(e,i){var a={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return a.snippet=Qo(a),new Fe(i,a)}function K(e,i){throw lr(e,i)}function cn(e,i){e.onWarning&&e.onWarning.call(null,lr(e,i))}var ki={YAML:function(i,a,l){var c,u,p;i.version!==null&&K(i,"duplication of %YAML directive"),l.length!==1&&K(i,"YAML directive accepts exactly one argument"),c=/^([0-9]+)\.([0-9]+)$/.exec(l[0]),c===null&&K(i,"ill-formed argument of the YAML directive"),u=parseInt(c[1],10),p=parseInt(c[2],10),u!==1&&K(i,"unacceptable YAML version of the document"),i.version=l[0],i.checkLineBreaks=p<2,p!==1&&p!==2&&cn(i,"unsupported YAML version of the document")},TAG:function(i,a,l){var c,u;l.length!==2&&K(i,"TAG directive accepts exactly two arguments"),c=l[0],u=l[1],rr.test(c)||K(i,"ill-formed tag handle (first argument) of the TAG directive"),dt.call(i.tagMap,c)&&K(i,'there is a previously declared suffix for "'+c+'" tag handle'),or.test(u)||K(i,"ill-formed tag prefix (second argument) of the TAG directive");try{u=decodeURIComponent(u)}catch{K(i,"tag prefix is malformed: "+u)}i.tagMap[c]=u}};function ct(e,i,a,l){var c,u,p,m;if(i<a){if(m=e.input.slice(i,a),l)for(c=0,u=m.length;c<u;c+=1)p=m.charCodeAt(c),p===9||32<=p&&p<=1114111||K(e,"expected valid JSON character");else qa.test(m)&&K(e,"the stream contains non-printable characters");e.result+=m}}function Ei(e,i,a,l){var c,u,p,m;for(be.isObject(a)||K(e,"cannot merge mappings; the provided source object is unacceptable"),c=Object.keys(a),p=0,m=c.length;p<m;p+=1)u=c[p],dt.call(i,u)||(i[u]=a[u],l[u]=!0)}function Tt(e,i,a,l,c,u,p,m,v){var y,S;if(Array.isArray(c))for(c=Array.prototype.slice.call(c),y=0,S=c.length;y<S;y+=1)Array.isArray(c[y])&&K(e,"nested arrays are not supported inside keys"),typeof c=="object"&&wi(c[y])==="[object Object]"&&(c[y]="[object Object]");if(typeof c=="object"&&wi(c)==="[object Object]"&&(c="[object Object]"),c=String(c),i===null&&(i={}),l==="tag:yaml.org,2002:merge")if(Array.isArray(u))for(y=0,S=u.length;y<S;y+=1)Ei(e,i,u[y],a);else Ei(e,i,u,a);else!e.json&&!dt.call(a,c)&&dt.call(i,c)&&(e.line=p||e.line,e.lineStart=m||e.lineStart,e.position=v||e.position,K(e,"duplicated mapping key")),c==="__proto__"?Object.defineProperty(i,c,{configurable:!0,enumerable:!0,writable:!0,value:u}):i[c]=u,delete a[c];return i}function Rn(e){var i;i=e.input.charCodeAt(e.position),i===10?e.position++:i===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):K(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function ye(e,i,a){for(var l=0,c=e.input.charCodeAt(e.position);c!==0;){for(;ft(c);)c===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),c=e.input.charCodeAt(++e.position);if(i&&c===35)do c=e.input.charCodeAt(++e.position);while(c!==10&&c!==13&&c!==0);if(Qe(c))for(Rn(e),c=e.input.charCodeAt(e.position),l++,e.lineIndent=0;c===32;)e.lineIndent++,c=e.input.charCodeAt(++e.position);else break}return a!==-1&&l!==0&&e.lineIndent<a&&cn(e,"deficient indentation"),l}function pn(e){var i=e.position,a;return a=e.input.charCodeAt(i),!!((a===45||a===46)&&a===e.input.charCodeAt(i+1)&&a===e.input.charCodeAt(i+2)&&(i+=3,a=e.input.charCodeAt(i),a===0||ze(a)))}function Bn(e,i){i===1?e.result+=" ":i>1&&(e.result+=be.repeat(`
`,i-1))}function Va(e,i,a){var l,c,u,p,m,v,y,S,_=e.kind,E=e.result,T;if(T=e.input.charCodeAt(e.position),ze(T)||At(T)||T===35||T===38||T===42||T===33||T===124||T===62||T===39||T===34||T===37||T===64||T===96||(T===63||T===45)&&(c=e.input.charCodeAt(e.position+1),ze(c)||a&&At(c)))return!1;for(e.kind="scalar",e.result="",u=p=e.position,m=!1;T!==0;){if(T===58){if(c=e.input.charCodeAt(e.position+1),ze(c)||a&&At(c))break}else if(T===35){if(l=e.input.charCodeAt(e.position-1),ze(l))break}else{if(e.position===e.lineStart&&pn(e)||a&&At(T))break;if(Qe(T))if(v=e.line,y=e.lineStart,S=e.lineIndent,ye(e,!1,-1),e.lineIndent>=i){m=!0,T=e.input.charCodeAt(e.position);continue}else{e.position=p,e.line=v,e.lineStart=y,e.lineIndent=S;break}}m&&(ct(e,u,p,!1),Bn(e,e.line-v),u=p=e.position,m=!1),ft(T)||(p=e.position+1),T=e.input.charCodeAt(++e.position)}return ct(e,u,p,!1),e.result?!0:(e.kind=_,e.result=E,!1)}function Ga(e,i){var a,l,c;if(a=e.input.charCodeAt(e.position),a!==39)return!1;for(e.kind="scalar",e.result="",e.position++,l=c=e.position;(a=e.input.charCodeAt(e.position))!==0;)if(a===39)if(ct(e,l,e.position,!0),a=e.input.charCodeAt(++e.position),a===39)l=e.position,e.position++,c=e.position;else return!0;else Qe(a)?(ct(e,l,c,!0),Bn(e,ye(e,!1,i)),l=c=e.position):e.position===e.lineStart&&pn(e)?K(e,"unexpected end of the document within a single quoted scalar"):(e.position++,c=e.position);K(e,"unexpected end of the stream within a single quoted scalar")}function Ja(e,i){var a,l,c,u,p,m;if(m=e.input.charCodeAt(e.position),m!==34)return!1;for(e.kind="scalar",e.result="",e.position++,a=l=e.position;(m=e.input.charCodeAt(e.position))!==0;){if(m===34)return ct(e,a,e.position,!0),e.position++,!0;if(m===92){if(ct(e,a,e.position,!0),m=e.input.charCodeAt(++e.position),Qe(m))ye(e,!1,i);else if(m<256&&ar[m])e.result+=sr[m],e.position++;else if((p=Ka(m))>0){for(c=p,u=0;c>0;c--)m=e.input.charCodeAt(++e.position),(p=$a(m))>=0?u=(u<<4)+p:K(e,"expected hexadecimal character");e.result+=Wa(u),e.position++}else K(e,"unknown escape sequence");a=l=e.position}else Qe(m)?(ct(e,a,l,!0),Bn(e,ye(e,!1,i)),a=l=e.position):e.position===e.lineStart&&pn(e)?K(e,"unexpected end of the document within a double quoted scalar"):(e.position++,l=e.position)}K(e,"unexpected end of the stream within a double quoted scalar")}function Qa(e,i){var a=!0,l,c,u,p=e.tag,m,v=e.anchor,y,S,_,E,T,F=Object.create(null),L,M,D,O;if(O=e.input.charCodeAt(e.position),O===91)S=93,T=!1,m=[];else if(O===123)S=125,T=!0,m={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=m),O=e.input.charCodeAt(++e.position);O!==0;){if(ye(e,!0,i),O=e.input.charCodeAt(e.position),O===S)return e.position++,e.tag=p,e.anchor=v,e.kind=T?"mapping":"sequence",e.result=m,!0;a?O===44&&K(e,"expected the node content, but found ','"):K(e,"missed comma between flow collection entries"),M=L=D=null,_=E=!1,O===63&&(y=e.input.charCodeAt(e.position+1),ze(y)&&(_=E=!0,e.position++,ye(e,!0,i))),l=e.line,c=e.lineStart,u=e.position,Ot(e,i,sn,!1,!0),M=e.tag,L=e.result,ye(e,!0,i),O=e.input.charCodeAt(e.position),(E||e.line===l)&&O===58&&(_=!0,O=e.input.charCodeAt(++e.position),ye(e,!0,i),Ot(e,i,sn,!1,!0),D=e.result),T?Tt(e,m,F,M,L,D,l,c,u):_?m.push(Tt(e,null,F,M,L,D,l,c,u)):m.push(L),ye(e,!0,i),O=e.input.charCodeAt(e.position),O===44?(a=!0,O=e.input.charCodeAt(++e.position)):a=!1}K(e,"unexpected end of the stream within a flow collection")}function Za(e,i){var a,l,c=On,u=!1,p=!1,m=i,v=0,y=!1,S,_;if(_=e.input.charCodeAt(e.position),_===124)l=!1;else if(_===62)l=!0;else return!1;for(e.kind="scalar",e.result="";_!==0;)if(_=e.input.charCodeAt(++e.position),_===43||_===45)On===c?c=_===43?_i:Na:K(e,"repeat of a chomping mode identifier");else if((S=Ua(_))>=0)S===0?K(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):p?K(e,"repeat of an indentation width identifier"):(m=i+S-1,p=!0);else break;if(ft(_)){do _=e.input.charCodeAt(++e.position);while(ft(_));if(_===35)do _=e.input.charCodeAt(++e.position);while(!Qe(_)&&_!==0)}for(;_!==0;){for(Rn(e),e.lineIndent=0,_=e.input.charCodeAt(e.position);(!p||e.lineIndent<m)&&_===32;)e.lineIndent++,_=e.input.charCodeAt(++e.position);if(!p&&e.lineIndent>m&&(m=e.lineIndent),Qe(_)){v++;continue}if(e.lineIndent<m){c===_i?e.result+=be.repeat(`
`,u?1+v:v):c===On&&u&&(e.result+=`
`);break}for(l?ft(_)?(y=!0,e.result+=be.repeat(`
`,u?1+v:v)):y?(y=!1,e.result+=be.repeat(`
`,v+1)):v===0?u&&(e.result+=" "):e.result+=be.repeat(`
`,v):e.result+=be.repeat(`
`,u?1+v:v),u=!0,p=!0,v=0,a=e.position;!Qe(_)&&_!==0;)_=e.input.charCodeAt(++e.position);ct(e,a,e.position,!1)}return!0}function Ci(e,i){var a,l=e.tag,c=e.anchor,u=[],p,m=!1,v;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),v=e.input.charCodeAt(e.position);v!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,K(e,"tab characters must not be used in indentation")),!(v!==45||(p=e.input.charCodeAt(e.position+1),!ze(p))));){if(m=!0,e.position++,ye(e,!0,-1)&&e.lineIndent<=i){u.push(null),v=e.input.charCodeAt(e.position);continue}if(a=e.line,Ot(e,i,ir,!1,!0),u.push(e.result),ye(e,!0,-1),v=e.input.charCodeAt(e.position),(e.line===a||e.lineIndent>i)&&v!==0)K(e,"bad indentation of a sequence entry");else if(e.lineIndent<i)break}return m?(e.tag=l,e.anchor=c,e.kind="sequence",e.result=u,!0):!1}function es(e,i,a){var l,c,u,p,m,v,y=e.tag,S=e.anchor,_={},E=Object.create(null),T=null,F=null,L=null,M=!1,D=!1,O;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=_),O=e.input.charCodeAt(e.position);O!==0;){if(!M&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,K(e,"tab characters must not be used in indentation")),l=e.input.charCodeAt(e.position+1),u=e.line,(O===63||O===58)&&ze(l))O===63?(M&&(Tt(e,_,E,T,F,null,p,m,v),T=F=L=null),D=!0,M=!0,c=!0):M?(M=!1,c=!0):K(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,O=l;else{if(p=e.line,m=e.lineStart,v=e.position,!Ot(e,a,nr,!1,!0))break;if(e.line===u){for(O=e.input.charCodeAt(e.position);ft(O);)O=e.input.charCodeAt(++e.position);if(O===58)O=e.input.charCodeAt(++e.position),ze(O)||K(e,"a whitespace character is expected after the key-value separator within a block mapping"),M&&(Tt(e,_,E,T,F,null,p,m,v),T=F=L=null),D=!0,M=!1,c=!1,T=e.tag,F=e.result;else if(D)K(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=y,e.anchor=S,!0}else if(D)K(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=y,e.anchor=S,!0}if((e.line===u||e.lineIndent>i)&&(M&&(p=e.line,m=e.lineStart,v=e.position),Ot(e,i,ln,!0,c)&&(M?F=e.result:L=e.result),M||(Tt(e,_,E,T,F,L,p,m,v),T=F=L=null),ye(e,!0,-1),O=e.input.charCodeAt(e.position)),(e.line===u||e.lineIndent>i)&&O!==0)K(e,"bad indentation of a mapping entry");else if(e.lineIndent<i)break}return M&&Tt(e,_,E,T,F,null,p,m,v),D&&(e.tag=y,e.anchor=S,e.kind="mapping",e.result=_),D}function ts(e){var i,a=!1,l=!1,c,u,p;if(p=e.input.charCodeAt(e.position),p!==33)return!1;if(e.tag!==null&&K(e,"duplication of a tag property"),p=e.input.charCodeAt(++e.position),p===60?(a=!0,p=e.input.charCodeAt(++e.position)):p===33?(l=!0,c="!!",p=e.input.charCodeAt(++e.position)):c="!",i=e.position,a){do p=e.input.charCodeAt(++e.position);while(p!==0&&p!==62);e.position<e.length?(u=e.input.slice(i,e.position),p=e.input.charCodeAt(++e.position)):K(e,"unexpected end of the stream within a verbatim tag")}else{for(;p!==0&&!ze(p);)p===33&&(l?K(e,"tag suffix cannot contain exclamation marks"):(c=e.input.slice(i-1,e.position+1),rr.test(c)||K(e,"named tag handle cannot contain such characters"),l=!0,i=e.position+1)),p=e.input.charCodeAt(++e.position);u=e.input.slice(i,e.position),Ya.test(u)&&K(e,"tag suffix cannot contain flow indicator characters")}u&&!or.test(u)&&K(e,"tag name cannot contain such characters: "+u);try{u=decodeURIComponent(u)}catch{K(e,"tag name is malformed: "+u)}return a?e.tag=u:dt.call(e.tagMap,c)?e.tag=e.tagMap[c]+u:c==="!"?e.tag="!"+u:c==="!!"?e.tag="tag:yaml.org,2002:"+u:K(e,'undeclared tag handle "'+c+'"'),!0}function ns(e){var i,a;if(a=e.input.charCodeAt(e.position),a!==38)return!1;for(e.anchor!==null&&K(e,"duplication of an anchor property"),a=e.input.charCodeAt(++e.position),i=e.position;a!==0&&!ze(a)&&!At(a);)a=e.input.charCodeAt(++e.position);return e.position===i&&K(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(i,e.position),!0}function is(e){var i,a,l;if(l=e.input.charCodeAt(e.position),l!==42)return!1;for(l=e.input.charCodeAt(++e.position),i=e.position;l!==0&&!ze(l)&&!At(l);)l=e.input.charCodeAt(++e.position);return e.position===i&&K(e,"name of an alias node must contain at least one character"),a=e.input.slice(i,e.position),dt.call(e.anchorMap,a)||K(e,'unidentified alias "'+a+'"'),e.result=e.anchorMap[a],ye(e,!0,-1),!0}function Ot(e,i,a,l,c){var u,p,m,v=1,y=!1,S=!1,_,E,T,F,L,M;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,u=p=m=ln===a||ir===a,l&&ye(e,!0,-1)&&(y=!0,e.lineIndent>i?v=1:e.lineIndent===i?v=0:e.lineIndent<i&&(v=-1)),v===1)for(;ts(e)||ns(e);)ye(e,!0,-1)?(y=!0,m=u,e.lineIndent>i?v=1:e.lineIndent===i?v=0:e.lineIndent<i&&(v=-1)):m=!1;if(m&&(m=y||c),(v===1||ln===a)&&(sn===a||nr===a?L=i:L=i+1,M=e.position-e.lineStart,v===1?m&&(Ci(e,M)||es(e,M,L))||Qa(e,L)?S=!0:(p&&Za(e,L)||Ga(e,L)||Ja(e,L)?S=!0:is(e)?(S=!0,(e.tag!==null||e.anchor!==null)&&K(e,"alias node should not have any properties")):Va(e,L,sn===a)&&(S=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):v===0&&(S=m&&Ci(e,M))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&K(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),_=0,E=e.implicitTypes.length;_<E;_+=1)if(F=e.implicitTypes[_],F.resolve(e.result)){e.result=F.construct(e.result),e.tag=F.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(dt.call(e.typeMap[e.kind||"fallback"],e.tag))F=e.typeMap[e.kind||"fallback"][e.tag];else for(F=null,T=e.typeMap.multi[e.kind||"fallback"],_=0,E=T.length;_<E;_+=1)if(e.tag.slice(0,T[_].tag.length)===T[_].tag){F=T[_];break}F||K(e,"unknown tag !<"+e.tag+">"),e.result!==null&&F.kind!==e.kind&&K(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+F.kind+'", not "'+e.kind+'"'),F.resolve(e.result,e.tag)?(e.result=F.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):K(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||S}function rs(e){var i=e.position,a,l,c,u=!1,p;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(p=e.input.charCodeAt(e.position))!==0&&(ye(e,!0,-1),p=e.input.charCodeAt(e.position),!(e.lineIndent>0||p!==37));){for(u=!0,p=e.input.charCodeAt(++e.position),a=e.position;p!==0&&!ze(p);)p=e.input.charCodeAt(++e.position);for(l=e.input.slice(a,e.position),c=[],l.length<1&&K(e,"directive name must not be less than one character in length");p!==0;){for(;ft(p);)p=e.input.charCodeAt(++e.position);if(p===35){do p=e.input.charCodeAt(++e.position);while(p!==0&&!Qe(p));break}if(Qe(p))break;for(a=e.position;p!==0&&!ze(p);)p=e.input.charCodeAt(++e.position);c.push(e.input.slice(a,e.position))}p!==0&&Rn(e),dt.call(ki,l)?ki[l](e,l,c):cn(e,'unknown document directive "'+l+'"')}if(ye(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,ye(e,!0,-1)):u&&K(e,"directives end mark is expected"),Ot(e,e.lineIndent-1,ln,!1,!0),ye(e,!0,-1),e.checkLineBreaks&&Ha.test(e.input.slice(i,e.position))&&cn(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&pn(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,ye(e,!0,-1));return}if(e.position<e.length-1)K(e,"end of the stream or a document separator is expected");else return}function cr(e,i){e=String(e),i=i||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var a=new Xa(e,i),l=e.indexOf("\0");for(l!==-1&&(a.position=l,K(a,"null byte is not allowed in input")),a.input+="\0";a.input.charCodeAt(a.position)===32;)a.lineIndent+=1,a.position+=1;for(;a.position<a.length-1;)rs(a);return a.documents}function os(e,i,a){i!==null&&typeof i=="object"&&typeof a=="undefined"&&(a=i,i=null);var l=cr(e,a);if(typeof i!="function")return l;for(var c=0,u=l.length;c<u;c+=1)i(l[c])}function as(e,i){var a=cr(e,i);if(a.length!==0){if(a.length===1)return a[0];throw new Fe("expected a single document in the stream, but found more")}}var ss=os,ls=as,dr={loadAll:ss,load:ls},ur=Object.prototype.toString,pr=Object.prototype.hasOwnProperty,jn=65279,cs=9,$t=10,ds=13,us=32,ps=33,hs=34,Pn=35,fs=37,gs=38,ms=39,vs=42,hr=44,ys=45,dn=58,bs=61,xs=62,_s=63,ws=64,fr=91,gr=93,Ss=96,mr=123,ks=124,vr=125,Ce={};Ce[0]="\\0";Ce[7]="\\a";Ce[8]="\\b";Ce[9]="\\t";Ce[10]="\\n";Ce[11]="\\v";Ce[12]="\\f";Ce[13]="\\r";Ce[27]="\\e";Ce[34]='\\"';Ce[92]="\\\\";Ce[133]="\\N";Ce[160]="\\_";Ce[8232]="\\L";Ce[8233]="\\P";var Es=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Cs=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function As(e,i){var a,l,c,u,p,m,v;if(i===null)return{};for(a={},l=Object.keys(i),c=0,u=l.length;c<u;c+=1)p=l[c],m=String(i[p]),p.slice(0,2)==="!!"&&(p="tag:yaml.org,2002:"+p.slice(2)),v=e.compiledTypeMap.fallback[p],v&&pr.call(v.styleAliases,m)&&(m=v.styleAliases[m]),a[p]=m;return a}function Ts(e){var i,a,l;if(i=e.toString(16).toUpperCase(),e<=255)a="x",l=2;else if(e<=65535)a="u",l=4;else if(e<=4294967295)a="U",l=8;else throw new Fe("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+a+be.repeat("0",l-i.length)+i}var Os=1,Kt=2;function Ms(e){this.schema=e.schema||Dn,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=be.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=As(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Kt:Os,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Ai(e,i){for(var a=be.repeat(" ",i),l=0,c=-1,u="",p,m=e.length;l<m;)c=e.indexOf(`
`,l),c===-1?(p=e.slice(l),l=m):(p=e.slice(l,c+1),l=c+1),p.length&&p!==`
`&&(u+=a),u+=p;return u}function In(e,i){return`
`+be.repeat(" ",e.indent*i)}function Ps(e,i){var a,l,c;for(a=0,l=e.implicitTypes.length;a<l;a+=1)if(c=e.implicitTypes[a],c.resolve(i))return!0;return!1}function un(e){return e===us||e===cs}function Ut(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==jn||65536<=e&&e<=1114111}function Ti(e){return Ut(e)&&e!==jn&&e!==ds&&e!==$t}function Oi(e,i,a){var l=Ti(e),c=l&&!un(e);return(a?l:l&&e!==hr&&e!==fr&&e!==gr&&e!==mr&&e!==vr)&&e!==Pn&&!(i===dn&&!c)||Ti(i)&&!un(i)&&e===Pn||i===dn&&c}function Is(e){return Ut(e)&&e!==jn&&!un(e)&&e!==ys&&e!==_s&&e!==dn&&e!==hr&&e!==fr&&e!==gr&&e!==mr&&e!==vr&&e!==Pn&&e!==gs&&e!==vs&&e!==ps&&e!==ks&&e!==bs&&e!==xs&&e!==ms&&e!==hs&&e!==fs&&e!==ws&&e!==Ss}function Fs(e){return!un(e)&&e!==dn}function Ht(e,i){var a=e.charCodeAt(i),l;return a>=55296&&a<=56319&&i+1<e.length&&(l=e.charCodeAt(i+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}function yr(e){var i=/^\n* /;return i.test(e)}var br=1,Fn=2,xr=3,_r=4,Ct=5;function Ls(e,i,a,l,c,u,p,m){var v,y=0,S=null,_=!1,E=!1,T=l!==-1,F=-1,L=Is(Ht(e,0))&&Fs(Ht(e,e.length-1));if(i||p)for(v=0;v<e.length;y>=65536?v+=2:v++){if(y=Ht(e,v),!Ut(y))return Ct;L=L&&Oi(y,S,m),S=y}else{for(v=0;v<e.length;y>=65536?v+=2:v++){if(y=Ht(e,v),y===$t)_=!0,T&&(E=E||v-F-1>l&&e[F+1]!==" ",F=v);else if(!Ut(y))return Ct;L=L&&Oi(y,S,m),S=y}E=E||T&&v-F-1>l&&e[F+1]!==" "}return!_&&!E?L&&!p&&!c(e)?br:u===Kt?Ct:Fn:a>9&&yr(e)?Ct:p?u===Kt?Ct:Fn:E?_r:xr}function zs(e,i,a,l,c){e.dump=(function(){if(i.length===0)return e.quotingType===Kt?'""':"''";if(!e.noCompatMode&&(Es.indexOf(i)!==-1||Cs.test(i)))return e.quotingType===Kt?'"'+i+'"':"'"+i+"'";var u=e.indent*Math.max(1,a),p=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-u),m=l||e.flowLevel>-1&&a>=e.flowLevel;function v(y){return Ps(e,y)}switch(Ls(i,m,e.indent,p,v,e.quotingType,e.forceQuotes&&!l,c)){case br:return i;case Fn:return"'"+i.replace(/'/g,"''")+"'";case xr:return"|"+Mi(i,e.indent)+Pi(Ai(i,u));case _r:return">"+Mi(i,e.indent)+Pi(Ai(Ds(i,p),u));case Ct:return'"'+Rs(i)+'"';default:throw new Fe("impossible error: invalid scalar style")}})()}function Mi(e,i){var a=yr(e)?String(i):"",l=e[e.length-1]===`
`,c=l&&(e[e.length-2]===`
`||e===`
`),u=c?"+":l?"":"-";return a+u+`
`}function Pi(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Ds(e,i){for(var a=/(\n+)([^\n]*)/g,l=(function(){var y=e.indexOf(`
`);return y=y!==-1?y:e.length,a.lastIndex=y,Ii(e.slice(0,y),i)})(),c=e[0]===`
`||e[0]===" ",u,p;p=a.exec(e);){var m=p[1],v=p[2];u=v[0]===" ",l+=m+(!c&&!u&&v!==""?`
`:"")+Ii(v,i),c=u}return l}function Ii(e,i){if(e===""||e[0]===" ")return e;for(var a=/ [^ ]/g,l,c=0,u,p=0,m=0,v="";l=a.exec(e);)m=l.index,m-c>i&&(u=p>c?p:m,v+=`
`+e.slice(c,u),c=u+1),p=m;return v+=`
`,e.length-c>i&&p>c?v+=e.slice(c,p)+`
`+e.slice(p+1):v+=e.slice(c),v.slice(1)}function Rs(e){for(var i="",a=0,l,c=0;c<e.length;a>=65536?c+=2:c++)a=Ht(e,c),l=Ce[a],!l&&Ut(a)?(i+=e[c],a>=65536&&(i+=e[c+1])):i+=l||Ts(a);return i}function Bs(e,i,a){var l="",c=e.tag,u,p,m;for(u=0,p=a.length;u<p;u+=1)m=a[u],e.replacer&&(m=e.replacer.call(a,String(u),m)),(tt(e,i,m,!1,!1)||typeof m=="undefined"&&tt(e,i,null,!1,!1))&&(l!==""&&(l+=","+(e.condenseFlow?"":" ")),l+=e.dump);e.tag=c,e.dump="["+l+"]"}function Fi(e,i,a,l){var c="",u=e.tag,p,m,v;for(p=0,m=a.length;p<m;p+=1)v=a[p],e.replacer&&(v=e.replacer.call(a,String(p),v)),(tt(e,i+1,v,!0,!0,!1,!0)||typeof v=="undefined"&&tt(e,i+1,null,!0,!0,!1,!0))&&((!l||c!=="")&&(c+=In(e,i)),e.dump&&$t===e.dump.charCodeAt(0)?c+="-":c+="- ",c+=e.dump);e.tag=u,e.dump=c||"[]"}function js(e,i,a){var l="",c=e.tag,u=Object.keys(a),p,m,v,y,S;for(p=0,m=u.length;p<m;p+=1)S="",l!==""&&(S+=", "),e.condenseFlow&&(S+='"'),v=u[p],y=a[v],e.replacer&&(y=e.replacer.call(a,v,y)),tt(e,i,v,!1,!1)&&(e.dump.length>1024&&(S+="? "),S+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),tt(e,i,y,!1,!1)&&(S+=e.dump,l+=S));e.tag=c,e.dump="{"+l+"}"}function Ns(e,i,a,l){var c="",u=e.tag,p=Object.keys(a),m,v,y,S,_,E;if(e.sortKeys===!0)p.sort();else if(typeof e.sortKeys=="function")p.sort(e.sortKeys);else if(e.sortKeys)throw new Fe("sortKeys must be a boolean or a function");for(m=0,v=p.length;m<v;m+=1)E="",(!l||c!=="")&&(E+=In(e,i)),y=p[m],S=a[y],e.replacer&&(S=e.replacer.call(a,y,S)),tt(e,i+1,y,!0,!0,!0)&&(_=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,_&&(e.dump&&$t===e.dump.charCodeAt(0)?E+="?":E+="? "),E+=e.dump,_&&(E+=In(e,i)),tt(e,i+1,S,!0,_)&&(e.dump&&$t===e.dump.charCodeAt(0)?E+=":":E+=": ",E+=e.dump,c+=E));e.tag=u,e.dump=c||"{}"}function Li(e,i,a){var l,c,u,p,m,v;for(c=a?e.explicitTypes:e.implicitTypes,u=0,p=c.length;u<p;u+=1)if(m=c[u],(m.instanceOf||m.predicate)&&(!m.instanceOf||typeof i=="object"&&i instanceof m.instanceOf)&&(!m.predicate||m.predicate(i))){if(a?m.multi&&m.representName?e.tag=m.representName(i):e.tag=m.tag:e.tag="?",m.represent){if(v=e.styleMap[m.tag]||m.defaultStyle,ur.call(m.represent)==="[object Function]")l=m.represent(i,v);else if(pr.call(m.represent,v))l=m.represent[v](i,v);else throw new Fe("!<"+m.tag+'> tag resolver accepts not "'+v+'" style');e.dump=l}return!0}return!1}function tt(e,i,a,l,c,u,p){e.tag=null,e.dump=a,Li(e,a,!1)||Li(e,a,!0);var m=ur.call(e.dump),v=l,y;l&&(l=e.flowLevel<0||e.flowLevel>i);var S=m==="[object Object]"||m==="[object Array]",_,E;if(S&&(_=e.duplicates.indexOf(a),E=_!==-1),(e.tag!==null&&e.tag!=="?"||E||e.indent!==2&&i>0)&&(c=!1),E&&e.usedDuplicates[_])e.dump="*ref_"+_;else{if(S&&E&&!e.usedDuplicates[_]&&(e.usedDuplicates[_]=!0),m==="[object Object]")l&&Object.keys(e.dump).length!==0?(Ns(e,i,e.dump,c),E&&(e.dump="&ref_"+_+e.dump)):(js(e,i,e.dump),E&&(e.dump="&ref_"+_+" "+e.dump));else if(m==="[object Array]")l&&e.dump.length!==0?(e.noArrayIndent&&!p&&i>0?Fi(e,i-1,e.dump,c):Fi(e,i,e.dump,c),E&&(e.dump="&ref_"+_+e.dump)):(Bs(e,i,e.dump),E&&(e.dump="&ref_"+_+" "+e.dump));else if(m==="[object String]")e.tag!=="?"&&zs(e,e.dump,i,u,v);else{if(m==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new Fe("unacceptable kind of an object to dump "+m)}e.tag!==null&&e.tag!=="?"&&(y=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?y="!"+y:y.slice(0,18)==="tag:yaml.org,2002:"?y="!!"+y.slice(18):y="!<"+y+">",e.dump=y+" "+e.dump)}return!0}function qs(e,i){var a=[],l=[],c,u;for(Ln(e,a,l),c=0,u=l.length;c<u;c+=1)i.duplicates.push(a[l[c]]);i.usedDuplicates=new Array(u)}function Ln(e,i,a){var l,c,u;if(e!==null&&typeof e=="object")if(c=i.indexOf(e),c!==-1)a.indexOf(c)===-1&&a.push(c);else if(i.push(e),Array.isArray(e))for(c=0,u=e.length;c<u;c+=1)Ln(e[c],i,a);else for(l=Object.keys(e),c=0,u=l.length;c<u;c+=1)Ln(e[l[c]],i,a)}function Hs(e,i){i=i||{};var a=new Ms(i);a.noRefs||qs(e,a);var l=e;return a.replacer&&(l=a.replacer.call({"":l},"",l)),tt(a,0,l,!0,!0)?a.dump+`
`:""}var Ys=Hs,$s={dump:Ys};function Nn(e,i){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+i+" instead, which is now safe by default.")}}var Ks=Ee,Us=Ri,Ws=qi,Xs=Ui,Vs=Wi,Gs=Dn,Js=dr.load,Qs=dr.loadAll,Zs=$s.dump,el=Fe,tl={binary:Qi,float:Ki,map:Ni,null:Hi,pairs:er,set:tr,timestamp:Gi,bool:Yi,int:$i,merge:Ji,omap:Zi,seq:ji,str:Bi},nl=Nn("safeLoad","load"),il=Nn("safeLoadAll","loadAll"),rl=Nn("safeDump","dump"),ol={Type:Ks,Schema:Us,FAILSAFE_SCHEMA:Ws,JSON_SCHEMA:Xs,CORE_SCHEMA:Vs,DEFAULT_SCHEMA:Gs,load:Js,loadAll:Qs,dump:Zs,YAMLException:el,types:tl,safeLoad:nl,safeLoadAll:il,safeDump:rl},wr=ol;window.interact||(window.interact=kr.default);window.jsyaml||(window.jsyaml=wr);var al="0.1.76";console.info(`%c drag-and-drop-card %c v${al} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var sl=(e,...i)=>console.debug(`[drag-and-drop-card] ${e}`,...i);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var Sr=()=>new Promise(e=>requestAnimationFrame(()=>e())),ll=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),qn=class e extends HTMLElement{async _getHelpers(){if(this.__helpersPromise)return this.__helpersPromise;let i=a=>new Promise(l=>setTimeout(l,a));return this.__helpersPromise=(async()=>{for(let a=0;a<60;a++){try{if(typeof window.loadCardHelpers=="function"){let l=await this._getHelpers();if(h&&typeof h.createCardElement=="function")return h}}catch{}await i(100)}return null})(),this.__helpersPromise}_createCardDirect(i){var c;let a=((i==null?void 0:i.type)||"").toString(),l;if(a.startsWith("custom:"))l=document.createElement(a.substring(7));else{let u=`hui-${a.replace(/_/g,"-")}-card`;l=document.createElement(u)}try{(c=l.setConfig)==null||c.call(l,i)}catch(u){console.error("setConfig failed",u,i)}return l}_deepQueryAll(i,a=document){let l=[],c=u=>{if(!u)return;if(u.querySelectorAll)try{u.querySelectorAll(i).forEach(v=>l.push(v))}catch{}let p=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,null),m=u;for(;m;){let v=m.shadowRoot;v&&c(v),m=p.nextNode()}};return c(a),l}_syncEditorsStorageKey(){try{let i=this.storageKey||"";this._deepQueryAll("#storage_key").forEach(l=>{try{l&&l.tagName==="INPUT"&&l.value!==i&&(l.value=i,l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}})}catch{}}static getConfigElement(){let i=document.createElement("div");i.innerHTML=`
      <style>
        .cfg-row{display:flex;gap:12px;align-items:center;margin:8px 0;flex-wrap:wrap}
        input[type="text"],input[type="number"],select{
          padding:6px;border-radius:8px;border:1px solid var(--divider-color);
          background:var(--primary-background-color);color:var(--primary-text-color)
        }
        label{font-weight:600;min-width:130px}
        .inline{display:inline-flex;gap:8px;align-items:center}
        .hint{opacity:.65;font-size:.85rem}
      </style>
  
      <div class="cfg-row">
        <label>Storage key</label>
        <input type="text" id="storage_key" placeholder="e.g. livingroom_layout">
      </div>
  
      <div class="cfg-row">
        <label>Grid (px)</label>
        <input type="number" id="grid" min="5" step="1" value="10">
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="liveSnap"> Snap while dragging (live)</label>
      </div>
  
      <div class="cfg-row">
        <label>Auto-save</label>
        <input type="checkbox" id="autoSave" checked>
        <span style="margin-left:auto">Debounce (ms)</span>
        <input type="number" id="autoSaveDebounce" min="0" step="50" value="800" style="width:90px">
      </div>
  
      <div class="cfg-row">
        <label>Container Baxckground</label>
        <input type="text" id="containerBg"
          placeholder="transparent or css e.g. linear-gradient(...)"
          title="Try: transparent, #232f3e, linear-gradient(to right, #1a2a6c, #b21f1f, #fdbb2d), radial-gradient(circle, #4e54c8, #8f94fb)" />
      </div>
  
      <div class="cfg-row">
        <label>Card Background</label>
        <input type="text" id="cardBg"
          placeholder="var(--ha-card-background) or css e.g. #ffffffcc"
          title="Try: transparent, #151515aa, linear-gradient(135deg, #667eea 0%, #764ba2 100%)" />
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="debug"> Debug logs</label>
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="noOverlap">
          Disable overlapping <small style="opacity:.6">(Experimental)</small>
        </label>
      </div>
  
      <!-- NEW: container sizing -->
      <div class="cfg-row">
        <label>Container size</label>
        <select id="sizeMode">
          <option value="dynamic">Dynamic (auto)</option>
          <option value="fixed_custom">User preference (px)</option>
          <option value="preset">Preset</option>
        </select>
  
        <span id="sizeCustom" class="inline" style="display:none">
          W <input type="number" id="sizeW" min="100" step="10" style="width:110px">
          H <input type="number" id="sizeH" min="100" step="10" style="width:110px">
        </span>
  
        <span id="sizePresetWrap" class="inline" style="display:none">
          <select id="sizePreset" style="min-width:240px"></select>
          <select id="sizeOrientation">
            <option value="auto">Auto</option>
            <option value="portrait">Portrait</option>
            <option value="landscape">Landscape</option>
          </select>
        </span>
        <span class="hint">In fixed mode, cards cannot leave the box.</span>
      </div>
    `;let a=e._sizePresets(),l=i.querySelector("#sizePreset"),c=(v,y)=>{let S=document.createElement("optgroup");S.label=v,y.forEach(_=>{let E=document.createElement("option");E.value=_.key,E.textContent=`${_.label} (${_.w}\xD7${_.h})`,l.appendChild(E)}),l.appendChild(S)};[["Phones",a.filter(v=>v.group==="phone")],["Tablets",a.filter(v=>v.group==="tablet")],["Desktop",a.filter(v=>v.group==="desktop")]].forEach(([v,y])=>{if(!y.length)return;let S=document.createElement("optgroup");S.label=v,y.forEach(_=>{let E=document.createElement("option");E.value=_.key,E.textContent=`${_.label} (${_.w}\xD7${_.h})`,S.appendChild(E)}),l.appendChild(S)});let u=()=>{let v=i.querySelector("#sizeMode").value;i.querySelector("#sizeCustom").style.display=v==="fixed_custom"?"inline-flex":"none",i.querySelector("#sizePresetWrap").style.display=v==="preset"?"inline-flex":"none"};i.setConfig=(v={})=>{var y,S,_,E,T,F;i._config={type:v.type||"custom:drag-and-drop-card",...v},i.querySelector("#storage_key").value=v.storage_key||"",i.querySelector("#grid").value=(y=v.grid)!=null?y:10,i.querySelector("#liveSnap").checked=!!v.drag_live_snap,i.querySelector("#autoSave").checked=v.auto_save!==!1,i.querySelector("#autoSaveDebounce").value=(S=v.auto_save_debounce)!=null?S:800,i.querySelector("#containerBg").value=(_=v.container_background)!=null?_:"transparent",i.querySelector("#cardBg").value=(E=v.card_background)!=null?E:"var(--ha-card-background, var(--card-background-color))",i.querySelector("#debug").checked=!!v.debug,i.querySelector("#noOverlap").checked=!!v.disable_overlap,i.querySelector("#sizeMode").value=v.container_size_mode||"dynamic",i.querySelector("#sizeW").value=(T=v.container_fixed_width)!=null?T:"",i.querySelector("#sizeH").value=(F=v.container_fixed_height)!=null?F:"",i.querySelector("#sizePreset").value=v.container_preset||"fullhd",i.querySelector("#sizeOrientation").value=v.container_preset_orientation||"auto",u()},i.getConfig=()=>{let v={...i._config||{type:"custom:drag-and-drop-card"}};return v.type=v.type||"custom:drag-and-drop-card",v.storage_key=i.querySelector("#storage_key").value||void 0,v.grid=Number(i.querySelector("#grid").value||10),v.drag_live_snap=!!i.querySelector("#liveSnap").checked,v.auto_save=!!i.querySelector("#autoSave").checked,v.auto_save_debounce=Number(i.querySelector("#autoSaveDebounce").value||800),v.container_background=i.querySelector("#containerBg").value||"transparent",v.card_background=i.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",v.debug=!!i.querySelector("#debug").checked,v.disable_overlap=!!i.querySelector("#noOverlap").checked,v.container_size_mode=i.querySelector("#sizeMode").value,v.container_fixed_width=Number(i.querySelector("#sizeW").value||0)||void 0,v.container_fixed_height=Number(i.querySelector("#sizeH").value||0)||void 0,v.container_preset=i.querySelector("#sizePreset").value||void 0,v.container_preset_orientation=i.querySelector("#sizeOrientation").value||"auto",v};let p=()=>{i.dispatchEvent(new CustomEvent("config-changed",{detail:{config:i.getConfig()}}))},m=(v,y="input")=>{var S;return(S=i.querySelector(v))==null?void 0:S.addEventListener(y,()=>{v==="#sizeMode"&&u(),p()})};return m("#storage_key"),m("#grid"),m("#liveSnap","change"),m("#autoSave","change"),m("#autoSaveDebounce"),m("#containerBg"),m("#cardBg"),m("#debug","change"),m("#noOverlap","change"),m("#sizeMode","change"),m("#sizeW"),m("#sizeH"),m("#sizePreset","change"),m("#sizeOrientation","change"),i}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let i=Math.max(100,Number(this.containerFixedWidth||0)),a=Math.max(100,Number(this.containerFixedHeight||0));return{w:i,h:a}}if(this.containerSizeMode==="preset"){let i=e._sizePresets().find(c=>c.key===this.containerPreset)||e._sizePresets().find(c=>c.key==="fhd");if(!i)return{w:1920,h:1080};let a=i.w,l=i.h;return this.containerPresetOrient==="portrait"&&a>l&&([a,l]=[l,a]),this.containerPresetOrient==="landscape"&&l>a&&([a,l]=[l,a]),{w:a,h:l}}return null}_applyContainerSizingFromConfig(i=!1){var l,c;let a=this.cardContainer;if(a)if(this._isContainerFixed()){let{w:u,h:p}=this._resolveFixedSize();a.style.width=`${u}px`,a.style.height=`${p}px`,a.style.overflow="hidden",i||(l=this._dbgPush)==null||l.call(this,"size","Applied fixed size",{w:u,h:p,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else a.style.overflow="hidden",i||(c=this._dbgPush)==null||c.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let i=this.cardContainer;if(!i)return{w:0,h:0};let a=parseFloat(getComputedStyle(i).width)||i.getBoundingClientRect().width,l=parseFloat(getComputedStyle(i).height)||i.getBoundingClientRect().height;return{w:a,h:l}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:i,h:a}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(c=>{let u=parseFloat(c.getAttribute("data-x"))||0,p=parseFloat(c.getAttribute("data-y"))||0,m=parseFloat(c.style.width)||c.getBoundingClientRect().width,v=parseFloat(c.style.height)||c.getBoundingClientRect().height,y=Math.max(0,Math.min(u,Math.max(0,i-m))),S=Math.max(0,Math.min(p,Math.max(0,a-v))),_=Math.min(m,i),E=Math.min(v,a);(_!==m||E!==v)&&(c.style.width=`${_}px`,c.style.height=`${E}px`);let T=Math.max(0,Math.min(y,Math.max(0,i-_))),F=Math.max(0,Math.min(S,Math.max(0,a-E)));this._setCardPosition(c,T,F)})}_applyGridVars(){var a;let i=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",i),(a=this.cardContainer)==null||a.style.setProperty("--ddc-grid-size",i)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(i,a,l=null){let c={t:new Date().toISOString(),kind:i,msg:a,extra:l};this._dbgBuffer.push(c),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${i}]%c ${a}`,"color:#03a9f4","color:unset",l!=null?l:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(i){return String(i).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}setConfig(i={}){var p,m,v,y,S,_,E,T,F,L;let a=i||{},l=this.storageKey,c=a.storage_key||`layout_${Date.now().toString(36)}`;this._config={...a,storage_key:c},this.storageKey=c,(p=this._syncEditorsStorageKey)==null||p.call(this);let u=a.child_card_mod;if(this._childCardStyle=typeof u=="string"?u:(y=(v=u==null?void 0:u.style)!=null?v:(m=u==null?void 0:u.card_mod)==null?void 0:m.style)!=null?y:"",this.gridSize=Number((S=a.grid)!=null?S:10),this.dragLiveSnap=!!a.drag_live_snap,this.autoSave=a.auto_save!==!1,this.autoSaveDebounce=Number((_=a.auto_save_debounce)!=null?_:800),this.containerBackground=(E=a.container_background)!=null?E:"transparent",this.cardBackground=(T=a.card_background)!=null?T:"var(--ha-card-background, var(--card-background-color))",this.debug=!!a.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!i.disable_overlap,this.containerSizeMode=i.container_size_mode||"dynamic",this.containerFixedWidth=Number((F=i.container_fixed_width)!=null?F:0)||null,this.containerFixedHeight=Number((L=i.container_fixed_height)!=null?L:0)||null,this.containerPreset=i.container_preset||"fullhd",this.containerPresetOrient=i.container_preset_orientation||"auto",this.cardContainer&&this._applyContainerSizingFromConfig(!1),this._applyGridVars(),this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:i.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let M=document.createElement("script");M.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(M)}if(!window.interact){let M=document.createElement("script");M.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",M.onload=()=>this._initInteract(),document.head.appendChild(M)}this._helpersPromise=null,this._built||(this._built=!0,this.innerHTML=`
        <style>

          :host{
            display:block;

            /* Defaults that card-mod can override from :host {} */
            --ddc-bg: var(--card-background-color);
            --ha-card-border-radius: 12px;
            --ha-card-box-shadow: var(--mdc-elevation-z2, 0 2px 12px rgba(0,0,0,.18));
          }

          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          ha-card{
            background: var(--ddc-bg, var(--card-background-color));
            border-radius: var(--ha-card-border-radius, 12px);
            box-shadow: var(--ha-card-box-shadow, var(--mdc-elevation-z2));
            overflow: hidden;
            padding: 0;
          }          
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            padding: 10px;

            /* All visuals now flow through variables that card-mod can set on :host */
            background: var(--ddc-bg, var(--card-background-color));
            border-radius: var(--ha-card-border-radius, 12px);
            box-shadow: var(--ha-card-box-shadow, 0 2px 12px rgba(0,0,0,.18));
            border: var(--ddc-border, 1px solid var(--divider-color));

            width: auto; height: auto; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }


          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:0;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab;
            /* ensure buttons and resize handles remain visible on very small cards */
            overflow:visible;
            border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:1;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
        .chip{
            position:absolute;
            top:8px;
            right:8px;
            display:flex;
            gap:6px;
            flex-wrap:wrap;             /* allow chip buttons to wrap when space is limited */
            opacity:0;
            transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .chip .mini{
            display:inline-flex;align-items:center;gap:6px;
            background:rgba(28,28,30,.78);color:#fff;border:1px solid rgba(255,255,255,.18);
            border-radius:999px;padding:6px 10px;font-size:.76rem;cursor:pointer;letter-spacing:.2px;
            box-shadow:0 2px 6px rgba(0,0,0,.25); transition:transform .08s, background .12s, box-shadow .12s
          }
          .chip .mini:hover{transform:translateY(-1px); background:rgba(28,28,30,.95); box-shadow:0 3px 10px rgba(0,0,0,.35)}
          .chip .mini ha-icon{--mdc-icon-size:18px;width:18px;height:18px}
          .chip .mini.danger{background:rgba(220, 38, 38, .9);border-color:rgba(255,255,255,.22)}
          .chip .mini.danger:hover{background:rgba(220, 38, 38, 1)}
          .chip .mini.pill{padding:6px}

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:none;
            position:absolute;
            /* Position the handle outside the card so it\u2019s always visible and clickable,
               even when the card is tiny or collapsed. */
            bottom:-14px;
            right:-14px;
            width:30px;
            height:30px;
            border-radius:50%;
            background:var(--primary-color);
            color:#fff;
            border:1px solid rgba(255,255,255,.25);
            cursor:se-resize;
            z-index:50; /* keep it above other card elements */
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            align-items:center;
            justify-content:center;
            transition:transform .1s, box-shadow .1s, background .12s;
          }
          .resize-handle:hover{transform:scale(1.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{--mdc-icon-size:18px;width:18px;height:18px;pointer-events:none}

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96vw);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{border-right:1px solid var(--divider-color);overflow:auto;background:var(--primary-background-color);contain:content}
          #rightPane{overflow:hidden;background:var(--primary-background-color)}
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);overflow:visible;position:relative;contain:content}
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}

          /* --- FIX: YAML editor should scroll and not overflow --- */
          #yamlSec { min-height: 0; }
          #yamlSec .bd { 
            overflow: auto;        /* allow scrolling inside the YAML section */
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec { min-height: 0; }
          #optionsSec .bd {
            overflow: auto;        /* scroll inside the Visual editor section */
            /* allow the visual editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          #editorHost { display:block; min-height: 0; }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: fixed and scroll inside */
          ha-code-editor { 
            display: block; 
            height: 260px !important; 
          }
          .CodeMirror { 
            height: 260px !important; 
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            max-height: 260px; 
            overflow: auto; 
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            display:flex;align-items:center;justify-content:center;width:100%;height:100%;
            background:repeating-conic-gradient(from 45deg, rgba(0,0,0,.05) 0% 25%, transparent 0% 50%) 50% / 14px 14px;pointer-events: none;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }
        </style>
        <ha-card class="ddc-card">
          <div class="ddc-root">
            <div class="toolbar">
              <button class="btn" id="addCardBtn" style="display:none">
                <ha-icon icon="mdi:plus"></ha-icon>
                <span style="margin-left:6px">Add Card</span>
              </button>
              <button class="btn secondary" id="reloadBtn" style="display:none">
                <ha-icon icon="mdi:refresh"></ha-icon>
                <span style="margin-left:6px">Reload</span>
              </button>
              <button class="btn secondary" id="diagBtn" style="display:none">
                <ha-icon icon="mdi:play-circle-outline"></ha-icon>
                <span style="margin-left:6px">Diagnostics</span>
              </button>
              <button class="btn secondary" id="exportBtn" style="display:none">
                <ha-icon icon="mdi:download"></ha-icon>
                <span style="margin-left:6px">Export Design</span>
              </button>
              <button class="btn secondary" id="importBtn" style="display:none">
                <ha-icon icon="mdi:upload"></ha-icon>
                <span style="margin-left:6px">Import Design</span>
              </button>
              <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
                <ha-icon icon="mdi:storefront-outline"></ha-icon>
                <span>Open HADS</span>
              </button>
              <button class="btn warning" id="exitEditBtn" style="display:none">
                <ha-icon icon="mdi:exit-run"></ha-icon>
                <span>Exit edit mode</span>
              </button>
              <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
            </div>
            <div class="card-container" id="cardContainer"></div>
          </div>
        </ha-card>          
      `,this.cardContainer=this.querySelector("#cardContainer"),this.addButton=this.querySelector("#addCardBtn"),this.reloadBtn=this.querySelector("#reloadBtn"),this.diagBtn=this.querySelector("#diagBtn"),this.exitEditBtn=this.querySelector("#exitEditBtn"),this.storeBadge=this.querySelector("#storeBadge"),this.exportBtn=this.querySelector("#exportBtn"),this.importBtn=this.querySelector("#importBtn"),this.exploreBtn=this.querySelector("#exploreBtn"),this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.exploreBtn.addEventListener("click",()=>window.open("https://cardstore.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),this._installLongPressToEnterEdit(),window.addEventListener("keydown",M=>{M.key==="Escape"&&this.editMode&&this._toggleEditMode(!1)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",M=>{this.editMode&&(M.target.closest(".card-wrapper")||!M.shiftKey&&!M.ctrlKey&&!M.metaKey&&this._clearSelection())}));try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),!this.__booted||l!==this.storageKey?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),this._resizeContainer())}connectedCallback(){this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1)}disconnectedCallback(){if(window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis),this.__lpInstalled&&this.__lpHandlers){let i=this.cardContainer;i==null||i.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),i==null||i.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}}set hass(i){var l;this._hass=i,sl("set hass"),!this.__probed&&i&&(this.__probed=!0,this._probeBackend().then(()=>this._initialLoad(!0)));let a=((l=this.cardContainer)==null?void 0:l.children)||[];for(let c of a){let u=c.firstElementChild;u&&u.hass!==i&&(u.hass=i)}}get hass(){return this._hass}async _initialLoad(i=!1){var m,v,y,S,_,E,T,F,L,M,D;this._loading=!0,i&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:i});let a=null;if(this._backendOK&&this.storageKey&&(a=await this._loadLayoutFromBackend(this.storageKey)),!a&&this.storageKey){let O=null;try{O=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(O&&this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(O).length}),O&&this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,O),this._dbgPush("boot","Migrated local -> backend"),a=O}catch(X){this._dbgPush("boot","Migration failed, staying local",{error:String(X)}),a=O}else O&&(a=O)}!a&&((v=(m=this._config)==null?void 0:m.cards)!=null&&v.length)&&(this._dbgPush("boot","Using embedded config"),a={cards:this._config.cards});let l={...this._config||{}};a!=null&&a.options?this._applyImportedOptions(a.options,!0):typeof(a==null?void 0:a.grid)=="number"&&this._applyImportedOptions({grid:a.grid},!0);let c=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation"],u={};for(let O of c)l[O]!==void 0&&(u[O]=l[O]);Object.keys(u).length&&this._applyImportedOptions(u,!0);let p=!1;if((y=a==null?void 0:a.cards)!=null&&y.length){for(let O of a.cards){if(!(O!=null&&O.card)||typeof O.card=="object"&&Object.keys(O.card).length===0){let C=this._makePlaceholderAt(((S=O.position)==null?void 0:S.x)||0,((_=O.position)==null?void 0:_.y)||0,((E=O.size)==null?void 0:E.width)||100,((T=O.size)==null?void 0:T.height)||100);this.cardContainer.appendChild(C),p=!0;continue}let X=await this._createCard(O.card),B=this._makeWrapper(X);this.editMode&&B.classList.add("editing"),this._setCardPosition(B,((F=O.position)==null?void 0:F.x)||0,((L=O.position)==null?void 0:L.y)||0),B.style.width=`${((M=O.size)==null?void 0:M.width)||14*this.gridSize}px`,B.style.height=`${((D=O.size)==null?void 0:D.height)||10*this.gridSize}px`,O.z!=null&&(B.style.zIndex=String(O.z)),this.cardContainer.appendChild(B),this._initCardInteract(B),p=!0}this._resizeContainer(),this._dbgPush("boot","Layout applied",{count:a.cards.length})}p||(this._showEmptyPlaceholder(),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI(),this._loading=!1}_toggleEditMode(i=null){var u,p,m,v;try{(u=this.__clearPressTimer)==null||u.call(this)}catch{}let a=i===null?!this.editMode:!!i,l=!this.editMode&&a;if(this.editMode=a,this.editMode=a,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(y=>{y.classList.toggle("editing",this.editMode);let S=y.querySelector(".resize-handle");S&&(S.style.display=this.editMode?"flex":"none"),!y.dataset.placeholder&&window.interact&&window.interact(y).draggable(this.editMode).resizable(this.editMode),y.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(p=this.cardContainer)==null||p.querySelectorAll(".card-wrapper.dragging").forEach(y=>y.classList.remove("dragging")),l){let y=(m=this.__lastHoldX)!=null?m:null,S=(v=this.__lastHoldY)!=null?v:null;this._playEditRipple(y,S)}}_isInHaEditorPreview(){let i=this;for(;i;){let a=i.nodeType===1&&i.localName?i.localName.toLowerCase():"";if(a==="hui-card-editor"||a==="hui-dialog-edit-card"||a==="hui-card-preview"||a==="ha-dialog"||a==="mwc-dialog")return!0;let l=i.getRootNode&&i.getRootNode();i=i.parentElement||l&&l.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let i=this.cardContainer;if(!i)return;let a=800,l=18,c=B=>!!B&&typeof B=="object"&&B.nodeType===1,u=(B,C)=>{try{return!!(B&&C&&typeof B.contains=="function"&&c(C)&&B.contains(C))}catch{return!1}},p=B=>u(this.cardContainer,B),m=B=>{var oe,G,ve;let C=(G=(oe=B.target)==null?void 0:oe.closest)==null?void 0:G.call(oe,".card-wrapper");if(c(C)&&p(C)&&!C.classList.contains("ddc-placeholder"))return!0;let te=typeof B.composedPath=="function"?B.composedPath():[];for(let se of te)if(c(se)&&p(se)&&(ve=se.classList)!=null&&ve.contains("card-wrapper")&&!se.classList.contains("ddc-placeholder"))return!0;return!1},v=(B,C)=>{let te=document.createElement("div");te.className="ddc-press-ring",document.body.appendChild(te),Object.assign(te.style,{position:"fixed",left:`${B}px`,top:`${C}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),te.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let oe=te.querySelector(".pr-fg"),G=18,ve=2*Math.PI*G;return oe.style.strokeDasharray=`${ve}`,oe.style.strokeDashoffset=`${ve}`,requestAnimationFrame(()=>{oe.style.transition=`stroke-dashoffset ${a}ms linear`,oe.style.strokeDashoffset="0"}),{el:te,move(se,Se){te.style.left=`${se}px`,te.style.top=`${Se}px`},remove(){try{te.remove()}catch{}}}},y=null,S=null,_=0,E=0,T=null,F=()=>{y&&clearTimeout(y),y=null,S==null||S.remove(),S=null};this.__clearPressTimer=F;let L=B=>{B.pointerType==="mouse"&&B.button!==0||this._isInHaEditorPreview()||!p(B.target)||m(B)||(T=B.pointerId,_=B.clientX,E=B.clientY,this.__lastHoldX=_,this.__lastHoldY=E,S=v(_,E),y=setTimeout(()=>{var te;F();let C=!this.editMode;this._toggleEditMode(C),(te=this._toast)==null||te.call(this,`Edit mode ${C?"enabled":"disabled"}`)},a))},M=B=>{y==null||B.pointerId!==T||(S==null||S.move(B.clientX,B.clientY),(Math.abs(B.clientX-_)>l||Math.abs(B.clientY-E)>l)&&F())},D=B=>{B.pointerId===T&&(F(),T=null)},O=B=>{if(y)return B.preventDefault(),B.stopPropagation(),!1},X=B=>{var te;if(this._isInHaEditorPreview()||!p(B.target)||m(B))return;let C=!this.editMode;this._toggleEditMode(C),(te=this._toast)==null||te.call(this,`Edit mode ${C?"enabled":"disabled"}`)};i.addEventListener("pointerdown",L),window.addEventListener("pointermove",M,{passive:!0}),window.addEventListener("pointerup",D,{passive:!0}),window.addEventListener("pointercancel",D,{passive:!0}),window.addEventListener("contextmenu",O),i.addEventListener("dblclick",X),this.__lpHandlers={onPointerDown:L,onPointerMove:M,onPointerUpOrCancel:D,onContextMenu:O,onDblClick:X}}_isLayoutEmpty(){let i=this.cardContainer;return i?i.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let i=this._isLayoutEmpty();if(this.addButton){let l=this.editMode||i;this.addButton.style.display=l?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&i)}let a=l=>l&&(l.style.display=this.editMode?"inline-block":"none");a(this.reloadBtn),a(this.diagBtn),a(this.exitEditBtn),a(this.exportBtn),a(this.importBtn),a(this.exploreBtn),a(this.storeBadge)}_playEditRipple(i=null,a=null){let l=this.cardContainer;if(!l)return;let c=l.getBoundingClientRect(),u=i==null?c.left+c.width/2:i,p=a==null?c.top+c.height/2:a,m=u-c.left,v=p-c.top,y=document.createElement("div");y.className="ddc-ripple-veil",y.style.setProperty("--rip-x",`${m}px`),y.style.setProperty("--rip-y",`${v}px`),l.appendChild(y),setTimeout(()=>y.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>this._initCardInteract(a))}_initCardInteract(i){if(!window.interact||i.dataset.placeholder)return;let a=this.gridSize,l=!!this.dragLiveSnap,u=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let p=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});u.push(window.interact.modifiers.snap({targets:[p],range:1/0,offset:"startCoords"}))}window.interact(i).draggable({enabled:this.editMode,inertia:!1,modifiers:u,listeners:{start:p=>{this._selection.has(i)||(!(p!=null&&p.shiftKey)&&!(p!=null&&p.ctrlKey)&&!(p!=null&&p.metaKey)&&this._clearSelection(),this._toggleSelection(i,!0));let m=Array.from(this._selection);this.__groupDrag={leader:i,members:m,startRaw:new Map(m.map(y=>[y,{x:parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,y:parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0,w:parseFloat(y.style.width)||y.getBoundingClientRect().width,h:parseFloat(y.style.height)||y.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(y=>{let S=parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,_=parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0;this.__collisionOriginals.set(y,{x:S,y:_})}),m.forEach(y=>{y.classList.add("dragging"),y.getAttribute("data-x-raw")===null&&y.setAttribute("data-x-raw",y.getAttribute("data-x")||"0"),y.getAttribute("data-y-raw")===null&&y.setAttribute("data-y-raw",y.getAttribute("data-y")||"0")})},move:p=>{if(!this.__groupDrag)return;let m=this.gridSize,v=!!this.dragLiveSnap,y=this.__groupDrag.leader,S=this.__groupDrag.startRaw.get(y),_=(parseFloat(y.getAttribute("data-x-raw"))||S.x)+p.dx,E=(parseFloat(y.getAttribute("data-y-raw"))||S.y)+p.dy,T=_-S.x,F=E-S.y,L=this.__groupDrag.members.map(M=>{let D=this.__groupDrag.startRaw.get(M),O=D.x+T,X=D.y+F,B=v?Math.round(O/m)*m:O,C=v?Math.round(X/m)*m:X;return{el:M,rawX:O,rawY:X,snapX:B,snapY:C,w:D.w,h:D.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(L,T,F,v,m),y.setAttribute("data-x-raw",String(_)),y.setAttribute("data-y-raw",String(E));for(let M of L)M.el.setAttribute("data-x-raw",String(M.rawX)),M.el.setAttribute("data-y-raw",String(M.rawY)),this._setCardPosition(M.el,M.snapX,M.snapY);this._resizeContainer()},end:p=>{if(!this.__groupDrag)return;let m=this.gridSize,v=this.__groupDrag.members.map(y=>{let S=parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,_=parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0,E=Math.round(S/m)*m,T=Math.round(_/m)*m,F=parseFloat(y.style.width)||y.getBoundingClientRect().width,L=parseFloat(y.style.height)||y.getBoundingClientRect().height;return{el:y,rawX:S,rawY:_,snapX:E,snapY:T,w:F,h:L}});this.disableOverlap&&this._pushCardsOutOfTheWay(v,0,0,!1,m);for(let y of v)this._setCardPosition(y.el,y.snapX,y.snapY),y.el.setAttribute("data-x-raw",String(y.snapX)),y.el.setAttribute("data-y-raw",String(y.snapY));for(let y of this.__groupDrag.members)y.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(i).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:p=>{let m=this.gridSize,v=!!this.dragLiveSnap,y=parseFloat(i.style.width)||i.getBoundingClientRect().width,S=parseFloat(i.style.height)||i.getBoundingClientRect().height,{width:_,height:E}=p.rect,T=v?Math.max(m,Math.round(_/m)*m):_,F=v?Math.max(m,Math.round(E/m)*m):E,L=parseFloat(i.getAttribute("data-x"))||0,M=parseFloat(i.getAttribute("data-y"))||0,D=T,O=F;if(this._isContainerFixed()){let{w:B,h:C}=this._getContainerSize();D=Math.min(T,Math.max(this.gridSize,B-L)),O=Math.min(F,Math.max(this.gridSize,C-M))}let X=[this._rectFor(i,L,M,D,O)];this.disableOverlap&&this._anyCollisionFor(X,new Set([i]))||(i.style.width=`${D}px`,i.style.height=`${O}px`,this._resizeContainer())},end:()=>{let p=this.gridSize,m=parseFloat(i.style.width)||i.getBoundingClientRect().width,v=parseFloat(i.style.height)||i.getBoundingClientRect().height,y=Math.max(p,Math.round(m/p)*p),S=Math.max(p,Math.round(v/p)*p),_=parseFloat(i.getAttribute("data-x"))||0,E=parseFloat(i.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:F,h:L}=this._getContainerSize();y=Math.min(y,Math.max(p,F-_)),S=Math.min(S,Math.max(p,L-E))}let T=[this._rectFor(i,_,E,y,S)];this.disableOverlap&&this._anyCollisionFor(T,new Set([i]))||(i.style.width=`${y}px`,i.style.height=`${S}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),i.addEventListener("mousedown",p=>{this.editMode&&(p.target.closest(".resize-handle")||p.target.closest(".chip")||(p.shiftKey||p.ctrlKey||p.metaKey?(p.stopPropagation(),this._toggleSelection(i)):this._selection.has(i)||(this._clearSelection(),this._toggleSelection(i,!0))))})}async _createCard(i){let a=this._childCardStyle;a&&(i={...i},i.card_mod||(i.card_mod={}),i.card_mod.style=(i.card_mod.style||"")+`
`+a);let c=await(await this._helpersPromise).createCardElement(i);return c.hass=this.hass,c}_makeWrapper(i){let a=document.createElement("div");a.classList.add("card-wrapper"),this.editMode&&a.classList.add("editing"),a.style.zIndex||(a.style.zIndex=String(this._highestZ()+1));let l=document.createElement("div");l.className="chip",l.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini danger pill" data-act="delete" title="Delete card" aria-label="Delete card">
        <ha-icon icon="mdi:close-thick"></ha-icon>
      </button>
    `,l.addEventListener("click",async p=>{var v,y,S;p.stopPropagation();let m=(S=(y=(v=p.target)==null?void 0:v.closest("button"))==null?void 0:y.dataset)==null?void 0:S.act;if(m){if(m==="delete")this._selection.size>1&&this._selection.has(a)?(Array.from(this._selection).forEach(E=>E.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(a.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(m==="duplicate"||m==="copy"){let _=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];for(let E of _){let T=this._extractCardConfig(E.firstElementChild)||{},F=await this._createCard(T),L=this._makeWrapper(F,T);L.style.width=E.style.width,L.style.height=E.style.height;let M=(parseFloat(E.getAttribute("data-x"))||0)+this.gridSize,D=(parseFloat(E.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(L,M,D),L.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(L),this._initCardInteract(L)}this._resizeContainer(),this._queueSave("duplicate")}else if(m==="front")this._adjustZ(a,1);else if(m==="back")this._adjustZ(a,-1);else if(m==="edit"){let _=this._extractCardConfig(a.firstElementChild)||{};await this._openSmartPicker("edit",_,async E=>{let T=await this._createCard(E);T.hass=this.hass;try{a.dataset.cfg=JSON.stringify(E)}catch{}a.replaceChild(T,a.firstElementChild),this._queueSave("edit")})}}});let c=document.createElement("div");c.className="shield";let u=document.createElement("div");u.classList.add("resize-handle"),u.title="Resize",u.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>';try{a.dataset.cfg=JSON.stringify(originalCfg||{})}catch{}return a.append(i,c,l,u),a}_makePlaceholderAt(i=0,a=0,l=100,c=100){let u=document.createElement("div");u.classList.add("card-wrapper","ddc-placeholder"),u.dataset.placeholder="1",this.editMode&&u.classList.add("editing"),this._setCardPosition(u,i,a),u.style.width=`${l}px`,u.style.height=`${c}px`,u.style.zIndex=String(this._highestZ()+1);let p=document.createElement("div");p.className="ddc-placeholder-inner",p.setAttribute("aria-hidden","true");let m=document.createElement("div");return m.className="shield",u.append(p,m),u}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let i=this._makePlaceholderAt(0,0,100,100);this.cardContainer.appendChild(i),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(i=>i.remove())}_ensurePlaceholderIfEmpty(){this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),this._syncEmptyStateUI()}_adjustZ(i,a){let c=parseInt(i.style.zIndex||"1",10)+a;c=Math.max(1,Math.min(9999,c)),i.style.zIndex=String(c),this._queueSave("z-change")}_highestZ(){let i=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>{let l=parseInt(a.style.zIndex||"0",10);l>i&&(i=l)}),i}_setCardPosition(i,a,l){let c=Math.round(a),u=Math.round(l);i.style.transform=`translate3d(${c}px, ${u}px, 0)`,i.setAttribute("data-x",String(c)),i.setAttribute("data-y",String(u)),i.setAttribute("data-x-raw",String(c)),i.setAttribute("data-y-raw",String(u))}_resizeContainer(){let i=this.cardContainer;if(!i||this._isContainerFixed())return;let a=Array.from(i.querySelectorAll(".card-wrapper")),l=0,c=0;a.forEach(u=>{let p=u.getBoundingClientRect(),m=i.getBoundingClientRect(),v=p.left-m.left+p.width,y=p.top-m.top+p.height;l=Math.max(l,v),c=Math.max(c,y)}),i.style.width=`${Math.ceil(l/this.gridSize)*this.gridSize||100}px`,i.style.height=`${Math.ceil(c/this.gridSize)*this.gridSize||100}px`}_pushCardsOutOfTheWay(i,a,l,c,u){if(!this.__collisionOriginals)return;let p=new Set(i.map(D=>D.el)),m=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(D=>!D.dataset.placeholder),v=this._isContainerFixed(),{w:y,h:S}=this._getContainerSize();for(let D of m){if(p.has(D))continue;let O=this.__collisionOriginals.get(D);if(O){D.setAttribute("data-x-raw",String(O.x)),D.setAttribute("data-y-raw",String(O.y));let X=c?Math.round(O.x/u)*u:O.x,B=c?Math.round(O.y/u)*u:O.y;this._setCardPosition(D,X,B)}}let _=i.map(D=>({x:D.snapX,y:D.snapY,w:D.w,h:D.h})),E=new Map,T=new Map;for(let D of m){let O=parseFloat(D.style.width)||D.getBoundingClientRect().width,X=parseFloat(D.style.height)||D.getBoundingClientRect().height;T.set(D,{w:O,h:X})}let F=a>0?1:a<0?-1:0,L=l>0?1:l<0?-1:0,M=Math.abs(a)>=Math.abs(l);for(let D of m){if(p.has(D))continue;let O=this.__collisionOriginals.get(D);if(!O)continue;let{x:X,y:B}=O,{w:C,h:te}=T.get(D),oe=!1;for(let G of _)if(this._rectsOverlap({x:G.x,y:G.y,w:G.w,h:G.h},{x:X,y:B,w:C,h:te})){oe=!0,M&&F!==0?X=F>0?G.x+G.w:G.x-C:!M&&L!==0?B=L>0?G.y+G.h:G.y-te:X=G.x+G.w;break}if(oe){let G=0,ve=M?F!==0?F*u:u:0,se=M?0:L!==0?L*u:u;for(;G<100;){let Se={x:X,y:B,w:C,h:te},de=!1;for(let xe of _)if(this._rectsOverlap(Se,xe)){de=!0;break}if(!de){for(let[,xe]of E)if(this._rectsOverlap(Se,xe)){de=!0;break}}if(!de&&v&&(X<0||B<0||X+C>y||B+te>S)&&(de=!0),!de)break;X+=ve,B+=se,G++}v&&(X=Math.max(0,Math.min(X,Math.max(0,y-C))),B=Math.max(0,Math.min(B,Math.max(0,S-te))))}E.set(D,{x:X,y:B,w:C,h:te}),_.push({x:X,y:B,w:C,h:te})}for(let[D,O]of E){D.setAttribute("data-x-raw",String(O.x)),D.setAttribute("data-y-raw",String(O.y));let X=c?Math.round(O.x/u)*u:O.x,B=c?Math.round(O.y/u)*u:O.y;this._setCardPosition(D,X,B)}}_rectFor(i,a=null,l=null,c=null,u=null){let p=a!=null?a:parseFloat(i.getAttribute("data-x"))||0,m=l!=null?l:parseFloat(i.getAttribute("data-y"))||0,v=c!=null?c:parseFloat(i.style.width)||i.getBoundingClientRect().width||0,y=u!=null?u:parseFloat(i.style.height)||i.getBoundingClientRect().height||0;return{x:p,y:m,w:v,h:y,el:i}}_rectsOverlap(i,a,l=.5){return!(i.x+i.w<=a.x+l||a.x+a.w<=i.x+l||i.y+i.h<=a.y+l||a.y+a.h<=i.y+l)}_anyCollisionFor(i,a){let l=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(u=>!a.has(u)&&!u.dataset.placeholder);if(!l.length)return!1;let c=l.map(u=>this._rectFor(u));for(let u of i)for(let p of c)if(this._rectsOverlap(u,p))return!0;return!1}_extractCardConfig(i){var l;if(!i)return{};try{let c=i.closest?i.closest(".card-wrapper"):null,u=(l=c==null?void 0:c.dataset)==null?void 0:l.cfg;if(u){let p=JSON.parse(u);if(p&&typeof p=="object")return p}}catch{}let a=i._config||i.config;return a&&typeof a=="object"&&Object.keys(a).length?a:{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(i,a){try{console.info("[ddc:editor] Requesting editor element",{type:i,cfg:a})}catch{}let l=await this._getHelpers();try{typeof i=="string"&&i&&!i.startsWith("custom:")&&i!=="custom_card"&&await this._ensureCardModuleLoaded(i,a)}catch{}let c=async()=>{try{if(l.getCardElementClass)return await l.getCardElementClass(i);let y;if(a&&typeof a=="object")y={type:i,...a};else{let _;try{_=await this._getStubConfigForType(i)}catch{}y=_&&typeof _=="object"?{..._}:{type:i}}let S=l.createCardElement(y);return(S==null?void 0:S.constructor)||null}catch{return null}};try{let y=await c();if(y&&typeof y.getConfigElement=="function"){let S=await y.getConfigElement();if(S){try{console.info("[ddc:editor] Found static class editor",{type:i})}catch{}return S}}}catch{}if(typeof i=="string"&&(i.startsWith("custom:")||i==="custom_card"||i==="entity"))try{let y;try{y=await this._getStubConfigForType(i)}catch{}let S=y&&typeof y=="object"?{...y}:{type:i},_=l.createCardElement(S);if(_.hass=this.hass,typeof _.getConfigElement=="function"){let E=await _.getConfigElement();if(E){try{console.info("[ddc:editor] Found instance-level editor",{type:i})}catch{}return E}}}catch{}let u=String(i).replace(/^custom:/,""),m=(Array.isArray(window.customCards)?window.customCards:[]).find(y=>(y==null?void 0:y.type)===u||(y==null?void 0:y.type)===i||(y==null?void 0:y.type)===`custom:${u}`),v=[];m!=null&&m.editor&&v.push(m.editor),v.push(`${u}-editor`,`${u}-config-editor`),u&&typeof u=="string"&&v.push(`hui-${u}-card-editor`);for(let y of v)if(!(!y||typeof y!="string"))for(let S of[0,100,300,700,1500,3e3])try{if(customElements.get(y)||await Promise.race([customElements.whenDefined(y),new Promise(_=>setTimeout(_,S))]),customElements.get(y)){try{console.info("[ddc:editor] Found editor by tag",{type:i,tag:y})}catch{}return document.createElement(y)}}catch{}return null}async _ensureCardModuleLoaded(i,a){try{let l=await this._getHelpers(),c;if(a&&typeof a=="object")c={type:i,...a};else{let m;try{m=await this._getStubConfigForType(i)}catch{}c=m&&typeof m=="object"?{...m}:{type:i}}let u=l.createCardElement(c);u.hass=this.hass;let p=document.createElement("div");p.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;",p.appendChild(u),document.body.appendChild(p),await new Promise(m=>requestAnimationFrame(m)),p.remove();try{console.info("[ddc:editor] Warmed card module",{type:i})}catch{}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let i=document.createElement("style");i.setAttribute("data-ddc-overlay-fix",""),i.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(i)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(a=>{var l;return{type:(l=a==null?void 0:a.type)!=null&&l.startsWith("custom:")?a.type:`custom:${a==null?void 0:a.type}`,name:(a==null?void 0:a.name)||(a==null?void 0:a.type)||"Custom card",icon:"mdi:puzzle-outline",description:(a==null?void 0:a.description)||"",editorTag:(a==null?void 0:a.editor)||null}}).filter(a=>typeof a.type=="string"&&a.type.startsWith("custom:"))}_schemaForType(i){let a=c=>c,l=[];return{entities:a({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities"}]}),entity:a({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity"}]}),sensor:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:a({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities (multiselect)"}]}),"picture-glance":a({fields:[{key:"entities",type:"entities",multi:!0,domains:l,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":a({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:a({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:a({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:a({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity"}]}),button:a({fields:[{key:"entity",type:"entity",multi:!1,domains:l,label:"Entity (optional)"}]}),iframe:a({fields:[{key:"url",type:"text",label:"URL"}]}),area:a({fields:[{key:"area",type:"text",label:"Area ID"}]})}[i]||{fields:[]}}_shapeBySchema(i,a={}){let l=this._schemaForType(i)||{fields:[]},c={...a,type:i};for(let u of l.fields){let p=c[u.key];if(u.type==="entities"){let v=(Array.isArray(p)?p:p!=null&&p!==""?[p]:[]).filter(Boolean);v.length?c[u.key]=v:delete c[u.key]}else if(u.type==="entity")Array.isArray(p)&&(p=p[0]),p==null||p===""?delete c[u.key]:c[u.key]=String(p);else if(u.type==="number")if(p==null||p==="")delete c[u.key];else{let m=Number(p);Number.isFinite(m)?c[u.key]=m:delete c[u.key]}else(u.type==="select"||u.type==="text"||u.type==="textarea")&&(p==null||p===""?delete c[u.key]:c[u.key]=p)}return c}_statesList(i){var c;let a=Object.keys(((c=this.hass)==null?void 0:c.states)||{});if(!i||!i.length)return a;if(!this.__domainIndex||this.__domainIndex._gen!==a.length){let u={};for(let p of a){let m=p.split(".")[0];(u[m]||(u[m]=[])).push(p)}this.__domainIndex={_gen:a.length,map:u}}let l=[];for(let u of i)this.__domainIndex.map[u]&&l.push(...this.__domainIndex.map[u]);return l}_isNumericEntity(i){var c,u;let a=(u=(c=this.hass)==null?void 0:c.states)==null?void 0:u[i];if(!a)return!1;let l=Number(a.state);return Number.isFinite(l)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(i){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(i)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(i){try{let a=this._getRecent().filter(l=>l!==i);a.unshift(i),a.length>10&&(a.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(a))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let i=document.createElement("link");i.rel="stylesheet",i.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",i.setAttribute("data-cm-core",""),document.head.appendChild(i)}await new Promise(i=>{if(window.CodeMirror)return i();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",a.onload=i,document.head.appendChild(a)}),await new Promise(i=>{var l,c;if((c=(l=window.CodeMirror)==null?void 0:l.mimeModes)!=null&&c.yaml)return i();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",a.onload=i,document.head.appendChild(a)}),this.__cmReady=!0}}async _mountYamlEditor(i,a,l,c){let u=v=>window.jsyaml?window.jsyaml.dump(v):JSON.stringify(v,null,2),p=v=>window.jsyaml?window.jsyaml.load(v):JSON.parse(v);i.innerHTML="";let m=u(a);if(customElements.get("ha-code-editor")){let v=document.createElement("ha-code-editor");v.mode="yaml",v.hass=this.hass,v.value=m,v.style.display="block",v.style.height="260px",i.appendChild(v);let y=!1;return v.addEventListener("value-changed",S=>{var E,T,F;if(y)return;let _=(F=(T=(E=S.detail)==null?void 0:E.value)!=null?T:v.value)!=null?F:"";try{l(p(_))}catch(L){c==null||c(L)}}),{setValue:S=>{var E;let _=u(S);((E=v.value)!=null?E:"")!==_&&(y=!0,v.value=_,y=!1)}}}try{await this._ensureCodeMirror();let v=window.CodeMirror(i,{value:m,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),y=!1;return v.on("change",()=>{if(y)return;let S=v.getValue();try{l(p(S))}catch(_){c==null||c(_)}}),{setValue:S=>{let _=u(S);v.getValue()!==_&&(y=!0,v.setValue(_),y=!1)}}}catch{let v=document.createElement("textarea");return v.style.width="100%",v.style.height="260px",v.value=m,v.addEventListener("input",()=>{try{l(p(v.value))}catch(y){c==null||c(y)}}),i.appendChild(v),{setValue:y=>{let S=u(y);v.value!==S&&(v.value=S)}}}}_createVirtualList({container:i,items:a,rowHeight:l=36,renderRow:c}){i.style.position="relative",i.style.overflow="auto";let u=document.createElement("div");u.style.height=`${a.length*l}px`,i.innerHTML="",i.appendChild(u);let p=new Map,m=()=>{let v=i.scrollTop,y=i.clientHeight,S=Math.max(0,Math.floor(v/l)-6),_=Math.min(a.length-1,Math.ceil((v+y)/l)+6);for(let[E,T]of p)(E<S||E>_)&&(T.remove(),p.delete(E));for(let E=S;E<=_;E++){if(p.has(E))continue;let T=c(a[E],E);T.style.position="absolute",T.style.left="0",T.style.right="0",T.style.top=`${E*l}px`,p.set(E,T),i.appendChild(T)}};return i.addEventListener("scroll",m,{passive:!0}),new ResizeObserver(m).observe(i),m(),{refresh(v){if(v){a=v,u.style.height=`${a.length*l}px`;for(let[,y]of p)y.remove();p.clear()}m()}}}async _openSmartPicker(i="add",a=null,l=null){let c=()=>u.remove(),u=document.createElement("div");u.className="modal",u.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${i==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${i==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${i==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.appendChild(u);let p=u.querySelector("#leftPane"),m=u.querySelector("#addBtn"),v=u.querySelector("#footAdd"),y=u.querySelector("#cancelBtn"),S=u.querySelector("#footCancel"),_=u.querySelector("#search"),E=u.querySelector("#cardHost"),T=u.querySelector("#editorHost"),F=u.querySelector("#editorSpin"),L=u.querySelector("#quickFill"),M=u.querySelector("#yamlHost"),D=u.querySelector("#yamlErr"),O=u.querySelector("#yamlSec"),X=u.querySelector("#tabVisual"),B=u.querySelector("#tabYaml"),C=u.querySelector("#err"),te=u.querySelector("#previewSpin"),oe=R=>{m.disabled=v.disabled=!R},G=R=>{R?(C.hidden=!1,C.textContent=R):(C.hidden=!0,C.textContent="")},ve=this._getFaves(),se=this._getRecent(),Se=this._catalog(),de=Se.find(R=>R.id==="favorites"),xe=Se.find(R=>R.id==="recent"),Ae=Se.flatMap(R=>R.items||[]);de.items=Ae.filter(R=>ve.has(R.type)),xe.items=se.map(R=>Ae.find(j=>j.type===R)).filter(Boolean);let Xe=this._customCardsFromRegistry();Xe.length&&Se.push({id:"custom",name:"Custom (installed)",items:Xe});let Mt=u.querySelector("#quickFillSec");Mt&&(Mt.style.display="none");let qe=u.querySelector("#optionsSec"),$e=u.querySelector("#yamlSec");qe&&(qe.style.gridRow="1"),$e&&($e.style.gridRow="2");let Ve=u.querySelector("#optionsSec .hd"),Ke,De,Pt=()=>{if(!De)return;let R=ge&&ve.has(ge),j=De.querySelector("ha-icon");j&&j.setAttribute("icon",R?"mdi:star":"mdi:star-outline")},gt=R=>{if(Ke){let j=Ae.find(re=>re.type===R),ie=j?j.name:R||"";Ke.textContent=ie}Pt()};if(Ve&&!Ve.querySelector(".sel-info")){let R=Ve.querySelector("span");R&&(R.style.display="none"),Ke=document.createElement("span"),Ke.className="sel-info",Ke.style.flex="1",Ke.style.fontWeight="bold",Ke.style.paddingRight="8px",Ve.insertBefore(Ke,Ve.firstChild),De=document.createElement("button"),De.className="icon-btn",De.setAttribute("title","Favorite"),Object.assign(De.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--primary-background-color)",padding:"0",marginLeft:"4px",cursor:"pointer"}),De.innerHTML='<ha-icon icon="mdi:star-outline"></ha-icon>',Ve.appendChild(De),De.addEventListener("click",j=>{j.stopPropagation(),ge&&(ve.has(ge)?ve.delete(ge):ve.add(ge),this._setFaves(ve),Pt(),Y())})}let nt="visual",Ge=R=>{let j=R==="yaml";X.classList.toggle("active",!j),X.setAttribute("aria-selected",String(!j)),B.classList.toggle("active",j),B.setAttribute("aria-selected",String(j)),T.parentElement.style.display=j?"none":"",O.style.display=j?"":"none",j&&O.scrollIntoView({behavior:"smooth",block:"start"}),nt=j?"yaml":"visual"};X.addEventListener("click",async()=>{var R;if(Ge("visual"),!ue)await mt(U);else try{(R=ue.setConfig)==null||R.call(ue,U)}catch{}}),B.addEventListener("click",()=>Ge("yaml")),Ge("yaml");let Wt=()=>{let R=_.value.trim().toLowerCase();return Se.map(j=>({...j,items:(j.items||[]).filter(ie=>!R||ie.name.toLowerCase().includes(R)||ie.type.toLowerCase().includes(R))})).filter(j=>j.items&&j.items.length||j.id==="favorites"||j.id==="recent")},Y=()=>{let R=Wt();p.innerHTML="",R.forEach(j=>{let ie=document.createElement("div");ie.style.padding="12px",ie.style.borderBottom="1px solid var(--divider-color)";let re=document.createElement("h4");if(re.textContent=j.name,re.style.margin="0 0 10px 0",re.style.fontSize=".92rem",re.style.opacity=".85",ie.appendChild(re),!j.items.length&&(j.id==="favorites"||j.id==="recent")){let ae=document.createElement("div");ae.style.opacity=".6",ae.style.fontSize=".85rem",ae.textContent=j.id==="favorites"?"No favorites yet.":"No recent items yet.",ie.appendChild(ae)}else j.items.forEach(ae=>{let pe=document.createElement("button");pe.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${ae.icon}"></ha-icon><span>${ae.name}</span>
            </span>`,Object.assign(pe.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),pe.addEventListener("click",async()=>{Xt(pe),await yt(ae.type)}),ie.appendChild(pe)});p.appendChild(ie)})},Xt=R=>{p.querySelectorAll("button").forEach(j=>{j.classList.remove("active"),j.style.background="transparent",j.style.color=""}),R&&(R.classList.add("active"),R.style.background="rgba(3,169,244,.12)",R.style.color="var(--primary-color)")},U=null,ge=null,le=null,ue=null,Le=0,Ue=null,It="",Ze=(R,j)=>{var ke;let ie=this._schemaForType(R);if(L.innerHTML="",!ie.fields.length){L.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let re=Object.keys(((ke=this.hass)==null?void 0:ke.states)||{}),ae=document.createElement("div"),pe=(H,ce,_e,Re)=>{let he=document.createElement("div");Object.assign(he.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),he.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${H}</span>`,ce.includes(H)&&(he.style.background="rgba(3,169,244,.12)",he.style.borderColor="var(--primary-color)",he.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),he.addEventListener("click",async()=>{let Be=ce.indexOf(H);Be>=0?ce.splice(Be,1):ce.push(H);let je=ce.includes(H);he.style.background=je?"rgba(3,169,244,.12)":"",he.style.borderColor=je?"var(--primary-color)":"var(--divider-color)",he.querySelector("ha-icon").setAttribute("icon",je?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),U=this._shapeBySchema(R,{...U,[Re]:[...ce]}),He(U),le==null||le.setValue(U)}),_e.appendChild(he)};ie.fields.forEach(H=>{var Re,he,Be,je,Ft,_t,Lt,wt,St;let ce=document.createElement("div");Object.assign(ce.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let _e=document.createElement("label");if(_e.textContent=H.label||H.key,_e.style.minWidth="130px",H.type==="entities"){let ne=document.createElement("div");ne.style.flex="1";let Z=document.createElement("input");Object.assign(Z,{placeholder:"Filter entities\u2026"}),Object.assign(Z.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let me=document.createElement("div");Object.assign(me.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let Te=H.domains&&H.domains.length?this._statesList(H.domains):re,Oe=Array.isArray(j[H.key])?[...j[H.key]]:j[H.key]?[j[H.key]]:[],kt=Je=>{let we=document.createElement("div");Object.assign(we.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let Ye=document.createElement("ha-icon");Ye.setAttribute("icon","mdi:checkbox-blank-outline"),Ye.style.setProperty("--mdc-icon-size","18px");let Me=document.createElement("span");Me.textContent=Je,Me.style.whiteSpace="nowrap",Me.style.overflow="hidden",Me.style.textOverflow="ellipsis",we.append(Ye,Me);let Gt=()=>{let rt=Oe.includes(Je);we.style.background=rt?"rgba(3,169,244,.12)":"",we.style.borderColor=rt?"var(--primary-color)":"var(--divider-color)",Ye.setAttribute("icon",rt?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return Gt(),we.addEventListener("click",()=>{let rt=Oe.indexOf(Je);rt>=0?Oe.splice(rt,1):Oe.push(Je),U=this._shapeBySchema(R,{...U,[H.key]:[...Oe]}),He(U),le==null||le.setValue(U),Gt()}),we},zt=Te;this._createVirtualList({container:me,items:zt,rowHeight:36,renderRow:kt}),Z.addEventListener("input",()=>{let Je=Z.value.trim().toLowerCase();zt=Te.filter(we=>!Je||we.toLowerCase().includes(Je)),this._createVirtualList({container:me,items:zt,rowHeight:36,renderRow:kt})}),ne.append(Z,me),ce.append(_e,ne),U=this._shapeBySchema(R,{...j,[H.key]:Oe})}if(H.type==="entity"){let ne=document.createElement("div");ne.style.flex="1",ne.style.position="relative";let Z=document.createElement("input");Z.setAttribute("list","ddc_entlist_"+H.key),Object.assign(Z.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),Z.placeholder=`Select ${((Re=H.label)==null?void 0:Re.toLowerCase())||"entity"}\u2026`;let me=document.createElement("ha-icon");me.setAttribute("icon","mdi:magnify"),Object.assign(me.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let Te=document.createElement("datalist");Te.id="ddc_entlist_"+H.key;let Oe=H.domains&&H.domains.length?this._statesList(H.domains):Object.keys(((he=this.hass)==null?void 0:he.states)||{});Te.innerHTML=Oe.map(kt=>`<option value="${kt}">`).join(""),Z.value=Array.isArray(j[H.key])?j[H.key][0]||"":j[H.key]||"",Z.addEventListener("change",async()=>{U=this._shapeBySchema(R,{...U,[H.key]:Z.value||void 0}),He(U),le==null||le.setValue(U)}),ne.append(me,Z,Te),ce.append(_e,ne)}if(H.type==="number"){let ne=document.createElement("div");ne.style.flex="1",ne.style.position="relative";let Z=document.createElement("input");Z.type="number",H.step&&(Z.step=H.step),Object.assign(Z.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let me=document.createElement("ha-icon");me.setAttribute("icon","mdi:counter"),Object.assign(me.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),Z.value=(je=(Be=j[H.key])!=null?Be:H.default)!=null?je:"",Z.addEventListener("input",async()=>{let Te=Z.value===""?void 0:Number(Z.value);U=this._shapeBySchema(R,{...U,[H.key]:isNaN(Te)?void 0:Te}),He(U),le==null||le.setValue(U)}),ne.append(me,Z),ce.append(_e,ne)}if(H.type==="select"){let ne=document.createElement("div");ne.style.flex="1",ne.style.position="relative";let Z=document.createElement("select");Object.assign(Z.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let me=document.createElement("ha-icon");me.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(me.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(H.options||[]).forEach(Te=>{let Oe=document.createElement("option");Oe.value=Te,Z.appendChild(Oe)}),Z.value=(Lt=(Ft=j[H.key])!=null?Ft:H.default)!=null?Lt:((_t=H.options)==null?void 0:_t[0])||"",Z.addEventListener("change",async()=>{U=this._shapeBySchema(R,{...U,[H.key]:Z.value}),He(U),le==null||le.setValue(U)}),ne.append(me,Z),ce.append(_e,ne)}if(H.type==="text"){let ne=document.createElement("div");ne.style.flex="1",ne.style.position="relative";let Z=document.createElement("input");Z.type="text",Object.assign(Z.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let me=document.createElement("ha-icon");me.setAttribute("icon","mdi:text"),Object.assign(me.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),Z.value=(wt=j[H.key])!=null?wt:"",Z.addEventListener("input",async()=>{U=this._shapeBySchema(R,{...U,[H.key]:Z.value||void 0}),He(U),le==null||le.setValue(U)}),ne.append(me,Z),ce.append(_e,ne)}if(H.type==="textarea"){let ne=document.createElement("textarea");Object.assign(ne.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),ne.value=(St=j[H.key])!=null?St:"",ne.addEventListener("input",async()=>{U=this._shapeBySchema(R,{...U,[H.key]:ne.value||""}),He(U),le==null||le.setValue(U)}),ce.append(_e,ne)}ae.appendChild(ce)}),L.innerHTML="",L.appendChild(ae)},He=R=>{let j=JSON.stringify(R||{});j!==It&&(It=j,Ue&&clearTimeout(Ue),Ue=setTimeout(async()=>{let ie=++Le;te.hidden=!1,E.innerHTML="",await Sr();try{let re=await this._getHelpers();if(ie!==Le)return;let ae=re.createCardElement(R);if(ae.hass=this.hass,ie!==Le)return;E.appendChild(ae)}catch{}finally{ie===Le&&(te.hidden=!0)}},150))},mt=async R=>{var ae;let j=++Le;if(F.hidden=!1,T.innerHTML="",await ll(),j!==Le)return F.hidden=!0,!1;let ie=R.type||ge,re=await this._getEditorElementForType(ie,R);if(!re){await this._ensureCardModuleLoaded(ie,R);for(let pe of[0,120,250,500,900,2e3,4e3])if(pe&&await new Promise(ke=>setTimeout(ke,pe)),re=await this._getEditorElementForType(ie,R),re)break}if(!re){let pe=document.createElement("div");return pe.style.opacity=".7",pe.style.fontSize=".9rem",pe.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",j===Le&&(T.appendChild(pe),F.hidden=!0),ue=null,oe(!0),nt!=="visual"&&Ge("yaml"),!1}try{re.hass=this.hass,re.isConnected||T.appendChild(re),await Promise.resolve();try{re.setConfig(R)}catch{}try{let ke=await this._getHelpers(),H=ke.getCardElementClass?await ke.getCardElementClass(R.type||ge):null;if(H!=null&&H.getStubConfig){let ce=Object.keys(((ae=this.hass)==null?void 0:ae.states)||{}),_e=he=>ce.filter(Be=>Be.startsWith(he+".")),Re=await H.getStubConfig(this.hass,ce,_e);Re&&(R=this._shapeBySchema(R.type||ge,{...Re}))}}catch{}await Promise.resolve();try{re.setConfig(R)}catch{}ue&&this.__onEditorChange&&(ue.removeEventListener("config-changed",this.__onEditorChange),ue.removeEventListener("value-changed",this.__onEditorChange));let pe=async ke=>{var _e,Re,he;let H=(he=(_e=ke.detail)==null?void 0:_e.config)!=null?he:(Re=ke.detail)==null?void 0:Re.value;if(!H)return;let ce=H.type||ge;ge=ce,U=this._shapeBySchema(ce,H),G(""),oe(!0),Ze(ge,U),He(U),le==null||le.setValue(U)};return this.__onEditorChange=pe,re.addEventListener("config-changed",pe),re.addEventListener("value-changed",pe),ue=re,nt!=="yaml"&&Ge("visual"),oe(!0),!0}finally{j===Le&&(F.hidden=!0)}},vt=async R=>{le=await this._mountYamlEditor(M,R,async j=>{var ie,re;try{let ae=(j==null?void 0:j.type)||ge,pe=this._shapeBySchema(ae,j||{}),ke=ae!==ge;if(ge=ae,U=pe,D.hidden=!0,D.textContent="",oe(!0),ke){if(Ze(ge,U),ue){try{(ie=ue.setConfig)==null||ie.call(ue,U)}catch{}nt!=="yaml"&&Ge("visual")}}else{try{(re=ue==null?void 0:ue.setConfig)==null||re.call(ue,U)}catch{}He(U)}}catch(ae){D.hidden=!1,D.textContent=`Invalid config: ${String((ae==null?void 0:ae.message)||ae)}`,oe(!1)}},j=>{D.hidden=!1,D.textContent=`Invalid YAML: ${String((j==null?void 0:j.message)||j)}`,oe(!1)})},Vt=async R=>{if(this.__stubCache.has(R))return{...this.__stubCache.get(R)};let j=await this._getStubConfigForType(R);return this.__stubCache.set(R,{...j}),{...j}},yt=async R=>{D.hidden=!0,D.textContent="",G(""),ge=R;try{typeof gt=="function"&&gt(R)}catch{}let j=i==="edit"&&a&&a.type===R?{...a}:await Vt(R);U=this._shapeBySchema(R,j),ue=null,Ze(R,U),await vt(U),await Sr(),He(U),Ge("yaml"),oe(!0)},it=async()=>{if(!U)return;let R=this._shapeBySchema(ge,U);i==="edit"&&typeof l=="function"?await l(R):(await this._addPickedCardToLayout(R),this._pushRecent((R||{}).type)),c()};y.addEventListener("click",c),S.addEventListener("click",c),m.addEventListener("click",it),v.addEventListener("click",it),u.addEventListener("keydown",R=>{R.key==="Escape"&&c(),R.key==="Enter"&&!m.disabled&&it()});let bt=null;_.addEventListener("input",()=>{bt&&clearTimeout(bt),bt=setTimeout(Y,120)}),Y(),await yt((()=>{var ie;return(((ie=this._getRecent)==null?void 0:ie.call(this))||[]).find(Boolean)||"entities"})()),oe(!0),i==="edit"&&a&&(await yt(a.type||"entities"),oe(!0))}async _getStubConfigForType(i){var y;let a=await this._getHelpers(),l=null;if(i==="custom_card")return{type:"custom_card"};try{a.getCardElementClass&&(l=await a.getCardElementClass(i))}catch{}let c=Object.keys(((y=this.hass)==null?void 0:y.states)||{}),u=S=>c.filter(_=>_.startsWith(S+"."));if(l!=null&&l.getStubConfig)try{return await l.getStubConfig(this.hass,c,u)}catch{}let p={type:i},m=c[0],v=u("sensor")[0]||m;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast","map"].includes(i)){let S={sensor:v,gauge:u("sensor").find(this._isNumericEntity.bind(this))||v,"media-control":u("media_player")[0]||m,light:u("light")[0]||m,thermostat:u("climate")[0]||m,"alarm-panel":u("alarm_control_panel")[0]||m,"weather-forecast":u("weather")[0]||m,map:u("device_tracker")[0]||u("person")[0]||m}[i]||v||m;["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity"].includes(i)?p.entity=S:i==="weather-forecast"?(p.entity=S,p.show_current=!0,p.show_forecast=!0,p.forecast_type="daily"):i==="map"&&(p.entities=[S].filter(Boolean),p.theme_mode="auto")}if(["entities","glance","picture-glance","history-graph","statistics-graph"].includes(i)){let S=_=>(_!=null&&_.length?c.filter(E=>_.includes(E.split(".")[0])):c).slice(0,3);i==="statistics-graph"?p.entities=S(["sensor","number","input_number"]):p.entities=S()}if(i==="markdown"&&(p.content="Markdown card"),i==="sensor"&&(p.graph="line"),i==="button"&&(p.show_name=!0,p.show_icon=!0),i==="tile"&&(p.features_position="bottom",p.vertical=!1),i==="picture-glance"&&(p.title=p.title||"Glance",p.image=p.image||"https://demo.home-assistant.io/stub_config/kitchen.png"),i==="picture-entity"&&(p.image=p.image||"https://demo.home-assistant.io/stub_config/bedroom.png"),i==="iframe"&&(p.url=p.url||"https://www.home-assistant.io",p.aspect_ratio=p.aspect_ratio||"50%"),i==="alarm-panel"&&(p.states=p.states||["arm_home","arm_away"]),i==="area")try{let S=this.hass&&this.hass.areas?Object.values(this.hass.areas):[];S.length?p.area=S[0].area_id||S[0].name||S[0].id:p.area=m?m.split(".")[0]:"default_area",p.display_type="picture",p.alert_classes=p.alert_classes||["moisture","motion"],p.sensor_classes=p.sensor_classes||["temperature","humidity"],p.features_position="bottom"}catch{}return p}_getNextAvailablePosition(){let i=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),a=new Set,l=this.gridSize;i.forEach(p=>{let m=parseFloat(p.getAttribute("data-x"))||0,v=parseFloat(p.getAttribute("data-y"))||0,y=parseFloat(getComputedStyle(p).width)||100,S=parseFloat(getComputedStyle(p).height)||100,_=Math.floor(m/l),E=Math.floor(v/l),T=Math.floor((m+y)/l),F=Math.floor((v+S)/l);for(let L=_;L<T;L++)for(let M=E;M<F;M++)a.add(`${L}-${M}`)});let c=0,u=0;for(;a.has(`${c}-${u}`);)c+=6,c>60&&(c=0,u+=6);return{x:c*l,y:u*l}}async _addPickedCardToLayout(i){this._hideEmptyPlaceholder();let a=await this._createCard(i),l=this._makeWrapper(a),c=this._getNextAvailablePosition();this._setCardPosition(l,c.x,c.y),l.style.width=`${14*this.gridSize}px`,l.style.height=`${10*this.gridSize}px`,l.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(l),this._initCardInteract(l),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI()}_toggleSelection(i,a=null){let l=a==null?!this._selection.has(i):!!a;l?this._selection.add(i):this._selection.delete(i),i.classList.toggle("selected",l)}_clearSelection(){for(let i of this._selection)i.classList.remove("selected");this._selection.clear()}_installSelectionMarquee(){let i=this.cardContainer,a=0,l=0,c=null,u=!1,p=_=>{let E=i.getBoundingClientRect(),T="touches"in _&&_.touches[0]?_.touches[0].clientX:_.clientX,F="touches"in _&&_.touches[0]?_.touches[0].clientY:_.clientY;return{x:T-E.left,y:F-E.top}},m=(_,E)=>{let T=Math.min(_,a),F=Math.max(_,a),L=Math.min(E,l),M=Math.max(E,l);c.style.left=`${T}px`,c.style.top=`${L}px`,c.style.width=`${F-T}px`,c.style.height=`${M-L}px`;let D=c.getBoundingClientRect(),O=i.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),O.forEach(X=>{let B=X.getBoundingClientRect();!(B.right<D.left||B.left>D.right||B.bottom<D.top||B.top>D.bottom)&&this._toggleSelection(X,!0)})},v=_=>{if(!this.editMode||_.target.closest(".card-wrapper"))return;u=!0;let E=p(_);a=E.x,l=E.y,c=document.createElement("div"),c.className="marquee",c.style.left=`${a}px`,c.style.top=`${l}px`,i.appendChild(c),_.preventDefault()},y=_=>{!u||!c||m(p(_).x,p(_).y)},S=()=>{u&&(u=!1,c&&c.remove(),c=null)};i.addEventListener("mousedown",v),window.addEventListener("mousemove",y),window.addEventListener("mouseup",S),i.addEventListener("touchstart",_=>{this.editMode&&(_.target.closest(".card-wrapper")||v(_))},{passive:!1}),window.addEventListener("touchmove",_=>{y(_)},{passive:!1}),window.addEventListener("touchend",S),window.addEventListener("touchcancel",S)}async _openDiagnostics(){var m,v;let i=document.createElement("div");i.className="modal";let a=this.storageKey||"(none)",l=this._backendOK&&!!this.storageKey,c=y=>y.slice(-200).map(S=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${S.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${S.kind}]</b>
        <span style="margin-left:6px">${this._safe(S.msg)}</span>
        ${S.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(S.extra,null,2))}</pre>`:""}
      </div>`).join("");i.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95vw);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((m=this._config)==null?void 0:m.storage_key)||"")}</code> \u2192 <code>${this._safe(a)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${l?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((v=this.cardContainer)==null?void 0:v.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${c(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let u=()=>i.remove();i.querySelector("#closeDiag").addEventListener("click",u),this.appendChild(i);let p=()=>{let y=i.querySelector("#logArea"),S=_=>_.slice(-200).map(E=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${E.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${E.kind}]</b>
          <span style="margin-left:6px">${this._safe(E.msg)}</span>
          ${E.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(E.extra,null,2))}</pre>`:""}
        </div>`).join("");y.innerHTML=S(this._dbgDump()),y.scrollTop=y.scrollHeight};i.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{p()}}),i.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),p()}),i.querySelector("#exportJson").addEventListener("click",()=>{let S=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(F=>{let L=parseFloat(F.getAttribute("data-x"))||0,M=parseFloat(F.getAttribute("data-y"))||0,D=parseFloat(F.style.width)||F.getBoundingClientRect().width,O=parseFloat(F.style.height)||F.getBoundingClientRect().height,X=parseInt(F.style.zIndex||"1",10);return{card:this._extractCardConfig(F.firstElementChild),position:{x:L,y:M},size:{width:D,height:O},z:X}}),_={version:2,options:this._exportableOptions(),cards:S},E=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),T=document.createElement("a");T.href=URL.createObjectURL(E),T.download=`ddc_${this.storageKey||"layout"}.json`,T.click(),URL.revokeObjectURL(T.href)}),i.querySelector("#importJson").addEventListener("click",async()=>{let y=document.createElement("input");y.type="file",y.accept="application/json",y.onchange=async()=>{var T,F,L,M,D,O,X,B,C,te;let S=(T=y.files)==null?void 0:T[0];if(!S)return;let _=await S.text();try{let oe=JSON.parse(_);if(this._dbgPush("import","Loaded file",{bytes:_.length}),this.cardContainer.innerHTML="",(F=oe.cards)!=null&&F.length)for(let G of oe.cards)if(!(G!=null&&G.card)||typeof G.card=="object"&&Object.keys(G.card).length===0){let ve=this._makePlaceholderAt(((L=G.position)==null?void 0:L.x)||0,((M=G.position)==null?void 0:M.y)||0,((D=G.size)==null?void 0:D.width)||100,((O=G.size)==null?void 0:O.height)||100);this.cardContainer.appendChild(ve)}else{let ve=await this._createCard(G.card),se=this._makeWrapper(ve,cfg);this._setCardPosition(se,((X=G.position)==null?void 0:X.x)||0,((B=G.position)==null?void 0:B.y)||0),se.style.width=`${((C=G.size)==null?void 0:C.width)||140}px`,se.style.height=`${((te=G.size)==null?void 0:te.height)||100}px`,this.cardContainer.appendChild(se),this._initCardInteract(se)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1)}catch(oe){this._dbgPush("import","Parse failed",{error:String(oe)})}let E=new Event("ddc-logrefresh");window.dispatchEvent(E)},y.click()}),i.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),p();let y=(this.storageKey||"ddc_test")+"_selftest",S={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(y,S);let _=await this._loadLayoutFromBackend(y);this._dbgPush("test","Round-trip result",{wrote:S,read:_})}catch(_){this._dbgPush("test","Round-trip failed",{error:String(_)})}p()}),p()}_exportableOptions(){var a,l;let i={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(a=this.containerFixedWidth)!=null?a:void 0,container_fixed_height:(l=this.containerFixedHeight)!=null?l:void 0,container_preset:this.containerPreset};return Object.keys(i).forEach(c=>i[c]===void 0&&delete i[c]),i}_applyImportedOptions(i={},a=!0){var l,c,u;if(i&&Object.prototype.hasOwnProperty.call(i,"storage_key"))try{let p={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:p}}))}catch{}this._config={...this._config||{},...i},"storage_key"in i&&(this.storageKey=i.storage_key||void 0),this._syncEditorsStorageKey(),"grid"in i&&(this.gridSize=Number(i.grid)||10),"drag_live_snap"in i&&(this.dragLiveSnap=!!i.drag_live_snap),"auto_save"in i&&(this.autoSave=!!i.auto_save),"auto_save_debounce"in i&&(this.autoSaveDebounce=Number(i.auto_save_debounce)||800),"container_background"in i&&(this.containerBackground=(l=i.container_background)!=null?l:"transparent"),"card_background"in i&&(this.cardBackground=(c=i.card_background)!=null?c:"var(--ha-card-background, var(--card-background-color))"),"debug"in i&&(this.debug=!!i.debug),"disable_overlap"in i&&(this.disableOverlap=!!i.disable_overlap),"container_size_mode"in i&&(this.containerSizeMode=i.container_size_mode||"dynamic"),"container_fixed_width"in i&&(this.containerFixedWidth=Number(i.container_fixed_width)||null),"container_fixed_height"in i&&(this.containerFixedHeight=Number(i.container_fixed_height)||null),"container_preset"in i&&(this.containerPreset=i.container_preset||"fhd"),"container_preset_orientation"in i&&(this.containerPresetOrient=i.container_preset_orientation||"auto"),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),a&&(this._applyContainerSizingFromConfig(!0),this._resizeContainer(),(u=this._updateStoreBadge)==null||u.call(this))}_exportDesign(){let a=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(m=>{let v=parseFloat(m.getAttribute("data-x"))||0,y=parseFloat(m.getAttribute("data-y"))||0,S=parseFloat(m.style.width)||m.getBoundingClientRect().width,_=parseFloat(m.style.height)||m.getBoundingClientRect().height,E=parseInt(m.style.zIndex||"1",10);return{card:this._extractCardConfig(m.firstElementChild),position:{x:v,y},size:{width:S,height:_},z:E}}),l={version:2,options:this._exportableOptions(),cards:a},c=`ddc_design_${this.storageKey||"layout"}.json`,u=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),p=document.createElement("a");p.href=URL.createObjectURL(u),p.download=c,p.click(),URL.revokeObjectURL(p.href),this._toast("Design exported.")}_importDesign(){let i=document.createElement("input");i.type="file",i.accept="application/json",i.onchange=async()=>{var c,u,p,m,v,y,S,_,E,T,F;let a=(c=i.files)==null?void 0:c[0];if(!a)return;let l=await a.text();try{let L=JSON.parse(l);if(L.options?this._applyImportedOptions(L.options,!0):typeof L.grid=="number"&&this._applyImportedOptions({grid:L.grid},!0),(u=L==null?void 0:L.options)!=null&&u.storage_key){let M=L.options.storage_key;this._config={...this._config||{},storage_key:M},this.storageKey=M,this._syncEditorsStorageKey();try{let D={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:D}}))}catch{}}if(this.cardContainer.innerHTML="",(p=L.cards)!=null&&p.length)for(let M of L.cards)if(!(M!=null&&M.card)||typeof M.card=="object"&&Object.keys(M.card).length===0){let D=this._makePlaceholderAt(((m=M.position)==null?void 0:m.x)||0,((v=M.position)==null?void 0:v.y)||0,((y=M.size)==null?void 0:y.width)||100,((S=M.size)==null?void 0:S.height)||100);this.cardContainer.appendChild(D)}else{let D=await this._createCard(M.card),O=this._makeWrapper(D,cfg);this._setCardPosition(O,((_=M.position)==null?void 0:_.x)||0,((E=M.position)==null?void 0:E.y)||0),O.style.width=`${((T=M.size)==null?void 0:T.width)||140}px`,O.style.height=`${((F=M.size)==null?void 0:F.height)||100}px`,M.z!=null&&(O.style.zIndex=String(M.z)),this.cardContainer.appendChild(O),this._initCardInteract(O)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1),this._toast("Design imported.")}catch(L){console.error("Import failed",L),this._toast("Import failed \u2014 invalid file.")}},i.click()}_queueSave(i="auto"){this.autoSave&&(this._loading||this.editMode&&(this._dbgPush("autosave","Queued",{reason:i,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce)))}async _saveLayout(i=!0){let l=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(u=>{let p=parseFloat(u.getAttribute("data-x"))||0,m=parseFloat(u.getAttribute("data-y"))||0,v=parseFloat(u.style.width)||u.getBoundingClientRect().width,y=parseFloat(u.style.height)||u.getBoundingClientRect().height,S=parseInt(u.style.zIndex||"1",10);return{card:this._extractCardConfig(u.firstElementChild),position:{x:p,y:m},size:{width:v,height:y},z:S}}),c={version:2,options:this._exportableOptions(),cards:l};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(c))}catch{}if(!this.storageKey){i||this._toast("Saved locally (no storage_key set).");return}try{await this._saveLayoutToBackend(this.storageKey,c),i||this._toast("Layout saved.")}catch(u){console.error("Backend save failed",u),this._dbgPush("save","Backend save failed",{error:String(u)}),i||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let i=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let a=await this.hass.callApi("get","dragdrop_storage"),l=Math.round(performance.now()-i);this._dbgPush("probe",`OK (${l} ms)`,a),this._backendOK=!!a}catch(a){let l=Math.round(performance.now()-i);this._dbgPush("probe",`FAILED (${l} ms)`,{error:String(a)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(i){let a=`dragdrop_storage/${encodeURIComponent(i)}`,l=performance.now();try{this._dbgPush("load",`GET /api/${a}`);let c=await this.hass.callApi("get",a),u=Math.round(performance.now()-l);return this._dbgPush("load",`OK (${u} ms)`,{bytes:JSON.stringify(c||"").length}),c}catch(c){let u=Math.round(performance.now()-l);return this._dbgPush("load",`FAILED (${u} ms)`,{error:String(c)}),null}}async _saveLayoutToBackend(i,a){let l=`dragdrop_storage/${encodeURIComponent(i)}`,c=JSON.stringify(a).length,u=performance.now();try{this._dbgPush("save",`POST /api/${l}`,{bytes:c});let p=await this.hass.callApi("post",l,a),m=Math.round(performance.now()-u);return this._dbgPush("save",`OK (${m} ms)`,p),p}catch(p){let m=Math.round(performance.now()-u);throw this._dbgPush("save",`FAILED (${m} ms)`,{error:String(p),bytes:c}),p}}_updateStoreBadge(){let i=this.storeBadge;if(!i)return;let a=this._backendOK&&!!this.storageKey;i.textContent=a?"storage: backend":"storage: local",i.style.background=a?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",i.style.borderColor=a?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(i){let a=new Event("hass-notification");a.detail={message:i},window.dispatchEvent(a)}_huiRoot(){var i,a,l,c,u,p;try{let m=document.querySelector("home-assistant"),v=(i=m==null?void 0:m.shadowRoot)==null?void 0:i.querySelector("home-assistant-main"),y=((a=v==null?void 0:v.shadowRoot)==null?void 0:a.querySelector("ha-drawer"))||v,S=((l=y==null?void 0:y.shadowRoot)==null?void 0:l.querySelector("partial-panel-resolver"))||y,_=((c=S==null?void 0:S.shadowRoot)==null?void 0:c.querySelector("ha-panel-lovelace"))||((u=y==null?void 0:y.shadowRoot)==null?void 0:u.querySelector("ha-panel-lovelace"));return((p=_==null?void 0:_.shadowRoot)==null?void 0:p.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",qn);(()=>{try{let e=window.customCards=window.customCards||[];e.some(i=>i.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!0})}catch{}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
