var za=Object.create;var zi=Object.defineProperty;var Pa=Object.getOwnPropertyDescriptor;var Ma=Object.getOwnPropertyNames;var Ia=Object.getPrototypeOf,Da=Object.prototype.hasOwnProperty;var Ra=(e,u,t)=>u in e?zi(e,u,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[u]=t;var Fa=(e,u)=>()=>(u||e((u={exports:{}}).exports,u),u.exports);var Ba=(e,u,t,a)=>{if(u&&typeof u=="object"||typeof u=="function")for(let o of Ma(u))!Da.call(e,o)&&o!==t&&zi(e,o,{get:()=>u[o],enumerable:!(a=Pa(u,o))||a.enumerable});return e};var Na=(e,u,t)=>(t=e!=null?za(Ia(e)):{},Ba(u||!e||!e.__esModule?zi(t,"default",{value:e,enumerable:!0}):t,e));var kn=(e,u,t)=>Ra(e,typeof u!="symbol"?u+"":u,t);var Sn=Fa((Pi,Bt)=>{(function(e,u){typeof Pi=="object"&&typeof Bt!="undefined"?Bt.exports=u():typeof define=="function"&&define.amd?define(u):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=u()})(Pi,(function(){"use strict";function e(n,i){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);i&&(s=s.filter((function(p){return Object.getOwnPropertyDescriptor(n,p).enumerable}))),r.push.apply(r,s)}return r}function u(n){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(s){c(n,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(r,s))}))}return n}function t(n){return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},t(n)}function a(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}function o(n,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,k(s.key),s)}}function l(n,i,r){return i&&o(n.prototype,i),r&&o(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function c(n,i,r){return(i=k(i))in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n}function d(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),i&&v(n,i)}function f(n){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},f(n)}function v(n,i){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},v(n,i)}function m(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _(n){var i=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var r,s=f(n);if(i){var p=f(this).constructor;r=Reflect.construct(s,arguments,p)}else r=s.apply(this,arguments);return(function(h,y){if(y&&(typeof y=="object"||typeof y=="function"))return y;if(y!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m(h)})(this,r)}}function g(){return g=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(n,i,r){var s=(function(h,y){for(;!Object.prototype.hasOwnProperty.call(h,y)&&(h=f(h))!==null;);return h})(n,i);if(s){var p=Object.getOwnPropertyDescriptor(s,i);return p.get?p.get.call(arguments.length<3?n:r):p.value}},g.apply(this,arguments)}function k(n){var i=(function(r,s){if(typeof r!="object"||r===null)return r;var p=r[Symbol.toPrimitive];if(p!==void 0){var h=p.call(r,s||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(r)})(n,"string");return typeof i=="symbol"?i:i+""}var z=function(n){return!(!n||!n.Window)&&n instanceof n.Window},E=void 0,L=void 0;function I(n){E=n;var i=n.document.createTextNode("");i.ownerDocument!==n.document&&typeof n.wrap=="function"&&n.wrap(i)===i&&(n=n.wrap(n)),L=n}function C(n){return z(n)?n:(n.ownerDocument||n).defaultView||L.window}typeof window!="undefined"&&window&&I(window);var A=function(n){return!!n&&t(n)==="object"},O=function(n){return typeof n=="function"},b={window:function(n){return n===L||z(n)},docFrag:function(n){return A(n)&&n.nodeType===11},object:A,func:O,number:function(n){return typeof n=="number"},bool:function(n){return typeof n=="boolean"},string:function(n){return typeof n=="string"},element:function(n){if(!n||t(n)!=="object")return!1;var i=C(n)||L;return/object|function/.test(typeof Element=="undefined"?"undefined":t(Element))?n instanceof Element||n instanceof i.Element:n.nodeType===1&&typeof n.nodeName=="string"},plainObject:function(n){return A(n)&&!!n.constructor&&/function Object\b/.test(n.constructor.toString())},array:function(n){return A(n)&&n.length!==void 0&&O(n.splice)}};function M(n){var i=n.interaction;if(i.prepared.name==="drag"){var r=i.prepared.axis;r==="x"?(i.coords.cur.page.y=i.coords.start.page.y,i.coords.cur.client.y=i.coords.start.client.y,i.coords.velocity.client.y=0,i.coords.velocity.page.y=0):r==="y"&&(i.coords.cur.page.x=i.coords.start.page.x,i.coords.cur.client.x=i.coords.start.client.x,i.coords.velocity.client.x=0,i.coords.velocity.page.x=0)}}function R(n){var i=n.iEvent,r=n.interaction;if(r.prepared.name==="drag"){var s=r.prepared.axis;if(s==="x"||s==="y"){var p=s==="x"?"y":"x";i.page[p]=r.coords.start.page[p],i.client[p]=r.coords.start.client[p],i.delta[p]=0}}}var Z={id:"actions/drag",install:function(n){var i=n.actions,r=n.Interactable,s=n.defaults;r.prototype.draggable=Z.draggable,i.map.drag=Z,i.methodDict.drag="draggable",s.actions.drag=Z.defaults},listeners:{"interactions:before-action-move":M,"interactions:action-resume":M,"interactions:action-move":R,"auto-start:check":function(n){var i=n.interaction,r=n.interactable,s=n.buttons,p=r.options.drag;if(p&&p.enabled&&(!i.pointerIsDown||!/mouse|pointer/.test(i.pointerType)||(s&r.options.drag.mouseButtons)!=0))return n.action={name:"drag",axis:p.lockAxis==="start"?p.startAxis:p.lockAxis},!1}},draggable:function(n){return b.object(n)?(this.options.drag.enabled=n.enabled!==!1,this.setPerAction("drag",n),this.setOnEvents("drag",n),/^(xy|x|y|start)$/.test(n.lockAxis)&&(this.options.drag.lockAxis=n.lockAxis),/^(xy|x|y)$/.test(n.startAxis)&&(this.options.drag.startAxis=n.startAxis),this):b.bool(n)?(this.options.drag.enabled=n,this):this.options.drag},beforeMove:M,move:R,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(n){return n.search("drag")===0}},F=Z,K={init:function(n){var i=n;K.document=i.document,K.DocumentFragment=i.DocumentFragment||ie,K.SVGElement=i.SVGElement||ie,K.SVGSVGElement=i.SVGSVGElement||ie,K.SVGElementInstance=i.SVGElementInstance||ie,K.Element=i.Element||ie,K.HTMLElement=i.HTMLElement||K.Element,K.Event=i.Event,K.Touch=i.Touch||ie,K.PointerEvent=i.PointerEvent||i.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function ie(){}var G=K,ee={init:function(n){var i=G.Element,r=n.navigator||{};ee.supportsTouch="ontouchstart"in n||b.func(n.DocumentTouch)&&G.document instanceof n.DocumentTouch,ee.supportsPointerEvent=r.pointerEnabled!==!1&&!!G.PointerEvent,ee.isIOS=/iP(hone|od|ad)/.test(r.platform),ee.isIOS7=/iP(hone|od|ad)/.test(r.platform)&&/OS 7[^\d]/.test(r.appVersion),ee.isIe9=/MSIE 9/.test(r.userAgent),ee.isOperaMobile=r.appName==="Opera"&&ee.supportsTouch&&/Presto/.test(r.userAgent),ee.prefixedMatchesSelector="matches"in i.prototype?"matches":"webkitMatchesSelector"in i.prototype?"webkitMatchesSelector":"mozMatchesSelector"in i.prototype?"mozMatchesSelector":"oMatchesSelector"in i.prototype?"oMatchesSelector":"msMatchesSelector",ee.pEventTypes=ee.supportsPointerEvent?G.PointerEvent===n.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,ee.wheelEvent=G.document&&"onmousewheel"in G.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},_e=ee;function Te(n,i){if(n.contains)return n.contains(i);for(;i;){if(i===n)return!0;i=i.parentNode}return!1}function et(n,i){for(;b.element(n);){if(je(n,i))return n;n=Ye(n)}return null}function Ye(n){var i=n.parentNode;if(b.docFrag(i)){for(;(i=i.host)&&b.docFrag(i););return i}return i}function je(n,i){return L!==E&&(i=i.replace(/\/deep\//g," ")),n[_e.prefixedMatchesSelector](i)}var Ne=function(n){return n.parentNode||n.host};function Me(n,i){for(var r,s=[],p=n;(r=Ne(p))&&p!==i&&r!==p.ownerDocument;)s.unshift(p),p=r;return s}function nt(n,i,r){for(;b.element(n);){if(je(n,i))return!0;if((n=Ye(n))===r)return je(n,i)}return!1}function tt(n){return n.correspondingUseElement||n}function Ge(n){var i=n instanceof G.SVGElement?n.getBoundingClientRect():n.getClientRects()[0];return i&&{left:i.left,right:i.right,top:i.top,bottom:i.bottom,width:i.width||i.right-i.left,height:i.height||i.bottom-i.top}}function it(n){var i,r=Ge(n);if(!_e.isIOS7&&r){var s={x:(i=(i=C(n))||L).scrollX||i.document.documentElement.scrollLeft,y:i.scrollY||i.document.documentElement.scrollTop};r.left+=s.x,r.right+=s.x,r.top+=s.y,r.bottom+=s.y}return r}function pt(n){for(var i=[];n;)i.push(n),n=Ye(n);return i}function rt(n){return!!b.string(n)&&(G.document.querySelector(n),!0)}function oe(n,i){for(var r in i)n[r]=i[r];return n}function ft(n,i,r){return n==="parent"?Ye(r):n==="self"?i.getRect(r):et(r,n)}function at(n,i,r,s){var p=n;return b.string(p)?p=ft(p,i,r):b.func(p)&&(p=p.apply(void 0,s)),b.element(p)&&(p=it(p)),p}function De(n){return n&&{x:"x"in n?n.x:n.left,y:"y"in n?n.y:n.top}}function re(n){return!n||"x"in n&&"y"in n||((n=oe({},n)).x=n.left||0,n.y=n.top||0,n.width=n.width||(n.right||0)-n.x,n.height=n.height||(n.bottom||0)-n.y),n}function Re(n,i,r){n.left&&(i.left+=r.x),n.right&&(i.right+=r.x),n.top&&(i.top+=r.y),n.bottom&&(i.bottom+=r.y),i.width=i.right-i.left,i.height=i.bottom-i.top}function Ae(n,i,r){var s=r&&n.options[r];return De(at(s&&s.origin||n.options.origin,n,i,[n&&i]))||{x:0,y:0}}function Ce(n,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(w){return!0},s=arguments.length>3?arguments[3]:void 0;if(s=s||{},b.string(n)&&n.search(" ")!==-1&&(n=ct(n)),b.array(n))return n.forEach((function(w){return Ce(w,i,r,s)})),s;if(b.object(n)&&(i=n,n=""),b.func(i)&&r(n))s[n]=s[n]||[],s[n].push(i);else if(b.array(i))for(var p=0,h=i;p<h.length;p++){var y=h[p];Ce(n,y,r,s)}else if(b.object(i))for(var x in i)Ce(ct(x).map((function(w){return"".concat(n).concat(w)})),i[x],r,s);return s}function ct(n){return n.trim().split(/ +/)}var lt=function(n,i){return Math.sqrt(n*n+i*i)},kt=["webkit","moz"];function xt(n,i){n.__set||(n.__set={});var r=function(p){if(kt.some((function(h){return p.indexOf(h)===0})))return 1;typeof n[p]!="function"&&p!=="__set"&&Object.defineProperty(n,p,{get:function(){return p in n.__set?n.__set[p]:n.__set[p]=i[p]},set:function(h){n.__set[p]=h},configurable:!0})};for(var s in i)r(s);return n}function _t(n,i){n.page=n.page||{},n.page.x=i.page.x,n.page.y=i.page.y,n.client=n.client||{},n.client.x=i.client.x,n.client.y=i.client.y,n.timeStamp=i.timeStamp}function Ke(n){n.page.x=0,n.page.y=0,n.client.x=0,n.client.y=0}function Dt(n){return n instanceof G.Event||n instanceof G.Touch}function mt(n,i,r){return n=n||"page",(r=r||{}).x=i[n+"X"],r.y=i[n+"Y"],r}function ot(n,i){return i=i||{x:0,y:0},_e.isOperaMobile&&Dt(n)?(mt("screen",n,i),i.x+=window.scrollX,i.y+=window.scrollY):mt("page",n,i),i}function W(n){return b.number(n.pointerId)?n.pointerId:n.identifier}function ge(n,i,r){var s=i.length>1?ve(i):i[0];ot(s,n.page),(function(p,h){h=h||{},_e.isOperaMobile&&Dt(p)?mt("screen",p,h):mt("client",p,h)})(s,n.client),n.timeStamp=r}function le(n){var i=[];return b.array(n)?(i[0]=n[0],i[1]=n[1]):n.type==="touchend"?n.touches.length===1?(i[0]=n.touches[0],i[1]=n.changedTouches[0]):n.touches.length===0&&(i[0]=n.changedTouches[0],i[1]=n.changedTouches[1]):(i[0]=n.touches[0],i[1]=n.touches[1]),i}function ve(n){for(var i={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},r=0;r<n.length;r++){var s=n[r];for(var p in i)i[p]+=s[p]}for(var h in i)i[h]/=n.length;return i}function X(n){if(!n.length)return null;var i=le(n),r=Math.min(i[0].pageX,i[1].pageX),s=Math.min(i[0].pageY,i[1].pageY),p=Math.max(i[0].pageX,i[1].pageX),h=Math.max(i[0].pageY,i[1].pageY);return{x:r,y:s,left:r,top:s,right:p,bottom:h,width:p-r,height:h-s}}function te(n,i){var r=i+"X",s=i+"Y",p=le(n),h=p[0][r]-p[1][r],y=p[0][s]-p[1][s];return lt(h,y)}function se(n,i){var r=i+"X",s=i+"Y",p=le(n),h=p[1][r]-p[0][r],y=p[1][s]-p[0][s];return 180*Math.atan2(y,h)/Math.PI}function D(n){return b.string(n.pointerType)?n.pointerType:b.number(n.pointerType)?[void 0,void 0,"touch","pen","mouse"][n.pointerType]:/touch/.test(n.type||"")||n instanceof G.Touch?"touch":"mouse"}function B(n){var i=b.func(n.composedPath)?n.composedPath():n.path;return[tt(i?i[0]:n.target),tt(n.currentTarget)]}var ne=(function(){function n(i){a(this,n),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=i}return l(n,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n})();Object.defineProperty(ne.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var ce=function(n,i){for(var r=0;r<i.length;r++){var s=i[r];n.push(s)}return n},de=function(n){return ce([],n)},ye=function(n,i){for(var r=0;r<n.length;r++)if(i(n[r],r,n))return r;return-1},N=function(n,i){return n[ye(n,i)]},J=(function(n){d(r,n);var i=_(r);function r(s,p,h){var y;a(this,r),(y=i.call(this,p._interaction)).dropzone=void 0,y.dragEvent=void 0,y.relatedTarget=void 0,y.draggable=void 0,y.propagationStopped=!1,y.immediatePropagationStopped=!1;var x=h==="dragleave"?s.prev:s.cur,w=x.element,T=x.dropzone;return y.type=h,y.target=w,y.currentTarget=w,y.dropzone=T,y.dragEvent=p,y.relatedTarget=p.target,y.draggable=p.interactable,y.timeStamp=p.timeStamp,y}return l(r,[{key:"reject",value:function(){var s=this,p=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&p.cur.dropzone===this.dropzone&&p.cur.element===this.target)if(p.prev.dropzone=this.dropzone,p.prev.element=this.target,p.rejected=!0,p.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var h=p.activeDrops,y=ye(h,(function(w){var T=w.dropzone,S=w.element;return T===s.dropzone&&S===s.target}));p.activeDrops.splice(y,1);var x=new r(p,this.dragEvent,"dropdeactivate");x.dropzone=this.dropzone,x.target=this.target,this.dropzone.fire(x)}else this.dropzone.fire(new r(p,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),r})(ne);function Oe(n,i){for(var r=0,s=n.slice();r<s.length;r++){var p=s[r],h=p.dropzone,y=p.element;i.dropzone=h,i.target=y,h.fire(i),i.propagationStopped=i.immediatePropagationStopped=!1}}function H(n,i){for(var r=(function(h,y){for(var x=[],w=0,T=h.interactables.list;w<T.length;w++){var S=T[w];if(S.options.drop.enabled){var P=S.options.drop.accept;if(!(b.element(P)&&P!==y||b.string(P)&&!je(y,P)||b.func(P)&&!P({dropzone:S,draggableElement:y})))for(var q=0,Y=S.getAllElements();q<Y.length;q++){var $=Y[q];$!==y&&x.push({dropzone:S,element:$,rect:S.getRect($)})}}}return x})(n,i),s=0;s<r.length;s++){var p=r[s];p.rect=p.dropzone.getRect(p.element)}return r}function Le(n,i,r){for(var s=n.dropState,p=n.interactable,h=n.element,y=[],x=0,w=s.activeDrops;x<w.length;x++){var T=w[x],S=T.dropzone,P=T.element,q=T.rect,Y=S.dropCheck(i,r,p,h,P,q);y.push(Y?P:null)}var $=(function(Q){for(var he,ue,be,Pe=[],qe=0;qe<Q.length;qe++){var Se=Q[qe],Ie=Q[he];if(Se&&qe!==he)if(Ie){var vt=Ne(Se),Ze=Ne(Ie);if(vt!==Se.ownerDocument)if(Ze!==Se.ownerDocument)if(vt!==Ze){Pe=Pe.length?Pe:Me(Ie);var St=void 0;if(Ie instanceof G.HTMLElement&&Se instanceof G.SVGElement&&!(Se instanceof G.SVGSVGElement)){if(Se===Ze)continue;St=Se.ownerSVGElement}else St=Se;for(var Ct=Me(St,Ie.ownerDocument),Tt=0;Ct[Tt]&&Ct[Tt]===Pe[Tt];)Tt++;var ui=[Ct[Tt-1],Ct[Tt],Pe[Tt]];if(ui[0])for(var Jt=ui[0].lastChild;Jt;){if(Jt===ui[1]){he=qe,Pe=Ct;break}if(Jt===ui[2])break;Jt=Jt.previousSibling}}else be=Ie,(parseInt(C(ue=Se).getComputedStyle(ue).zIndex,10)||0)>=(parseInt(C(be).getComputedStyle(be).zIndex,10)||0)&&(he=qe);else he=qe}else he=qe}return he})(y);return s.activeDrops[$]||null}function Be(n,i,r){var s=n.dropState,p={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return r.type==="dragstart"&&(p.activate=new J(s,r,"dropactivate"),p.activate.target=null,p.activate.dropzone=null),r.type==="dragend"&&(p.deactivate=new J(s,r,"dropdeactivate"),p.deactivate.target=null,p.deactivate.dropzone=null),s.rejected||(s.cur.element!==s.prev.element&&(s.prev.dropzone&&(p.leave=new J(s,r,"dragleave"),r.dragLeave=p.leave.target=s.prev.element,r.prevDropzone=p.leave.dropzone=s.prev.dropzone),s.cur.dropzone&&(p.enter=new J(s,r,"dragenter"),r.dragEnter=s.cur.element,r.dropzone=s.cur.dropzone)),r.type==="dragend"&&s.cur.dropzone&&(p.drop=new J(s,r,"drop"),r.dropzone=s.cur.dropzone,r.relatedTarget=s.cur.element),r.type==="dragmove"&&s.cur.dropzone&&(p.move=new J(s,r,"dropmove"),r.dropzone=s.cur.dropzone)),p}function Ve(n,i){var r=n.dropState,s=r.activeDrops,p=r.cur,h=r.prev;i.leave&&h.dropzone.fire(i.leave),i.enter&&p.dropzone.fire(i.enter),i.move&&p.dropzone.fire(i.move),i.drop&&p.dropzone.fire(i.drop),i.deactivate&&Oe(s,i.deactivate),r.prev.dropzone=p.dropzone,r.prev.element=p.element}function Fe(n,i){var r=n.interaction,s=n.iEvent,p=n.event;if(s.type==="dragmove"||s.type==="dragend"){var h=r.dropState;i.dynamicDrop&&(h.activeDrops=H(i,r.element));var y=s,x=Le(r,y,p);h.rejected=h.rejected&&!!x&&x.dropzone===h.cur.dropzone&&x.element===h.cur.element,h.cur.dropzone=x&&x.dropzone,h.cur.element=x&&x.element,h.events=Be(r,0,y)}}var Qe={id:"actions/drop",install:function(n){var i=n.actions,r=n.interactStatic,s=n.Interactable,p=n.defaults;n.usePlugin(F),s.prototype.dropzone=function(h){return(function(y,x){if(b.object(x)){if(y.options.drop.enabled=x.enabled!==!1,x.listeners){var w=Ce(x.listeners),T=Object.keys(w).reduce((function(P,q){return P[/^(enter|leave)/.test(q)?"drag".concat(q):/^(activate|deactivate|move)/.test(q)?"drop".concat(q):q]=w[q],P}),{}),S=y.options.drop.listeners;S&&y.off(S),y.on(T),y.options.drop.listeners=T}return b.func(x.ondrop)&&y.on("drop",x.ondrop),b.func(x.ondropactivate)&&y.on("dropactivate",x.ondropactivate),b.func(x.ondropdeactivate)&&y.on("dropdeactivate",x.ondropdeactivate),b.func(x.ondragenter)&&y.on("dragenter",x.ondragenter),b.func(x.ondragleave)&&y.on("dragleave",x.ondragleave),b.func(x.ondropmove)&&y.on("dropmove",x.ondropmove),/^(pointer|center)$/.test(x.overlap)?y.options.drop.overlap=x.overlap:b.number(x.overlap)&&(y.options.drop.overlap=Math.max(Math.min(1,x.overlap),0)),"accept"in x&&(y.options.drop.accept=x.accept),"checker"in x&&(y.options.drop.checker=x.checker),y}return b.bool(x)?(y.options.drop.enabled=x,y):y.options.drop})(this,h)},s.prototype.dropCheck=function(h,y,x,w,T,S){return(function(P,q,Y,$,Q,he,ue){var be=!1;if(!(ue=ue||P.getRect(he)))return!!P.options.drop.checker&&P.options.drop.checker(q,Y,be,P,he,$,Q);var Pe=P.options.drop.overlap;if(Pe==="pointer"){var qe=Ae($,Q,"drag"),Se=ot(q);Se.x+=qe.x,Se.y+=qe.y;var Ie=Se.x>ue.left&&Se.x<ue.right,vt=Se.y>ue.top&&Se.y<ue.bottom;be=Ie&&vt}var Ze=$.getRect(Q);if(Ze&&Pe==="center"){var St=Ze.left+Ze.width/2,Ct=Ze.top+Ze.height/2;be=St>=ue.left&&St<=ue.right&&Ct>=ue.top&&Ct<=ue.bottom}return Ze&&b.number(Pe)&&(be=Math.max(0,Math.min(ue.right,Ze.right)-Math.max(ue.left,Ze.left))*Math.max(0,Math.min(ue.bottom,Ze.bottom)-Math.max(ue.top,Ze.top))/(Ze.width*Ze.height)>=Pe),P.options.drop.checker&&(be=P.options.drop.checker(q,Y,be,P,he,$,Q)),be})(this,h,y,x,w,T,S)},r.dynamicDrop=function(h){return b.bool(h)?(n.dynamicDrop=h,r):n.dynamicDrop},oe(i.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),i.methodDict.drop="dropzone",n.dynamicDrop=!1,p.actions.drop=Qe.defaults},listeners:{"interactions:before-action-start":function(n){var i=n.interaction;i.prepared.name==="drag"&&(i.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(n,i){var r=n.interaction,s=(n.event,n.iEvent);if(r.prepared.name==="drag"){var p=r.dropState;p.activeDrops=[],p.events={},p.activeDrops=H(i,r.element),p.events=Be(r,0,s),p.events.activate&&(Oe(p.activeDrops,p.events.activate),i.fire("actions/drop:start",{interaction:r,dragEvent:s}))}},"interactions:action-move":Fe,"interactions:after-action-move":function(n,i){var r=n.interaction,s=n.iEvent;if(r.prepared.name==="drag"){var p=r.dropState;Ve(r,p.events),i.fire("actions/drop:move",{interaction:r,dragEvent:s}),p.events={}}},"interactions:action-end":function(n,i){if(n.interaction.prepared.name==="drag"){var r=n.interaction,s=n.iEvent;Fe(n,i),Ve(r,r.dropState.events),i.fire("actions/drop:end",{interaction:r,dragEvent:s})}},"interactions:stop":function(n){var i=n.interaction;if(i.prepared.name==="drag"){var r=i.dropState;r&&(r.activeDrops=null,r.events=null,r.cur.dropzone=null,r.cur.element=null,r.prev.dropzone=null,r.prev.element=null,r.rejected=!1)}}},getActiveDrops:H,getDrop:Le,getDropEvents:Be,fireDropEvents:Ve,filterEventType:function(n){return n.search("drag")===0||n.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},Xe=Qe;function Je(n){var i=n.interaction,r=n.iEvent,s=n.phase;if(i.prepared.name==="gesture"){var p=i.pointers.map((function(T){return T.pointer})),h=s==="start",y=s==="end",x=i.interactable.options.deltaSource;if(r.touches=[p[0],p[1]],h)r.distance=te(p,x),r.box=X(p),r.scale=1,r.ds=0,r.angle=se(p,x),r.da=0,i.gesture.startDistance=r.distance,i.gesture.startAngle=r.angle;else if(y||i.pointers.length<2){var w=i.prevEvent;r.distance=w.distance,r.box=w.box,r.scale=w.scale,r.ds=0,r.angle=w.angle,r.da=0}else r.distance=te(p,x),r.box=X(p),r.scale=r.distance/i.gesture.startDistance,r.angle=se(p,x),r.ds=r.scale-i.gesture.scale,r.da=r.angle-i.gesture.angle;i.gesture.distance=r.distance,i.gesture.angle=r.angle,b.number(r.scale)&&r.scale!==1/0&&!isNaN(r.scale)&&(i.gesture.scale=r.scale)}}var $e={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(n){var i=n.actions,r=n.Interactable,s=n.defaults;r.prototype.gesturable=function(p){return b.object(p)?(this.options.gesture.enabled=p.enabled!==!1,this.setPerAction("gesture",p),this.setOnEvents("gesture",p),this):b.bool(p)?(this.options.gesture.enabled=p,this):this.options.gesture},i.map.gesture=$e,i.methodDict.gesture="gesturable",s.actions.gesture=$e.defaults},listeners:{"interactions:action-start":Je,"interactions:action-move":Je,"interactions:action-end":Je,"interactions:new":function(n){n.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(n){if(!(n.interaction.pointers.length<2)){var i=n.interactable.options.gesture;if(i&&i.enabled)return n.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(n){return n.search("gesture")===0}},We=$e;function Ee(n,i,r,s,p,h,y){if(!i)return!1;if(i===!0){var x=b.number(h.width)?h.width:h.right-h.left,w=b.number(h.height)?h.height:h.bottom-h.top;if(y=Math.min(y,Math.abs((n==="left"||n==="right"?x:w)/2)),x<0&&(n==="left"?n="right":n==="right"&&(n="left")),w<0&&(n==="top"?n="bottom":n==="bottom"&&(n="top")),n==="left"){var T=x>=0?h.left:h.right;return r.x<T+y}if(n==="top"){var S=w>=0?h.top:h.bottom;return r.y<S+y}if(n==="right")return r.x>(x>=0?h.right:h.left)-y;if(n==="bottom")return r.y>(w>=0?h.bottom:h.top)-y}return!!b.element(s)&&(b.element(i)?i===s:nt(s,i,p))}function fe(n){var i=n.iEvent,r=n.interaction;if(r.prepared.name==="resize"&&r.resizeAxes){var s=i;r.interactable.options.resize.square?(r.resizeAxes==="y"?s.delta.x=s.delta.y:s.delta.y=s.delta.x,s.axes="xy"):(s.axes=r.resizeAxes,r.resizeAxes==="x"?s.delta.y=0:r.resizeAxes==="y"&&(s.delta.x=0))}}var we,ze,ke={id:"actions/resize",before:["actions/drag"],install:function(n){var i=n.actions,r=n.browser,s=n.Interactable,p=n.defaults;ke.cursors=(function(h){return h.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(r),ke.defaultMargin=r.supportsTouch||r.supportsPointerEvent?20:10,s.prototype.resizable=function(h){return(function(y,x,w){return b.object(x)?(y.options.resize.enabled=x.enabled!==!1,y.setPerAction("resize",x),y.setOnEvents("resize",x),b.string(x.axis)&&/^x$|^y$|^xy$/.test(x.axis)?y.options.resize.axis=x.axis:x.axis===null&&(y.options.resize.axis=w.defaults.actions.resize.axis),b.bool(x.preserveAspectRatio)?y.options.resize.preserveAspectRatio=x.preserveAspectRatio:b.bool(x.square)&&(y.options.resize.square=x.square),y):b.bool(x)?(y.options.resize.enabled=x,y):y.options.resize})(this,h,n)},i.map.resize=ke,i.methodDict.resize="resizable",p.actions.resize=ke.defaults},listeners:{"interactions:new":function(n){n.interaction.resizeAxes="xy"},"interactions:action-start":function(n){(function(i){var r=i.iEvent,s=i.interaction;if(s.prepared.name==="resize"&&s.prepared.edges){var p=r,h=s.rect;s._rects={start:oe({},h),corrected:oe({},h),previous:oe({},h),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},p.edges=s.prepared.edges,p.rect=s._rects.corrected,p.deltaRect=s._rects.delta}})(n),fe(n)},"interactions:action-move":function(n){(function(i){var r=i.iEvent,s=i.interaction;if(s.prepared.name==="resize"&&s.prepared.edges){var p=r,h=s.interactable.options.resize.invert,y=h==="reposition"||h==="negate",x=s.rect,w=s._rects,T=w.start,S=w.corrected,P=w.delta,q=w.previous;if(oe(q,S),y){if(oe(S,x),h==="reposition"){if(S.top>S.bottom){var Y=S.top;S.top=S.bottom,S.bottom=Y}if(S.left>S.right){var $=S.left;S.left=S.right,S.right=$}}}else S.top=Math.min(x.top,T.bottom),S.bottom=Math.max(x.bottom,T.top),S.left=Math.min(x.left,T.right),S.right=Math.max(x.right,T.left);for(var Q in S.width=S.right-S.left,S.height=S.bottom-S.top,S)P[Q]=S[Q]-q[Q];p.edges=s.prepared.edges,p.rect=S,p.deltaRect=P}})(n),fe(n)},"interactions:action-end":function(n){var i=n.iEvent,r=n.interaction;if(r.prepared.name==="resize"&&r.prepared.edges){var s=i;s.edges=r.prepared.edges,s.rect=r._rects.corrected,s.deltaRect=r._rects.delta}},"auto-start:check":function(n){var i=n.interaction,r=n.interactable,s=n.element,p=n.rect,h=n.buttons;if(p){var y=oe({},i.coords.cur.page),x=r.options.resize;if(x&&x.enabled&&(!i.pointerIsDown||!/mouse|pointer/.test(i.pointerType)||(h&x.mouseButtons)!=0)){if(b.object(x.edges)){var w={left:!1,right:!1,top:!1,bottom:!1};for(var T in w)w[T]=Ee(T,x.edges[T],y,i._latestPointer.eventTarget,s,p,x.margin||ke.defaultMargin);w.left=w.left&&!w.right,w.top=w.top&&!w.bottom,(w.left||w.right||w.top||w.bottom)&&(n.action={name:"resize",edges:w})}else{var S=x.axis!=="y"&&y.x>p.right-ke.defaultMargin,P=x.axis!=="x"&&y.y>p.bottom-ke.defaultMargin;(S||P)&&(n.action={name:"resize",axes:(S?"x":"")+(P?"y":"")})}return!n.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(n){var i=n.edges,r=n.axis,s=n.name,p=ke.cursors,h=null;if(r)h=p[s+r];else if(i){for(var y="",x=0,w=["top","bottom","left","right"];x<w.length;x++){var T=w[x];i[T]&&(y+=T)}h=p[y]}return h},filterEventType:function(n){return n.search("resize")===0},defaultMargin:null},pe=ke,ae={id:"actions",install:function(n){n.usePlugin(We),n.usePlugin(pe),n.usePlugin(F),n.usePlugin(Xe)}},V=0,U={request:function(n){return we(n)},cancel:function(n){return ze(n)},init:function(n){if(we=n.requestAnimationFrame,ze=n.cancelAnimationFrame,!we)for(var i=["ms","moz","webkit","o"],r=0;r<i.length;r++){var s=i[r];we=n["".concat(s,"RequestAnimationFrame")],ze=n["".concat(s,"CancelAnimationFrame")]||n["".concat(s,"CancelRequestAnimationFrame")]}we=we&&we.bind(n),ze=ze&&ze.bind(n),we||(we=function(p){var h=Date.now(),y=Math.max(0,16-(h-V)),x=n.setTimeout((function(){p(h+y)}),y);return V=h+y,x},ze=function(p){return clearTimeout(p)})}},j={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(n){j.isScrolling=!0,U.cancel(j.i),n.autoScroll=j,j.interaction=n,j.prevTime=j.now(),j.i=U.request(j.scroll)},stop:function(){j.isScrolling=!1,j.interaction&&(j.interaction.autoScroll=null),U.cancel(j.i)},scroll:function(){var n=j.interaction,i=n.interactable,r=n.element,s=n.prepared.name,p=i.options[s].autoScroll,h=me(p.container,i,r),y=j.now(),x=(y-j.prevTime)/1e3,w=p.speed*x;if(w>=1){var T={x:j.x*w,y:j.y*w};if(T.x||T.y){var S=Ue(h);b.window(h)?h.scrollBy(T.x,T.y):h&&(h.scrollLeft+=T.x,h.scrollTop+=T.y);var P=Ue(h),q={x:P.x-S.x,y:P.y-S.y};(q.x||q.y)&&i.fire({type:"autoscroll",target:r,interactable:i,delta:q,interaction:n,container:h})}j.prevTime=y}j.isScrolling&&(U.cancel(j.i),j.i=U.request(j.scroll))},check:function(n,i){var r;return(r=n.options[i].autoScroll)==null?void 0:r.enabled},onInteractionMove:function(n){var i=n.interaction,r=n.pointer;if(i.interacting()&&j.check(i.interactable,i.prepared.name))if(i.simulation)j.x=j.y=0;else{var s,p,h,y,x=i.interactable,w=i.element,T=i.prepared.name,S=x.options[T].autoScroll,P=me(S.container,x,w);if(b.window(P))y=r.clientX<j.margin,s=r.clientY<j.margin,p=r.clientX>P.innerWidth-j.margin,h=r.clientY>P.innerHeight-j.margin;else{var q=Ge(P);y=r.clientX<q.left+j.margin,s=r.clientY<q.top+j.margin,p=r.clientX>q.right-j.margin,h=r.clientY>q.bottom-j.margin}j.x=p?1:y?-1:0,j.y=h?1:s?-1:0,j.isScrolling||(j.margin=S.margin,j.speed=S.speed,j.start(i))}}};function me(n,i,r){return(b.string(n)?ft(n,i,r):n)||C(r)}function Ue(n){return b.window(n)&&(n=window.document.body),{x:n.scrollLeft,y:n.scrollTop}}var He={id:"auto-scroll",install:function(n){var i=n.defaults,r=n.actions;n.autoScroll=j,j.now=function(){return n.now()},r.phaselessTypes.autoscroll=!0,i.perAction.autoScroll=j.defaults},listeners:{"interactions:new":function(n){n.interaction.autoScroll=null},"interactions:destroy":function(n){n.interaction.autoScroll=null,j.stop(),j.interaction&&(j.interaction=null)},"interactions:stop":j.stop,"interactions:action-move":function(n){return j.onInteractionMove(n)}}},ut=He;function Et(n,i){var r=!1;return function(){return r||(L.console.warn(i),r=!0),n.apply(this,arguments)}}function Ht(n,i){return n.name=i.name,n.axis=i.axis,n.edges=i.edges,n}function Rt(n){return b.bool(n)?(this.options.styleCursor=n,this):n===null?(delete this.options.styleCursor,this):this.options.styleCursor}function ni(n){return b.func(n)?(this.options.actionChecker=n,this):n===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Or={id:"auto-start/interactableMethods",install:function(n){var i=n.Interactable;i.prototype.getAction=function(r,s,p,h){var y=(function(x,w,T,S,P){var q=x.getRect(S),Y=w.buttons||{0:1,1:4,3:8,4:16}[w.button],$={action:null,interactable:x,interaction:T,element:S,rect:q,buttons:Y};return P.fire("auto-start:check",$),$.action})(this,s,p,h,n);return this.options.actionChecker?this.options.actionChecker(r,s,y,this,h,p):y},i.prototype.ignoreFrom=Et((function(r){return this._backCompatOption("ignoreFrom",r)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),i.prototype.allowFrom=Et((function(r){return this._backCompatOption("allowFrom",r)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),i.prototype.actionChecker=ni,i.prototype.styleCursor=Rt}};function Gi(n,i,r,s,p){return i.testIgnoreAllow(i.options[n.name],r,s)&&i.options[n.name].enabled&&ri(i,r,n,p)?n:null}function Lr(n,i,r,s,p,h,y){for(var x=0,w=s.length;x<w;x++){var T=s[x],S=p[x],P=T.getAction(i,r,n,S);if(P){var q=Gi(P,T,S,h,y);if(q)return{action:q,interactable:T,element:S}}}return{action:null,interactable:null,element:null}}function Xi(n,i,r,s,p){var h=[],y=[],x=s;function w(S){h.push(S),y.push(x)}for(;b.element(x);){h=[],y=[],p.interactables.forEachMatch(x,w);var T=Lr(n,i,r,h,y,s,p);if(T.action&&!T.interactable.options[T.action.name].manualStart)return T;x=Ye(x)}return{action:null,interactable:null,element:null}}function Ji(n,i,r){var s=i.action,p=i.interactable,h=i.element;s=s||{name:null},n.interactable=p,n.element=h,Ht(n.prepared,s),n.rect=p&&s.name?p.getRect(h):null,Zi(n,r),r.fire("autoStart:prepared",{interaction:n})}function ri(n,i,r,s){var p=n.options,h=p[r.name].max,y=p[r.name].maxPerElement,x=s.autoStart.maxInteractions,w=0,T=0,S=0;if(!(h&&y&&x))return!1;for(var P=0,q=s.interactions.list;P<q.length;P++){var Y=q[P],$=Y.prepared.name;if(Y.interacting()&&(++w>=x||Y.interactable===n&&((T+=$===r.name?1:0)>=h||Y.element===i&&(S++,$===r.name&&S>=y))))return!1}return x>0}function Qi(n,i){return b.number(n)?(i.autoStart.maxInteractions=n,this):i.autoStart.maxInteractions}function bi(n,i,r){var s=r.autoStart.cursorElement;s&&s!==n&&(s.style.cursor=""),n.ownerDocument.documentElement.style.cursor=i,n.style.cursor=i,r.autoStart.cursorElement=i?n:null}function Zi(n,i){var r=n.interactable,s=n.element,p=n.prepared;if(n.pointerType==="mouse"&&r&&r.options.styleCursor){var h="";if(p.name){var y=r.options[p.name].cursorChecker;h=b.func(y)?y(p,r,s,n._interacting):i.actions.map[p.name].getCursor(p)}bi(n.element,h||"",i)}else i.autoStart.cursorElement&&bi(i.autoStart.cursorElement,"",i)}var zr={id:"auto-start/base",before:["actions"],install:function(n){var i=n.interactStatic,r=n.defaults;n.usePlugin(Or),r.base.actionChecker=null,r.base.styleCursor=!0,oe(r.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),i.maxInteractions=function(s){return Qi(s,n)},n.autoStart={maxInteractions:1/0,withinInteractionLimit:ri,cursorElement:null}},listeners:{"interactions:down":function(n,i){var r=n.interaction,s=n.pointer,p=n.event,h=n.eventTarget;r.interacting()||Ji(r,Xi(r,s,p,h,i),i)},"interactions:move":function(n,i){(function(r,s){var p=r.interaction,h=r.pointer,y=r.event,x=r.eventTarget;p.pointerType!=="mouse"||p.pointerIsDown||p.interacting()||Ji(p,Xi(p,h,y,x,s),s)})(n,i),(function(r,s){var p=r.interaction;if(p.pointerIsDown&&!p.interacting()&&p.pointerWasMoved&&p.prepared.name){s.fire("autoStart:before-start",r);var h=p.interactable,y=p.prepared.name;y&&h&&(h.options[y].manualStart||!ri(h,p.element,p.prepared,s)?p.stop():(p.start(p.prepared,h,p.element),Zi(p,s)))}})(n,i)},"interactions:stop":function(n,i){var r=n.interaction,s=r.interactable;s&&s.options.styleCursor&&bi(r.element,"",i)}},maxInteractions:Qi,withinInteractionLimit:ri,validateAction:Gi},xi=zr,Pr={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(n,i){var r=n.interaction,s=n.eventTarget,p=n.dx,h=n.dy;if(r.prepared.name==="drag"){var y=Math.abs(p),x=Math.abs(h),w=r.interactable.options.drag,T=w.startAxis,S=y>x?"x":y<x?"y":"xy";if(r.prepared.axis=w.lockAxis==="start"?S[0]:w.lockAxis,S!=="xy"&&T!=="xy"&&T!==S){r.prepared.name=null;for(var P=s,q=function($){if($!==r.interactable){var Q=r.interactable.options.drag;if(!Q.manualStart&&$.testIgnoreAllow(Q,P,s)){var he=$.getAction(r.downPointer,r.downEvent,r,P);if(he&&he.name==="drag"&&(function(ue,be){if(!be)return!1;var Pe=be.options.drag.startAxis;return ue==="xy"||Pe==="xy"||Pe===ue})(S,$)&&xi.validateAction(he,$,P,s,i))return $}}};b.element(P);){var Y=i.interactables.forEachMatch(P,q);if(Y){r.prepared.name="drag",r.interactable=Y,r.element=P;break}P=Ye(P)}}}}}};function _i(n){var i=n.prepared&&n.prepared.name;if(!i)return null;var r=n.interactable.options;return r[i].hold||r[i].delay}var Mr={id:"auto-start/hold",install:function(n){var i=n.defaults;n.usePlugin(xi),i.perAction.hold=0,i.perAction.delay=0},listeners:{"interactions:new":function(n){n.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(n){var i=n.interaction,r=_i(i);r>0&&(i.autoStartHoldTimer=setTimeout((function(){i.start(i.prepared,i.interactable,i.element)}),r))},"interactions:move":function(n){var i=n.interaction,r=n.duplicate;i.autoStartHoldTimer&&i.pointerWasMoved&&!r&&(clearTimeout(i.autoStartHoldTimer),i.autoStartHoldTimer=null)},"autoStart:before-start":function(n){var i=n.interaction;_i(i)>0&&(i.prepared.name=null)}},getHoldDuration:_i},Ir=Mr,Dr={id:"auto-start",install:function(n){n.usePlugin(xi),n.usePlugin(Ir),n.usePlugin(Pr)}},Rr=function(n){return/^(always|never|auto)$/.test(n)?(this.options.preventDefault=n,this):b.bool(n)?(this.options.preventDefault=n?"always":"never",this):this.options.preventDefault};function Fr(n){var i=n.interaction,r=n.event;i.interactable&&i.interactable.checkAndPreventDefault(r)}var en={id:"core/interactablePreventDefault",install:function(n){var i=n.Interactable;i.prototype.preventDefault=Rr,i.prototype.checkAndPreventDefault=function(r){return(function(s,p,h){var y=s.options.preventDefault;if(y!=="never")if(y!=="always"){if(p.events.supportsPassive&&/^touch(start|move)$/.test(h.type)){var x=C(h.target).document,w=p.getDocOptions(x);if(!w||!w.events||w.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(h.type)||b.element(h.target)&&je(h.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||h.preventDefault()}else h.preventDefault()})(this,n,r)},n.interactions.docEvents.push({type:"dragstart",listener:function(r){for(var s=0,p=n.interactions.list;s<p.length;s++){var h=p[s];if(h.element&&(h.element===r.target||Te(h.element,r.target)))return void h.interactable.checkAndPreventDefault(r)}}})},listeners:["down","move","up","cancel"].reduce((function(n,i){return n["interactions:".concat(i)]=Fr,n}),{})};function ai(n,i){if(i.phaselessTypes[n])return!0;for(var r in i.map)if(n.indexOf(r)===0&&n.substr(r.length)in i.phases)return!0;return!1}function jt(n){var i={};for(var r in n){var s=n[r];b.plainObject(s)?i[r]=jt(s):b.array(s)?i[r]=de(s):i[r]=s}return i}var wi=(function(){function n(i){a(this,n),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=i,this.result=oi(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return l(n,[{key:"start",value:function(i,r){var s,p,h=i.phase,y=this.interaction,x=(function(T){var S=T.interactable.options[T.prepared.name],P=S.modifiers;return P&&P.length?P:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(q){var Y=S[q];return Y&&Y.enabled&&{options:Y,methods:Y._methods}})).filter((function(q){return!!q}))})(y);this.prepareStates(x),this.startEdges=oe({},y.edges),this.edges=oe({},this.startEdges),this.startOffset=(s=y.rect,p=r,s?{left:p.x-s.left,top:p.y-s.top,right:s.right-p.x,bottom:s.bottom-p.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var w=this.fillArg({phase:h,pageCoords:r,preEnd:!1});return this.result=oi(),this.startAll(w),this.result=this.setAll(w)}},{key:"fillArg",value:function(i){var r=this.interaction;return i.interaction=r,i.interactable=r.interactable,i.element=r.element,i.rect||(i.rect=r.rect),i.edges||(i.edges=this.startEdges),i.startOffset=this.startOffset,i}},{key:"startAll",value:function(i){for(var r=0,s=this.states;r<s.length;r++){var p=s[r];p.methods.start&&(i.state=p,p.methods.start(i))}}},{key:"setAll",value:function(i){var r=i.phase,s=i.preEnd,p=i.skipModifiers,h=i.rect,y=i.edges;i.coords=oe({},i.pageCoords),i.rect=oe({},h),i.edges=oe({},y);for(var x=p?this.states.slice(p):this.states,w=oi(i.coords,i.rect),T=0;T<x.length;T++){var S,P=x[T],q=P.options,Y=oe({},i.coords),$=null;(S=P.methods)!=null&&S.set&&this.shouldDo(q,s,r)&&(i.state=P,$=P.methods.set(i),Re(i.edges,i.rect,{x:i.coords.x-Y.x,y:i.coords.y-Y.y})),w.eventProps.push($)}oe(this.edges,i.edges),w.delta.x=i.coords.x-i.pageCoords.x,w.delta.y=i.coords.y-i.pageCoords.y,w.rectDelta.left=i.rect.left-h.left,w.rectDelta.right=i.rect.right-h.right,w.rectDelta.top=i.rect.top-h.top,w.rectDelta.bottom=i.rect.bottom-h.bottom;var Q=this.result.coords,he=this.result.rect;if(Q&&he){var ue=w.rect.left!==he.left||w.rect.right!==he.right||w.rect.top!==he.top||w.rect.bottom!==he.bottom;w.changed=ue||Q.x!==w.coords.x||Q.y!==w.coords.y}return w}},{key:"applyToInteraction",value:function(i){var r=this.interaction,s=i.phase,p=r.coords.cur,h=r.coords.start,y=this.result,x=this.startDelta,w=y.delta;s==="start"&&oe(this.startDelta,y.delta);for(var T=0,S=[[h,x],[p,w]];T<S.length;T++){var P=S[T],q=P[0],Y=P[1];q.page.x+=Y.x,q.page.y+=Y.y,q.client.x+=Y.x,q.client.y+=Y.y}var $=this.result.rectDelta,Q=i.rect||r.rect;Q.left+=$.left,Q.right+=$.right,Q.top+=$.top,Q.bottom+=$.bottom,Q.width=Q.right-Q.left,Q.height=Q.bottom-Q.top}},{key:"setAndApply",value:function(i){var r=this.interaction,s=i.phase,p=i.preEnd,h=i.skipModifiers,y=this.setAll(this.fillArg({preEnd:p,phase:s,pageCoords:i.modifiedCoords||r.coords.cur.page}));if(this.result=y,!y.changed&&(!h||h<this.states.length)&&r.interacting())return!1;if(i.modifiedCoords){var x=r.coords.cur.page,w={x:i.modifiedCoords.x-x.x,y:i.modifiedCoords.y-x.y};y.coords.x+=w.x,y.coords.y+=w.y,y.delta.x+=w.x,y.delta.y+=w.y}this.applyToInteraction(i)}},{key:"beforeEnd",value:function(i){var r=i.interaction,s=i.event,p=this.states;if(p&&p.length){for(var h=!1,y=0;y<p.length;y++){var x=p[y];i.state=x;var w=x.options,T=x.methods,S=T.beforeEnd&&T.beforeEnd(i);if(S)return this.endResult=S,!1;h=h||!h&&this.shouldDo(w,!0,i.phase,!0)}h&&r.move({event:s,preEnd:!0})}}},{key:"stop",value:function(i){var r=i.interaction;if(this.states&&this.states.length){var s=oe({states:this.states,interactable:r.interactable,element:r.element,rect:null},i);this.fillArg(s);for(var p=0,h=this.states;p<h.length;p++){var y=h[p];s.state=y,y.methods.stop&&y.methods.stop(s)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(i){this.states=[];for(var r=0;r<i.length;r++){var s=i[r],p=s.options,h=s.methods,y=s.name;this.states.push({options:p,methods:h,index:r,name:y})}return this.states}},{key:"restoreInteractionCoords",value:function(i){var r=i.interaction,s=r.coords,p=r.rect,h=r.modification;if(h.result){for(var y=h.startDelta,x=h.result,w=x.delta,T=x.rectDelta,S=0,P=[[s.start,y],[s.cur,w]];S<P.length;S++){var q=P[S],Y=q[0],$=q[1];Y.page.x-=$.x,Y.page.y-=$.y,Y.client.x-=$.x,Y.client.y-=$.y}p.left-=T.left,p.right-=T.right,p.top-=T.top,p.bottom-=T.bottom}}},{key:"shouldDo",value:function(i,r,s,p){return!(!i||i.enabled===!1||p&&!i.endOnly||i.endOnly&&!r||s==="start"&&!i.setStart)}},{key:"copyFrom",value:function(i){this.startOffset=i.startOffset,this.startDelta=i.startDelta,this.startEdges=i.startEdges,this.edges=i.edges,this.states=i.states.map((function(r){return jt(r)})),this.result=oi(oe({},i.result.coords),oe({},i.result.rect))}},{key:"destroy",value:function(){for(var i in this)this[i]=null}}]),n})();function oi(n,i){return{rect:i,coords:n,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function Lt(n,i){var r=n.defaults,s={start:n.start,set:n.set,beforeEnd:n.beforeEnd,stop:n.stop},p=function(h){var y=h||{};for(var x in y.enabled=y.enabled!==!1,r)x in y||(y[x]=r[x]);var w={options:y,methods:s,name:i,enable:function(){return y.enabled=!0,w},disable:function(){return y.enabled=!1,w}};return w};return i&&typeof i=="string"&&(p._defaults=r,p._methods=s),p}function Ut(n){var i=n.iEvent,r=n.interaction.modification.result;r&&(i.modifiers=r.eventProps)}var Br={id:"modifiers/base",before:["actions"],install:function(n){n.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(n){var i=n.interaction;i.modification=new wi(i)},"interactions:before-action-start":function(n){var i=n.interaction,r=n.interaction.modification;r.start(n,i.coords.start.page),i.edges=r.edges,r.applyToInteraction(n)},"interactions:before-action-move":function(n){var i=n.interaction,r=i.modification,s=r.setAndApply(n);return i.edges=r.edges,s},"interactions:before-action-end":function(n){var i=n.interaction,r=i.modification,s=r.beforeEnd(n);return i.edges=r.startEdges,s},"interactions:action-start":Ut,"interactions:action-move":Ut,"interactions:action-end":Ut,"interactions:after-action-start":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-move":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:stop":function(n){return n.interaction.modification.stop(n)}}},tn=Br,nn={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},ki=(function(n){d(r,n);var i=_(r);function r(s,p,h,y,x,w,T){var S;a(this,r),(S=i.call(this,s)).relatedTarget=null,S.screenX=void 0,S.screenY=void 0,S.button=void 0,S.buttons=void 0,S.ctrlKey=void 0,S.shiftKey=void 0,S.altKey=void 0,S.metaKey=void 0,S.page=void 0,S.client=void 0,S.delta=void 0,S.rect=void 0,S.x0=void 0,S.y0=void 0,S.t0=void 0,S.dt=void 0,S.duration=void 0,S.clientX0=void 0,S.clientY0=void 0,S.velocity=void 0,S.speed=void 0,S.swipe=void 0,S.axes=void 0,S.preEnd=void 0,x=x||s.element;var P=s.interactable,q=(P&&P.options||nn).deltaSource,Y=Ae(P,x,h),$=y==="start",Q=y==="end",he=$?m(S):s.prevEvent,ue=$?s.coords.start:Q?{page:he.page,client:he.client,timeStamp:s.coords.cur.timeStamp}:s.coords.cur;return S.page=oe({},ue.page),S.client=oe({},ue.client),S.rect=oe({},s.rect),S.timeStamp=ue.timeStamp,Q||(S.page.x-=Y.x,S.page.y-=Y.y,S.client.x-=Y.x,S.client.y-=Y.y),S.ctrlKey=p.ctrlKey,S.altKey=p.altKey,S.shiftKey=p.shiftKey,S.metaKey=p.metaKey,S.button=p.button,S.buttons=p.buttons,S.target=x,S.currentTarget=x,S.preEnd=w,S.type=T||h+(y||""),S.interactable=P,S.t0=$?s.pointers[s.pointers.length-1].downTime:he.t0,S.x0=s.coords.start.page.x-Y.x,S.y0=s.coords.start.page.y-Y.y,S.clientX0=s.coords.start.client.x-Y.x,S.clientY0=s.coords.start.client.y-Y.y,S.delta=$||Q?{x:0,y:0}:{x:S[q].x-he[q].x,y:S[q].y-he[q].y},S.dt=s.coords.delta.timeStamp,S.duration=S.timeStamp-S.t0,S.velocity=oe({},s.coords.velocity[q]),S.speed=lt(S.velocity.x,S.velocity.y),S.swipe=Q||y==="inertiastart"?S.getSwipe():null,S}return l(r,[{key:"getSwipe",value:function(){var s=this._interaction;if(s.prevEvent.speed<600||this.timeStamp-s.prevEvent.timeStamp>150)return null;var p=180*Math.atan2(s.prevEvent.velocityY,s.prevEvent.velocityX)/Math.PI;p<0&&(p+=360);var h=112.5<=p&&p<247.5,y=202.5<=p&&p<337.5;return{up:y,down:!y&&22.5<=p&&p<157.5,left:h,right:!h&&(292.5<=p||p<67.5),angle:p,speed:s.prevEvent.speed,velocity:{x:s.prevEvent.velocityX,y:s.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),r})(ne);Object.defineProperties(ki.prototype,{pageX:{get:function(){return this.page.x},set:function(n){this.page.x=n}},pageY:{get:function(){return this.page.y},set:function(n){this.page.y=n}},clientX:{get:function(){return this.client.x},set:function(n){this.client.x=n}},clientY:{get:function(){return this.client.y},set:function(n){this.client.y=n}},dx:{get:function(){return this.delta.x},set:function(n){this.delta.x=n}},dy:{get:function(){return this.delta.y},set:function(n){this.delta.y=n}},velocityX:{get:function(){return this.velocity.x},set:function(n){this.velocity.x=n}},velocityY:{get:function(){return this.velocity.y},set:function(n){this.velocity.y=n}}});var Nr=l((function n(i,r,s,p,h){a(this,n),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=i,this.pointer=r,this.event=s,this.downTime=p,this.downTarget=h})),qr=(function(n){return n.interactable="",n.element="",n.prepared="",n.pointerIsDown="",n.pointerWasMoved="",n._proxy="",n})({}),rn=(function(n){return n.start="",n.move="",n.end="",n.stop="",n.interacting="",n})({}),Hr=0,jr=(function(){function n(i){var r=this,s=i.pointerType,p=i.scopeFire;a(this,n),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Et((function(S){this.move(S)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=Hr++,this._scopeFire=p,this.pointerType=s;var h=this;this._proxy={};var y=function(S){Object.defineProperty(r._proxy,S,{get:function(){return h[S]}})};for(var x in qr)y(x);var w=function(S){Object.defineProperty(r._proxy,S,{value:function(){return h[S].apply(h,arguments)}})};for(var T in rn)w(T);this._scopeFire("interactions:new",{interaction:this})}return l(n,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(i,r,s){var p=this.updatePointer(i,r,s,!0),h=this.pointers[p];this._scopeFire("interactions:down",{pointer:i,event:r,eventTarget:s,pointerIndex:p,pointerInfo:h,type:"down",interaction:this})}},{key:"start",value:function(i,r,s){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(i.name==="gesture"?2:1)||!r.options[i.name].enabled)&&(Ht(this.prepared,i),this.interactable=r,this.element=s,this.rect=r.getRect(s),this.edges=this.prepared.edges?oe({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(i,r,s){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(i,r,s,!1);var p,h,y=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(p=this.coords.cur.client.x-this.coords.start.client.x,h=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=lt(p,h)>this.pointerMoveTolerance);var x,w,T,S=this.getPointerIndex(i),P={pointer:i,pointerIndex:S,pointerInfo:this.pointers[S],event:r,type:"move",eventTarget:s,dx:p,dy:h,duplicate:y,interaction:this};y||(x=this.coords.velocity,w=this.coords.delta,T=Math.max(w.timeStamp/1e3,.001),x.page.x=w.page.x/T,x.page.y=w.page.y/T,x.client.x=w.client.x/T,x.client.y=w.client.y/T,x.timeStamp=T),this._scopeFire("interactions:move",P),y||this.simulation||(this.interacting()&&(P.type=null,this.move(P)),this.pointerWasMoved&&_t(this.coords.prev,this.coords.cur))}},{key:"move",value:function(i){i&&i.event||Ke(this.coords.delta),(i=oe({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},i||{})).phase="move",this._doPhase(i)}},{key:"pointerUp",value:function(i,r,s,p){var h=this.getPointerIndex(i);h===-1&&(h=this.updatePointer(i,r,s,!1));var y=/cancel$/i.test(r.type)?"cancel":"up";this._scopeFire("interactions:".concat(y),{pointer:i,pointerIndex:h,pointerInfo:this.pointers[h],event:r,eventTarget:s,type:y,curEventTarget:p,interaction:this}),this.simulation||this.end(r),this.removePointer(i,r)}},{key:"documentBlur",value:function(i){this.end(i),this._scopeFire("interactions:blur",{event:i,type:"blur",interaction:this})}},{key:"end",value:function(i){var r;this._ending=!0,i=i||this._latestPointer.event,this.interacting()&&(r=this._doPhase({event:i,interaction:this,phase:"end"})),this._ending=!1,r===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(i){var r=W(i);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:ye(this.pointers,(function(s){return s.id===r}))}},{key:"getPointerInfo",value:function(i){return this.pointers[this.getPointerIndex(i)]}},{key:"updatePointer",value:function(i,r,s,p){var h,y,x,w=W(i),T=this.getPointerIndex(i),S=this.pointers[T];return p=p!==!1&&(p||/(down|start)$/i.test(r.type)),S?S.pointer=i:(S=new Nr(w,i,r,null,null),T=this.pointers.length,this.pointers.push(S)),ge(this.coords.cur,this.pointers.map((function(P){return P.pointer})),this._now()),h=this.coords.delta,y=this.coords.prev,x=this.coords.cur,h.page.x=x.page.x-y.page.x,h.page.y=x.page.y-y.page.y,h.client.x=x.client.x-y.client.x,h.client.y=x.client.y-y.client.y,h.timeStamp=x.timeStamp-y.timeStamp,p&&(this.pointerIsDown=!0,S.downTime=this.coords.cur.timeStamp,S.downTarget=s,xt(this.downPointer,i),this.interacting()||(_t(this.coords.start,this.coords.cur),_t(this.coords.prev,this.coords.cur),this.downEvent=r,this.pointerWasMoved=!1)),this._updateLatestPointer(i,r,s),this._scopeFire("interactions:update-pointer",{pointer:i,event:r,eventTarget:s,down:p,pointerInfo:S,pointerIndex:T,interaction:this}),T}},{key:"removePointer",value:function(i,r){var s=this.getPointerIndex(i);if(s!==-1){var p=this.pointers[s];this._scopeFire("interactions:remove-pointer",{pointer:i,event:r,eventTarget:null,pointerIndex:s,pointerInfo:p,interaction:this}),this.pointers.splice(s,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(i,r,s){this._latestPointer.pointer=i,this._latestPointer.event=r,this._latestPointer.eventTarget=s}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(i,r,s,p){return new ki(this,i,this.prepared.name,r,this.element,s,p)}},{key:"_fireEvent",value:function(i){var r;(r=this.interactable)==null||r.fire(i),(!this.prevEvent||i.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=i)}},{key:"_doPhase",value:function(i){var r=i.event,s=i.phase,p=i.preEnd,h=i.type,y=this.rect;if(y&&s==="move"&&(Re(this.edges,y,this.coords.delta[this.interactable.options.deltaSource]),y.width=y.right-y.left,y.height=y.bottom-y.top),this._scopeFire("interactions:before-action-".concat(s),i)===!1)return!1;var x=i.iEvent=this._createPreparedEvent(r,s,p,h);return this._scopeFire("interactions:action-".concat(s),i),s==="start"&&(this.prevEvent=x),this._fireEvent(x),this._scopeFire("interactions:after-action-".concat(s),i),!0}},{key:"_now",value:function(){return Date.now()}}]),n})();function an(n){on(n.interaction)}function on(n){if(!(function(r){return!(!r.offset.pending.x&&!r.offset.pending.y)})(n))return!1;var i=n.offset.pending;return Si(n.coords.cur,i),Si(n.coords.delta,i),Re(n.edges,n.rect,i),i.x=0,i.y=0,!0}function Kr(n){var i=n.x,r=n.y;this.offset.pending.x+=i,this.offset.pending.y+=r,this.offset.total.x+=i,this.offset.total.y+=r}function Si(n,i){var r=n.page,s=n.client,p=i.x,h=i.y;r.x+=p,r.y+=h,s.x+=p,s.y+=h}rn.offsetBy="";var $r={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(n){n.Interaction.prototype.offsetBy=Kr},listeners:{"interactions:new":function(n){n.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(n){return(function(i){i.pointerIsDown&&(Si(i.coords.cur,i.offset.total),i.offset.pending.x=0,i.offset.pending.y=0)})(n.interaction)},"interactions:before-action-start":an,"interactions:before-action-move":an,"interactions:before-action-end":function(n){var i=n.interaction;if(on(i))return i.move({offset:!0}),i.end(),!1},"interactions:stop":function(n){var i=n.interaction;i.offset.total.x=0,i.offset.total.y=0,i.offset.pending.x=0,i.offset.pending.y=0}}},sn=$r,Wr=(function(){function n(i){a(this,n),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=i}return l(n,[{key:"start",value:function(i){var r=this.interaction,s=si(r);if(!s||!s.enabled)return!1;var p=r.coords.velocity.client,h=lt(p.x,p.y),y=this.modification||(this.modification=new wi(r));if(y.copyFrom(r.modification),this.t0=r._now(),this.allowResume=s.allowResume,this.v0=h,this.currentOffset={x:0,y:0},this.startCoords=r.coords.cur.page,this.modifierArg=y.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-r.coords.cur.timeStamp<50&&h>s.minSpeed&&h>s.endSpeed)this.startInertia();else{if(y.result=y.setAll(this.modifierArg),!y.result.changed)return!1;this.startSmoothEnd()}return r.modification.result.rect=null,r.offsetBy(this.targetOffset),r._doPhase({interaction:r,event:i,phase:"inertiastart"}),r.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),r.modification.result.rect=null,this.active=!0,r.simulation=this,!0}},{key:"startInertia",value:function(){var i=this,r=this.interaction.coords.velocity.client,s=si(this.interaction),p=s.resistance,h=-Math.log(s.endSpeed/this.v0)/p;this.targetOffset={x:(r.x-h)/p,y:(r.y-h)/p},this.te=h,this.lambda_v0=p/this.v0,this.one_ve_v0=1-s.endSpeed/this.v0;var y=this.modification,x=this.modifierArg;x.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},y.result=y.setAll(x),y.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+y.result.delta.x,y:this.targetOffset.y+y.result.delta.y}),this.onNextFrame((function(){return i.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var i=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return i.smoothEndTick()}))}},{key:"onNextFrame",value:function(i){var r=this;this.timeout=U.request((function(){r.active&&i()}))}},{key:"inertiaTick",value:function(){var i,r,s,p,h,y,x,w=this,T=this.interaction,S=si(T).resistance,P=(T._now()-this.t0)/1e3;if(P<this.te){var q,Y=1-(Math.exp(-S*P)-this.lambda_v0)/this.one_ve_v0;this.isModified?(i=0,r=0,s=this.targetOffset.x,p=this.targetOffset.y,h=this.modifiedOffset.x,y=this.modifiedOffset.y,q={x:cn(x=Y,i,s,h),y:cn(x,r,p,y)}):q={x:this.targetOffset.x*Y,y:this.targetOffset.y*Y};var $={x:q.x-this.currentOffset.x,y:q.y-this.currentOffset.y};this.currentOffset.x+=$.x,this.currentOffset.y+=$.y,T.offsetBy($),T.move(),this.onNextFrame((function(){return w.inertiaTick()}))}else T.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var i=this,r=this.interaction,s=r._now()-this.t0,p=si(r).smoothEndDuration;if(s<p){var h={x:ln(s,0,this.targetOffset.x,p),y:ln(s,0,this.targetOffset.y,p)},y={x:h.x-this.currentOffset.x,y:h.y-this.currentOffset.y};this.currentOffset.x+=y.x,this.currentOffset.y+=y.y,r.offsetBy(y),r.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return i.smoothEndTick()}))}else r.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(i){var r=i.pointer,s=i.event,p=i.eventTarget,h=this.interaction;h.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),h.updatePointer(r,s,p,!0),h._doPhase({interaction:h,event:s,phase:"resume"}),_t(h.coords.prev,h.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,U.cancel(this.timeout)}}]),n})();function si(n){var i=n.interactable,r=n.prepared;return i&&i.options&&r.name&&i.options[r.name].inertia}var Yr={id:"inertia",before:["modifiers","actions"],install:function(n){var i=n.defaults;n.usePlugin(sn),n.usePlugin(tn),n.actions.phases.inertiastart=!0,n.actions.phases.resume=!0,i.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(n){var i=n.interaction;i.inertia=new Wr(i)},"interactions:before-action-end":function(n){var i=n.interaction,r=n.event;return(!i._interacting||i.simulation||!i.inertia.start(r))&&null},"interactions:down":function(n){var i=n.interaction,r=n.eventTarget,s=i.inertia;if(s.active)for(var p=r;b.element(p);){if(p===i.element){s.resume(n);break}p=Ye(p)}},"interactions:stop":function(n){var i=n.interaction.inertia;i.active&&i.stop()},"interactions:before-action-resume":function(n){var i=n.interaction.modification;i.stop(n),i.start(n,n.interaction.coords.cur.page),i.applyToInteraction(n)},"interactions:before-action-inertiastart":function(n){return n.interaction.modification.setAndApply(n)},"interactions:action-resume":Ut,"interactions:action-inertiastart":Ut,"interactions:after-action-inertiastart":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-resume":function(n){return n.interaction.modification.restoreInteractionCoords(n)}}};function cn(n,i,r,s){var p=1-n;return p*p*i+2*p*n*r+n*n*s}function ln(n,i,r,s){return-r*(n/=s)*(n-2)+i}var Ur=Yr;function dn(n,i){for(var r=0;r<i.length;r++){var s=i[r];if(n.immediatePropagationStopped)break;s(n)}}var pn=(function(){function n(i){a(this,n),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=oe({},i||{})}return l(n,[{key:"fire",value:function(i){var r,s=this.global;(r=this.types[i.type])&&dn(i,r),!i.propagationStopped&&s&&(r=s[i.type])&&dn(i,r)}},{key:"on",value:function(i,r){var s=Ce(i,r);for(i in s)this.types[i]=ce(this.types[i]||[],s[i])}},{key:"off",value:function(i,r){var s=Ce(i,r);for(i in s){var p=this.types[i];if(p&&p.length)for(var h=0,y=s[i];h<y.length;h++){var x=y[h],w=p.indexOf(x);w!==-1&&p.splice(w,1)}}}},{key:"getRect",value:function(i){return null}}]),n})(),Vr=(function(){function n(i){a(this,n),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=i,xt(this,i)}return l(n,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),n})();function Vt(n){return b.object(n)?{capture:!!n.capture,passive:!!n.passive}:{capture:!!n,passive:!1}}function ci(n,i){return n===i||(typeof n=="boolean"?!!i.capture===n&&!i.passive:!!n.capture==!!i.capture&&!!n.passive==!!i.passive)}var Gr={id:"events",install:function(n){var i,r=[],s={},p=[],h={add:y,remove:x,addDelegate:function(S,P,q,Y,$){var Q=Vt($);if(!s[q]){s[q]=[];for(var he=0;he<p.length;he++){var ue=p[he];y(ue,q,w),y(ue,q,T,!0)}}var be=s[q],Pe=N(be,(function(qe){return qe.selector===S&&qe.context===P}));Pe||(Pe={selector:S,context:P,listeners:[]},be.push(Pe)),Pe.listeners.push({func:Y,options:Q})},removeDelegate:function(S,P,q,Y,$){var Q,he=Vt($),ue=s[q],be=!1;if(ue)for(Q=ue.length-1;Q>=0;Q--){var Pe=ue[Q];if(Pe.selector===S&&Pe.context===P){for(var qe=Pe.listeners,Se=qe.length-1;Se>=0;Se--){var Ie=qe[Se];if(Ie.func===Y&&ci(Ie.options,he)){qe.splice(Se,1),qe.length||(ue.splice(Q,1),x(P,q,w),x(P,q,T,!0)),be=!0;break}}if(be)break}}},delegateListener:w,delegateUseCapture:T,delegatedEvents:s,documents:p,targets:r,supportsOptions:!1,supportsPassive:!1};function y(S,P,q,Y){if(S.addEventListener){var $=Vt(Y),Q=N(r,(function(he){return he.eventTarget===S}));Q||(Q={eventTarget:S,events:{}},r.push(Q)),Q.events[P]||(Q.events[P]=[]),N(Q.events[P],(function(he){return he.func===q&&ci(he.options,$)}))||(S.addEventListener(P,q,h.supportsOptions?$:$.capture),Q.events[P].push({func:q,options:$}))}}function x(S,P,q,Y){if(S.addEventListener&&S.removeEventListener){var $=ye(r,(function(vt){return vt.eventTarget===S})),Q=r[$];if(Q&&Q.events)if(P!=="all"){var he=!1,ue=Q.events[P];if(ue){if(q==="all"){for(var be=ue.length-1;be>=0;be--){var Pe=ue[be];x(S,P,Pe.func,Pe.options)}return}for(var qe=Vt(Y),Se=0;Se<ue.length;Se++){var Ie=ue[Se];if(Ie.func===q&&ci(Ie.options,qe)){S.removeEventListener(P,q,h.supportsOptions?qe:qe.capture),ue.splice(Se,1),ue.length===0&&(delete Q.events[P],he=!0);break}}}he&&!Object.keys(Q.events).length&&r.splice($,1)}else for(P in Q.events)Q.events.hasOwnProperty(P)&&x(S,P,"all")}}function w(S,P){for(var q=Vt(P),Y=new Vr(S),$=s[S.type],Q=B(S)[0],he=Q;b.element(he);){for(var ue=0;ue<$.length;ue++){var be=$[ue],Pe=be.selector,qe=be.context;if(je(he,Pe)&&Te(qe,Q)&&Te(qe,he)){var Se=be.listeners;Y.currentTarget=he;for(var Ie=0;Ie<Se.length;Ie++){var vt=Se[Ie];ci(vt.options,q)&&vt.func(Y)}}}he=Ye(he)}}function T(S){return w(S,!0)}return(i=n.document)==null||i.createElement("div").addEventListener("test",null,{get capture(){return h.supportsOptions=!0},get passive(){return h.supportsPassive=!0}}),n.events=h,h}},Ei={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(n){for(var i=0,r=Ei.methodOrder;i<r.length;i++){var s=r[i],p=Ei[s](n);if(p)return p}return null},simulationResume:function(n){var i=n.pointerType,r=n.eventType,s=n.eventTarget,p=n.scope;if(!/down|start/i.test(r))return null;for(var h=0,y=p.interactions.list;h<y.length;h++){var x=y[h],w=s;if(x.simulation&&x.simulation.allowResume&&x.pointerType===i)for(;w;){if(w===x.element)return x;w=Ye(w)}}return null},mouseOrPen:function(n){var i,r=n.pointerId,s=n.pointerType,p=n.eventType,h=n.scope;if(s!=="mouse"&&s!=="pen")return null;for(var y=0,x=h.interactions.list;y<x.length;y++){var w=x[y];if(w.pointerType===s){if(w.simulation&&!un(w,r))continue;if(w.interacting())return w;i||(i=w)}}if(i)return i;for(var T=0,S=h.interactions.list;T<S.length;T++){var P=S[T];if(!(P.pointerType!==s||/down/i.test(p)&&P.simulation))return P}return null},hasPointer:function(n){for(var i=n.pointerId,r=0,s=n.scope.interactions.list;r<s.length;r++){var p=s[r];if(un(p,i))return p}return null},idle:function(n){for(var i=n.pointerType,r=0,s=n.scope.interactions.list;r<s.length;r++){var p=s[r];if(p.pointers.length===1){var h=p.interactable;if(h&&(!h.options.gesture||!h.options.gesture.enabled))continue}else if(p.pointers.length>=2)continue;if(!p.interacting()&&i===p.pointerType)return p}return null}};function un(n,i){return n.pointers.some((function(r){return r.id===i}))}var Xr=Ei,Ci=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function hn(n,i){return function(r){var s=i.interactions.list,p=D(r),h=B(r),y=h[0],x=h[1],w=[];if(/^touch/.test(r.type)){i.prevTouchTime=i.now();for(var T=0,S=r.changedTouches;T<S.length;T++){var P=S[T],q={pointer:P,pointerId:W(P),pointerType:p,eventType:r.type,eventTarget:y,curEventTarget:x,scope:i},Y=fn(q);w.push([q.pointer,q.eventTarget,q.curEventTarget,Y])}}else{var $=!1;if(!_e.supportsPointerEvent&&/mouse/.test(r.type)){for(var Q=0;Q<s.length&&!$;Q++)$=s[Q].pointerType!=="mouse"&&s[Q].pointerIsDown;$=$||i.now()-i.prevTouchTime<500||r.timeStamp===0}if(!$){var he={pointer:r,pointerId:W(r),pointerType:p,eventType:r.type,curEventTarget:x,eventTarget:y,scope:i},ue=fn(he);w.push([he.pointer,he.eventTarget,he.curEventTarget,ue])}}for(var be=0;be<w.length;be++){var Pe=w[be],qe=Pe[0],Se=Pe[1],Ie=Pe[2];Pe[3][n](qe,r,Se,Ie)}}}function fn(n){var i=n.pointerType,r=n.scope,s={interaction:Xr.search(n),searchDetails:n};return r.fire("interactions:find",s),s.interaction||r.interactions.new({pointerType:i})}function Ai(n,i){var r=n.doc,s=n.scope,p=n.options,h=s.interactions.docEvents,y=s.events,x=y[i];for(var w in s.browser.isIOS&&!p.events&&(p.events={passive:!1}),y.delegatedEvents)x(r,w,y.delegateListener),x(r,w,y.delegateUseCapture,!0);for(var T=p&&p.events,S=0;S<h.length;S++){var P=h[S];x(r,P.type,P.listener,T)}}var Jr={id:"core/interactions",install:function(n){for(var i={},r=0;r<Ci.length;r++){var s=Ci[r];i[s]=hn(s,n)}var p,h=_e.pEventTypes;function y(){for(var x=0,w=n.interactions.list;x<w.length;x++){var T=w[x];if(T.pointerIsDown&&T.pointerType==="touch"&&!T._interacting)for(var S=function(){var Y=q[P];n.documents.some((function($){return Te($.doc,Y.downTarget)}))||T.removePointer(Y.pointer,Y.event)},P=0,q=T.pointers;P<q.length;P++)S()}}(p=G.PointerEvent?[{type:h.down,listener:y},{type:h.down,listener:i.pointerDown},{type:h.move,listener:i.pointerMove},{type:h.up,listener:i.pointerUp},{type:h.cancel,listener:i.pointerUp}]:[{type:"mousedown",listener:i.pointerDown},{type:"mousemove",listener:i.pointerMove},{type:"mouseup",listener:i.pointerUp},{type:"touchstart",listener:y},{type:"touchstart",listener:i.pointerDown},{type:"touchmove",listener:i.pointerMove},{type:"touchend",listener:i.pointerUp},{type:"touchcancel",listener:i.pointerUp}]).push({type:"blur",listener:function(x){for(var w=0,T=n.interactions.list;w<T.length;w++)T[w].documentBlur(x)}}),n.prevTouchTime=0,n.Interaction=(function(x){d(T,x);var w=_(T);function T(){return a(this,T),w.apply(this,arguments)}return l(T,[{key:"pointerMoveTolerance",get:function(){return n.interactions.pointerMoveTolerance},set:function(S){n.interactions.pointerMoveTolerance=S}},{key:"_now",value:function(){return n.now()}}]),T})(jr),n.interactions={list:[],new:function(x){x.scopeFire=function(T,S){return n.fire(T,S)};var w=new n.Interaction(x);return n.interactions.list.push(w),w},listeners:i,docEvents:p,pointerMoveTolerance:1},n.usePlugin(en)},listeners:{"scope:add-document":function(n){return Ai(n,"add")},"scope:remove-document":function(n){return Ai(n,"remove")},"interactable:unset":function(n,i){for(var r=n.interactable,s=i.interactions.list.length-1;s>=0;s--){var p=i.interactions.list[s];p.interactable===r&&(p.stop(),i.fire("interactions:destroy",{interaction:p}),p.destroy(),i.interactions.list.length>2&&i.interactions.list.splice(s,1))}}},onDocSignal:Ai,doOnInteractions:hn,methodNames:Ci},Qr=Jr,zt=(function(n){return n[n.On=0]="On",n[n.Off=1]="Off",n})(zt||{}),Zr=(function(){function n(i,r,s,p){a(this,n),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new pn,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=r.actions,this.target=i,this._context=r.context||s,this._win=C(rt(i)?this._context:i),this._doc=this._win.document,this._scopeEvents=p,this.set(r)}return l(n,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(i,r){return b.func(r.onstart)&&this.on("".concat(i,"start"),r.onstart),b.func(r.onmove)&&this.on("".concat(i,"move"),r.onmove),b.func(r.onend)&&this.on("".concat(i,"end"),r.onend),b.func(r.oninertiastart)&&this.on("".concat(i,"inertiastart"),r.oninertiastart),this}},{key:"updatePerActionListeners",value:function(i,r,s){var p,h=this,y=(p=this._actions.map[i])==null?void 0:p.filterEventType,x=function(w){return(y==null||y(w))&&ai(w,h._actions)};(b.array(r)||b.object(r))&&this._onOff(zt.Off,i,r,void 0,x),(b.array(s)||b.object(s))&&this._onOff(zt.On,i,s,void 0,x)}},{key:"setPerAction",value:function(i,r){var s=this._defaults;for(var p in r){var h=p,y=this.options[i],x=r[h];h==="listeners"&&this.updatePerActionListeners(i,y.listeners,x),b.array(x)?y[h]=de(x):b.plainObject(x)?(y[h]=oe(y[h]||{},jt(x)),b.object(s.perAction[h])&&"enabled"in s.perAction[h]&&(y[h].enabled=x.enabled!==!1)):b.bool(x)&&b.object(s.perAction[h])?y[h].enabled=x:y[h]=x}}},{key:"getRect",value:function(i){return i=i||(b.element(this.target)?this.target:null),b.string(this.target)&&(i=i||this._context.querySelector(this.target)),it(i)}},{key:"rectChecker",value:function(i){var r=this;return b.func(i)?(this.getRect=function(s){var p=oe({},i.apply(r,s));return"width"in p||(p.width=p.right-p.left,p.height=p.bottom-p.top),p},this):i===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(i,r){if(rt(r)||b.object(r)){for(var s in this.options[i]=r,this._actions.map)this.options[s][i]=r;return this}return this.options[i]}},{key:"origin",value:function(i){return this._backCompatOption("origin",i)}},{key:"deltaSource",value:function(i){return i==="page"||i==="client"?(this.options.deltaSource=i,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var i=this.target;return b.string(i)?Array.from(this._context.querySelectorAll(i)):b.func(i)&&i.getAllElements?i.getAllElements():b.element(i)?[i]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(i){return this._context===i.ownerDocument||Te(this._context,i)}},{key:"testIgnoreAllow",value:function(i,r,s){return!this.testIgnore(i.ignoreFrom,r,s)&&this.testAllow(i.allowFrom,r,s)}},{key:"testAllow",value:function(i,r,s){return!i||!!b.element(s)&&(b.string(i)?nt(s,i,r):!!b.element(i)&&Te(i,s))}},{key:"testIgnore",value:function(i,r,s){return!(!i||!b.element(s))&&(b.string(i)?nt(s,i,r):!!b.element(i)&&Te(i,s))}},{key:"fire",value:function(i){return this.events.fire(i),this}},{key:"_onOff",value:function(i,r,s,p,h){b.object(r)&&!b.array(r)&&(p=s,s=null);var y=Ce(r,s,h);for(var x in y){x==="wheel"&&(x=_e.wheelEvent);for(var w=0,T=y[x];w<T.length;w++){var S=T[w];ai(x,this._actions)?this.events[i===zt.On?"on":"off"](x,S):b.string(this.target)?this._scopeEvents[i===zt.On?"addDelegate":"removeDelegate"](this.target,this._context,x,S,p):this._scopeEvents[i===zt.On?"add":"remove"](this.target,x,S,p)}}return this}},{key:"on",value:function(i,r,s){return this._onOff(zt.On,i,r,s)}},{key:"off",value:function(i,r,s){return this._onOff(zt.Off,i,r,s)}},{key:"set",value:function(i){var r=this._defaults;for(var s in b.object(i)||(i={}),this.options=jt(r.base),this._actions.methodDict){var p=s,h=this._actions.methodDict[p];this.options[p]={},this.setPerAction(p,oe(oe({},r.perAction),r.actions[p])),this[h](i[p])}for(var y in i)y!=="getRect"?b.func(this[y])&&this[y](i[y]):this.rectChecker(i.getRect);return this}},{key:"unset",value:function(){if(b.string(this.target))for(var i in this._scopeEvents.delegatedEvents)for(var r=this._scopeEvents.delegatedEvents[i],s=r.length-1;s>=0;s--){var p=r[s],h=p.selector,y=p.context,x=p.listeners;h===this.target&&y===this._context&&r.splice(s,1);for(var w=x.length-1;w>=0;w--)this._scopeEvents.removeDelegate(this.target,this._context,i,x[w][0],x[w][1])}else this._scopeEvents.remove(this.target,"all")}}]),n})(),ea=(function(){function n(i){var r=this;a(this,n),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=i,i.addListeners({"interactable:unset":function(s){var p=s.interactable,h=p.target,y=b.string(h)?r.selectorMap[h]:h[r.scope.id],x=ye(y,(function(w){return w===p}));y.splice(x,1)}})}return l(n,[{key:"new",value:function(i,r){r=oe(r||{},{actions:this.scope.actions});var s=new this.scope.Interactable(i,r,this.scope.document,this.scope.events);return this.scope.addDocument(s._doc),this.list.push(s),b.string(i)?(this.selectorMap[i]||(this.selectorMap[i]=[]),this.selectorMap[i].push(s)):(s.target[this.scope.id]||Object.defineProperty(i,this.scope.id,{value:[],configurable:!0}),i[this.scope.id].push(s)),this.scope.fire("interactable:new",{target:i,options:r,interactable:s,win:this.scope._win}),s}},{key:"getExisting",value:function(i,r){var s=r&&r.context||this.scope.document,p=b.string(i),h=p?this.selectorMap[i]:i[this.scope.id];if(h)return N(h,(function(y){return y._context===s&&(p||y.inContext(i))}))}},{key:"forEachMatch",value:function(i,r){for(var s=0,p=this.list;s<p.length;s++){var h=p[s],y=void 0;if((b.string(h.target)?b.element(i)&&je(i,h.target):i===h.target)&&h.inContext(i)&&(y=r(h)),y!==void 0)return y}}}]),n})(),ta=(function(){function n(){var i=this;a(this,n),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=_e,this.defaults=jt(nn),this.Eventable=pn,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(s){var p=function h(y,x){var w=s.interactables.getExisting(y,x);return w||((w=s.interactables.new(y,x)).events.global=h.globalEvents),w};return p.getPointerAverage=ve,p.getTouchBBox=X,p.getTouchDistance=te,p.getTouchAngle=se,p.getElementRect=it,p.getElementClientRect=Ge,p.matchesSelector=je,p.closest=et,p.globalEvents={},p.version="1.10.27",p.scope=s,p.use=function(h,y){return this.scope.usePlugin(h,y),this},p.isSet=function(h,y){return!!this.scope.interactables.get(h,y&&y.context)},p.on=Et((function(h,y,x){if(b.string(h)&&h.search(" ")!==-1&&(h=h.trim().split(/ +/)),b.array(h)){for(var w=0,T=h;w<T.length;w++){var S=T[w];this.on(S,y,x)}return this}if(b.object(h)){for(var P in h)this.on(P,h[P],y);return this}return ai(h,this.scope.actions)?this.globalEvents[h]?this.globalEvents[h].push(y):this.globalEvents[h]=[y]:this.scope.events.add(this.scope.document,h,y,{options:x}),this}),"The interact.on() method is being deprecated"),p.off=Et((function(h,y,x){if(b.string(h)&&h.search(" ")!==-1&&(h=h.trim().split(/ +/)),b.array(h)){for(var w=0,T=h;w<T.length;w++){var S=T[w];this.off(S,y,x)}return this}if(b.object(h)){for(var P in h)this.off(P,h[P],y);return this}var q;return ai(h,this.scope.actions)?h in this.globalEvents&&(q=this.globalEvents[h].indexOf(y))!==-1&&this.globalEvents[h].splice(q,1):this.scope.events.remove(this.scope.document,h,y,x),this}),"The interact.off() method is being deprecated"),p.debug=function(){return this.scope},p.supportsTouch=function(){return _e.supportsTouch},p.supportsPointerEvent=function(){return _e.supportsPointerEvent},p.stop=function(){for(var h=0,y=this.scope.interactions.list;h<y.length;h++)y[h].stop();return this},p.pointerMoveTolerance=function(h){return b.number(h)?(this.scope.interactions.pointerMoveTolerance=h,this):this.scope.interactions.pointerMoveTolerance},p.addDocument=function(h,y){this.scope.addDocument(h,y)},p.removeDocument=function(h){this.scope.removeDocument(h)},p})(this),this.InteractEvent=ki,this.Interactable=void 0,this.interactables=new ea(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(s){return i.removeDocument(s.target)};var r=this;this.Interactable=(function(s){d(h,s);var p=_(h);function h(){return a(this,h),p.apply(this,arguments)}return l(h,[{key:"_defaults",get:function(){return r.defaults}},{key:"set",value:function(y){return g(f(h.prototype),"set",this).call(this,y),r.fire("interactable:set",{options:y,interactable:this}),this}},{key:"unset",value:function(){g(f(h.prototype),"unset",this).call(this);var y=r.interactables.list.indexOf(this);y<0||(r.interactables.list.splice(y,1),r.fire("interactable:unset",{interactable:this}))}}]),h})(Zr)}return l(n,[{key:"addListeners",value:function(i,r){this.listenerMaps.push({id:r,map:i})}},{key:"fire",value:function(i,r){for(var s=0,p=this.listenerMaps;s<p.length;s++){var h=p[s].map[i];if(h&&h(r,this,i)===!1)return!1}}},{key:"init",value:function(i){return this.isInitialized?this:(function(r,s){return r.isInitialized=!0,b.window(s)&&I(s),G.init(s),_e.init(s),U.init(s),r.window=s,r.document=s.document,r.usePlugin(Qr),r.usePlugin(Gr),r})(this,i)}},{key:"pluginIsInstalled",value:function(i){var r=i.id;return r?!!this._plugins.map[r]:this._plugins.list.indexOf(i)!==-1}},{key:"usePlugin",value:function(i,r){if(!this.isInitialized)return this;if(this.pluginIsInstalled(i))return this;if(i.id&&(this._plugins.map[i.id]=i),this._plugins.list.push(i),i.install&&i.install(this,r),i.listeners&&i.before){for(var s=0,p=this.listenerMaps.length,h=i.before.reduce((function(x,w){return x[w]=!0,x[gn(w)]=!0,x}),{});s<p;s++){var y=this.listenerMaps[s].id;if(y&&(h[y]||h[gn(y)]))break}this.listenerMaps.splice(s,0,{id:i.id,map:i.listeners})}else i.listeners&&this.listenerMaps.push({id:i.id,map:i.listeners});return this}},{key:"addDocument",value:function(i,r){if(this.getDocIndex(i)!==-1)return!1;var s=C(i);r=r?oe({},r):{},this.documents.push({doc:i,options:r}),this.events.documents.push(i),i!==this.document&&this.events.add(s,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:i,window:s,scope:this,options:r})}},{key:"removeDocument",value:function(i){var r=this.getDocIndex(i),s=C(i),p=this.documents[r].options;this.events.remove(s,"unload",this.onWindowUnload),this.documents.splice(r,1),this.events.documents.splice(r,1),this.fire("scope:remove-document",{doc:i,window:s,scope:this,options:p})}},{key:"getDocIndex",value:function(i){for(var r=0;r<this.documents.length;r++)if(this.documents[r].doc===i)return r;return-1}},{key:"getDocOptions",value:function(i){var r=this.getDocIndex(i);return r===-1?null:this.documents[r].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),n})();function gn(n){return n&&n.replace(/\/.*$/,"")}var mn=new ta,yt=mn.interactStatic,ia=typeof globalThis!="undefined"?globalThis:window;mn.init(ia);var na=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(n){var i=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(s){var p=s[0],h=s[1];return p in n||h in n})),r=function(s,p){for(var h=n.range,y=n.limits,x=y===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:y,w=n.offset,T=w===void 0?{x:0,y:0}:w,S={range:h,grid:n,x:null,y:null},P=0;P<i.length;P++){var q=i[P],Y=q[0],$=q[1],Q=Math.round((s-T.x)/n[Y]),he=Math.round((p-T.y)/n[$]);S[Y]=Math.max(x.left,Math.min(x.right,Q*n[Y]+T.x)),S[$]=Math.max(x.top,Math.min(x.bottom,he*n[$]+T.y))}return S};return r.grid=n,r.coordFields=i,r}}),ra={id:"snappers",install:function(n){var i=n.interactStatic;i.snappers=oe(i.snappers||{},na),i.createSnapGrid=i.snappers.grid}},aa=ra,oa={start:function(n){var i=n.state,r=n.rect,s=n.edges,p=n.pageCoords,h=i.options,y=h.ratio,x=h.enabled,w=i.options,T=w.equalDelta,S=w.modifiers;y==="preserve"&&(y=r.width/r.height),i.startCoords=oe({},p),i.startRect=oe({},r),i.ratio=y,i.equalDelta=T;var P=i.linkedEdges={top:s.top||s.left&&!s.bottom,left:s.left||s.top&&!s.right,bottom:s.bottom||s.right&&!s.top,right:s.right||s.bottom&&!s.left};if(i.xIsPrimaryAxis=!(!s.left&&!s.right),i.equalDelta){var q=(P.left?1:-1)*(P.top?1:-1);i.edgeSign={x:q,y:q}}else i.edgeSign={x:P.left?-1:1,y:P.top?-1:1};if(x!==!1&&oe(s,P),S!=null&&S.length){var Y=new wi(n.interaction);Y.copyFrom(n.interaction.modification),Y.prepareStates(S),i.subModification=Y,Y.startAll(u({},n))}},set:function(n){var i=n.state,r=n.rect,s=n.coords,p=i.linkedEdges,h=oe({},s),y=i.equalDelta?sa:ca;if(oe(n.edges,p),y(i,i.xIsPrimaryAxis,s,r),!i.subModification)return null;var x=oe({},r);Re(p,x,{x:s.x-h.x,y:s.y-h.y});var w=i.subModification.setAll(u(u({},n),{},{rect:x,edges:p,pageCoords:s,prevCoords:s,prevRect:x})),T=w.delta;return w.changed&&(y(i,Math.abs(T.x)>Math.abs(T.y),w.coords,w.rect),oe(s,w.coords)),w.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function sa(n,i,r){var s=n.startCoords,p=n.edgeSign;i?r.y=s.y+(r.x-s.x)*p.y:r.x=s.x+(r.y-s.y)*p.x}function ca(n,i,r,s){var p=n.startRect,h=n.startCoords,y=n.ratio,x=n.edgeSign;if(i){var w=s.width/y;r.y=h.y+(w-p.height)*x.y}else{var T=s.height*y;r.x=h.x+(T-p.width)*x.x}}var la=Lt(oa,"aspectRatio"),yn=function(){};yn._defaults={};var li=yn;function Ft(n,i,r){return b.func(n)?at(n,i.interactable,i.element,[r.x,r.y,i]):at(n,i.interactable,i.element)}var di={start:function(n){var i=n.rect,r=n.startOffset,s=n.state,p=n.interaction,h=n.pageCoords,y=s.options,x=y.elementRect,w=oe({left:0,top:0,right:0,bottom:0},y.offset||{});if(i&&x){var T=Ft(y.restriction,p,h);if(T){var S=T.right-T.left-i.width,P=T.bottom-T.top-i.height;S<0&&(w.left+=S,w.right+=S),P<0&&(w.top+=P,w.bottom+=P)}w.left+=r.left-i.width*x.left,w.top+=r.top-i.height*x.top,w.right+=r.right-i.width*(1-x.right),w.bottom+=r.bottom-i.height*(1-x.bottom)}s.offset=w},set:function(n){var i=n.coords,r=n.interaction,s=n.state,p=s.options,h=s.offset,y=Ft(p.restriction,r,i);if(y){var x=(function(w){return!w||"left"in w&&"top"in w||((w=oe({},w)).left=w.x||0,w.top=w.y||0,w.right=w.right||w.left+w.width,w.bottom=w.bottom||w.top+w.height),w})(y);i.x=Math.max(Math.min(x.right-h.right,i.x),x.left+h.left),i.y=Math.max(Math.min(x.bottom-h.bottom,i.y),x.top+h.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},da=Lt(di,"restrict"),vn={top:1/0,left:1/0,bottom:-1/0,right:-1/0},bn={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function xn(n,i){for(var r=0,s=["top","left","bottom","right"];r<s.length;r++){var p=s[r];p in n||(n[p]=i[p])}return n}var Gt={noInner:vn,noOuter:bn,start:function(n){var i,r=n.interaction,s=n.startOffset,p=n.state,h=p.options;h&&(i=De(Ft(h.offset,r,r.coords.start.page))),i=i||{x:0,y:0},p.offset={top:i.y+s.top,left:i.x+s.left,bottom:i.y-s.bottom,right:i.x-s.right}},set:function(n){var i=n.coords,r=n.edges,s=n.interaction,p=n.state,h=p.offset,y=p.options;if(r){var x=oe({},i),w=Ft(y.inner,s,x)||{},T=Ft(y.outer,s,x)||{};xn(w,vn),xn(T,bn),r.top?i.y=Math.min(Math.max(T.top+h.top,x.y),w.top+h.top):r.bottom&&(i.y=Math.max(Math.min(T.bottom+h.bottom,x.y),w.bottom+h.bottom)),r.left?i.x=Math.min(Math.max(T.left+h.left,x.x),w.left+h.left):r.right&&(i.x=Math.max(Math.min(T.right+h.right,x.x),w.right+h.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},pa=Lt(Gt,"restrictEdges"),ua=oe({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(n){}},di.defaults),ha=Lt({start:di.start,set:di.set,defaults:ua},"restrictRect"),fa={width:-1/0,height:-1/0},ga={width:1/0,height:1/0},ma=Lt({start:function(n){return Gt.start(n)},set:function(n){var i=n.interaction,r=n.state,s=n.rect,p=n.edges,h=r.options;if(p){var y=re(Ft(h.min,i,n.coords))||fa,x=re(Ft(h.max,i,n.coords))||ga;r.options={endOnly:h.endOnly,inner:oe({},Gt.noInner),outer:oe({},Gt.noOuter)},p.top?(r.options.inner.top=s.bottom-y.height,r.options.outer.top=s.bottom-x.height):p.bottom&&(r.options.inner.bottom=s.top+y.height,r.options.outer.bottom=s.top+x.height),p.left?(r.options.inner.left=s.right-y.width,r.options.outer.left=s.right-x.width):p.right&&(r.options.inner.right=s.left+y.width,r.options.outer.right=s.left+x.width),Gt.set(n),r.options=h}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),Ti={start:function(n){var i,r=n.interaction,s=n.interactable,p=n.element,h=n.rect,y=n.state,x=n.startOffset,w=y.options,T=w.offsetWithOrigin?(function(q){var Y=q.interaction.element,$=De(at(q.state.options.origin,null,null,[Y])),Q=$||Ae(q.interactable,Y,q.interaction.prepared.name);return Q})(n):{x:0,y:0};if(w.offset==="startCoords")i={x:r.coords.start.page.x,y:r.coords.start.page.y};else{var S=at(w.offset,s,p,[r]);(i=De(S)||{x:0,y:0}).x+=T.x,i.y+=T.y}var P=w.relativePoints;y.offsets=h&&P&&P.length?P.map((function(q,Y){return{index:Y,relativePoint:q,x:x.left-h.width*q.x+i.x,y:x.top-h.height*q.y+i.y}})):[{index:0,relativePoint:null,x:i.x,y:i.y}]},set:function(n){var i=n.interaction,r=n.coords,s=n.state,p=s.options,h=s.offsets,y=Ae(i.interactable,i.element,i.prepared.name),x=oe({},r),w=[];p.offsetWithOrigin||(x.x-=y.x,x.y-=y.y);for(var T=0,S=h;T<S.length;T++)for(var P=S[T],q=x.x-P.x,Y=x.y-P.y,$=0,Q=p.targets.length;$<Q;$++){var he=p.targets[$],ue=void 0;(ue=b.func(he)?he(q,Y,i._proxy,P,$):he)&&w.push({x:(b.number(ue.x)?ue.x:q)+P.x,y:(b.number(ue.y)?ue.y:Y)+P.y,range:b.number(ue.range)?ue.range:p.range,source:he,index:$,offset:P})}for(var be={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},Pe=0;Pe<w.length;Pe++){var qe=w[Pe],Se=qe.range,Ie=qe.x-x.x,vt=qe.y-x.y,Ze=lt(Ie,vt),St=Ze<=Se;Se===1/0&&be.inRange&&be.range!==1/0&&(St=!1),be.target&&!(St?be.inRange&&Se!==1/0?Ze/Se<be.distance/be.range:Se===1/0&&be.range!==1/0||Ze<be.distance:!be.inRange&&Ze<be.distance)||(be.target=qe,be.distance=Ze,be.range=Se,be.inRange=St,be.delta.x=Ie,be.delta.y=vt)}return be.inRange&&(r.x=be.target.x,r.y=be.target.y),s.closest=be,be},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},ya=Lt(Ti,"snap"),pi={start:function(n){var i=n.state,r=n.edges,s=i.options;if(!r)return null;n.state={options:{targets:null,relativePoints:[{x:r.left?0:1,y:r.top?0:1}],offset:s.offset||"self",origin:{x:0,y:0},range:s.range}},i.targetFields=i.targetFields||[["width","height"],["x","y"]],Ti.start(n),i.offsets=n.state.offsets,n.state=i},set:function(n){var i=n.interaction,r=n.state,s=n.coords,p=r.options,h=r.offsets,y={x:s.x-h[0].x,y:s.y-h[0].y};r.options=oe({},p),r.options.targets=[];for(var x=0,w=p.targets||[];x<w.length;x++){var T=w[x],S=void 0;if(S=b.func(T)?T(y.x,y.y,i):T){for(var P=0,q=r.targetFields;P<q.length;P++){var Y=q[P],$=Y[0],Q=Y[1];if($ in S||Q in S){S.x=S[$],S.y=S[Q];break}}r.options.targets.push(S)}}var he=Ti.set(n);return r.options=p,he},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},va=Lt(pi,"snapSize"),Oi={aspectRatio:la,restrictEdges:pa,restrict:da,restrictRect:ha,restrictSize:ma,snapEdges:Lt({start:function(n){var i=n.edges;return i?(n.state.targetFields=n.state.targetFields||[[i.left?"left":"right",i.top?"top":"bottom"]],pi.start(n)):null},set:pi.set,defaults:oe(jt(pi.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:ya,snapSize:va,spring:li,avoid:li,transform:li,rubberband:li},ba={id:"modifiers",install:function(n){var i=n.interactStatic;for(var r in n.usePlugin(tn),n.usePlugin(aa),i.modifiers=Oi,Oi){var s=Oi[r],p=s._defaults,h=s._methods;p._methods=h,n.defaults.perAction[r]=p}}},xa=ba,_n=(function(n){d(r,n);var i=_(r);function r(s,p,h,y,x,w){var T;if(a(this,r),xt(m(T=i.call(this,x)),h),h!==p&&xt(m(T),p),T.timeStamp=w,T.originalEvent=h,T.type=s,T.pointerId=W(p),T.pointerType=D(p),T.target=y,T.currentTarget=null,s==="tap"){var S=x.getPointerIndex(p);T.dt=T.timeStamp-x.pointers[S].downTime;var P=T.timeStamp-x.tapTime;T.double=!!x.prevTap&&x.prevTap.type!=="doubletap"&&x.prevTap.target===T.target&&P<500}else s==="doubletap"&&(T.dt=p.timeStamp-x.tapTime,T.double=!0);return T}return l(r,[{key:"_subtractOrigin",value:function(s){var p=s.x,h=s.y;return this.pageX-=p,this.pageY-=h,this.clientX-=p,this.clientY-=h,this}},{key:"_addOrigin",value:function(s){var p=s.x,h=s.y;return this.pageX+=p,this.pageY+=h,this.clientX+=p,this.clientY+=h,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),r})(ne),Xt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(n){n.pointerEvents=Xt,n.defaults.actions.pointerEvents=Xt.defaults,oe(n.actions.phaselessTypes,Xt.types)},listeners:{"interactions:new":function(n){var i=n.interaction;i.prevTap=null,i.tapTime=0},"interactions:update-pointer":function(n){var i=n.down,r=n.pointerInfo;!i&&r.hold||(r.hold={duration:1/0,timeout:null})},"interactions:move":function(n,i){var r=n.interaction,s=n.pointer,p=n.event,h=n.eventTarget;n.duplicate||r.pointerIsDown&&!r.pointerWasMoved||(r.pointerIsDown&&Li(n),Pt({interaction:r,pointer:s,event:p,eventTarget:h,type:"move"},i))},"interactions:down":function(n,i){(function(r,s){for(var p=r.interaction,h=r.pointer,y=r.event,x=r.eventTarget,w=r.pointerIndex,T=p.pointers[w].hold,S=pt(x),P={interaction:p,pointer:h,event:y,eventTarget:x,type:"hold",targets:[],path:S,node:null},q=0;q<S.length;q++){var Y=S[q];P.node=Y,s.fire("pointerEvents:collect-targets",P)}if(P.targets.length){for(var $=1/0,Q=0,he=P.targets;Q<he.length;Q++){var ue=he[Q].eventable.options.holdDuration;ue<$&&($=ue)}T.duration=$,T.timeout=setTimeout((function(){Pt({interaction:p,eventTarget:x,pointer:h,event:y,type:"hold"},s)}),$)}})(n,i),Pt(n,i)},"interactions:up":function(n,i){Li(n),Pt(n,i),(function(r,s){var p=r.interaction,h=r.pointer,y=r.event,x=r.eventTarget;p.pointerWasMoved||Pt({interaction:p,eventTarget:x,pointer:h,event:y,type:"tap"},s)})(n,i)},"interactions:cancel":function(n,i){Li(n),Pt(n,i)}},PointerEvent:_n,fire:Pt,collectEventTargets:wn,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function Pt(n,i){var r=n.interaction,s=n.pointer,p=n.event,h=n.eventTarget,y=n.type,x=n.targets,w=x===void 0?wn(n,i):x,T=new _n(y,s,p,h,r,i.now());i.fire("pointerEvents:new",{pointerEvent:T});for(var S={interaction:r,pointer:s,event:p,eventTarget:h,targets:w,type:y,pointerEvent:T},P=0;P<w.length;P++){var q=w[P];for(var Y in q.props||{})T[Y]=q.props[Y];var $=Ae(q.eventable,q.node);if(T._subtractOrigin($),T.eventable=q.eventable,T.currentTarget=q.node,q.eventable.fire(T),T._addOrigin($),T.immediatePropagationStopped||T.propagationStopped&&P+1<w.length&&w[P+1].node!==T.currentTarget)break}if(i.fire("pointerEvents:fired",S),y==="tap"){var Q=T.double?Pt({interaction:r,pointer:s,event:p,eventTarget:h,type:"doubletap"},i):T;r.prevTap=Q,r.tapTime=Q.timeStamp}return T}function wn(n,i){var r=n.interaction,s=n.pointer,p=n.event,h=n.eventTarget,y=n.type,x=r.getPointerIndex(s),w=r.pointers[x];if(y==="tap"&&(r.pointerWasMoved||!w||w.downTarget!==h))return[];for(var T=pt(h),S={interaction:r,pointer:s,event:p,eventTarget:h,type:y,path:T,targets:[],node:null},P=0;P<T.length;P++){var q=T[P];S.node=q,i.fire("pointerEvents:collect-targets",S)}return y==="hold"&&(S.targets=S.targets.filter((function(Y){var $,Q;return Y.eventable.options.holdDuration===(($=r.pointers[x])==null||(Q=$.hold)==null?void 0:Q.duration)}))),S.targets}function Li(n){var i=n.interaction,r=n.pointerIndex,s=i.pointers[r].hold;s&&s.timeout&&(clearTimeout(s.timeout),s.timeout=null)}var _a=Object.freeze({__proto__:null,default:Xt});function wa(n){var i=n.interaction;i.holdIntervalHandle&&(clearInterval(i.holdIntervalHandle),i.holdIntervalHandle=null)}var ka={id:"pointer-events/holdRepeat",install:function(n){n.usePlugin(Xt);var i=n.pointerEvents;i.defaults.holdRepeatInterval=0,i.types.holdrepeat=n.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(n,i){return n["pointerEvents:".concat(i)]=wa,n}),{"pointerEvents:new":function(n){var i=n.pointerEvent;i.type==="hold"&&(i.count=(i.count||0)+1)},"pointerEvents:fired":function(n,i){var r=n.interaction,s=n.pointerEvent,p=n.eventTarget,h=n.targets;if(s.type==="hold"&&h.length){var y=h[0].eventable.options.holdRepeatInterval;y<=0||(r.holdIntervalHandle=setTimeout((function(){i.pointerEvents.fire({interaction:r,eventTarget:p,type:"hold",pointer:s,event:s},i)}),y))}}})},Sa=ka,Ea={id:"pointer-events/interactableTargets",install:function(n){var i=n.Interactable;i.prototype.pointerEvents=function(s){return oe(this.events.options,s),this};var r=i.prototype._backCompatOption;i.prototype._backCompatOption=function(s,p){var h=r.call(this,s,p);return h===this&&(this.events.options[s]=p),h}},listeners:{"pointerEvents:collect-targets":function(n,i){var r=n.targets,s=n.node,p=n.type,h=n.eventTarget;i.interactables.forEachMatch(s,(function(y){var x=y.events,w=x.options;x.types[p]&&x.types[p].length&&y.testIgnoreAllow(w,s,h)&&r.push({node:s,eventable:x,props:{interactable:y}})}))},"interactable:new":function(n){var i=n.interactable;i.events.getRect=function(r){return i.getRect(r)}},"interactable:set":function(n,i){var r=n.interactable,s=n.options;oe(r.events.options,i.pointerEvents.defaults),oe(r.events.options,s.pointerEvents||{})}}},Ca=Ea,Aa={id:"pointer-events",install:function(n){n.usePlugin(_a),n.usePlugin(Sa),n.usePlugin(Ca)}},Ta=Aa,Oa={id:"reflow",install:function(n){var i=n.Interactable;n.actions.phases.reflow=!0,i.prototype.reflow=function(r){return(function(s,p,h){for(var y=s.getAllElements(),x=h.window.Promise,w=x?[]:null,T=function(){var P=y[S],q=s.getRect(P);if(!q)return 1;var Y,$=N(h.interactions.list,(function(ue){return ue.interacting()&&ue.interactable===s&&ue.element===P&&ue.prepared.name===p.name}));if($)$.move(),w&&(Y=$._reflowPromise||new x((function(ue){$._reflowResolve=ue})));else{var Q=re(q),he=(function(ue){return{coords:ue,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:Q.x,y:Q.y},client:{x:Q.x,y:Q.y},timeStamp:h.now()});Y=(function(ue,be,Pe,qe,Se){var Ie=ue.interactions.new({pointerType:"reflow"}),vt={interaction:Ie,event:Se,pointer:Se,eventTarget:Pe,phase:"reflow"};Ie.interactable=be,Ie.element=Pe,Ie.prevEvent=Se,Ie.updatePointer(Se,Se,Pe,!0),Ke(Ie.coords.delta),Ht(Ie.prepared,qe),Ie._doPhase(vt);var Ze=ue.window,St=Ze.Promise,Ct=St?new St((function(Tt){Ie._reflowResolve=Tt})):void 0;return Ie._reflowPromise=Ct,Ie.start(qe,be,Pe),Ie._interacting?(Ie.move(vt),Ie.end(Se)):(Ie.stop(),Ie._reflowResolve()),Ie.removePointer(Se,Se),Ct})(h,s,P,p,he)}w&&w.push(Y)},S=0;S<y.length&&!T();S++);return w&&x.all(w).then((function(){return s}))})(this,r,n)}},listeners:{"interactions:stop":function(n,i){var r=n.interaction;r.pointerType==="reflow"&&(r._reflowResolve&&r._reflowResolve(),(function(s,p){s.splice(s.indexOf(p),1)})(i.interactions.list,r))}}},La=Oa;if(yt.use(en),yt.use(sn),yt.use(Ta),yt.use(Ur),yt.use(xa),yt.use(Dr),yt.use(ae),yt.use(ut),yt.use(La),yt.default=yt,(typeof Bt=="undefined"?"undefined":t(Bt))==="object"&&Bt)try{Bt.exports=yt}catch{}return yt.default=yt,yt}))});var Tr=Na(Sn(),1);function qn(e){return typeof e=="undefined"||e===null}function qa(e){return typeof e=="object"&&e!==null}function Ha(e){return Array.isArray(e)?e:qn(e)?[]:[e]}function ja(e,u){var t,a,o,l;if(u)for(l=Object.keys(u),t=0,a=l.length;t<a;t+=1)o=l[t],e[o]=u[o];return e}function Ka(e,u){var t="",a;for(a=0;a<u;a+=1)t+=e;return t}function $a(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Wa=qn,Ya=qa,Ua=Ha,Va=Ka,Ga=$a,Xa=ja,dt={isNothing:Wa,isObject:Ya,toArray:Ua,repeat:Va,isNegativeZero:Ga,extend:Xa};function Hn(e,u){var t="",a=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(t+='in "'+e.mark.name+'" '),t+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!u&&e.mark.snippet&&(t+=`

`+e.mark.snippet),a+" "+t):a}function Zt(e,u){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=u,this.message=Hn(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Zt.prototype=Object.create(Error.prototype);Zt.prototype.constructor=Zt;Zt.prototype.toString=function(u){return this.name+": "+Hn(this,u)};var bt=Zt;function Mi(e,u,t,a,o){var l="",c="",d=Math.floor(o/2)-1;return a-u>d&&(l=" ... ",u=a-d+l.length),t-a>d&&(c=" ...",t=a+d-c.length),{str:l+e.slice(u,t).replace(/\t/g,"\u2192")+c,pos:a-u+l.length}}function Ii(e,u){return dt.repeat(" ",u-e.length)+e}function Ja(e,u){if(u=Object.create(u||null),!e.buffer)return null;u.maxLength||(u.maxLength=79),typeof u.indent!="number"&&(u.indent=1),typeof u.linesBefore!="number"&&(u.linesBefore=3),typeof u.linesAfter!="number"&&(u.linesAfter=2);for(var t=/\r?\n|\r|\0/g,a=[0],o=[],l,c=-1;l=t.exec(e.buffer);)o.push(l.index),a.push(l.index+l[0].length),e.position<=l.index&&c<0&&(c=a.length-2);c<0&&(c=a.length-1);var d="",f,v,m=Math.min(e.line+u.linesAfter,o.length).toString().length,_=u.maxLength-(u.indent+m+3);for(f=1;f<=u.linesBefore&&!(c-f<0);f++)v=Mi(e.buffer,a[c-f],o[c-f],e.position-(a[c]-a[c-f]),_),d=dt.repeat(" ",u.indent)+Ii((e.line-f+1).toString(),m)+" | "+v.str+`
`+d;for(v=Mi(e.buffer,a[c],o[c],e.position,_),d+=dt.repeat(" ",u.indent)+Ii((e.line+1).toString(),m)+" | "+v.str+`
`,d+=dt.repeat("-",u.indent+m+3+v.pos)+`^
`,f=1;f<=u.linesAfter&&!(c+f>=o.length);f++)v=Mi(e.buffer,a[c+f],o[c+f],e.position-(a[c]-a[c+f]),_),d+=dt.repeat(" ",u.indent)+Ii((e.line+f+1).toString(),m)+" | "+v.str+`
`;return d.replace(/\n$/,"")}var Qa=Ja,Za=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],eo=["scalar","sequence","mapping"];function to(e){var u={};return e!==null&&Object.keys(e).forEach(function(t){e[t].forEach(function(a){u[String(a)]=t})}),u}function io(e,u){if(u=u||{},Object.keys(u).forEach(function(t){if(Za.indexOf(t)===-1)throw new bt('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.options=u,this.tag=e,this.kind=u.kind||null,this.resolve=u.resolve||function(){return!0},this.construct=u.construct||function(t){return t},this.instanceOf=u.instanceOf||null,this.predicate=u.predicate||null,this.represent=u.represent||null,this.representName=u.representName||null,this.defaultStyle=u.defaultStyle||null,this.multi=u.multi||!1,this.styleAliases=to(u.styleAliases||null),eo.indexOf(this.kind)===-1)throw new bt('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var ht=io;function En(e,u){var t=[];return e[u].forEach(function(a){var o=t.length;t.forEach(function(l,c){l.tag===a.tag&&l.kind===a.kind&&l.multi===a.multi&&(o=c)}),t[o]=a}),t}function no(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},u,t;function a(o){o.multi?(e.multi[o.kind].push(o),e.multi.fallback.push(o)):e[o.kind][o.tag]=e.fallback[o.tag]=o}for(u=0,t=arguments.length;u<t;u+=1)arguments[u].forEach(a);return e}function Ri(e){return this.extend(e)}Ri.prototype.extend=function(u){var t=[],a=[];if(u instanceof ht)a.push(u);else if(Array.isArray(u))a=a.concat(u);else if(u&&(Array.isArray(u.implicit)||Array.isArray(u.explicit)))u.implicit&&(t=t.concat(u.implicit)),u.explicit&&(a=a.concat(u.explicit));else throw new bt("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(l){if(!(l instanceof ht))throw new bt("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(l.loadKind&&l.loadKind!=="scalar")throw new bt("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(l.multi)throw new bt("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),a.forEach(function(l){if(!(l instanceof ht))throw new bt("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var o=Object.create(Ri.prototype);return o.implicit=(this.implicit||[]).concat(t),o.explicit=(this.explicit||[]).concat(a),o.compiledImplicit=En(o,"implicit"),o.compiledExplicit=En(o,"explicit"),o.compiledTypeMap=no(o.compiledImplicit,o.compiledExplicit),o};var jn=Ri,Kn=new ht("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),$n=new ht("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Wn=new ht("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Yn=new jn({explicit:[Kn,$n,Wn]});function ro(e){if(e===null)return!0;var u=e.length;return u===1&&e==="~"||u===4&&(e==="null"||e==="Null"||e==="NULL")}function ao(){return null}function oo(e){return e===null}var Un=new ht("tag:yaml.org,2002:null",{kind:"scalar",resolve:ro,construct:ao,predicate:oo,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function so(e){if(e===null)return!1;var u=e.length;return u===4&&(e==="true"||e==="True"||e==="TRUE")||u===5&&(e==="false"||e==="False"||e==="FALSE")}function co(e){return e==="true"||e==="True"||e==="TRUE"}function lo(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Vn=new ht("tag:yaml.org,2002:bool",{kind:"scalar",resolve:so,construct:co,predicate:lo,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function po(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function uo(e){return 48<=e&&e<=55}function ho(e){return 48<=e&&e<=57}function fo(e){if(e===null)return!1;var u=e.length,t=0,a=!1,o;if(!u)return!1;if(o=e[t],(o==="-"||o==="+")&&(o=e[++t]),o==="0"){if(t+1===u)return!0;if(o=e[++t],o==="b"){for(t++;t<u;t++)if(o=e[t],o!=="_"){if(o!=="0"&&o!=="1")return!1;a=!0}return a&&o!=="_"}if(o==="x"){for(t++;t<u;t++)if(o=e[t],o!=="_"){if(!po(e.charCodeAt(t)))return!1;a=!0}return a&&o!=="_"}if(o==="o"){for(t++;t<u;t++)if(o=e[t],o!=="_"){if(!uo(e.charCodeAt(t)))return!1;a=!0}return a&&o!=="_"}}if(o==="_")return!1;for(;t<u;t++)if(o=e[t],o!=="_"){if(!ho(e.charCodeAt(t)))return!1;a=!0}return!(!a||o==="_")}function go(e){var u=e,t=1,a;if(u.indexOf("_")!==-1&&(u=u.replace(/_/g,"")),a=u[0],(a==="-"||a==="+")&&(a==="-"&&(t=-1),u=u.slice(1),a=u[0]),u==="0")return 0;if(a==="0"){if(u[1]==="b")return t*parseInt(u.slice(2),2);if(u[1]==="x")return t*parseInt(u.slice(2),16);if(u[1]==="o")return t*parseInt(u.slice(2),8)}return t*parseInt(u,10)}function mo(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!dt.isNegativeZero(e)}var Gn=new ht("tag:yaml.org,2002:int",{kind:"scalar",resolve:fo,construct:go,predicate:mo,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),yo=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function vo(e){return!(e===null||!yo.test(e)||e[e.length-1]==="_")}function bo(e){var u,t;return u=e.replace(/_/g,"").toLowerCase(),t=u[0]==="-"?-1:1,"+-".indexOf(u[0])>=0&&(u=u.slice(1)),u===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:u===".nan"?NaN:t*parseFloat(u,10)}var xo=/^[-+]?[0-9]+e/;function _o(e,u){var t;if(isNaN(e))switch(u){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(u){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(u){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(dt.isNegativeZero(e))return"-0.0";return t=e.toString(10),xo.test(t)?t.replace("e",".e"):t}function wo(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||dt.isNegativeZero(e))}var Xn=new ht("tag:yaml.org,2002:float",{kind:"scalar",resolve:vo,construct:bo,predicate:wo,represent:_o,defaultStyle:"lowercase"}),Jn=Yn.extend({implicit:[Un,Vn,Gn,Xn]}),Qn=Jn,Zn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),er=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function ko(e){return e===null?!1:Zn.exec(e)!==null||er.exec(e)!==null}function So(e){var u,t,a,o,l,c,d,f=0,v=null,m,_,g;if(u=Zn.exec(e),u===null&&(u=er.exec(e)),u===null)throw new Error("Date resolve error");if(t=+u[1],a=+u[2]-1,o=+u[3],!u[4])return new Date(Date.UTC(t,a,o));if(l=+u[4],c=+u[5],d=+u[6],u[7]){for(f=u[7].slice(0,3);f.length<3;)f+="0";f=+f}return u[9]&&(m=+u[10],_=+(u[11]||0),v=(m*60+_)*6e4,u[9]==="-"&&(v=-v)),g=new Date(Date.UTC(t,a,o,l,c,d,f)),v&&g.setTime(g.getTime()-v),g}function Eo(e){return e.toISOString()}var tr=new ht("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:ko,construct:So,instanceOf:Date,represent:Eo});function Co(e){return e==="<<"||e===null}var ir=new ht("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Co}),Hi=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Ao(e){if(e===null)return!1;var u,t,a=0,o=e.length,l=Hi;for(t=0;t<o;t++)if(u=l.indexOf(e.charAt(t)),!(u>64)){if(u<0)return!1;a+=6}return a%8===0}function To(e){var u,t,a=e.replace(/[\r\n=]/g,""),o=a.length,l=Hi,c=0,d=[];for(u=0;u<o;u++)u%4===0&&u&&(d.push(c>>16&255),d.push(c>>8&255),d.push(c&255)),c=c<<6|l.indexOf(a.charAt(u));return t=o%4*6,t===0?(d.push(c>>16&255),d.push(c>>8&255),d.push(c&255)):t===18?(d.push(c>>10&255),d.push(c>>2&255)):t===12&&d.push(c>>4&255),new Uint8Array(d)}function Oo(e){var u="",t=0,a,o,l=e.length,c=Hi;for(a=0;a<l;a++)a%3===0&&a&&(u+=c[t>>18&63],u+=c[t>>12&63],u+=c[t>>6&63],u+=c[t&63]),t=(t<<8)+e[a];return o=l%3,o===0?(u+=c[t>>18&63],u+=c[t>>12&63],u+=c[t>>6&63],u+=c[t&63]):o===2?(u+=c[t>>10&63],u+=c[t>>4&63],u+=c[t<<2&63],u+=c[64]):o===1&&(u+=c[t>>2&63],u+=c[t<<4&63],u+=c[64],u+=c[64]),u}function Lo(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var nr=new ht("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Ao,construct:To,predicate:Lo,represent:Oo}),zo=Object.prototype.hasOwnProperty,Po=Object.prototype.toString;function Mo(e){if(e===null)return!0;var u=[],t,a,o,l,c,d=e;for(t=0,a=d.length;t<a;t+=1){if(o=d[t],c=!1,Po.call(o)!=="[object Object]")return!1;for(l in o)if(zo.call(o,l))if(!c)c=!0;else return!1;if(!c)return!1;if(u.indexOf(l)===-1)u.push(l);else return!1}return!0}function Io(e){return e!==null?e:[]}var rr=new ht("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Mo,construct:Io}),Do=Object.prototype.toString;function Ro(e){if(e===null)return!0;var u,t,a,o,l,c=e;for(l=new Array(c.length),u=0,t=c.length;u<t;u+=1){if(a=c[u],Do.call(a)!=="[object Object]"||(o=Object.keys(a),o.length!==1))return!1;l[u]=[o[0],a[o[0]]]}return!0}function Fo(e){if(e===null)return[];var u,t,a,o,l,c=e;for(l=new Array(c.length),u=0,t=c.length;u<t;u+=1)a=c[u],o=Object.keys(a),l[u]=[o[0],a[o[0]]];return l}var ar=new ht("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Ro,construct:Fo}),Bo=Object.prototype.hasOwnProperty;function No(e){if(e===null)return!0;var u,t=e;for(u in t)if(Bo.call(t,u)&&t[u]!==null)return!1;return!0}function qo(e){return e!==null?e:{}}var or=new ht("tag:yaml.org,2002:set",{kind:"mapping",resolve:No,construct:qo}),ji=Qn.extend({implicit:[tr,ir],explicit:[nr,rr,ar,or]}),It=Object.prototype.hasOwnProperty,hi=1,sr=2,cr=3,fi=4,Di=1,Ho=2,Cn=3,jo=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ko=/[\x85\u2028\u2029]/,$o=/[,\[\]\{\}]/,lr=/^(?:!|!!|![a-z\-]+!)$/i,dr=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function An(e){return Object.prototype.toString.call(e)}function At(e){return e===10||e===13}function qt(e){return e===9||e===32}function wt(e){return e===9||e===32||e===10||e===13}function $t(e){return e===44||e===91||e===93||e===123||e===125}function Wo(e){var u;return 48<=e&&e<=57?e-48:(u=e|32,97<=u&&u<=102?u-97+10:-1)}function Yo(e){return e===120?2:e===117?4:e===85?8:0}function Uo(e){return 48<=e&&e<=57?e-48:-1}function Tn(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Vo(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var pr=new Array(256),ur=new Array(256);for(Nt=0;Nt<256;Nt++)pr[Nt]=Tn(Nt)?1:0,ur[Nt]=Tn(Nt);var Nt;function Go(e,u){this.input=e,this.filename=u.filename||null,this.schema=u.schema||ji,this.onWarning=u.onWarning||null,this.legacy=u.legacy||!1,this.json=u.json||!1,this.listener=u.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function hr(e,u){var t={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return t.snippet=Qa(t),new bt(u,t)}function xe(e,u){throw hr(e,u)}function gi(e,u){e.onWarning&&e.onWarning.call(null,hr(e,u))}var On={YAML:function(u,t,a){var o,l,c;u.version!==null&&xe(u,"duplication of %YAML directive"),a.length!==1&&xe(u,"YAML directive accepts exactly one argument"),o=/^([0-9]+)\.([0-9]+)$/.exec(a[0]),o===null&&xe(u,"ill-formed argument of the YAML directive"),l=parseInt(o[1],10),c=parseInt(o[2],10),l!==1&&xe(u,"unacceptable YAML version of the document"),u.version=a[0],u.checkLineBreaks=c<2,c!==1&&c!==2&&gi(u,"unsupported YAML version of the document")},TAG:function(u,t,a){var o,l;a.length!==2&&xe(u,"TAG directive accepts exactly two arguments"),o=a[0],l=a[1],lr.test(o)||xe(u,"ill-formed tag handle (first argument) of the TAG directive"),It.call(u.tagMap,o)&&xe(u,'there is a previously declared suffix for "'+o+'" tag handle'),dr.test(l)||xe(u,"ill-formed tag prefix (second argument) of the TAG directive");try{l=decodeURIComponent(l)}catch{xe(u,"tag prefix is malformed: "+l)}u.tagMap[o]=l}};function Mt(e,u,t,a){var o,l,c,d;if(u<t){if(d=e.input.slice(u,t),a)for(o=0,l=d.length;o<l;o+=1)c=d.charCodeAt(o),c===9||32<=c&&c<=1114111||xe(e,"expected valid JSON character");else jo.test(d)&&xe(e,"the stream contains non-printable characters");e.result+=d}}function Ln(e,u,t,a){var o,l,c,d;for(dt.isObject(t)||xe(e,"cannot merge mappings; the provided source object is unacceptable"),o=Object.keys(t),c=0,d=o.length;c<d;c+=1)l=o[c],It.call(u,l)||(u[l]=t[l],a[l]=!0)}function Wt(e,u,t,a,o,l,c,d,f){var v,m;if(Array.isArray(o))for(o=Array.prototype.slice.call(o),v=0,m=o.length;v<m;v+=1)Array.isArray(o[v])&&xe(e,"nested arrays are not supported inside keys"),typeof o=="object"&&An(o[v])==="[object Object]"&&(o[v]="[object Object]");if(typeof o=="object"&&An(o)==="[object Object]"&&(o="[object Object]"),o=String(o),u===null&&(u={}),a==="tag:yaml.org,2002:merge")if(Array.isArray(l))for(v=0,m=l.length;v<m;v+=1)Ln(e,u,l[v],t);else Ln(e,u,l,t);else!e.json&&!It.call(t,o)&&It.call(u,o)&&(e.line=c||e.line,e.lineStart=d||e.lineStart,e.position=f||e.position,xe(e,"duplicated mapping key")),o==="__proto__"?Object.defineProperty(u,o,{configurable:!0,enumerable:!0,writable:!0,value:l}):u[o]=l,delete t[o];return u}function Ki(e){var u;u=e.input.charCodeAt(e.position),u===10?e.position++:u===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):xe(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function st(e,u,t){for(var a=0,o=e.input.charCodeAt(e.position);o!==0;){for(;qt(o);)o===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),o=e.input.charCodeAt(++e.position);if(u&&o===35)do o=e.input.charCodeAt(++e.position);while(o!==10&&o!==13&&o!==0);if(At(o))for(Ki(e),o=e.input.charCodeAt(e.position),a++,e.lineIndent=0;o===32;)e.lineIndent++,o=e.input.charCodeAt(++e.position);else break}return t!==-1&&a!==0&&e.lineIndent<t&&gi(e,"deficient indentation"),a}function vi(e){var u=e.position,t;return t=e.input.charCodeAt(u),!!((t===45||t===46)&&t===e.input.charCodeAt(u+1)&&t===e.input.charCodeAt(u+2)&&(u+=3,t=e.input.charCodeAt(u),t===0||wt(t)))}function $i(e,u){u===1?e.result+=" ":u>1&&(e.result+=dt.repeat(`
`,u-1))}function Xo(e,u,t){var a,o,l,c,d,f,v,m,_=e.kind,g=e.result,k;if(k=e.input.charCodeAt(e.position),wt(k)||$t(k)||k===35||k===38||k===42||k===33||k===124||k===62||k===39||k===34||k===37||k===64||k===96||(k===63||k===45)&&(o=e.input.charCodeAt(e.position+1),wt(o)||t&&$t(o)))return!1;for(e.kind="scalar",e.result="",l=c=e.position,d=!1;k!==0;){if(k===58){if(o=e.input.charCodeAt(e.position+1),wt(o)||t&&$t(o))break}else if(k===35){if(a=e.input.charCodeAt(e.position-1),wt(a))break}else{if(e.position===e.lineStart&&vi(e)||t&&$t(k))break;if(At(k))if(f=e.line,v=e.lineStart,m=e.lineIndent,st(e,!1,-1),e.lineIndent>=u){d=!0,k=e.input.charCodeAt(e.position);continue}else{e.position=c,e.line=f,e.lineStart=v,e.lineIndent=m;break}}d&&(Mt(e,l,c,!1),$i(e,e.line-f),l=c=e.position,d=!1),qt(k)||(c=e.position+1),k=e.input.charCodeAt(++e.position)}return Mt(e,l,c,!1),e.result?!0:(e.kind=_,e.result=g,!1)}function Jo(e,u){var t,a,o;if(t=e.input.charCodeAt(e.position),t!==39)return!1;for(e.kind="scalar",e.result="",e.position++,a=o=e.position;(t=e.input.charCodeAt(e.position))!==0;)if(t===39)if(Mt(e,a,e.position,!0),t=e.input.charCodeAt(++e.position),t===39)a=e.position,e.position++,o=e.position;else return!0;else At(t)?(Mt(e,a,o,!0),$i(e,st(e,!1,u)),a=o=e.position):e.position===e.lineStart&&vi(e)?xe(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);xe(e,"unexpected end of the stream within a single quoted scalar")}function Qo(e,u){var t,a,o,l,c,d;if(d=e.input.charCodeAt(e.position),d!==34)return!1;for(e.kind="scalar",e.result="",e.position++,t=a=e.position;(d=e.input.charCodeAt(e.position))!==0;){if(d===34)return Mt(e,t,e.position,!0),e.position++,!0;if(d===92){if(Mt(e,t,e.position,!0),d=e.input.charCodeAt(++e.position),At(d))st(e,!1,u);else if(d<256&&pr[d])e.result+=ur[d],e.position++;else if((c=Yo(d))>0){for(o=c,l=0;o>0;o--)d=e.input.charCodeAt(++e.position),(c=Wo(d))>=0?l=(l<<4)+c:xe(e,"expected hexadecimal character");e.result+=Vo(l),e.position++}else xe(e,"unknown escape sequence");t=a=e.position}else At(d)?(Mt(e,t,a,!0),$i(e,st(e,!1,u)),t=a=e.position):e.position===e.lineStart&&vi(e)?xe(e,"unexpected end of the document within a double quoted scalar"):(e.position++,a=e.position)}xe(e,"unexpected end of the stream within a double quoted scalar")}function Zo(e,u){var t=!0,a,o,l,c=e.tag,d,f=e.anchor,v,m,_,g,k,z=Object.create(null),E,L,I,C;if(C=e.input.charCodeAt(e.position),C===91)m=93,k=!1,d=[];else if(C===123)m=125,k=!0,d={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=d),C=e.input.charCodeAt(++e.position);C!==0;){if(st(e,!0,u),C=e.input.charCodeAt(e.position),C===m)return e.position++,e.tag=c,e.anchor=f,e.kind=k?"mapping":"sequence",e.result=d,!0;t?C===44&&xe(e,"expected the node content, but found ','"):xe(e,"missed comma between flow collection entries"),L=E=I=null,_=g=!1,C===63&&(v=e.input.charCodeAt(e.position+1),wt(v)&&(_=g=!0,e.position++,st(e,!0,u))),a=e.line,o=e.lineStart,l=e.position,Yt(e,u,hi,!1,!0),L=e.tag,E=e.result,st(e,!0,u),C=e.input.charCodeAt(e.position),(g||e.line===a)&&C===58&&(_=!0,C=e.input.charCodeAt(++e.position),st(e,!0,u),Yt(e,u,hi,!1,!0),I=e.result),k?Wt(e,d,z,L,E,I,a,o,l):_?d.push(Wt(e,null,z,L,E,I,a,o,l)):d.push(E),st(e,!0,u),C=e.input.charCodeAt(e.position),C===44?(t=!0,C=e.input.charCodeAt(++e.position)):t=!1}xe(e,"unexpected end of the stream within a flow collection")}function es(e,u){var t,a,o=Di,l=!1,c=!1,d=u,f=0,v=!1,m,_;if(_=e.input.charCodeAt(e.position),_===124)a=!1;else if(_===62)a=!0;else return!1;for(e.kind="scalar",e.result="";_!==0;)if(_=e.input.charCodeAt(++e.position),_===43||_===45)Di===o?o=_===43?Cn:Ho:xe(e,"repeat of a chomping mode identifier");else if((m=Uo(_))>=0)m===0?xe(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):c?xe(e,"repeat of an indentation width identifier"):(d=u+m-1,c=!0);else break;if(qt(_)){do _=e.input.charCodeAt(++e.position);while(qt(_));if(_===35)do _=e.input.charCodeAt(++e.position);while(!At(_)&&_!==0)}for(;_!==0;){for(Ki(e),e.lineIndent=0,_=e.input.charCodeAt(e.position);(!c||e.lineIndent<d)&&_===32;)e.lineIndent++,_=e.input.charCodeAt(++e.position);if(!c&&e.lineIndent>d&&(d=e.lineIndent),At(_)){f++;continue}if(e.lineIndent<d){o===Cn?e.result+=dt.repeat(`
`,l?1+f:f):o===Di&&l&&(e.result+=`
`);break}for(a?qt(_)?(v=!0,e.result+=dt.repeat(`
`,l?1+f:f)):v?(v=!1,e.result+=dt.repeat(`
`,f+1)):f===0?l&&(e.result+=" "):e.result+=dt.repeat(`
`,f):e.result+=dt.repeat(`
`,l?1+f:f),l=!0,c=!0,f=0,t=e.position;!At(_)&&_!==0;)_=e.input.charCodeAt(++e.position);Mt(e,t,e.position,!1)}return!0}function zn(e,u){var t,a=e.tag,o=e.anchor,l=[],c,d=!1,f;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=l),f=e.input.charCodeAt(e.position);f!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,xe(e,"tab characters must not be used in indentation")),!(f!==45||(c=e.input.charCodeAt(e.position+1),!wt(c))));){if(d=!0,e.position++,st(e,!0,-1)&&e.lineIndent<=u){l.push(null),f=e.input.charCodeAt(e.position);continue}if(t=e.line,Yt(e,u,cr,!1,!0),l.push(e.result),st(e,!0,-1),f=e.input.charCodeAt(e.position),(e.line===t||e.lineIndent>u)&&f!==0)xe(e,"bad indentation of a sequence entry");else if(e.lineIndent<u)break}return d?(e.tag=a,e.anchor=o,e.kind="sequence",e.result=l,!0):!1}function ts(e,u,t){var a,o,l,c,d,f,v=e.tag,m=e.anchor,_={},g=Object.create(null),k=null,z=null,E=null,L=!1,I=!1,C;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=_),C=e.input.charCodeAt(e.position);C!==0;){if(!L&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,xe(e,"tab characters must not be used in indentation")),a=e.input.charCodeAt(e.position+1),l=e.line,(C===63||C===58)&&wt(a))C===63?(L&&(Wt(e,_,g,k,z,null,c,d,f),k=z=E=null),I=!0,L=!0,o=!0):L?(L=!1,o=!0):xe(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,C=a;else{if(c=e.line,d=e.lineStart,f=e.position,!Yt(e,t,sr,!1,!0))break;if(e.line===l){for(C=e.input.charCodeAt(e.position);qt(C);)C=e.input.charCodeAt(++e.position);if(C===58)C=e.input.charCodeAt(++e.position),wt(C)||xe(e,"a whitespace character is expected after the key-value separator within a block mapping"),L&&(Wt(e,_,g,k,z,null,c,d,f),k=z=E=null),I=!0,L=!1,o=!1,k=e.tag,z=e.result;else if(I)xe(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=v,e.anchor=m,!0}else if(I)xe(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=v,e.anchor=m,!0}if((e.line===l||e.lineIndent>u)&&(L&&(c=e.line,d=e.lineStart,f=e.position),Yt(e,u,fi,!0,o)&&(L?z=e.result:E=e.result),L||(Wt(e,_,g,k,z,E,c,d,f),k=z=E=null),st(e,!0,-1),C=e.input.charCodeAt(e.position)),(e.line===l||e.lineIndent>u)&&C!==0)xe(e,"bad indentation of a mapping entry");else if(e.lineIndent<u)break}return L&&Wt(e,_,g,k,z,null,c,d,f),I&&(e.tag=v,e.anchor=m,e.kind="mapping",e.result=_),I}function is(e){var u,t=!1,a=!1,o,l,c;if(c=e.input.charCodeAt(e.position),c!==33)return!1;if(e.tag!==null&&xe(e,"duplication of a tag property"),c=e.input.charCodeAt(++e.position),c===60?(t=!0,c=e.input.charCodeAt(++e.position)):c===33?(a=!0,o="!!",c=e.input.charCodeAt(++e.position)):o="!",u=e.position,t){do c=e.input.charCodeAt(++e.position);while(c!==0&&c!==62);e.position<e.length?(l=e.input.slice(u,e.position),c=e.input.charCodeAt(++e.position)):xe(e,"unexpected end of the stream within a verbatim tag")}else{for(;c!==0&&!wt(c);)c===33&&(a?xe(e,"tag suffix cannot contain exclamation marks"):(o=e.input.slice(u-1,e.position+1),lr.test(o)||xe(e,"named tag handle cannot contain such characters"),a=!0,u=e.position+1)),c=e.input.charCodeAt(++e.position);l=e.input.slice(u,e.position),$o.test(l)&&xe(e,"tag suffix cannot contain flow indicator characters")}l&&!dr.test(l)&&xe(e,"tag name cannot contain such characters: "+l);try{l=decodeURIComponent(l)}catch{xe(e,"tag name is malformed: "+l)}return t?e.tag=l:It.call(e.tagMap,o)?e.tag=e.tagMap[o]+l:o==="!"?e.tag="!"+l:o==="!!"?e.tag="tag:yaml.org,2002:"+l:xe(e,'undeclared tag handle "'+o+'"'),!0}function ns(e){var u,t;if(t=e.input.charCodeAt(e.position),t!==38)return!1;for(e.anchor!==null&&xe(e,"duplication of an anchor property"),t=e.input.charCodeAt(++e.position),u=e.position;t!==0&&!wt(t)&&!$t(t);)t=e.input.charCodeAt(++e.position);return e.position===u&&xe(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(u,e.position),!0}function rs(e){var u,t,a;if(a=e.input.charCodeAt(e.position),a!==42)return!1;for(a=e.input.charCodeAt(++e.position),u=e.position;a!==0&&!wt(a)&&!$t(a);)a=e.input.charCodeAt(++e.position);return e.position===u&&xe(e,"name of an alias node must contain at least one character"),t=e.input.slice(u,e.position),It.call(e.anchorMap,t)||xe(e,'unidentified alias "'+t+'"'),e.result=e.anchorMap[t],st(e,!0,-1),!0}function Yt(e,u,t,a,o){var l,c,d,f=1,v=!1,m=!1,_,g,k,z,E,L;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,l=c=d=fi===t||cr===t,a&&st(e,!0,-1)&&(v=!0,e.lineIndent>u?f=1:e.lineIndent===u?f=0:e.lineIndent<u&&(f=-1)),f===1)for(;is(e)||ns(e);)st(e,!0,-1)?(v=!0,d=l,e.lineIndent>u?f=1:e.lineIndent===u?f=0:e.lineIndent<u&&(f=-1)):d=!1;if(d&&(d=v||o),(f===1||fi===t)&&(hi===t||sr===t?E=u:E=u+1,L=e.position-e.lineStart,f===1?d&&(zn(e,L)||ts(e,L,E))||Zo(e,E)?m=!0:(c&&es(e,E)||Jo(e,E)||Qo(e,E)?m=!0:rs(e)?(m=!0,(e.tag!==null||e.anchor!==null)&&xe(e,"alias node should not have any properties")):Xo(e,E,hi===t)&&(m=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):f===0&&(m=d&&zn(e,L))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&xe(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),_=0,g=e.implicitTypes.length;_<g;_+=1)if(z=e.implicitTypes[_],z.resolve(e.result)){e.result=z.construct(e.result),e.tag=z.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(It.call(e.typeMap[e.kind||"fallback"],e.tag))z=e.typeMap[e.kind||"fallback"][e.tag];else for(z=null,k=e.typeMap.multi[e.kind||"fallback"],_=0,g=k.length;_<g;_+=1)if(e.tag.slice(0,k[_].tag.length)===k[_].tag){z=k[_];break}z||xe(e,"unknown tag !<"+e.tag+">"),e.result!==null&&z.kind!==e.kind&&xe(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+z.kind+'", not "'+e.kind+'"'),z.resolve(e.result,e.tag)?(e.result=z.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):xe(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||m}function as(e){var u=e.position,t,a,o,l=!1,c;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(c=e.input.charCodeAt(e.position))!==0&&(st(e,!0,-1),c=e.input.charCodeAt(e.position),!(e.lineIndent>0||c!==37));){for(l=!0,c=e.input.charCodeAt(++e.position),t=e.position;c!==0&&!wt(c);)c=e.input.charCodeAt(++e.position);for(a=e.input.slice(t,e.position),o=[],a.length<1&&xe(e,"directive name must not be less than one character in length");c!==0;){for(;qt(c);)c=e.input.charCodeAt(++e.position);if(c===35){do c=e.input.charCodeAt(++e.position);while(c!==0&&!At(c));break}if(At(c))break;for(t=e.position;c!==0&&!wt(c);)c=e.input.charCodeAt(++e.position);o.push(e.input.slice(t,e.position))}c!==0&&Ki(e),It.call(On,a)?On[a](e,a,o):gi(e,'unknown document directive "'+a+'"')}if(st(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,st(e,!0,-1)):l&&xe(e,"directives end mark is expected"),Yt(e,e.lineIndent-1,fi,!1,!0),st(e,!0,-1),e.checkLineBreaks&&Ko.test(e.input.slice(u,e.position))&&gi(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&vi(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,st(e,!0,-1));return}if(e.position<e.length-1)xe(e,"end of the stream or a document separator is expected");else return}function fr(e,u){e=String(e),u=u||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var t=new Go(e,u),a=e.indexOf("\0");for(a!==-1&&(t.position=a,xe(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)as(t);return t.documents}function os(e,u,t){u!==null&&typeof u=="object"&&typeof t=="undefined"&&(t=u,u=null);var a=fr(e,t);if(typeof u!="function")return a;for(var o=0,l=a.length;o<l;o+=1)u(a[o])}function ss(e,u){var t=fr(e,u);if(t.length!==0){if(t.length===1)return t[0];throw new bt("expected a single document in the stream, but found more")}}var cs=os,ls=ss,gr={loadAll:cs,load:ls},mr=Object.prototype.toString,yr=Object.prototype.hasOwnProperty,Wi=65279,ds=9,ei=10,ps=13,us=32,hs=33,fs=34,Fi=35,gs=37,ms=38,ys=39,vs=42,vr=44,bs=45,mi=58,xs=61,_s=62,ws=63,ks=64,br=91,xr=93,Ss=96,_r=123,Es=124,wr=125,gt={};gt[0]="\\0";gt[7]="\\a";gt[8]="\\b";gt[9]="\\t";gt[10]="\\n";gt[11]="\\v";gt[12]="\\f";gt[13]="\\r";gt[27]="\\e";gt[34]='\\"';gt[92]="\\\\";gt[133]="\\N";gt[160]="\\_";gt[8232]="\\L";gt[8233]="\\P";var Cs=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],As=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Ts(e,u){var t,a,o,l,c,d,f;if(u===null)return{};for(t={},a=Object.keys(u),o=0,l=a.length;o<l;o+=1)c=a[o],d=String(u[c]),c.slice(0,2)==="!!"&&(c="tag:yaml.org,2002:"+c.slice(2)),f=e.compiledTypeMap.fallback[c],f&&yr.call(f.styleAliases,d)&&(d=f.styleAliases[d]),t[c]=d;return t}function Os(e){var u,t,a;if(u=e.toString(16).toUpperCase(),e<=255)t="x",a=2;else if(e<=65535)t="u",a=4;else if(e<=4294967295)t="U",a=8;else throw new bt("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+dt.repeat("0",a-u.length)+u}var Ls=1,ti=2;function zs(e){this.schema=e.schema||ji,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=dt.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Ts(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?ti:Ls,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Pn(e,u){for(var t=dt.repeat(" ",u),a=0,o=-1,l="",c,d=e.length;a<d;)o=e.indexOf(`
`,a),o===-1?(c=e.slice(a),a=d):(c=e.slice(a,o+1),a=o+1),c.length&&c!==`
`&&(l+=t),l+=c;return l}function Bi(e,u){return`
`+dt.repeat(" ",e.indent*u)}function Ps(e,u){var t,a,o;for(t=0,a=e.implicitTypes.length;t<a;t+=1)if(o=e.implicitTypes[t],o.resolve(u))return!0;return!1}function yi(e){return e===us||e===ds}function ii(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Wi||65536<=e&&e<=1114111}function Mn(e){return ii(e)&&e!==Wi&&e!==ps&&e!==ei}function In(e,u,t){var a=Mn(e),o=a&&!yi(e);return(t?a:a&&e!==vr&&e!==br&&e!==xr&&e!==_r&&e!==wr)&&e!==Fi&&!(u===mi&&!o)||Mn(u)&&!yi(u)&&e===Fi||u===mi&&o}function Ms(e){return ii(e)&&e!==Wi&&!yi(e)&&e!==bs&&e!==ws&&e!==mi&&e!==vr&&e!==br&&e!==xr&&e!==_r&&e!==wr&&e!==Fi&&e!==ms&&e!==vs&&e!==hs&&e!==Es&&e!==xs&&e!==_s&&e!==ys&&e!==fs&&e!==gs&&e!==ks&&e!==Ss}function Is(e){return!yi(e)&&e!==mi}function Qt(e,u){var t=e.charCodeAt(u),a;return t>=55296&&t<=56319&&u+1<e.length&&(a=e.charCodeAt(u+1),a>=56320&&a<=57343)?(t-55296)*1024+a-56320+65536:t}function kr(e){var u=/^\n* /;return u.test(e)}var Sr=1,Ni=2,Er=3,Cr=4,Kt=5;function Ds(e,u,t,a,o,l,c,d){var f,v=0,m=null,_=!1,g=!1,k=a!==-1,z=-1,E=Ms(Qt(e,0))&&Is(Qt(e,e.length-1));if(u||c)for(f=0;f<e.length;v>=65536?f+=2:f++){if(v=Qt(e,f),!ii(v))return Kt;E=E&&In(v,m,d),m=v}else{for(f=0;f<e.length;v>=65536?f+=2:f++){if(v=Qt(e,f),v===ei)_=!0,k&&(g=g||f-z-1>a&&e[z+1]!==" ",z=f);else if(!ii(v))return Kt;E=E&&In(v,m,d),m=v}g=g||k&&f-z-1>a&&e[z+1]!==" "}return!_&&!g?E&&!c&&!o(e)?Sr:l===ti?Kt:Ni:t>9&&kr(e)?Kt:c?l===ti?Kt:Ni:g?Cr:Er}function Rs(e,u,t,a,o){e.dump=(function(){if(u.length===0)return e.quotingType===ti?'""':"''";if(!e.noCompatMode&&(Cs.indexOf(u)!==-1||As.test(u)))return e.quotingType===ti?'"'+u+'"':"'"+u+"'";var l=e.indent*Math.max(1,t),c=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-l),d=a||e.flowLevel>-1&&t>=e.flowLevel;function f(v){return Ps(e,v)}switch(Ds(u,d,e.indent,c,f,e.quotingType,e.forceQuotes&&!a,o)){case Sr:return u;case Ni:return"'"+u.replace(/'/g,"''")+"'";case Er:return"|"+Dn(u,e.indent)+Rn(Pn(u,l));case Cr:return">"+Dn(u,e.indent)+Rn(Pn(Fs(u,c),l));case Kt:return'"'+Bs(u)+'"';default:throw new bt("impossible error: invalid scalar style")}})()}function Dn(e,u){var t=kr(e)?String(u):"",a=e[e.length-1]===`
`,o=a&&(e[e.length-2]===`
`||e===`
`),l=o?"+":a?"":"-";return t+l+`
`}function Rn(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Fs(e,u){for(var t=/(\n+)([^\n]*)/g,a=(function(){var v=e.indexOf(`
`);return v=v!==-1?v:e.length,t.lastIndex=v,Fn(e.slice(0,v),u)})(),o=e[0]===`
`||e[0]===" ",l,c;c=t.exec(e);){var d=c[1],f=c[2];l=f[0]===" ",a+=d+(!o&&!l&&f!==""?`
`:"")+Fn(f,u),o=l}return a}function Fn(e,u){if(e===""||e[0]===" ")return e;for(var t=/ [^ ]/g,a,o=0,l,c=0,d=0,f="";a=t.exec(e);)d=a.index,d-o>u&&(l=c>o?c:d,f+=`
`+e.slice(o,l),o=l+1),c=d;return f+=`
`,e.length-o>u&&c>o?f+=e.slice(o,c)+`
`+e.slice(c+1):f+=e.slice(o),f.slice(1)}function Bs(e){for(var u="",t=0,a,o=0;o<e.length;t>=65536?o+=2:o++)t=Qt(e,o),a=gt[t],!a&&ii(t)?(u+=e[o],t>=65536&&(u+=e[o+1])):u+=a||Os(t);return u}function Ns(e,u,t){var a="",o=e.tag,l,c,d;for(l=0,c=t.length;l<c;l+=1)d=t[l],e.replacer&&(d=e.replacer.call(t,String(l),d)),(Ot(e,u,d,!1,!1)||typeof d=="undefined"&&Ot(e,u,null,!1,!1))&&(a!==""&&(a+=","+(e.condenseFlow?"":" ")),a+=e.dump);e.tag=o,e.dump="["+a+"]"}function Bn(e,u,t,a){var o="",l=e.tag,c,d,f;for(c=0,d=t.length;c<d;c+=1)f=t[c],e.replacer&&(f=e.replacer.call(t,String(c),f)),(Ot(e,u+1,f,!0,!0,!1,!0)||typeof f=="undefined"&&Ot(e,u+1,null,!0,!0,!1,!0))&&((!a||o!=="")&&(o+=Bi(e,u)),e.dump&&ei===e.dump.charCodeAt(0)?o+="-":o+="- ",o+=e.dump);e.tag=l,e.dump=o||"[]"}function qs(e,u,t){var a="",o=e.tag,l=Object.keys(t),c,d,f,v,m;for(c=0,d=l.length;c<d;c+=1)m="",a!==""&&(m+=", "),e.condenseFlow&&(m+='"'),f=l[c],v=t[f],e.replacer&&(v=e.replacer.call(t,f,v)),Ot(e,u,f,!1,!1)&&(e.dump.length>1024&&(m+="? "),m+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Ot(e,u,v,!1,!1)&&(m+=e.dump,a+=m));e.tag=o,e.dump="{"+a+"}"}function Hs(e,u,t,a){var o="",l=e.tag,c=Object.keys(t),d,f,v,m,_,g;if(e.sortKeys===!0)c.sort();else if(typeof e.sortKeys=="function")c.sort(e.sortKeys);else if(e.sortKeys)throw new bt("sortKeys must be a boolean or a function");for(d=0,f=c.length;d<f;d+=1)g="",(!a||o!=="")&&(g+=Bi(e,u)),v=c[d],m=t[v],e.replacer&&(m=e.replacer.call(t,v,m)),Ot(e,u+1,v,!0,!0,!0)&&(_=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,_&&(e.dump&&ei===e.dump.charCodeAt(0)?g+="?":g+="? "),g+=e.dump,_&&(g+=Bi(e,u)),Ot(e,u+1,m,!0,_)&&(e.dump&&ei===e.dump.charCodeAt(0)?g+=":":g+=": ",g+=e.dump,o+=g));e.tag=l,e.dump=o||"{}"}function Nn(e,u,t){var a,o,l,c,d,f;for(o=t?e.explicitTypes:e.implicitTypes,l=0,c=o.length;l<c;l+=1)if(d=o[l],(d.instanceOf||d.predicate)&&(!d.instanceOf||typeof u=="object"&&u instanceof d.instanceOf)&&(!d.predicate||d.predicate(u))){if(t?d.multi&&d.representName?e.tag=d.representName(u):e.tag=d.tag:e.tag="?",d.represent){if(f=e.styleMap[d.tag]||d.defaultStyle,mr.call(d.represent)==="[object Function]")a=d.represent(u,f);else if(yr.call(d.represent,f))a=d.represent[f](u,f);else throw new bt("!<"+d.tag+'> tag resolver accepts not "'+f+'" style');e.dump=a}return!0}return!1}function Ot(e,u,t,a,o,l,c){e.tag=null,e.dump=t,Nn(e,t,!1)||Nn(e,t,!0);var d=mr.call(e.dump),f=a,v;a&&(a=e.flowLevel<0||e.flowLevel>u);var m=d==="[object Object]"||d==="[object Array]",_,g;if(m&&(_=e.duplicates.indexOf(t),g=_!==-1),(e.tag!==null&&e.tag!=="?"||g||e.indent!==2&&u>0)&&(o=!1),g&&e.usedDuplicates[_])e.dump="*ref_"+_;else{if(m&&g&&!e.usedDuplicates[_]&&(e.usedDuplicates[_]=!0),d==="[object Object]")a&&Object.keys(e.dump).length!==0?(Hs(e,u,e.dump,o),g&&(e.dump="&ref_"+_+e.dump)):(qs(e,u,e.dump),g&&(e.dump="&ref_"+_+" "+e.dump));else if(d==="[object Array]")a&&e.dump.length!==0?(e.noArrayIndent&&!c&&u>0?Bn(e,u-1,e.dump,o):Bn(e,u,e.dump,o),g&&(e.dump="&ref_"+_+e.dump)):(Ns(e,u,e.dump),g&&(e.dump="&ref_"+_+" "+e.dump));else if(d==="[object String]")e.tag!=="?"&&Rs(e,e.dump,u,l,f);else{if(d==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new bt("unacceptable kind of an object to dump "+d)}e.tag!==null&&e.tag!=="?"&&(v=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?v="!"+v:v.slice(0,18)==="tag:yaml.org,2002:"?v="!!"+v.slice(18):v="!<"+v+">",e.dump=v+" "+e.dump)}return!0}function js(e,u){var t=[],a=[],o,l;for(qi(e,t,a),o=0,l=a.length;o<l;o+=1)u.duplicates.push(t[a[o]]);u.usedDuplicates=new Array(l)}function qi(e,u,t){var a,o,l;if(e!==null&&typeof e=="object")if(o=u.indexOf(e),o!==-1)t.indexOf(o)===-1&&t.push(o);else if(u.push(e),Array.isArray(e))for(o=0,l=e.length;o<l;o+=1)qi(e[o],u,t);else for(a=Object.keys(e),o=0,l=a.length;o<l;o+=1)qi(e[a[o]],u,t)}function Ks(e,u){u=u||{};var t=new zs(u);t.noRefs||js(e,t);var a=e;return t.replacer&&(a=t.replacer.call({"":a},"",a)),Ot(t,0,a,!0,!0)?t.dump+`
`:""}var $s=Ks,Ws={dump:$s};function Yi(e,u){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+u+" instead, which is now safe by default.")}}var Ys=ht,Us=jn,Vs=Yn,Gs=Jn,Xs=Qn,Js=ji,Qs=gr.load,Zs=gr.loadAll,ec=Ws.dump,tc=bt,ic={binary:nr,float:Xn,map:Wn,null:Un,pairs:ar,set:or,timestamp:tr,bool:Vn,int:Gn,merge:ir,omap:rr,seq:$n,str:Kn},nc=Yi("safeLoad","load"),rc=Yi("safeLoadAll","loadAll"),ac=Yi("safeDump","dump"),oc={Type:Ys,Schema:Us,FAILSAFE_SCHEMA:Vs,JSON_SCHEMA:Gs,CORE_SCHEMA:Xs,DEFAULT_SCHEMA:Js,load:Qs,loadAll:Zs,dump:ec,YAMLException:tc,types:ic,safeLoad:nc,safeLoadAll:rc,safeDump:ac},Ar=oc;window.interact||(window.interact=Tr.default);window.jsyaml||(window.jsyaml=Ar);var sc="0.9.5";console.info(`%c drag-and-drop-card %c v${sc} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var cc=(e,...u)=>console.debug(`[drag-and-drop-card] ${e}`,...u);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var Ui=()=>new Promise(e=>requestAnimationFrame(()=>e())),lc=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),Vi=class e extends HTMLElement{constructor(){super();kn(this,"__booting",!1);this.shadowRoot||this.attachShadow({mode:"open"}),this.__rebuiltCards=new WeakSet}_updateTabsA11y_(){var o;let t=this.tabsBar;if(!t)return;t.setAttribute("role","tablist"),t.querySelectorAll(".ddc-tab").forEach((l,c)=>{let d=l.classList.contains("active");l.setAttribute("role","tab"),l.setAttribute("aria-selected",String(d)),l.setAttribute("tabindex",d?"0":"-1"),l.dataset.index=String(c)}),this.__tabsKeyHandler||(this.__tabsKeyHandler=l=>{if(!["ArrowLeft","ArrowRight","Home","End"].includes(l.key))return;let d=Array.from(t.querySelectorAll(".ddc-tab"));if(!d.length)return;l.preventDefault();let f=d.findIndex(g=>g===document.activeElement),v=d.findIndex(g=>g.classList.contains("active")),m=f>=0?f:v>=0?v:0;l.key==="ArrowRight"&&(m=Math.min(d.length-1,m+1)),l.key==="ArrowLeft"&&(m=Math.max(0,m-1)),l.key==="Home"&&(m=0),l.key==="End"&&(m=d.length-1);let _=d[m];if(_){try{_.focus({preventScroll:!1})}catch{}_.click()}},t.addEventListener("keydown",this.__tabsKeyHandler)),this.__tabsScrollHandler||(this.__tabsScrollHandler=()=>{var l;return(l=this._updateTabOverflowShadows_)==null?void 0:l.call(this)},t.addEventListener("scroll",this.__tabsScrollHandler,{passive:!0})),(o=this._updateTabOverflowShadows_)==null||o.call(this)}_getCurrentDashboardUrlPath_(){let a=(window.location.pathname||"/").replace(/^\/+/,"").split("/")[0]||"lovelace";return a==="lovelace"?null:a}async _ensureCardIdSeededInStorage_(){var a;if((a=this.config)!=null&&a.id)return this.config.id;let t=crypto!=null&&crypto.randomUUID?crypto.randomUUID():"ddc_"+Math.random().toString(36).slice(2);this.config={...this.config,id:t};try{let o=this._getCurrentDashboardUrlPath_(),l=await this.hass.callWS(o?{type:"lovelace/config",url_path:o}:{type:"lovelace/config"}),c=this._findThisCardPathRecursive_(l,k=>(k==null?void 0:k.type)==="custom:drag-and-drop-card"&&(!k.id||k.id===t));if(!c)return t;let{viewIndex:d,cardIndex:f,parentPath:v}=c,m=l.views[d],g={...this._getCardByPath_(m,v,f),id:t};this._setCardByPath_(m,v,f,g),await this.hass.callWS(o?{type:"lovelace/config/save",url_path:o,config:l}:{type:"lovelace/config/save",config:l})}catch{}return t}async _persistThisCardConfigToStorage_(){var g,k;await this._ensureCardIdSeededInStorage_();let t={type:"custom:drag-and-drop-card",id:(g=this.config)==null?void 0:g.id,...this._config},a=this._getCurrentDashboardUrlPath_(),o=await this.hass.callWS(a?{type:"lovelace/config",url_path:a}:{type:"lovelace/config"}),l=this._findThisCardPathRecursive_(o,z=>{var E;return(z==null?void 0:z.type)==="custom:drag-and-drop-card"&&(z==null?void 0:z.id)===((E=this.config)==null?void 0:E.id)});if(!l)throw new Error("Card not found in Lovelace config");let{viewIndex:c,cardIndex:d,parentPath:f}=l,v=o.views[c],_={...this._getCardByPath_(v,f,d),...t};this._setCardByPath_(v,f,d,_),await this.hass.callWS(a?{type:"lovelace/config/save",url_path:a,config:o}:{type:"lovelace/config/save",config:o}),this.config=_,(k=this.requestUpdate)==null||k.call(this)}_findThisCardPathRecursive_(t,a){let o=(t==null?void 0:t.views)||[];for(let l=0;l<o.length;l++){let c=this._findInCardTree_(o[l],a);if(c)return{viewIndex:l,...c}}return null}_findInCardTree_(t,a,o=[]){var c;let l=(t==null?void 0:t.cards)||[];for(let d=0;d<l.length;d++){let f=l[d];if(a(f))return{cardIndex:d,parentPath:o};if((c=f==null?void 0:f.cards)!=null&&c.length){let v=this._findInCardTree_(f,a,o.concat(d));if(v)return v}}return null}_getCardByPath_(t,a,o){let l=t;for(let c of a||[])l=l.cards[c];return l.cards[o]}_setCardByPath_(t,a,o,l){let c=t;for(let d of a||[])c=c.cards[d];c.cards[o]=l}_ensureToolbarStyles_(){try{if(this.shadowRoot.querySelector("#ddc-toolbar-styles"))return;let a=document.createElement("style");a.id="ddc-toolbar-styles",a.textContent=`/* ===== Edit toolbar ===== */
  .ddc-toolbar{
    position: sticky; top:0; z-index: 50;
    display:grid; grid-template-columns: 1fr auto 1fr; align-items:center;
    gap: 12px; padding: 10px 14px;
    backdrop-filter: blur(8px);
    background: color-mix(in oklab, var(--card-background-color, rgba(0,0,0,.45)) 80%, transparent);
    border-bottom: 1px solid var(--divider-color, rgba(255,255,255,.08));
    box-shadow: 0 2px 10px rgba(0,0,0,.25);
  }
  .ddc-t-group{ display:flex; align-items:center; gap:8px; flex-wrap: wrap; }
  .ddc-toolbar > .ddc-t-group:first-child{ justify-self: start; }
  .ddc-toolbar > .ddc-t-group:nth-child(3){ justify-self: center; }
  .ddc-toolbar > .ddc-t-group:last-child{ justify-self: end; }

  .ddc-t-btn{
    display:inline-flex; align-items:center; gap:8px;
    height:34px; padding:0 12px; border-radius:10px;
    font: inherit; line-height: 1; cursor:pointer;
    background: var(--ha-card-background, rgba(255,255,255,.06));
    border: 1px solid color-mix(in oklab, currentColor 12%, transparent);
    color: var(--primary-text-color, #e5e7eb);
    transition: transform .08s ease, background .15s ease, border-color .15s ease;
  }
  .ddc-t-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.1); }
  .ddc-t-btn:active{ transform: translateY(0); }
  .ddc-t-btn ha-icon{ --mdc-icon-size:18px; }
  .ddc-t-btn .label{ white-space:nowrap; }

  .ddc-t-btn.primary{
    background: var(--primary-color);
    color: var(--text-primary-color, #fff);
    border-color: color-mix(in oklab, var(--primary-color) 75%, #000);
  }
  .ddc-t-btn.danger{
    background: var(--error-color, #ef4444);
    color:#fff;
    border-color: color-mix(in oklab, var(--error-color) 75%, #000);
  }
  .ddc-t-btn.ghost{
    background: transparent;
    border-color: transparent;
    color: var(--secondary-text-color, #cbd5e1);
  }

  .ddc-t-sep{ width:1px; height:28px; background: var(--divider-color, rgba(255,255,255,.12)); }

  .ddc-t-status{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 12px; border-radius:999px;
    background: rgba(255,255,255,.06);
    border: 1px solid color-mix(in oklab, currentColor 12%, transparent);
    font-size:.875rem;
  }
  .ddc-t-dot{ width:10px; height:10px; border-radius:50%; background:#22c55e; }
  .ddc-t-dot.dirty{ background:#f59e0b; animation: ddc-pulse 1.5s ease-in-out infinite; }
  .ddc-t-dot.error{ background:#ef4444; }
  @keyframes ddc-pulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.4)} }

  /* Compact (icon-only) when narrow */
  .ddc-toolbar.compact .ddc-t-btn .label{ display:none; }
  /* Super-narrow: stack rows */
  @media (max-width: 840px){
    .ddc-toolbar{ grid-template-columns: 1fr; row-gap: 10px; }
    .ddc-toolbar .ddc-t-sep{ display:none; }
    .ddc-toolbar > .ddc-t-group{ justify-self: stretch; }
  }`,this.shadowRoot.appendChild(a)}catch(t){console.warn("Toolbar style inject failed",t)}}_ensureSettingsStyles_(){if(this.shadowRoot.querySelector("#ddc-settings-styles"))return;let t=document.createElement("style");t.id="ddc-settings-styles",t.textContent=`
  .dialog.modern { max-width: 1920px; width: min(92vw, 1080px); border-radius: 14px; overflow: hidden; }
  .dlg-head { display:flex; justify-content:space-between; align-items:center; padding:14px 18px; background:var(--primary-color); color:#fff; }
  .dlg-head h3 { margin:0; font-size:1.1rem; font-weight:700; }
  .icon-btn { border:0; background:transparent; color:inherit; cursor:pointer; display:grid; place-items:center; }
  .settings-body { display:grid; gap:16px; padding:16px; max-height:70vh; overflow:auto; grid-template-columns: 1fr; }
  @media (min-width: 720px){ .settings-body { grid-template-columns: 1fr 1fr; } }
  .card { background:var(--ha-card-background, #fff); border-radius:12px; box-shadow:0 1px 6px rgba(0,0,0,.08); padding:12px 14px; display:flex; flex-direction:column; gap:10px; }
  .card h4 { margin:0; font-size:1rem; font-weight:700; color:var(--primary-text-color); }
  .row { display:flex; align-items:center; gap:12px; }
  .row label { flex:1; font-size:.95rem; }
  .row input[type="text"], .row input[type="number"], .row select { flex:1; padding:8px; border:1px solid var(--divider-color, rgba(0,0,0,.2)); border-radius:8px; background:var(--card-background-color, #fff); }
  .range-wrap { display:flex; align-items:center; gap:12px; }
  .range-wrap input[type="range"] { flex:1; }
  .range-wrap output { width:64px; text-align:right; color:var(--secondary-text-color); font-weight:600; }
  .chips { display:flex; gap:8px; flex-wrap:wrap; }
  .chip { border:1px solid var(--divider-color, rgba(0,0,0,.25)); padding:6px 10px; border-radius:999px; background:transparent; cursor:pointer; font-size:.9rem; }
  .chip[aria-pressed="true"] { background:var(--primary-color); color:#fff; border-color:transparent; }
  .preview { border:1px dashed var(--divider-color, rgba(0,0,0,.25)); border-radius:10px; padding:10px; }
  /* ---- Grid demo ---- */
  .grid-demo{
    --g: 100px;                               /* cell size injected via JS */
    --line-minor: rgba(255,255,255,.10);
    --line-major: rgba(255,255,255,.22);
    --bg-fade   : linear-gradient(180deg, transparent 0%, rgba(0,0,0,.04) 100%);

    position: relative;
    height: 180px;
    border-radius: 14px;
    border: 1px solid var(--divider-color, rgba(0,0,0,.18));
    overflow: hidden;
    background:
      /* subtle base */
      var(--bg-fade),
      /* major lines every 5 cells (thicker) - horizontal */
      repeating-linear-gradient(
        to bottom,
        var(--line-major) 0 2px,
        transparent 2px calc(var(--g) * 5)
      ),
      /* major lines every 5 cells (thicker) - vertical */
      repeating-linear-gradient(
        to right,
        var(--line-major) 0 2px,
        transparent 2px calc(var(--g) * 5)
      ),
      /* minor lines each cell - horizontal */
      repeating-linear-gradient(
        to bottom,
        var(--line-minor) 0 1px,
        transparent 1px var(--g)
      ),
      /* minor lines each cell - vertical */
      repeating-linear-gradient(
        to right,
        var(--line-minor) 0 1px,
        transparent 1px var(--g)
      );
    background-color: rgba(0,0,0,.02);
  }

  .grid-meta-badge{
    position: absolute; top: 8px; right: 8px;
    padding: 6px 10px;
    background: color-mix(in oklab, var(--ha-card-background, #111) 80%, transparent);
    border: 1px solid var(--divider-color, rgba(0,0,0,.24));
    border-radius: 999px;
    font-size: .86rem;
    letter-spacing:.2px;
    display:flex; align-items:center; gap:8px;
    backdrop-filter: blur(4px);
    pointer-events:none;
  }

    /* --- NEW nicer headers / captions / swatches / tooltips --- */

    .caption { margin:0 0 8px 0; color:var(--secondary-text-color); font-size:.9rem; }

    .swatches { display:flex; gap:8px; flex-wrap:wrap; }
    .swatch { width:28px; height:28px; border-radius:6px; border:1px solid rgba(0,0,0,.15); cursor:pointer; position:relative; }
    .swatch[aria-pressed="true"]::after { content:""; position:absolute; inset:-3px; border:2px solid var(--primary-color); border-radius:8px; }

    .inline-help { display:inline-flex; align-items:center; gap:6px; color:var(--secondary-text-color); font-size:.9rem; }
    .inline-help ha-icon { opacity:.8; }

    .input-file { display:flex; gap:10px; align-items:center; }
    .input-file input[type="file"] { display:none; }
    .input-file .file-btn { border:1px solid var(--divider-color,rgba(0,0,0,.25)); border-radius:8px; padding:8px 12px; cursor:pointer; background:var(--ha-card-background,#fff); }
    .thumb { width:64px; height:42px; border-radius:6px; background-size:cover; background-position:center; border:1px solid rgba(0,0,0,.12); }

    .divider { height:1px; background:var(--divider-color, rgba(0,0,0,.12)); margin:8px 0; opacity:.7; }

    .section-head { display:flex; align-items:center; gap:8px; margin:0 0 8px 0; padding-bottom:6px; border-bottom:1px solid var(--divider-color, rgba(0,0,0,.12)); }
    .section-head ha-icon { opacity:.9; }
    .setting { display:flex; flex-direction:column; gap:6px; margin:8px 0; }
    .setting .row { display:flex; align-items:center; gap:12px; }
    .setting .title { display:flex; align-items:center; gap:8px; min-width:220px; }
    .setting .title ha-icon { opacity:.9; }
    .setting .control { display:flex; align-items:center; gap:10px; flex:1; }
    .setting .hint { margin-left:32px; color:var(--secondary-text-color); font-size:.88rem; line-height:1.35; }
    .setting .suffix { opacity:.6; margin-left:4px; }
    .range-wrap { display:flex; align-items:center; gap:12px; flex:1; }
    .range-wrap output { width:64px; text-align:right; color:var(--secondary-text-color); font-weight:600; }

    /* --- Tabs manager UI --- */
    .tabs-card .tab-row { display:flex; align-items:center; gap:10px; padding:6px 0; border-bottom:1px solid var(--divider-color, rgba(0,0,0,.08)); }
    .tabs-card .tab-row:last-child { border-bottom:0; }
    .tabs-card .tab-name { flex:1; display:flex; align-items:center; gap:8px; }
    .tabs-card .tab-name input { flex:1; padding:6px 8px; border:1px solid var(--divider-color, rgba(0,0,0,.25)); border-radius:8px; background:var(--ha-card-background, #fff); }
    .tabs-card .tab-actions { display:flex; align-items:center; gap:8px; }
    .icon-btn.danger { color: var(--error-color, #b00020); }

    /* gradient swatches */
    .gradients { display:flex; gap:8px; flex-wrap:wrap; }
    .gradient { width:44px; height:28px; border-radius:8px; border:1px solid rgba(0,0,0,.15); cursor:pointer; position:relative; }
    .gradient[aria-pressed="true"]::after { content:""; position:absolute; inset:-3px; border:2px solid var(--primary-color); border-radius:10px; }

    /* Section hierarchy */
    .section-head {
      display:flex; align-items:center; gap:10px; margin:6px 0 6px;
    }
    .section-head ha-icon { opacity:.85; }
    .section-head h4 {
      margin:0;
      font-size:1.1rem;          /* larger than setting labels */
      font-weight:700;
      letter-spacing:.2px;
    }

    /* Setting rows */
    .setting { padding:10px 0; }
    .setting .row {
      display:flex; align-items:center; gap:14px;
    }
    .setting .title {
      flex:0 0 240px;            /* left column width */
      display:flex; align-items:center; gap:8px;
      font-weight:600;
    }
    .setting .title label, .setting .title span { font-size:.98rem; }
    .setting .control { flex:1; display:flex; align-items:center; gap:10px; }

    /* Hints and captions */
    .caption { margin:0 0 4px; color:var(--secondary-text-color); font-size:.92rem; }
    .hint    { margin:6px 0 0;  color:var(--secondary-text-color); font-size:.88rem; }

    /* Dividers */
    .divider {
      height:1px;
      background:linear-gradient(
        to right,
        transparent,
        var(--divider-color, rgba(0,0,0,.12)),
        transparent
      );
      margin:12px 0;
    }

    /* Inputs */
    .modern select,
    .modern input[type="text"],
    .modern input[type="number"] {
      padding:8px 10px;
      border:1px solid var(--divider-color,rgba(0,0,0,.25));
      border-radius:10px;
      background:var(--ha-card-background,#fff);
    }

    /* Slider + output */
    .range-wrap { display:flex; align-items:center; gap:10px; width:100%; }
    .range-wrap input[type="range"] { flex:1; }
    .range-wrap output {
      min-width:64px; text-align:right; font-variant-numeric:tabular-nums;
      color:var(--secondary-text-color);
    }

    /* Chips row spacing */
    .chips { display:flex; gap:8px; flex-wrap:wrap; }

    /* ----- Hard category separators ----- */
    section.card {
      border-bottom: 2px solid var(--divider-strong, rgba(255,255,255,.15));
      margin-bottom: 20px;
      padding-bottom: 24px;
    }

    section.card:last-of-type {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    section.card:hover > .section-head h4 {
      color: var(--accent-color, var(--primary-color));
      transition: color .25s ease;
    }

    .section-head {
      background: linear-gradient(90deg, var(--accent-color, #2563eb) 0%, transparent 70%);
      padding: 4px 10px;
      border-radius: 6px;
    }
    .section-head h4 {
      color: #fff;
    }

    /* Tighten the empty space after Background image and between sections */
    section.card .setting:last-child { margin-bottom: 0; padding-bottom: 0; }
    section.card { margin-bottom: 16px; padding-bottom: 20px; }
    .section-head { margin-top: 4px; }

    /* Place Tabs section right after Appearance without big gaps */
    .tabs-card { margin-top: 8px; }

    /* File inputs: clearer Upload/Delete buttons */
    .input-file { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .file-btn, #ddc-clear-bg {
      height: 36px; padding: 0 14px; border-radius: 10px; font-weight: 700;
      border: 1px solid transparent; cursor: pointer;
    }
    .file-btn {
      background: var(--primary-color); color: var(--text-primary-color, #fff);
    }
    #ddc-clear-bg {
      background: var(--error-color, #ef4444); color:#fff;
    }
    #ddc-clear-bg:hover { filter: brightness(1.05); }
    .file-btn:hover { filter: brightness(1.05); }

    /* BG option controls */
    .bg-opts { display:grid; grid-template-columns: 220px 1fr; gap:10px 12px; margin-top:8px; }
    .bg-opts label { display:flex; align-items:center; gap:8px; font-weight:600; }
    .bg-opts select, .bg-opts input[type="range"] {
      width: 100%; padding:8px 10px; border:1px solid var(--divider-color,rgba(0,0,0,.25));
      border-radius:10px; background:var(--ha-card-background,#1e1e1e);
    }
    .bg-opts output { min-width:52px; text-align:right; color:var(--secondary-text-color); }

    /* Background image preview thumb */
    .thumb {
      width: 72px; height: 42px; border-radius: 8px;
      background-size: cover; background-position: center center;
      border: 1px solid var(--divider-color, rgba(0,0,0,.25));
    }

    /* ---- Render the background image via a pseudo element so opacity doesn't fade content ---- */
    .ddc-canvas { position: relative; z-index: 0; }
    .ddc-canvas::before{
      content:""; position:absolute; inset:0; z-index:0; pointer-events:none;
      background-image: var(--ddc-bg-image, none);
      background-repeat: var(--ddc-bg-repeat, no-repeat);
      background-size: var(--ddc-bg-size, cover);
      background-position: var(--ddc-bg-position, center center);
      background-attachment: var(--ddc-bg-attachment, scroll);
      opacity: var(--ddc-bg-opacity, 1);
    }
    .ddc-canvas > * { position: relative; z-index: 1; }

    /* Tabs manager polish */
    .tab-row {
      display:flex; align-items:center; gap:10px;
      margin-bottom:10px; padding:8px;
      border:1px solid var(--divider-color, rgba(255,255,255,.12));
      border-radius:8px; background:var(--ha-card-background, rgba(255,255,255,.04));
    }
    .tab-row:hover { background: var(--ha-card-background, rgba(255,255,255,.08)); }

    .tab-name { flex:1; display:flex; align-items:center; gap:8px; }
    .tab-name input {
      background: var(--ha-card-background, #1f1f1f);
      border:1px solid var(--divider-color, rgba(255,255,255,.12));
      color: var(--primary-text-color);
      padding:6px 8px; border-radius:6px;
    }

    .tab-icon-wrap { position:relative; display:flex; align-items:center; gap:6px; }
    .tab-icon-wrap ha-icon { opacity:.9; }

    .mode-chips {
      display:flex; gap:6px;
    }
    .mode-chips .chip {
      border-radius:10px; padding:4px 8px; font-weight:600;
      background: var(--ha-card-background, #222); border:1px solid var(--divider-color, rgba(255,255,255,.12));
    }
    .mode-chips .chip[aria-pressed="true"] {
      background: var(--primary-color); color: #fff; border-color: transparent;
    }

  .grid-meta-badge ha-icon{ opacity:.9; }
  .color-pair { display:flex; gap:8px; }
  .color-pair input[type="color"] { width:44px; height:36px; border:0; background:transparent; padding:0; }
  .footer { display:flex; justify-content:flex-end; gap:10px; padding:12px 16px; border-top:1px solid var(--divider-color, rgba(0,0,0,.12)); }
  .btn.primary { background:var(--primary-color); color:#fff; border:0; border-radius:8px; padding:8px 16px; font-weight:600; cursor:pointer; }
  .btn.secondary { background:transparent; border:1px solid var(--divider-color, rgba(0,0,0,.25)); border-radius:8px; padding:8px 16px; cursor:pointer; }
  `,this.shadowRoot.appendChild(t)}_setHeaderVisible_(t=!0){var a,o,l,c,d;try{(((a=this._deepQueryAll)==null?void 0:a.call(this,"app-header, ha-top-app-bar, ha-top-app-bar-fixed, mwc-top-app-bar-fixed, ha-header-bar, app-toolbar, ha-toolbar"))||[]).forEach(g=>{g&&(g.dataset.ddcPrevDisplayHeader===void 0&&(g.dataset.ddcPrevDisplayHeader=g.style.display||"",g.dataset.ddcPrevMinH=g.style.minHeight||"",g.dataset.ddcPrevH=g.style.height||"",g.dataset.ddcPrevVis=g.style.visibility||""),t?(g.style.display=g.dataset.ddcPrevDisplayHeader||"",g.style.minHeight=g.dataset.ddcPrevMinH||"",g.style.height=g.dataset.ddcPrevH||"",g.style.visibility=g.dataset.ddcPrevVis||"",g.removeAttribute("hidden")):(g.style.display="none",g.style.minHeight="0",g.style.height="0",g.style.visibility="hidden",g.setAttribute("hidden","")))}),(((o=this._deepQueryAll)==null?void 0:o.call(this,'[slot="actionItems"], ha-icon-button, ha-button-menu, assist-button, search-input, ha-quick-bar, ha-mwc-menu'))||[]).forEach(g=>{g&&(g.dataset.ddcPrevDisplayAction===void 0&&(g.dataset.ddcPrevDisplayAction=g.style.display||"",g.dataset.ddcPrevVisAction=g.style.visibility||""),t?(g.style.display=g.dataset.ddcPrevDisplayAction||"",g.style.visibility=g.dataset.ddcPrevVisAction||""):(g.style.display="none",g.style.visibility="hidden"))}),[...((l=this._deepQueryAll)==null?void 0:l.call(this,"ha-app-layout"))||[],...((c=this._deepQueryAll)==null?void 0:c.call(this,"home-assistant-main"))||[],document.documentElement,document.body].filter(Boolean).forEach(g=>{if(g)if(g.dataset.ddcPrevHdrVars===void 0&&(g.dataset.ddcPrevHdrVars=JSON.stringify({mdc:g.style.getPropertyValue("--mdc-top-app-bar-height")||"",app:g.style.getPropertyValue("--app-header-height")||"",hdr:g.style.getPropertyValue("--header-height")||"",hah:g.style.getPropertyValue("--ha-header-height")||"",pad:g.style&&(g.style.paddingTop||"")||""})),t)try{let k=JSON.parse(g.dataset.ddcPrevHdrVars||"{}");g.style.setProperty("--mdc-top-app-bar-height",k.mdc||""),g.style.setProperty("--app-header-height",k.app||""),g.style.setProperty("--header-height",k.hdr||""),g.style.setProperty("--ha-header-height",k.hah||""),k.pad!==void 0&&(g.style.paddingTop=k.pad||"")}catch{}else{g.style.setProperty("--mdc-top-app-bar-height","0px"),g.style.setProperty("--app-header-height","0px"),g.style.setProperty("--header-height","0px"),g.style.setProperty("--ha-header-height","0px");try{g.style.paddingTop="0px"}catch{}}}),(((d=this._deepQueryAll)==null?void 0:d.call(this,"#contentContainer"))||[]).forEach(g=>{g&&(g.dataset.ddcPrevContentPadTop===void 0&&(g.dataset.ddcPrevContentPadTop=g.style&&(g.style.paddingTop||"")||""),g.style.paddingTop=t?g.dataset.ddcPrevContentPadTop||"":"0px")})}catch{}}_setSidebarVisible_(t=!0){var a,o;try{(((a=this._deepQueryAll)==null?void 0:a.call(this,"ha-sidebar"))||[]).forEach(d=>{d&&(d.dataset.ddcPrevDisplaySidebar===void 0&&(d.dataset.ddcPrevDisplaySidebar=d.style.display||""),d.style.display=t?d.dataset.ddcPrevDisplaySidebar||"":"none")}),(((o=this._deepQueryAll)==null?void 0:o.call(this,"ha-drawer"))||[]).forEach(d=>{if(d){d.dataset.ddcPrevDrawerWidth===void 0&&(d.dataset.ddcPrevDrawerWidth=d.style.getPropertyValue("--mdc-drawer-width")||""),t?d.style.setProperty("--mdc-drawer-width",d.dataset.ddcPrevDrawerWidth||""):d.style.setProperty("--mdc-drawer-width","0px");try{!t&&typeof d.close=="function"&&d.close()}catch{}}})}catch{}}_applyHaChromeVisibility_(){var t;try{let a=!!this.editMode||((t=this._isInHaEditorPreview)==null?void 0:t.call(this));a||!this.hideHaHeader?this._setHeaderVisible_(!0):this._setHeaderVisible_(!1),a||!this.hideHaSidebar?this._setSidebarVisible_(!0):this._setSidebarVisible_(!1)}catch{}}_applyBackgroundImageFromConfig(){var l;let t=this._config||{},a=t.background_image||t.bg_image||null,o=this.cardContainer;if(o)if(a&&a.src){let c=String(a.src).trim(),d=a.repeat===!0||a.repeat==="repeat"?"repeat":"no-repeat",f=Math.max(0,Math.min(1,Number((l=a.opacity)!=null?l:1))),v=a.size||"cover",m=a.position||"center center",_=a.attachment||"scroll",g=a.filter||"none";o.style.setProperty("--ddc-bg-image",c?`url("${c.replace(/"/g,'"')}")`:"none"),o.style.setProperty("--ddc-bg-repeat",d),o.style.setProperty("--ddc-bg-opacity",String(f)),o.style.setProperty("--ddc-bg-size",v),o.style.setProperty("--ddc-bg-position",m),o.style.setProperty("--ddc-bg-attachment",_),o.style.setProperty("--ddc-bg-filter",g),o.classList.add("has-bg-image")}else o.style.removeProperty("--ddc-bg-image"),o.style.removeProperty("--ddc-bg-repeat"),o.style.removeProperty("--ddc-bg-opacity"),o.style.removeProperty("--ddc-bg-size"),o.style.removeProperty("--ddc-bg-position"),o.style.removeProperty("--ddc-bg-attachment"),o.style.removeProperty("--ddc-bg-filter"),o.classList.remove("has-bg-image")}_evaluateVisibility_(t){try{let a=this.hass||this._hass;if(!Array.isArray(t)||t.length===0)return!0;let o=l=>{var d,f,v,m,_;if(!l||typeof l!="object")return!0;let c=l.condition||l.type||"state";if(c==="and"||c==="or"){let g=Array.isArray(l.conditions)?l.conditions:[];return g.length===0?!0:c==="and"?g.every(k=>o(k)):g.some(k=>o(k))}if(c==="state"){let g=l.entity;if(!g)return!0;let k=(d=a==null?void 0:a.states)==null?void 0:d[g];if(!k)return!1;let z=String((f=k.state)!=null?f:"");return l.state!==void 0?(Array.isArray(l.state)?l.state:[l.state]).some(L=>String(L)===z):l.state_not!==void 0?!(Array.isArray(l.state_not)?l.state_not:[l.state_not]).some(L=>String(L)===z):!0}if(c==="numeric_state"){let g=l.entity;if(!g)return!0;let k=(v=a==null?void 0:a.states)==null?void 0:v[g];if(!k)return!1;let z=parseFloat(k.state);return!(isNaN(z)||l.above!==void 0&&!(z>Number(l.above))||l.below!==void 0&&!(z<Number(l.below)))}if(c==="screen"){let g=l.media_query||l.query;if(!g||typeof g!="string")return!0;try{return window.matchMedia(g).matches}catch{return!0}}if(c==="user"){let g=Array.isArray(l.users)?l.users:l.user?[l.user]:[];if(!g.length)return!0;let k=((m=a==null?void 0:a.user)==null?void 0:m.id)||((_=a==null?void 0:a.user)==null?void 0:_.id)||null;return k?g.includes(k):!0}return!0};return t.every(l=>o(l))}catch(a){return console.warn("[ddc:visibility] evaluate error",a),!0}}_applyVisibility_(){var t;try{let a=((t=this.cardContainer)==null?void 0:t.children)||[],o=this._normalizeTabId(this.activeTab);for(let l of a){if(!l||!l.firstElementChild||this._normalizeTabId(l.dataset.tabId)!==o)continue;let f=(this._extractCardConfig(l.firstElementChild)||{}).visibility,v=this.editMode?!0:this._evaluateVisibility_(f);l.style.display=v?"":"none"}}catch(a){console.warn("[ddc:visibility] apply error",a)}}async _onKeyDown_(t){var d,f,v,m,_,g,k,z,E,L;if(!this.editMode||this._isTypingTarget_(t.target))return;let a=Number(this.gridSize||10),o=t.altKey?1:t.shiftKey?a*5:a,l=0,c=0;switch(t.key){case"ArrowLeft":l=-o;break;case"ArrowRight":l=o;break;case"ArrowUp":c=-o;break;case"ArrowDown":c=o;break}if(l||c){t.preventDefault(),this._moveSelectionBy_(l,c,{liveSnap:!t.altKey});return}if(t.key==="Delete"||t.key==="Backspace"){let I=this._selection&&this._selection.size?Array.from(this._selection):[];if(!I.length)return;t.preventDefault(),I.forEach(C=>C.remove()),(d=this._clearSelection)==null||d.call(this),(f=this._resizeContainer)==null||f.call(this),(v=this._queueSave)==null||v.call(this,"delete-key"),(m=this._ensurePlaceholderIfEmpty)==null||m.call(this);return}if((t.ctrlKey||t.metaKey)&&(t.key==="d"||t.key==="D")){t.preventDefault(),await this._duplicateSelection_();return}if((t.ctrlKey||t.metaKey)&&t.key==="]"){t.preventDefault(),this._selection&&((g=(_=this._selection).forEach)==null||g.call(_,I=>{var C;return(C=this._adjustZ)==null?void 0:C.call(this,I,1)})),(k=this._queueSave)==null||k.call(this,"z-up");return}if((t.ctrlKey||t.metaKey)&&t.key==="["){t.preventDefault(),this._selection&&((E=(z=this._selection).forEach)==null||E.call(z,I=>{var C;return(C=this._adjustZ)==null?void 0:C.call(this,I,-1)})),(L=this._queueSave)==null||L.call(this,"z-down");return}}async _duplicateSelection_(){var a,o,l,c,d,f,v,m,_,g,k,z;if(!this._selection||!this._selection.size)return;let t=Array.from(this._selection);for(let E of t)try{let L=((a=this._extractCardConfig)==null?void 0:a.call(this,E.firstElementChild))||{},I=await((o=this._createCard)==null?void 0:o.call(this,L)),C=(l=this._makeWrapper)==null?void 0:l.call(this,I);if(!I||!C)continue;C.style.width=E.style.width,C.style.height=E.style.height;let A=Number(this.gridSize||10),O=(parseFloat(E.getAttribute("data-x"))||0)+A,b=(parseFloat(E.getAttribute("data-y"))||0)+A;(c=this._setCardPosition)==null||c.call(this,C,O,b),C.style.zIndex=String((((d=this._highestZ)==null?void 0:d.call(this))||0)+1);try{let M=(f=E.dataset)==null?void 0:f.tabId;M&&(C.dataset.tabId=M)}catch{}(v=this.cardContainer)==null||v.appendChild(C);try{(m=this._addTabSelectorToChip)==null||m.call(this,C,C.dataset.tabId)}catch{}try{(_=this._rebuildOnce)==null||_.call(this,C.firstElementChild)}catch{}try{(g=this._initCardInteract)==null||g.call(this,C)}catch{}}catch{}try{(k=this._resizeContainer)==null||k.call(this)}catch{}try{(z=this._queueSave)==null||z.call(this,"duplicate")}catch{}}_moveSelectionBy_(t,a,{liveSnap:o=!0}={}){var m,_,g,k,z;if(!this._selection||!this._selection.size)return;let l=Array.from(this._selection),c=Number(this.gridSize||10),d=(m=this._isContainerFixed)==null?void 0:m.call(this),f=((_=this._getContainerSize)==null?void 0:_.call(this))||{w:1/0,h:1/0},v=l.map(E=>{let L=parseFloat(E.getAttribute("data-x-raw"))||parseFloat(E.getAttribute("data-x"))||0,I=parseFloat(E.getAttribute("data-y-raw"))||parseFloat(E.getAttribute("data-y"))||0,C=parseFloat(E.style.width)||E.getBoundingClientRect().width,A=parseFloat(E.style.height)||E.getBoundingClientRect().height,O=L+t,b=I+a;d&&(O=Math.max(0,Math.min(O,Math.max(0,f.w-C))),b=Math.max(0,Math.min(b,Math.max(0,f.h-A))));let M=o?Math.round(O/c)*c:O,R=o?Math.round(b/c)*c:b;return{el:E,rawX:O,rawY:b,snapX:M,snapY:R,w:C,h:A}});if(this.disableOverlap&&typeof this._pushCardsOutOfTheWay=="function")try{this._pushCardsOutOfTheWay(v,t,a,o,c)}catch{}for(let E of v){E.el.setAttribute("data-x-raw",String(E.rawX)),E.el.setAttribute("data-y-raw",String(E.rawY));try{(g=this._setCardPosition)==null||g.call(this,E.el,E.snapX,E.snapY)}catch{}}try{(k=this._resizeContainer)==null||k.call(this)}catch{}try{(z=this._queueSave)==null||z.call(this,"nudge")}catch{}}_syncTabsWidth_(){try{let t=this.tabsBar;if(!t)return;if(this.tabsPosition==="left"){t.style.width="",t.style.maxWidth="";return}let a=this.cardContainer||this.__scaleOuter;if(!a)return;let o=0;try{let l=a.getBoundingClientRect();o=l&&l.width?l.width:0}catch{}if(o<=0&&this.__scaleOuter&&this.__scaleOuter!==a)try{let l=this.__scaleOuter.getBoundingClientRect();o=l&&l.width?l.width:0}catch{}o>0&&(t.style.width=`${o}px`,t.style.maxWidth=`${o}px`)}catch{}}_isTypingTarget_(t){var l,c,d,f;if(!t||t===window||t===document)return!1;let a=(l=t.closest)==null?void 0:l.call(t,'input, textarea, [contenteditable="true"], ha-textfield, mwc-textfield');if(!a)return!1;let o=((d=(c=a.tagName)==null?void 0:c.toLowerCase)==null?void 0:d.call(c))||"";return o==="input"||o==="textarea"||((f=a.hasAttribute)==null?void 0:f.call(a,"contenteditable"))}_scheduleReflowAndScale(){this.__reflowRAF||(this.__reflowRAF=requestAnimationFrame(()=>{var t,a;this.__reflowRAF=null;try{(this.containerSizeMode||this.container_size_mode||"dynamic").toLowerCase()==="dynamic"&&((t=this._resizeContainer)==null||t.call(this))}catch{}try{(a=this._applyAutoScale)==null||a.call(this)}catch{}}))}__ddcBindPointerListeners(){if(!this.__ddcPtrBound){this.__ddcPtrBound=!0,this.__onDDCPointerDown=t=>{var a,o;try{if(t.button!==void 0&&t.button!==0)return;let l=((a=t.composedPath)==null?void 0:a.call(t))||[],c=null;for(let d of l)if(d&&d.classList&&d.classList.contains("card-wrapper")){c=d;break}if(!c)return;this.__ddcDragging=!0,this.__scaleOuter&&(this.__prevOverflow=this.__scaleOuter.style.overflow,this.__scaleOuter.style.overflow="visible"),(o=this._scheduleReflowAndScale)==null||o.call(this)}catch{}},this.__onDDCPointerMove=t=>{var a;try{if(!this.__ddcDragging)return;(a=this._scheduleReflowAndScale)==null||a.call(this)}catch{}},this.__onDDCPointerUp=t=>{var a;try{if(!this.__ddcDragging)return;this.__ddcDragging=!1,this.__scaleOuter&&(this.__scaleOuter.style.overflow=this.__prevOverflow||"");try{(a=this._applyAutoScale)==null||a.call(this)}catch{}}catch{}};try{this.addEventListener("pointerdown",this.__onDDCPointerDown,{passive:!0})}catch{}try{this.addEventListener("pointermove",this.__onDDCPointerMove,{passive:!0})}catch{}try{window.addEventListener("pointerup",this.__onDDCPointerUp,{passive:!0})}catch{}try{window.addEventListener("pointercancel",this.__onDDCPointerUp,{passive:!0})}catch{}}}_renderEditToolbar_(){this.shadowRoot.querySelectorAll(".ddc-toolbar").forEach(g=>g.remove()),this._ensureToolbarStyles_();let t=document.createElement("div");t.className="ddc-toolbar";let a=document.createElement("div");a.className="ddc-t-group",a.append(this._mkBtn_("add_card","mdi:plus-box","Add card (A)","primary"),this._mkBtn_("snap_toggle","mdi:magnet","Toggle snap (G)"),this._mkBtn_("align_grid","mdi:grid","Align to grid"));let o=document.createElement("div");o.className="ddc-t-group";let l=document.createElement("div");l.className="ddc-t-status";let c=document.createElement("div");c.className="ddc-t-dot"+(this.__dirty?" dirty":"");let d=document.createElement("span");d.textContent=this.__dirty?"Unsaved changes":`Saved${this.__lastSavedAt?" \xB7 "+this.__lastSavedAt:""}`,l.append(c,d),o.appendChild(l);let f=document.createElement("div");f.className="ddc-t-group",f.append(this._mkBtn_("reload","mdi:refresh","Reload (R)","ghost"),this._mkBtn_("open_hads","mdi:alpha-h-box-outline","Open HACS/HADS","ghost"),this._mkBtn_("apply","mdi:content-save","Apply / Save (S)","primary"),this._mkBtn_("exit_edit","mdi:logout-variant","Exit edit (Esc)","danger"));let v=document.createElement("div");v.className="ddc-t-group ddc-t-row",v.append(a);let m=document.createElement("div");m.className="ddc-t-group ddc-t-row",m.append(o);let _=document.createElement("div");_.className="ddc-t-group ddc-t-row",_.append(f),t.append(v,document.createElement("div")).lastChild.className="ddc-t-sep",t.append(m,document.createElement("div")).lastChild.className="ddc-t-sep",t.append(_),t.addEventListener("click",g=>{let k=g.target.closest("[data-action]");k&&this._onToolbarAction_(k.dataset.action,{button:k,bar:t,dot:c,txt:d})}),this.shadowRoot.appendChild(t);try{this.__toolbarRO&&this.__toolbarRO.disconnect(),this.__toolbarRO=new ResizeObserver(g=>{for(let k of g)t.classList.toggle("compact",k.contentRect.width<980)}),this.__toolbarRO.observe(t)}catch{}this.__toolbarKeyHandler=g=>{if(!(!this.editMode&&!this.isEditing)){if(g.key==="a"||g.key==="A")return this._onToolbarAction_("add_card");if(g.key==="s"||g.key==="S")return this._onToolbarAction_("apply");if(g.key==="r"||g.key==="R")return this._onToolbarAction_("reload");if(g.key==="g"||g.key==="G")return this._onToolbarAction_("snap_toggle");if(g.key==="Escape")return this._onToolbarAction_("exit_edit")}},window.addEventListener("keydown",this.__toolbarKeyHandler)}async _onToolbarAction_(t,a={}){var o,l,c,d,f,v,m,_,g,k,z;switch(t){case"add_card":(o=this._openAddCardDialog_)!=null&&o.call(this)||(l=this._addNewCard_)!=null&&l.call(this)||((c=this._openEntityPicker_)==null||c.call(this));break;case"snap_toggle":{this.dragLiveSnap=!this.dragLiveSnap,(d=this._initInteract)==null||d.call(this),(f=this._toast_)==null||f.call(this,`Live snap ${this.dragLiveSnap?"ON":"OFF"}`);break}case"align_grid":(v=this._alignAllToGrid_)==null||v.call(this,this.gridSize);break;case"reload":(m=this._reloadLayout_)==null||m.call(this);break;case"open_hads":(_=this._openHACS_)!=null&&_.call(this)||window.open("/hacs","_blank")||window.open("/hacsfiles","_blank");break;case"apply":{let E=()=>{this._setDirty_(!1),a!=null&&a.txt&&(a.txt.textContent=`Saved \xB7 ${this.__lastSavedAt}`),a!=null&&a.dot&&a.dot.classList.remove("dirty","error")},L=()=>{a!=null&&a.dot&&a.dot.classList.add("error")};try{this._saveLayoutNow_?await this._saveLayoutNow_():this._persistThisCardConfigToStorage_?await this._persistThisCardConfigToStorage_():(g=this._queueSave)==null||g.call(this,"toolbar-apply",!0),this.__lastSavedAt=new Date().toLocaleTimeString(),E()}catch(I){console.warn(I),L()}break}case"exit_edit":if((k=this._toggleEditMode)!=null&&k.call(this,!1)||(z=this._exitEditMode_)!=null&&z.call(this)||(this.isEditing=!1),this.__toolbarKeyHandler&&(window.removeEventListener("keydown",this.__toolbarKeyHandler),this.__toolbarKeyHandler=null),this.__toolbarRO){try{this.__toolbarRO.disconnect()}catch{}this.__toolbarRO=null}this.shadowRoot.querySelectorAll(".ddc-toolbar").forEach(E=>E.remove());break}}_ensureScaleWrapper(){let t=this.cardContainer;if(!t||this.__scaleOuter&&this.__scaleOuter.contains(t))return;let a=document.createElement("div");a.className="ddc-scale-outer",Object.assign(a.style,{position:"relative",width:"100%",overflow:"hidden"}),t.parentNode&&(t.parentNode.insertBefore(a,t),a.appendChild(t)),Object.assign(t.style,{position:"absolute",top:"0",left:"0",transformOrigin:"top left"}),this.__scaleOuter=a}_hasCardModDeep(t){try{if(!t||typeof t!="object")return!1;if(t.card_mod||t.type==="custom:mod-card")return!0;if(t.card)return this._hasCardModDeep(t.card);if(Array.isArray(t.cards)){for(let a of t.cards)if(this._hasCardModDeep(a))return!0}return!1}catch{return!1}}_rebuildOnce(t){try{if(!t||(this.__rebuiltCards||(this.__rebuiltCards=new WeakSet),this.__rebuiltCards.has(t)))return;this.__rebuiltCards.add(t),t.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}}_deepQueryAll(t,a=document){let o=[],l=c=>{if(!c)return;if(c.querySelectorAll)try{c.querySelectorAll(t).forEach(v=>o.push(v))}catch{}let d=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,null),f=c;for(;f;){let v=f.shadowRoot;v&&l(v),f=d.nextNode()}};return l(a),o}_syncEditorsStorageKey(){try{let t=this.storageKey||"";this._deepQueryAll("#storage_key").forEach(o=>{try{o&&o.tagName==="INPUT"&&o.value!==t&&(o.value=t,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}})}catch{}}static _genKey(){var a,o;return`layout_${((o=(a=globalThis.crypto)==null?void 0:a.randomUUID)==null?void 0:o.call(a))||`${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}`}static getStubConfig(){return{type:"custom:drag-and-drop-card",storage_key:this._genKey(),grid:10,drag_live_snap:!1,auto_save:!0,auto_save_debounce:800,container_size_mode:"dynamic",hero_image:"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png"}}static getConfigElement(){let t=document.createElement("div");t.innerHTML=`
    <style>
      :host, .ddc-editor { font-family: var(--paper-font-body1_-_font-family, Roboto, system-ui, sans-serif); color: var(--primary-text-color); }

      .ddc-editor { display: grid; grid-template-columns: 220px 1fr; gap: 10px 16px; align-items: center; box-sizing: border-box; padding: 8px 4px; }
      .section { grid-column: 1 / -1; margin: 10px 0 2px; font-weight: 600; opacity: 0.9; }
      .row-spacer { grid-column: 1 / -1; height: 2px; background: var(--divider-color); opacity: .2; border-radius: 2px; }

      .label { align-self: flex-start; padding-top: 6px; font-weight: 600; opacity: .9; }
      .helper { grid-column: 2 / 3; font-size: .85rem; opacity: .7; margin-top: -6px; }

      .inline { display: inline-flex; align-items: center; gap: 8px; }
      .two-col { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }

      .actions { grid-column: 1 / -1; display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px; }
      .actions ha-button[disabled] { opacity: .6; }

      /* Subtle pulse for enabled Apply button */
      @keyframes ddcPulse {
        0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0,0,0,0); }
        50% { transform: scale(1.035); box-shadow: 0 0 12px 2px rgba(255,255,255,.22); }
      }
      #applyBtn:not([disabled]) { animation: ddcPulse 1.8s ease-in-out infinite; }

      /* Make HA inputs fill width nicely */
      ha-textfield, ha-select { width: 100%; }

      /* Checkbox rows: keep left column reserved so alignment stays consistent */
      .left-empty { visibility: hidden; }

</style>

     <div class="ddc-editor">
      <div class="section">Layout & Behavior</div>

      <div class="label">Storage key</div>
      <ha-textfield id="storage_key" label="Storage key" placeholder="my_unique_layout_key"></ha-textfield>
      <div class="helper">Unique key for saving layout positions. Auto-generated if empty.</div>

      <div class="label">Grid size</div>
      <ha-textfield id="grid" label="Grid (px)" type="number" min="4" max="32" step="1" value="10"></ha-textfield>
      <div class="helper">Pixel size of each grid cell. Affects snap and default card size.</div>

      <div class="label">Snap while dragging</div>
      <ha-formfield label="Snap to grid during drag (live)">
        <ha-checkbox id="liveSnap"></ha-checkbox>
      </ha-formfield>
      <div class="helper">If on, elements snap to grid while dragging. If off, snap occurs on drop.</div>

      <div class="label">Auto-save</div>
      <div class="two-col">
        <ha-formfield label="Auto-save changes">
          <ha-checkbox id="autoSave"></ha-checkbox>
        </ha-formfield>
        <ha-textfield id="autoSaveDebounce" label="Debounce (ms)" type="number" min="0" step="50" value="800"></ha-textfield>
      </div>
      <div class="helper">When enabled, layout changes are saved automatically after a short delay.</div>

      <div class="row-spacer"></div>
      <div class="section">Appearance</div>

      <div class="label">Container background</div>
      <ha-textfield id="containerBg" label="CSS color/gradient" placeholder="transparent, #232f3e, linear-gradient(...)" helper=""></ha-textfield>
      <div class="helper">Examples: <code>transparent</code>, <code>#232f3e</code>, <code>linear-gradient(...)</code>.</div>

      <div class="label">Card background</div>
      <ha-textfield id="cardBg" label="CSS color/gradient" placeholder="var(--ha-card-background) or #ffffffcc"></ha-textfield>
      <div class="helper">Background for each card in the layout; can use theme vars.</div>

      <div class="label">Debug logs</div>
      <ha-formfield label="Enable console debug">
        <ha-checkbox id="debug"></ha-checkbox>
      </ha-formfield>

      <div class="label">Disable overlap</div>
      <ha-formfield label="Prevent cards from overlapping">
        <ha-checkbox id="noOverlap"></ha-checkbox>
      </ha-formfield>

      <div class="label">Auto-resize cards</div>
      <ha-formfield label="Scale layout to fit parent (view mode)">
        <ha-checkbox id="autoResize"></ha-checkbox>
      </ha-formfield>

      <div class="label">Animate cards</div>
      <ha-formfield label="Animate cards on tab switch">
        <ha-checkbox id="animateCards"></ha-checkbox>
      </ha-formfield>
      <div class="helper">If enabled, cards will fly in when switching tabs or on refresh.</div>


      <div class="row-spacer"></div>
      <div class="section">Container Size</div>

      <div class="label">Mode</div>
      <ha-select id="sizeMode" label="Container size mode">
        <mwc-list-item value="dynamic">Dynamic (auto)</mwc-list-item>
        <mwc-list-item value="fixed_custom">Fixed (custom)</mwc-list-item>
        <mwc-list-item value="preset">Preset</mwc-list-item>
      </ha-select>

      <div class="label">Fixed size</div>
      <div class="inline" id="sizeCustom" style="display:none">
        <ha-textfield id="sizeW" type="number" label="W" min="100" step="10"></ha-textfield>
        <ha-textfield id="sizeH" type="number" label="H" min="100" step="10"></ha-textfield>
      </div>

      <div class="label">Preset</div>
      <div class="inline" id="sizePresetWrap" style="display:none">
        <ha-select id="sizePreset" label="Preset"></ha-select>
        <ha-select id="sizeOrientation" label="Orientation">
          <mwc-list-item value="auto">Auto</mwc-list-item>
          <mwc-list-item value="landscape">Landscape</mwc-list-item>
          <mwc-list-item value="portrait">Portrait</mwc-list-item>
        </ha-select>
      </div>

      <div class="actions">
        <ha-button id="revertBtn">Revert</ha-button>
        <ha-button id="applyBtn" raised disabled>Apply</ha-button>
      </div>
    </div>
  `;let a=()=>{let m=f();c.disabled=!m},o=()=>{let m=t.getConfig();t.dispatchEvent(new CustomEvent("config-changed",{detail:{config:m}})),a()},l=()=>{let m=t.querySelector("#sizeMode").value;t.querySelector("#sizeCustom").style.display=m==="fixed_custom"?"inline-flex":"none",t.querySelector("#sizePresetWrap").style.display=m==="preset"?"inline-flex":"none"},c=t.querySelector("#applyBtn"),d=t.querySelector("#revertBtn");["#sizeMode","#sizePreset","#sizeOrientation"].forEach(m=>{let _=t.querySelector(m);if(_){try{_.fixedMenuPosition=!0}catch{}_.addEventListener("closed",g=>g.stopPropagation())}}),t.setConfig=(m={})=>{var g,k,z,E,L,I,C,A;t._config={type:m.type||"custom:drag-and-drop-card",...m},t._config.storage_key||(t._config.storage_key=`layout_${((g=crypto==null?void 0:crypto.randomUUID)==null?void 0:g.call(crypto))||Date.now().toString(36)}`,t.__autokeyPending=!0),t.querySelector("#storage_key").value=t._config.storage_key||"",t.querySelector("#grid").value=(k=t._config.grid)!=null?k:10,t.querySelector("#liveSnap").checked=!!t._config.drag_live_snap,t.querySelector("#autoSave").checked=t._config.auto_save!==!1,t.querySelector("#autoSaveDebounce").value=(z=t._config.auto_save_debounce)!=null?z:800,t.querySelector("#containerBg").value=(E=t._config.container_background)!=null?E:"transparent",t.querySelector("#cardBg").value=(L=t._config.card_background)!=null?L:"var(--ha-card-background, var(--card-background-color))",t.querySelector("#debug").checked=!!t._config.debug,t.querySelector("#noOverlap").checked=!!t._config.disable_overlap,t.querySelector("#autoResize").checked=!!t._config.auto_resize_cards,t.querySelector("#animateCards").checked=!!t._config.animate_cards,t.querySelector("#sizeMode").value=t._config.container_size_mode||"dynamic",t.querySelector("#sizeW").value=(I=t._config.container_fixed_width)!=null?I:"",t.querySelector("#sizeH").value=(C=t._config.container_fixed_height)!=null?C:"",t.querySelector("#sizeOrientation").value=t._config.container_preset_orientation||"auto";let _=t.querySelector("#sizePreset");if(!_.__filled){let O=(((A=this._sizePresets)==null?void 0:A.call(this))||[]).reduce((b,M)=>{var R;return(b[R=M.group||"other"]||(b[R]=[])).push(M),b},{});_.innerHTML="";for(let[b,M]of Object.entries(O)){let R=document.createElement("optgroup");R.label=b.replace(/(^.|-.?)/g,F=>F.toUpperCase()),M.forEach(F=>{let K=document.createElement("mwc-list-item");K.value=F.key,K.textContent=`${F.label} (${F.w}\xD7${F.h})`,R.appendChild(K)});let Z=document.createElement("mwc-list-item");Z.setAttribute("disabled",""),Z.textContent=`\u2014 ${R.label} \u2014`,_.appendChild(Z),Array.from(R.children).forEach(F=>_.appendChild(F))}_.__filled=!0}t._config.container_preset&&(_.value=t._config.container_preset),l(),a(),t.__autokeyPending&&(t.__autokeyPending=!1,o())},t.getConfig=()=>{let m={...t._config||{}};return m.storage_key=t.querySelector("#storage_key").value||"",m.grid=Number(t.querySelector("#grid").value||10),m.drag_live_snap=!!t.querySelector("#liveSnap").checked,m.auto_save=!!t.querySelector("#autoSave").checked,m.auto_save_debounce=Number(t.querySelector("#autoSaveDebounce").value||800),m.container_background=t.querySelector("#containerBg").value||"transparent",m.card_background=t.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",m.debug=!!t.querySelector("#debug").checked,m.disable_overlap=!!t.querySelector("#noOverlap").checked,m.auto_resize_cards=!!t.querySelector("#autoResize").checked,m.animate_cards=!!t.querySelector("#animateCards").checked,m.container_size_mode=t.querySelector("#sizeMode").value,m.container_fixed_width=Number(t.querySelector("#sizeW").value||0)||void 0,m.container_fixed_height=Number(t.querySelector("#sizeH").value||0)||void 0,m.container_preset=t.querySelector("#sizePreset").value||void 0,m.container_preset_orientation=t.querySelector("#sizeOrientation").value||"auto",m};let f=()=>{let m=t.getConfig(),_=t._config||{};try{return JSON.stringify(m)!==JSON.stringify(_)}catch{return!0}},v=(m,_="input")=>{var g;return(g=t.querySelector(m))==null?void 0:g.addEventListener(_,()=>{m==="#sizeMode"&&l(),a()})};return v("#storage_key"),v("#grid"),v("#liveSnap","change"),v("#autoSave","change"),v("#autoSaveDebounce"),v("#containerBg"),v("#cardBg"),v("#debug","change"),v("#noOverlap","change"),v("#autoResize","change"),v("#animateCards","change"),v("#sizeMode","change"),v("#sizeW"),v("#sizeH"),v("#sizePreset","selected"),v("#sizeOrientation","selected"),c==null||c.addEventListener("click",()=>{o()}),d==null||d.addEventListener("click",()=>t.setConfig(t._config)),t}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let t=Math.max(100,Number(this.containerFixedWidth||0)),a=Math.max(100,Number(this.containerFixedHeight||0));return{w:t,h:a}}if(this.containerSizeMode==="preset"){let t=e._sizePresets().find(l=>l.key===this.containerPreset)||e._sizePresets().find(l=>l.key==="fhd");if(!t)return{w:1920,h:1080};let a=t.w,o=t.h;return this.containerPresetOrient==="portrait"&&a>o&&([a,o]=[o,a]),this.containerPresetOrient==="landscape"&&o>a&&([a,o]=[o,a]),{w:a,h:o}}return null}_applyContainerSizingFromConfig(t=!1){var o,l;let a=this.cardContainer;if(a)if(this._isContainerFixed()){let{w:c,h:d}=this._resolveFixedSize();a.style.width=`${c}px`,a.style.height=`${d}px`,a.style.overflow="hidden",t||(o=this._dbgPush)==null||o.call(this,"size","Applied fixed size",{w:c,h:d,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else a.style.overflow="hidden",t||(l=this._dbgPush)==null||l.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let t=this.cardContainer;if(!t)return{w:0,h:0};let a=parseFloat(getComputedStyle(t).width)||t.getBoundingClientRect().width,o=parseFloat(getComputedStyle(t).height)||t.getBoundingClientRect().height;return{w:a,h:o}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:t,h:a}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(l=>{let c=parseFloat(l.getAttribute("data-x"))||0,d=parseFloat(l.getAttribute("data-y"))||0,f=parseFloat(l.style.width)||l.getBoundingClientRect().width,v=parseFloat(l.style.height)||l.getBoundingClientRect().height,m=Math.max(0,Math.min(c,Math.max(0,t-f))),_=Math.max(0,Math.min(d,Math.max(0,a-v))),g=Math.min(f,t),k=Math.min(v,a);(g!==f||k!==v)&&(l.style.width=`${g}px`,l.style.height=`${k}px`);let z=Math.max(0,Math.min(m,Math.max(0,t-g))),E=Math.max(0,Math.min(_,Math.max(0,a-k)));this._setCardPosition(l,z,E)})}_applyGridVars(){var a;let t=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",t),(a=this.cardContainer)==null||a.style.setProperty("--ddc-grid-size",t)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(t,a,o=null){let l={t:new Date().toISOString(),kind:t,msg:a,extra:o};this._dbgBuffer.push(l),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${t}]%c ${a}`,"color:#03a9f4","color:unset",o!=null?o:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(t){return String(t).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}setConfig(t={}){var l,c,d,f,v,m,_,g,k,z,E,L,I,C,A,O,b,M,R,Z,F,K;let a=this.storageKey;this.config={...t},(!this.config.storage_key||this.config.storage_key==="")&&(this.config.storage_key=this.constructor._genKey()),this.storageKey=this.config.storage_key,t.storage_key||(this.storageKey?t={...t,storage_key:this.storageKey}:(this.storageKey=`layout_${((l=crypto==null?void 0:crypto.randomUUID)==null?void 0:l.call(crypto))||Date.now().toString(36)}`,t={...t,storage_key:this.storageKey})),this._config=t,this.storageKey=t.storage_key,this._syncEditorsStorageKey(),this.storageKey=t.storage_key||void 0,this._syncEditorsStorageKey(),this.gridSize=Number((c=t.grid)!=null?c:10),this.dragLiveSnap=!!t.drag_live_snap,this.autoSave=t.auto_save!==!1,this.autoSaveDebounce=Number((d=t.auto_save_debounce)!=null?d:800),this.containerBackground=(f=t.container_background)!=null?f:"transparent",this.cardBackground=(v=t.card_background)!=null?v:"var(--ha-card-background, var(--card-background-color))",this.hideHaHeader=!!((_=(m=t.hide_HA_Header)!=null?m:t.hide_ha_header)!=null&&_),this.hideHaSidebar=!!((k=(g=t.hide_HA_Sidebar)!=null?g:t.hide_ha_sidebar)!=null&&k),this.debug=!!t.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!t.disable_overlap,this.containerSizeMode=t.container_size_mode||"dynamic",this.autoResizeCards=!!t.auto_resize_cards,this.animateCards=!!t.animate_cards,this.autoResizeCards?(z=this._startScaleWatch)==null||z.call(this):(E=this._stopScaleWatch)==null||E.call(this),(L=this._applyAutoScale)==null||L.call(this),this.containerFixedWidth=Number((I=t.container_fixed_width)!=null?I:0)||null,this.containerFixedHeight=Number((C=t.container_fixed_height)!=null?C:0)||null,this.containerPreset=t.container_preset||"fullhd",this.containerPresetOrient=t.container_preset_orientation||"auto",this.heroImage=(t==null?void 0:t.hero_image)||"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png",this.tabs=Array.isArray(t.tabs)?t.tabs:[],this.tabsPosition=t.tabs_position==="left"?"left":"top",this.defaultTab=t.default_tab||((O=(A=this.tabs[0])==null?void 0:A.id)!=null?O:"default"),this.hideTabsWhenSingle=t.hide_tabs_when_single!==!1,this.activeTab=this.defaultTab;try{let ie=localStorage.getItem(`ddc_lasttab_${this.storageKey}`);ie&&this.tabs.some(G=>G.id===ie)&&(this.activeTab=ie)}catch{}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left"),this.cardContainer&&this._applyContainerSizingFromConfig(!1);let o=a!==this.storageKey;if(this.editMode&&!this.__booting&&!o)try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._applyGridVars();try{(b=this._applyBackgroundImageFromConfig)==null||b.call(this)}catch{}try{(M=this._applyHaChromeVisibility_)==null||M.call(this)}catch{}if(this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:t.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let ie=document.createElement("script");ie.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(ie)}if(!window.interact){let ie=document.createElement("script");ie.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",ie.onload=()=>this._initInteract(),document.head.appendChild(ie)}if(this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),!this._built){this._built=!0,this.shadowRoot.innerHTML=`
        <style>
.ddc-root{
  position:relative;
  /* JS will keep this in sync with your \u201CGrid (px)\u201D */
  --ddc-grid-size: 10px;
  /* Good contrast on light/dark themes */
  --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);

  /* Container we query for width */
  container-type: inline-size;
  container-name: ddc-root;
}

/* ===== DDC Toolbar \u2014 Minimal Redesign (pills with accent tint) ===== */

/* scope to either version */
.ddc-toolbar.streamlined.v2,
.ddc-toolbar.streamlined.v3{
  --ddc-bg: color-mix(in oklab, var(--card-background-color, #0d0f12) 88%, transparent);
  --ddc-border: color-mix(in oklab, #fff 14%, transparent);
  --ddc-soft: color-mix(in oklab, #fff 7%, transparent);
  --ddc-shadow: 0 10px 30px rgba(0,0,0,.25), 0 2px 8px rgba(0,0,0,.22);

  /* section accent colors */
  --sec-primary: #3b82f6;
  --sec-clip:    #a855f7;
  --sec-share:   #4fb6ff;
  --sec-utils:   #10b981;
  --sec-status:  #ef4444;

  --btn-h: 36px;
  --btn-r: 12px;
  --btn-gap: 8px;

  /* animation vars */
  --ddc-ease: cubic-bezier(.2,.7,.2,1);
  --ddc-dur: 260ms;
  --open-h: 0px; /* JS sets this to scrollHeight */

  position: sticky; top: 0; z-index: 50;
  background: var(--ddc-bg);
  border-bottom: 1px solid var(--ddc-border);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  box-shadow: var(--ddc-shadow);
  padding: 12px 14px 10px;

  /* never exceed the root\u2019s width */
  max-width: 100%;

  /* GRID (kept ready) */
  display: grid;
  grid-template-columns: repeat(4, minmax(0,1fr)) auto; /* Status at the end */
  grid-template-areas:
    "primary clip share utils status"
    "layouts layouts layouts layouts status";
  column-gap: 18px;
  row-gap: 10px;
  align-items: start;

  /* Visibility is animated \u2014 NOT display */
  opacity: 0;
  transform: translateY(-6px);
  max-height: 0;              /* collapse when closed */
  overflow: clip;             /* avoid scrollbars during anim */
  pointer-events: none;       /* inert when closed */
  visibility: hidden;         /* keep out of a11y focus when closed */

  transition:
    opacity var(--ddc-dur) var(--ddc-ease),
    transform var(--ddc-dur) var(--ddc-ease),
    max-height var(--ddc-dur) var(--ddc-ease),
    visibility 0s linear var(--ddc-dur); /* becomes hidden after fade-out */

  /* make this element respond to its own width, too */
  container-type: inline-size;
  container-name: ddc;
}

/* OPEN state (set by JS) */
.ddc-toolbar.streamlined.v2.is-open,
.ddc-toolbar.streamlined.v3.is-open{
  opacity: 1;
  transform: translateY(0);
  max-height: var(--open-h);  /* expand to measured height */
  pointer-events: auto;
  visibility: visible;
  transition:
    opacity var(--ddc-dur) var(--ddc-ease),
    transform var(--ddc-dur) var(--ddc-ease),
    max-height var(--ddc-dur) var(--ddc-ease),
    visibility 0s; /* visible immediately */
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .ddc-toolbar.streamlined.v2,
  .ddc-toolbar.streamlined.v3{
    transition: none;
  }
}

/* map areas (HTML unchanged) */
.ddc-toolbar.streamlined.v2 .sec-primary{ grid-area: primary; }
.ddc-toolbar.streamlined.v2 .sec-clip   { grid-area: clip; }
.ddc-toolbar.streamlined.v2 .sec-share  { grid-area: share; }
.ddc-toolbar.streamlined.v2 .sec-utils  { grid-area: utils; }
.ddc-toolbar.streamlined.v2 .sec-status { grid-area: status; }
.ddc-toolbar.streamlined.v2 .sec-layouts{ grid-area: layouts; }
.ddc-toolbar.streamlined.v2 .ddc-spacer,
.ddc-toolbar.streamlined.v2 .ddc-vsep{ display:none; }

/* === ONE-PILL PER SECTION: header + buttons inside === */
.ddc-toolbar.streamlined.v2 .ddc-sec,
.ddc-toolbar.streamlined.v3 .ddc-sec{
  --pill-accent: #6b7280;            /* default; overridden per-section below */

  display: flex; flex-direction: column; gap: 10px; min-width: 0;
  padding: 12px 14px;
  border-radius: 16px;

  /* accent-tinted background & border */
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--pill-accent) 12%, transparent),
      transparent),
    color-mix(in oklab, var(--primary-background-color, #0e1116) 22%, transparent);
  border: 1px solid color-mix(in oklab, var(--pill-accent) 26%, transparent);
  box-shadow: inset 0 1px 2px rgba(255,255,255,.04);
}

/* per-section tint */
.ddc-toolbar.streamlined.v2 .sec-primary{ --pill-accent: var(--sec-primary); }
.ddc-toolbar.streamlined.v2 .sec-clip   { --pill-accent: var(--sec-clip); }
.ddc-toolbar.streamlined.v2 .sec-share  { --pill-accent: var(--sec-share); }
.ddc-toolbar.streamlined.v2 .sec-utils  { --pill-accent: var(--sec-utils); }
.ddc-toolbar.streamlined.v2 .sec-status { --pill-accent: var(--sec-status); }
.ddc-toolbar.streamlined.v2 .sec-layouts{ --pill-accent: var(--sec-clip); } /* layouts gets a gentle purple tint */

/* header inside the pill */
.ddc-toolbar.streamlined.v2 .ddc-sec-head{
  background: transparent; border: 0; padding: 0; border-radius: 0;
  color: var(--accent, #9aa0a6);
  display: inline-flex; align-items: center; gap: 10px;
  font-weight: 700; font-size: .92rem; letter-spacing: .2px;
}
.ddc-toolbar.streamlined.v2 .sec-primary .ddc-sec-head{ --accent: var(--sec-primary); color: var(--sec-primary); }
.ddc-toolbar.streamlined.v2 .sec-clip    .ddc-sec-head{ --accent: var(--sec-clip);    color: var(--sec-clip); }
.ddc-toolbar.streamlined.v2 .sec-share   .ddc-sec-head{ --accent: var(--sec-share);   color: var(--sec-share); }
.ddc-toolbar.streamlined.v2 .sec-utils   .ddc-sec-head{ --accent: var(--sec-utils);   color: var(--sec-utils); }
.ddc-toolbar.streamlined.v2 .sec-status  .ddc-sec-head{ --accent: var(--sec-status);  color: var(--sec-status); }
.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-sec-head{ --accent: var(--sec-clip);    color: var(--sec-clip); }

.ddc-toolbar.streamlined.v2 .ddc-sec-dot{
  width: 8px; height: 8px; border-radius: 50%; background: currentColor; opacity: .95;
}

/* row of actions inside the pill */
.ddc-toolbar.streamlined.v2 .ddc-row{ display: flex; flex-wrap: wrap; align-items: center; gap: var(--btn-gap); margin: 0; }

/* buttons (reset native look + style) */
.ddc-toolbar.streamlined.v2 .btn{
  appearance:none; -webkit-appearance:none;
  display:inline-flex; align-items:center; gap:8px;
  height:var(--btn-h); padding:8px 12px; border-radius:var(--btn-r);
  background: color-mix(in oklab, var(--primary-background-color, #0e1116) 14%, transparent);
  border:1px solid var(--ddc-border);
  color: var(--primary-text-color, #e5e7eb);
  cursor:pointer; font:inherit; white-space:nowrap;
  transition: transform .08s, background .16s, border-color .16s, box-shadow .16s;
  flex: 1 1 220px;           /* equal-ish width buttons and wrap nicely */
  min-width: 160px;
}
.ddc-toolbar.streamlined.v2 .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px; display:inline-block; }
.ddc-toolbar.streamlined.v2 .btn:hover{ transform: translateY(-1px); background: color-mix(in oklab, var(--primary-background-color) 22%, transparent); }
.ddc-toolbar.streamlined.v2 .btn:active{ transform: translateY(0); }
.ddc-toolbar.streamlined.v2 .btn:focus-visible{ outline:none; box-shadow:0 0 0 2px color-mix(in oklab, #fff 15%, transparent); }
.ddc-toolbar.streamlined.v2 .btn.secondary{ background:transparent; }
.ddc-toolbar.streamlined.v2 .btn.info{
  background: color-mix(in oklab, var(--sec-share) 92%, transparent); color:#0b2537;
  border-color: color-mix(in oklab, var(--sec-share) 55%, transparent);
}
.ddc-toolbar.streamlined.v2 .btn.danger{
  background: color-mix(in oklab, #ff5d5d 92%, transparent); color:#2b0b0b;
  border-color: color-mix(in oklab, #ff5d5d 55%, transparent);
}

/* >>> Make "Add Card" extra prominent */
.ddc-toolbar.streamlined.v2 .btn.cta-add{
  --glow: color-mix(in oklab, var(--sec-primary) 65%, #fff 0%);
  height: 40px; padding: 10px 14px; border-radius: 14px;
  font-weight: 800; letter-spacing: .2px;
  background: linear-gradient(135deg, var(--sec-primary), color-mix(in oklab, var(--sec-primary) 60%, #fff 0%));
  color:#fff;
  border-color: color-mix(in oklab, var(--sec-primary) 55%, #000);
  box-shadow: 0 10px 24px rgba(59,130,246,.34), 0 0 0 2px color-mix(in oklab, var(--sec-primary) 22%, transparent) inset;
  flex-basis: 100%;  /* spans full row when wrapping */
}
.ddc-toolbar.streamlined.v2 .btn.cta-add::after{
  content:""; position:absolute; inset:-4px; border-radius:16px;
  border:2px solid color-mix(in oklab, var(--sec-primary) 45%, transparent);
  opacity:.6; pointer-events:none;
}

/* status: dot above text, HIGH-CONTRAST text */
.ddc-toolbar.streamlined.v2 .ddc-t-status{
  display:flex; flex-direction: column; align-items:center; justify-content:center;
  gap: 4px; text-align: center;
  min-width: 120px; height: auto; padding: 10px 12px; border-radius: 999px;
  background: color-mix(in oklab, var(--primary-background-color, #0b0d10) 28%, transparent);
  border: 1px solid color-mix(in oklab, #ffffff 28%, transparent);
  color: #f8fbff;  /* brighter default */
  font-size: .9rem; line-height: 1.25; font-weight: 700;
  text-shadow: 0 1px 1px rgba(0,0,0,.45);
}
.ddc-toolbar.streamlined.v2 .ddc-t-status .ddc-t-text{ color: #f8fbff; }
.ddc-toolbar.streamlined.v2 .ddc-t-dot{ width: 12px; height: 12px; border-radius:50%; background:#22c55e; }
.ddc-toolbar.streamlined.v2 .ddc-t-status.warn  .ddc-t-dot{ background:#f59e0b; }
.ddc-toolbar.streamlined.v2 .ddc-t-status.error .ddc-t-dot{ background:#ef4444; }
@keyframes ddc-pulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.35)} }

/* store badge (optional) */
.ddc-toolbar.streamlined.v2 .store-badge{
  display:inline-flex; align-items:center; height:var(--btn-h);
  border:1px solid var(--ddc-border); border-radius:999px; padding:6px 10px; font-size:.85rem;
  background: color-mix(in oklab, #ffc107 22%, transparent); color:#1a1200;
  flex: 1 1 220px; min-width: 160px;
}

/* Layouts: inline switcher styling */
.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-row.center{ display:flex; justify-content:center; gap:12px; flex-wrap: wrap; }
.ddc-toolbar.streamlined.v2 .sec-layouts .layout-host{ display:inline-flex; align-items:center; gap:10px; color:#cfd6de; }
.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline{
  display:inline-flex; align-items:center; gap:10px; flex-wrap: wrap;
  padding:8px 10px; border-radius:12px;
  background: color-mix(in oklab, var(--primary-background-color, #0e1116) 14%, transparent);
  border: 1px solid color-mix(in oklab, #ffffff 14%, transparent);
}
.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline .label{
  color:#cfd6de; font-size:.9rem; letter-spacing:.2px;
}
.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline button,
.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline .btn{
  appearance:none; -webkit-appearance:none;
  display:inline-flex; align-items:center; gap:8px;
  height:32px; padding:6px 10px; border-radius:10px;
  background: color-mix(in oklab, var(--primary-background-color, #0e1116) 10%, transparent);
  border:1px solid color-mix(in oklab, #ffffff 12%, transparent);
  color: var(--primary-text-color, #e5e7eb);
  cursor:pointer; font:inherit; white-space:nowrap;
  transition: transform .08s, background .16s, border-color .16s, box-shadow .16s;
}

/* JS shim to override default hidden state purely for measuring/animating */
.ddc-toolbar.streamlined.v2[data-force-open="1"],
.ddc-toolbar.streamlined.v3[data-force-open="1"]{
  display: grid !important;
}

/* ===== STACK WHEN ROOT IS NARROW (uses .ddc-root width) ===== */
@container ddc-root (max-width: 900px){
  .ddc-toolbar.streamlined.v2,
  .ddc-toolbar.streamlined.v3{
    /* when narrow, just stack pills under each other */
    display: block;
    padding: 10px;
  }

  .ddc-toolbar.streamlined.v2 > .ddc-sec,
  .ddc-toolbar.streamlined.v3 > .ddc-sec{
    display: block;
    width: 100%;
    margin: 0 0 12px 0;
    grid-area: auto !important;  /* neutralize named areas */
  }

  .ddc-toolbar.streamlined.v2 .ddc-row,
  .ddc-toolbar.streamlined.v3 .ddc-row{
    display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; width: 100%;
  }

  .ddc-toolbar.streamlined.v2 .ddc-row > .btn,
  .ddc-toolbar.streamlined.v3 .ddc-row > .btn,
  .ddc-toolbar.streamlined.v2 .ddc-row > .store-badge,
  .ddc-toolbar.streamlined.v3 .ddc-row > .store-badge{
    flex: 1 1 calc(50% - 8px);
    min-width: 160px;
  }

  .ddc-toolbar.streamlined.v2 .ddc-row > .btn.cta-add,
  .ddc-toolbar.streamlined.v3 .ddc-row > .btn.cta-add{
    flex-basis: 100%;
  }

  .ddc-toolbar.streamlined.v2 .btn,
  .ddc-toolbar.streamlined.v3 .btn{ height: 44px; }
}

@container ddc-root (max-width: 560px){
  .ddc-toolbar.streamlined.v2 .ddc-row > .btn,
  .ddc-toolbar.streamlined.v3 .ddc-row > .btn,
  .ddc-toolbar.streamlined.v2 .ddc-row > .store-badge,
  .ddc-toolbar.streamlined.v3 .ddc-row > .store-badge{
    flex: 1 1 100%;
  }
}

/* Fallback for environments without container queries */
@supports not (container-type: inline-size){
  @media (max-width: 900px){
    .ddc-toolbar.streamlined.v2,
    .ddc-toolbar.streamlined.v3{
      display: block;
      padding: 10px;
    }
    .ddc-toolbar.streamlined.v2 > .ddc-sec,
    .ddc-toolbar.streamlined.v3 > .ddc-sec{
      display: block; width: 100%; margin: 0 0 12px 0; grid-area: auto !important;
    }
    .ddc-toolbar.streamlined.v2 .ddc-row,
    .ddc-toolbar.streamlined.v3 .ddc-row{
      display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; width: 100%;
    }
    .ddc-toolbar.streamlined.v2 .ddc-row > .btn,
    .ddc-toolbar.streamlined.v3 .ddc-row > .btn,
    .ddc-toolbar.streamlined.v2 .ddc-row > .store-badge,
    .ddc-toolbar.streamlined.v3 .ddc-row > .store-badge{
      flex: 1 1 calc(50% - 8px); min-width: 160px;
    }
    @media (max-width: 560px){
      .ddc-toolbar.streamlined.v2 .ddc-row > .btn,
      .ddc-toolbar.streamlined.v3 .ddc-row > .btn,
      .ddc-toolbar.streamlined.v2 .ddc-row > .store-badge,
      .ddc-toolbar.streamlined.v3 .ddc-row > .store-badge{
        flex: 1 1 100%;
      }
    }
  }
}

/* Optional: make sure all children use border-box inside the toolbar */
.ddc-toolbar.streamlined.v2 * ,
.ddc-toolbar.streamlined.v3 * { box-sizing: border-box; }








      /* ------- Rest of your styles remain unchanged ------- */

      .card-container{
        position: relative;
        transform-origin: top left;
        padding: 10px;
        border: 1px solid var(--divider-color);
        background: var(--ddc-bg, transparent);
        width: auto; height: auto; border-radius: 12px; overflow: hidden;
        isolation: isolate; z-index: 0; -webkit-touch-callout: none;
        user-select: none;
      }
      .card-container::before{
        content:'';
        position:absolute; inset:0;
        background-image:
          linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
          linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
        background-size: var(--ddc-grid-size) var(--ddc-grid-size);
        background-origin: content-box;
        background-clip: content-box;
        pointer-events:none;
        opacity:0;
        transition: opacity .15s;
        z-index:1;
      }
      .card-container.grid-on::before{ opacity:.28; }

      .card-container::after{
        content:'';
        position:absolute; inset:0;
        pointer-events:none;
        z-index:0;
        opacity: var(--ddc-bg-opacity, 1);
        background-image: var(--ddc-bg-image, none);
        background-repeat: var(--ddc-bg-repeat, no-repeat);
        background-size: var(--ddc-bg-size, cover);
        background-position: var(--ddc-bg-position, center center);
        background-attachment: var(--ddc-bg-attachment, scroll);
        filter: var(--ddc-bg-filter, none);
      }

      .card-wrapper{
        position:absolute;
        left: 0; top: 0;
        box-sizing: border-box;
        border:2px solid transparent;
        background:var(--ddc-card-bg, var(--card-background-color));
        cursor:grab;
        overflow:auto;
        border-radius:14px;
        box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
        will-change:transform,width,height,box-shadow; touch-action:auto;
        z-index:2;
      }
      .card-wrapper.dragging{ cursor:grabbing; touch-action: none; }
      .card-wrapper.editing.selected{
        border-color:var(--primary-color,#03a9f4);
        box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
      }

      /* ---- empty-state of the card ---- */
      .btn.cta-empty{
        position:relative;
        padding:12px 16px;
        font-weight:600;
        border-radius:14px;
        display:inline-flex !important;
        align-items:center;
        gap:8px;
        box-shadow:0 6px 18px rgba(3,169,244,.25);
      }
      .btn.cta-empty::after{
        content:"";
        position:absolute; inset:-4px;
        border-radius:16px;
        border:2px solid rgba(3,169,244,.35);
        animation: ddc-cta-pulse 1.8s ease-out infinite;
        pointer-events:none;
      }
      @keyframes ddc-cta-pulse{
        0%   { opacity:.85; transform:scale(.98); }
        70%  { opacity:0;   transform:scale(1.12); }
        100% { opacity:0;   transform:scale(1.18); }
      }

      /* pleasant buttons: info (light blue) & warning (orange) */
      .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
      .btn.info:active{ transform: translateY(0) }
      .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
      .btn.warning:active{ transform: translateY(0) }

      /* ---- chip ---- */
      .chip{
        position:absolute;
        bottom:48px; left:50%; transform:translateX(-50%);
        display:flex; gap:6px; flex-wrap:wrap;
        opacity:0; transition:opacity .15s;
        z-index:30; pointer-events: none;
      }
      .card-wrapper.editing .chip{ opacity:1; pointer-events: auto; }
      .chip .mini{
        display:flex; align-items:center; justify-content:center;
        width:32px; height:32px;
        background:linear-gradient(135deg, rgba(24,25,27,.7) 0%, rgba(40,41,43,.9) 100%);
        color:#fff; border:1px solid rgba(255,255,255,.18); border-radius:8px; cursor:pointer;
        box-shadow:0 2px 4px rgba(0,0,0,.25);
        transition:background .15s, transform .1s, box-shadow .15s;
      }
      .chip .mini span{ display:none; }
      .chip .mini:hover{
        transform:translateY(-1px);
        background:linear-gradient(135deg, rgba(24,25,27,.85) 0%, rgba(40,41,43,1) 100%);
        box-shadow:0 3px 8px rgba(0,0,0,.4);
      }
      .chip .mini ha-icon{ --mdc-icon-size:20px; width:20px; height:20px; }
      .chip .mini.danger{
        background:linear-gradient(135deg, rgba(236,72,72,.9) 0%, rgba(255,105,97,1) 100%);
        border-color:rgba(255,255,255,.22);
      }
      .chip .mini.danger:hover{
        background:linear-gradient(135deg, rgba(236,72,72,1) 0%, rgba(255,105,97,1) 100%);
      }
      .chip .mini.pill{ padding:0; }

      /* Edit highlight */
      .card-wrapper.editing{ border-color:var(--primary-color,#03a9f4); touch-action: none; }
      .card-wrapper.editing::after{
        content:""; position:absolute; inset:0; border:1px dashed var(--primary-color,#03a9f4);
        border-radius:12px; pointer-events:none; opacity:.35; z-index:5; box-sizing:border-box;
      }

      .shield{position:absolute; inset:0; z-index:10; background:transparent; pointer-events:none}
      .card-wrapper.editing .shield, .card-wrapper.dragging .shield{pointer-events:auto; cursor:grab}

      .resize-handle{
        display:none; position:absolute; bottom:0; right:0; width:40px; height:40px;
        background:var(--primary-color); color:#fff; border-top-left-radius:40px;
        cursor:se-resize; z-index:999; box-shadow:0 3px 8px rgba(0,0,0,.28);
        display:flex; align-items:center; justify-content:center;
        transition:background .15s, transform .1s, box-shadow .15s;
      }
      .resize-handle:hover{ transform:scale(1.05); box-shadow:0 6px 16px rgba(0,0,0,.35); filter:brightness(1.05); }
      .card-wrapper.editing .resize-handle{ display:flex }
      .resize-handle ha-icon{ --mdc-icon-size:20px; width:20px; height:20px; pointer-events:none; }

      /* Delete handle */
      .delete-handle{
        display:none; position:absolute; top:0; left:0; width:40px; height:40px;
        background:linear-gradient(135deg, rgba(236,72,72,.9) 0%, rgba(255,105,97,1) 100%);
        color:#fff; border-bottom-right-radius:40px; z-index:999;
        box-shadow:0 3px 8px rgba(0,0,0,.28); cursor:pointer; align-items:center; justify-content:center;
        transition:background .15s, transform .1s, box-shadow .15s;
      }
      .delete-handle:hover{ transform:scale(1.05); box-shadow:0 6px 16px rgba(0,0,0,.35); filter:brightness(1.05); }
      .card-wrapper.editing .delete-handle{ display:flex }
      .delete-handle ha-icon{ --mdc-icon-size:20px; width:20px; height:20px; pointer-events:none; }

      /* modal */
      .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:flex; align-items:center; justify-content:center; z-index:9000 }
      .dialog{
        width:min(1220px,96%); max-height:min(90vh, 900px); display:flex; flex-direction:column;
        background:var(--card-background-color); border-radius:20px; padding:0; border:1px solid var(--divider-color); overflow:visible;
      }
      .dlg-head{
        display:flex; align-items:center; gap:12px; padding:12px 16px; border-bottom:1px solid var(--divider-color);
        background:
          radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
          radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
      }
      .dlg-head h3{ margin:0; font-size:1.1rem; letter-spacing:.2px }
      .dlg-foot{ display:flex; gap:10px; justify-content:flex-end; padding:12px; border-top:1px solid var(--divider-color); background:var(--primary-background-color) }
      .btn:disabled{ opacity:.6; cursor:not-allowed }

      .visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{
            border-right:1px solid var(--divider-color);
            overflow:auto;
            background:var(--primary-background-color);
            /*
             * Remove contain:content so that fixed-position menus from
             * custom card editors can correctly position themselves
             * relative to the viewport. CSS containment can interfere
             * with anchoring of overlays.
             */
            contain:none;
          }
          /*
           * Allow content like dropdown menus from custom card editors to
           * overflow the right pane without being clipped. Using overflow
           * visible instead of hidden prevents menus from being positioned
           * far away or requiring excessive scrolling when they open.
           */
          #rightPane{
            /* Allow the right-hand editor pane to scroll vertically when
             * content from custom card editors exceeds the available space.
             * We hide horizontal overflow to avoid layout shifts. */
            overflow-y:auto;
            overflow-x:hidden;
            background:var(--primary-background-color);
          }
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{
            border:1px solid var(--divider-color);
            border-radius:12px;
            background:var(--card-background-color);
            overflow:visible;
            position:relative;
            /* Remove content containment on sections to prevent the
             * creation of an artificial containing block which can
             * disrupt dropdown positioning. */
            contain:none;
          }
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}
          .cm-editor{height: 100%}
          /* --- FIX: YAML/Visual editor: ensure the entire content is visible --- */
          /*
           * The YAML editor previously had a fixed height which caused the
           * bottom of longer configurations to be clipped. Removing the fixed
           * height allows the section to flex based on available space within
           * the grid row. A min-height of zero lets it collapse when there
           * isn't much content, while overflow:auto enables scrolling when
           * content exceeds the visible area.
           */
          #yamlSec {
            min-height: 0;
            height: auto !important;
            overflow: auto;
          }
          #yamlSec .bd {
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            overflow: auto;
            max-height: none;
            /* Fill the available grid row height (1fr) so that scrolling
             * happens inside this section rather than expanding the editor
             * beyond the modal boundary. A min-height of zero ensures the
             * section can shrink when little content is present. */
            height: 100%;
            min-height: 0;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec {
            min-height: 0;
            overflow: auto;
          }
          #optionsSec .bd {
            position: relative;
            overflow: auto;
            height: auto;
            max-height: none;
            min-height: 0;
          }
          #editorHost {
            display: block;
            min-height: 0;
          }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: allow growth but set a sensible minimum
           * so that very short snippets don't collapse. Using min-height
           * instead of a fixed height allows the editor to expand when the
           * parent container grows. The !important flag ensures that the
           * component\u2019s inline styles from HA won\u2019t override this sizing.
           */
          ha-code-editor {
            display: block;
            min-height: 260px;
            height: auto !important;
          }
          .CodeMirror {
            min-height: 260px;
            height: auto !important;
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            overflow: visible; 
            height: auto;
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            position: relative;
            display:flex; align-items:center; justify-content:center;
            width:100%; height:100%;
            border-radius:16px;
            overflow: hidden;
            /* cool gradient derived from HA primary color */
            background:
              radial-gradient(120% 120% at 100% 0%,
                color-mix(in srgb, var(--primary-color) 18%, #000 0%) 0%,
                transparent 60%),
              linear-gradient(135deg,
                color-mix(in srgb, var(--primary-color) 70%, #000 0%) 0%,
                color-mix(in srgb, var(--primary-color) 35%, #000 0%) 100%);
          }

          /* subtle shine */
          .ddc-placeholder-inner::after{
            content:"";
            position:absolute; inset:0;
            background: radial-gradient(120% 90% at 0% 100%, rgba(255,255,255,.15), transparent 60%);
            pointer-events:none;
          }

          /* center stack */
          .ddc-hero{
            position:absolute; inset:0;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            gap:16px; text-align:center; padding:24px;
            color:rgba(255,255,255,.98);
            text-shadow:0 1px 2px rgba(0,0,0,.35);
            user-select:none; pointer-events:none; /* click goes to shield below */
          }

          .ddc-hero img{
            width:128px; height:128px; object-fit:contain; opacity:.95; filter: drop-shadow(0 4px 14px rgba(0,0,0,.25));
          }

          .ddc-hero .ddc-title{
            font-weight:800; font-size:1.25rem; letter-spacing:.2px;
          }

          .ddc-hero .ddc-sub{
            font-weight:600; opacity:.95;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }

                /* --- Tabs bar (DDC) --- */
          /* --- WILD DDC Tabs (drop in and replace your block) --- */

          /* --- DDC Tabs \u2014 Chrome-style, no backdrop, mobile-friendly --- */

          /* --- DDC Tabs \u2014 Chrome-style, fills width, steady hover (no bounce), stronger active shadow --- */

          /* Tabs bar (transparent, no backdrop) */
 /* --- DDC Tabs \u2014 Chrome-style, centered content, smooth tab-change, faint inactive outline --- */

        /* Tabs bar (transparent, no backdrop; fills width) */
        .ddc-tabs{
          position: relative;
          display: flex; flex-wrap: wrap;
          align-items: flex-end; /* Chrome-like baseline */
          gap: 6px;
          padding: 6px 10px;
          width: 100%;
          overflow-x: hidden;
          overflow-y: hidden;
          -webkit-overflow-scrolling: touch;
          scroll-snap-type: x proximity;
          background: transparent;
          border-bottom: 1px solid var(--divider-color, rgba(0,0,0,.12));
          scrollbar-width: thin;
          scrollbar-color: color-mix(in oklab, var(--primary-text-color) 35%, transparent) transparent;
        }
        .ddc-tabs::-webkit-scrollbar { height: 8px; }
        .ddc-tabs::-webkit-scrollbar-thumb {
          background: color-mix(in oklab, var(--primary-text-color) 35%, transparent);
          border-radius: 9999px;
        }
        .ddc-tabs::-webkit-scrollbar-track { background: transparent; }

        /* Tab: fills available width, centered icon+text, no hover bounce */
        .ddc-tab{
          -webkit-tap-highlight-color: transparent;
          position: relative;
          z-index: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;             /* 1) center content */
          text-align: center;                  /* 1) center label text */
          gap: 8px;
          padding: 8px 12px;
          font: 500 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
          letter-spacing: .2px;
          color: color-mix(in oklab, var(--primary-text-color) 75%, #000 0%);
          cursor: pointer;

          /* fill width but remain scrollable when crowded */
          flex: 1 1 clamp(120px, 18%, 280px);
          min-width: clamp(120px, 18%, 280px);
          max-width: 100%;
          scroll-snap-align: start;

          margin: 0;                           /* no overlap for steady layout */
          border: 0;
          background: transparent;

          /* 2&3) keep motion minimal; animate only color/shadow/line */
          transition: color .18s ease, filter .18s ease, box-shadow .18s ease, border-color .18s ease;
        }
        .ddc-tab ha-icon{ --mdc-icon-size:18px; }
        .ddc-tab .ddc-tab-label{ max-width: 100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

        /* 3) Inactive tabs have a faint outline */
        .ddc-tab::before{
          content:"";
          position:absolute;
          inset: 0;
          border-top-left-radius: 14px;
          border-top-right-radius: 14px;
          border: 1px solid color-mix(in oklab, var(--primary-text-color) 12%, transparent); /* faint */
          border-bottom: none;
          background: transparent;
          pointer-events: none;
          z-index: -1;
        }

        /* Subtle hover: clearer text only (no movement) */
        .ddc-tab:hover{
          color: var(--primary-text-color);
          filter: saturate(1.05);
        }

        /* Active tab: elevated, stronger shadow */
        .ddc-tab.active{
          color: var(--primary-text-color);
          z-index: 2;
        }
        .ddc-tab.active::before{
          background: var(--card-background-color, #fff);
          border-color: var(--divider-color, rgba(0,0,0,.18));
          box-shadow:
            0 10px 24px rgba(0,0,0,.16),
            0 4px 10px rgba(0,0,0,.10),
            0 0 0 1px color-mix(in oklab, var(--primary-text-color) 10%, transparent);
          animation: ddc-pop .18s ease-out;  /* quick, pleasing shadow pop */
        }

        /* 2) Animated TOP line \u2013 appears quickly when tab becomes active */
        .ddc-tab::after{
          content:"";
          position:absolute;
          top: -2px; left: 10px; right: 10px;
          height: 0;                            /* hidden by default */
          border-radius: 3px 3px 0 0;
          background: linear-gradient(90deg, var(--primary-color), #ff4ecd, #00e0ff, var(--primary-color));
          background-size: 300% 100%;
          opacity: 0;
          transform: scaleX(0);                  /* prepare for quick reveal */
          transform-origin: 50% 50%;
          transition: transform .16s ease-out, height .16s ease-out, opacity .16s ease-out;
          pointer-events: none;
        }
        .ddc-tab.active::after{
          height: 3px;
          opacity: 1;
          transform: scaleX(1);
          animation: ddc-rainbow 4s linear infinite;
        }

        /* Pressed: keep still (no bounce) */
        .ddc-tab:active{ box-shadow: 0 1px 0 rgba(0,0,0,0); }

        /* Focus ring without motion */
        .ddc-tab:focus-visible{
          outline: none;
          box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary-color) 45%, transparent);
        }

        /* Mobile scaling \u2014 smaller min width & tighter paddings */
        @media (max-width: 640px){
          .ddc-tabs{ gap: 4px; padding: 6px 8px; }
          .ddc-tab{
            flex: 1 1 clamp(96px, 34%, 200px);
            min-width: clamp(96px, 34%, 200px);
            padding: 6px 10px;
            font-size: 12px;
          }
          .ddc-tab::after{ left: 8px; right: 8px; }
        }

        /* Vertical tabs rail (transparent) \u2014 centered content too */
        .ddc-tabs-left{
          display:flex;
          flex-direction:column;
          align-items: stretch;
          width: clamp(150px, 28%, 220px);
          padding: 8px 6px;
          gap: 6px;
          overflow-y: auto;
          overflow-x: hidden;
          border-right: 1px solid var(--divider-color, rgba(0,0,0,.12));
          border-bottom: none;
          background: transparent;
        }
        .ddc-tabs-left .ddc-tab{
          justify-content: center;             /* 1) center in vertical list as well */
          margin: 0;
          border: 1px solid color-mix(in oklab, var(--primary-text-color) 12%, transparent);
          border-radius: 10px;
          padding: 8px 10px;
          flex: 0 0 auto;
        }
        .ddc-tabs-left .ddc-tab::before{ display:none; }
        .ddc-tabs-left .ddc-tab.active{
          background: var(--card-background-color, #fff);
          box-shadow: 0 4px 12px rgba(0,0,0,.12);
        }
        .ddc-tabs-left .ddc-tab.active::after{ display:none; } /* top line is only for horizontal */

        /* Animations */
        @keyframes ddc-rainbow{
          0% { background-position: 0% 50%; }
          100% { background-position: 300% 50%; }
        }
        @keyframes ddc-pop{
          0% { box-shadow: 0 0 0 rgba(0,0,0,0); }
          100% {
            box-shadow:
              0 10px 24px rgba(0,0,0,.16),
              0 4px 10px rgba(0,0,0,.10),
              0 0 0 1px color-mix(in oklab, var(--primary-text-color) 10%, transparent);
          }
        }

        /* Fly\u2011in animation for card wrappers. When the animate_cards
           configuration option is enabled, card wrappers will animate
           into view using this keyframe sequence. Cards translate
           upward while fading in to produce a quick, pleasant fly\u2011in. */
        @keyframes ddc-card-fly-in{
          0%   { opacity: 0; transform: translateY(12px); }
          100% { opacity: 1; transform: translateY(0); }
        }
        /* Apply the fly\u2011in animation to visible cards. The animation
           duration and easing mirror other UI animations for cohesion. */
        .card-wrapper.ddc-fly-in{
          animation: ddc-card-fly-in 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
              

        </style>
        <div class="ddc-root">
        
<div class="toolbar ddc-toolbar streamlined v2" role="toolbar" aria-label="Layout editor">

  <!-- Add & Save -->
  <section class="ddc-sec sec-primary" aria-label="Add & Save">
    <header class="ddc-sec-head">
      <span class="ddc-sec-dot" aria-hidden="true"></span>
      <span class="ddc-sec-title">Add &amp; Save</span>
    </header>
    <div class="ddc-row">
      <button class="btn primary cta-add" id="addCardBtn" style="display:none" data-tooltip="Add card">
        <ha-icon icon="mdi:plus"></ha-icon><span class="label">Add Card</span>
      </button>
      <button class="btn secondary" id="applyLayoutBtn" style="display:none" data-tooltip="Save">
        <ha-icon icon="mdi:content-save"></ha-icon><span class="label">Save</span>
      </button>
    </div>
  </section>

  <!-- Clipboard -->
  <section class="ddc-sec sec-clip" aria-label="Clipboard">
    <header class="ddc-sec-head">
      <span class="ddc-sec-dot" aria-hidden="true"></span>
      <span class="ddc-sec-title">Clipboard</span>
    </header>
    <div class="ddc-row">
      <button class="btn secondary" id="copyBtn" style="display:none" data-tooltip="Copy">
        <ha-icon icon="mdi:content-copy"></ha-icon><span class="label">Copy</span>
      </button>
      <button class="btn secondary" id="pasteBtn" style="display:none" data-tooltip="Paste">
        <ha-icon icon="mdi:content-paste"></ha-icon><span class="label">Paste</span>
      </button>
    </div>
  </section>

  <!-- Import & Share -->
  <section class="ddc-sec sec-share" aria-label="Import & Share">
    <header class="ddc-sec-head">
      <span class="ddc-sec-dot" aria-hidden="true"></span>
      <span class="ddc-sec-title">Import &amp; Share</span>
    </header>
    <div class="ddc-row">
      <button class="btn secondary" id="importBtn" style="display:none" data-tooltip="Import YAML">
        <ha-icon icon="mdi:upload"></ha-icon><span class="label">Import</span>
      </button>
      <button class="btn secondary" id="exportBtn" style="display:none" data-tooltip="Export YAML">
        <ha-icon icon="mdi:download"></ha-icon><span class="label">Export</span>
      </button>
      <button class="btn info hads" id="exploreBtn" style="display:none" data-tooltip="Open HADS">
        <ha-icon icon="mdi:storefront-outline"></ha-icon><span class="label">Open HADS</span>
      </button>
      <button class="btn danger" id="exitEditBtn" style="display:none" data-tooltip="Exit edit mode">
        <ha-icon icon="mdi:exit-run"></ha-icon><span class="label">Exit Edit Mode</span>
      </button>
    </div>
  </section>

  <!-- Utilities -->
  <section class="ddc-sec sec-utils" aria-label="Utilities">
    <header class="ddc-sec-head">
      <span class="ddc-sec-dot" aria-hidden="true"></span>
      <span class="ddc-sec-title">Utilities</span>
    </header>
    <div class="ddc-row">
      <button class="btn secondary" id="reloadBtn" style="display:none" data-tooltip="Reload">
        <ha-icon icon="mdi:refresh"></ha-icon><span class="label">Reload</span>
      </button>
      <button class="btn secondary" id="diagBtn" style="display:none" data-tooltip="Diagnostics">
        <ha-icon icon="mdi:play-circle-outline"></ha-icon><span class="label">Diagnostics</span>
      </button>
      <button class="btn secondary" id="settingsBtn" style="display:none" data-tooltip="Card Settings">
        <ha-icon icon="mdi:cog"></ha-icon><span class="label">Card Settings</span>
      </button>
    </div>
  </section>

  <!-- Status -->
  <section class="ddc-sec sec-status" aria-label="Status">
    <header class="ddc-sec-head">
      <span class="ddc-sec-dot" aria-hidden="true"></span>
      <span class="ddc-sec-title">Status</span>
    </header>
    <div class="ddc-row">
      <span class="ddc-t-status ok" id="ddcStatus" style="display:none" aria-live="polite">
        <span class="ddc-t-dot" id="ddcDot" aria-hidden="true"></span>
        <span class="ddc-t-text" id="ddcStatusText">storage: backend \xB7 OK</span>
      </span>
      <span class="store-badge" id="storeBadge" title="Where layout is persisted" style="display:none">storage: backend \xB7 OK</span>
    </div>
  </section>

</div>


          <!-- Tabs & card container -->
          <div class="ddc-tabs" id="tabsBar" style="display:none"></div>
          <div class="card-container" id="cardContainer"></div>
        </div>


      `,this.cardContainer=this.shadowRoot.querySelector("#cardContainer");try{(R=this._applyBackgroundImageFromConfig)==null||R.call(this)}catch{}this.addButton=this.shadowRoot.querySelector("#addCardBtn"),this.reloadBtn=this.shadowRoot.querySelector("#reloadBtn"),this.diagBtn=this.shadowRoot.querySelector("#diagBtn"),this.exitEditBtn=this.shadowRoot.querySelector("#exitEditBtn"),this.storeBadge=this.shadowRoot.querySelector("#storeBadge"),this.exportBtn=this.shadowRoot.querySelector("#exportBtn"),this.importBtn=this.shadowRoot.querySelector("#importBtn"),this.exploreBtn=this.shadowRoot.querySelector("#exploreBtn"),this.applyLayoutBtn=this.shadowRoot.querySelector("#applyLayoutBtn"),this.copyBtn=this.shadowRoot.querySelector("#copyBtn"),this.pasteBtn=this.shadowRoot.querySelector("#pasteBtn"),this.settingsBtn=this.shadowRoot.querySelector("#settingsBtn"),this.tabsBar=this.shadowRoot.querySelector("#tabsBar"),this.rootEl=this.shadowRoot.querySelector(".ddc-root");try{this._renderTabs(),this._applyActiveTab()}catch{}this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.applyLayoutBtn.addEventListener("click",()=>this._saveLayout(!1)),this.copyBtn&&this.copyBtn.addEventListener("click",()=>this._copySelection()),this.pasteBtn&&this.pasteBtn.addEventListener("click",()=>this._pasteClipboard()),this.settingsBtn&&this.settingsBtn.addEventListener("click",()=>this._openDashboardSettings()),window.addEventListener("keydown",ie=>{var G;if(this.editMode){if((ie.ctrlKey||ie.metaKey)&&(ie.key==="s"||ie.key==="S")&&(ie.preventDefault(),this._saveLayout(!1)),!this.__ddcResizeObs&&this.autoResizeCards){this.__ddcResizeObs=new ResizeObserver(()=>{var ee;return(ee=this._applyAutoScale)==null?void 0:ee.call(this)});try{this.__ddcResizeObs.observe(this)}catch{}try{this.__ddcResizeObs.observe(this.cardContainer)}catch{}try{this.parentElement&&this.__ddcResizeObs.observe(this.parentElement)}catch{}try{this.offsetParent&&this.__ddcResizeObs.observe(this.offsetParent)}catch{}window.addEventListener("resize",this.__ddcOnWinResize=()=>{var ee;return(ee=this._applyAutoScale)==null?void 0:ee.call(this)})}(G=this._applyAutoScale)==null||G.call(this)}}),this.exploreBtn.addEventListener("click",()=>window.open("https://hads.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),(Z=this._applyAutoScale)==null||Z.call(this),this._installLongPressToEnterEdit(),(F=this._startScaleWatch)==null||F.call(this),window.addEventListener("keydown",ie=>{var G;ie.key==="Escape"&&this.editMode&&this._toggleEditMode(!1),this.__ddcResizeObs||(this.__ddcResizeObs=new ResizeObserver(()=>{var ee;return(ee=this._applyAutoScale)==null?void 0:ee.call(this)}),this.__ddcResizeObs.observe(this),this.__ddcResizeObs.observe(this.cardContainer),window.addEventListener("resize",this.__ddcOnWinResize=()=>{var ee;return(ee=this._applyAutoScale)==null?void 0:ee.call(this)})),(G=this._applyAutoScale)==null||G.call(this)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",ie=>{this.editMode&&(ie.target.closest(".card-wrapper")||!ie.shiftKey&&!ie.ctrlKey&&!ie.metaKey&&this._clearSelection())})}try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),this.__cfgReady=!0,o&&this.__booted?this._initialLoad(!0):!this.__booted&&this.__probed?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),(K=this._applyAutoScale)==null||K.call(this),this._resizeContainer())}connectedCallback(){var t,a;try{(t=this._applyHaChromeVisibility_)==null||t.call(this)}catch{}if(this.__keyHandlerBound||(this.__keyHandler=o=>this._onKeyDown_(o),window.addEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!0),this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1),!this.__visObs){let o=new IntersectionObserver(l=>{l.some(c=>c.isIntersecting)&&requestAnimationFrame(()=>this._applyAutoScale&&this._applyAutoScale())},{root:null,threshold:0});o.observe(this),this.__visObs=o}this.__ddcOnWinResize=this.__ddcOnWinResize||(()=>this._applyAutoScale&&this._applyAutoScale()),window.addEventListener("resize",this.__ddcOnWinResize);try{(a=this.__ddcBindPointerListeners)==null||a.call(this)}catch{}}disconnectedCallback(){var t,a,o,l,c;try{(t=this._setHeaderVisible_)==null||t.call(this,!0),(a=this._setSidebarVisible_)==null||a.call(this,!0)}catch{}try{(o=this._applyHaChromeVisibility_)==null||o.call(this)}catch{}this.__keyHandlerBound&&this.__keyHandler&&(window.removeEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!1,this.__keyHandler=null),this.__keyHandlerBound||(this.__keyHandler=d=>this._onKeyDown_(d),window.addEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!0),window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis);try{(l=this.__ddcResizeObs)==null||l.disconnect()}catch{}if(this.__ddcResizeObs=null,(c=this._stopScaleWatch)==null||c.call(this),this.__ddcOnWinResize&&(window.removeEventListener("resize",this.__ddcOnWinResize),this.__ddcOnWinResize=null),this.__lpInstalled&&this.__lpHandlers){let d=this.cardContainer;d==null||d.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),d==null||d.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}try{this.__visObs&&this.__visObs.disconnect()}catch{}this.__visObs=null,this.__ddcOnWinResize&&window.removeEventListener("resize",this.__ddcOnWinResize);try{this.__ddcPtrBound&&(this.removeEventListener("pointerdown",this.__onDDCPointerDown),this.removeEventListener("pointermove",this.__onDDCPointerMove),window.removeEventListener("pointerup",this.__onDDCPointerUp),window.removeEventListener("pointercancel",this.__onDDCPointerUp),this.__ddcPtrBound=!1)}catch{}}set hass(t){var o;this._hass=t,cc("set hass"),!this.__probed&&t&&(this.__probed=!0,this._probeBackend().then(()=>{this.__probed=!0,!this.__booted&&this.__cfgReady&&(this.__booted=!0,this._initialLoad(!0))}));let a=((o=this.cardContainer)==null?void 0:o.children)||[];for(let l of a){let c=l.firstElementChild;c&&c.hass!==t&&(c.hass=t)}try{this._applyVisibility_()}catch{}}get hass(){return this._hass}async _initialLoad(t=!1){var a,o,l,c,d,f,v,m,_,g,k,z,E,L,I,C;if(!this.__booting){this.__booting=!0;try{this._loading=!0,t&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:t});let A=[],O=null;if(this._backendOK&&this.storageKey)try{O=await this._loadLayoutFromBackend(this.storageKey)}catch(F){this._dbgPush("boot","Backend load failed",{error:String(F)})}if(!O&&this.storageKey){let F=null;try{F=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(F)if(this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(F).length}),this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,F),this._dbgPush("boot","Migrated local -> backend"),O=F}catch(K){this._dbgPush("boot","Migration failed, staying local",{error:String(K)}),O=F}else O=F}!O&&((o=(a=this._config)==null?void 0:a.cards)!=null&&o.length)&&(this._dbgPush("boot","Using embedded config"),O={cards:this._config.cards});let b={...this._config||{}};if(O!=null&&O.options){let{storage_key:F,...K}=O.options;this._applyImportedOptions(K,!0)}else typeof(O==null?void 0:O.grid)=="number"&&this._applyImportedOptions({grid:O.grid},!0);let M=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","auto_resize_cards"],R={};for(let F of M)b[F]!==void 0&&(R[F]=b[F]);Object.keys(R).length&&this._applyImportedOptions(R,!0);let Z=!1;if((l=O==null?void 0:O.cards)!=null&&l.length){for(let F of O.cards){if(!(F!=null&&F.card)||typeof F.card=="object"&&Object.keys(F.card).length===0){let G=this._makePlaceholderAt(((c=F.position)==null?void 0:c.x)||0,((d=F.position)==null?void 0:d.y)||0,((f=F.size)==null?void 0:f.width)||200,((v=F.size)==null?void 0:v.height)||200);this.cardContainer.appendChild(G);try{this._rebuildOnce(G.firstElementChild)}catch{}Z=!0;continue}let K=await this._createCard(F.card),ie=this._makeWrapper(K);this.editMode&&ie.classList.add("editing"),ie.dataset.tabId=this._normalizeTabId(F.tabId||F.tab_id||this.defaultTab),this._setCardPosition(ie,((m=F.position)==null?void 0:m.x)||0,((_=F.position)==null?void 0:_.y)||0),ie.style.width=`${(k=(g=F.size)==null?void 0:g.width)!=null?k:14*this.gridSize}px`,ie.style.height=`${(E=(z=F.size)==null?void 0:z.height)!=null?E:10*this.gridSize}px`,F.z!=null&&(ie.style.zIndex=String(F.z)),this.cardContainer.appendChild(ie);try{this._rebuildOnce(ie.firstElementChild)}catch{}this._initCardInteract(ie),Z=!0}this._resizeContainer(),(L=this._applyAutoScale)==null||L.call(this),this._dbgPush("boot","Layout applied",{count:O.cards.length})}Z||(this._showEmptyPlaceholder(),(I=this._applyAutoScale)==null||I.call(this),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI(),t&&(this._cardModProcessed=!1),setTimeout(()=>{this._processCardModOnce()},100);try{A.forEach(F=>{try{F.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}})}catch{}}finally{this._loading=!1,this.__booting=!1,this.__dirty=!1,(C=this._updateApplyBtn)==null||C.call(this);try{this._renderTabs(),this._applyActiveTab()}catch{}try{this._applyVisibility_()}catch{}}}}_normalizeTabId(t){let a=Array.isArray(this.tabs)?this.tabs.map(o=>o.id):[];return a.length?t&&a.includes(t)?t:this.defaultTab||a[0]:this.defaultTab||"default"}_renderTabs(){var o,l,c;let t=this.tabsBar;if(!t)return;let a=Array.isArray(this.tabs)?this.tabs:[];if(!a.length||a.length===1&&this.hideTabsWhenSingle){t.style.display="none";return}t.style.display="",t.className="ddc-tabs "+(this.tabsPosition==="left"?"ddc-tabs-left":""),t.innerHTML="";for(let d of a){let f=document.createElement("button");f.className="ddc-tab"+(d.id===this.activeTab?" active":""),f.dataset.tabId=d.id,f.title=d.label||d.id,f.innerHTML=`${d.icon?`<ha-icon icon="${d.icon}"></ha-icon>`:""}<span class="ddc-tab-label">${(o=d.label)!=null?o:d.id}</span>`,f.addEventListener("click",()=>{if(this.activeTab!==d.id){this.activeTab=d.id;try{localStorage.setItem(`ddc_lasttab_${this.storageKey}`,d.id)}catch{}this._applyActiveTab(),this._renderTabs();try{this._applyVisibility_()}catch{}}}),t.appendChild(f)}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left");try{(l=this._updateTabsA11y_)==null||l.call(this)}catch{}try{(c=this._syncTabsWidth_)==null||c.call(this)}catch{}}_applyActiveTab(){var o,l,c;let t=this._normalizeTabId(this.activeTab);(((l=(o=this.cardContainer)==null?void 0:o.querySelectorAll)==null?void 0:l.call(o,".card-wrapper"))||[]).forEach(d=>{var v;let f=d.dataset.tabId?this._normalizeTabId(d.dataset.tabId):this.defaultTab;if(!this.tabs||!this.tabs.length){d.style.display="",d.inert=!1,d.classList.remove("ddc-hidden");return}f===t?(d.style.display="",d.inert=!1,d.classList.remove("ddc-hidden")):(d.style.display="none",d.inert=!0,d.classList.add("ddc-hidden"),d.classList.remove("ddc-selected"),(v=this._applyAutoScale)==null||v.call(this))});try{this._clearSelection()}catch{}try{this.animateCards&&((c=this._animateCards)==null||c.call(this))}catch{}}_animateCards(){var t,a;try{(((a=(t=this.cardContainer)==null?void 0:t.querySelectorAll)==null?void 0:a.call(t,".card-wrapper"))||[]).forEach(l=>{let c=window.getComputedStyle?window.getComputedStyle(l):null;if(l.style.display==="none"||c&&c.display==="none"||l.classList.contains("ddc-hidden"))return;let f=window.getComputedStyle(l),v=f&&f.transform&&f.transform!=="none"?f.transform:"",m=[{opacity:0,transform:`${v} translateY(12px)`},{opacity:1,transform:`${v}`}];try{l.animate(m,{duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"none"})}catch{l.style.opacity="0",requestAnimationFrame(()=>{l.style.transition="opacity .3s ease",l.style.opacity="1"})}})}catch(o){console.warn("[ddc:animate] animation error",o)}}_addTabSelectorToChip(t,a=null){if(!this.tabs||!this.tabs.length)return;let o=t.querySelector(".chip");if(!o)return;let l=o.querySelector("select.ddc-chip-tab");l||(l=document.createElement("select"),l.className="ddc-chip-tab",l.style.marginLeft="6px",l.title="Assign to tab",o.appendChild(l)),l.innerHTML="";for(let d of this.tabs){let f=document.createElement("option");f.value=d.id,f.textContent=d.label||d.id,l.appendChild(f)}let c=this._normalizeTabId(a||t.dataset.tabId||this.activeTab||this.defaultTab);l.value=c,t.dataset.tabId=c,l.onchange=()=>{t.dataset.tabId=this._normalizeTabId(l.value),this._applyActiveTab();try{this._applyVisibility_()}catch{}try{this._queueSave("tab-change")}catch{}}}_toggleEditMode(t=null){var k,z,E,L,I,C,A,O,b,M,R,Z;try{(k=this.__clearPressTimer)==null||k.call(this)}catch{}let a=t===null?!this.editMode:!!t,o=!this.editMode&&a,l=this.renderRoot||this.shadowRoot||this,c=(z=l==null?void 0:l.querySelector)==null?void 0:z.call(l,".ddc-toolbar.streamlined.v2, .ddc-toolbar.streamlined.v3"),d=(F,K)=>{try{F&&(F.style.display=K)}catch{}},f="inline-block",v="none",m=()=>{d(this.addButton,f),d(this.reloadBtn,f),d(this.diagBtn,f),d(this.exitEditBtn,f),d(this.exportBtn,f),d(this.importBtn,f),d(this.exploreBtn,f),d(this.storeBadge,f),d(this.applyLayoutBtn,f),d(this.copyBtn,f),d(this.pasteBtn,f),d(this.settingsBtn,f)},_=()=>{d(this.addButton,v),d(this.reloadBtn,v),d(this.diagBtn,v),d(this.exitEditBtn,v),d(this.exportBtn,v),d(this.importBtn,v),d(this.exploreBtn,v),d(this.storeBadge,v),d(this.applyLayoutBtn,v),d(this.copyBtn,v),d(this.pasteBtn,v),d(this.settingsBtn,v)};if(c)if(a)c.setAttribute("data-force-open","1"),c.style.display="grid",m(),requestAnimationFrame(()=>{let K=c.scrollHeight||0;c.style.setProperty("--open-h",K+"px"),c.classList.add("is-open")});else{c.setAttribute("data-force-open","1"),c.style.display="grid";let K=c.scrollHeight||0;c.style.setProperty("--open-h",K+"px"),requestAnimationFrame(()=>{c.classList.remove("is-open")}),setTimeout(()=>{_(),c.removeAttribute("data-force-open")},260)}else a?m():_();if(this.editMode=a,(E=this._syncEmptyStateUI)==null||E.call(this),(L=this.cardContainer)==null||L.classList.toggle("grid-on",this.editMode),(((C=(I=this.cardContainer)==null?void 0:I.querySelectorAll)==null?void 0:C.call(I,".card-wrapper"))||[]).forEach(F=>{F.classList.toggle("editing",this.editMode);let K=F.querySelector(".resize-handle");K&&(K.style.display=this.editMode?"flex":"none"),!F.dataset.placeholder&&window.interact&&window.interact(F).draggable(this.editMode).resizable(this.editMode),F.style.touchAction=this.editMode?"none":"auto"}),this.editMode||(A=this._clearSelection)==null||A.call(this),this.editMode||(O=this.cardContainer)==null||O.querySelectorAll(".card-wrapper.dragging").forEach(F=>F.classList.remove("dragging")),o){let F=(b=this.__lastHoldX)!=null?b:null,K=(M=this.__lastHoldY)!=null?M:null;(R=this._playEditRipple)==null||R.call(this,F,K)}try{(Z=this._applyHaChromeVisibility_)==null||Z.call(this)}catch{}}_isInHaEditorPreview(){let t=this;for(;t;){let a=t.nodeType===1&&t.localName?t.localName.toLowerCase():"";if(a==="hui-card-editor"||a==="hui-dialog-edit-card"||a==="hui-card-preview"||a==="ha-dialog"||a==="mwc-dialog")return!0;let o=t.getRootNode&&t.getRootNode();t=t.parentElement||o&&o.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let t=this.cardContainer;if(!t)return;let a=800,o=18,l=b=>!!b&&typeof b=="object"&&b.nodeType===1,c=(b,M)=>{try{return!!(b&&M&&typeof b.contains=="function"&&l(M)&&b.contains(M))}catch{return!1}},d=b=>c(this.cardContainer,b),f=b=>{var Z,F,K;let M=(F=(Z=b.target)==null?void 0:Z.closest)==null?void 0:F.call(Z,".card-wrapper");if(l(M)&&d(M)&&!M.classList.contains("ddc-placeholder"))return!0;let R=typeof b.composedPath=="function"?b.composedPath():[];for(let ie of R)if(l(ie)&&d(ie)&&(K=ie.classList)!=null&&K.contains("card-wrapper")&&!ie.classList.contains("ddc-placeholder"))return!0;return!1},v=(b,M)=>{let R=document.createElement("div");R.className="ddc-press-ring",document.body.appendChild(R),Object.assign(R.style,{position:"fixed",left:`${b}px`,top:`${M}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),R.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let Z=R.querySelector(".pr-fg"),F=18,K=2*Math.PI*F;return Z.style.strokeDasharray=`${K}`,Z.style.strokeDashoffset=`${K}`,requestAnimationFrame(()=>{Z.style.transition=`stroke-dashoffset ${a}ms linear`,Z.style.strokeDashoffset="0"}),{el:R,move(ie,G){R.style.left=`${ie}px`,R.style.top=`${G}px`},remove(){try{R.remove()}catch{}}}},m=null,_=null,g=0,k=0,z=null,E=()=>{m&&clearTimeout(m),m=null,_==null||_.remove(),_=null};this.__clearPressTimer=E;let L=b=>{b.pointerType==="mouse"&&b.button!==0||this._isInHaEditorPreview()||!d(b.target)||f(b)||(z=b.pointerId,g=b.clientX,k=b.clientY,this.__lastHoldX=g,this.__lastHoldY=k,_=v(g,k),m=setTimeout(()=>{var R;E();let M=!this.editMode;this._toggleEditMode(M),(R=this._toast)==null||R.call(this,`Edit mode ${M?"enabled":"disabled"}`)},a))},I=b=>{m==null||b.pointerId!==z||(_==null||_.move(b.clientX,b.clientY),(Math.abs(b.clientX-g)>o||Math.abs(b.clientY-k)>o)&&E())},C=b=>{b.pointerId===z&&(E(),z=null)},A=b=>{if(m)return b.preventDefault(),b.stopPropagation(),!1},O=b=>{var R;if(this._isInHaEditorPreview()||!d(b.target)||f(b))return;let M=!this.editMode;this._toggleEditMode(M),(R=this._toast)==null||R.call(this,`Edit mode ${M?"enabled":"disabled"}`)};t.addEventListener("pointerdown",L),window.addEventListener("pointermove",I,{passive:!0}),window.addEventListener("pointerup",C,{passive:!0}),window.addEventListener("pointercancel",C,{passive:!0}),window.addEventListener("contextmenu",A),t.addEventListener("dblclick",O),this.__lpHandlers={onPointerDown:L,onPointerMove:I,onPointerUpOrCancel:C,onContextMenu:A,onDblClick:O}}_isLayoutEmpty(){let t=this.cardContainer;return t?t.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let t=this._isLayoutEmpty();if(this.addButton){let o=this.editMode||t;this.addButton.style.display=o?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&t)}let a=o=>o&&(o.style.display=this.editMode?"inline-block":"none");a(this.reloadBtn),a(this.diagBtn),a(this.exitEditBtn),a(this.exportBtn),a(this.importBtn),a(this.exploreBtn),a(this.storeBadge),a(this.applyLayoutBtn)}_updateApplyBtn(){this.applyLayoutBtn&&(this.applyLayoutBtn.disabled=!this.__dirty)}_markDirty(t=""){var a;this.__dirty=!0,this._updateApplyBtn(),(a=this._dbgPush)==null||a.call(this,"dirty","Marked dirty",{reason:t})}_playEditRipple(t=null,a=null){let o=this.cardContainer;if(!o)return;let l=o.getBoundingClientRect(),c=t==null?l.left+l.width/2:t,d=a==null?l.top+l.height/2:a,f=c-l.left,v=d-l.top,m=document.createElement("div");m.className="ddc-ripple-veil",m.style.setProperty("--rip-x",`${f}px`),m.style.setProperty("--rip-y",`${v}px`),o.appendChild(m),setTimeout(()=>m.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>this._initCardInteract(a))}_initCardInteract(t){if(!window.interact||t.dataset.placeholder)return;let a=this.gridSize,o=!!this.dragLiveSnap,c=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let d=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});c.push(window.interact.modifiers.snap({targets:[d],range:1/0,offset:"startCoords"}))}window.interact(t).draggable({enabled:this.editMode,inertia:!1,modifiers:c,listeners:{start:d=>{this._selection.has(t)||(!(d!=null&&d.shiftKey)&&!(d!=null&&d.ctrlKey)&&!(d!=null&&d.metaKey)&&this._clearSelection(),this._toggleSelection(t,!0));let f=Array.from(this._selection);this.__groupDrag={leader:t,members:f,startRaw:new Map(f.map(m=>[m,{x:parseFloat(m.getAttribute("data-x-raw"))||parseFloat(m.getAttribute("data-x"))||0,y:parseFloat(m.getAttribute("data-y-raw"))||parseFloat(m.getAttribute("data-y"))||0,w:parseFloat(m.style.width)||m.getBoundingClientRect().width,h:parseFloat(m.style.height)||m.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(m=>{let _=parseFloat(m.getAttribute("data-x-raw"))||parseFloat(m.getAttribute("data-x"))||0,g=parseFloat(m.getAttribute("data-y-raw"))||parseFloat(m.getAttribute("data-y"))||0;this.__collisionOriginals.set(m,{x:_,y:g})}),f.forEach(m=>{m.classList.add("dragging"),m.getAttribute("data-x-raw")===null&&m.setAttribute("data-x-raw",m.getAttribute("data-x")||"0"),m.getAttribute("data-y-raw")===null&&m.setAttribute("data-y-raw",m.getAttribute("data-y")||"0")})},move:d=>{if(!this.__groupDrag)return;let f=this.gridSize,v=!!this.dragLiveSnap,m=this.__groupDrag.leader,_=this.__groupDrag.startRaw.get(m),g=(parseFloat(m.getAttribute("data-x-raw"))||_.x)+d.dx,k=(parseFloat(m.getAttribute("data-y-raw"))||_.y)+d.dy,z=g-_.x,E=k-_.y,L=this.__groupDrag.members.map(I=>{let C=this.__groupDrag.startRaw.get(I),A=C.x+z,O=C.y+E,b=v?Math.round(A/f)*f:A,M=v?Math.round(O/f)*f:O;return{el:I,rawX:A,rawY:O,snapX:b,snapY:M,w:C.w,h:C.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(L,z,E,v,f),m.setAttribute("data-x-raw",String(g)),m.setAttribute("data-y-raw",String(k));for(let I of L)I.el.setAttribute("data-x-raw",String(I.rawX)),I.el.setAttribute("data-y-raw",String(I.rawY)),this._setCardPosition(I.el,I.snapX,I.snapY);this._resizeContainer()},end:d=>{if(!this.__groupDrag)return;let f=this.gridSize,v=this.__groupDrag.members.map(m=>{let _=parseFloat(m.getAttribute("data-x-raw"))||parseFloat(m.getAttribute("data-x"))||0,g=parseFloat(m.getAttribute("data-y-raw"))||parseFloat(m.getAttribute("data-y"))||0,k=Math.round(_/f)*f,z=Math.round(g/f)*f,E=parseFloat(m.style.width)||m.getBoundingClientRect().width,L=parseFloat(m.style.height)||m.getBoundingClientRect().height;return{el:m,rawX:_,rawY:g,snapX:k,snapY:z,w:E,h:L}});this.disableOverlap&&this._pushCardsOutOfTheWay(v,0,0,!1,f);for(let m of v)this._setCardPosition(m.el,m.snapX,m.snapY),m.el.setAttribute("data-x-raw",String(m.snapX)),m.el.setAttribute("data-y-raw",String(m.snapY));for(let m of this.__groupDrag.members)m.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(t).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:d=>{let f=this.gridSize,v=!!this.dragLiveSnap,m=parseFloat(t.style.width)||t.getBoundingClientRect().width,_=parseFloat(t.style.height)||t.getBoundingClientRect().height,{width:g,height:k}=d.rect,z=v?Math.max(f,Math.round(g/f)*f):g,E=v?Math.max(f,Math.round(k/f)*f):k,L=parseFloat(t.getAttribute("data-x"))||0,I=parseFloat(t.getAttribute("data-y"))||0,C=z,A=E;if(this._isContainerFixed()){let{w:b,h:M}=this._getContainerSize();C=Math.min(z,Math.max(this.gridSize,b-L)),A=Math.min(E,Math.max(this.gridSize,M-I))}let O=[this._rectFor(t,L,I,C,A)];this.disableOverlap&&this._anyCollisionFor(O,new Set([t]))||(t.style.width=`${C}px`,t.style.height=`${A}px`,this._resizeContainer())},end:()=>{let d=this.gridSize,f=parseFloat(t.style.width)||t.getBoundingClientRect().width,v=parseFloat(t.style.height)||t.getBoundingClientRect().height,m=Math.max(d,Math.round(f/d)*d),_=Math.max(d,Math.round(v/d)*d),g=parseFloat(t.getAttribute("data-x"))||0,k=parseFloat(t.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:E,h:L}=this._getContainerSize();m=Math.min(m,Math.max(d,E-g)),_=Math.min(_,Math.max(d,L-k))}let z=[this._rectFor(t,g,k,m,_)];this.disableOverlap&&this._anyCollisionFor(z,new Set([t]))||(t.style.width=`${m}px`,t.style.height=`${_}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),t.addEventListener("mousedown",d=>{this.editMode&&(d.target.closest(".resize-handle")||d.target.closest(".delete-handle")||d.target.closest(".chip")||(d.shiftKey||d.ctrlKey||d.metaKey?(d.stopPropagation(),this._toggleSelection(t)):this._selection.has(t)||(this._clearSelection(),this._toggleSelection(t,!0))))})}async _createCard(t){let o=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(t);if(o.hass=this.hass,t.type==="custom:mod-card"&&(await new Promise(l=>setTimeout(l,0)),o.setConfig&&typeof o.setConfig=="function"))try{o.setConfig(t)}catch{}return o}_makeWrapper(t){let a=document.createElement("div");a.classList.add("card-wrapper"),a.dataset.tabId=this._normalizeTabId(this.activeTab||this.defaultTab),this.editMode&&a.classList.add("editing"),a.style.zIndex||(a.style.zIndex=String(this._highestZ()+1));let o=document.createElement("div");o.className="chip",o.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini pill" data-act="front-most" title="Bring to front" aria-label="Bring to front">
        <ha-icon icon="mdi:arrange-bring-to-front"></ha-icon>
      </button>
      <button class="mini pill" data-act="back-most" title="Send to back" aria-label="Send to back">
        <ha-icon icon="mdi:arrange-send-to-back"></ha-icon>
      </button>
    `;let l=document.createElement("div");l.className="delete-handle",l.innerHTML='<ha-icon icon="mdi:close-thick"></ha-icon>',l.addEventListener("click",f=>{var v,m;f.stopPropagation(),this._selection.size>1&&this._selection.has(a)?(Array.from(this._selection).forEach(g=>g.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),(v=this._ensurePlaceholderIfEmpty)==null||v.call(this)):(a.remove(),this._resizeContainer(),this._queueSave("delete"),(m=this._ensurePlaceholderIfEmpty)==null||m.call(this))});try{this._addTabSelectorToChip(a,a.dataset.tabId)}catch{}o.addEventListener("click",async f=>{var m,_,g,k,z;f.stopPropagation();let v=(g=(_=(m=f.target)==null?void 0:m.closest("button"))==null?void 0:_.dataset)==null?void 0:g.act;if(v){if(v==="delete")this._selection.size>1&&this._selection.has(a)?(Array.from(this._selection).forEach(L=>L.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(a.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(v==="duplicate"||v==="copy"){let E=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];for(let L of E){let I=this._extractCardConfig(L.firstElementChild)||{},C=await this._createCard(I),A=this._makeWrapper(C);A.style.width=L.style.width,A.style.height=L.style.height;let O=(parseFloat(L.getAttribute("data-x"))||0)+this.gridSize,b=(parseFloat(L.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(A,O,b),A.style.zIndex=String(this._highestZ()+1);try{let M=(k=L.dataset)==null?void 0:k.tabId;M&&(A.dataset.tabId=M)}catch{}this.cardContainer.appendChild(A);try{(z=this._addTabSelectorToChip)==null||z.call(this,A,A.dataset.tabId)}catch{}try{this._rebuildOnce(A.firstElementChild)}catch{}this._initCardInteract(A)}this._resizeContainer(),this._queueSave("duplicate")}else if(v==="front")this._adjustZ(a,1);else if(v==="back")this._adjustZ(a,-1);else if(v==="front-most"){let E=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];E.sort((I,C)=>{let A=parseInt(I.style.zIndex||"1",10),O=parseInt(C.style.zIndex||"1",10);return A-O});let L=this._highestZ();for(let I of E)L+=1,I.style.zIndex=String(L);this._queueSave("z-change")}else if(v==="back-most"){let E=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];E.sort((C,A)=>{let O=parseInt(C.style.zIndex||"1",10);return parseInt(A.style.zIndex||"1",10)-O});let L=1/0;this.cardContainer.querySelectorAll(".card-wrapper").forEach(C=>{let A=parseInt(C.style.zIndex||"1",10);A<L&&(L=A)}),isFinite(L)||(L=1);let I=L;for(let C of E)I-=1,C.style.zIndex=String(Math.max(1,I));this._queueSave("z-change")}else if(v==="edit"){let E=this._extractCardConfig(a.firstElementChild)||{};await this._openSmartPicker("edit",E,async L=>{var A,O,b;let I=a.firstElementChild,C=await this._createCard(L);try{a.dataset.cfg=JSON.stringify(L),(A=this._hasCardModDeep)!=null&&A.call(this,L)?a.dataset.needsCardMod="true":delete a.dataset.needsCardMod}catch{}a.replaceChild(C,I),await Ui();try{if(C.hass=this.hass,(O=C.requestUpdate)==null||O.call(C),C.updateComplete)try{await C.updateComplete}catch{}}catch{}try{this._rebuildOnce(C)}catch{}try{C.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}(b=this._resizeContainer)==null||b.call(this);try{clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(M){console.warn("Save before reload failed",M)}window.location.reload()})}}});let c=document.createElement("div");c.className="shield";let d=document.createElement("div");d.classList.add("resize-handle"),this.editMode||(d.style.display="none"),d.title="Resize",d.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>';try{let f=t._config||t.config;f&&typeof f=="object"&&Object.keys(f).length&&(a.dataset.cfg=JSON.stringify(f),this._hasCardModDeep(f)&&(a.dataset.needsCardMod="true"))}catch{}a.append(t,c,o,l,d);try{this._rebuildOnce(t)}catch{}return a}_makePlaceholderAt(t=0,a=0,o=400,l=400){let c=document.createElement("div");c.classList.add("card-wrapper","ddc-placeholder"),c.dataset.placeholder="1",this.editMode&&c.classList.add("editing"),this._setCardPosition(c,t,a),c.style.width=`${o}px`,c.style.height=`${l}px`,c.style.zIndex=String(this._highestZ()+1);let d=document.createElement("div");d.className="ddc-placeholder-inner",d.setAttribute("aria-hidden","true");let f=document.createElement("div");f.className="ddc-hero";let v=this.heroImage;if(v){let k=document.createElement("img");k.src=v,k.alt="",f.appendChild(k)}let m=document.createElement("div");m.className="ddc-title",m.textContent="Drag & Drop Card";let _=document.createElement("div");_.className="ddc-sub",_.textContent="Hold me / double click me to enter Edit mode",f.append(m,_),d.appendChild(f),c.addEventListener("dblclick",k=>{k.stopPropagation(),this._toggleEditMode(!0)});let g=document.createElement("div");return g.className="shield",c.append(d,g),c}_processCardModOnce(){var a;if(this._cardModProcessed)return;this._cardModProcessed=!0,(((a=this.cardContainer)==null?void 0:a.querySelectorAll('[data-needs-card-mod="true"]'))||[]).forEach(o=>{let l=o.firstElementChild;if(!l)return;let c=l._config||l.config;if(c){if(c.type==="custom:mod-card")setTimeout(()=>{if(l.updateComplete)l.updateComplete.then(()=>{l.requestUpdate()});else if(l.setConfig)try{l.setConfig({...c})}catch{}},100);else if(c.card_mod&&l.setConfig)try{l.setConfig({...c})}catch{}}})}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let t=this._makePlaceholderAt(0,0,200,200);this.cardContainer.appendChild(t),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(t=>t.remove())}_ensurePlaceholderIfEmpty(){var a;this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),(a=this._applyAutoScale)==null||a.call(this),this._syncEmptyStateUI()}_adjustZ(t,a){let l=parseInt(t.style.zIndex||"1",10)+a;l=Math.max(1,Math.min(9999,l)),t.style.zIndex=String(l),this._queueSave("z-change")}_highestZ(){let t=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>{let o=parseInt(a.style.zIndex||"0",10);o>t&&(t=o)}),t}_setCardPosition(t,a,o){let l=Math.round(a),c=Math.round(o);t.style.transform=`translate3d(${l}px, ${c}px, 0)`,t.setAttribute("data-x",String(l)),t.setAttribute("data-y",String(c)),t.setAttribute("data-x-raw",String(l)),t.setAttribute("data-y-raw",String(c))}_computeDesignSize(){let t=this.cardContainer;if(!t)return{w:1,h:1};if(this._isContainerFixed()){let{w:d,h:f}=this._resolveFixedSize();return{w:Math.max(1,d),h:Math.max(1,f)}}let a=0,o=0,l=Array.from(t.querySelectorAll(".card-wrapper"));if(!l.length){let d=t.getBoundingClientRect();return{w:Math.max(1,d.width||1),h:Math.max(1,d.height||1)}}for(let d of l){let f=parseFloat(d.getAttribute("data-x-raw")||d.getAttribute("data-x")||"0")||0,v=parseFloat(d.getAttribute("data-y-raw")||d.getAttribute("data-y")||"0")||0,m=parseFloat(d.style.width)||d.getBoundingClientRect().width||0,_=parseFloat(d.style.height)||d.getBoundingClientRect().height||0,g=f+m,k=v+_;g>a&&(a=g),k>o&&(o=k)}let c=Math.max(1,this.gridSize||10);return a=Math.ceil(a/c)*c,o=Math.ceil(o/c)*c,{w:Math.max(1,a),h:Math.max(1,o)}}_startScaleWatch(){if(!this.autoResizeCards||this.__scaleRAF)return;let t=()=>{var l;if(!this.autoResizeCards){this.__scaleRAF=null;return}let a=this.getBoundingClientRect(),o=Math.max(1,a.width||0);o!==this.__lastScaleW&&(this.__lastScaleW=o,(l=this._applyAutoScale)==null||l.call(this)),this.__scaleRAF=requestAnimationFrame(t)};this.__scaleRAF=requestAnimationFrame(t)}_stopScaleWatch(){if(this.__scaleRAF){try{cancelAnimationFrame(this.__scaleRAF)}catch{}this.__scaleRAF=null}}_applyAutoScale(){var d,f,v,m,_,g,k,z,E,L;let t=this.cardContainer;if(!t)return;if(typeof this._ensureScaleWrapper=="function"&&this._ensureScaleWrapper(),!this.autoResizeCards){let I=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:t.offsetWidth||1,h:t.offsetHeight||1};if(t.style.width=`${I.w}px`,t.style.height=`${I.h}px`,t.style.transform="scale(1)",t.style.transformOrigin="top left",t.style.position="absolute",t.style.top="0",t.style.left="0",this.__scaleOuter){let C=this.parentElement&&((f=(d=this.parentElement).getBoundingClientRect)==null?void 0:f.call(d).width)||this.offsetParent&&((m=(v=this.offsetParent).getBoundingClientRect)==null?void 0:m.call(v).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||I.w;this.__scaleOuter.style.width=`${Math.max(1,C)}px`,this.__scaleOuter.style.height=`${Math.max(1,I.h)}px`}try{(_=this._syncTabsWidth_)==null||_.call(this)}catch{}return}let a=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:t.offsetWidth||1,h:t.offsetHeight||1},o=this.parentElement&&((k=(g=this.parentElement).getBoundingClientRect)==null?void 0:k.call(g).width)||this.offsetParent&&((E=(z=this.offsetParent).getBoundingClientRect)==null?void 0:E.call(z).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||a.w,l=Math.max(1,o),c=Math.min(l/Math.max(1,a.w),1);this.__scaleOuter&&(this.__scaleOuter.style.width=`${l}px`,this.__scaleOuter.style.height=`${Math.max(1,a.h*c)}px`),t.style.width=`${a.w}px`,t.style.height=`${a.h}px`,t.style.transform=`scale(${c})`,t.style.transformOrigin="top left",t.style.position="absolute",t.style.top="0",t.style.left="0";try{(L=this._syncTabsWidth_)==null||L.call(this)}catch{}}_resizeContainer(){var c;let t=this.cardContainer;if(!t||this._isContainerFixed())return;let a=Array.from(t.querySelectorAll(".card-wrapper")),o=0,l=0;a.forEach(d=>{let f=d.getBoundingClientRect(),v=t.getBoundingClientRect(),m=f.left-v.left+f.width,_=f.top-v.top+f.height;o=Math.max(o,m),l=Math.max(l,_)}),t.style.width=`${Math.ceil(o/this.gridSize)*this.gridSize||100}px`,t.style.height=`${Math.ceil(l/this.gridSize)*this.gridSize||100}px`;try{(c=this._syncTabsWidth_)==null||c.call(this)}catch{}}_pushCardsOutOfTheWay(t,a,o,l,c){if(!this.__collisionOriginals)return;let d=new Set(t.map(C=>C.el)),f=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(C=>!C.dataset.placeholder),v=this._isContainerFixed(),{w:m,h:_}=this._getContainerSize();for(let C of f){if(d.has(C))continue;let A=this.__collisionOriginals.get(C);if(A){C.setAttribute("data-x-raw",String(A.x)),C.setAttribute("data-y-raw",String(A.y));let O=l?Math.round(A.x/c)*c:A.x,b=l?Math.round(A.y/c)*c:A.y;this._setCardPosition(C,O,b)}}let g=t.map(C=>({x:C.snapX,y:C.snapY,w:C.w,h:C.h})),k=new Map,z=new Map;for(let C of f){let A=parseFloat(C.style.width)||C.getBoundingClientRect().width,O=parseFloat(C.style.height)||C.getBoundingClientRect().height;z.set(C,{w:A,h:O})}let E=a>0?1:a<0?-1:0,L=o>0?1:o<0?-1:0,I=Math.abs(a)>=Math.abs(o);for(let C of f){if(d.has(C))continue;let A=this.__collisionOriginals.get(C);if(!A)continue;let{x:O,y:b}=A,{w:M,h:R}=z.get(C),Z=!1;for(let F of g)if(this._rectsOverlap({x:F.x,y:F.y,w:F.w,h:F.h},{x:O,y:b,w:M,h:R})){Z=!0,I&&E!==0?O=E>0?F.x+F.w:F.x-M:!I&&L!==0?b=L>0?F.y+F.h:F.y-R:O=F.x+F.w;break}if(Z){let F=0,K=I?E!==0?E*c:c:0,ie=I?0:L!==0?L*c:c;for(;F<100;){let G={x:O,y:b,w:M,h:R},ee=!1;for(let _e of g)if(this._rectsOverlap(G,_e)){ee=!0;break}if(!ee){for(let[,_e]of k)if(this._rectsOverlap(G,_e)){ee=!0;break}}if(!ee&&v&&(O<0||b<0||O+M>m||b+R>_)&&(ee=!0),!ee)break;O+=K,b+=ie,F++}v&&(O=Math.max(0,Math.min(O,Math.max(0,m-M))),b=Math.max(0,Math.min(b,Math.max(0,_-R))))}k.set(C,{x:O,y:b,w:M,h:R}),g.push({x:O,y:b,w:M,h:R})}for(let[C,A]of k){C.setAttribute("data-x-raw",String(A.x)),C.setAttribute("data-y-raw",String(A.y));let O=l?Math.round(A.x/c)*c:A.x,b=l?Math.round(A.y/c)*c:A.y;this._setCardPosition(C,O,b)}}_rectFor(t,a=null,o=null,l=null,c=null){let d=a!=null?a:parseFloat(t.getAttribute("data-x"))||0,f=o!=null?o:parseFloat(t.getAttribute("data-y"))||0,v=l!=null?l:parseFloat(t.style.width)||t.getBoundingClientRect().width||0,m=c!=null?c:parseFloat(t.style.height)||t.getBoundingClientRect().height||0;return{x:d,y:f,w:v,h:m,el:t}}_rectsOverlap(t,a,o=.5){return!(t.x+t.w<=a.x+o||a.x+a.w<=t.x+o||t.y+t.h<=a.y+o||a.y+a.h<=t.y+o)}_anyCollisionFor(t,a){let o=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(c=>!a.has(c)&&!c.dataset.placeholder);if(!o.length)return!1;let l=o.map(c=>this._rectFor(c));for(let c of t)for(let d of l)if(this._rectsOverlap(c,d))return!0;return!1}_extractCardConfig(t){var o;if(!t)return{};let a=t._config||t.config;if(a&&typeof a=="object"&&Object.keys(a).length)return a;try{let l=t.closest?t.closest(".card-wrapper"):null,c=(o=l==null?void 0:l.dataset)==null?void 0:o.cfg;if(c){let d=JSON.parse(c);if(d&&typeof d=="object")return d}}catch{}return{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(t,a){try{console.info("[ddc:editor] Requesting editor element",{type:t,cfg:a})}catch{}let o=await this._helpersPromise||await window.loadCardHelpers();try{typeof t=="string"&&t&&!t.startsWith("custom:")&&t!=="custom_card"&&await this._ensureCardModuleLoaded(t,a)}catch{}if(typeof t=="string"&&t==="entity")try{return await this._getEntityCardEditor(a||{})}catch(m){console.warn("[ddc:editor] Custom entity editor failed",m)}let l=async()=>{try{if(o.getCardElementClass)return await o.getCardElementClass(t);let m;if(a&&typeof a=="object")m={type:t,...a};else{let g;try{g=await this._getStubConfigForType(t)}catch{}m=g&&typeof g=="object"?{...g}:{type:t}}let _=o.createCardElement(m);return(_==null?void 0:_.constructor)||null}catch{return null}};try{let m=await l();if(m){if(typeof m.getConfigElement=="function"){let _=await m.getConfigElement();if(_){try{console.info("[ddc:editor] Found static class editor",{type:t})}catch{}return _}}if(typeof m.getConfigForm=="function")try{let _=await m.getConfigForm();if(_&&_.schema){try{await customElements.whenDefined("ha-form")}catch{}let g=document.createElement("ha-form");g.hass=this.hass,g.schema=Array.isArray(_.schema)?_.schema.map(k=>({...k})):_.schema,typeof _.computeLabel=="function"&&(g.computeLabel=_.computeLabel.bind(m)),typeof _.computeHelper=="function"&&(g.computeHelper=_.computeHelper.bind(m)),g.data={...a},g.addEventListener("value-changed",k=>{});try{console.info("[ddc:editor] Generated form editor via getConfigForm",{type:t})}catch{}return g}}catch{}}}catch{}if(typeof t=="string"&&(t.startsWith("custom:")||t==="custom_card"))try{let m;try{m=await this._getStubConfigForType(t)}catch{}let _=m&&typeof m=="object"?{...m}:{type:t},g=o.createCardElement(_);if(g.hass=this.hass,typeof g.getConfigElement=="function"){let k=await g.getConfigElement();if(k){try{console.info("[ddc:editor] Found instance-level editor",{type:t})}catch{}return k}}}catch{}let c=String(t).replace(/^custom:/,""),f=(Array.isArray(window.customCards)?window.customCards:[]).find(m=>(m==null?void 0:m.type)===c||(m==null?void 0:m.type)===t||(m==null?void 0:m.type)===`custom:${c}`),v=[];f!=null&&f.editor&&v.push(f.editor),v.push(`${c}-editor`,`${c}-config-editor`),c&&typeof c=="string"&&v.push(`hui-${c}-card-editor`);for(let m of v)if(!(!m||typeof m!="string"))for(let _ of[0,100,300,700,1500,3e3])try{if(customElements.get(m)||await Promise.race([customElements.whenDefined(m),new Promise(g=>setTimeout(g,_))]),customElements.get(m)){try{console.info("[ddc:editor] Found editor by tag",{type:t,tag:m})}catch{}return document.createElement(m)}}catch{}return null}async _ensureCardModuleLoaded(t,a){try{let o=await this._helpersPromise||await window.loadCardHelpers(),l;if(a&&typeof a=="object")l={type:t,...a};else{let f;try{f=await this._getStubConfigForType(t)}catch{}l=f&&typeof f=="object"?{...f}:{type:t}}let c=o.createCardElement(l);c.hass=this.hass;let d=document.createElement("div");d.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;",d.appendChild(c),document.body.appendChild(d),await new Promise(f=>requestAnimationFrame(f)),d.remove();try{console.info("[ddc:editor] Warmed card module",{type:t})}catch{}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let t=document.createElement("style");t.setAttribute("data-ddc-overlay-fix",""),t.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(t)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(a=>{var o;return{type:(o=a==null?void 0:a.type)!=null&&o.startsWith("custom:")?a.type:`custom:${a==null?void 0:a.type}`,name:(a==null?void 0:a.name)||(a==null?void 0:a.type)||"Custom card",icon:"mdi:puzzle-outline",description:(a==null?void 0:a.description)||"",editorTag:(a==null?void 0:a.editor)||null}}).filter(a=>typeof a.type=="string"&&a.type.startsWith("custom:"))}_schemaForType(t){let a=l=>l,o=[];return{entities:a({fields:[{key:"entities",type:"entities",multi:!0,domains:o,label:"Entities"}]}),entity:a({fields:[{key:"entity",type:"entity",multi:!1,domains:o,label:"Entity"}]}),sensor:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:o,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:a({fields:[{key:"entities",type:"entities",multi:!0,domains:o,label:"Entities (multiselect)"}]}),"picture-glance":a({fields:[{key:"entities",type:"entities",multi:!0,domains:o,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":a({fields:[{key:"entity",type:"entity",multi:!1,domains:o,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:a({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:a({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:a({fields:[{key:"entity",type:"entity",multi:!1,domains:o,label:"Entity"}]}),button:a({fields:[{key:"entity",type:"entity",multi:!1,domains:o,label:"Entity (optional)"}]}),iframe:a({fields:[{key:"url",type:"text",label:"URL"}]}),area:a({fields:[{key:"area",type:"text",label:"Area ID"}]})}[t]||{fields:[]}}async _getEntityCardEditor(t={}){let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.gap="12px",a.style.padding="8px 0",a.style.overflow="visible",a._cfg={type:"entity",...t||{}};let o=()=>{let A={type:"entity"};["entity","name","icon","attribute","unit","state_color","theme"].forEach(O=>{let b=a._cfg[O];b!==void 0&&b!==""&&b!==null&&(A[O]=b)}),a.dispatchEvent(new CustomEvent("config-changed",{detail:{config:A}}))},l=document.createElement("div");l.style.display="flex",l.style.flexDirection="column",l.style.gap="4px";let c=document.createElement("span");c.textContent="Entity",c.style.fontSize=".8rem",c.style.opacity="0.8";let d=document.createElement("ha-entity-picker");d.setAttribute("label","Select entity"),d.addEventListener("value-changed",A=>{var b,M,R;A.stopPropagation();let O=(R=A.detail&&((b=A.detail.value)!=null?b:A.detail))!=null?R:(M=A.target)==null?void 0:M.value;a._cfg.entity=O||"";try{f()}catch{}o()}),l.appendChild(c),l.appendChild(d),a.appendChild(l);let f=()=>{},v=document.createElement("div");v.style.display="grid",v.style.gridTemplateColumns="1fr 1fr",v.style.columnGap="12px",v.style.rowGap="12px";let m=(A,O)=>{let b=document.createElement("div");b.style.display="flex",b.style.flexDirection="column",b.style.gap="4px";let M=document.createElement("span");M.textContent=A,M.style.fontSize=".8rem",M.style.opacity="0.8",b.appendChild(M),b.appendChild(O),v.appendChild(b)},_;customElements.get("ha-textfield")?(_=document.createElement("ha-textfield"),_.setAttribute("label","Name"),_.addEventListener("input",()=>{a._cfg.name=_.value||void 0,o()})):(_=document.createElement("input"),_.type="text",_.placeholder="Name",_.addEventListener("input",()=>{a._cfg.name=_.value||void 0,o()}),Object.assign(_.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),m("Name",_);let g;customElements.get("ha-icon-picker")?(g=document.createElement("ha-icon-picker"),g.setAttribute("label","Icon"),g.addEventListener("value-changed",A=>{var O;A.stopPropagation(),a._cfg.icon=((O=A.detail)==null?void 0:O.value)||void 0,o()}),Object.assign(g.style,{position:"relative",zIndex:"1000"})):customElements.get("ha-textfield")?(g=document.createElement("ha-textfield"),g.setAttribute("label","Icon"),g.addEventListener("input",()=>{a._cfg.icon=g.value||void 0,o()})):(g=document.createElement("input"),g.type="text",g.placeholder="mdi:icon",g.addEventListener("input",()=>{a._cfg.icon=g.value||void 0,o()}),Object.assign(g.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),m("Icon",g);let k;if(f=()=>{var K,ie;let A=[],O=(K=a._cfg)==null?void 0:K.entity,b=a._hass;if(O&&b&&b.states&&b.states[O]&&b.states[O].attributes)try{A=Object.keys(b.states[O].attributes||{}).filter(G=>G&&typeof G=="string"),A.sort()}catch{}let M=k&&typeof k.value!="undefined"?k.value:void 0,R=((k==null?void 0:k.tagName)||"").toLowerCase(),Z={min_color_temp_kelvin:"Minimum color temperature (Kelvin)",max_color_temp_kelvin:"Maximum color temperature (Kelvin)",min_color_temp_mireds:"Minimum color temperature (mireds)",max_color_temp_mireds:"Maximum color temperature (mireds)",min_mireds:"Minimum color temperature (mireds)",max_mireds:"Maximum color temperature (mireds)",effect_list:"Available effects",color_mode:"Color mode",brightness:"Brightness",hs_color:"Hs color",rgb_color:"Rgb color",xy_color:"Xy color",entity_id:"Entity ID",friendly_name:"Friendly name",icon:"Icon"},F=G=>Z[G]?Z[G]:G.split("_").map(ee=>ee&&(ee.toLowerCase()==="kelvin"?"Kelvin":ee.toLowerCase()==="mireds"?"mireds":ee.charAt(0).toUpperCase()+ee.slice(1))).join(" ");if(R==="ha-combo-box"){let G=A.map(ee=>({value:ee,label:F(ee)}));G.unshift({value:"",label:""}),k.items=G,M&&A.includes(M)?k.value=M:k.value=""}else if(R==="ha-select"){k.innerHTML="";let G=document.createElement("mwc-list-item");G.setAttribute("value",""),G.textContent="",k.appendChild(G);for(let ee of A){let _e=document.createElement("mwc-list-item");_e.setAttribute("value",ee),_e.textContent=F(ee),k.appendChild(_e)}M&&A.includes(M)?k.value=M:k.value="",(ie=k.requestUpdate)==null||ie.call(k)}else if(R==="select"){k.innerHTML="";let G=document.createElement("option");G.value="",G.textContent="",k.appendChild(G);for(let ee of A){let _e=document.createElement("option");_e.value=ee,_e.textContent=F(ee),k.appendChild(_e)}M&&A.includes(M)&&(k.value=M)}},customElements.get("ha-combo-box"))k=document.createElement("ha-combo-box"),k.setAttribute("label","Attribute"),k.setAttribute("item-label-path","label"),k.setAttribute("item-value-path","value"),k.setAttribute("allow-custom-value","false"),k.addEventListener("value-changed",A=>{var b,M;A.stopPropagation();let O=(M=(b=A.detail)==null?void 0:b.value)!=null?M:k.value;a._cfg.attribute=O||void 0,o()});else if(customElements.get("ha-select"))k=document.createElement("ha-select"),k.setAttribute("label","Attribute"),k.addEventListener("selected",A=>{A.stopPropagation(),a._cfg.attribute=k.value||void 0,o()}),Object.assign(k.style,{position:"relative",zIndex:"1000"});else{k=document.createElement("select");let A=document.createElement("option");A.value="",A.textContent="",k.appendChild(A),k.addEventListener("change",O=>{O.stopPropagation(),a._cfg.attribute=k.value||void 0,o()}),Object.assign(k.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),Object.assign(k.style,{position:"relative",zIndex:"1000"})}f(),m("Attribute",k);let z;customElements.get("ha-textfield")?(z=document.createElement("ha-textfield"),z.setAttribute("label","Unit"),z.addEventListener("input",()=>{a._cfg.unit=z.value||void 0,o()})):(z=document.createElement("input"),z.type="text",z.placeholder="Unit",z.addEventListener("input",()=>{a._cfg.unit=z.value||void 0,o()}),Object.assign(z.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),m("Unit",z);let E;if(customElements.get("ha-select"))E=document.createElement("ha-select"),E.setAttribute("label","Theme (optional)"),E.addEventListener("selected",A=>{A.stopPropagation(),a._cfg.theme=E.value||void 0,o()});else{E=document.createElement("select");let A=document.createElement("option");A.value="",A.textContent="",E.appendChild(A),E.addEventListener("change",O=>{O.stopPropagation(),a._cfg.theme=E.value||void 0,o()}),Object.assign(E.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})}m("Theme (optional)",E);let L;customElements.get("ha-switch")?(L=document.createElement("ha-switch"),L.addEventListener("change",()=>{a._cfg.state_color=!!L.checked,o()})):(L=document.createElement("input"),L.type="checkbox",L.addEventListener("change",()=>{a._cfg.state_color=!!L.checked,o()}));let I=document.createElement("div");I.style.display="flex",I.style.alignItems="center",I.style.gap="8px";let C=document.createElement("span");return C.textContent="Show state color",C.style.fontSize=".8rem",C.style.opacity="0.8",I.appendChild(C),I.appendChild(L),v.appendChild(I),a.appendChild(v),a.setConfig=(A={})=>{a._cfg={type:"entity",...A||{}};let O=a._cfg;if(d&&("value"in d&&(d.value=O.entity||""),d.setAttribute&&d.setAttribute("value",O.entity||"")),_&&(_.value=O.name||""),g&&(g.value=O.icon||""),k){try{f()}catch{}k.value=O.attribute||""}z&&(z.value=O.unit||""),E&&(E.value=O.theme||""),L&&"checked"in L&&(L.checked=!!O.state_color)},Object.defineProperty(a,"hass",{get(){return this._hass},set(A){var O;if(this._hass=A,d){try{d.hass=A}catch{}customElements.get("ha-entity-picker")||customElements.whenDefined("ha-entity-picker").then(()=>{var b;try{d.hass=this._hass,(b=d.requestUpdate)==null||b.call(d)}catch{}}).catch(()=>{})}if(g){try{g.hass=A}catch{}customElements.get("ha-icon-picker")||customElements.whenDefined("ha-icon-picker").then(()=>{var b;try{g.hass=this._hass,(b=g.requestUpdate)==null||b.call(g)}catch{}}).catch(()=>{})}if(E){let b=[];A&&A.themes&&(A.themes.themes?b=Object.keys(A.themes.themes):typeof A.themes=="object"&&(b=Object.keys(A.themes).filter(Z=>Z!=="default_theme")));let M=E.value,R=(E.tagName||"").toLowerCase();if(R==="ha-select"){E.innerHTML="";let Z=document.createElement("mwc-list-item");Z.setAttribute("value",""),Z.textContent="",E.appendChild(Z);for(let F of b){let K=document.createElement("mwc-list-item");K.setAttribute("value",F),K.textContent=F,E.appendChild(K)}M&&b.includes(M)?E.value=M:M||(E.value=""),(O=E.requestUpdate)==null||O.call(E)}else if(R==="select"){E.innerHTML="";let Z=document.createElement("option");Z.value="",Z.textContent="",E.appendChild(Z);for(let F of b){let K=document.createElement("option");K.value=F,K.textContent=F,E.appendChild(K)}M&&Array.from(E.options).some(F=>F.value===M)&&(E.value=M)}}try{f()}catch{}}}),a.setConfig(t||{}),a}_shapeBySchema(t,a={}){let o=this._schemaForType(t)||{fields:[]},l={...a,type:t};for(let c of o.fields){let d=l[c.key];if(c.type==="entities"){let v=(Array.isArray(d)?d:d!=null&&d!==""?[d]:[]).filter(Boolean);v.length?l[c.key]=v:delete l[c.key]}else if(c.type==="entity")Array.isArray(d)&&(d=d[0]),d==null||d===""?delete l[c.key]:l[c.key]=String(d);else if(c.type==="number")if(d==null||d==="")delete l[c.key];else{let f=Number(d);Number.isFinite(f)?l[c.key]=f:delete l[c.key]}else(c.type==="select"||c.type==="text"||c.type==="textarea")&&(d==null||d===""?delete l[c.key]:l[c.key]=d)}return l}_statesList(t){var l;let a=Object.keys(((l=this.hass)==null?void 0:l.states)||{});if(!t||!t.length)return a;if(!this.__domainIndex||this.__domainIndex._gen!==a.length){let c={};for(let d of a){let f=d.split(".")[0];(c[f]||(c[f]=[])).push(d)}this.__domainIndex={_gen:a.length,map:c}}let o=[];for(let c of t)this.__domainIndex.map[c]&&o.push(...this.__domainIndex.map[c]);return o}_isNumericEntity(t){var l,c;let a=(c=(l=this.hass)==null?void 0:l.states)==null?void 0:c[t];if(!a)return!1;let o=Number(a.state);return Number.isFinite(o)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(t){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(t)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(t){try{let a=this._getRecent().filter(o=>o!==t);a.unshift(t),a.length>10&&(a.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(a))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let t=document.createElement("link");t.rel="stylesheet",t.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",t.setAttribute("data-cm-core",""),document.head.appendChild(t)}await new Promise(t=>{if(window.CodeMirror)return t();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",a.onload=t,document.head.appendChild(a)}),await new Promise(t=>{var o,l;if((l=(o=window.CodeMirror)==null?void 0:o.mimeModes)!=null&&l.yaml)return t();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",a.onload=t,document.head.appendChild(a)}),this.__cmReady=!0}}async _mountYamlEditor(t,a,o,l){let c=v=>window.jsyaml?window.jsyaml.dump(v):JSON.stringify(v,null,2),d=v=>window.jsyaml?window.jsyaml.load(v):JSON.parse(v);t.innerHTML="";let f=c(a);if(customElements.get("ha-code-editor")){let v=document.createElement("ha-code-editor");v.mode="yaml",v.hass=this.hass,v.value=f,v.style.display="block",v.style.height="260px",t.appendChild(v);let m=!1;return v.addEventListener("value-changed",_=>{var k,z,E;if(m)return;let g=(E=(z=(k=_.detail)==null?void 0:k.value)!=null?z:v.value)!=null?E:"";try{o(d(g))}catch(L){l==null||l(L)}}),{setValue:_=>{var k;let g=c(_);((k=v.value)!=null?k:"")!==g&&(m=!0,v.value=g,m=!1)}}}try{await this._ensureCodeMirror();let v=window.CodeMirror(t,{value:f,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),m=!1;return v.on("change",()=>{if(m)return;let _=v.getValue();try{o(d(_))}catch(g){l==null||l(g)}}),{setValue:_=>{let g=c(_);v.getValue()!==g&&(m=!0,v.setValue(g),m=!1)}}}catch{let v=document.createElement("textarea");return v.style.width="100%",v.style.height="260px",v.value=f,v.addEventListener("input",()=>{try{o(d(v.value))}catch(m){l==null||l(m)}}),t.appendChild(v),{setValue:m=>{let _=c(m);v.value!==_&&(v.value=_)}}}}_createVirtualList({container:t,items:a,rowHeight:o=36,renderRow:l}){t.style.position="relative",t.style.overflow="auto";let c=document.createElement("div");c.style.height=`${a.length*o}px`,t.innerHTML="",t.appendChild(c);let d=new Map,f=()=>{let v=t.scrollTop,m=t.clientHeight,_=Math.max(0,Math.floor(v/o)-6),g=Math.min(a.length-1,Math.ceil((v+m)/o)+6);for(let[k,z]of d)(k<_||k>g)&&(z.remove(),d.delete(k));for(let k=_;k<=g;k++){if(d.has(k))continue;let z=l(a[k],k);z.style.position="absolute",z.style.left="0",z.style.right="0",z.style.top=`${k*o}px`,d.set(k,z),t.appendChild(z)}};return t.addEventListener("scroll",f,{passive:!0}),new ResizeObserver(f).observe(t),f(),{refresh(v){if(v){a=v,c.style.height=`${a.length*o}px`;for(let[,m]of d)m.remove();d.clear()}f()}}}async _openSmartPicker(t="add",a=null,o=null){let l=()=>c.remove(),c=document.createElement("div");c.className="modal",c.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${t==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${t==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                    <!-- DDC: Visibility tab allows configuring when the card should be shown -->
                    <button id="tabVis" class="tab">Visibility</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>

              <!-- DDC: Visibility section shares the same grid row as YAML. It is hidden by default and shown when the Visibility tab is selected. -->
              <div class="sec" id="visSec" style="grid-column:1;grid-row:3;min-height:0;display:none">
                <div class="hd">Visibility</div>
                <div class="bd" style="min-height:0">
                  <div id="visHost"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${t==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.shadowRoot.appendChild(c);let d=c.querySelector("#leftPane"),f=c.querySelector("#addBtn"),v=c.querySelector("#footAdd"),m=c.querySelector("#cancelBtn"),_=c.querySelector("#footCancel"),g=c.querySelector("#search"),k=c.querySelector("#cardHost"),z=c.querySelector("#editorHost"),E=c.querySelector("#editorSpin"),L=c.querySelector("#quickFill"),I=c.querySelector("#yamlHost"),C=c.querySelector("#yamlErr"),A=c.querySelector("#yamlSec"),O=c.querySelector("#tabVisual"),b=c.querySelector("#tabYaml"),M=c.querySelector("#tabVis"),R=c.querySelector("#visSec"),Z=c.querySelector("#visHost"),F=c.querySelector("#err"),K=c.querySelector("#previewSpin"),ie=D=>{f.disabled=v.disabled=!D},G=D=>{D?(F.hidden=!1,F.textContent=D):(F.hidden=!0,F.textContent="")},ee=this._getFaves(),_e=this._getRecent(),Te=this._catalog(),et=Te.find(D=>D.id==="favorites"),Ye=Te.find(D=>D.id==="recent"),je=Te.flatMap(D=>D.items||[]);et.items=je.filter(D=>ee.has(D.type)),Ye.items=_e.map(D=>je.find(B=>B.type===D)).filter(Boolean);let Ne=this._customCardsFromRegistry();Ne.length&&Te.push({id:"custom",name:"Custom (installed)",items:Ne});let Me=c.querySelector("#quickFillSec");Me&&(Me.style.display="none");let nt=c.querySelector("#optionsSec .hd"),tt,Ge,it=()=>{if(!Ge)return;let D=Re&&ee.has(Re),B=Ge.querySelector("ha-icon");B&&B.setAttribute("icon",D?"mdi:star":"mdi:star-outline")},pt=D=>{if(tt){let B=je.find(ce=>ce.type===D),ne=B?B.name:D||"";tt.textContent=ne}it()};if(nt&&!nt.querySelector(".sel-info")){let D=nt.querySelector("span");D&&(D.style.display="none"),tt=document.createElement("span"),tt.className="sel-info",tt.style.flex="1",tt.style.fontWeight="bold",tt.style.paddingRight="8px",nt.insertBefore(tt,nt.firstChild),Ge=document.createElement("button"),Ge.className="icon-btn",Ge.setAttribute("title","Favorite"),Object.assign(Ge.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--primary-background-color)",padding:"0",marginLeft:"4px",cursor:"pointer"}),Ge.innerHTML='<ha-icon icon="mdi:star-outline"></ha-icon>',nt.appendChild(Ge),Ge.addEventListener("click",B=>{B.stopPropagation(),Re&&(ee.has(Re)?ee.delete(Re):ee.add(Re),this._setFaves(ee),it(),at())})}let rt="visual",oe=D=>{let B=D==="yaml",ne=D==="vis",ce=!B&&!ne;O.classList.toggle("active",ce),O.setAttribute("aria-selected",String(ce)),b.classList.toggle("active",B),b.setAttribute("aria-selected",String(B)),M&&(M.classList.toggle("active",ne),M.setAttribute("aria-selected",String(ne))),z.parentElement.style.display=ce?"":"none",A.style.display=B?"":"none",R&&(R.style.display=ne?"":"none"),B?A.scrollIntoView({behavior:"smooth",block:"start"}):ne&&R&&R.scrollIntoView({behavior:"smooth",block:"start"}),rt=B?"yaml":ne?"vis":"visual"};O.addEventListener("click",async()=>{var D;if(oe("visual"),!Ce)await W(re);else try{(D=Ce.setConfig)==null||D.call(Ce,re)}catch{}}),b.addEventListener("click",()=>oe("yaml")),M&&M.addEventListener("click",()=>{oe("vis");try{mt(re)}catch{}}),oe("visual");let ft=()=>{let D=g.value.trim().toLowerCase();return Te.map(B=>({...B,items:(B.items||[]).filter(ne=>!D||ne.name.toLowerCase().includes(D)||ne.type.toLowerCase().includes(D))})).filter(B=>B.items&&B.items.length||B.id==="favorites"||B.id==="recent")},at=()=>{let D=ft();d.innerHTML="",D.forEach(B=>{let ne=document.createElement("div");ne.style.padding="12px",ne.style.borderBottom="1px solid var(--divider-color)";let ce=document.createElement("h4");if(ce.textContent=B.name,ce.style.margin="0 0 10px 0",ce.style.fontSize=".92rem",ce.style.opacity=".85",ne.appendChild(ce),!B.items.length&&(B.id==="favorites"||B.id==="recent")){let de=document.createElement("div");de.style.opacity=".6",de.style.fontSize=".85rem",de.textContent=B.id==="favorites"?"No favorites yet.":"No recent items yet.",ne.appendChild(de)}else B.items.forEach(de=>{let ye=document.createElement("button");ye.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${de.icon}"></ha-icon><span>${de.name}</span>
            </span>`,Object.assign(ye.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),ye.addEventListener("click",async()=>{De(ye),await ve(de.type)}),ne.appendChild(ye)});d.appendChild(ne)})},De=D=>{d.querySelectorAll("button").forEach(B=>{B.classList.remove("active"),B.style.background="transparent",B.style.color=""}),D&&(D.classList.add("active"),D.style.background="rgba(3,169,244,.12)",D.style.color="var(--primary-color)")},re=null,Re=null,Ae=null,Ce=null,ct=null,lt=0,kt=null,xt="",_t=(D,B)=>{var N;let ne=this._schemaForType(D);if(L.innerHTML="",!ne.fields.length){L.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let ce=Object.keys(((N=this.hass)==null?void 0:N.states)||{}),de=document.createElement("div"),ye=(J,Oe,H,Le)=>{let Be=document.createElement("div");Object.assign(Be.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),Be.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${J}</span>`,Oe.includes(J)&&(Be.style.background="rgba(3,169,244,.12)",Be.style.borderColor="var(--primary-color)",Be.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),Be.addEventListener("click",async()=>{let Ve=Oe.indexOf(J);Ve>=0?Oe.splice(Ve,1):Oe.push(J);let Fe=Oe.includes(J);Be.style.background=Fe?"rgba(3,169,244,.12)":"",Be.style.borderColor=Fe?"var(--primary-color)":"var(--divider-color)",Be.querySelector("ha-icon").setAttribute("icon",Fe?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),re=this._shapeBySchema(D,{...re,[Le]:[...Oe]}),ot(re),Ae==null||Ae.setValue(re)}),H.appendChild(Be)};ne.fields.forEach(J=>{var Le,Be,Ve,Fe,Qe,Xe,Je,$e,We;let Oe=document.createElement("div");Object.assign(Oe.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let H=document.createElement("label");if(H.textContent=J.label||J.key,H.style.minWidth="130px",J.type==="entities"){let Ee=document.createElement("div");Ee.style.flex="1";let fe=document.createElement("input");Object.assign(fe,{placeholder:"Filter entities\u2026"}),Object.assign(fe.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let we=document.createElement("div");Object.assign(we.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let ze=J.domains&&J.domains.length?this._statesList(J.domains):ce,ke=Array.isArray(B[J.key])?[...B[J.key]]:B[J.key]?[B[J.key]]:[],pe=V=>{let U=document.createElement("div");Object.assign(U.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let j=document.createElement("ha-icon");j.setAttribute("icon","mdi:checkbox-blank-outline"),j.style.setProperty("--mdc-icon-size","18px");let me=document.createElement("span");me.textContent=V,me.style.whiteSpace="nowrap",me.style.overflow="hidden",me.style.textOverflow="ellipsis",U.append(j,me);let Ue=()=>{let He=ke.includes(V);U.style.background=He?"rgba(3,169,244,.12)":"",U.style.borderColor=He?"var(--primary-color)":"var(--divider-color)",j.setAttribute("icon",He?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return Ue(),U.addEventListener("click",()=>{let He=ke.indexOf(V);He>=0?ke.splice(He,1):ke.push(V),re=this._shapeBySchema(D,{...re,[J.key]:[...ke]}),ot(re),Ae==null||Ae.setValue(re),Ue()}),U},ae=ze;this._createVirtualList({container:we,items:ae,rowHeight:36,renderRow:pe}),fe.addEventListener("input",()=>{let V=fe.value.trim().toLowerCase();ae=ze.filter(U=>!V||U.toLowerCase().includes(V)),this._createVirtualList({container:we,items:ae,rowHeight:36,renderRow:pe})}),Ee.append(fe,we),Oe.append(H,Ee),re=this._shapeBySchema(D,{...B,[J.key]:ke})}if(J.type==="entity"){let Ee=document.createElement("div");Ee.style.flex="1",Ee.style.position="relative";let fe=document.createElement("input");fe.setAttribute("list","ddc_entlist_"+J.key),Object.assign(fe.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),fe.placeholder=`Select ${((Le=J.label)==null?void 0:Le.toLowerCase())||"entity"}\u2026`;let we=document.createElement("ha-icon");we.setAttribute("icon","mdi:magnify"),Object.assign(we.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let ze=document.createElement("datalist");ze.id="ddc_entlist_"+J.key;let ke=J.domains&&J.domains.length?this._statesList(J.domains):Object.keys(((Be=this.hass)==null?void 0:Be.states)||{});ze.innerHTML=ke.map(pe=>`<option value="${pe}">`).join(""),fe.value=Array.isArray(B[J.key])?B[J.key][0]||"":B[J.key]||"",fe.addEventListener("change",async()=>{re=this._shapeBySchema(D,{...re,[J.key]:fe.value||void 0}),ot(re),Ae==null||Ae.setValue(re)}),Ee.append(we,fe,ze),Oe.append(H,Ee)}if(J.type==="number"){let Ee=document.createElement("div");Ee.style.flex="1",Ee.style.position="relative";let fe=document.createElement("input");fe.type="number",J.step&&(fe.step=J.step),Object.assign(fe.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let we=document.createElement("ha-icon");we.setAttribute("icon","mdi:counter"),Object.assign(we.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),fe.value=(Fe=(Ve=B[J.key])!=null?Ve:J.default)!=null?Fe:"",fe.addEventListener("input",async()=>{let ze=fe.value===""?void 0:Number(fe.value);re=this._shapeBySchema(D,{...re,[J.key]:isNaN(ze)?void 0:ze}),ot(re),Ae==null||Ae.setValue(re)}),Ee.append(we,fe),Oe.append(H,Ee)}if(J.type==="select"){let Ee=document.createElement("div");Ee.style.flex="1",Ee.style.position="relative";let fe=document.createElement("select");Object.assign(fe.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let we=document.createElement("ha-icon");we.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(we.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(J.options||[]).forEach(ze=>{let ke=document.createElement("option");ke.value=ze,fe.appendChild(ke)}),fe.value=(Je=(Qe=B[J.key])!=null?Qe:J.default)!=null?Je:((Xe=J.options)==null?void 0:Xe[0])||"",fe.addEventListener("change",async()=>{re=this._shapeBySchema(D,{...re,[J.key]:fe.value}),ot(re),Ae==null||Ae.setValue(re)}),Ee.append(we,fe),Oe.append(H,Ee)}if(J.type==="text"){let Ee=document.createElement("div");Ee.style.flex="1",Ee.style.position="relative";let fe=document.createElement("input");fe.type="text",Object.assign(fe.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let we=document.createElement("ha-icon");we.setAttribute("icon","mdi:text"),Object.assign(we.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),fe.value=($e=B[J.key])!=null?$e:"",fe.addEventListener("input",async()=>{re=this._shapeBySchema(D,{...re,[J.key]:fe.value||void 0}),ot(re),Ae==null||Ae.setValue(re)}),Ee.append(we,fe),Oe.append(H,Ee)}if(J.type==="textarea"){let Ee=document.createElement("textarea");Object.assign(Ee.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),Ee.value=(We=B[J.key])!=null?We:"",Ee.addEventListener("input",async()=>{re=this._shapeBySchema(D,{...re,[J.key]:Ee.value||""}),ot(re),Ae==null||Ae.setValue(re)}),Oe.append(H,Ee)}de.appendChild(Oe)}),L.innerHTML="",L.appendChild(de)},Ke=new WeakMap,Dt=D=>{if(!Z)return;let B=Array.isArray(D==null?void 0:D.visibility)?D.visibility.map(ye=>({...ye})):[],ne=()=>mt(re),ce=()=>{var ye;B=B.filter(N=>N&&typeof N=="object"&&N.condition),re={...re,visibility:B};try{Ae==null||Ae.setValue(re)}catch{}try{(ye=Ce==null?void 0:Ce.setConfig)==null||ye.call(Ce,re)}catch{}ot(re)},de=()=>{if(Z.innerHTML="",!B||!B.length){let N=document.createElement("div");N.style.opacity=".7",N.style.fontSize=".9rem",N.style.marginBottom="8px",N.textContent="No conditions defined \u2013 this card is always visible.",Z.appendChild(N)}B.forEach((N,J)=>{let Oe=document.createElement("div");Object.assign(Oe.style,{display:"flex",flexDirection:"column",gap:"6px",marginBottom:"12px",border:"1px solid var(--divider-color)",borderRadius:"8px",padding:"8px"});let H=document.createElement("div");Object.assign(H.style,{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"});let Le=document.createElement("div");Le.style.display="flex",Le.style.alignItems="center",Le.style.gap="6px";let Be=document.createElement("ha-icon"),Ve="mdi:filter",Fe=N.condition||"state";Fe==="numeric_state"?Ve="mdi:numeric":Fe==="screen"?Ve="mdi:monitor":Fe==="user"?Ve="mdi:account":Fe==="state"&&(Ve="mdi:state-machine"),Be.setAttribute("icon",Ve);let Qe=document.createElement("span");Qe.style.fontWeight="bold",Qe.style.textTransform="capitalize",Qe.textContent=Fe==="numeric_state"?"Entity numeric state":Fe==="state"?"Entity state":Fe==="screen"?"Screen":"User",Le.appendChild(Be),Le.appendChild(Qe),H.appendChild(Le);let Xe=document.createElement("button");Xe.setAttribute("title","Remove condition"),Xe.innerHTML='<ha-icon icon="mdi:trash-can-outline"></ha-icon>',Object.assign(Xe.style,{border:"none",background:"transparent",cursor:"pointer",padding:"4px",display:"inline-flex",alignItems:"center"}),Xe.style.position="relative",Xe.style.zIndex="1000",Xe.addEventListener("click",ze=>{ze.preventDefault(),ze.stopPropagation();let ke=B.indexOf(N);ke>-1&&B.splice(ke,1),re.visibility=B,de(),ce()}),H.appendChild(Xe),Oe.appendChild(H);let Je=document.createElement("div");Je.style.display="flex",Je.style.gap="8px";let $e=document.createElement("label");$e.textContent="Type",$e.style.fontSize=".85rem",$e.style.marginRight="4px";let We=document.createElement("select");["state","numeric_state","screen","user"].forEach(ze=>{let ke=document.createElement("option");ke.value=ze,ke.textContent=ze.replace("_"," "),We.appendChild(ke)}),We.value=Fe,We.addEventListener("change",()=>{N.condition=We.value,delete N.entity,delete N.state,delete N.state_not,delete N.above,delete N.below,delete N.media_query,delete N.users,de(),ce()}),Je.appendChild($e),Je.appendChild(We),Oe.appendChild(Je);let Ee=document.createElement("div");Object.assign(Ee.style,{display:"flex",flexWrap:"wrap",gap:"8px",alignItems:"center"});let fe=(ze,ke)=>{let pe=document.createElement("div");pe.style.display="flex",pe.style.flexDirection="column",pe.style.gap="4px",pe.style.minWidth="150px";let ae=document.createElement("span");ae.textContent=ze,ae.style.fontSize=".75rem",pe.appendChild(ae),pe.appendChild(ke),Ee.appendChild(pe)};(()=>{var ze,ke;if(Ee.innerHTML="",N.condition==="state"){let pe;customElements.get("ha-entity-picker")?(pe=document.createElement("ha-entity-picker"),pe.hass=this.hass,pe.setAttribute("label","Select entity"),pe.removeAttribute("hide-clear-icon"),pe.value=N.entity||"",pe.addEventListener("value-changed",U=>{U.stopPropagation(),N.entity=U.detail.value||"",ce()})):(pe=document.createElement("input"),pe.value=N.entity||"",pe.addEventListener("input",()=>{N.entity=pe.value.trim(),ce()}),Object.assign(pe.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),fe("Entity",pe);let ae;if(customElements.get("ha-select")){ae=document.createElement("ha-select");let U=document.createElement("mwc-list-item");U.setAttribute("value","state"),U.textContent="State is equal to";let j=document.createElement("mwc-list-item");j.setAttribute("value","state_not"),j.textContent="State is not equal to",ae.appendChild(U),ae.appendChild(j),ae.value=N.state_not!=null?"state_not":"state",ae.addEventListener("selected",me=>{me.stopPropagation();let Ue=N.state_not!=null?N.state_not:N.state;ae.value==="state_not"?(N.state_not=Ue,delete N.state):(N.state=Ue,delete N.state_not),ce()})}else ae=document.createElement("select"),ae.innerHTML='<option value="state">State is equal to</option><option value="state_not">State is not equal to</option>',ae.value=N.state_not!=null?"state_not":"state",Object.assign(ae.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),ae.addEventListener("change",U=>{U.stopPropagation();let j=N.state_not!=null?N.state_not:N.state;ae.value==="state_not"?(N.state_not=j,delete N.state):(N.state=j,delete N.state_not),ce()});fe("Match type",ae);let V;customElements.get("ha-textfield")?(V=document.createElement("ha-textfield"),V.value=(N.state_not!=null?N.state_not:N.state)||"",V.setAttribute("label",""),V.addEventListener("input",U=>{U.stopPropagation();let j=ae.value;N[j]=V.value;let me=j==="state"?"state_not":"state";delete N[me],ce()})):(V=document.createElement("input"),V.value=(N.state_not!=null?N.state_not:N.state)||"",Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),V.addEventListener("input",U=>{U.stopPropagation();let j=ae.value;N[j]=V.value;let me=j==="state"?"state_not":"state";delete N[me],ce()})),fe("State",V)}else if(N.condition==="numeric_state"){let pe;customElements.get("ha-entity-picker")?(pe=document.createElement("ha-entity-picker"),pe.hass=this.hass,pe.setAttribute("label","Select entity"),pe.removeAttribute("hide-clear-icon"),pe.value=N.entity||"",pe.addEventListener("value-changed",U=>{U.stopPropagation(),N.entity=U.detail.value||"",ce()})):(pe=document.createElement("input"),pe.value=N.entity||"",pe.addEventListener("input",()=>{N.entity=pe.value.trim(),ce()}),Object.assign(pe.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),fe("Entity",pe);let ae;customElements.get("ha-textfield")?(ae=document.createElement("ha-textfield"),ae.setAttribute("type","number"),ae.value=N.above!=null?N.above:"",ae.addEventListener("input",U=>{U.stopPropagation();let j=ae.value;j===""||isNaN(Number(j))?delete N.above:N.above=Number(j),ce()})):(ae=document.createElement("input"),ae.type="number",ae.value=N.above!=null?N.above:"",Object.assign(ae.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),ae.addEventListener("input",()=>{let U=ae.value;U===""||isNaN(Number(U))?delete N.above:N.above=Number(U),ce()})),fe("Above",ae);let V;customElements.get("ha-textfield")?(V=document.createElement("ha-textfield"),V.setAttribute("type","number"),V.value=N.below!=null?N.below:"",V.addEventListener("input",U=>{U.stopPropagation();let j=V.value;j===""||isNaN(Number(j))?delete N.below:N.below=Number(j),ce()})):(V=document.createElement("input"),V.type="number",V.value=N.below!=null?N.below:"",Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),V.addEventListener("input",()=>{let U=V.value;U===""||isNaN(Number(U))?delete N.below:N.below=Number(U),ce()})),fe("Below",V)}else if(N.condition==="screen"){let pe=document.createElement("select"),ae=[{label:"Custom",value:""},{label:"Mobile (max-width: 599px)",value:"(max-width: 599px)"},{label:"Tablet (600px - 991px)",value:"(min-width: 600px) and (max-width: 991px)"},{label:"Desktop (min-width: 992px)",value:"(min-width: 992px)"}];if(ae.forEach(V=>{let U=document.createElement("option");U.value=V.value,U.textContent=V.label,pe.appendChild(U)}),pe.value=(ke=(ze=ae.find(V=>V.value===(N.media_query||"")))==null?void 0:ze.value)!=null?ke:"",pe.addEventListener("change",()=>{N.media_query=pe.value,ce()}),fe("Screen size",pe),pe.value===""){let V=document.createElement("input");V.placeholder="e.g. (min-width: 1280px)",V.value=N.media_query||"",V.addEventListener("input",()=>{N.media_query=V.value,ce()}),fe("Custom query",V)}}else if(N.condition==="user"){let pe;customElements.get("ha-user-picker")?(pe=document.createElement("ha-user-picker"),pe.hass=this.hass,pe.value=Array.isArray(N.users)?N.users:[],pe.addEventListener("value-changed",ae=>{N.users=Array.isArray(ae.detail.value)?ae.detail.value:[ae.detail.value],ce()})):(pe=document.createElement("input"),pe.value=Array.isArray(N.users)?N.users.join(","):"",pe.addEventListener("input",()=>{N.users=pe.value.split(",").map(ae=>ae.trim()).filter(Boolean),ce()})),fe("Users",pe)}})(),Oe.appendChild(Ee),Z.appendChild(Oe)});let ye=document.createElement("button");ye.className="btn",ye.innerHTML='<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add condition</span>',Object.assign(ye.style,{marginTop:"8px"}),ye.addEventListener("click",()=>{B.push({condition:"state",entity:"",state:""}),re.visibility=B,de(),ce()}),Z.appendChild(ye)};de()},mt=D=>{if(!Z)return;let B=Array.isArray(D==null?void 0:D.visibility)?D.visibility:[],ne=null,ce=async()=>{if(ne)return ne;try{if(this.hass&&typeof this.hass.callWS=="function")try{let J=await this.hass.callWS({type:"config/auth/list"});if(Array.isArray(J))return ne=J,J}catch{}if(this.hass&&typeof this.hass.callApi=="function")try{let J=await this.hass.callApi("get","users");if(Array.isArray(J))return ne=J,J}catch{}let N=[];if(this.hass&&this.hass.users&&Array.isArray(this.hass.users)&&N.push(...this.hass.users),this.hass&&this.hass.userData&&Array.isArray(this.hass.userData.users)&&N.push(...this.hass.userData.users),this.hass&&this.hass.authorizedUsers&&Array.isArray(this.hass.authorizedUsers)&&N.push(...this.hass.authorizedUsers),N.length){let J=new Map;N.forEach(H=>{let Le=H.id||H.user_id||H.uid||H.name||"";J.has(Le)||J.set(Le,H)});let Oe=Array.from(J.values());return ne=Oe,Oe}}catch{}return ne=[],[]},de=()=>{var N;B=B.filter(J=>J&&typeof J=="object"&&J.condition),re.visibility=B;try{Ae==null||Ae.setValue(re)}catch{}try{(N=Ce==null?void 0:Ce.setConfig)==null||N.call(Ce,re)}catch{}ot(re)},ye=()=>{Z.innerHTML="";let N=document.createElement("div");N.style.opacity=".75",N.style.fontSize=".85rem",N.style.marginBottom="12px",N.textContent="The card will be shown when ALL conditions below are fulfilled. If no conditions are set, the card will always be shown.",Z.appendChild(N);let J=(H,Le)=>{H.forEach((Fe,Qe)=>{Oe(Fe,H,Qe,Le)});let Be=document.createElement("div");Be.style.marginTop="8px";let Ve=document.createElement("button");Ve.className="btn",Ve.innerHTML='<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add condition</span>',Object.assign(Ve.style,{display:"flex",alignItems:"center",gap:"6px",padding:"6px 12px",border:"none",borderRadius:"20px",background:"var(--primary-color)",color:"var(--text-primary-color, #fff)",cursor:"pointer",fontWeight:"500"}),Ve.addEventListener("click",Fe=>{Fe.stopPropagation();let Qe=Be.querySelector(".add-menu");if(Qe){Qe.remove();return}let Xe=document.createElement("div");Xe.className="add-menu",Object.assign(Xe.style,{position:"relative",marginTop:"4px",border:"1px solid var(--divider-color)",borderRadius:"8px",background:"var(--card-background-color, var(--secondary-background-color))",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}),[{type:"numeric_state",label:"Entity numeric state",icon:"mdi:numeric"},{type:"state",label:"Entity state",icon:"mdi:state-machine"},{type:"screen",label:"Screen",icon:"mdi:monitor"},{type:"user",label:"User",icon:"mdi:account"},{type:"and",label:"And",icon:"mdi:logic-and"},{type:"or",label:"Or",icon:"mdi:logic-or"}].forEach($e=>{let We=document.createElement("div");We.style.display="flex",We.style.alignItems="center",We.style.gap="8px",We.style.padding="6px 12px",We.style.cursor="pointer",We.addEventListener("mouseenter",()=>We.style.background="var(--hover-color, #444)"),We.addEventListener("mouseleave",()=>We.style.background=""),We.addEventListener("click",()=>{Xe.remove();let we;$e.type==="and"||$e.type==="or"?we={condition:$e.type,conditions:[]}:$e.type==="state"?we={condition:"state",entity:"",state:""}:$e.type==="numeric_state"?we={condition:"numeric_state",entity:""}:$e.type==="screen"?we={condition:"screen",media_query:""}:$e.type==="user"&&(we={condition:"user",users:[]}),H.push(we),Ke.set(we,!0),de(),ye()});let Ee=document.createElement("ha-icon");Ee.setAttribute("icon",$e.icon),We.appendChild(Ee);let fe=document.createElement("span");fe.textContent=$e.label,We.appendChild(fe),Xe.appendChild(We)}),Be.appendChild(Xe)}),Be.appendChild(Ve),Le.appendChild(Be)},Oe=(H,Le,Be,Ve)=>{let Fe=H.condition||"state",Qe=Ke.get(H);Qe===void 0&&(Qe=B.length===1);let Xe=document.createElement("div");Object.assign(Xe.style,{display:"flex",flexDirection:"column",border:"1px solid var(--divider-color)",borderLeft:"3px solid var(--primary-color)",borderRadius:"12px",padding:"16px",marginBottom:"20px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",boxShadow:"var(--ha-card-box-shadow, 0 2px 6px rgba(0, 0, 0, 0.15))"});let Je=document.createElement("div");Je.style.display="flex",Je.style.alignItems="center",Je.style.justifyContent="space-between",Je.style.marginBottom="8px",Je.style.borderBottom="1px solid var(--divider-color)",Je.style.paddingBottom="4px",Je.style.position="relative";let $e=document.createElement("div");$e.style.display="flex",$e.style.alignItems="center",$e.style.gap="6px";let We=document.createElement("button");We.innerHTML=`<ha-icon icon="${Qe?"mdi:chevron-down":"mdi:chevron-right"}"></ha-icon>`,Object.assign(We.style,{border:"none",background:"transparent",cursor:"pointer",padding:"4px",display:"inline-flex",alignItems:"center"}),We.addEventListener("click",ke=>{ke.stopPropagation(),Ke.set(H,!Qe),ye()}),$e.appendChild(We);let Ee=document.createElement("ha-icon"),fe="mdi:filter";Fe==="numeric_state"?fe="mdi:numeric":Fe==="screen"?fe="mdi:monitor":Fe==="user"?fe="mdi:account":Fe==="state"?fe="mdi:state-machine":Fe==="and"?fe="mdi:logic-and":Fe==="or"&&(fe="mdi:logic-or"),Ee.setAttribute("icon",fe),$e.appendChild(Ee);let we=document.createElement("span");we.style.fontWeight="600",we.style.fontSize="0.95rem",we.style.textTransform="capitalize",we.textContent=Fe==="numeric_state"?"Entity numeric state":Fe==="state"?"Entity state":Fe==="screen"?"Screen":Fe==="user"?"User":Fe==="and"?"And":"Or",$e.appendChild(we),Je.appendChild($e);let ze=document.createElement("button");if(ze.setAttribute("title","Remove condition"),ze.innerHTML='<ha-icon icon="mdi:trash-can-outline"></ha-icon>',Object.assign(ze.style,{border:"none",background:"transparent",cursor:"pointer",padding:"4px",display:"inline-flex",alignItems:"center"}),ze.style.position="relative",ze.style.zIndex="1000",ze.addEventListener("click",ke=>{ke.preventDefault(),ke.stopPropagation();let pe=Le.indexOf(H);pe>-1&&Le.splice(pe,1),de(),ye()}),Je.appendChild(ze),Xe.appendChild(Je),Fe!=="and"&&Fe!=="or"){if(Qe){let ke=document.createElement("div");Object.assign(ke.style,{display:"flex",flexDirection:"column",gap:"14px",alignItems:"stretch"});let pe=(ae,V)=>{let U=document.createElement("div");U.style.display="flex",U.style.flexDirection="column",U.style.gap="4px";let j=document.createElement("span");j.textContent=ae,j.style.fontSize=".75rem",U.appendChild(j),U.appendChild(V),ke.appendChild(U);let me=(V.tagName||"").toLowerCase();(me==="input"||me==="select")&&Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})};if(H.condition==="state"){let ae=document.createElement("ha-entity-picker");ae.value=H.entity||"",ae.hass=this.hass,ae.setAttribute("label","Select entity"),ae.addEventListener("value-changed",j=>{H.entity=j.detail.value||"",de()}),customElements.get("ha-entity-picker")||customElements.whenDefined("ha-entity-picker").then(()=>{ye()}).catch(()=>{}),pe("Entity",ae);let V;if(customElements.get("ha-select")){V=document.createElement("ha-select");let j=document.createElement("mwc-list-item");j.setAttribute("value","state"),j.textContent="State is equal to";let me=document.createElement("mwc-list-item");me.setAttribute("value","state_not"),me.textContent="State is not equal to",V.appendChild(j),V.appendChild(me),V.value=H.state_not!=null?"state_not":"state",V.addEventListener("selected",Ue=>{Ue.stopPropagation();let He=H.state_not!=null?H.state_not:H.state;V.value==="state_not"?(H.state_not=He,delete H.state):(H.state=He,delete H.state_not),de()})}else V=document.createElement("select"),V.innerHTML='<option value="state">State is equal to</option><option value="state_not">State is not equal to</option>',V.value=H.state_not!=null?"state_not":"state",V.addEventListener("change",j=>{j.stopPropagation();let me=H.state_not!=null?H.state_not:H.state;V.value==="state_not"?(H.state_not=me,delete H.state):(H.state=me,delete H.state_not),de()}),Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"});pe("Match type",V);let U;customElements.get("ha-textfield")?(U=document.createElement("ha-textfield"),U.value=(H.state_not!=null?H.state_not:H.state)||"",U.setAttribute("label",""),U.addEventListener("input",j=>{j.stopPropagation();let me=V.value;H[me]=U.value;let Ue=me==="state"?"state_not":"state";delete H[Ue],de()})):(U=document.createElement("input"),U.value=(H.state_not!=null?H.state_not:H.state)||"",Object.assign(U.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),U.addEventListener("input",j=>{j.stopPropagation();let me=V.value;H[me]=U.value;let Ue=me==="state"?"state_not":"state";delete H[Ue],de()})),pe("State",U)}else if(H.condition==="numeric_state"){let ae=document.createElement("ha-entity-picker");ae.value=H.entity||"",ae.hass=this.hass,ae.setAttribute("label","Select entity"),ae.removeAttribute("hide-clear-icon"),ae.addEventListener("value-changed",j=>{H.entity=j.detail.value||"",de()}),customElements.get("ha-entity-picker")||customElements.whenDefined("ha-entity-picker").then(()=>{ye()}).catch(()=>{}),pe("Entity",ae);let V;customElements.get("ha-textfield")?(V=document.createElement("ha-textfield"),V.setAttribute("type","number"),V.value=H.above!=null?H.above:"",V.addEventListener("input",j=>{j.stopPropagation();let me=V.value;me===""||isNaN(Number(me))?delete H.above:H.above=Number(me),de()})):(V=document.createElement("input"),V.type="number",V.value=H.above!=null?H.above:"",Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),V.addEventListener("input",()=>{let j=V.value;j===""||isNaN(Number(j))?delete H.above:H.above=Number(j),de()})),pe("Above",V);let U;customElements.get("ha-textfield")?(U=document.createElement("ha-textfield"),U.setAttribute("type","number"),U.value=H.below!=null?H.below:"",U.addEventListener("input",j=>{j.stopPropagation();let me=U.value;me===""||isNaN(Number(me))?delete H.below:H.below=Number(me),de()})):(U=document.createElement("input"),U.type="number",U.value=H.below!=null?H.below:"",Object.assign(U.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),U.addEventListener("input",()=>{let j=U.value;j===""||isNaN(Number(j))?delete H.below:H.below=Number(j),de()})),pe("Below",U)}else if(H.condition==="screen"){let ae=[{label:"Mobile",query:"(max-width: 599px)"},{label:"Tablet (min: 768px)",query:"(min-width: 768px)"},{label:"Desktop (min: 1024px)",query:"(min-width: 1024px)"},{label:"Wide (min: 1280px)",query:"(min-width: 1280px)"}];Array.isArray(H.media_query_list)||(H.media_query_list=[]);let V=document.createElement("div");V.style.display="flex",V.style.flexDirection="column",V.style.gap="4px",ae.forEach(U=>{let j=document.createElement("label");j.style.display="flex",j.style.alignItems="center",j.style.gap="6px";let me=document.createElement("input");me.type="checkbox",me.checked=H.media_query_list.includes(U.query),me.addEventListener("change",()=>{me.checked?H.media_query_list.push(U.query):H.media_query_list=H.media_query_list.filter(He=>He!==U.query),H.media_query=H.media_query_list.join(","),de()});let Ue=document.createElement("span");Ue.textContent=U.label,j.appendChild(me),j.appendChild(Ue),V.appendChild(j)}),pe("Screen sizes",V)}else if(H.condition==="user"){let ae;if(customElements.get("ha-user-picker"))ae=document.createElement("ha-user-picker"),ae.hass=this.hass,ae.setAttribute("label","Select user"),ae.value=Array.isArray(H.users)?H.users:[],ae.addEventListener("value-changed",V=>{let U=V.detail.value;H.users=Array.isArray(U)?U:[U],de()});else{ae=document.createElement("div"),ae.style.display="flex",ae.style.flexDirection="column",ae.style.gap="4px";let V=document.createElement("span");V.style.opacity="0.7",V.style.fontSize=".85rem",V.textContent="Loading users\u2026",ae.appendChild(V);let U=Array.isArray(H.users)?H.users:[];ce().then(j=>{if(ae.innerHTML="",Array.isArray(j)&&j.length)j.forEach(me=>{let Ue=me.id||me.user_id||me.uid||me.name||"",He=me.name||Ue,ut=document.createElement("label");ut.style.display="flex",ut.style.alignItems="center",ut.style.gap="6px",ut.style.padding="4px 0";let Et=document.createElement("input");Et.type="checkbox",Et.checked=U.includes(Ue)||U.includes(He),Et.addEventListener("change",()=>{let Rt=Array.isArray(H.users)?H.users.slice():[];Et.checked?Rt.includes(Ue)||Rt.push(Ue):Rt=Rt.filter(ni=>ni!==Ue&&ni!==He),H.users=Rt,de()});let Ht=document.createElement("span");Ht.textContent=He,ut.appendChild(Et),ut.appendChild(Ht),ae.appendChild(ut)});else{let me=document.createElement("input");me.value=Array.isArray(H.users)?H.users.join(","):"",Object.assign(me.style,{padding:"6px 10px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--card-background-color, var(--secondary-background-color))",color:"var(--primary-text-color, inherit)"});let Ue=()=>{H.users=me.value.split(",").map(He=>He.trim()).filter(Boolean),de()};me.addEventListener("change",Ue),me.addEventListener("blur",Ue),ae.appendChild(me)}})}pe("Users",ae)}Xe.appendChild(ke)}}else if(Qe){Array.isArray(H.conditions)||(H.conditions=[]);let ke=document.createElement("div");ke.style.marginLeft="16px",J(H.conditions,ke),Xe.appendChild(ke)}Ve.appendChild(Xe)};J(B,Z)};ye()},ot=D=>{if(((D==null?void 0:D.type)||"")==="custom_card"){xt=JSON.stringify(D||{}),k.innerHTML='<div style="opacity:.6;font-size:.9rem;padding:8px">Preview not available for the custom card placeholder. Use the YAML editor.</div>',K.hidden=!0;return}let B=JSON.stringify(D||{});B!==xt&&(xt=B,kt&&clearTimeout(kt),kt=setTimeout(async()=>{let ne=++lt;K.hidden=!1,k.innerHTML="",await Ui();try{let ce=await this._helpersPromise||await window.loadCardHelpers();if(ne!==lt)return;let de=ce.createCardElement(D);if(de.hass=this.hass,ne!==lt)return;k.appendChild(de)}catch{}finally{ne===lt&&(K.hidden=!0)}},150))},W=async D=>{var ce;let B=++lt;E.hidden=!1,z.innerHTML="",await lc();let ne=D.type||Re;if(ct=await this._getEditorElementForType(ne,D),ne==="custom_card"){let de=document.createElement("div");return de.style.opacity=".7",de.style.fontSize=".9rem",de.textContent="Custom card placeholder: use the YAML editor to paste the card type and options.",z.appendChild(de),Ce=null,rt!=="yaml"&&oe("yaml"),ie(!0),E.hidden=!0,!1}if(!ct){let de=document.createElement("div");return de.style.opacity=".7",de.style.fontSize=".9rem",de.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",B===lt&&(z.appendChild(de),E.hidden=!0),Ce=null,ie(!0),rt!=="visual"&&oe("yaml"),!1}try{ct.hass=this.hass,ct.isConnected||z.appendChild(ct),await Promise.resolve();try{ct.setConfig(D)}catch{}try{let ye=await this._helpersPromise||await window.loadCardHelpers(),N=ye.getCardElementClass?await ye.getCardElementClass(D.type||Re):null;if(N!=null&&N.getStubConfig){let J=Object.keys(((ce=this.hass)==null?void 0:ce.states)||{}),Oe=Le=>J.filter(Be=>Be.startsWith(Le+".")),H=await N.getStubConfig(this.hass,J,Oe);H&&(D=this._shapeBySchema(D.type||Re,{...H}))}}catch{}await Promise.resolve();try{ct.setConfig(D)}catch{}Ce&&this.__onEditorChange&&(Ce.removeEventListener("config-changed",this.__onEditorChange),Ce.removeEventListener("value-changed",this.__onEditorChange));let de=async ye=>{var Oe,H,Le;let N=(Le=(Oe=ye.detail)==null?void 0:Oe.config)!=null?Le:(H=ye.detail)==null?void 0:H.value;if(!N)return;let J=N.type||Re;Re=J,re=this._shapeBySchema(J,N),G(""),ie(!0),_t(Re,re),ot(re),Ae==null||Ae.setValue(re)};return this.__onEditorChange=de,ct.addEventListener("config-changed",de),ct.addEventListener("value-changed",de),Ce=ct,rt!=="yaml"&&oe("visual"),ie(!0),!0}finally{B===lt&&(E.hidden=!0)}},ge=async D=>{Ae=await this._mountYamlEditor(I,D,async B=>{var ne,ce;try{let de=(B==null?void 0:B.type)||Re,ye=this._shapeBySchema(de,B||{}),N=de!==Re;if(Re=de,re=ye,C.hidden=!0,C.textContent="",ie(!0),N){if(_t(Re,re),Ce){try{(ne=Ce.setConfig)==null||ne.call(Ce,re)}catch{}rt!=="yaml"&&oe("visual")}try{mt(re)}catch{}}else{try{(ce=Ce==null?void 0:Ce.setConfig)==null||ce.call(Ce,re)}catch{}ot(re);try{mt(re)}catch{}}}catch(de){C.hidden=!1,C.textContent=`Invalid config: ${String((de==null?void 0:de.message)||de)}`,ie(!1)}},B=>{C.hidden=!1,C.textContent=`Invalid YAML: ${String((B==null?void 0:B.message)||B)}`,ie(!1)})},le=async D=>{if(this.__stubCache.has(D))return{...this.__stubCache.get(D)};let B=await this._getStubConfigForType(D);return this.__stubCache.set(D,{...B}),{...B}},ve=async D=>{C.hidden=!0,C.textContent="",G(""),Re=D;try{typeof pt=="function"&&pt(D)}catch{}let B=t==="edit"&&a&&a.type===D?{...a}:await le(D);re=this._shapeBySchema(D,B),Ce=null,_t(D,re),await ge(re),await Ui(),ot(re);try{mt(re)}catch{}try{let ne=await W(re);oe(ne?"visual":"yaml")}catch{oe("yaml")}ie(!0)},X=async()=>{if(!re)return;let D=this._shapeBySchema(Re,re);t==="edit"&&typeof o=="function"?await o(D):(await this._addPickedCardToLayout(D),this._pushRecent((D||{}).type)),l()};m.addEventListener("click",l),_.addEventListener("click",l),f.addEventListener("click",X),v.addEventListener("click",X),c.addEventListener("keydown",D=>{D.key==="Escape"&&l(),D.key==="Enter"&&!f.disabled&&X()});let te=null;g.addEventListener("input",()=>{te&&clearTimeout(te),te=setTimeout(at,120)}),at(),await ve((()=>{var ne;return(((ne=this._getRecent)==null?void 0:ne.call(this))||[]).find(Boolean)||"entities"})()),ie(!0),t==="edit"&&a&&(await ve(a.type||"entities"),ie(!0))}async _getStubConfigForType(t){var m;let a=await this._helpersPromise||await window.loadCardHelpers(),o=null;if(t==="custom_card")return null;try{a.getCardElementClass&&(o=await a.getCardElementClass(t))}catch{}let l=Object.keys(((m=this.hass)==null?void 0:m.states)||{}),c=_=>l.filter(g=>g.startsWith(_+".")),d={type:t};if(o!=null&&o.getStubConfig)try{let _=await o.getStubConfig(this.hass,l,c);if(t!=="entity")return _;_&&typeof _=="object"&&(d={...d,..._})}catch{}let f=l[0],v=c("sensor")[0]||f;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast","map"].includes(t)){let _={sensor:v,gauge:c("sensor").find(this._isNumericEntity.bind(this))||v,"media-control":c("media_player")[0]||f,light:c("light")[0]||f,thermostat:c("climate")[0]||f,"alarm-panel":c("alarm_control_panel")[0]||f,"weather-forecast":c("weather")[0]||f,map:c("device_tracker")[0]||c("person")[0]||f}[t]||v||f;["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity"].includes(t)?d.entity=_:t==="weather-forecast"?(d.entity=_,d.show_current=!0,d.show_forecast=!0,d.forecast_type="daily"):t==="map"&&(d.entities=[_].filter(Boolean),d.theme_mode="auto")}if(["entities","glance","picture-glance","history-graph","statistics-graph"].includes(t)){let _=g=>(g!=null&&g.length?l.filter(k=>g.includes(k.split(".")[0])):l).slice(0,3);t==="statistics-graph"?d.entities=_(["sensor","number","input_number"]):d.entities=_()}if(t==="markdown"&&(d.content="Markdown card"),t==="sensor"&&(d.graph="line"),t==="button"&&(d.show_name=!0,d.show_icon=!0),t==="tile"&&(d.features_position="bottom",d.vertical=!1),t==="picture-glance"&&(d.title=d.title||"Glance",d.image=d.image||"https://demo.home-assistant.io/stub_config/kitchen.png"),t==="picture-entity"&&(d.image=d.image||"https://demo.home-assistant.io/stub_config/bedroom.png"),t==="iframe"&&(d.url=d.url||"https://www.home-assistant.io",d.aspect_ratio=d.aspect_ratio||"50%"),t==="alarm-panel"&&(d.states=d.states||["arm_home","arm_away"]),t==="area")try{let _=this.hass&&this.hass.areas?Object.values(this.hass.areas):[];_.length?d.area=_[0].area_id||_[0].name||_[0].id:d.area=f?f.split(".")[0]:"default_area",d.display_type="picture",d.alert_classes=d.alert_classes||["moisture","motion"],d.sensor_classes=d.sensor_classes||["temperature","humidity"],d.features_position="bottom"}catch{}return d}_getNextAvailablePosition(){let t=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),a=new Set,o=this.gridSize;t.forEach(d=>{let f=parseFloat(d.getAttribute("data-x"))||0,v=parseFloat(d.getAttribute("data-y"))||0,m=parseFloat(getComputedStyle(d).width)||100,_=parseFloat(getComputedStyle(d).height)||100,g=Math.floor(f/o),k=Math.floor(v/o),z=Math.floor((f+m)/o),E=Math.floor((v+_)/o);for(let L=g;L<z;L++)for(let I=k;I<E;I++)a.add(`${L}-${I}`)});let l=0,c=0;for(;a.has(`${l}-${c}`);)l+=6,l>60&&(l=0,c+=6);return{x:l*o,y:c*o}}async _addPickedCardToLayout(t){this._hideEmptyPlaceholder();let a=await this._createCard(t),o=this._makeWrapper(a),l=this._getNextAvailablePosition();this._setCardPosition(o,l.x,l.y),o.style.width=`${14*this.gridSize}px`,o.style.height=`${10*this.gridSize}px`,o.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(o);try{this._rebuildOnce(o.firstElementChild)}catch{}this._initCardInteract(o),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI();try{this._applyVisibility_()}catch{}}_toggleSelection(t,a=null){let o=a==null?!this._selection.has(t):!!a;o?this._selection.add(t):this._selection.delete(t),t.classList.toggle("selected",o)}_clearSelection(){for(let t of this._selection)t.classList.remove("selected");this._selection.clear()}_copySelection(){var t,a,o;try{let l=this._selection?Array.from(this._selection):[];if(!l.length){(t=this._toast)==null||t.call(this,"Nothing selected to copy.");return}let c=1/0,d=1/0,f=[];for(let v of l){if(v.dataset.placeholder)continue;let m=parseFloat(v.getAttribute("data-x"))||0,_=parseFloat(v.getAttribute("data-y"))||0;m<c&&(c=m),_<d&&(d=_)}for(let v of l){if(v.dataset.placeholder)continue;let m=this._extractCardConfig(v.firstElementChild)||{},_=parseFloat(v.getAttribute("data-x"))||0,g=parseFloat(v.getAttribute("data-y"))||0,k=v.style.width||`${v.getBoundingClientRect().width}px`,z=v.style.height||`${v.getBoundingClientRect().height}px`;f.push({cfg:m,dx:_-c,dy:g-d,width:k,height:z})}window.__DDC_CLIPBOARD__={items:f},(a=this._toast)==null||a.call(this,`Copied ${f.length} card${f.length===1?"":"s"}.`)}catch(l){console.warn("[drag-and-drop-card] Copy failed",l),(o=this._toast)==null||o.call(this,"Copy failed.")}}async _pasteClipboard(){var t,a,o,l;try{let c=window.__DDC_CLIPBOARD__;if(!c||!Array.isArray(c.items)||!c.items.length){(t=this._toast)==null||t.call(this,"Clipboard is empty.");return}let d=c.items,f=1,v;do{let g=this.gridSize*f,k=this.gridSize*f;v=d.map(z=>{let E=parseFloat(z.width)||0,L=parseFloat(z.height)||0;return{x:g+(z.dx||0),y:k+(z.dy||0),w:E,h:L}}),f+=1}while(this._anyCollisionFor(v,new Set));let m=this.gridSize*(f-1),_=this.gridSize*(f-1);for(let g of d){let k=g.cfg||{},z=await this._createCard(k),E=this._makeWrapper(z);E.style.width=g.width,E.style.height=g.height;let L=m+(g.dx||0),I=_+(g.dy||0);this._setCardPosition(E,L,I),E.style.zIndex=String(this._highestZ()+1);try{let C=this._normalizeTabId(this.activeTab||this.defaultTab);C&&(E.dataset.tabId=C)}catch{}this.cardContainer.appendChild(E);try{this._rebuildOnce(E.firstElementChild)}catch{}this._initCardInteract(E)}this._resizeContainer(),this._applyActiveTab(),(a=this._queueSave)==null||a.call(this,"paste"),(o=this._toast)==null||o.call(this,`Pasted ${d.length} card${d.length===1?"":"s"}.`)}catch(c){console.warn("[drag-and-drop-card] Paste failed",c),(l=this._toast)==null||l.call(this,"Paste failed.")}}_installSelectionMarquee(){let t=this.cardContainer,a=0,o=0,l=null,c=!1,d=g=>{let k=t.getBoundingClientRect(),z="touches"in g&&g.touches[0]?g.touches[0].clientX:g.clientX,E="touches"in g&&g.touches[0]?g.touches[0].clientY:g.clientY;return{x:z-k.left,y:E-k.top}},f=(g,k)=>{let z=Math.min(g,a),E=Math.max(g,a),L=Math.min(k,o),I=Math.max(k,o);l.style.left=`${z}px`,l.style.top=`${L}px`,l.style.width=`${E-z}px`,l.style.height=`${I-L}px`;let C=l.getBoundingClientRect(),A=t.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),A.forEach(O=>{let b=O.getBoundingClientRect();!(b.right<C.left||b.left>C.right||b.bottom<C.top||b.top>C.bottom)&&this._toggleSelection(O,!0)})},v=g=>{if(!this.editMode||g.target.closest(".card-wrapper"))return;c=!0;let k=d(g);a=k.x,o=k.y,l=document.createElement("div"),l.className="marquee",l.style.left=`${a}px`,l.style.top=`${o}px`,t.appendChild(l),g.preventDefault()},m=g=>{!c||!l||f(d(g).x,d(g).y)},_=()=>{c&&(c=!1,l&&l.remove(),l=null)};t.addEventListener("mousedown",v),window.addEventListener("mousemove",m),window.addEventListener("mouseup",_),t.addEventListener("touchstart",g=>{this.editMode&&(g.target.closest(".card-wrapper")||v(g))},{passive:!1}),window.addEventListener("touchmove",g=>{m(g)},{passive:!1}),window.addEventListener("touchend",_),window.addEventListener("touchcancel",_)}async _openDiagnostics(){var f,v;let t=document.createElement("div");t.className="modal";let a=this.storageKey||"(none)",o=this._backendOK&&!!this.storageKey,l=m=>m.slice(-200).map(_=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${_.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${_.kind}]</b>
        <span style="margin-left:6px">${this._safe(_.msg)}</span>
        ${_.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(_.extra,null,2))}</pre>`:""}
      </div>`).join("");t.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95%);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((f=this._config)==null?void 0:f.storage_key)||"")}</code> \u2192 <code>${this._safe(a)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${o?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((v=this.cardContainer)==null?void 0:v.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${l(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let c=()=>t.remove();t.querySelector("#closeDiag").addEventListener("click",c),this.shadowRoot.appendChild(t);let d=()=>{let m=t.querySelector("#logArea"),_=g=>g.slice(-200).map(k=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${k.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${k.kind}]</b>
          <span style="margin-left:6px">${this._safe(k.msg)}</span>
          ${k.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(k.extra,null,2))}</pre>`:""}
        </div>`).join("");m.innerHTML=_(this._dbgDump()),m.scrollTop=m.scrollHeight};t.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{d()}}),t.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),d()}),t.querySelector("#exportJson").addEventListener("click",()=>{let _=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(E=>{let L=parseFloat(E.getAttribute("data-x"))||0,I=parseFloat(E.getAttribute("data-y"))||0,C=parseFloat(E.style.width)||E.getBoundingClientRect().width,A=parseFloat(E.style.height)||E.getBoundingClientRect().height,O=parseInt(E.style.zIndex||"1",10),b=this._extractCardConfig(E.firstElementChild),M=E.dataset.tabId||this.defaultTab;return{card:b,position:{x:L,y:I},size:{width:C,height:A},z:O,tabId:M}}),g={version:2,options:this._exportableOptions(),cards:_},k=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),z=document.createElement("a");z.href=URL.createObjectURL(k),z.download=`ddc_${this.storageKey||"layout"}.json`,z.click(),URL.revokeObjectURL(z.href)}),t.querySelector("#importJson").addEventListener("click",async()=>{let m=document.createElement("input");m.type="file",m.accept="application/json",m.onchange=async()=>{var z,E,L,I,C,A,O,b,M,R,Z,F,K;let _=(z=m.files)==null?void 0:z[0];if(!_)return;let g=await _.text();try{let ie=JSON.parse(g);if(this._dbgPush("import","Loaded file",{bytes:g.length}),this.cardContainer.innerHTML="",(E=ie.cards)!=null&&E.length)for(let G of ie.cards)if(!(G!=null&&G.card)||typeof G.card=="object"&&Object.keys(G.card).length===0){let ee=this._makePlaceholderAt(((L=G.position)==null?void 0:L.x)||0,((I=G.position)==null?void 0:I.y)||0,((C=G.size)==null?void 0:C.width)||200,((A=G.size)==null?void 0:A.height)||200);this.cardContainer.appendChild(ee)}else{let ee=await this._createCard(G.card),_e=this._makeWrapper(ee);this._setCardPosition(_e,((O=G.position)==null?void 0:O.x)||0,((b=G.position)==null?void 0:b.y)||0),_e.dataset.tabId=this._normalizeTabId(G.tabId||G.tab_id||this.defaultTab),this._setCardPosition(_e,((M=G.position)==null?void 0:M.x)||0,((R=G.position)==null?void 0:R.y)||0),_e.style.width=`${((Z=G.size)==null?void 0:Z.width)||140}px`,_e.style.height=`${((F=G.size)==null?void 0:F.height)||100}px`,this.cardContainer.appendChild(_e);try{this._rebuildOnce(_e.firstElementChild)}catch{}this._initCardInteract(_e)}else this._showEmptyPlaceholder(),(K=this._applyAutoScale)==null||K.call(this);this._resizeContainer(),await this._saveLayout(!1)}catch(ie){this._dbgPush("import","Parse failed",{error:String(ie)})}let k=new Event("ddc-logrefresh");window.dispatchEvent(k)},m.click()}),t.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),d();let m=(this.storageKey||"ddc_test")+"_selftest",_={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(m,_);let g=await this._loadLayoutFromBackend(m);this._dbgPush("test","Round-trip result",{wrote:_,read:g})}catch(g){this._dbgPush("test","Round-trip failed",{error:String(g)})}d()}),d()}_openDashboardSettings(){var Re,Ae,Ce,ct,lt,kt,xt,_t,Ke,Dt,mt,ot;let t=document.createElement("div");t.className="modal",this._ensureSettingsStyles_(),t.innerHTML=`
  <div class="dialog modern" role="dialog" aria-modal="true">
    <div class="dlg-head">
      <h3>Dashboard Settings</h3>
      <button class="icon-btn" id="ddc-settings-close" title="Close"><ha-icon icon="mdi:close"></ha-icon></button>
    </div>

    <div class="settings-body">

      <!-- Layout -->
      <section class="card">
        <div class="section-head">
          <ha-icon icon="mdi:view-grid-plus-outline"></ha-icon>
          <h4>Layout</h4>
        </div>
        <p class="caption">Control grid density, canvas sizing, and card behavior.</p>

        <!-- GRID SIZE -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:grid"></ha-icon>
              <label for="ddc-setting-gridSize">Grid size</label>
            </div>
            <div class="control">
              <div class="range-wrap">
                <input type="range" id="ddc-setting-gridSize" min="1" max="400" step="1" />
                <output id="ddc-grid-out">100 px</output>
              </div>
            </div>
          </div>
          <div class="hint">Cards snap every <b>N</b> pixels. Lower values give a denser grid for finer placement.</div>
        </div>

      <div class="preview" style="margin-top:6px">
        <div class="grid-demo" id="ddc-grid-demo">
          <div class="grid-meta-badge" id="ddc-grid-meta"></div>
        </div>
      </div>


        <!-- QUICK CANVAS SIZES -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:move-resize"></ha-icon>
              <span>Quick canvas sizes</span>
            </div>
            <div class="control chips" role="group" aria-label="Quick sizes">
              <button class="chip" data-w="1280" data-h="720">Tablet (1280\xD7720)</button>
              <button class="chip" data-w="1920" data-h="1080" aria-pressed="true">Desktop (1920\xD71080)</button>
              <button class="chip" data-w="2560" data-h="1440">WQHD (2560\xD71440)</button>
            </div>
          </div>
          <div class="hint">Applies a fixed custom canvas size instantly. Switch back to Dynamic or Preset below if needed.</div>
        </div>

        <!-- AUTO RESIZE -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:resize"></ha-icon>
              <label for="ddc-setting-autoResize">Auto resize cards</label>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-autoResize"></ha-switch>
            </div>
          </div>
          <div class="hint">Scale the layout with the viewport. Off = fixed canvas size.</div>
        </div>

        <!-- LIVE SNAP -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:drag-variant"></ha-icon>
              <label for="ddc-setting-dragSnap">Live snap while dragging</label>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-dragSnap"></ha-switch>
            </div>
          </div>
          <div class="hint">While dragging, cards snap to the nearest grid lines in real time.</div>
        </div>

        <!-- OVERLAP -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:animation"></ha-icon>
              <label for="ddc-setting-disableOverlap">Prevent overlap</label>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-disableOverlap"></ha-switch>
            </div>
          </div>
          <div class="hint">Blocks placements that would overlap another card.</div>
        </div>

        <div class="divider"></div>

        <!-- SIZE MODE -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:move-resize"></ha-icon>
              <label for="ddc-setting-sizeMode">Container size mode</label>
            </div>
            <div class="control">
              <select id="ddc-setting-sizeMode">
                <option value="dynamic">Dynamic</option>
                <option value="preset">Preset</option>
                <option value="fixed_custom">Fixed (custom)</option>
              </select>
            </div>
          </div>
          <div class="hint">Dynamic fits the available space. Preset uses common screen sizes. Fixed lets you specify width & height.</div>
        </div>

        <!-- SIZE EXTRAS (injected) -->
        <div id="ddc-setting-sizeExtras"></div>

        <!-- ORIENTATION -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:phone-rotate-landscape"></ha-icon>
              <label for="ddc-setting-orient">Orientation</label>
            </div>
            <div class="control">
              <select id="ddc-setting-orient">
                <option value="auto">Auto</option>
                <option value="landscape">Landscape</option>
                <option value="portrait">Portrait</option>
              </select>
            </div>
          </div>
          <div class="hint">For presets and fixed sizes, choose a preferred orientation. Auto adapts to the screen.</div>
        </div>

        <div class="divider"></div>

        <!-- AUTOSAVE -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:content-save"></ha-icon>
              <label for="ddc-setting-autoSave">Auto save</label>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-autoSave"></ha-switch>
            </div>
          </div>
          <div class="hint">Automatically persist layout changes after you drag or edit.</div>
        </div>

        <!-- AUTOSAVE DELAY -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:timer-outline"></ha-icon>
              <label for="ddc-setting-autoSaveDebounce">Auto save delay (ms)</label>
            </div>
            <div class="control">
              <input type="number" id="ddc-setting-autoSaveDebounce" min="100" max="10000" step="50" />
            </div>
          </div>
          <div class="hint">Wait time after the last change before saving. Lower = more frequent saves.</div>
        </div>
      </section>

      <!-- Appearance -->
      <section class="card">
        <div class="section-head">
          <ha-icon icon="mdi:palette-swatch"></ha-icon>
          <h4>Appearance</h4>
        </div>
        <p class="caption">Choose backgrounds and colors. Use theme vars like <code>var(--ha-card-background)</code>.</p>

        <!-- CONTAINER BG -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:palette-swatch"></ha-icon>
              <label for="ddc-setting-containerBg">Container background</label>
            </div>
            <div class="control" style="flex:1">
              <div class="color-pair" style="margin-bottom:8px">
                <input type="color" id="ddc-color-containerBg" />
                <input type="text" id="ddc-setting-containerBg" placeholder="transparent \xB7 #123456 \xB7 var(--ha-card-background)" />
              </div>
            </div>
          </div>
          <div class="swatches" id="ddc-swatches-containerBg"></div>
          <div class="gradients" id="ddc-gradients-containerBg" style="margin-top:6px"></div>
          <div class="hint">Accepts plain colors or theme variables.</div>
        </div>

        <!-- CARD BG -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:palette-swatch"></ha-icon>
              <label for="ddc-setting-cardBg">Card background</label>
            </div>
            <div class="control" style="flex:1">
              <div class="color-pair" style="margin-bottom:8px">
                <input type="color" id="ddc-color-cardBg" />
                <input type="text" id="ddc-setting-cardBg" placeholder="#121212 \xB7 var(--ha-card-background)" />
              </div>
            </div>
          </div>
          <div class="swatches" id="ddc-swatches-cardBg"></div>
          <div class="gradients" id="ddc-gradients-cardBg" style="margin-top:6px"></div>
          <div class="hint">Affects the background of each draggable card container.</div>
        </div>

        <div class="divider"></div>

      <!-- BACKGROUND IMAGE -->
      <div class="setting">
        <div class="row">
          <div class="title">
            <ha-icon icon="mdi:image-outline"></ha-icon>
            <label for="ddc-setting-bgImg">Background image</label>
          </div>
          <div class="control" style="flex:1; flex-direction:column; align-items:flex-start">
            <div class="input-file">
              <label class="file-btn" for="ddc-file-bg">Upload image</label>
              <input id="ddc-file-bg" type="file" accept="image/*" />
              <div class="thumb" id="ddc-bg-thumb"></div>
              <button type="button" class="btn secondary" id="ddc-clear-bg">Delete</button>
            </div>

            <div class="row" style="margin-top:8px; width:100%">
              <label style="flex:0 0 auto" for="ddc-setting-bgImg">or URL</label>
              <input type="text" id="ddc-setting-bgImg" placeholder="https://\u2026 or /local/\u2026" style="flex:1"/>
            </div>

            <!-- NEW: options -->
            <div class="bg-opts" style="width:100%">
              <label for="ddc-bg-repeat"><ha-icon icon="mdi:repeat"></ha-icon> Repeat</label>
              <select id="ddc-bg-repeat">
                <option value="no-repeat">No repeat</option>
                <option value="repeat">Repeat</option>
                <option value="repeat-x">Repeat X</option>
                <option value="repeat-y">Repeat Y</option>
              </select>

              <label for="ddc-bg-size"><ha-icon icon="mdi:arrow-expand-all"></ha-icon> Size</label>
              <select id="ddc-bg-size">
                <option value="cover">Cover</option>
                <option value="contain">Contain</option>
                <option value="auto">Auto</option>
                <option value="100% 100%">Fill (stretch)</option>
              </select>

              <label for="ddc-bg-position"><ha-icon icon="mdi:crosshairs-gps"></ha-icon> Position</label>
              <select id="ddc-bg-position">
                <option value="center center">Center</option>
                <option value="top center">Top</option>
                <option value="bottom center">Bottom</option>
                <option value="left center">Left</option>
                <option value="right center">Right</option>
                <option value="top left">Top left</option>
                <option value="top right">Top right</option>
                <option value="bottom left">Bottom left</option>
                <option value="bottom right">Bottom right</option>
              </select>

              <label for="ddc-bg-attachment"><ha-icon icon="mdi:pin"></ha-icon> Attachment</label>
              <select id="ddc-bg-attachment">
                <option value="scroll">Scroll</option>
                <option value="fixed">Fixed</option>
              </select>

              <label for="ddc-bg-opacity"><ha-icon icon="mdi:opacity"></ha-icon> Opacity</label>
              <div style="display:flex; align-items:center; gap:10px">
                <input type="range" id="ddc-bg-opacity" min="0" max="100" step="1" style="width:220px" />
                <output id="ddc-bg-opacity-out">100%</output>
              </div>
            </div>
          </div>
        </div>
        <div class="hint">Uploads are saved inline as data-URLs. For large files, host under <code>/local/</code> and paste the URL.</div>
      </div>
      </section>

      <!-- Behaviour -->
      <section class="card">
        <div class="section-head">
          <ha-icon icon="mdi:tune"></ha-icon>
          <h4>Behaviour</h4>
        </div>
        <p class="caption">Animation, logging, and Home Assistant chrome visibility.</p>

        <!-- ANIMATE -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:play-box"></ha-icon>
              <label for="ddc-setting-animate">Animate cards</label>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-animate"></ha-switch>
            </div>
          </div>
          <div class="hint">Smooth transitions when moving and resizing cards.</div>
        </div>

        <!-- DEBUG -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:bug-play-outline"></ha-icon>
              <label for="ddc-setting-debug">Enable debug logging</label>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-debug"></ha-switch>
            </div>
          </div>
          <div class="hint">Extra console logs for troubleshooting layout issues.</div>
        </div>

        <!-- HIDE HEADER -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:page-layout-header"></ha-icon>
              <label for="ddc-setting-hideHdr">Hide HA Header</label>
              <ha-icon class="suffix" icon="mdi:thumbs-up-down" title="Preference"></ha-icon>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-hideHdr"></ha-switch>
            </div>
          </div>
          <div class="hint">Removes the top app bar (Search / Assist / Edit). It auto-shows in Edit mode.</div>
        </div>

        <!-- HIDE SIDEBAR -->
        <div class="setting">
          <div class="row">
            <div class="title">
              <ha-icon icon="mdi:page-layout-sidebar-left"></ha-icon>
              <label for="ddc-setting-hideSbar">Hide HA Sidebar</label>
              <ha-icon class="suffix" icon="mdi:thumbs-up-down" title="Preference"></ha-icon>
            </div>
            <div class="control">
              <ha-switch id="ddc-setting-hideSbar"></ha-switch>
            </div>
          </div>
          <div class="hint">Hides the left navigation drawer to maximize canvas space.</div>
        </div>
      </section>


      <!-- Tabs -->
    <section class="card tabs-card">
      <div class="section-head">
        <ha-icon icon="mdi:tab"></ha-icon>
        <h4>Tabs</h4>
      </div>
      <p class="caption">Create, rename, delete, and choose the default tab. Cards use <code>tabId</code> to decide where they appear.</p>

      <!-- Current tabs list -->
      <div id="ddc-tabs-list"></div>

      <!-- Add new tab -->
      <div class="setting" style="margin-top:8px">
        <div class="row">
          <div class="title">
            <ha-icon icon="mdi:tab-plus"></ha-icon>
            <label for="ddc-new-tab-name">Add tab</label>
          </div>
          <div class="control" style="flex:1">
            <input type="text" id="ddc-new-tab-name" placeholder="e.g. Lights" />
            <button class="btn primary" id="ddc-add-tab-btn">Add</button>
          </div>
        </div>
        <div class="hint">Tab IDs must be unique. The label defaults to the ID if left empty.</div>
      </div>
    </section>

    </div>

    <div class="footer">
      <button class="btn secondary" id="ddc-settings-cancel">Cancel</button>
      <button class="btn primary" id="ddc-settings-save">Save</button>
    </div>
  </div>
`;let a=this.shadowRoot.querySelector(".modal");if(a){try{a.remove()}catch{}this.__settingsModal===a&&(this.__settingsModal=null)}if(this.__settingsModal){try{this.__settingsModal.remove()}catch{}this.__settingsModal=null}this.__settingsModal=t,this.shadowRoot.appendChild(t);let o=t.querySelector("#ddc-setting-autoResize"),l=t.querySelector("#ddc-setting-gridSize"),c=t.querySelector("#ddc-setting-animate"),d=t.querySelector("#ddc-setting-hideHdr"),f=t.querySelector("#ddc-setting-hideSbar"),v=t.querySelector("#ddc-setting-dragSnap"),m=t.querySelector("#ddc-setting-autoSave"),_=t.querySelector("#ddc-setting-autoSaveDebounce"),g=t.querySelector("#ddc-setting-sizeMode"),k=t.querySelector("#ddc-setting-orient"),z=t.querySelector("#ddc-setting-disableOverlap"),E=t.querySelector("#ddc-setting-containerBg"),L=t.querySelector("#ddc-setting-cardBg"),I=t.querySelector("#ddc-setting-bgImg"),C=t.querySelector("#ddc-bg-repeat"),A=t.querySelector("#ddc-bg-size"),O=t.querySelector("#ddc-bg-position"),b=t.querySelector("#ddc-bg-attachment"),M=t.querySelector("#ddc-bg-opacity"),R=t.querySelector("#ddc-bg-opacity-out"),Z=t.querySelector("#ddc-setting-debug"),F=((Re=this._config)==null?void 0:Re.background_image)||{};if(o&&(o.checked=!!this.autoResizeCards),l&&(l.value=String(this.gridSize||100)),c&&(c.checked=!!this.animateCards),d&&(d.checked=!!this.hideHaHeader),f&&(f.checked=!!this.hideHaSidebar),v&&(v.checked=!!this.dragLiveSnap),m&&(m.checked=!!this.autoSave),_&&(_.value=String((Ae=this.autoSaveDebounce)!=null?Ae:800)),g&&(g.value=String(this.containerSizeMode||"dynamic")),k&&(k.value=String(this.containerPresetOrient||"auto")),z&&(z.checked=!!this.disableOverlap),E&&(E.value=String(this.containerBackground||"")),L&&(L.value=String(this.cardBackground||"")),I){let W=((lt=(Ce=this._config)==null?void 0:Ce.background_image)!=null?lt:(ct=this._config)==null?void 0:ct.bg_image)||{};I.value=W.src?String(W.src):""}if(Z&&(Z.checked=!!this.debug),C&&(C.value=String(F.repeat||"no-repeat")),A&&(A.value=String(F.size||"cover")),O&&(O.value=String(F.position||"center center")),b&&(b.value=String(F.attachment||"scroll")),M){let W=Math.round((F.opacity!=null?F.opacity:1)*100);M.value=String(W),R&&(R.textContent=`${W}%`),M.addEventListener("input",()=>{let ge=Math.max(0,Math.min(100,parseInt(M.value||"100",10)));R.textContent=`${ge}%`,this.style.setProperty("--ddc-bg-opacity",String(ge/100))})}let K=t.querySelector("#ddc-setting-gridSize"),ie=t.querySelector("#ddc-grid-out"),G=t.querySelector("#ddc-grid-demo"),ee=t.querySelector("#ddc-grid-meta"),_e=()=>{if(!G||!ee)return;let W=G.getBoundingClientRect(),ge=Math.max(1,parseInt(K.value||"100",10)),le=Math.max(1,Math.floor(W.width/ge)),ve=Math.max(1,Math.floor(W.height/ge));ee.innerHTML=`
        <ha-icon icon="mdi:grid"></ha-icon>
        <span>${ge}px \xB7 ${le}\xD7${ve}</span>
      `},Te=()=>{let W=Math.max(1,parseInt(K.value||"100",10));ie&&(ie.textContent=`${W} px`),G&&G.style.setProperty("--g",`${W}px`),_e()};if(K&&(K.value||(K.value=String(this.gridSize||100)),K.addEventListener("input",Te),Te()),G){let W=new ResizeObserver(()=>_e());W.observe(G),(xt=(kt=this.__ddcGridRO)==null?void 0:kt.disconnect)==null||xt.call(kt),this.__ddcGridRO=W}t.querySelectorAll(".chip").forEach(W=>{W.addEventListener("click",()=>{var X,te;t.querySelectorAll(".chip").forEach(se=>se.setAttribute("aria-pressed","false")),W.setAttribute("aria-pressed","true");let ge=parseInt(W.dataset.w,10),le=parseInt(W.dataset.h,10),ve=t.querySelector("#ddc-setting-sizeMode");ve.value="fixed_custom",(te=(X=typeof g!="undefined"&&g)==null?void 0:X.dispatchEvent)==null||te.call(X,new Event("change")),setTimeout(()=>{var B,ne,ce;(B=t.querySelector("#ddc-setting-custW"))==null||B.setAttribute("value",String(ge)),(ce=(ne=t.querySelector("#ddc-setting-custW"))==null?void 0:ne.dispatchEvent)==null||ce.call(ne,new Event("change"));let se=t.querySelector("#ddc-setting-custW");se&&(se.value=String(ge));let D=t.querySelector("#ddc-setting-custH");D&&(D.value=String(le))},0)})});let et=["#ffffff","#f5f7fa","#ebeff5","#121212","#1f2937","#334155","var(--card-background-color)","var(--ha-card-background)","transparent"],Ye=(W,ge,le)=>{let ve=t.querySelector(W),X=t.querySelector(ge),te=t.querySelector(le);!ve||!X||(ve.innerHTML="",et.forEach((se,D)=>{let B=document.createElement("button");B.type="button",B.className="swatch",B.title=se,B.style.background=se.startsWith("var(")?getComputedStyle(this).getPropertyValue(se.slice(4,-1)).trim()||"#fff":se,B.setAttribute("aria-pressed","false"),B.addEventListener("click",()=>{ve.querySelectorAll(".swatch").forEach(ne=>ne.setAttribute("aria-pressed","false")),B.setAttribute("aria-pressed","true"),X.value=se,/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(se)&&te&&(te.value=se)}),ve.appendChild(B),String(X.value).trim()===se&&B.setAttribute("aria-pressed","true")}))};Ye("#ddc-swatches-containerBg","#ddc-setting-containerBg","#ddc-color-containerBg"),Ye("#ddc-swatches-cardBg","#ddc-setting-cardBg","#ddc-color-cardBg"),[["#ddc-color-containerBg","#ddc-setting-containerBg"],["#ddc-color-cardBg","#ddc-setting-cardBg"]].forEach(([W,ge])=>{let le=t.querySelector(W),ve=t.querySelector(ge);if(!le||!ve)return;let X=(String(ve.value||"").match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)||[])[0];X&&(le.value=X),le.addEventListener("input",()=>{ve.value=le.value}),ve.addEventListener("change",()=>{let te=(String(ve.value||"").match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)||[])[0];te&&(le.value=te)})});let je=t.querySelector("#ddc-file-bg"),Ne=t.querySelector("#ddc-setting-bgImg"),Me=t.querySelector("#ddc-bg-thumb"),nt=W=>{Me&&(Me.style.backgroundImage=W?`url(${W})`:"none")};Ne!=null&&Ne.value&&nt(Ne.value),je==null||je.addEventListener("change",async()=>{var le;let W=(le=je.files)==null?void 0:le[0];if(!W)return;let ge=new FileReader;ge.onload=()=>{Ne.value=String(ge.result||""),nt(Ne.value),this.style.setProperty("--ddc-bg-image",`url("${Ne.value}")`)},ge.readAsDataURL(W)}),(_t=t.querySelector("#ddc-clear-bg"))==null||_t.addEventListener("click",()=>{var le,ve;Ne&&(Ne.value=""),nt("");let{background_image:W,...ge}=this._config||{};this._config=ge,this.style.setProperty("--ddc-bg-image","none"),(le=this._applyBackgroundImageFromConfig_)==null||le.call(this),(ve=this._persistThisCardConfigToStorage_)==null||ve.call(this)}),t.addEventListener("click",W=>{W.target===t&&(W.stopPropagation(),re())});let tt=W=>{W.key==="Escape"&&(W.stopPropagation(),re())};document.addEventListener("keydown",tt,{once:!0}),setTimeout(()=>{var W;return(W=t.querySelector("#ddc-setting-gridSize"))==null?void 0:W.focus()},0);try{let W=t.querySelector("#ddc-setting-sizeExtras"),ge=()=>{var ve,X;if(!W)return;W.innerHTML="";let le=(g==null?void 0:g.value)||"dynamic";if(le==="fixed_custom"){let te=document.createElement("label");te.style.display="flex",te.style.flexDirection="column",te.style.fontSize=".95rem",te.style.marginBottom="10px";let se=document.createElement("span");se.textContent="Custom width (px)",se.style.marginBottom="4px";let D=document.createElement("input");D.type="number",D.id="ddc-setting-custW",D.min="100",D.max="10000",D.step="10",D.style.padding="6px",D.style.border="1px solid var(--divider-color,rgba(0,0,0,.3))",D.style.borderRadius="6px",D.value=String((ve=this.containerFixedWidth)!=null?ve:800),te.appendChild(se),te.appendChild(D);let B=document.createElement("label");B.style.display="flex",B.style.flexDirection="column",B.style.fontSize=".95rem",B.style.marginBottom="10px";let ne=document.createElement("span");ne.textContent="Custom height (px)",ne.style.marginBottom="4px";let ce=document.createElement("input");ce.type="number",ce.id="ddc-setting-custH",ce.min="100",ce.max="10000",ce.step="10",ce.style.padding="6px",ce.style.border="1px solid var(--divider-color,rgba(0,0,0,.3))",ce.style.borderRadius="6px",ce.value=String((X=this.containerFixedHeight)!=null?X:600),B.appendChild(ne),B.appendChild(ce),W.appendChild(te),W.appendChild(B)}else if(le==="preset"){let te=document.createElement("label");te.style.display="flex",te.style.flexDirection="column",te.style.fontSize=".95rem",te.style.marginBottom="10px";let se=document.createElement("span");se.textContent="Preset size",se.style.marginBottom="4px";let D=document.createElement("select");D.id="ddc-setting-preset",D.style.padding="6px",D.style.border="1px solid var(--divider-color,rgba(0,0,0,.3))",D.style.borderRadius="6px",(typeof e!="undefined"&&e._sizePresets?e._sizePresets():[]).forEach(ne=>{let ce=document.createElement("option");ce.value=ne.key,ce.textContent=`${ne.label||ne.key} (${ne.w}\xD7${ne.h})`,D.appendChild(ce)}),D.value=String(this.containerPreset||"fhd"),te.appendChild(se),te.appendChild(D),W.appendChild(te)}};ge(),g==null||g.addEventListener("change",ge)}catch(W){console.warn("[drag-and-drop-card] Failed to build container size extras",W)}let Ge=()=>{var ge,le,ve,X,te;return((te=(X=(le=(ge=this._config)==null?void 0:ge.options)==null?void 0:le.tabs)!=null?X:(ve=this._config)==null?void 0:ve.tabs)!=null?te:[]).map(se=>{var D,B,ne,ce,de,ye,N;return typeof se=="string"?{id:se,label:se,icon:"",label_mode:"both",__raw:{id:se,label:se}}:{id:(ne=(B=(D=se.id)!=null?D:se.key)!=null?B:se.label)!=null?ne:"tab",label:(de=(ce=se.label)!=null?ce:se.id)!=null?de:"Tab",icon:(ye=se.icon)!=null?ye:"",label_mode:(N=se.label_mode)!=null?N:"both",__raw:se}})},it=async(W,ge)=>{var ve,X,te;let le=W.map(se=>({...se.__raw,id:se.id,label:se.label,icon:se.icon||"",label_mode:se.label_mode||"both"}));(ve=this._config)!=null&&ve.options?this._config.options={...this._config.options||{},tabs:le,default_tab:ge!=null?ge:(X=this._config.options)==null?void 0:X.default_tab}:(this._config.tabs=le,ge&&(this._config.default_tab=ge));try{await this._persistThisCardConfigToStorage_()}catch(se){console.warn("[drag-and-drop-card] Could not persist tabs",se)}(te=this.requestUpdate)==null||te.call(this)},pt=()=>{var W,ge,le,ve;return((ge=(W=this._config)==null?void 0:W.options)==null?void 0:ge.default_tab)||((le=this._config)==null?void 0:le.default_tab)||((ve=Ge()[0])==null?void 0:ve.id)},rt=t.querySelector("#ddc-tabs-list"),oe=()=>{let W=Ge(),ge=pt();if(rt.innerHTML="",!W.length){let le=document.createElement("div");le.className="hint",le.textContent="No tabs yet. Add one below.",rt.appendChild(le);return}W.forEach((le,ve)=>{let X=document.createElement("div");X.className="tab-row";let te=document.createElement("input");te.type="radio",te.name="ddc-default-tab",te.value=le.id,te.checked=le.id===ge,te.title="Set as default tab",te.addEventListener("change",async()=>{await it(W,le.id)});let se=document.createElement("div");se.className="tab-name";let D=document.createElement("ha-icon");D.setAttribute("icon",le.icon||"mdi:tab");let B=document.createElement("input");B.value=le.icon||"",B.placeholder="mdi:home",B.title="Tab icon (mdi:...)",B.style.width="160px",B.addEventListener("change",async()=>{le.icon=B.value.trim(),D.setAttribute("icon",le.icon||"mdi:tab"),W[ve]=le,await it(W,ge)});let ne=document.createElement("input");ne.value=le.label,ne.placeholder="Tab name",ne.style.flex="1",ne.addEventListener("change",async()=>{le.label=ne.value.trim()||le.id,W[ve]=le,await it(W,ge)});let ce=document.createElement("div");ce.className="tab-icon-wrap",ce.appendChild(D),ce.appendChild(B),se.appendChild(ce),se.appendChild(ne);let de=document.createElement("div");de.className="mode-chips";let ye=(Oe,H)=>{let Le=document.createElement("button");return Le.type="button",Le.className="chip",Le.textContent=H,Le.setAttribute("aria-pressed",String((le.label_mode||"both")===Oe)),Le.addEventListener("click",async()=>{de.querySelectorAll(".chip").forEach(Be=>Be.setAttribute("aria-pressed","false")),Le.setAttribute("aria-pressed","true"),le.label_mode=Oe,W[ve]=le,await it(W,ge)}),Le};de.appendChild(ye("icon","Icon")),de.appendChild(ye("text","Text")),de.appendChild(ye("both","Both"));let N=document.createElement("div");N.className="tab-actions";let J=document.createElement("button");J.className="icon-btn danger",J.innerHTML='<ha-icon icon="mdi:trash-can-outline"></ha-icon>',J.title="Delete tab",J.addEventListener("click",async()=>{var Le,Be;let Oe=Ge().filter(Ve=>Ve.id!==le.id),H=ge;le.id===ge&&(H=(Le=Oe[0])==null?void 0:Le.id),await it(Oe,H);try{(Be=this._reassignCardsToTab_)==null||Be.call(this,le.id,H)}catch{}oe()}),N.appendChild(de),N.appendChild(J),X.appendChild(te),X.appendChild(se),X.appendChild(N),rt.appendChild(X)})};oe(),(Ke=t.querySelector("#ddc-add-tab-btn"))==null||Ke.addEventListener("click",async()=>{let W=t.querySelector("#ddc-new-tab-name"),ge=((W==null?void 0:W.value)||"").trim();if(!ge)return;let le=Ge(),ve=ge.replace(/\s+/g,"-").toLowerCase(),X=2;for(;le.some(te=>te.id===ve);)ve=`${ve}-${X++}`;le.push({id:ve,label:ge,icon:"",label_mode:"both",__raw:{id:ve,label:ge}}),await it(le,pt()),W.value="",oe()});let ft=t.querySelector("#ddc-clear-bg");ft&&ft.addEventListener("click",()=>{var le,ve,X;let W=t.querySelector("#ddc-setting-bgImg"),ge=t.querySelector("#ddc-bg-thumb");W&&(W.value=""),ge&&(ge.style.backgroundImage="none");try{if((le=this._config)!=null&&le.background_image){let{background_image:te,...se}=this._config;this._config=se}(ve=this._applyBackgroundImageFromConfig)==null||ve.call(this),(X=this._persistThisCardConfigToStorage_)==null||X.call(this)}catch(te){console.warn("[drag-and-drop-card] Failed to clear background image",te)}});let at=["linear-gradient(135deg, #1e3a8a, #0ea5e9)","linear-gradient(135deg, #111827, #1f2937)","linear-gradient(135deg, #0f766e, #22c55e)","linear-gradient(135deg, #7c3aed, #06b6d4)","linear-gradient(135deg, #f97316, #f43f5e)","linear-gradient(135deg, #eab308, #22d3ee)","radial-gradient(circle at 30% 20%, #2dd4bf, #1e293b)","radial-gradient(circle at 70% 80%, #f59e0b, #7c3aed)"],De=(W,ge)=>{let le=t.querySelector(W),ve=t.querySelector(ge);!le||!ve||(le.innerHTML="",at.forEach(X=>{let te=document.createElement("button");te.type="button",te.className="gradient",te.style.background=X,te.setAttribute("aria-pressed","false"),te.title=X,te.addEventListener("click",()=>{le.querySelectorAll(".gradient").forEach(se=>se.setAttribute("aria-pressed","false")),te.setAttribute("aria-pressed","true"),ve.value=X;try{this.containerBackground=X,this.style.setProperty("--ddc-bg",X)}catch{}}),le.appendChild(te),String(ve.value).trim()===X&&te.setAttribute("aria-pressed","true")}))};De("#ddc-gradients-containerBg","#ddc-setting-containerBg"),De("#ddc-gradients-cardBg","#ddc-setting-cardBg");let re=()=>{var W,ge;try{(ge=(W=this.__ddcGridRO)==null?void 0:W.disconnect)==null||ge.call(W),this.__ddcGridRO=null}catch{}try{t.remove()}catch{}this.__settingsModal===t&&(this.__settingsModal=null)};(Dt=t.querySelector("#ddc-settings-close"))==null||Dt.addEventListener("click",W=>{W.stopPropagation(),re()}),(mt=t.querySelector("#ddc-settings-cancel"))==null||mt.addEventListener("click",W=>{W.stopPropagation(),re()}),(ot=t.querySelector("#ddc-settings-save"))==null||ot.addEventListener("click",W=>{var H,Le,Be,Ve,Fe,Qe,Xe,Je,$e,We,Ee,fe,we;W.stopPropagation();let ge=!!(o!=null&&o.checked),le=parseInt((l==null?void 0:l.value)||"0",10),ve=!!(c!=null&&c.checked),X=!!(d!=null&&d.checked),te=!!(f!=null&&f.checked),se=!!(v!=null&&v.checked),D=!!(m!=null&&m.checked),B=parseInt((_==null?void 0:_.value)||"0",10),ne=(g==null?void 0:g.value)||"dynamic",ce=(k==null?void 0:k.value)||"auto",de=!!(z!=null&&z.checked),ye=((E==null?void 0:E.value)||"").trim(),N=((L==null?void 0:L.value)||"").trim(),J=((I==null?void 0:I.value)||"").trim(),Oe=!!(Z!=null&&Z.checked);try{this.autoResizeCards=ge,this.autoResizeCards?(H=this._startScaleWatch)==null||H.call(this):(Le=this._stopScaleWatch)==null||Le.call(this),!isNaN(le)&&le>0&&le!==this.gridSize&&(this.gridSize=le,(Be=this._applyGridVars)==null||Be.call(this),(Ve=this._resizeContainer)==null||Ve.call(this));let ze=se!==this.dragLiveSnap;this.dragLiveSnap=se,ze&&((Fe=this._initInteract)==null||Fe.call(this)),this.autoSave=D,!isNaN(B)&&B>0&&(this.autoSaveDebounce=B);let ke=ne!==this.containerSizeMode;this.containerSizeMode=ne;let pe=ce!==this.containerPresetOrient;if(this.containerPresetOrient=ce,(ke||pe)&&((Qe=this._resizeContainer)==null||Qe.call(this)),ne==="fixed_custom"){let He=parseInt(((Xe=t.querySelector("#ddc-setting-custW"))==null?void 0:Xe.value)||"0",10),ut=parseInt(((Je=t.querySelector("#ddc-setting-custH"))==null?void 0:Je.value)||"0",10);!isNaN(He)&&He>0&&(this.containerFixedWidth=He),!isNaN(ut)&&ut>0&&(this.containerFixedHeight=ut),($e=this._resizeContainer)==null||$e.call(this)}else if(ne==="preset"){let He=(We=t.querySelector("#ddc-setting-preset"))==null?void 0:We.value;He&&(this.containerPreset=He),(Ee=this._resizeContainer)==null||Ee.call(this)}if(this.disableOverlap=de,ye&&(this.containerBackground=ye,this.style.setProperty("--ddc-bg",this.containerBackground)),N&&(this.cardBackground=N,this.style.setProperty("--ddc-card-bg",this.cardBackground)),J){let He=this._config&&this._config.background_image||{};this._config={...this._config,background_image:{...He,src:J}}}else{let{background_image:He,...ut}=this._config||{};this._config=ut}this.debug=Oe,this.animateCards=ve,this.hideHaHeader=X,this.hideHaSidebar=te,(fe=this._applyHaChromeVisibility_)==null||fe.call(this);let ae=this._config&&this._config.background_image||{},V=(C==null?void 0:C.value)||"no-repeat",U=(A==null?void 0:A.value)||"cover",j=(O==null?void 0:O.value)||"center center",me=(b==null?void 0:b.value)||"scroll",Ue=M?Math.max(0,Math.min(100,parseInt(M.value||"100",10)))/100:1;if(J)this._config={...this._config,background_image:{...ae,src:J,repeat:V,size:U,position:j,attachment:me,opacity:Ue}};else if(ae.src)this._config={...this._config,background_image:{...ae,repeat:V,size:U,position:j,attachment:me,opacity:Ue}};else{let{background_image:He,...ut}=this._config||{};this._config=ut}(we=this._applyBackgroundImageFromConfig_)==null||we.call(this);try{this._config||(this._config={}),this._config.grid=this.gridSize,this._config.auto_resize_cards=!!this.autoResizeCards,this._config.drag_live_snap=!!this.dragLiveSnap,this._config.auto_save=!!this.autoSave,this._config.auto_save_debounce=this.autoSaveDebounce,this._config.container_size_mode=this.containerSizeMode,this._config.container_preset_orientation=this.containerPresetOrient,this._config.container_fixed_width=this.containerFixedWidth,this._config.container_fixed_height=this.containerFixedHeight,this._config.container_preset=this.containerPreset,this._config.disable_overlap=!!this.disableOverlap,this._config.container_background=this.containerBackground,this._config.card_background=this.cardBackground,this._config.debug=!!this.debug,this._config.animate_cards=!!this.animateCards,this._config.hide_HA_Header=!!this.hideHaHeader,this._config.hide_HA_Sidebar=!!this.hideHaSidebar}catch(He){console.warn("[drag-and-drop-card] Failed to update config",He)}this._persistThisCardConfigToStorage_().catch(He=>{console.warn("[drag-and-drop-card] Storage save failed (is this a YAML dashboard?)",He)})}catch(ze){console.warn("[drag-and-drop-card] Failed to apply settings",ze)}re()})}_exportableOptions(){var a,o;let t={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(a=this.containerFixedWidth)!=null?a:void 0,container_fixed_height:(o=this.containerFixedHeight)!=null?o:void 0,container_preset:this.containerPreset,tabs:this.tabs,tabs_position:this.tabsPosition,default_tab:this.defaultTab,hide_tabs_when_single:!!this.hideTabsWhenSingle,auto_resize_cards:!!this.autoResizeCards};return Object.keys(t).forEach(l=>t[l]===void 0&&delete t[l]),t}_applyImportedOptions(t={},a=!0){var o,l,c,d,f,v,m,_;if(t&&Object.prototype.hasOwnProperty.call(t,"storage_key")&&this._isInHaEditorPreview())try{let g={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:g},bubbles:!0,composed:!0}))}catch{}this._config={...this._config||{},...t},"storage_key"in t&&(this.storageKey=t.storage_key||void 0),this._syncEditorsStorageKey(),"grid"in t&&(this.gridSize=Number(t.grid)||10),"drag_live_snap"in t&&(this.dragLiveSnap=!!t.drag_live_snap),"auto_save"in t&&(this.autoSave=!!t.auto_save),"auto_save_debounce"in t&&(this.autoSaveDebounce=Number(t.auto_save_debounce)||800),"container_background"in t&&(this.containerBackground=(o=t.container_background)!=null?o:"transparent"),"card_background"in t&&(this.cardBackground=(l=t.card_background)!=null?l:"var(--ha-card-background, var(--card-background-color))"),"debug"in t&&(this.debug=!!t.debug),"disable_overlap"in t&&(this.disableOverlap=!!t.disable_overlap),"container_size_mode"in t&&(this.containerSizeMode=t.container_size_mode||"dynamic"),"container_fixed_width"in t&&(this.containerFixedWidth=Number(t.container_fixed_width)||null),"container_fixed_height"in t&&(this.containerFixedHeight=Number(t.container_fixed_height)||null),"container_preset"in t&&(this.containerPreset=t.container_preset||"fhd"),"container_preset_orientation"in t&&(this.containerPresetOrient=t.container_preset_orientation||"auto"),"auto_resize_cards"in t&&(this.autoResizeCards=!!t.auto_resize_cards,this.autoResizeCards?(c=this._startScaleWatch)==null||c.call(this):(d=this._stopScaleWatch)==null||d.call(this),(f=this._applyAutoScale)==null||f.call(this)),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),a&&(this._applyContainerSizingFromConfig(!0),(v=this._applyAutoScale)==null||v.call(this),this._resizeContainer(),(m=this._updateStoreBadge)==null||m.call(this),(_=this._applyAutoScale)==null||_.call(this))}_exportDesign(){let a=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(f=>{let v=parseFloat(f.getAttribute("data-x"))||0,m=parseFloat(f.getAttribute("data-y"))||0,_=parseFloat(f.style.width)||f.getBoundingClientRect().width,g=parseFloat(f.style.height)||f.getBoundingClientRect().height,k=parseInt(f.style.zIndex||"1",10),z=this._extractCardConfig(f.firstElementChild),E=f.dataset.tabId||this.defaultTab;return{card:z,position:{x:v,y:m},size:{width:_,height:g},z:k,tabId:E}}),o={version:2,options:this._exportableOptions(),cards:a};this._config&&this._config.card_mod&&(o.options=o.options||{},o.options.card_mod=this._config.card_mod);let l=`DragAndDrop_Design_${this.storageKey||"layout"}.json`,c=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(c),d.download=l,d.click(),URL.revokeObjectURL(d.href),this._toast("Design exported.")}_importDesign(){let t=document.createElement("input");t.type="file",t.accept="application/json";let a=!0,o=!1,l=["grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","card_mod","storage_key"];t.onchange=async()=>{var f,v,m,_,g,k,z,E,L,I,C,A,O,b,M,R,Z,F,K,ie,G,ee,_e,Te,et,Ye,je,Ne,Me,nt,tt,Ge,it,pt,rt,oe,ft,at,De,re,Re,Ae,Ce,ct,lt,kt,xt,_t;let c=(f=t.files)==null?void 0:f[0];if(!c)return;let d=await c.text();try{let Ke=JSON.parse(d),Dt=this.storageKey||((v=this._config)==null?void 0:v.storage_key)||null,mt=!!(Ke.options&&Array.isArray(Ke.options.tabs)),ot=Array.isArray(Ke.cards)&&Ke.cards.some(X=>(X==null?void 0:X.tabId)||(X==null?void 0:X.tab_id)),W=[];mt?W=Ke.options.tabs:ot?W=Array.from(new Set(Ke.cards.map(te=>(te==null?void 0:te.tabId)||(te==null?void 0:te.tab_id)).filter(Boolean))).map(te=>({id:te,label:te})):W=[{id:"default",label:"Layout"}];let ge=((m=Ke.options)==null?void 0:m.tabs_position)==="left"?"left":this.tabsPosition||"top",le=((_=Ke.options)==null?void 0:_.default_tab)||((g=W[0])==null?void 0:g.id)||"default",ve=((k=Ke.options)==null?void 0:k.hide_tabs_when_single)!==void 0?!!Ke.options.hide_tabs_when_single:!0;if(Ke.options){let X={...Ke.options};if(o||delete X.storage_key,a){let te=this._config||{type:"custom:drag-and-drop-card"};for(let se of l)se==="storage_key"&&!o||!(se in X)&&se in te&&delete te[se];try{this.cardContainer&&(this.cardContainer.style.background="",this.cardContainer.style.width="",this.cardContainer.style.height=""),(E=(z=this.style)==null?void 0:z.removeProperty)==null||E.call(z,"--ddc-container-bg"),(I=(L=this.style)==null?void 0:L.removeProperty)==null||I.call(L,"--ddc-card-bg")}catch{}if(this._config={...te,...X},"card_mod"in X||delete this._config.card_mod,o&&X.storage_key&&(this.storageKey=X.storage_key),this._opts){this._opts={...this._opts,...X};for(let se of l)se in X||delete this._opts[se]}(C=this._applyOptionsToDom)==null||C.call(this,this._config),(A=this.requestUpdate)==null||A.call(this)}else this._applyImportedOptions(X,!0),X.card_mod!==void 0&&(this._config=this._config||{},this._config.card_mod=X.card_mod,(O=this.requestUpdate)==null||O.call(this))}else if(typeof Ke.grid=="number"){let X={grid:Ke.grid};a?this._config={...this._config||{},...X}:this._applyImportedOptions(X,!0),(b=this.requestUpdate)==null||b.call(this)}(!Array.isArray(this.tabs)||!this.tabs.length)&&(this.tabs=W),this.tabsPosition||(this.tabsPosition=ge),this.defaultTab||(this.defaultTab=le),this.hideTabsWhenSingle===void 0&&(this.hideTabsWhenSingle=ve),(Z=(R=(M=this.rootEl)==null?void 0:M.classList)==null?void 0:R.toggle)==null||Z.call(R,"ddc-tabs-left-layout",this.tabsPosition==="left");try{let X=((F=this._config)==null?void 0:F.storage_key)||this.storageKey||null,te=(K=Ke.options)!=null?K:typeof Ke.grid=="number"?{grid:Ke.grid}:{},se={...te,tabs:(G=(ie=te.tabs)!=null?ie:this.tabs)!=null?G:[],tabs_position:(_e=(ee=te.tabs_position)!=null?ee:this.tabsPosition)!=null?_e:"top",default_tab:(Me=(Te=te.default_tab)!=null?Te:this.defaultTab)!=null?Me:((Ye=(et=te.tabs)==null?void 0:et[0])==null?void 0:Ye.id)||((Ne=(je=this.tabs)==null?void 0:je[0])==null?void 0:Ne.id)||"default",hide_tabs_when_single:(tt=te.hide_tabs_when_single)!=null?tt:(nt=this.hideTabsWhenSingle)!=null?nt:!0};if(o||delete se.storage_key,!X)console.warn("[ddc:import] No storage_key on this card; aborting YAML persist.");else{let D=await((Ge=this._persistOptionsToYaml)==null?void 0:Ge.call(this,se,{forceTargetKey:String(X),noDownload:!0,replace:!0,wipeUnknownKeys:!0})),B=!!(D&&D.yamlSaved);(it=console.debug)==null||it.call(console,"[ddc:import] YAML persist result:",B)}try{let D={type:"custom:drag-and-drop-card",...this._config||{}};D.tabs=se.tabs,D.tabs_position=se.tabs_position,D.default_tab=se.default_tab,D.hide_tabs_when_single=!!se.hide_tabs_when_single,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:D},bubbles:!0,composed:!0}))}catch{}}catch(X){console.warn("[ddc:import] YAML persist failed:",X)}if(this.cardContainer.innerHTML="",Array.isArray(Ke.cards)&&Ke.cards.length)for(let X of Ke.cards){let te=((pt=X.position)==null?void 0:pt.x)||0,se=((rt=X.position)==null?void 0:rt.y)||0,D=((oe=X.size)==null?void 0:oe.width)||140,B=((ft=X.size)==null?void 0:ft.height)||100,ne=X.z,ce=this._normalizeTabId(X.tabId||X.tab_id||this.defaultTab);if(!(X!=null&&X.card)||typeof X.card=="object"&&!Object.keys(X.card).length){let N=this._makePlaceholderAt(te,se,D,B);N.dataset.tabId=ce,this.cardContainer.appendChild(N);continue}let de=await this._createCard(X.card),ye=this._makeWrapper(de);ye.dataset.tabId=ce,this._setCardPosition(ye,te,se),ye.style.width=`${D}px`,ye.style.height=`${B}px`,ne!=null&&(ye.style.zIndex=String(ne)),this.cardContainer.appendChild(ye);try{this._rebuildOnce(ye.firstElementChild)}catch{}this._initCardInteract(ye)}else this._showEmptyPlaceholder(),(at=this._applyAutoScale)==null||at.call(this);(De=this._applyOptionsToDom)==null||De.call(this,this._config),this._resizeContainer();try{(Ae=(Re=(re=this.rootEl)==null?void 0:re.classList)==null?void 0:Re.toggle)==null||Ae.call(Re,"ddc-tabs-left-layout",this.tabsPosition==="left"),(Ce=this._renderTabs)==null||Ce.call(this),(ct=this._applyActiveTab)==null||ct.call(this)}catch{}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0),(lt=this._toast)==null||lt.call(this,"Design imported & saved. Reloading..."),window.location.reload()}catch(X){console.warn("[ddc:import] saveLayout failed",X),(kt=this._markDirty)==null||kt.call(this,"import"),(xt=this._toast)==null||xt.call(this,"Design imported \u2014 click Apply to save.")}}catch(Ke){console.error("Import failed",Ke),(_t=this._toast)==null||_t.call(this,"Import failed \u2014 invalid file.")}},t.click()}_getLovelace(){var c,d;let t=0,a=this;for(;a&&t++<20;){let f=(c=a.getRootNode)==null?void 0:c.call(a),v=f==null?void 0:f.host;if((v==null?void 0:v.tagName)==="HUI-ROOT")return v.lovelace;a=v||a.parentElement}let o=new Set,l=[document];for(;l.length;){let f=l.shift();if(!(!f||o.has(f))){if(o.add(f),((d=f.host)==null?void 0:d.tagName)==="HUI-ROOT")return f.host.lovelace;if(f.tagName==="HUI-ROOT")return f.lovelace;if(f.shadowRoot&&l.push(f.shadowRoot),f.children)for(let v of f.children)l.push(v)}}}_scanDdcCards(t){let a=[],o=(c,d,f)=>{(f==null?void 0:f.type)==="custom:drag-and-drop-card"&&a.push({view:c,path:[...d],card:f})},l=(c,d,f)=>{if(c){if(Array.isArray(c)){c.forEach((v,m)=>l(v,d,f.concat(m)));return}if(typeof c=="object"){"type"in c&&o(d,f,c);for(let[v,m]of Object.entries(c))v==="views"&&Array.isArray(m)?m.forEach((_,g)=>l(_,g,["views",g])):(Array.isArray(m)||m&&typeof m=="object")&&l(m,d,f.concat(v))}}};return l(t,-1,[]),a}async _persistOptionsToYaml(t,{prevKey:a=null,patchAllInCurrentViewIfNoKey:o=!1}={}){var l,c,d,f,v,m,_,g,k;try{let z=this._getLovelace();if(!z)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof z.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let E=JSON.parse(JSON.stringify(z.config)),L=this._scanDdcCards(E),I=(l=z.current_view)!=null?l:0;console.debug("[ddc:import] persist: found DDC cards",L.map(M=>({view:M.view,path:M.path.join("."),storage_key:M.card.storage_key||null})));let C=(c=t==null?void 0:t.storage_key)!=null?c:null,A=[];a&&A.push(a),C&&A.push(C),this.storageKey&&A.push(this.storageKey),(d=this._config)!=null&&d.storage_key&&A.push(this._config.storage_key);let O=L.filter(M=>M.card.storage_key&&A.includes(M.card.storage_key));if(!O.length){let M=L.filter(R=>R.view===I);M.length===1&&(O=M)}if(!O.length&&L.length===1&&(O=L),!O.length)return console.debug("[ddc:import] persist: no target. Provide a unique storage_key on this card and import again.",{prevKey:a,newKey:C,storageKey:this.storageKey}),!1;let b={type:"custom:drag-and-drop-card",...t};"storage_key"in b&&delete b.storage_key,"storageKey"in b&&delete b.storageKey;for(let M of O){let R=E;for(let K of M.path)R=R[K];let Z=(k=(g=(m=(f=R==null?void 0:R.storage_key)!=null?f:R==null?void 0:R.storageKey)!=null?m:(v=R==null?void 0:R.options)==null?void 0:v.storage_key)!=null?g:(_=R==null?void 0:R.options)==null?void 0:_.storageKey)!=null?k:null,F=!!(a&&C&&Z===a&&C!==a);Object.assign(R,b),F?R.storage_key=String(C):Z&&(R.storage_key=String(Z)),"storageKey"in R&&delete R.storageKey}return console.debug("[ddc:import] persist \u2192 saving",{patched:O.length,keysTried:A,patch}),await z.saveConfig(E),!0}catch(z){return console.warn("[ddc:import] persist error",z),!1}}_queueSave(t="auto"){this._markDirty(t),this.autoSave&&(this._loading||this.editMode&&(this._dbgPush("autosave","Queued",{reason:t,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce)))}async _saveLayout(t=!0){let o=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(c=>{let d=parseFloat(c.getAttribute("data-x"))||0,f=parseFloat(c.getAttribute("data-y"))||0,v=parseFloat(c.style.width)||c.getBoundingClientRect().width,m=parseFloat(c.style.height)||c.getBoundingClientRect().height,_=parseInt(c.style.zIndex||"1",10),g=this._extractCardConfig(c.firstElementChild),k=c.dataset.tabId||this.defaultTab;return{card:g,position:{x:d,y:f},size:{width:v,height:m},z:_,tabId:k}}),l={version:2,options:this._exportableOptions(),cards:o};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(l))}catch{}if(!this.storageKey){t||this._toast("Saved locally (no storage_key set)."),this.__dirty=!1,this._updateApplyBtn();return}try{await this._saveLayoutToBackend(this.storageKey,l),t||this._toast("Layout saved."),this.__dirty=!1,this._updateApplyBtn()}catch(c){console.error("Backend save failed",c),this._dbgPush("save","Backend save failed",{error:String(c)}),t||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let t=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let a=await this.hass.callApi("get","dragdrop_storage"),o=Math.round(performance.now()-t);this._dbgPush("probe",`OK (${o} ms)`,a),this._backendOK=!!a}catch(a){let o=Math.round(performance.now()-t);this._dbgPush("probe",`FAILED (${o} ms)`,{error:String(a)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(t){let a=`dragdrop_storage/${encodeURIComponent(t)}`,o=performance.now();try{this._dbgPush("load",`GET /api/${a}`);let l=await this.hass.callApi("get",a),c=Math.round(performance.now()-o);return this._dbgPush("load",`OK (${c} ms)`,{bytes:JSON.stringify(l||"").length}),l}catch(l){let c=Math.round(performance.now()-o);return this._dbgPush("load",`FAILED (${c} ms)`,{error:String(l)}),null}}async _saveLayoutToBackend(t,a){let o=`dragdrop_storage/${encodeURIComponent(t)}`,l=JSON.stringify(a).length,c=performance.now();try{this._dbgPush("save",`POST /api/${o}`,{bytes:l});let d=await this.hass.callApi("post",o,a),f=Math.round(performance.now()-c);return this._dbgPush("save",`OK (${f} ms)`,d),d}catch(d){let f=Math.round(performance.now()-c);throw this._dbgPush("save",`FAILED (${f} ms)`,{error:String(d),bytes:l}),d}}_updateStoreBadge(){let t=this.storeBadge;if(!t)return;let a=this._backendOK&&!!this.storageKey;t.textContent=a?"storage: backend - OK":"storage: local. Your Changes are NOT being SAVED. You need to download the Drag and Drop Card backend integration",t.style.background=a?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",t.style.borderColor=a?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(t){let a=new Event("hass-notification");a.detail={message:t},window.dispatchEvent(a)}_huiRoot(){var t,a,o,l,c,d;try{let f=document.querySelector("home-assistant"),v=(t=f==null?void 0:f.shadowRoot)==null?void 0:t.querySelector("home-assistant-main"),m=((a=v==null?void 0:v.shadowRoot)==null?void 0:a.querySelector("ha-drawer"))||v,_=((o=m==null?void 0:m.shadowRoot)==null?void 0:o.querySelector("partial-panel-resolver"))||m,g=((l=_==null?void 0:_.shadowRoot)==null?void 0:l.querySelector("ha-panel-lovelace"))||((c=m==null?void 0:m.shadowRoot)==null?void 0:c.querySelector("ha-panel-lovelace"));return((d=g==null?void 0:g.shadowRoot)==null?void 0:d.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",Vi);(()=>{try{let e=window.customCards=window.customCards||[];e.some(u=>u.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!1})}catch{}})();(()=>{let e=new WeakSet,u=c=>{try{if(!(c instanceof Element))return!1;let d=c.localName||"";return d?!!(d==="ha-card"||d.endsWith("-card")):!1}catch{return!1}},t=c=>{try{if(!c||e.has(c))return;e.add(c),c.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}},a=c=>{var d,f;try{if(!c)return;c instanceof Element&&u(c)&&t(c);let v=(f=(d=(c instanceof ShadowRoot,c)).querySelectorAll)==null?void 0:f.call(d,"*");if(!v)return;for(let m of v){u(m)&&t(m);let _=m.shadowRoot;if(_)try{a(_)}catch{}}}catch{}},o=c=>{try{if(!c||c.__ddcCardModIntegrated)return;c.__ddcCardModIntegrated=!0;let d=c.shadowRoot||c;a(d);let f=new MutationObserver(v=>{for(let m of v)if(!(!m.addedNodes||!m.addedNodes.length))for(let _ of m.addedNodes)(_ instanceof Element||_ instanceof ShadowRoot)&&a(_)});f.observe(d,{childList:!0,subtree:!0}),c.__ddcCardModIntegratedObserver=f,setTimeout(()=>{try{a(d)}catch{}},250),setTimeout(()=>{try{a(d)}catch{}},1e3)}catch{}},l=()=>{try{document.querySelectorAll("drag-and-drop-card").forEach(o)}catch{}};if(window.customElements&&window.customElements.whenDefined)window.customElements.whenDefined("drag-and-drop-card").then(()=>{l();let c=window.customElements.get("drag-and-drop-card");if(c&&c.prototype){let f=c.prototype.connectedCallback;c.prototype.connectedCallback=function(){try{f&&f.call(this)}finally{o(this)}}}new MutationObserver(()=>l()).observe(document.documentElement,{childList:!0,subtree:!0})});else{let c=setInterval(l,1e3);setTimeout(()=>clearInterval(c),1e4)}})();(function(){let e="drag-and-drop-card",u=customElements.get(e);if(!u){console.warn("[ddc:augment] Could not find custom element",e);return}function t(){var E,L;try{let I=0,C=this;for(;C&&I++<20;){let b=(E=C.getRootNode)==null?void 0:E.call(C),M=b==null?void 0:b.host;if((M==null?void 0:M.tagName)==="HUI-ROOT")return M.lovelace;C=M||C.parentElement}let A=new Set,O=[document];for(;O.length;){let b=O.shift();if(!(!b||A.has(b))){if(A.add(b),((L=b.host)==null?void 0:L.tagName)==="HUI-ROOT")return b.host.lovelace;if(b.tagName==="HUI-ROOT")return b.lovelace;if(b.shadowRoot&&O.push(b.shadowRoot),b.children)for(let M of b.children)O.push(M)}}}catch{}}function a(E){let L=[],I=(A,O,b)=>{(b==null?void 0:b.type)==="custom:drag-and-drop-card"&&L.push({view:A,path:[...O],card:b})},C=(A,O,b)=>{if(A){if(Array.isArray(A)){A.forEach((M,R)=>C(M,O,b.concat(R)));return}if(typeof A=="object"){"type"in A&&I(O,b,A);for(let[M,R]of Object.entries(A))M==="views"&&Array.isArray(R)?R.forEach((Z,F)=>C(Z,F,["views",F])):(Array.isArray(R)||R&&typeof R=="object")&&C(R,O,b.concat(M))}}};return C(E,-1,[]),L}function o(E,L,I){let C=new Date().toISOString().replace(/[:.]/g,"-"),A=L.map(b=>{let M=E;for(let R of b.path)M=M[R];return{view:b.view,path:b.path,storage_key:M&&M.storage_key||null,before:M,patch:I}}),O={kind:"ddc-import-backup",created_at:C,count:A.length,items:A};try{let b=`ddc.backup.${C}`;localStorage.setItem(b,JSON.stringify(O));let M=Object.keys(localStorage).filter(R=>R.startsWith("ddc.backup.")).sort().reverse();for(let R of M.slice(10))localStorage.removeItem(R)}catch{}return{name:`ddc_backup_${C}.json`,data:O}}function l(E,L){try{let I=new Blob([JSON.stringify(L,null,2)],{type:"application/json"}),C=URL.createObjectURL(I),A=document.createElement("a");A.href=C,A.download=E,document.body.appendChild(A),A.click(),A.remove(),setTimeout(()=>URL.revokeObjectURL(C),1500)}catch(I){console.warn("[ddc:backup] download failed",I)}}function c(E){if(E)try{let L="ddc.recent.keys",I=JSON.parse(localStorage.getItem(L)||"[]");I.includes(E)||I.unshift(E),localStorage.setItem(L,JSON.stringify(I.slice(0,20)))}catch{}}function d(){try{return JSON.parse(localStorage.getItem("ddc.recent.keys")||"[]")}catch{return[]}}function f(){var L,I;let E=new Set;try{let C=Object.keys(localStorage).filter(A=>A.startsWith("ddc.backup.")).sort().reverse();for(let A of C)try{let O=JSON.parse(localStorage.getItem(A)||"null");if(O&&O.items)for(let b of O.items){let M=((L=b==null?void 0:b.before)==null?void 0:L.storage_key)||((I=b==null?void 0:b.patch)==null?void 0:I.storage_key);M&&E.add(M)}}catch{}}catch{}return Array.from(E)}async function v(E,{forceTargetKey:L=null,onlyThisCard:I=!1,prevKey:C,noDownload:A}={}){var Te,et,Ye,je,Ne;let O=((Te=this._getLovelace)==null?void 0:Te.call(this))||t.call(this);if(!O)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof O.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let b=Me=>typeof Me=="string"?Me.trim():null,M=b(L)||b((et=this==null?void 0:this._config)==null?void 0:et.storage_key)||b(this==null?void 0:this.storageKey)||b(C);if(!M)return console.warn("[ddc:import] persist: missing target storage_key on this card; aborting"),!1;let R=JSON.parse(JSON.stringify(O.config)),Z=(this._scanDdcCards||a)(R);console.debug("[ddc:import] persist: found DDC cards",Z.map(Me=>({view:Me.view,path:Me.path.join("."),storage_key:Me.card&&(Me.card.storage_key||Me.card.storageKey)||null})));let F=Z.filter(Me=>{var tt,Ge,it,pt,rt,oe,ft,at,De;return((De=(oe=(it=b((tt=Me.card)==null?void 0:tt.storage_key))!=null?it:b((Ge=Me.card)==null?void 0:Ge.storageKey))!=null?oe:b((rt=(pt=Me.card)==null?void 0:pt.options)==null?void 0:rt.storage_key))!=null?De:b((at=(ft=Me.card)==null?void 0:ft.options)==null?void 0:at.storageKey))===M});if(F.length!==1)return console.warn("[ddc:import] persist: expected exactly one target with key, got",F.length,{myKey:M}),!1;let K={type:"custom:drag-and-drop-card",...E||{}};"storage_key"in K&&delete K.storage_key,"storageKey"in K&&delete K.storageKey,K!=null&&K.options&&("storage_key"in K.options&&delete K.options.storage_key,"storageKey"in K.options&&delete K.options.storageKey);let ie=Array.isArray(K.cards)?K.cards:null;delete K.cards;try{let Me=o==null?void 0:o(O.config,F,K);Me&&(console.debug("[ddc:import] backup created",{file:Me.name,items:(Ye=Me.data)==null?void 0:Ye.count}),!A&&typeof l=="function"&&l(Me.name,Me.data))}catch(Me){console.debug("[ddc:import] backup skipped/error:",(Me==null?void 0:Me.message)||Me)}let G=F[0],ee=R;for(let Me of G.path)ee=ee[Me];let _e=(Ne=(je=b(ee==null?void 0:ee.storage_key))!=null?je:b(ee==null?void 0:ee.storageKey))!=null?Ne:null;return Object.assign(ee,K),_e?ee.storage_key=_e:ee.storage_key=M,"storageKey"in ee&&delete ee.storageKey,console.debug("[ddc:import] persist \u2192 saving",{patched:1,into_key:ee.storage_key,ignored_file_key:b(E==null?void 0:E.storage_key)||b(E==null?void 0:E.storageKey)||null}),await O.saveConfig(R),{yamlSaved:!0,cardsForStorage:ie}}async function m(){var I;let E=C=>{if(!C)return[];if(Array.isArray(C))return C;if(Array.isArray(C==null?void 0:C.keys))return C.keys;if(Array.isArray(C==null?void 0:C.dashboards))return C.dashboards;if(Array.isArray(C==null?void 0:C.entries))return C.entries.map(A=>A.key||A.id||A.name).filter(Boolean);if(Array.isArray(C==null?void 0:C.items))return C.items.map(A=>A.key||A.id||A.name).filter(Boolean);if(typeof C=="object"){for(let A of Object.values(C))if(Array.isArray(A)&&A.every(O=>typeof O=="string"))return A}return[]};try{if((I=this==null?void 0:this.hass)!=null&&I.callApi){let C=await this.hass.callApi("get","dragdrop_storage"),A=E(C);if(A.length)return A}}catch(C){console.debug("[ddc:switcher] hass.callApi dragdrop_storage failed",C)}let L=["/api/dragdrop_storage","/api/dragdrop_storage/keys","/api/dragdrop_storage/list","/api/dragdrop_storage?all=1"];for(let C of L)try{let O=await(await fetch(C,{cache:"no-store"})).json(),b=E(O);if(b.length)return b}catch{}return[]}async function _(E){let L=O=>{if(!O)return null;if(O.options||O.cards)return O;if(typeof O.design=="object")return O.design;if(typeof O.payload=="object")return O.payload;try{if(typeof O=="string")return JSON.parse(O)}catch{}return null},I=async(O,b,M)=>{var R;try{if((R=this==null?void 0:this.hass)!=null&&R.callApi){let Z=await this.hass.callApi(O,b,M),F=L(Z);if(F)return F}}catch{}return null},C=async O=>{try{let b=await fetch(O,{cache:"no-store"}),M=b.headers.get("content-type")||"";if(M.includes("application/json")||M.includes("text/plain")){let R=await b.json().catch(()=>null)||await b.text().catch(()=>null),Z=L(R);if(Z)return Z}}catch{}return null},A=encodeURIComponent(E);return await(I("get",`dragdrop_storage/${A}`)||C(`/api/dragdrop_storage/${A}`)||C(`/api/dragdrop_storage?key=${A}`)||I("post","dragdrop_storage/get",{key:E})||null)}async function g(E,{source:L="switcher",newKey:I=null}={}){var O,b,M,R,Z,F,K,ie,G,ee,_e,Te,et,Ye,je,Ne,Me,nt,tt,Ge,it,pt,rt,oe,ft,at;if(!E||typeof E!="object")throw new Error("Invalid design payload");let C=this.storageKey||((O=this._config)==null?void 0:O.storage_key)||null;try{(b=this._dbgInit)==null||b.call(this),(M=this._dbgPush)==null||M.call(this,"import","Begin import (programmatic)",{source:L,newKey:I})}catch{}if(E.options){let{storage_key:De,...re}=E.options;(R=this._applyImportedOptions)==null||R.call(this,re,!0)}else typeof E.grid=="number"&&((Z=this._applyImportedOptions)==null||Z.call(this,{grid:E.grid},!0));let A=I||((F=E==null?void 0:E.options)==null?void 0:F.storage_key)||C;if(A){this.storageKey=A,this._config={...this._config||{},storage_key:A};try{(K=this._syncEditorsStorageKey)==null||K.call(this)}catch{}}try{let De=(ie=E.options)!=null?ie:typeof E.grid=="number"?{grid:E.grid}:{};await((G=this._persistOptionsToYaml)==null?void 0:G.call(this,{...De,storage_key:A},{prevKey:C,noDownload:L==="switcher"}))}catch(De){console.warn("[ddc:apply] persist failed",De)}try{if(this.cardContainer.innerHTML="",Array.isArray(E.cards)&&E.cards.length)for(let De of E.cards)if(!(De!=null&&De.card)||typeof De.card=="object"&&Object.keys(De.card).length===0){let re=(Ye=this._makePlaceholderAt)==null?void 0:Ye.call(this,((ee=De.position)==null?void 0:ee.x)||0,((_e=De.position)==null?void 0:_e.y)||0,((Te=De.size)==null?void 0:Te.width)||200,((et=De.size)==null?void 0:et.height)||200);re&&this.cardContainer.appendChild(re)}else{let re=await this._createCard(De.card),Re=this._makeWrapper(re);(Me=this._setCardPosition)==null||Me.call(this,Re,((je=De.position)==null?void 0:je.x)||0,((Ne=De.position)==null?void 0:Ne.y)||0),Re.style.width=`${((nt=De.size)==null?void 0:nt.width)||140}px`,Re.style.height=`${((tt=De.size)==null?void 0:tt.height)||100}px`,De.z!=null&&(Re.style.zIndex=String(De.z)),this.cardContainer.appendChild(Re);try{(Ge=this._rebuildOnce)==null||Ge.call(this,Re.firstElementChild)}catch{}(it=this._initCardInteract)==null||it.call(this,Re)}else(pt=this._showEmptyPlaceholder)==null||pt.call(this);(rt=this._resizeContainer)==null||rt.call(this),(oe=this._markDirty)==null||oe.call(this,"import"),(ft=this._toast)==null||ft.call(this,L==="switcher"?`Loaded layout "${A}"`:"Design imported")}catch(De){console.error("[ddc:apply] rebuild failed",De),(at=this._toast)==null||at.call(this,"Import failed during rebuild.")}}function k(){var E,L;try{let I=this.shadowRoot||this.renderRoot||this,C=I.querySelector(".ddc-switcher-inline");if(!C)return;let A=((E=this._getLovelace)==null?void 0:E.call(this))||t.call(this),O=!1;try{let b=(L=I.getRootNode&&I.getRootNode())==null?void 0:L.host;O=!!(A&&(A.editMode===!0||b&&b.editMode===!0))}catch{}C.style.display=O?"inline-flex":"none"}catch{}}function z(){try{if(this._ddcSwitcherInstalled)return;let L=(this.shadowRoot||this.renderRoot||this).querySelector(".toolbar");if(!L)return;let I=document.createElement("div");I.className="ddc-switcher-inline",Object.assign(I.style,{display:"inline-flex",gap:"6px",alignItems:"center",marginLeft:"auto"});let C=document.createElement("span");C.textContent="Layout:",C.style.fontSize="12px",C.style.opacity="0.8";let A=document.createElement("select");Object.assign(A.style,{fontSize:"12px",padding:"4px 6px",borderRadius:"8px",border:"1px solid var(--divider-color, #999)",background:"var(--card-background-color, #fff)"}),A.title="Select stored layout (storage_key)",A.id="ddcKeySelect";let O=document.createElement("button");O.className="btn secondary",O.type="button",O.style.padding="6px 10px",O.innerHTML='<ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh</span>',I.appendChild(C),I.appendChild(A),I.appendChild(O),L.appendChild(I),this._ddcSwitcherInstalled=!0;let b=async()=>{let M=this.storageKey||this._config&&this._config.storage_key||"",R=await m.call(this),Z=f(),F=d(),K=Te=>Array.from(new Set(Te.filter(Boolean))),ie=K(R),G=K(Z),ee=K(F);if(A.innerHTML="",M&&!ie.includes(M)&&!G.includes(M)&&!ee.includes(M)){let Te=document.createElement("option");Te.value=M,Te.textContent=`${M} (current)`,Te.selected=!0,A.appendChild(Te)}let _e=(Te,et)=>{if(!et.length)return;let Ye=document.createElement("optgroup");Ye.label=Te,et.forEach(je=>{let Ne=document.createElement("option");Ne.value=je,Ne.textContent=je,je===M&&(Ne.selected=!0),Ye.appendChild(Ne)}),A.appendChild(Ye)};if(_e("Server",ie),_e("Backups",G),_e("Recent",ee),!A.children.length){let Te=document.createElement("option");Te.value="",Te.textContent="\u2014 none \u2014",Te.selected=!0,A.appendChild(Te)}k.call(this)};b(),O.addEventListener("click",b),A.addEventListener("change",async M=>{var Z,F,K,ie,G,ee,_e,Te;let R=String(M.target.value||"");if(R&&!this._ddcLoadingFromKey){this._ddcLoadingFromKey=!0;try{let et=await _.call(this,R);if(!et){(Z=this._toast)==null||Z.call(this,`No layout found for "${R}"`);return}await g.call(this,et,{source:"switcher",newKey:R}),(F=this._resizeContainer)==null||F.call(this),(K=this._toast)==null||K.call(this,`Loaded layout "${R}"`);let Ye=String(((ie=this._config)==null?void 0:ie.storage_key)||this.storageKey||""),je=!1;try{let Ne=Ye?{forceTargetKey:Ye,noDownload:!0}:{noDownload:!0};je=await this._persistOptionsToYaml({storage_key:R},Ne)}catch(Ne){console.warn("[ddc:switcher] failed to persist storage_key to YAML",Ne),(G=this._toast)==null||G.call(this,"Failed to persist selected layout. Keeping current.");return}if(this.storageKey=R,this._config&&(this._config.storage_key=R),!je){console.warn("[ddc:switcher] persist returned false (likely YAML mode). Skipping reload.");return}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(Ne){console.warn("[ddc:switcher] saveLayout failed",Ne),(ee=this._markDirty)==null||ee.call(this,"switcher"),(_e=this._toast)==null||_e.call(this,"Layout loaded \u2014 click Apply to save.");return}window.location.reload(),window.location.reload()}catch(et){console.warn("[ddc:switcher] load/apply failed",et),(Te=this._toast)==null||Te.call(this,"Failed to load layout.")}finally{this._ddcLoadingFromKey=!1}}}),this._ddcVisTimer&&clearInterval(this._ddcVisTimer),this._ddcVisTimer=setInterval(()=>k.call(this),800),k.call(this)}catch(E){console.warn("[ddc:switcher] inline install failed",E)}}u.prototype._getLovelace||(u.prototype._getLovelace=t),u.prototype._scanDdcCards||(u.prototype._scanDdcCards=a),u.prototype._persistOptionsToYaml=v,u.prototype._applyDesignObject||(u.prototype._applyDesignObject=g);try{let E=Object.getOwnPropertyDescriptor(u.prototype,"hass");if(E&&(E.set||E.get)){let L=E.set;Object.defineProperty(u.prototype,"hass",{configurable:!0,enumerable:!0,set(I){L&&L.call(this,I);try{z.call(this)}catch{}},get:E.get||function(){return this._hass}})}else if(typeof u.prototype.setHass=="function"){let L=u.prototype.setHass;u.prototype.setHass=function(I){L&&L.call(this,I);try{z.call(this)}catch{}}}else{let L=u.prototype.updated||u.prototype.firstUpdated;u.prototype.updated=function(...I){L&&L.apply(this,I);try{z.call(this)}catch{}}}}catch(E){console.warn("[ddc:switcher] wrap hass setter failed",E)}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
