var Po=Object.create;var pi=Object.defineProperty;var Io=Object.getOwnPropertyDescriptor;var Lo=Object.getOwnPropertyNames;var zo=Object.getPrototypeOf,Fo=Object.prototype.hasOwnProperty;var Do=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var Ro=(e,r,a,d)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of Lo(r))!Fo.call(e,l)&&l!==a&&pi(e,l,{get:()=>r[l],enumerable:!(d=Io(r,l))||d.enumerable});return e};var Bo=(e,r,a)=>(a=e!=null?Po(zo(e)):{},Ro(r||!e||!e.__esModule?pi(a,"default",{value:e,enumerable:!0}):a,e));var hi=Do((yn,pt)=>{(function(e,r){typeof yn=="object"&&typeof pt!="undefined"?pt.exports=r():typeof define=="function"&&define.amd?define(r):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=r()})(yn,(function(){"use strict";function e(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),i.push.apply(i,o)}return i}function r(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?e(Object(i),!0).forEach((function(o){h(n,o,i[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(i,o))}))}return n}function a(n){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(n)}function d(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function l(n,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,T(o.key),o)}}function u(n,t,i){return t&&l(n.prototype,t),i&&l(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function h(n,t,i){return(t=T(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function m(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&b(n,t)}function g(n){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(n)}function b(n,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},b(n,t)}function S(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _(n){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var i,o=g(n);if(t){var s=g(this).constructor;i=Reflect.construct(o,arguments,s)}else i=o.apply(this,arguments);return(function(c,p){if(p&&(typeof p=="object"||typeof p=="function"))return p;if(p!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S(c)})(this,i)}}function k(){return k=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(n,t,i){var o=(function(c,p){for(;!Object.prototype.hasOwnProperty.call(c,p)&&(c=g(c))!==null;);return c})(n,t);if(o){var s=Object.getOwnPropertyDescriptor(o,t);return s.get?s.get.call(arguments.length<3?n:i):s.value}},k.apply(this,arguments)}function T(n){var t=(function(i,o){if(typeof i!="object"||i===null)return i;var s=i[Symbol.toPrimitive];if(s!==void 0){var c=s.call(i,o||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)})(n,"string");return typeof t=="symbol"?t:t+""}var M=function(n){return!(!n||!n.Window)&&n instanceof n.Window},A=void 0,L=void 0;function j(n){A=n;var t=n.document.createTextNode("");t.ownerDocument!==n.document&&typeof n.wrap=="function"&&n.wrap(t)===t&&(n=n.wrap(n)),L=n}function q(n){return M(n)?n:(n.ownerDocument||n).defaultView||L.window}typeof window!="undefined"&&window&&j(window);var re=function(n){return!!n&&a(n)==="object"},$=function(n){return typeof n=="function"},E={window:function(n){return n===L||M(n)},docFrag:function(n){return re(n)&&n.nodeType===11},object:re,func:$,number:function(n){return typeof n=="number"},bool:function(n){return typeof n=="boolean"},string:function(n){return typeof n=="string"},element:function(n){if(!n||a(n)!=="object")return!1;var t=q(n)||L;return/object|function/.test(typeof Element=="undefined"?"undefined":a(Element))?n instanceof Element||n instanceof t.Element:n.nodeType===1&&typeof n.nodeName=="string"},plainObject:function(n){return re(n)&&!!n.constructor&&/function Object\b/.test(n.constructor.toString())},array:function(n){return re(n)&&n.length!==void 0&&$(n.splice)}};function ne(n){var t=n.interaction;if(t.prepared.name==="drag"){var i=t.prepared.axis;i==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):i==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function de(n){var t=n.iEvent,i=n.interaction;if(i.prepared.name==="drag"){var o=i.prepared.axis;if(o==="x"||o==="y"){var s=o==="x"?"y":"x";t.page[s]=i.coords.start.page[s],t.client[s]=i.coords.start.client[s],t.delta[s]=0}}}var ae={id:"actions/drag",install:function(n){var t=n.actions,i=n.Interactable,o=n.defaults;i.prototype.draggable=ae.draggable,t.map.drag=ae,t.methodDict.drag="draggable",o.actions.drag=ae.defaults},listeners:{"interactions:before-action-move":ne,"interactions:action-resume":ne,"interactions:action-move":de,"auto-start:check":function(n){var t=n.interaction,i=n.interactable,o=n.buttons,s=i.options.drag;if(s&&s.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(o&i.options.drag.mouseButtons)!=0))return n.action={name:"drag",axis:s.lockAxis==="start"?s.startAxis:s.lockAxis},!1}},draggable:function(n){return E.object(n)?(this.options.drag.enabled=n.enabled!==!1,this.setPerAction("drag",n),this.setOnEvents("drag",n),/^(xy|x|y|start)$/.test(n.lockAxis)&&(this.options.drag.lockAxis=n.lockAxis),/^(xy|x|y)$/.test(n.startAxis)&&(this.options.drag.startAxis=n.startAxis),this):E.bool(n)?(this.options.drag.enabled=n,this):this.options.drag},beforeMove:ne,move:de,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(n){return n.search("drag")===0}},le=ae,oe={init:function(n){var t=n;oe.document=t.document,oe.DocumentFragment=t.DocumentFragment||He,oe.SVGElement=t.SVGElement||He,oe.SVGSVGElement=t.SVGSVGElement||He,oe.SVGElementInstance=t.SVGElementInstance||He,oe.Element=t.Element||He,oe.HTMLElement=t.HTMLElement||oe.Element,oe.Event=t.Event,oe.Touch=t.Touch||He,oe.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function He(){}var ve=oe,ye={init:function(n){var t=ve.Element,i=n.navigator||{};ye.supportsTouch="ontouchstart"in n||E.func(n.DocumentTouch)&&ve.document instanceof n.DocumentTouch,ye.supportsPointerEvent=i.pointerEnabled!==!1&&!!ve.PointerEvent,ye.isIOS=/iP(hone|od|ad)/.test(i.platform),ye.isIOS7=/iP(hone|od|ad)/.test(i.platform)&&/OS 7[^\d]/.test(i.appVersion),ye.isIe9=/MSIE 9/.test(i.userAgent),ye.isOperaMobile=i.appName==="Opera"&&ye.supportsTouch&&/Presto/.test(i.userAgent),ye.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",ye.pEventTypes=ye.supportsPointerEvent?ve.PointerEvent===n.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,ye.wheelEvent=ve.document&&"onmousewheel"in ve.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},ze=ye;function Ge(n,t){if(n.contains)return n.contains(t);for(;t;){if(t===n)return!0;t=t.parentNode}return!1}function Ct(n,t){for(;E.element(n);){if(Oe(n,t))return n;n=je(n)}return null}function je(n){var t=n.parentNode;if(E.docFrag(t)){for(;(t=t.host)&&E.docFrag(t););return t}return t}function Oe(n,t){return L!==A&&(t=t.replace(/\/deep\//g," ")),n[ze.prefixedMatchesSelector](t)}var Ne=function(n){return n.parentNode||n.host};function Bt(n,t){for(var i,o=[],s=n;(i=Ne(s))&&s!==t&&i!==s.ownerDocument;)o.unshift(s),s=i;return o}function gt(n,t,i){for(;E.element(n);){if(Oe(n,t))return!0;if((n=je(n))===i)return Oe(n,t)}return!1}function jt(n){return n.correspondingUseElement||n}function K(n){var t=n instanceof ve.SVGElement?n.getBoundingClientRect():n.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function Me(n){var t,i=K(n);if(!ze.isIOS7&&i){var o={x:(t=(t=q(n))||L).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};i.left+=o.x,i.right+=o.x,i.top+=o.y,i.bottom+=o.y}return i}function ie(n){for(var t=[];n;)t.push(n),n=je(n);return t}function Fe(n){return!!E.string(n)&&(ve.document.querySelector(n),!0)}function B(n,t){for(var i in t)n[i]=t[i];return n}function mt(n,t,i){return n==="parent"?je(i):n==="self"?t.getRect(i):Ct(i,n)}function we(n,t,i,o){var s=n;return E.string(s)?s=mt(s,t,i):E.func(s)&&(s=s.apply(void 0,o)),E.element(s)&&(s=Me(s)),s}function ct(n){return n&&{x:"x"in n?n.x:n.left,y:"y"in n?n.y:n.top}}function vt(n){return!n||"x"in n&&"y"in n||((n=B({},n)).x=n.left||0,n.y=n.top||0,n.width=n.width||(n.right||0)-n.x,n.height=n.height||(n.bottom||0)-n.y),n}function yt(n,t,i){n.left&&(t.left+=i.x),n.right&&(t.right+=i.x),n.top&&(t.top+=i.y),n.bottom&&(t.bottom+=i.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function Xe(n,t,i){var o=i&&n.options[i];return ct(we(o&&o.origin||n.options.origin,n,t,[n&&t]))||{x:0,y:0}}function Ye(n,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(v){return!0},o=arguments.length>3?arguments[3]:void 0;if(o=o||{},E.string(n)&&n.search(" ")!==-1&&(n=tn(n)),E.array(n))return n.forEach((function(v){return Ye(v,t,i,o)})),o;if(E.object(n)&&(t=n,n=""),E.func(t)&&i(n))o[n]=o[n]||[],o[n].push(t);else if(E.array(t))for(var s=0,c=t;s<c.length;s++){var p=c[s];Ye(n,p,i,o)}else if(E.object(t))for(var f in t)Ye(tn(f).map((function(v){return"".concat(n).concat(v)})),t[f],i,o);return o}function tn(n){return n.trim().split(/ +/)}var z=function(n,t){return Math.sqrt(n*n+t*t)},F=["webkit","moz"];function G(n,t){n.__set||(n.__set={});var i=function(s){if(F.some((function(c){return s.indexOf(c)===0})))return 1;typeof n[s]!="function"&&s!=="__set"&&Object.defineProperty(n,s,{get:function(){return s in n.__set?n.__set[s]:n.__set[s]=t[s]},set:function(c){n.__set[s]=c},configurable:!0})};for(var o in t)i(o);return n}function J(n,t){n.page=n.page||{},n.page.x=t.page.x,n.page.y=t.page.y,n.client=n.client||{},n.client.x=t.client.x,n.client.y=t.client.y,n.timeStamp=t.timeStamp}function te(n){n.page.x=0,n.page.y=0,n.client.x=0,n.client.y=0}function be(n){return n instanceof ve.Event||n instanceof ve.Touch}function Pe(n,t,i){return n=n||"page",(i=i||{}).x=t[n+"X"],i.y=t[n+"Y"],i}function $e(n,t){return t=t||{x:0,y:0},ze.isOperaMobile&&be(n)?(Pe("screen",n,t),t.x+=window.scrollX,t.y+=window.scrollY):Pe("page",n,t),t}function De(n){return E.number(n.pointerId)?n.pointerId:n.identifier}function N(n,t,i){var o=t.length>1?he(t):t[0];$e(o,n.page),(function(s,c){c=c||{},ze.isOperaMobile&&be(s)?Pe("screen",s,c):Pe("client",s,c)})(o,n.client),n.timeStamp=i}function ue(n){var t=[];return E.array(n)?(t[0]=n[0],t[1]=n[1]):n.type==="touchend"?n.touches.length===1?(t[0]=n.touches[0],t[1]=n.changedTouches[0]):n.touches.length===0&&(t[0]=n.changedTouches[0],t[1]=n.changedTouches[1]):(t[0]=n.touches[0],t[1]=n.touches[1]),t}function he(n){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},i=0;i<n.length;i++){var o=n[i];for(var s in t)t[s]+=o[s]}for(var c in t)t[c]/=n.length;return t}function Ue(n){if(!n.length)return null;var t=ue(n),i=Math.min(t[0].pageX,t[1].pageX),o=Math.min(t[0].pageY,t[1].pageY),s=Math.max(t[0].pageX,t[1].pageX),c=Math.max(t[0].pageY,t[1].pageY);return{x:i,y:o,left:i,top:o,right:s,bottom:c,width:s-i,height:c-o}}function pe(n,t){var i=t+"X",o=t+"Y",s=ue(n),c=s[0][i]-s[1][i],p=s[0][o]-s[1][o];return z(c,p)}function Se(n,t){var i=t+"X",o=t+"Y",s=ue(n),c=s[1][i]-s[0][i],p=s[1][o]-s[0][o];return 180*Math.atan2(p,c)/Math.PI}function Re(n){return E.string(n.pointerType)?n.pointerType:E.number(n.pointerType)?[void 0,void 0,"touch","pen","mouse"][n.pointerType]:/touch/.test(n.type||"")||n instanceof ve.Touch?"touch":"mouse"}function et(n){var t=E.func(n.composedPath)?n.composedPath():n.path;return[jt(t?t[0]:n.target),jt(n.currentTarget)]}var Ee=(function(){function n(t){d(this,n),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return u(n,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n})();Object.defineProperty(Ee.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var tt=function(n,t){for(var i=0;i<t.length;i++){var o=t[i];n.push(o)}return n},ge=function(n){return tt([],n)},xe=function(n,t){for(var i=0;i<n.length;i++)if(t(n[i],i,n))return i;return-1},Z=function(n,t){return n[xe(n,t)]},X=(function(n){m(i,n);var t=_(i);function i(o,s,c){var p;d(this,i),(p=t.call(this,s._interaction)).dropzone=void 0,p.dragEvent=void 0,p.relatedTarget=void 0,p.draggable=void 0,p.propagationStopped=!1,p.immediatePropagationStopped=!1;var f=c==="dragleave"?o.prev:o.cur,v=f.element,x=f.dropzone;return p.type=c,p.target=v,p.currentTarget=v,p.dropzone=x,p.dragEvent=s,p.relatedTarget=s.target,p.draggable=s.interactable,p.timeStamp=s.timeStamp,p}return u(i,[{key:"reject",value:function(){var o=this,s=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&s.cur.dropzone===this.dropzone&&s.cur.element===this.target)if(s.prev.dropzone=this.dropzone,s.prev.element=this.target,s.rejected=!0,s.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var c=s.activeDrops,p=xe(c,(function(v){var x=v.dropzone,y=v.element;return x===o.dropzone&&y===o.target}));s.activeDrops.splice(p,1);var f=new i(s,this.dragEvent,"dropdeactivate");f.dropzone=this.dropzone,f.target=this.target,this.dropzone.fire(f)}else this.dropzone.fire(new i(s,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),i})(Ee);function ce(n,t){for(var i=0,o=n.slice();i<o.length;i++){var s=o[i],c=s.dropzone,p=s.element;t.dropzone=c,t.target=p,c.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function Ie(n,t){for(var i=(function(c,p){for(var f=[],v=0,x=c.interactables.list;v<x.length;v++){var y=x[v];if(y.options.drop.enabled){var w=y.options.drop.accept;if(!(E.element(w)&&w!==p||E.string(w)&&!Oe(p,w)||E.func(w)&&!w({dropzone:y,draggableElement:p})))for(var C=0,P=y.getAllElements();C<P.length;C++){var O=P[C];O!==p&&f.push({dropzone:y,element:O,rect:y.getRect(O)})}}}return f})(n,t),o=0;o<i.length;o++){var s=i[o];s.rect=s.dropzone.getRect(s.element)}return i}function Ke(n,t,i){for(var o=n.dropState,s=n.interactable,c=n.element,p=[],f=0,v=o.activeDrops;f<v.length;f++){var x=v[f],y=x.dropzone,w=x.element,C=x.rect,P=y.dropCheck(t,i,s,c,w,C);p.push(P?w:null)}var O=(function(I){for(var R,D,H,V=[],ee=0;ee<I.length;ee++){var U=I[ee],Q=I[R];if(U&&ee!==R)if(Q){var Ae=Ne(U),se=Ne(Q);if(Ae!==U.ownerDocument)if(se!==U.ownerDocument)if(Ae!==se){V=V.length?V:Bt(Q);var Be=void 0;if(Q instanceof ve.HTMLElement&&U instanceof ve.SVGElement&&!(U instanceof ve.SVGSVGElement)){if(U===se)continue;Be=U.ownerSVGElement}else Be=U;for(var qe=Bt(Be,Q.ownerDocument),Qe=0;qe[Qe]&&qe[Qe]===V[Qe];)Qe++;var Gt=[qe[Qe-1],qe[Qe],V[Qe]];if(Gt[0])for(var It=Gt[0].lastChild;It;){if(It===Gt[1]){R=ee,V=qe;break}if(It===Gt[2])break;It=It.previousSibling}}else H=Q,(parseInt(q(D=U).getComputedStyle(D).zIndex,10)||0)>=(parseInt(q(H).getComputedStyle(H).zIndex,10)||0)&&(R=ee);else R=ee}else R=ee}return R})(p);return o.activeDrops[O]||null}function nt(n,t,i){var o=n.dropState,s={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return i.type==="dragstart"&&(s.activate=new X(o,i,"dropactivate"),s.activate.target=null,s.activate.dropzone=null),i.type==="dragend"&&(s.deactivate=new X(o,i,"dropdeactivate"),s.deactivate.target=null,s.deactivate.dropzone=null),o.rejected||(o.cur.element!==o.prev.element&&(o.prev.dropzone&&(s.leave=new X(o,i,"dragleave"),i.dragLeave=s.leave.target=o.prev.element,i.prevDropzone=s.leave.dropzone=o.prev.dropzone),o.cur.dropzone&&(s.enter=new X(o,i,"dragenter"),i.dragEnter=o.cur.element,i.dropzone=o.cur.dropzone)),i.type==="dragend"&&o.cur.dropzone&&(s.drop=new X(o,i,"drop"),i.dropzone=o.cur.dropzone,i.relatedTarget=o.cur.element),i.type==="dragmove"&&o.cur.dropzone&&(s.move=new X(o,i,"dropmove"),i.dropzone=o.cur.dropzone)),s}function bt(n,t){var i=n.dropState,o=i.activeDrops,s=i.cur,c=i.prev;t.leave&&c.dropzone.fire(t.leave),t.enter&&s.dropzone.fire(t.enter),t.move&&s.dropzone.fire(t.move),t.drop&&s.dropzone.fire(t.drop),t.deactivate&&ce(o,t.deactivate),i.prev.dropzone=s.dropzone,i.prev.element=s.element}function xt(n,t){var i=n.interaction,o=n.iEvent,s=n.event;if(o.type==="dragmove"||o.type==="dragend"){var c=i.dropState;t.dynamicDrop&&(c.activeDrops=Ie(t,i.element));var p=o,f=Ke(i,p,s);c.rejected=c.rejected&&!!f&&f.dropzone===c.cur.dropzone&&f.element===c.cur.element,c.cur.dropzone=f&&f.dropzone,c.cur.element=f&&f.element,c.events=nt(i,0,p)}}var zn={id:"actions/drop",install:function(n){var t=n.actions,i=n.interactStatic,o=n.Interactable,s=n.defaults;n.usePlugin(le),o.prototype.dropzone=function(c){return(function(p,f){if(E.object(f)){if(p.options.drop.enabled=f.enabled!==!1,f.listeners){var v=Ye(f.listeners),x=Object.keys(v).reduce((function(w,C){return w[/^(enter|leave)/.test(C)?"drag".concat(C):/^(activate|deactivate|move)/.test(C)?"drop".concat(C):C]=v[C],w}),{}),y=p.options.drop.listeners;y&&p.off(y),p.on(x),p.options.drop.listeners=x}return E.func(f.ondrop)&&p.on("drop",f.ondrop),E.func(f.ondropactivate)&&p.on("dropactivate",f.ondropactivate),E.func(f.ondropdeactivate)&&p.on("dropdeactivate",f.ondropdeactivate),E.func(f.ondragenter)&&p.on("dragenter",f.ondragenter),E.func(f.ondragleave)&&p.on("dragleave",f.ondragleave),E.func(f.ondropmove)&&p.on("dropmove",f.ondropmove),/^(pointer|center)$/.test(f.overlap)?p.options.drop.overlap=f.overlap:E.number(f.overlap)&&(p.options.drop.overlap=Math.max(Math.min(1,f.overlap),0)),"accept"in f&&(p.options.drop.accept=f.accept),"checker"in f&&(p.options.drop.checker=f.checker),p}return E.bool(f)?(p.options.drop.enabled=f,p):p.options.drop})(this,c)},o.prototype.dropCheck=function(c,p,f,v,x,y){return(function(w,C,P,O,I,R,D){var H=!1;if(!(D=D||w.getRect(R)))return!!w.options.drop.checker&&w.options.drop.checker(C,P,H,w,R,O,I);var V=w.options.drop.overlap;if(V==="pointer"){var ee=Xe(O,I,"drag"),U=$e(C);U.x+=ee.x,U.y+=ee.y;var Q=U.x>D.left&&U.x<D.right,Ae=U.y>D.top&&U.y<D.bottom;H=Q&&Ae}var se=O.getRect(I);if(se&&V==="center"){var Be=se.left+se.width/2,qe=se.top+se.height/2;H=Be>=D.left&&Be<=D.right&&qe>=D.top&&qe<=D.bottom}return se&&E.number(V)&&(H=Math.max(0,Math.min(D.right,se.right)-Math.max(D.left,se.left))*Math.max(0,Math.min(D.bottom,se.bottom)-Math.max(D.top,se.top))/(se.width*se.height)>=V),w.options.drop.checker&&(H=w.options.drop.checker(C,P,H,w,R,O,I)),H})(this,c,p,f,v,x,y)},i.dynamicDrop=function(c){return E.bool(c)?(n.dynamicDrop=c,i):n.dynamicDrop},B(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",n.dynamicDrop=!1,s.actions.drop=zn.defaults},listeners:{"interactions:before-action-start":function(n){var t=n.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(n,t){var i=n.interaction,o=(n.event,n.iEvent);if(i.prepared.name==="drag"){var s=i.dropState;s.activeDrops=[],s.events={},s.activeDrops=Ie(t,i.element),s.events=nt(i,0,o),s.events.activate&&(ce(s.activeDrops,s.events.activate),t.fire("actions/drop:start",{interaction:i,dragEvent:o}))}},"interactions:action-move":xt,"interactions:after-action-move":function(n,t){var i=n.interaction,o=n.iEvent;if(i.prepared.name==="drag"){var s=i.dropState;bt(i,s.events),t.fire("actions/drop:move",{interaction:i,dragEvent:o}),s.events={}}},"interactions:action-end":function(n,t){if(n.interaction.prepared.name==="drag"){var i=n.interaction,o=n.iEvent;xt(n,t),bt(i,i.dropState.events),t.fire("actions/drop:end",{interaction:i,dragEvent:o})}},"interactions:stop":function(n){var t=n.interaction;if(t.prepared.name==="drag"){var i=t.dropState;i&&(i.activeDrops=null,i.events=null,i.cur.dropzone=null,i.cur.element=null,i.prev.dropzone=null,i.prev.element=null,i.rejected=!1)}}},getActiveDrops:Ie,getDrop:Ke,getDropEvents:nt,fireDropEvents:bt,filterEventType:function(n){return n.search("drag")===0||n.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},br=zn;function nn(n){var t=n.interaction,i=n.iEvent,o=n.phase;if(t.prepared.name==="gesture"){var s=t.pointers.map((function(x){return x.pointer})),c=o==="start",p=o==="end",f=t.interactable.options.deltaSource;if(i.touches=[s[0],s[1]],c)i.distance=pe(s,f),i.box=Ue(s),i.scale=1,i.ds=0,i.angle=Se(s,f),i.da=0,t.gesture.startDistance=i.distance,t.gesture.startAngle=i.angle;else if(p||t.pointers.length<2){var v=t.prevEvent;i.distance=v.distance,i.box=v.box,i.scale=v.scale,i.ds=0,i.angle=v.angle,i.da=0}else i.distance=pe(s,f),i.box=Ue(s),i.scale=i.distance/t.gesture.startDistance,i.angle=Se(s,f),i.ds=i.scale-t.gesture.scale,i.da=i.angle-t.gesture.angle;t.gesture.distance=i.distance,t.gesture.angle=i.angle,E.number(i.scale)&&i.scale!==1/0&&!isNaN(i.scale)&&(t.gesture.scale=i.scale)}}var rn={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(n){var t=n.actions,i=n.Interactable,o=n.defaults;i.prototype.gesturable=function(s){return E.object(s)?(this.options.gesture.enabled=s.enabled!==!1,this.setPerAction("gesture",s),this.setOnEvents("gesture",s),this):E.bool(s)?(this.options.gesture.enabled=s,this):this.options.gesture},t.map.gesture=rn,t.methodDict.gesture="gesturable",o.actions.gesture=rn.defaults},listeners:{"interactions:action-start":nn,"interactions:action-move":nn,"interactions:action-end":nn,"interactions:new":function(n){n.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(n){if(!(n.interaction.pointers.length<2)){var t=n.interactable.options.gesture;if(t&&t.enabled)return n.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(n){return n.search("gesture")===0}},xr=rn;function _r(n,t,i,o,s,c,p){if(!t)return!1;if(t===!0){var f=E.number(c.width)?c.width:c.right-c.left,v=E.number(c.height)?c.height:c.bottom-c.top;if(p=Math.min(p,Math.abs((n==="left"||n==="right"?f:v)/2)),f<0&&(n==="left"?n="right":n==="right"&&(n="left")),v<0&&(n==="top"?n="bottom":n==="bottom"&&(n="top")),n==="left"){var x=f>=0?c.left:c.right;return i.x<x+p}if(n==="top"){var y=v>=0?c.top:c.bottom;return i.y<y+p}if(n==="right")return i.x>(f>=0?c.right:c.left)-p;if(n==="bottom")return i.y>(v>=0?c.bottom:c.top)-p}return!!E.element(o)&&(E.element(t)?t===o:gt(o,t,s))}function Fn(n){var t=n.iEvent,i=n.interaction;if(i.prepared.name==="resize"&&i.resizeAxes){var o=t;i.interactable.options.resize.square?(i.resizeAxes==="y"?o.delta.x=o.delta.y:o.delta.y=o.delta.x,o.axes="xy"):(o.axes=i.resizeAxes,i.resizeAxes==="x"?o.delta.y=0:i.resizeAxes==="y"&&(o.delta.x=0))}}var Ve,dt,Je={id:"actions/resize",before:["actions/drag"],install:function(n){var t=n.actions,i=n.browser,o=n.Interactable,s=n.defaults;Je.cursors=(function(c){return c.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(i),Je.defaultMargin=i.supportsTouch||i.supportsPointerEvent?20:10,o.prototype.resizable=function(c){return(function(p,f,v){return E.object(f)?(p.options.resize.enabled=f.enabled!==!1,p.setPerAction("resize",f),p.setOnEvents("resize",f),E.string(f.axis)&&/^x$|^y$|^xy$/.test(f.axis)?p.options.resize.axis=f.axis:f.axis===null&&(p.options.resize.axis=v.defaults.actions.resize.axis),E.bool(f.preserveAspectRatio)?p.options.resize.preserveAspectRatio=f.preserveAspectRatio:E.bool(f.square)&&(p.options.resize.square=f.square),p):E.bool(f)?(p.options.resize.enabled=f,p):p.options.resize})(this,c,n)},t.map.resize=Je,t.methodDict.resize="resizable",s.actions.resize=Je.defaults},listeners:{"interactions:new":function(n){n.interaction.resizeAxes="xy"},"interactions:action-start":function(n){(function(t){var i=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=i,c=o.rect;o._rects={start:B({},c),corrected:B({},c),previous:B({},c),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},s.edges=o.prepared.edges,s.rect=o._rects.corrected,s.deltaRect=o._rects.delta}})(n),Fn(n)},"interactions:action-move":function(n){(function(t){var i=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=i,c=o.interactable.options.resize.invert,p=c==="reposition"||c==="negate",f=o.rect,v=o._rects,x=v.start,y=v.corrected,w=v.delta,C=v.previous;if(B(C,y),p){if(B(y,f),c==="reposition"){if(y.top>y.bottom){var P=y.top;y.top=y.bottom,y.bottom=P}if(y.left>y.right){var O=y.left;y.left=y.right,y.right=O}}}else y.top=Math.min(f.top,x.bottom),y.bottom=Math.max(f.bottom,x.top),y.left=Math.min(f.left,x.right),y.right=Math.max(f.right,x.left);for(var I in y.width=y.right-y.left,y.height=y.bottom-y.top,y)w[I]=y[I]-C[I];s.edges=o.prepared.edges,s.rect=y,s.deltaRect=w}})(n),Fn(n)},"interactions:action-end":function(n){var t=n.iEvent,i=n.interaction;if(i.prepared.name==="resize"&&i.prepared.edges){var o=t;o.edges=i.prepared.edges,o.rect=i._rects.corrected,o.deltaRect=i._rects.delta}},"auto-start:check":function(n){var t=n.interaction,i=n.interactable,o=n.element,s=n.rect,c=n.buttons;if(s){var p=B({},t.coords.cur.page),f=i.options.resize;if(f&&f.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(c&f.mouseButtons)!=0)){if(E.object(f.edges)){var v={left:!1,right:!1,top:!1,bottom:!1};for(var x in v)v[x]=_r(x,f.edges[x],p,t._latestPointer.eventTarget,o,s,f.margin||Je.defaultMargin);v.left=v.left&&!v.right,v.top=v.top&&!v.bottom,(v.left||v.right||v.top||v.bottom)&&(n.action={name:"resize",edges:v})}else{var y=f.axis!=="y"&&p.x>s.right-Je.defaultMargin,w=f.axis!=="x"&&p.y>s.bottom-Je.defaultMargin;(y||w)&&(n.action={name:"resize",axes:(y?"x":"")+(w?"y":"")})}return!n.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(n){var t=n.edges,i=n.axis,o=n.name,s=Je.cursors,c=null;if(i)c=s[o+i];else if(t){for(var p="",f=0,v=["top","bottom","left","right"];f<v.length;f++){var x=v[f];t[x]&&(p+=x)}c=s[p]}return c},filterEventType:function(n){return n.search("resize")===0},defaultMargin:null},wr=Je,Sr={id:"actions",install:function(n){n.usePlugin(xr),n.usePlugin(wr),n.usePlugin(le),n.usePlugin(br)}},Dn=0,it={request:function(n){return Ve(n)},cancel:function(n){return dt(n)},init:function(n){if(Ve=n.requestAnimationFrame,dt=n.cancelAnimationFrame,!Ve)for(var t=["ms","moz","webkit","o"],i=0;i<t.length;i++){var o=t[i];Ve=n["".concat(o,"RequestAnimationFrame")],dt=n["".concat(o,"CancelAnimationFrame")]||n["".concat(o,"CancelRequestAnimationFrame")]}Ve=Ve&&Ve.bind(n),dt=dt&&dt.bind(n),Ve||(Ve=function(s){var c=Date.now(),p=Math.max(0,16-(c-Dn)),f=n.setTimeout((function(){s(c+p)}),p);return Dn=c+p,f},dt=function(s){return clearTimeout(s)})}},W={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(n){W.isScrolling=!0,it.cancel(W.i),n.autoScroll=W,W.interaction=n,W.prevTime=W.now(),W.i=it.request(W.scroll)},stop:function(){W.isScrolling=!1,W.interaction&&(W.interaction.autoScroll=null),it.cancel(W.i)},scroll:function(){var n=W.interaction,t=n.interactable,i=n.element,o=n.prepared.name,s=t.options[o].autoScroll,c=Rn(s.container,t,i),p=W.now(),f=(p-W.prevTime)/1e3,v=s.speed*f;if(v>=1){var x={x:W.x*v,y:W.y*v};if(x.x||x.y){var y=Bn(c);E.window(c)?c.scrollBy(x.x,x.y):c&&(c.scrollLeft+=x.x,c.scrollTop+=x.y);var w=Bn(c),C={x:w.x-y.x,y:w.y-y.y};(C.x||C.y)&&t.fire({type:"autoscroll",target:i,interactable:t,delta:C,interaction:n,container:c})}W.prevTime=p}W.isScrolling&&(it.cancel(W.i),W.i=it.request(W.scroll))},check:function(n,t){var i;return(i=n.options[t].autoScroll)==null?void 0:i.enabled},onInteractionMove:function(n){var t=n.interaction,i=n.pointer;if(t.interacting()&&W.check(t.interactable,t.prepared.name))if(t.simulation)W.x=W.y=0;else{var o,s,c,p,f=t.interactable,v=t.element,x=t.prepared.name,y=f.options[x].autoScroll,w=Rn(y.container,f,v);if(E.window(w))p=i.clientX<W.margin,o=i.clientY<W.margin,s=i.clientX>w.innerWidth-W.margin,c=i.clientY>w.innerHeight-W.margin;else{var C=K(w);p=i.clientX<C.left+W.margin,o=i.clientY<C.top+W.margin,s=i.clientX>C.right-W.margin,c=i.clientY>C.bottom-W.margin}W.x=s?1:p?-1:0,W.y=c?1:o?-1:0,W.isScrolling||(W.margin=y.margin,W.speed=y.speed,W.start(t))}}};function Rn(n,t,i){return(E.string(n)?mt(n,t,i):n)||q(i)}function Bn(n){return E.window(n)&&(n=window.document.body),{x:n.scrollLeft,y:n.scrollTop}}var kr={id:"auto-scroll",install:function(n){var t=n.defaults,i=n.actions;n.autoScroll=W,W.now=function(){return n.now()},i.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=W.defaults},listeners:{"interactions:new":function(n){n.interaction.autoScroll=null},"interactions:destroy":function(n){n.interaction.autoScroll=null,W.stop(),W.interaction&&(W.interaction=null)},"interactions:stop":W.stop,"interactions:action-move":function(n){return W.onInteractionMove(n)}}},Er=kr;function At(n,t){var i=!1;return function(){return i||(L.console.warn(t),i=!0),n.apply(this,arguments)}}function on(n,t){return n.name=t.name,n.axis=t.axis,n.edges=t.edges,n}function Cr(n){return E.bool(n)?(this.options.styleCursor=n,this):n===null?(delete this.options.styleCursor,this):this.options.styleCursor}function Ar(n){return E.func(n)?(this.options.actionChecker=n,this):n===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Tr={id:"auto-start/interactableMethods",install:function(n){var t=n.Interactable;t.prototype.getAction=function(i,o,s,c){var p=(function(f,v,x,y,w){var C=f.getRect(y),P=v.buttons||{0:1,1:4,3:8,4:16}[v.button],O={action:null,interactable:f,interaction:x,element:y,rect:C,buttons:P};return w.fire("auto-start:check",O),O.action})(this,o,s,c,n);return this.options.actionChecker?this.options.actionChecker(i,o,p,this,c,s):p},t.prototype.ignoreFrom=At((function(i){return this._backCompatOption("ignoreFrom",i)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=At((function(i){return this._backCompatOption("allowFrom",i)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Ar,t.prototype.styleCursor=Cr}};function jn(n,t,i,o,s){return t.testIgnoreAllow(t.options[n.name],i,o)&&t.options[n.name].enabled&&Nt(t,i,n,s)?n:null}function Or(n,t,i,o,s,c,p){for(var f=0,v=o.length;f<v;f++){var x=o[f],y=s[f],w=x.getAction(t,i,n,y);if(w){var C=jn(w,x,y,c,p);if(C)return{action:C,interactable:x,element:y}}}return{action:null,interactable:null,element:null}}function Nn(n,t,i,o,s){var c=[],p=[],f=o;function v(y){c.push(y),p.push(f)}for(;E.element(f);){c=[],p=[],s.interactables.forEachMatch(f,v);var x=Or(n,t,i,c,p,o,s);if(x.action&&!x.interactable.options[x.action.name].manualStart)return x;f=je(f)}return{action:null,interactable:null,element:null}}function qn(n,t,i){var o=t.action,s=t.interactable,c=t.element;o=o||{name:null},n.interactable=s,n.element=c,on(n.prepared,o),n.rect=s&&o.name?s.getRect(c):null,Yn(n,i),i.fire("autoStart:prepared",{interaction:n})}function Nt(n,t,i,o){var s=n.options,c=s[i.name].max,p=s[i.name].maxPerElement,f=o.autoStart.maxInteractions,v=0,x=0,y=0;if(!(c&&p&&f))return!1;for(var w=0,C=o.interactions.list;w<C.length;w++){var P=C[w],O=P.prepared.name;if(P.interacting()&&(++v>=f||P.interactable===n&&((x+=O===i.name?1:0)>=c||P.element===t&&(y++,O===i.name&&y>=p))))return!1}return f>0}function Hn(n,t){return E.number(n)?(t.autoStart.maxInteractions=n,this):t.autoStart.maxInteractions}function an(n,t,i){var o=i.autoStart.cursorElement;o&&o!==n&&(o.style.cursor=""),n.ownerDocument.documentElement.style.cursor=t,n.style.cursor=t,i.autoStart.cursorElement=t?n:null}function Yn(n,t){var i=n.interactable,o=n.element,s=n.prepared;if(n.pointerType==="mouse"&&i&&i.options.styleCursor){var c="";if(s.name){var p=i.options[s.name].cursorChecker;c=E.func(p)?p(s,i,o,n._interacting):t.actions.map[s.name].getCursor(s)}an(n.element,c||"",t)}else t.autoStart.cursorElement&&an(t.autoStart.cursorElement,"",t)}var Mr={id:"auto-start/base",before:["actions"],install:function(n){var t=n.interactStatic,i=n.defaults;n.usePlugin(Tr),i.base.actionChecker=null,i.base.styleCursor=!0,B(i.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(o){return Hn(o,n)},n.autoStart={maxInteractions:1/0,withinInteractionLimit:Nt,cursorElement:null}},listeners:{"interactions:down":function(n,t){var i=n.interaction,o=n.pointer,s=n.event,c=n.eventTarget;i.interacting()||qn(i,Nn(i,o,s,c,t),t)},"interactions:move":function(n,t){(function(i,o){var s=i.interaction,c=i.pointer,p=i.event,f=i.eventTarget;s.pointerType!=="mouse"||s.pointerIsDown||s.interacting()||qn(s,Nn(s,c,p,f,o),o)})(n,t),(function(i,o){var s=i.interaction;if(s.pointerIsDown&&!s.interacting()&&s.pointerWasMoved&&s.prepared.name){o.fire("autoStart:before-start",i);var c=s.interactable,p=s.prepared.name;p&&c&&(c.options[p].manualStart||!Nt(c,s.element,s.prepared,o)?s.stop():(s.start(s.prepared,c,s.element),Yn(s,o)))}})(n,t)},"interactions:stop":function(n,t){var i=n.interaction,o=i.interactable;o&&o.options.styleCursor&&an(i.element,"",t)}},maxInteractions:Hn,withinInteractionLimit:Nt,validateAction:jn},sn=Mr,Pr={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(n,t){var i=n.interaction,o=n.eventTarget,s=n.dx,c=n.dy;if(i.prepared.name==="drag"){var p=Math.abs(s),f=Math.abs(c),v=i.interactable.options.drag,x=v.startAxis,y=p>f?"x":p<f?"y":"xy";if(i.prepared.axis=v.lockAxis==="start"?y[0]:v.lockAxis,y!=="xy"&&x!=="xy"&&x!==y){i.prepared.name=null;for(var w=o,C=function(O){if(O!==i.interactable){var I=i.interactable.options.drag;if(!I.manualStart&&O.testIgnoreAllow(I,w,o)){var R=O.getAction(i.downPointer,i.downEvent,i,w);if(R&&R.name==="drag"&&(function(D,H){if(!H)return!1;var V=H.options.drag.startAxis;return D==="xy"||V==="xy"||V===D})(y,O)&&sn.validateAction(R,O,w,o,t))return O}}};E.element(w);){var P=t.interactables.forEachMatch(w,C);if(P){i.prepared.name="drag",i.interactable=P,i.element=w;break}w=je(w)}}}}}};function ln(n){var t=n.prepared&&n.prepared.name;if(!t)return null;var i=n.interactable.options;return i[t].hold||i[t].delay}var Ir={id:"auto-start/hold",install:function(n){var t=n.defaults;n.usePlugin(sn),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(n){n.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(n){var t=n.interaction,i=ln(t);i>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),i))},"interactions:move":function(n){var t=n.interaction,i=n.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!i&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(n){var t=n.interaction;ln(t)>0&&(t.prepared.name=null)}},getHoldDuration:ln},Lr=Ir,zr={id:"auto-start",install:function(n){n.usePlugin(sn),n.usePlugin(Lr),n.usePlugin(Pr)}},Fr=function(n){return/^(always|never|auto)$/.test(n)?(this.options.preventDefault=n,this):E.bool(n)?(this.options.preventDefault=n?"always":"never",this):this.options.preventDefault};function Dr(n){var t=n.interaction,i=n.event;t.interactable&&t.interactable.checkAndPreventDefault(i)}var $n={id:"core/interactablePreventDefault",install:function(n){var t=n.Interactable;t.prototype.preventDefault=Fr,t.prototype.checkAndPreventDefault=function(i){return(function(o,s,c){var p=o.options.preventDefault;if(p!=="never")if(p!=="always"){if(s.events.supportsPassive&&/^touch(start|move)$/.test(c.type)){var f=q(c.target).document,v=s.getDocOptions(f);if(!v||!v.events||v.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(c.type)||E.element(c.target)&&Oe(c.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||c.preventDefault()}else c.preventDefault()})(this,n,i)},n.interactions.docEvents.push({type:"dragstart",listener:function(i){for(var o=0,s=n.interactions.list;o<s.length;o++){var c=s[o];if(c.element&&(c.element===i.target||Ge(c.element,i.target)))return void c.interactable.checkAndPreventDefault(i)}}})},listeners:["down","move","up","cancel"].reduce((function(n,t){return n["interactions:".concat(t)]=Dr,n}),{})};function qt(n,t){if(t.phaselessTypes[n])return!0;for(var i in t.map)if(n.indexOf(i)===0&&n.substr(i.length)in t.phases)return!0;return!1}function _t(n){var t={};for(var i in n){var o=n[i];E.plainObject(o)?t[i]=_t(o):E.array(o)?t[i]=ge(o):t[i]=o}return t}var cn=(function(){function n(t){d(this,n),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=Ht(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return u(n,[{key:"start",value:function(t,i){var o,s,c=t.phase,p=this.interaction,f=(function(x){var y=x.interactable.options[x.prepared.name],w=y.modifiers;return w&&w.length?w:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(C){var P=y[C];return P&&P.enabled&&{options:P,methods:P._methods}})).filter((function(C){return!!C}))})(p);this.prepareStates(f),this.startEdges=B({},p.edges),this.edges=B({},this.startEdges),this.startOffset=(o=p.rect,s=i,o?{left:s.x-o.left,top:s.y-o.top,right:o.right-s.x,bottom:o.bottom-s.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var v=this.fillArg({phase:c,pageCoords:i,preEnd:!1});return this.result=Ht(),this.startAll(v),this.result=this.setAll(v)}},{key:"fillArg",value:function(t){var i=this.interaction;return t.interaction=i,t.interactable=i.interactable,t.element=i.element,t.rect||(t.rect=i.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var i=0,o=this.states;i<o.length;i++){var s=o[i];s.methods.start&&(t.state=s,s.methods.start(t))}}},{key:"setAll",value:function(t){var i=t.phase,o=t.preEnd,s=t.skipModifiers,c=t.rect,p=t.edges;t.coords=B({},t.pageCoords),t.rect=B({},c),t.edges=B({},p);for(var f=s?this.states.slice(s):this.states,v=Ht(t.coords,t.rect),x=0;x<f.length;x++){var y,w=f[x],C=w.options,P=B({},t.coords),O=null;(y=w.methods)!=null&&y.set&&this.shouldDo(C,o,i)&&(t.state=w,O=w.methods.set(t),yt(t.edges,t.rect,{x:t.coords.x-P.x,y:t.coords.y-P.y})),v.eventProps.push(O)}B(this.edges,t.edges),v.delta.x=t.coords.x-t.pageCoords.x,v.delta.y=t.coords.y-t.pageCoords.y,v.rectDelta.left=t.rect.left-c.left,v.rectDelta.right=t.rect.right-c.right,v.rectDelta.top=t.rect.top-c.top,v.rectDelta.bottom=t.rect.bottom-c.bottom;var I=this.result.coords,R=this.result.rect;if(I&&R){var D=v.rect.left!==R.left||v.rect.right!==R.right||v.rect.top!==R.top||v.rect.bottom!==R.bottom;v.changed=D||I.x!==v.coords.x||I.y!==v.coords.y}return v}},{key:"applyToInteraction",value:function(t){var i=this.interaction,o=t.phase,s=i.coords.cur,c=i.coords.start,p=this.result,f=this.startDelta,v=p.delta;o==="start"&&B(this.startDelta,p.delta);for(var x=0,y=[[c,f],[s,v]];x<y.length;x++){var w=y[x],C=w[0],P=w[1];C.page.x+=P.x,C.page.y+=P.y,C.client.x+=P.x,C.client.y+=P.y}var O=this.result.rectDelta,I=t.rect||i.rect;I.left+=O.left,I.right+=O.right,I.top+=O.top,I.bottom+=O.bottom,I.width=I.right-I.left,I.height=I.bottom-I.top}},{key:"setAndApply",value:function(t){var i=this.interaction,o=t.phase,s=t.preEnd,c=t.skipModifiers,p=this.setAll(this.fillArg({preEnd:s,phase:o,pageCoords:t.modifiedCoords||i.coords.cur.page}));if(this.result=p,!p.changed&&(!c||c<this.states.length)&&i.interacting())return!1;if(t.modifiedCoords){var f=i.coords.cur.page,v={x:t.modifiedCoords.x-f.x,y:t.modifiedCoords.y-f.y};p.coords.x+=v.x,p.coords.y+=v.y,p.delta.x+=v.x,p.delta.y+=v.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var i=t.interaction,o=t.event,s=this.states;if(s&&s.length){for(var c=!1,p=0;p<s.length;p++){var f=s[p];t.state=f;var v=f.options,x=f.methods,y=x.beforeEnd&&x.beforeEnd(t);if(y)return this.endResult=y,!1;c=c||!c&&this.shouldDo(v,!0,t.phase,!0)}c&&i.move({event:o,preEnd:!0})}}},{key:"stop",value:function(t){var i=t.interaction;if(this.states&&this.states.length){var o=B({states:this.states,interactable:i.interactable,element:i.element,rect:null},t);this.fillArg(o);for(var s=0,c=this.states;s<c.length;s++){var p=c[s];o.state=p,p.methods.stop&&p.methods.stop(o)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var i=0;i<t.length;i++){var o=t[i],s=o.options,c=o.methods,p=o.name;this.states.push({options:s,methods:c,index:i,name:p})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var i=t.interaction,o=i.coords,s=i.rect,c=i.modification;if(c.result){for(var p=c.startDelta,f=c.result,v=f.delta,x=f.rectDelta,y=0,w=[[o.start,p],[o.cur,v]];y<w.length;y++){var C=w[y],P=C[0],O=C[1];P.page.x-=O.x,P.page.y-=O.y,P.client.x-=O.x,P.client.y-=O.y}s.left-=x.left,s.right-=x.right,s.top-=x.top,s.bottom-=x.bottom}}},{key:"shouldDo",value:function(t,i,o,s){return!(!t||t.enabled===!1||s&&!t.endOnly||t.endOnly&&!i||o==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(i){return _t(i)})),this.result=Ht(B({},t.result.coords),B({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),n})();function Ht(n,t){return{rect:t,coords:n,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function rt(n,t){var i=n.defaults,o={start:n.start,set:n.set,beforeEnd:n.beforeEnd,stop:n.stop},s=function(c){var p=c||{};for(var f in p.enabled=p.enabled!==!1,i)f in p||(p[f]=i[f]);var v={options:p,methods:o,name:t,enable:function(){return p.enabled=!0,v},disable:function(){return p.enabled=!1,v}};return v};return t&&typeof t=="string"&&(s._defaults=i,s._methods=o),s}function Tt(n){var t=n.iEvent,i=n.interaction.modification.result;i&&(t.modifiers=i.eventProps)}var Rr={id:"modifiers/base",before:["actions"],install:function(n){n.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(n){var t=n.interaction;t.modification=new cn(t)},"interactions:before-action-start":function(n){var t=n.interaction,i=n.interaction.modification;i.start(n,t.coords.start.page),t.edges=i.edges,i.applyToInteraction(n)},"interactions:before-action-move":function(n){var t=n.interaction,i=t.modification,o=i.setAndApply(n);return t.edges=i.edges,o},"interactions:before-action-end":function(n){var t=n.interaction,i=t.modification,o=i.beforeEnd(n);return t.edges=i.startEdges,o},"interactions:action-start":Tt,"interactions:action-move":Tt,"interactions:action-end":Tt,"interactions:after-action-start":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-move":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:stop":function(n){return n.interaction.modification.stop(n)}}},Un=Rr,Kn={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},dn=(function(n){m(i,n);var t=_(i);function i(o,s,c,p,f,v,x){var y;d(this,i),(y=t.call(this,o)).relatedTarget=null,y.screenX=void 0,y.screenY=void 0,y.button=void 0,y.buttons=void 0,y.ctrlKey=void 0,y.shiftKey=void 0,y.altKey=void 0,y.metaKey=void 0,y.page=void 0,y.client=void 0,y.delta=void 0,y.rect=void 0,y.x0=void 0,y.y0=void 0,y.t0=void 0,y.dt=void 0,y.duration=void 0,y.clientX0=void 0,y.clientY0=void 0,y.velocity=void 0,y.speed=void 0,y.swipe=void 0,y.axes=void 0,y.preEnd=void 0,f=f||o.element;var w=o.interactable,C=(w&&w.options||Kn).deltaSource,P=Xe(w,f,c),O=p==="start",I=p==="end",R=O?S(y):o.prevEvent,D=O?o.coords.start:I?{page:R.page,client:R.client,timeStamp:o.coords.cur.timeStamp}:o.coords.cur;return y.page=B({},D.page),y.client=B({},D.client),y.rect=B({},o.rect),y.timeStamp=D.timeStamp,I||(y.page.x-=P.x,y.page.y-=P.y,y.client.x-=P.x,y.client.y-=P.y),y.ctrlKey=s.ctrlKey,y.altKey=s.altKey,y.shiftKey=s.shiftKey,y.metaKey=s.metaKey,y.button=s.button,y.buttons=s.buttons,y.target=f,y.currentTarget=f,y.preEnd=v,y.type=x||c+(p||""),y.interactable=w,y.t0=O?o.pointers[o.pointers.length-1].downTime:R.t0,y.x0=o.coords.start.page.x-P.x,y.y0=o.coords.start.page.y-P.y,y.clientX0=o.coords.start.client.x-P.x,y.clientY0=o.coords.start.client.y-P.y,y.delta=O||I?{x:0,y:0}:{x:y[C].x-R[C].x,y:y[C].y-R[C].y},y.dt=o.coords.delta.timeStamp,y.duration=y.timeStamp-y.t0,y.velocity=B({},o.coords.velocity[C]),y.speed=z(y.velocity.x,y.velocity.y),y.swipe=I||p==="inertiastart"?y.getSwipe():null,y}return u(i,[{key:"getSwipe",value:function(){var o=this._interaction;if(o.prevEvent.speed<600||this.timeStamp-o.prevEvent.timeStamp>150)return null;var s=180*Math.atan2(o.prevEvent.velocityY,o.prevEvent.velocityX)/Math.PI;s<0&&(s+=360);var c=112.5<=s&&s<247.5,p=202.5<=s&&s<337.5;return{up:p,down:!p&&22.5<=s&&s<157.5,left:c,right:!c&&(292.5<=s||s<67.5),angle:s,speed:o.prevEvent.speed,velocity:{x:o.prevEvent.velocityX,y:o.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),i})(Ee);Object.defineProperties(dn.prototype,{pageX:{get:function(){return this.page.x},set:function(n){this.page.x=n}},pageY:{get:function(){return this.page.y},set:function(n){this.page.y=n}},clientX:{get:function(){return this.client.x},set:function(n){this.client.x=n}},clientY:{get:function(){return this.client.y},set:function(n){this.client.y=n}},dx:{get:function(){return this.delta.x},set:function(n){this.delta.x=n}},dy:{get:function(){return this.delta.y},set:function(n){this.delta.y=n}},velocityX:{get:function(){return this.velocity.x},set:function(n){this.velocity.x=n}},velocityY:{get:function(){return this.velocity.y},set:function(n){this.velocity.y=n}}});var Br=u((function n(t,i,o,s,c){d(this,n),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=i,this.event=o,this.downTime=s,this.downTarget=c})),jr=(function(n){return n.interactable="",n.element="",n.prepared="",n.pointerIsDown="",n.pointerWasMoved="",n._proxy="",n})({}),Wn=(function(n){return n.start="",n.move="",n.end="",n.stop="",n.interacting="",n})({}),Nr=0,qr=(function(){function n(t){var i=this,o=t.pointerType,s=t.scopeFire;d(this,n),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=At((function(y){this.move(y)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=Nr++,this._scopeFire=s,this.pointerType=o;var c=this;this._proxy={};var p=function(y){Object.defineProperty(i._proxy,y,{get:function(){return c[y]}})};for(var f in jr)p(f);var v=function(y){Object.defineProperty(i._proxy,y,{value:function(){return c[y].apply(c,arguments)}})};for(var x in Wn)v(x);this._scopeFire("interactions:new",{interaction:this})}return u(n,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,i,o){var s=this.updatePointer(t,i,o,!0),c=this.pointers[s];this._scopeFire("interactions:down",{pointer:t,event:i,eventTarget:o,pointerIndex:s,pointerInfo:c,type:"down",interaction:this})}},{key:"start",value:function(t,i,o){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!i.options[t.name].enabled)&&(on(this.prepared,t),this.interactable=i,this.element=o,this.rect=i.getRect(o),this.edges=this.prepared.edges?B({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,i,o){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,i,o,!1);var s,c,p=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(s=this.coords.cur.client.x-this.coords.start.client.x,c=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=z(s,c)>this.pointerMoveTolerance);var f,v,x,y=this.getPointerIndex(t),w={pointer:t,pointerIndex:y,pointerInfo:this.pointers[y],event:i,type:"move",eventTarget:o,dx:s,dy:c,duplicate:p,interaction:this};p||(f=this.coords.velocity,v=this.coords.delta,x=Math.max(v.timeStamp/1e3,.001),f.page.x=v.page.x/x,f.page.y=v.page.y/x,f.client.x=v.client.x/x,f.client.y=v.client.y/x,f.timeStamp=x),this._scopeFire("interactions:move",w),p||this.simulation||(this.interacting()&&(w.type=null,this.move(w)),this.pointerWasMoved&&J(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||te(this.coords.delta),(t=B({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,i,o,s){var c=this.getPointerIndex(t);c===-1&&(c=this.updatePointer(t,i,o,!1));var p=/cancel$/i.test(i.type)?"cancel":"up";this._scopeFire("interactions:".concat(p),{pointer:t,pointerIndex:c,pointerInfo:this.pointers[c],event:i,eventTarget:o,type:p,curEventTarget:s,interaction:this}),this.simulation||this.end(i),this.removePointer(t,i)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var i;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(i=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,i===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var i=De(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:xe(this.pointers,(function(o){return o.id===i}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,i,o,s){var c,p,f,v=De(t),x=this.getPointerIndex(t),y=this.pointers[x];return s=s!==!1&&(s||/(down|start)$/i.test(i.type)),y?y.pointer=t:(y=new Br(v,t,i,null,null),x=this.pointers.length,this.pointers.push(y)),N(this.coords.cur,this.pointers.map((function(w){return w.pointer})),this._now()),c=this.coords.delta,p=this.coords.prev,f=this.coords.cur,c.page.x=f.page.x-p.page.x,c.page.y=f.page.y-p.page.y,c.client.x=f.client.x-p.client.x,c.client.y=f.client.y-p.client.y,c.timeStamp=f.timeStamp-p.timeStamp,s&&(this.pointerIsDown=!0,y.downTime=this.coords.cur.timeStamp,y.downTarget=o,G(this.downPointer,t),this.interacting()||(J(this.coords.start,this.coords.cur),J(this.coords.prev,this.coords.cur),this.downEvent=i,this.pointerWasMoved=!1)),this._updateLatestPointer(t,i,o),this._scopeFire("interactions:update-pointer",{pointer:t,event:i,eventTarget:o,down:s,pointerInfo:y,pointerIndex:x,interaction:this}),x}},{key:"removePointer",value:function(t,i){var o=this.getPointerIndex(t);if(o!==-1){var s=this.pointers[o];this._scopeFire("interactions:remove-pointer",{pointer:t,event:i,eventTarget:null,pointerIndex:o,pointerInfo:s,interaction:this}),this.pointers.splice(o,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,i,o){this._latestPointer.pointer=t,this._latestPointer.event=i,this._latestPointer.eventTarget=o}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,i,o,s){return new dn(this,t,this.prepared.name,i,this.element,o,s)}},{key:"_fireEvent",value:function(t){var i;(i=this.interactable)==null||i.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var i=t.event,o=t.phase,s=t.preEnd,c=t.type,p=this.rect;if(p&&o==="move"&&(yt(this.edges,p,this.coords.delta[this.interactable.options.deltaSource]),p.width=p.right-p.left,p.height=p.bottom-p.top),this._scopeFire("interactions:before-action-".concat(o),t)===!1)return!1;var f=t.iEvent=this._createPreparedEvent(i,o,s,c);return this._scopeFire("interactions:action-".concat(o),t),o==="start"&&(this.prevEvent=f),this._fireEvent(f),this._scopeFire("interactions:after-action-".concat(o),t),!0}},{key:"_now",value:function(){return Date.now()}}]),n})();function Gn(n){Xn(n.interaction)}function Xn(n){if(!(function(i){return!(!i.offset.pending.x&&!i.offset.pending.y)})(n))return!1;var t=n.offset.pending;return un(n.coords.cur,t),un(n.coords.delta,t),yt(n.edges,n.rect,t),t.x=0,t.y=0,!0}function Hr(n){var t=n.x,i=n.y;this.offset.pending.x+=t,this.offset.pending.y+=i,this.offset.total.x+=t,this.offset.total.y+=i}function un(n,t){var i=n.page,o=n.client,s=t.x,c=t.y;i.x+=s,i.y+=c,o.x+=s,o.y+=c}Wn.offsetBy="";var Yr={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(n){n.Interaction.prototype.offsetBy=Hr},listeners:{"interactions:new":function(n){n.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(n){return(function(t){t.pointerIsDown&&(un(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(n.interaction)},"interactions:before-action-start":Gn,"interactions:before-action-move":Gn,"interactions:before-action-end":function(n){var t=n.interaction;if(Xn(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(n){var t=n.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},Vn=Yr,$r=(function(){function n(t){d(this,n),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return u(n,[{key:"start",value:function(t){var i=this.interaction,o=Yt(i);if(!o||!o.enabled)return!1;var s=i.coords.velocity.client,c=z(s.x,s.y),p=this.modification||(this.modification=new cn(i));if(p.copyFrom(i.modification),this.t0=i._now(),this.allowResume=o.allowResume,this.v0=c,this.currentOffset={x:0,y:0},this.startCoords=i.coords.cur.page,this.modifierArg=p.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-i.coords.cur.timeStamp<50&&c>o.minSpeed&&c>o.endSpeed)this.startInertia();else{if(p.result=p.setAll(this.modifierArg),!p.result.changed)return!1;this.startSmoothEnd()}return i.modification.result.rect=null,i.offsetBy(this.targetOffset),i._doPhase({interaction:i,event:t,phase:"inertiastart"}),i.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),i.modification.result.rect=null,this.active=!0,i.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,i=this.interaction.coords.velocity.client,o=Yt(this.interaction),s=o.resistance,c=-Math.log(o.endSpeed/this.v0)/s;this.targetOffset={x:(i.x-c)/s,y:(i.y-c)/s},this.te=c,this.lambda_v0=s/this.v0,this.one_ve_v0=1-o.endSpeed/this.v0;var p=this.modification,f=this.modifierArg;f.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},p.result=p.setAll(f),p.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+p.result.delta.x,y:this.targetOffset.y+p.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var i=this;this.timeout=it.request((function(){i.active&&t()}))}},{key:"inertiaTick",value:function(){var t,i,o,s,c,p,f,v=this,x=this.interaction,y=Yt(x).resistance,w=(x._now()-this.t0)/1e3;if(w<this.te){var C,P=1-(Math.exp(-y*w)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,i=0,o=this.targetOffset.x,s=this.targetOffset.y,c=this.modifiedOffset.x,p=this.modifiedOffset.y,C={x:Jn(f=P,t,o,c),y:Jn(f,i,s,p)}):C={x:this.targetOffset.x*P,y:this.targetOffset.y*P};var O={x:C.x-this.currentOffset.x,y:C.y-this.currentOffset.y};this.currentOffset.x+=O.x,this.currentOffset.y+=O.y,x.offsetBy(O),x.move(),this.onNextFrame((function(){return v.inertiaTick()}))}else x.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,i=this.interaction,o=i._now()-this.t0,s=Yt(i).smoothEndDuration;if(o<s){var c={x:Qn(o,0,this.targetOffset.x,s),y:Qn(o,0,this.targetOffset.y,s)},p={x:c.x-this.currentOffset.x,y:c.y-this.currentOffset.y};this.currentOffset.x+=p.x,this.currentOffset.y+=p.y,i.offsetBy(p),i.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else i.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var i=t.pointer,o=t.event,s=t.eventTarget,c=this.interaction;c.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),c.updatePointer(i,o,s,!0),c._doPhase({interaction:c,event:o,phase:"resume"}),J(c.coords.prev,c.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,it.cancel(this.timeout)}}]),n})();function Yt(n){var t=n.interactable,i=n.prepared;return t&&t.options&&i.name&&t.options[i.name].inertia}var Ur={id:"inertia",before:["modifiers","actions"],install:function(n){var t=n.defaults;n.usePlugin(Vn),n.usePlugin(Un),n.actions.phases.inertiastart=!0,n.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(n){var t=n.interaction;t.inertia=new $r(t)},"interactions:before-action-end":function(n){var t=n.interaction,i=n.event;return(!t._interacting||t.simulation||!t.inertia.start(i))&&null},"interactions:down":function(n){var t=n.interaction,i=n.eventTarget,o=t.inertia;if(o.active)for(var s=i;E.element(s);){if(s===t.element){o.resume(n);break}s=je(s)}},"interactions:stop":function(n){var t=n.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(n){var t=n.interaction.modification;t.stop(n),t.start(n,n.interaction.coords.cur.page),t.applyToInteraction(n)},"interactions:before-action-inertiastart":function(n){return n.interaction.modification.setAndApply(n)},"interactions:action-resume":Tt,"interactions:action-inertiastart":Tt,"interactions:after-action-inertiastart":function(n){return n.interaction.modification.restoreInteractionCoords(n)},"interactions:after-action-resume":function(n){return n.interaction.modification.restoreInteractionCoords(n)}}};function Jn(n,t,i,o){var s=1-n;return s*s*t+2*s*n*i+n*n*o}function Qn(n,t,i,o){return-i*(n/=o)*(n-2)+t}var Kr=Ur;function Zn(n,t){for(var i=0;i<t.length;i++){var o=t[i];if(n.immediatePropagationStopped)break;o(n)}}var ei=(function(){function n(t){d(this,n),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=B({},t||{})}return u(n,[{key:"fire",value:function(t){var i,o=this.global;(i=this.types[t.type])&&Zn(t,i),!t.propagationStopped&&o&&(i=o[t.type])&&Zn(t,i)}},{key:"on",value:function(t,i){var o=Ye(t,i);for(t in o)this.types[t]=tt(this.types[t]||[],o[t])}},{key:"off",value:function(t,i){var o=Ye(t,i);for(t in o){var s=this.types[t];if(s&&s.length)for(var c=0,p=o[t];c<p.length;c++){var f=p[c],v=s.indexOf(f);v!==-1&&s.splice(v,1)}}}},{key:"getRect",value:function(t){return null}}]),n})(),Wr=(function(){function n(t){d(this,n),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,G(this,t)}return u(n,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),n})();function Ot(n){return E.object(n)?{capture:!!n.capture,passive:!!n.passive}:{capture:!!n,passive:!1}}function $t(n,t){return n===t||(typeof n=="boolean"?!!t.capture===n&&!t.passive:!!n.capture==!!t.capture&&!!n.passive==!!t.passive)}var Gr={id:"events",install:function(n){var t,i=[],o={},s=[],c={add:p,remove:f,addDelegate:function(y,w,C,P,O){var I=Ot(O);if(!o[C]){o[C]=[];for(var R=0;R<s.length;R++){var D=s[R];p(D,C,v),p(D,C,x,!0)}}var H=o[C],V=Z(H,(function(ee){return ee.selector===y&&ee.context===w}));V||(V={selector:y,context:w,listeners:[]},H.push(V)),V.listeners.push({func:P,options:I})},removeDelegate:function(y,w,C,P,O){var I,R=Ot(O),D=o[C],H=!1;if(D)for(I=D.length-1;I>=0;I--){var V=D[I];if(V.selector===y&&V.context===w){for(var ee=V.listeners,U=ee.length-1;U>=0;U--){var Q=ee[U];if(Q.func===P&&$t(Q.options,R)){ee.splice(U,1),ee.length||(D.splice(I,1),f(w,C,v),f(w,C,x,!0)),H=!0;break}}if(H)break}}},delegateListener:v,delegateUseCapture:x,delegatedEvents:o,documents:s,targets:i,supportsOptions:!1,supportsPassive:!1};function p(y,w,C,P){if(y.addEventListener){var O=Ot(P),I=Z(i,(function(R){return R.eventTarget===y}));I||(I={eventTarget:y,events:{}},i.push(I)),I.events[w]||(I.events[w]=[]),Z(I.events[w],(function(R){return R.func===C&&$t(R.options,O)}))||(y.addEventListener(w,C,c.supportsOptions?O:O.capture),I.events[w].push({func:C,options:O}))}}function f(y,w,C,P){if(y.addEventListener&&y.removeEventListener){var O=xe(i,(function(Ae){return Ae.eventTarget===y})),I=i[O];if(I&&I.events)if(w!=="all"){var R=!1,D=I.events[w];if(D){if(C==="all"){for(var H=D.length-1;H>=0;H--){var V=D[H];f(y,w,V.func,V.options)}return}for(var ee=Ot(P),U=0;U<D.length;U++){var Q=D[U];if(Q.func===C&&$t(Q.options,ee)){y.removeEventListener(w,C,c.supportsOptions?ee:ee.capture),D.splice(U,1),D.length===0&&(delete I.events[w],R=!0);break}}}R&&!Object.keys(I.events).length&&i.splice(O,1)}else for(w in I.events)I.events.hasOwnProperty(w)&&f(y,w,"all")}}function v(y,w){for(var C=Ot(w),P=new Wr(y),O=o[y.type],I=et(y)[0],R=I;E.element(R);){for(var D=0;D<O.length;D++){var H=O[D],V=H.selector,ee=H.context;if(Oe(R,V)&&Ge(ee,I)&&Ge(ee,R)){var U=H.listeners;P.currentTarget=R;for(var Q=0;Q<U.length;Q++){var Ae=U[Q];$t(Ae.options,C)&&Ae.func(P)}}}R=je(R)}}function x(y){return v(y,!0)}return(t=n.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return c.supportsOptions=!0},get passive(){return c.supportsPassive=!0}}),n.events=c,c}},pn={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(n){for(var t=0,i=pn.methodOrder;t<i.length;t++){var o=i[t],s=pn[o](n);if(s)return s}return null},simulationResume:function(n){var t=n.pointerType,i=n.eventType,o=n.eventTarget,s=n.scope;if(!/down|start/i.test(i))return null;for(var c=0,p=s.interactions.list;c<p.length;c++){var f=p[c],v=o;if(f.simulation&&f.simulation.allowResume&&f.pointerType===t)for(;v;){if(v===f.element)return f;v=je(v)}}return null},mouseOrPen:function(n){var t,i=n.pointerId,o=n.pointerType,s=n.eventType,c=n.scope;if(o!=="mouse"&&o!=="pen")return null;for(var p=0,f=c.interactions.list;p<f.length;p++){var v=f[p];if(v.pointerType===o){if(v.simulation&&!ti(v,i))continue;if(v.interacting())return v;t||(t=v)}}if(t)return t;for(var x=0,y=c.interactions.list;x<y.length;x++){var w=y[x];if(!(w.pointerType!==o||/down/i.test(s)&&w.simulation))return w}return null},hasPointer:function(n){for(var t=n.pointerId,i=0,o=n.scope.interactions.list;i<o.length;i++){var s=o[i];if(ti(s,t))return s}return null},idle:function(n){for(var t=n.pointerType,i=0,o=n.scope.interactions.list;i<o.length;i++){var s=o[i];if(s.pointers.length===1){var c=s.interactable;if(c&&(!c.options.gesture||!c.options.gesture.enabled))continue}else if(s.pointers.length>=2)continue;if(!s.interacting()&&t===s.pointerType)return s}return null}};function ti(n,t){return n.pointers.some((function(i){return i.id===t}))}var Xr=pn,hn=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function ni(n,t){return function(i){var o=t.interactions.list,s=Re(i),c=et(i),p=c[0],f=c[1],v=[];if(/^touch/.test(i.type)){t.prevTouchTime=t.now();for(var x=0,y=i.changedTouches;x<y.length;x++){var w=y[x],C={pointer:w,pointerId:De(w),pointerType:s,eventType:i.type,eventTarget:p,curEventTarget:f,scope:t},P=ii(C);v.push([C.pointer,C.eventTarget,C.curEventTarget,P])}}else{var O=!1;if(!ze.supportsPointerEvent&&/mouse/.test(i.type)){for(var I=0;I<o.length&&!O;I++)O=o[I].pointerType!=="mouse"&&o[I].pointerIsDown;O=O||t.now()-t.prevTouchTime<500||i.timeStamp===0}if(!O){var R={pointer:i,pointerId:De(i),pointerType:s,eventType:i.type,curEventTarget:f,eventTarget:p,scope:t},D=ii(R);v.push([R.pointer,R.eventTarget,R.curEventTarget,D])}}for(var H=0;H<v.length;H++){var V=v[H],ee=V[0],U=V[1],Q=V[2];V[3][n](ee,i,U,Q)}}}function ii(n){var t=n.pointerType,i=n.scope,o={interaction:Xr.search(n),searchDetails:n};return i.fire("interactions:find",o),o.interaction||i.interactions.new({pointerType:t})}function fn(n,t){var i=n.doc,o=n.scope,s=n.options,c=o.interactions.docEvents,p=o.events,f=p[t];for(var v in o.browser.isIOS&&!s.events&&(s.events={passive:!1}),p.delegatedEvents)f(i,v,p.delegateListener),f(i,v,p.delegateUseCapture,!0);for(var x=s&&s.events,y=0;y<c.length;y++){var w=c[y];f(i,w.type,w.listener,x)}}var Vr={id:"core/interactions",install:function(n){for(var t={},i=0;i<hn.length;i++){var o=hn[i];t[o]=ni(o,n)}var s,c=ze.pEventTypes;function p(){for(var f=0,v=n.interactions.list;f<v.length;f++){var x=v[f];if(x.pointerIsDown&&x.pointerType==="touch"&&!x._interacting)for(var y=function(){var P=C[w];n.documents.some((function(O){return Ge(O.doc,P.downTarget)}))||x.removePointer(P.pointer,P.event)},w=0,C=x.pointers;w<C.length;w++)y()}}(s=ve.PointerEvent?[{type:c.down,listener:p},{type:c.down,listener:t.pointerDown},{type:c.move,listener:t.pointerMove},{type:c.up,listener:t.pointerUp},{type:c.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:p},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(f){for(var v=0,x=n.interactions.list;v<x.length;v++)x[v].documentBlur(f)}}),n.prevTouchTime=0,n.Interaction=(function(f){m(x,f);var v=_(x);function x(){return d(this,x),v.apply(this,arguments)}return u(x,[{key:"pointerMoveTolerance",get:function(){return n.interactions.pointerMoveTolerance},set:function(y){n.interactions.pointerMoveTolerance=y}},{key:"_now",value:function(){return n.now()}}]),x})(qr),n.interactions={list:[],new:function(f){f.scopeFire=function(x,y){return n.fire(x,y)};var v=new n.Interaction(f);return n.interactions.list.push(v),v},listeners:t,docEvents:s,pointerMoveTolerance:1},n.usePlugin($n)},listeners:{"scope:add-document":function(n){return fn(n,"add")},"scope:remove-document":function(n){return fn(n,"remove")},"interactable:unset":function(n,t){for(var i=n.interactable,o=t.interactions.list.length-1;o>=0;o--){var s=t.interactions.list[o];s.interactable===i&&(s.stop(),t.fire("interactions:destroy",{interaction:s}),s.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(o,1))}}},onDocSignal:fn,doOnInteractions:ni,methodNames:hn},Jr=Vr,ot=(function(n){return n[n.On=0]="On",n[n.Off=1]="Off",n})(ot||{}),Qr=(function(){function n(t,i,o,s){d(this,n),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new ei,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=i.actions,this.target=t,this._context=i.context||o,this._win=q(Fe(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=s,this.set(i)}return u(n,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,i){return E.func(i.onstart)&&this.on("".concat(t,"start"),i.onstart),E.func(i.onmove)&&this.on("".concat(t,"move"),i.onmove),E.func(i.onend)&&this.on("".concat(t,"end"),i.onend),E.func(i.oninertiastart)&&this.on("".concat(t,"inertiastart"),i.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,i,o){var s,c=this,p=(s=this._actions.map[t])==null?void 0:s.filterEventType,f=function(v){return(p==null||p(v))&&qt(v,c._actions)};(E.array(i)||E.object(i))&&this._onOff(ot.Off,t,i,void 0,f),(E.array(o)||E.object(o))&&this._onOff(ot.On,t,o,void 0,f)}},{key:"setPerAction",value:function(t,i){var o=this._defaults;for(var s in i){var c=s,p=this.options[t],f=i[c];c==="listeners"&&this.updatePerActionListeners(t,p.listeners,f),E.array(f)?p[c]=ge(f):E.plainObject(f)?(p[c]=B(p[c]||{},_t(f)),E.object(o.perAction[c])&&"enabled"in o.perAction[c]&&(p[c].enabled=f.enabled!==!1)):E.bool(f)&&E.object(o.perAction[c])?p[c].enabled=f:p[c]=f}}},{key:"getRect",value:function(t){return t=t||(E.element(this.target)?this.target:null),E.string(this.target)&&(t=t||this._context.querySelector(this.target)),Me(t)}},{key:"rectChecker",value:function(t){var i=this;return E.func(t)?(this.getRect=function(o){var s=B({},t.apply(i,o));return"width"in s||(s.width=s.right-s.left,s.height=s.bottom-s.top),s},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,i){if(Fe(i)||E.object(i)){for(var o in this.options[t]=i,this._actions.map)this.options[o][t]=i;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return E.string(t)?Array.from(this._context.querySelectorAll(t)):E.func(t)&&t.getAllElements?t.getAllElements():E.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||Ge(this._context,t)}},{key:"testIgnoreAllow",value:function(t,i,o){return!this.testIgnore(t.ignoreFrom,i,o)&&this.testAllow(t.allowFrom,i,o)}},{key:"testAllow",value:function(t,i,o){return!t||!!E.element(o)&&(E.string(t)?gt(o,t,i):!!E.element(t)&&Ge(t,o))}},{key:"testIgnore",value:function(t,i,o){return!(!t||!E.element(o))&&(E.string(t)?gt(o,t,i):!!E.element(t)&&Ge(t,o))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,i,o,s,c){E.object(i)&&!E.array(i)&&(s=o,o=null);var p=Ye(i,o,c);for(var f in p){f==="wheel"&&(f=ze.wheelEvent);for(var v=0,x=p[f];v<x.length;v++){var y=x[v];qt(f,this._actions)?this.events[t===ot.On?"on":"off"](f,y):E.string(this.target)?this._scopeEvents[t===ot.On?"addDelegate":"removeDelegate"](this.target,this._context,f,y,s):this._scopeEvents[t===ot.On?"add":"remove"](this.target,f,y,s)}}return this}},{key:"on",value:function(t,i,o){return this._onOff(ot.On,t,i,o)}},{key:"off",value:function(t,i,o){return this._onOff(ot.Off,t,i,o)}},{key:"set",value:function(t){var i=this._defaults;for(var o in E.object(t)||(t={}),this.options=_t(i.base),this._actions.methodDict){var s=o,c=this._actions.methodDict[s];this.options[s]={},this.setPerAction(s,B(B({},i.perAction),i.actions[s])),this[c](t[s])}for(var p in t)p!=="getRect"?E.func(this[p])&&this[p](t[p]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(E.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var i=this._scopeEvents.delegatedEvents[t],o=i.length-1;o>=0;o--){var s=i[o],c=s.selector,p=s.context,f=s.listeners;c===this.target&&p===this._context&&i.splice(o,1);for(var v=f.length-1;v>=0;v--)this._scopeEvents.removeDelegate(this.target,this._context,t,f[v][0],f[v][1])}else this._scopeEvents.remove(this.target,"all")}}]),n})(),Zr=(function(){function n(t){var i=this;d(this,n),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(o){var s=o.interactable,c=s.target,p=E.string(c)?i.selectorMap[c]:c[i.scope.id],f=xe(p,(function(v){return v===s}));p.splice(f,1)}})}return u(n,[{key:"new",value:function(t,i){i=B(i||{},{actions:this.scope.actions});var o=new this.scope.Interactable(t,i,this.scope.document,this.scope.events);return this.scope.addDocument(o._doc),this.list.push(o),E.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(o)):(o.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(o)),this.scope.fire("interactable:new",{target:t,options:i,interactable:o,win:this.scope._win}),o}},{key:"getExisting",value:function(t,i){var o=i&&i.context||this.scope.document,s=E.string(t),c=s?this.selectorMap[t]:t[this.scope.id];if(c)return Z(c,(function(p){return p._context===o&&(s||p.inContext(t))}))}},{key:"forEachMatch",value:function(t,i){for(var o=0,s=this.list;o<s.length;o++){var c=s[o],p=void 0;if((E.string(c.target)?E.element(t)&&Oe(t,c.target):t===c.target)&&c.inContext(t)&&(p=i(c)),p!==void 0)return p}}}]),n})(),eo=(function(){function n(){var t=this;d(this,n),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=ze,this.defaults=_t(Kn),this.Eventable=ei,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(o){var s=function c(p,f){var v=o.interactables.getExisting(p,f);return v||((v=o.interactables.new(p,f)).events.global=c.globalEvents),v};return s.getPointerAverage=he,s.getTouchBBox=Ue,s.getTouchDistance=pe,s.getTouchAngle=Se,s.getElementRect=Me,s.getElementClientRect=K,s.matchesSelector=Oe,s.closest=Ct,s.globalEvents={},s.version="1.10.27",s.scope=o,s.use=function(c,p){return this.scope.usePlugin(c,p),this},s.isSet=function(c,p){return!!this.scope.interactables.get(c,p&&p.context)},s.on=At((function(c,p,f){if(E.string(c)&&c.search(" ")!==-1&&(c=c.trim().split(/ +/)),E.array(c)){for(var v=0,x=c;v<x.length;v++){var y=x[v];this.on(y,p,f)}return this}if(E.object(c)){for(var w in c)this.on(w,c[w],p);return this}return qt(c,this.scope.actions)?this.globalEvents[c]?this.globalEvents[c].push(p):this.globalEvents[c]=[p]:this.scope.events.add(this.scope.document,c,p,{options:f}),this}),"The interact.on() method is being deprecated"),s.off=At((function(c,p,f){if(E.string(c)&&c.search(" ")!==-1&&(c=c.trim().split(/ +/)),E.array(c)){for(var v=0,x=c;v<x.length;v++){var y=x[v];this.off(y,p,f)}return this}if(E.object(c)){for(var w in c)this.off(w,c[w],p);return this}var C;return qt(c,this.scope.actions)?c in this.globalEvents&&(C=this.globalEvents[c].indexOf(p))!==-1&&this.globalEvents[c].splice(C,1):this.scope.events.remove(this.scope.document,c,p,f),this}),"The interact.off() method is being deprecated"),s.debug=function(){return this.scope},s.supportsTouch=function(){return ze.supportsTouch},s.supportsPointerEvent=function(){return ze.supportsPointerEvent},s.stop=function(){for(var c=0,p=this.scope.interactions.list;c<p.length;c++)p[c].stop();return this},s.pointerMoveTolerance=function(c){return E.number(c)?(this.scope.interactions.pointerMoveTolerance=c,this):this.scope.interactions.pointerMoveTolerance},s.addDocument=function(c,p){this.scope.addDocument(c,p)},s.removeDocument=function(c){this.scope.removeDocument(c)},s})(this),this.InteractEvent=dn,this.Interactable=void 0,this.interactables=new Zr(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(o){return t.removeDocument(o.target)};var i=this;this.Interactable=(function(o){m(c,o);var s=_(c);function c(){return d(this,c),s.apply(this,arguments)}return u(c,[{key:"_defaults",get:function(){return i.defaults}},{key:"set",value:function(p){return k(g(c.prototype),"set",this).call(this,p),i.fire("interactable:set",{options:p,interactable:this}),this}},{key:"unset",value:function(){k(g(c.prototype),"unset",this).call(this);var p=i.interactables.list.indexOf(this);p<0||(i.interactables.list.splice(p,1),i.fire("interactable:unset",{interactable:this}))}}]),c})(Qr)}return u(n,[{key:"addListeners",value:function(t,i){this.listenerMaps.push({id:i,map:t})}},{key:"fire",value:function(t,i){for(var o=0,s=this.listenerMaps;o<s.length;o++){var c=s[o].map[t];if(c&&c(i,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(i,o){return i.isInitialized=!0,E.window(o)&&j(o),ve.init(o),ze.init(o),it.init(o),i.window=o,i.document=o.document,i.usePlugin(Jr),i.usePlugin(Gr),i})(this,t)}},{key:"pluginIsInstalled",value:function(t){var i=t.id;return i?!!this._plugins.map[i]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,i){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,i),t.listeners&&t.before){for(var o=0,s=this.listenerMaps.length,c=t.before.reduce((function(f,v){return f[v]=!0,f[ri(v)]=!0,f}),{});o<s;o++){var p=this.listenerMaps[o].id;if(p&&(c[p]||c[ri(p)]))break}this.listenerMaps.splice(o,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,i){if(this.getDocIndex(t)!==-1)return!1;var o=q(t);i=i?B({},i):{},this.documents.push({doc:t,options:i}),this.events.documents.push(t),t!==this.document&&this.events.add(o,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:o,scope:this,options:i})}},{key:"removeDocument",value:function(t){var i=this.getDocIndex(t),o=q(t),s=this.documents[i].options;this.events.remove(o,"unload",this.onWindowUnload),this.documents.splice(i,1),this.events.documents.splice(i,1),this.fire("scope:remove-document",{doc:t,window:o,scope:this,options:s})}},{key:"getDocIndex",value:function(t){for(var i=0;i<this.documents.length;i++)if(this.documents[i].doc===t)return i;return-1}},{key:"getDocOptions",value:function(t){var i=this.getDocIndex(t);return i===-1?null:this.documents[i].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),n})();function ri(n){return n&&n.replace(/\/.*$/,"")}var oi=new eo,Ce=oi.interactStatic,to=typeof globalThis!="undefined"?globalThis:window;oi.init(to);var no=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(n){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(o){var s=o[0],c=o[1];return s in n||c in n})),i=function(o,s){for(var c=n.range,p=n.limits,f=p===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:p,v=n.offset,x=v===void 0?{x:0,y:0}:v,y={range:c,grid:n,x:null,y:null},w=0;w<t.length;w++){var C=t[w],P=C[0],O=C[1],I=Math.round((o-x.x)/n[P]),R=Math.round((s-x.y)/n[O]);y[P]=Math.max(f.left,Math.min(f.right,I*n[P]+x.x)),y[O]=Math.max(f.top,Math.min(f.bottom,R*n[O]+x.y))}return y};return i.grid=n,i.coordFields=t,i}}),io={id:"snappers",install:function(n){var t=n.interactStatic;t.snappers=B(t.snappers||{},no),t.createSnapGrid=t.snappers.grid}},ro=io,oo={start:function(n){var t=n.state,i=n.rect,o=n.edges,s=n.pageCoords,c=t.options,p=c.ratio,f=c.enabled,v=t.options,x=v.equalDelta,y=v.modifiers;p==="preserve"&&(p=i.width/i.height),t.startCoords=B({},s),t.startRect=B({},i),t.ratio=p,t.equalDelta=x;var w=t.linkedEdges={top:o.top||o.left&&!o.bottom,left:o.left||o.top&&!o.right,bottom:o.bottom||o.right&&!o.top,right:o.right||o.bottom&&!o.left};if(t.xIsPrimaryAxis=!(!o.left&&!o.right),t.equalDelta){var C=(w.left?1:-1)*(w.top?1:-1);t.edgeSign={x:C,y:C}}else t.edgeSign={x:w.left?-1:1,y:w.top?-1:1};if(f!==!1&&B(o,w),y!=null&&y.length){var P=new cn(n.interaction);P.copyFrom(n.interaction.modification),P.prepareStates(y),t.subModification=P,P.startAll(r({},n))}},set:function(n){var t=n.state,i=n.rect,o=n.coords,s=t.linkedEdges,c=B({},o),p=t.equalDelta?ao:so;if(B(n.edges,s),p(t,t.xIsPrimaryAxis,o,i),!t.subModification)return null;var f=B({},i);yt(s,f,{x:o.x-c.x,y:o.y-c.y});var v=t.subModification.setAll(r(r({},n),{},{rect:f,edges:s,pageCoords:o,prevCoords:o,prevRect:f})),x=v.delta;return v.changed&&(p(t,Math.abs(x.x)>Math.abs(x.y),v.coords,v.rect),B(o,v.coords)),v.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function ao(n,t,i){var o=n.startCoords,s=n.edgeSign;t?i.y=o.y+(i.x-o.x)*s.y:i.x=o.x+(i.y-o.y)*s.x}function so(n,t,i,o){var s=n.startRect,c=n.startCoords,p=n.ratio,f=n.edgeSign;if(t){var v=o.width/p;i.y=c.y+(v-s.height)*f.y}else{var x=o.height*p;i.x=c.x+(x-s.width)*f.x}}var lo=rt(oo,"aspectRatio"),ai=function(){};ai._defaults={};var Ut=ai;function ut(n,t,i){return E.func(n)?we(n,t.interactable,t.element,[i.x,i.y,t]):we(n,t.interactable,t.element)}var Kt={start:function(n){var t=n.rect,i=n.startOffset,o=n.state,s=n.interaction,c=n.pageCoords,p=o.options,f=p.elementRect,v=B({left:0,top:0,right:0,bottom:0},p.offset||{});if(t&&f){var x=ut(p.restriction,s,c);if(x){var y=x.right-x.left-t.width,w=x.bottom-x.top-t.height;y<0&&(v.left+=y,v.right+=y),w<0&&(v.top+=w,v.bottom+=w)}v.left+=i.left-t.width*f.left,v.top+=i.top-t.height*f.top,v.right+=i.right-t.width*(1-f.right),v.bottom+=i.bottom-t.height*(1-f.bottom)}o.offset=v},set:function(n){var t=n.coords,i=n.interaction,o=n.state,s=o.options,c=o.offset,p=ut(s.restriction,i,t);if(p){var f=(function(v){return!v||"left"in v&&"top"in v||((v=B({},v)).left=v.x||0,v.top=v.y||0,v.right=v.right||v.left+v.width,v.bottom=v.bottom||v.top+v.height),v})(p);t.x=Math.max(Math.min(f.right-c.right,t.x),f.left+c.left),t.y=Math.max(Math.min(f.bottom-c.bottom,t.y),f.top+c.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},co=rt(Kt,"restrict"),si={top:1/0,left:1/0,bottom:-1/0,right:-1/0},li={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function ci(n,t){for(var i=0,o=["top","left","bottom","right"];i<o.length;i++){var s=o[i];s in n||(n[s]=t[s])}return n}var Mt={noInner:si,noOuter:li,start:function(n){var t,i=n.interaction,o=n.startOffset,s=n.state,c=s.options;c&&(t=ct(ut(c.offset,i,i.coords.start.page))),t=t||{x:0,y:0},s.offset={top:t.y+o.top,left:t.x+o.left,bottom:t.y-o.bottom,right:t.x-o.right}},set:function(n){var t=n.coords,i=n.edges,o=n.interaction,s=n.state,c=s.offset,p=s.options;if(i){var f=B({},t),v=ut(p.inner,o,f)||{},x=ut(p.outer,o,f)||{};ci(v,si),ci(x,li),i.top?t.y=Math.min(Math.max(x.top+c.top,f.y),v.top+c.top):i.bottom&&(t.y=Math.max(Math.min(x.bottom+c.bottom,f.y),v.bottom+c.bottom)),i.left?t.x=Math.min(Math.max(x.left+c.left,f.x),v.left+c.left):i.right&&(t.x=Math.max(Math.min(x.right+c.right,f.x),v.right+c.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},uo=rt(Mt,"restrictEdges"),po=B({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(n){}},Kt.defaults),ho=rt({start:Kt.start,set:Kt.set,defaults:po},"restrictRect"),fo={width:-1/0,height:-1/0},go={width:1/0,height:1/0},mo=rt({start:function(n){return Mt.start(n)},set:function(n){var t=n.interaction,i=n.state,o=n.rect,s=n.edges,c=i.options;if(s){var p=vt(ut(c.min,t,n.coords))||fo,f=vt(ut(c.max,t,n.coords))||go;i.options={endOnly:c.endOnly,inner:B({},Mt.noInner),outer:B({},Mt.noOuter)},s.top?(i.options.inner.top=o.bottom-p.height,i.options.outer.top=o.bottom-f.height):s.bottom&&(i.options.inner.bottom=o.top+p.height,i.options.outer.bottom=o.top+f.height),s.left?(i.options.inner.left=o.right-p.width,i.options.outer.left=o.right-f.width):s.right&&(i.options.inner.right=o.left+p.width,i.options.outer.right=o.left+f.width),Mt.set(n),i.options=c}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),gn={start:function(n){var t,i=n.interaction,o=n.interactable,s=n.element,c=n.rect,p=n.state,f=n.startOffset,v=p.options,x=v.offsetWithOrigin?(function(C){var P=C.interaction.element,O=ct(we(C.state.options.origin,null,null,[P])),I=O||Xe(C.interactable,P,C.interaction.prepared.name);return I})(n):{x:0,y:0};if(v.offset==="startCoords")t={x:i.coords.start.page.x,y:i.coords.start.page.y};else{var y=we(v.offset,o,s,[i]);(t=ct(y)||{x:0,y:0}).x+=x.x,t.y+=x.y}var w=v.relativePoints;p.offsets=c&&w&&w.length?w.map((function(C,P){return{index:P,relativePoint:C,x:f.left-c.width*C.x+t.x,y:f.top-c.height*C.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(n){var t=n.interaction,i=n.coords,o=n.state,s=o.options,c=o.offsets,p=Xe(t.interactable,t.element,t.prepared.name),f=B({},i),v=[];s.offsetWithOrigin||(f.x-=p.x,f.y-=p.y);for(var x=0,y=c;x<y.length;x++)for(var w=y[x],C=f.x-w.x,P=f.y-w.y,O=0,I=s.targets.length;O<I;O++){var R=s.targets[O],D=void 0;(D=E.func(R)?R(C,P,t._proxy,w,O):R)&&v.push({x:(E.number(D.x)?D.x:C)+w.x,y:(E.number(D.y)?D.y:P)+w.y,range:E.number(D.range)?D.range:s.range,source:R,index:O,offset:w})}for(var H={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},V=0;V<v.length;V++){var ee=v[V],U=ee.range,Q=ee.x-f.x,Ae=ee.y-f.y,se=z(Q,Ae),Be=se<=U;U===1/0&&H.inRange&&H.range!==1/0&&(Be=!1),H.target&&!(Be?H.inRange&&U!==1/0?se/U<H.distance/H.range:U===1/0&&H.range!==1/0||se<H.distance:!H.inRange&&se<H.distance)||(H.target=ee,H.distance=se,H.range=U,H.inRange=Be,H.delta.x=Q,H.delta.y=Ae)}return H.inRange&&(i.x=H.target.x,i.y=H.target.y),o.closest=H,H},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},vo=rt(gn,"snap"),Wt={start:function(n){var t=n.state,i=n.edges,o=t.options;if(!i)return null;n.state={options:{targets:null,relativePoints:[{x:i.left?0:1,y:i.top?0:1}],offset:o.offset||"self",origin:{x:0,y:0},range:o.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],gn.start(n),t.offsets=n.state.offsets,n.state=t},set:function(n){var t=n.interaction,i=n.state,o=n.coords,s=i.options,c=i.offsets,p={x:o.x-c[0].x,y:o.y-c[0].y};i.options=B({},s),i.options.targets=[];for(var f=0,v=s.targets||[];f<v.length;f++){var x=v[f],y=void 0;if(y=E.func(x)?x(p.x,p.y,t):x){for(var w=0,C=i.targetFields;w<C.length;w++){var P=C[w],O=P[0],I=P[1];if(O in y||I in y){y.x=y[O],y.y=y[I];break}}i.options.targets.push(y)}}var R=gn.set(n);return i.options=s,R},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},yo=rt(Wt,"snapSize"),mn={aspectRatio:lo,restrictEdges:uo,restrict:co,restrictRect:ho,restrictSize:mo,snapEdges:rt({start:function(n){var t=n.edges;return t?(n.state.targetFields=n.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],Wt.start(n)):null},set:Wt.set,defaults:B(_t(Wt.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:vo,snapSize:yo,spring:Ut,avoid:Ut,transform:Ut,rubberband:Ut},bo={id:"modifiers",install:function(n){var t=n.interactStatic;for(var i in n.usePlugin(Un),n.usePlugin(ro),t.modifiers=mn,mn){var o=mn[i],s=o._defaults,c=o._methods;s._methods=c,n.defaults.perAction[i]=s}}},xo=bo,di=(function(n){m(i,n);var t=_(i);function i(o,s,c,p,f,v){var x;if(d(this,i),G(S(x=t.call(this,f)),c),c!==s&&G(S(x),s),x.timeStamp=v,x.originalEvent=c,x.type=o,x.pointerId=De(s),x.pointerType=Re(s),x.target=p,x.currentTarget=null,o==="tap"){var y=f.getPointerIndex(s);x.dt=x.timeStamp-f.pointers[y].downTime;var w=x.timeStamp-f.tapTime;x.double=!!f.prevTap&&f.prevTap.type!=="doubletap"&&f.prevTap.target===x.target&&w<500}else o==="doubletap"&&(x.dt=s.timeStamp-f.tapTime,x.double=!0);return x}return u(i,[{key:"_subtractOrigin",value:function(o){var s=o.x,c=o.y;return this.pageX-=s,this.pageY-=c,this.clientX-=s,this.clientY-=c,this}},{key:"_addOrigin",value:function(o){var s=o.x,c=o.y;return this.pageX+=s,this.pageY+=c,this.clientX+=s,this.clientY+=c,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),i})(Ee),Pt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(n){n.pointerEvents=Pt,n.defaults.actions.pointerEvents=Pt.defaults,B(n.actions.phaselessTypes,Pt.types)},listeners:{"interactions:new":function(n){var t=n.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(n){var t=n.down,i=n.pointerInfo;!t&&i.hold||(i.hold={duration:1/0,timeout:null})},"interactions:move":function(n,t){var i=n.interaction,o=n.pointer,s=n.event,c=n.eventTarget;n.duplicate||i.pointerIsDown&&!i.pointerWasMoved||(i.pointerIsDown&&vn(n),at({interaction:i,pointer:o,event:s,eventTarget:c,type:"move"},t))},"interactions:down":function(n,t){(function(i,o){for(var s=i.interaction,c=i.pointer,p=i.event,f=i.eventTarget,v=i.pointerIndex,x=s.pointers[v].hold,y=ie(f),w={interaction:s,pointer:c,event:p,eventTarget:f,type:"hold",targets:[],path:y,node:null},C=0;C<y.length;C++){var P=y[C];w.node=P,o.fire("pointerEvents:collect-targets",w)}if(w.targets.length){for(var O=1/0,I=0,R=w.targets;I<R.length;I++){var D=R[I].eventable.options.holdDuration;D<O&&(O=D)}x.duration=O,x.timeout=setTimeout((function(){at({interaction:s,eventTarget:f,pointer:c,event:p,type:"hold"},o)}),O)}})(n,t),at(n,t)},"interactions:up":function(n,t){vn(n),at(n,t),(function(i,o){var s=i.interaction,c=i.pointer,p=i.event,f=i.eventTarget;s.pointerWasMoved||at({interaction:s,eventTarget:f,pointer:c,event:p,type:"tap"},o)})(n,t)},"interactions:cancel":function(n,t){vn(n),at(n,t)}},PointerEvent:di,fire:at,collectEventTargets:ui,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function at(n,t){var i=n.interaction,o=n.pointer,s=n.event,c=n.eventTarget,p=n.type,f=n.targets,v=f===void 0?ui(n,t):f,x=new di(p,o,s,c,i,t.now());t.fire("pointerEvents:new",{pointerEvent:x});for(var y={interaction:i,pointer:o,event:s,eventTarget:c,targets:v,type:p,pointerEvent:x},w=0;w<v.length;w++){var C=v[w];for(var P in C.props||{})x[P]=C.props[P];var O=Xe(C.eventable,C.node);if(x._subtractOrigin(O),x.eventable=C.eventable,x.currentTarget=C.node,C.eventable.fire(x),x._addOrigin(O),x.immediatePropagationStopped||x.propagationStopped&&w+1<v.length&&v[w+1].node!==x.currentTarget)break}if(t.fire("pointerEvents:fired",y),p==="tap"){var I=x.double?at({interaction:i,pointer:o,event:s,eventTarget:c,type:"doubletap"},t):x;i.prevTap=I,i.tapTime=I.timeStamp}return x}function ui(n,t){var i=n.interaction,o=n.pointer,s=n.event,c=n.eventTarget,p=n.type,f=i.getPointerIndex(o),v=i.pointers[f];if(p==="tap"&&(i.pointerWasMoved||!v||v.downTarget!==c))return[];for(var x=ie(c),y={interaction:i,pointer:o,event:s,eventTarget:c,type:p,path:x,targets:[],node:null},w=0;w<x.length;w++){var C=x[w];y.node=C,t.fire("pointerEvents:collect-targets",y)}return p==="hold"&&(y.targets=y.targets.filter((function(P){var O,I;return P.eventable.options.holdDuration===((O=i.pointers[f])==null||(I=O.hold)==null?void 0:I.duration)}))),y.targets}function vn(n){var t=n.interaction,i=n.pointerIndex,o=t.pointers[i].hold;o&&o.timeout&&(clearTimeout(o.timeout),o.timeout=null)}var _o=Object.freeze({__proto__:null,default:Pt});function wo(n){var t=n.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var So={id:"pointer-events/holdRepeat",install:function(n){n.usePlugin(Pt);var t=n.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=n.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(n,t){return n["pointerEvents:".concat(t)]=wo,n}),{"pointerEvents:new":function(n){var t=n.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(n,t){var i=n.interaction,o=n.pointerEvent,s=n.eventTarget,c=n.targets;if(o.type==="hold"&&c.length){var p=c[0].eventable.options.holdRepeatInterval;p<=0||(i.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:i,eventTarget:s,type:"hold",pointer:o,event:o},t)}),p))}}})},ko=So,Eo={id:"pointer-events/interactableTargets",install:function(n){var t=n.Interactable;t.prototype.pointerEvents=function(o){return B(this.events.options,o),this};var i=t.prototype._backCompatOption;t.prototype._backCompatOption=function(o,s){var c=i.call(this,o,s);return c===this&&(this.events.options[o]=s),c}},listeners:{"pointerEvents:collect-targets":function(n,t){var i=n.targets,o=n.node,s=n.type,c=n.eventTarget;t.interactables.forEachMatch(o,(function(p){var f=p.events,v=f.options;f.types[s]&&f.types[s].length&&p.testIgnoreAllow(v,o,c)&&i.push({node:o,eventable:f,props:{interactable:p}})}))},"interactable:new":function(n){var t=n.interactable;t.events.getRect=function(i){return t.getRect(i)}},"interactable:set":function(n,t){var i=n.interactable,o=n.options;B(i.events.options,t.pointerEvents.defaults),B(i.events.options,o.pointerEvents||{})}}},Co=Eo,Ao={id:"pointer-events",install:function(n){n.usePlugin(_o),n.usePlugin(ko),n.usePlugin(Co)}},To=Ao,Oo={id:"reflow",install:function(n){var t=n.Interactable;n.actions.phases.reflow=!0,t.prototype.reflow=function(i){return(function(o,s,c){for(var p=o.getAllElements(),f=c.window.Promise,v=f?[]:null,x=function(){var w=p[y],C=o.getRect(w);if(!C)return 1;var P,O=Z(c.interactions.list,(function(D){return D.interacting()&&D.interactable===o&&D.element===w&&D.prepared.name===s.name}));if(O)O.move(),v&&(P=O._reflowPromise||new f((function(D){O._reflowResolve=D})));else{var I=vt(C),R=(function(D){return{coords:D,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:I.x,y:I.y},client:{x:I.x,y:I.y},timeStamp:c.now()});P=(function(D,H,V,ee,U){var Q=D.interactions.new({pointerType:"reflow"}),Ae={interaction:Q,event:U,pointer:U,eventTarget:V,phase:"reflow"};Q.interactable=H,Q.element=V,Q.prevEvent=U,Q.updatePointer(U,U,V,!0),te(Q.coords.delta),on(Q.prepared,ee),Q._doPhase(Ae);var se=D.window,Be=se.Promise,qe=Be?new Be((function(Qe){Q._reflowResolve=Qe})):void 0;return Q._reflowPromise=qe,Q.start(ee,H,V),Q._interacting?(Q.move(Ae),Q.end(U)):(Q.stop(),Q._reflowResolve()),Q.removePointer(U,U),qe})(c,o,w,s,R)}v&&v.push(P)},y=0;y<p.length&&!x();y++);return v&&f.all(v).then((function(){return o}))})(this,i,n)}},listeners:{"interactions:stop":function(n,t){var i=n.interaction;i.pointerType==="reflow"&&(i._reflowResolve&&i._reflowResolve(),(function(o,s){o.splice(o.indexOf(s),1)})(t.interactions.list,i))}}},Mo=Oo;if(Ce.use($n),Ce.use(Vn),Ce.use(To),Ce.use(Kr),Ce.use(xo),Ce.use(zr),Ce.use(Sr),Ce.use(Er),Ce.use(Mo),Ce.default=Ce,(typeof pt=="undefined"?"undefined":a(pt))==="object"&&pt)try{pt.exports=Ce}catch{}return Ce.default=Ce,Ce}))});var yr=Bo(hi(),1);function Oi(e){return typeof e=="undefined"||e===null}function jo(e){return typeof e=="object"&&e!==null}function No(e){return Array.isArray(e)?e:Oi(e)?[]:[e]}function qo(e,r){var a,d,l,u;if(r)for(u=Object.keys(r),a=0,d=u.length;a<d;a+=1)l=u[a],e[l]=r[l];return e}function Ho(e,r){var a="",d;for(d=0;d<r;d+=1)a+=e;return a}function Yo(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var $o=Oi,Uo=jo,Ko=No,Wo=Ho,Go=Yo,Xo=qo,me={isNothing:$o,isObject:Uo,toArray:Ko,repeat:Wo,isNegativeZero:Go,extend:Xo};function Mi(e,r){var a="",d=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(a+='in "'+e.mark.name+'" '),a+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!r&&e.mark.snippet&&(a+=`

`+e.mark.snippet),d+" "+a):d}function zt(e,r){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=r,this.message=Mi(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}zt.prototype=Object.create(Error.prototype);zt.prototype.constructor=zt;zt.prototype.toString=function(r){return this.name+": "+Mi(this,r)};var Te=zt;function bn(e,r,a,d,l){var u="",h="",m=Math.floor(l/2)-1;return d-r>m&&(u=" ... ",r=d-m+u.length),a-d>m&&(h=" ...",a=d+m-h.length),{str:u+e.slice(r,a).replace(/\t/g,"\u2192")+h,pos:d-r+u.length}}function xn(e,r){return me.repeat(" ",r-e.length)+e}function Vo(e,r){if(r=Object.create(r||null),!e.buffer)return null;r.maxLength||(r.maxLength=79),typeof r.indent!="number"&&(r.indent=1),typeof r.linesBefore!="number"&&(r.linesBefore=3),typeof r.linesAfter!="number"&&(r.linesAfter=2);for(var a=/\r?\n|\r|\0/g,d=[0],l=[],u,h=-1;u=a.exec(e.buffer);)l.push(u.index),d.push(u.index+u[0].length),e.position<=u.index&&h<0&&(h=d.length-2);h<0&&(h=d.length-1);var m="",g,b,S=Math.min(e.line+r.linesAfter,l.length).toString().length,_=r.maxLength-(r.indent+S+3);for(g=1;g<=r.linesBefore&&!(h-g<0);g++)b=bn(e.buffer,d[h-g],l[h-g],e.position-(d[h]-d[h-g]),_),m=me.repeat(" ",r.indent)+xn((e.line-g+1).toString(),S)+" | "+b.str+`
`+m;for(b=bn(e.buffer,d[h],l[h],e.position,_),m+=me.repeat(" ",r.indent)+xn((e.line+1).toString(),S)+" | "+b.str+`
`,m+=me.repeat("-",r.indent+S+3+b.pos)+`^
`,g=1;g<=r.linesAfter&&!(h+g>=l.length);g++)b=bn(e.buffer,d[h+g],l[h+g],e.position-(d[h]-d[h+g]),_),m+=me.repeat(" ",r.indent)+xn((e.line+g+1).toString(),S)+" | "+b.str+`
`;return m.replace(/\n$/,"")}var Jo=Vo,Qo=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Zo=["scalar","sequence","mapping"];function ea(e){var r={};return e!==null&&Object.keys(e).forEach(function(a){e[a].forEach(function(d){r[String(d)]=a})}),r}function ta(e,r){if(r=r||{},Object.keys(r).forEach(function(a){if(Qo.indexOf(a)===-1)throw new Te('Unknown option "'+a+'" is met in definition of "'+e+'" YAML type.')}),this.options=r,this.tag=e,this.kind=r.kind||null,this.resolve=r.resolve||function(){return!0},this.construct=r.construct||function(a){return a},this.instanceOf=r.instanceOf||null,this.predicate=r.predicate||null,this.represent=r.represent||null,this.representName=r.representName||null,this.defaultStyle=r.defaultStyle||null,this.multi=r.multi||!1,this.styleAliases=ea(r.styleAliases||null),Zo.indexOf(this.kind)===-1)throw new Te('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var _e=ta;function fi(e,r){var a=[];return e[r].forEach(function(d){var l=a.length;a.forEach(function(u,h){u.tag===d.tag&&u.kind===d.kind&&u.multi===d.multi&&(l=h)}),a[l]=d}),a}function na(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},r,a;function d(l){l.multi?(e.multi[l.kind].push(l),e.multi.fallback.push(l)):e[l.kind][l.tag]=e.fallback[l.tag]=l}for(r=0,a=arguments.length;r<a;r+=1)arguments[r].forEach(d);return e}function wn(e){return this.extend(e)}wn.prototype.extend=function(r){var a=[],d=[];if(r instanceof _e)d.push(r);else if(Array.isArray(r))d=d.concat(r);else if(r&&(Array.isArray(r.implicit)||Array.isArray(r.explicit)))r.implicit&&(a=a.concat(r.implicit)),r.explicit&&(d=d.concat(r.explicit));else throw new Te("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");a.forEach(function(u){if(!(u instanceof _e))throw new Te("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(u.loadKind&&u.loadKind!=="scalar")throw new Te("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(u.multi)throw new Te("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),d.forEach(function(u){if(!(u instanceof _e))throw new Te("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var l=Object.create(wn.prototype);return l.implicit=(this.implicit||[]).concat(a),l.explicit=(this.explicit||[]).concat(d),l.compiledImplicit=fi(l,"implicit"),l.compiledExplicit=fi(l,"explicit"),l.compiledTypeMap=na(l.compiledImplicit,l.compiledExplicit),l};var Pi=wn,Ii=new _e("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Li=new _e("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),zi=new _e("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Fi=new Pi({explicit:[Ii,Li,zi]});function ia(e){if(e===null)return!0;var r=e.length;return r===1&&e==="~"||r===4&&(e==="null"||e==="Null"||e==="NULL")}function ra(){return null}function oa(e){return e===null}var Di=new _e("tag:yaml.org,2002:null",{kind:"scalar",resolve:ia,construct:ra,predicate:oa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function aa(e){if(e===null)return!1;var r=e.length;return r===4&&(e==="true"||e==="True"||e==="TRUE")||r===5&&(e==="false"||e==="False"||e==="FALSE")}function sa(e){return e==="true"||e==="True"||e==="TRUE"}function la(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Ri=new _e("tag:yaml.org,2002:bool",{kind:"scalar",resolve:aa,construct:sa,predicate:la,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ca(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function da(e){return 48<=e&&e<=55}function ua(e){return 48<=e&&e<=57}function pa(e){if(e===null)return!1;var r=e.length,a=0,d=!1,l;if(!r)return!1;if(l=e[a],(l==="-"||l==="+")&&(l=e[++a]),l==="0"){if(a+1===r)return!0;if(l=e[++a],l==="b"){for(a++;a<r;a++)if(l=e[a],l!=="_"){if(l!=="0"&&l!=="1")return!1;d=!0}return d&&l!=="_"}if(l==="x"){for(a++;a<r;a++)if(l=e[a],l!=="_"){if(!ca(e.charCodeAt(a)))return!1;d=!0}return d&&l!=="_"}if(l==="o"){for(a++;a<r;a++)if(l=e[a],l!=="_"){if(!da(e.charCodeAt(a)))return!1;d=!0}return d&&l!=="_"}}if(l==="_")return!1;for(;a<r;a++)if(l=e[a],l!=="_"){if(!ua(e.charCodeAt(a)))return!1;d=!0}return!(!d||l==="_")}function ha(e){var r=e,a=1,d;if(r.indexOf("_")!==-1&&(r=r.replace(/_/g,"")),d=r[0],(d==="-"||d==="+")&&(d==="-"&&(a=-1),r=r.slice(1),d=r[0]),r==="0")return 0;if(d==="0"){if(r[1]==="b")return a*parseInt(r.slice(2),2);if(r[1]==="x")return a*parseInt(r.slice(2),16);if(r[1]==="o")return a*parseInt(r.slice(2),8)}return a*parseInt(r,10)}function fa(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!me.isNegativeZero(e)}var Bi=new _e("tag:yaml.org,2002:int",{kind:"scalar",resolve:pa,construct:ha,predicate:fa,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ga=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function ma(e){return!(e===null||!ga.test(e)||e[e.length-1]==="_")}function va(e){var r,a;return r=e.replace(/_/g,"").toLowerCase(),a=r[0]==="-"?-1:1,"+-".indexOf(r[0])>=0&&(r=r.slice(1)),r===".inf"?a===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:r===".nan"?NaN:a*parseFloat(r,10)}var ya=/^[-+]?[0-9]+e/;function ba(e,r){var a;if(isNaN(e))switch(r){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(r){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(r){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(me.isNegativeZero(e))return"-0.0";return a=e.toString(10),ya.test(a)?a.replace("e",".e"):a}function xa(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||me.isNegativeZero(e))}var ji=new _e("tag:yaml.org,2002:float",{kind:"scalar",resolve:ma,construct:va,predicate:xa,represent:ba,defaultStyle:"lowercase"}),Ni=Fi.extend({implicit:[Di,Ri,Bi,ji]}),qi=Ni,Hi=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Yi=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function _a(e){return e===null?!1:Hi.exec(e)!==null||Yi.exec(e)!==null}function wa(e){var r,a,d,l,u,h,m,g=0,b=null,S,_,k;if(r=Hi.exec(e),r===null&&(r=Yi.exec(e)),r===null)throw new Error("Date resolve error");if(a=+r[1],d=+r[2]-1,l=+r[3],!r[4])return new Date(Date.UTC(a,d,l));if(u=+r[4],h=+r[5],m=+r[6],r[7]){for(g=r[7].slice(0,3);g.length<3;)g+="0";g=+g}return r[9]&&(S=+r[10],_=+(r[11]||0),b=(S*60+_)*6e4,r[9]==="-"&&(b=-b)),k=new Date(Date.UTC(a,d,l,u,h,m,g)),b&&k.setTime(k.getTime()-b),k}function Sa(e){return e.toISOString()}var $i=new _e("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:_a,construct:wa,instanceOf:Date,represent:Sa});function ka(e){return e==="<<"||e===null}var Ui=new _e("tag:yaml.org,2002:merge",{kind:"scalar",resolve:ka}),An=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Ea(e){if(e===null)return!1;var r,a,d=0,l=e.length,u=An;for(a=0;a<l;a++)if(r=u.indexOf(e.charAt(a)),!(r>64)){if(r<0)return!1;d+=6}return d%8===0}function Ca(e){var r,a,d=e.replace(/[\r\n=]/g,""),l=d.length,u=An,h=0,m=[];for(r=0;r<l;r++)r%4===0&&r&&(m.push(h>>16&255),m.push(h>>8&255),m.push(h&255)),h=h<<6|u.indexOf(d.charAt(r));return a=l%4*6,a===0?(m.push(h>>16&255),m.push(h>>8&255),m.push(h&255)):a===18?(m.push(h>>10&255),m.push(h>>2&255)):a===12&&m.push(h>>4&255),new Uint8Array(m)}function Aa(e){var r="",a=0,d,l,u=e.length,h=An;for(d=0;d<u;d++)d%3===0&&d&&(r+=h[a>>18&63],r+=h[a>>12&63],r+=h[a>>6&63],r+=h[a&63]),a=(a<<8)+e[d];return l=u%3,l===0?(r+=h[a>>18&63],r+=h[a>>12&63],r+=h[a>>6&63],r+=h[a&63]):l===2?(r+=h[a>>10&63],r+=h[a>>4&63],r+=h[a<<2&63],r+=h[64]):l===1&&(r+=h[a>>2&63],r+=h[a<<4&63],r+=h[64],r+=h[64]),r}function Ta(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Ki=new _e("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Ea,construct:Ca,predicate:Ta,represent:Aa}),Oa=Object.prototype.hasOwnProperty,Ma=Object.prototype.toString;function Pa(e){if(e===null)return!0;var r=[],a,d,l,u,h,m=e;for(a=0,d=m.length;a<d;a+=1){if(l=m[a],h=!1,Ma.call(l)!=="[object Object]")return!1;for(u in l)if(Oa.call(l,u))if(!h)h=!0;else return!1;if(!h)return!1;if(r.indexOf(u)===-1)r.push(u);else return!1}return!0}function Ia(e){return e!==null?e:[]}var Wi=new _e("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Pa,construct:Ia}),La=Object.prototype.toString;function za(e){if(e===null)return!0;var r,a,d,l,u,h=e;for(u=new Array(h.length),r=0,a=h.length;r<a;r+=1){if(d=h[r],La.call(d)!=="[object Object]"||(l=Object.keys(d),l.length!==1))return!1;u[r]=[l[0],d[l[0]]]}return!0}function Fa(e){if(e===null)return[];var r,a,d,l,u,h=e;for(u=new Array(h.length),r=0,a=h.length;r<a;r+=1)d=h[r],l=Object.keys(d),u[r]=[l[0],d[l[0]]];return u}var Gi=new _e("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:za,construct:Fa}),Da=Object.prototype.hasOwnProperty;function Ra(e){if(e===null)return!0;var r,a=e;for(r in a)if(Da.call(a,r)&&a[r]!==null)return!1;return!0}function Ba(e){return e!==null?e:{}}var Xi=new _e("tag:yaml.org,2002:set",{kind:"mapping",resolve:Ra,construct:Ba}),Tn=qi.extend({implicit:[$i,Ui],explicit:[Ki,Wi,Gi,Xi]}),lt=Object.prototype.hasOwnProperty,Xt=1,Vi=2,Ji=3,Vt=4,_n=1,ja=2,gi=3,Na=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,qa=/[\x85\u2028\u2029]/,Ha=/[,\[\]\{\}]/,Qi=/^(?:!|!!|![a-z\-]+!)$/i,Zi=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function mi(e){return Object.prototype.toString.call(e)}function We(e){return e===10||e===13}function ft(e){return e===9||e===32}function Le(e){return e===9||e===32||e===10||e===13}function St(e){return e===44||e===91||e===93||e===123||e===125}function Ya(e){var r;return 48<=e&&e<=57?e-48:(r=e|32,97<=r&&r<=102?r-97+10:-1)}function $a(e){return e===120?2:e===117?4:e===85?8:0}function Ua(e){return 48<=e&&e<=57?e-48:-1}function vi(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Ka(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var er=new Array(256),tr=new Array(256);for(ht=0;ht<256;ht++)er[ht]=vi(ht)?1:0,tr[ht]=vi(ht);var ht;function Wa(e,r){this.input=e,this.filename=r.filename||null,this.schema=r.schema||Tn,this.onWarning=r.onWarning||null,this.legacy=r.legacy||!1,this.json=r.json||!1,this.listener=r.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function nr(e,r){var a={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return a.snippet=Jo(a),new Te(r,a)}function Y(e,r){throw nr(e,r)}function Jt(e,r){e.onWarning&&e.onWarning.call(null,nr(e,r))}var yi={YAML:function(r,a,d){var l,u,h;r.version!==null&&Y(r,"duplication of %YAML directive"),d.length!==1&&Y(r,"YAML directive accepts exactly one argument"),l=/^([0-9]+)\.([0-9]+)$/.exec(d[0]),l===null&&Y(r,"ill-formed argument of the YAML directive"),u=parseInt(l[1],10),h=parseInt(l[2],10),u!==1&&Y(r,"unacceptable YAML version of the document"),r.version=d[0],r.checkLineBreaks=h<2,h!==1&&h!==2&&Jt(r,"unsupported YAML version of the document")},TAG:function(r,a,d){var l,u;d.length!==2&&Y(r,"TAG directive accepts exactly two arguments"),l=d[0],u=d[1],Qi.test(l)||Y(r,"ill-formed tag handle (first argument) of the TAG directive"),lt.call(r.tagMap,l)&&Y(r,'there is a previously declared suffix for "'+l+'" tag handle'),Zi.test(u)||Y(r,"ill-formed tag prefix (second argument) of the TAG directive");try{u=decodeURIComponent(u)}catch{Y(r,"tag prefix is malformed: "+u)}r.tagMap[l]=u}};function st(e,r,a,d){var l,u,h,m;if(r<a){if(m=e.input.slice(r,a),d)for(l=0,u=m.length;l<u;l+=1)h=m.charCodeAt(l),h===9||32<=h&&h<=1114111||Y(e,"expected valid JSON character");else Na.test(m)&&Y(e,"the stream contains non-printable characters");e.result+=m}}function bi(e,r,a,d){var l,u,h,m;for(me.isObject(a)||Y(e,"cannot merge mappings; the provided source object is unacceptable"),l=Object.keys(a),h=0,m=l.length;h<m;h+=1)u=l[h],lt.call(r,u)||(r[u]=a[u],d[u]=!0)}function kt(e,r,a,d,l,u,h,m,g){var b,S;if(Array.isArray(l))for(l=Array.prototype.slice.call(l),b=0,S=l.length;b<S;b+=1)Array.isArray(l[b])&&Y(e,"nested arrays are not supported inside keys"),typeof l=="object"&&mi(l[b])==="[object Object]"&&(l[b]="[object Object]");if(typeof l=="object"&&mi(l)==="[object Object]"&&(l="[object Object]"),l=String(l),r===null&&(r={}),d==="tag:yaml.org,2002:merge")if(Array.isArray(u))for(b=0,S=u.length;b<S;b+=1)bi(e,r,u[b],a);else bi(e,r,u,a);else!e.json&&!lt.call(a,l)&&lt.call(r,l)&&(e.line=h||e.line,e.lineStart=m||e.lineStart,e.position=g||e.position,Y(e,"duplicated mapping key")),l==="__proto__"?Object.defineProperty(r,l,{configurable:!0,enumerable:!0,writable:!0,value:u}):r[l]=u,delete a[l];return r}function On(e){var r;r=e.input.charCodeAt(e.position),r===10?e.position++:r===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):Y(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function fe(e,r,a){for(var d=0,l=e.input.charCodeAt(e.position);l!==0;){for(;ft(l);)l===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),l=e.input.charCodeAt(++e.position);if(r&&l===35)do l=e.input.charCodeAt(++e.position);while(l!==10&&l!==13&&l!==0);if(We(l))for(On(e),l=e.input.charCodeAt(e.position),d++,e.lineIndent=0;l===32;)e.lineIndent++,l=e.input.charCodeAt(++e.position);else break}return a!==-1&&d!==0&&e.lineIndent<a&&Jt(e,"deficient indentation"),d}function en(e){var r=e.position,a;return a=e.input.charCodeAt(r),!!((a===45||a===46)&&a===e.input.charCodeAt(r+1)&&a===e.input.charCodeAt(r+2)&&(r+=3,a=e.input.charCodeAt(r),a===0||Le(a)))}function Mn(e,r){r===1?e.result+=" ":r>1&&(e.result+=me.repeat(`
`,r-1))}function Ga(e,r,a){var d,l,u,h,m,g,b,S,_=e.kind,k=e.result,T;if(T=e.input.charCodeAt(e.position),Le(T)||St(T)||T===35||T===38||T===42||T===33||T===124||T===62||T===39||T===34||T===37||T===64||T===96||(T===63||T===45)&&(l=e.input.charCodeAt(e.position+1),Le(l)||a&&St(l)))return!1;for(e.kind="scalar",e.result="",u=h=e.position,m=!1;T!==0;){if(T===58){if(l=e.input.charCodeAt(e.position+1),Le(l)||a&&St(l))break}else if(T===35){if(d=e.input.charCodeAt(e.position-1),Le(d))break}else{if(e.position===e.lineStart&&en(e)||a&&St(T))break;if(We(T))if(g=e.line,b=e.lineStart,S=e.lineIndent,fe(e,!1,-1),e.lineIndent>=r){m=!0,T=e.input.charCodeAt(e.position);continue}else{e.position=h,e.line=g,e.lineStart=b,e.lineIndent=S;break}}m&&(st(e,u,h,!1),Mn(e,e.line-g),u=h=e.position,m=!1),ft(T)||(h=e.position+1),T=e.input.charCodeAt(++e.position)}return st(e,u,h,!1),e.result?!0:(e.kind=_,e.result=k,!1)}function Xa(e,r){var a,d,l;if(a=e.input.charCodeAt(e.position),a!==39)return!1;for(e.kind="scalar",e.result="",e.position++,d=l=e.position;(a=e.input.charCodeAt(e.position))!==0;)if(a===39)if(st(e,d,e.position,!0),a=e.input.charCodeAt(++e.position),a===39)d=e.position,e.position++,l=e.position;else return!0;else We(a)?(st(e,d,l,!0),Mn(e,fe(e,!1,r)),d=l=e.position):e.position===e.lineStart&&en(e)?Y(e,"unexpected end of the document within a single quoted scalar"):(e.position++,l=e.position);Y(e,"unexpected end of the stream within a single quoted scalar")}function Va(e,r){var a,d,l,u,h,m;if(m=e.input.charCodeAt(e.position),m!==34)return!1;for(e.kind="scalar",e.result="",e.position++,a=d=e.position;(m=e.input.charCodeAt(e.position))!==0;){if(m===34)return st(e,a,e.position,!0),e.position++,!0;if(m===92){if(st(e,a,e.position,!0),m=e.input.charCodeAt(++e.position),We(m))fe(e,!1,r);else if(m<256&&er[m])e.result+=tr[m],e.position++;else if((h=$a(m))>0){for(l=h,u=0;l>0;l--)m=e.input.charCodeAt(++e.position),(h=Ya(m))>=0?u=(u<<4)+h:Y(e,"expected hexadecimal character");e.result+=Ka(u),e.position++}else Y(e,"unknown escape sequence");a=d=e.position}else We(m)?(st(e,a,d,!0),Mn(e,fe(e,!1,r)),a=d=e.position):e.position===e.lineStart&&en(e)?Y(e,"unexpected end of the document within a double quoted scalar"):(e.position++,d=e.position)}Y(e,"unexpected end of the stream within a double quoted scalar")}function Ja(e,r){var a=!0,d,l,u,h=e.tag,m,g=e.anchor,b,S,_,k,T,M=Object.create(null),A,L,j,q;if(q=e.input.charCodeAt(e.position),q===91)S=93,T=!1,m=[];else if(q===123)S=125,T=!0,m={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=m),q=e.input.charCodeAt(++e.position);q!==0;){if(fe(e,!0,r),q=e.input.charCodeAt(e.position),q===S)return e.position++,e.tag=h,e.anchor=g,e.kind=T?"mapping":"sequence",e.result=m,!0;a?q===44&&Y(e,"expected the node content, but found ','"):Y(e,"missed comma between flow collection entries"),L=A=j=null,_=k=!1,q===63&&(b=e.input.charCodeAt(e.position+1),Le(b)&&(_=k=!0,e.position++,fe(e,!0,r))),d=e.line,l=e.lineStart,u=e.position,Et(e,r,Xt,!1,!0),L=e.tag,A=e.result,fe(e,!0,r),q=e.input.charCodeAt(e.position),(k||e.line===d)&&q===58&&(_=!0,q=e.input.charCodeAt(++e.position),fe(e,!0,r),Et(e,r,Xt,!1,!0),j=e.result),T?kt(e,m,M,L,A,j,d,l,u):_?m.push(kt(e,null,M,L,A,j,d,l,u)):m.push(A),fe(e,!0,r),q=e.input.charCodeAt(e.position),q===44?(a=!0,q=e.input.charCodeAt(++e.position)):a=!1}Y(e,"unexpected end of the stream within a flow collection")}function Qa(e,r){var a,d,l=_n,u=!1,h=!1,m=r,g=0,b=!1,S,_;if(_=e.input.charCodeAt(e.position),_===124)d=!1;else if(_===62)d=!0;else return!1;for(e.kind="scalar",e.result="";_!==0;)if(_=e.input.charCodeAt(++e.position),_===43||_===45)_n===l?l=_===43?gi:ja:Y(e,"repeat of a chomping mode identifier");else if((S=Ua(_))>=0)S===0?Y(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):h?Y(e,"repeat of an indentation width identifier"):(m=r+S-1,h=!0);else break;if(ft(_)){do _=e.input.charCodeAt(++e.position);while(ft(_));if(_===35)do _=e.input.charCodeAt(++e.position);while(!We(_)&&_!==0)}for(;_!==0;){for(On(e),e.lineIndent=0,_=e.input.charCodeAt(e.position);(!h||e.lineIndent<m)&&_===32;)e.lineIndent++,_=e.input.charCodeAt(++e.position);if(!h&&e.lineIndent>m&&(m=e.lineIndent),We(_)){g++;continue}if(e.lineIndent<m){l===gi?e.result+=me.repeat(`
`,u?1+g:g):l===_n&&u&&(e.result+=`
`);break}for(d?ft(_)?(b=!0,e.result+=me.repeat(`
`,u?1+g:g)):b?(b=!1,e.result+=me.repeat(`
`,g+1)):g===0?u&&(e.result+=" "):e.result+=me.repeat(`
`,g):e.result+=me.repeat(`
`,u?1+g:g),u=!0,h=!0,g=0,a=e.position;!We(_)&&_!==0;)_=e.input.charCodeAt(++e.position);st(e,a,e.position,!1)}return!0}function xi(e,r){var a,d=e.tag,l=e.anchor,u=[],h,m=!1,g;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),g=e.input.charCodeAt(e.position);g!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,Y(e,"tab characters must not be used in indentation")),!(g!==45||(h=e.input.charCodeAt(e.position+1),!Le(h))));){if(m=!0,e.position++,fe(e,!0,-1)&&e.lineIndent<=r){u.push(null),g=e.input.charCodeAt(e.position);continue}if(a=e.line,Et(e,r,Ji,!1,!0),u.push(e.result),fe(e,!0,-1),g=e.input.charCodeAt(e.position),(e.line===a||e.lineIndent>r)&&g!==0)Y(e,"bad indentation of a sequence entry");else if(e.lineIndent<r)break}return m?(e.tag=d,e.anchor=l,e.kind="sequence",e.result=u,!0):!1}function Za(e,r,a){var d,l,u,h,m,g,b=e.tag,S=e.anchor,_={},k=Object.create(null),T=null,M=null,A=null,L=!1,j=!1,q;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=_),q=e.input.charCodeAt(e.position);q!==0;){if(!L&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,Y(e,"tab characters must not be used in indentation")),d=e.input.charCodeAt(e.position+1),u=e.line,(q===63||q===58)&&Le(d))q===63?(L&&(kt(e,_,k,T,M,null,h,m,g),T=M=A=null),j=!0,L=!0,l=!0):L?(L=!1,l=!0):Y(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,q=d;else{if(h=e.line,m=e.lineStart,g=e.position,!Et(e,a,Vi,!1,!0))break;if(e.line===u){for(q=e.input.charCodeAt(e.position);ft(q);)q=e.input.charCodeAt(++e.position);if(q===58)q=e.input.charCodeAt(++e.position),Le(q)||Y(e,"a whitespace character is expected after the key-value separator within a block mapping"),L&&(kt(e,_,k,T,M,null,h,m,g),T=M=A=null),j=!0,L=!1,l=!1,T=e.tag,M=e.result;else if(j)Y(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=b,e.anchor=S,!0}else if(j)Y(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=b,e.anchor=S,!0}if((e.line===u||e.lineIndent>r)&&(L&&(h=e.line,m=e.lineStart,g=e.position),Et(e,r,Vt,!0,l)&&(L?M=e.result:A=e.result),L||(kt(e,_,k,T,M,A,h,m,g),T=M=A=null),fe(e,!0,-1),q=e.input.charCodeAt(e.position)),(e.line===u||e.lineIndent>r)&&q!==0)Y(e,"bad indentation of a mapping entry");else if(e.lineIndent<r)break}return L&&kt(e,_,k,T,M,null,h,m,g),j&&(e.tag=b,e.anchor=S,e.kind="mapping",e.result=_),j}function es(e){var r,a=!1,d=!1,l,u,h;if(h=e.input.charCodeAt(e.position),h!==33)return!1;if(e.tag!==null&&Y(e,"duplication of a tag property"),h=e.input.charCodeAt(++e.position),h===60?(a=!0,h=e.input.charCodeAt(++e.position)):h===33?(d=!0,l="!!",h=e.input.charCodeAt(++e.position)):l="!",r=e.position,a){do h=e.input.charCodeAt(++e.position);while(h!==0&&h!==62);e.position<e.length?(u=e.input.slice(r,e.position),h=e.input.charCodeAt(++e.position)):Y(e,"unexpected end of the stream within a verbatim tag")}else{for(;h!==0&&!Le(h);)h===33&&(d?Y(e,"tag suffix cannot contain exclamation marks"):(l=e.input.slice(r-1,e.position+1),Qi.test(l)||Y(e,"named tag handle cannot contain such characters"),d=!0,r=e.position+1)),h=e.input.charCodeAt(++e.position);u=e.input.slice(r,e.position),Ha.test(u)&&Y(e,"tag suffix cannot contain flow indicator characters")}u&&!Zi.test(u)&&Y(e,"tag name cannot contain such characters: "+u);try{u=decodeURIComponent(u)}catch{Y(e,"tag name is malformed: "+u)}return a?e.tag=u:lt.call(e.tagMap,l)?e.tag=e.tagMap[l]+u:l==="!"?e.tag="!"+u:l==="!!"?e.tag="tag:yaml.org,2002:"+u:Y(e,'undeclared tag handle "'+l+'"'),!0}function ts(e){var r,a;if(a=e.input.charCodeAt(e.position),a!==38)return!1;for(e.anchor!==null&&Y(e,"duplication of an anchor property"),a=e.input.charCodeAt(++e.position),r=e.position;a!==0&&!Le(a)&&!St(a);)a=e.input.charCodeAt(++e.position);return e.position===r&&Y(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(r,e.position),!0}function ns(e){var r,a,d;if(d=e.input.charCodeAt(e.position),d!==42)return!1;for(d=e.input.charCodeAt(++e.position),r=e.position;d!==0&&!Le(d)&&!St(d);)d=e.input.charCodeAt(++e.position);return e.position===r&&Y(e,"name of an alias node must contain at least one character"),a=e.input.slice(r,e.position),lt.call(e.anchorMap,a)||Y(e,'unidentified alias "'+a+'"'),e.result=e.anchorMap[a],fe(e,!0,-1),!0}function Et(e,r,a,d,l){var u,h,m,g=1,b=!1,S=!1,_,k,T,M,A,L;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,u=h=m=Vt===a||Ji===a,d&&fe(e,!0,-1)&&(b=!0,e.lineIndent>r?g=1:e.lineIndent===r?g=0:e.lineIndent<r&&(g=-1)),g===1)for(;es(e)||ts(e);)fe(e,!0,-1)?(b=!0,m=u,e.lineIndent>r?g=1:e.lineIndent===r?g=0:e.lineIndent<r&&(g=-1)):m=!1;if(m&&(m=b||l),(g===1||Vt===a)&&(Xt===a||Vi===a?A=r:A=r+1,L=e.position-e.lineStart,g===1?m&&(xi(e,L)||Za(e,L,A))||Ja(e,A)?S=!0:(h&&Qa(e,A)||Xa(e,A)||Va(e,A)?S=!0:ns(e)?(S=!0,(e.tag!==null||e.anchor!==null)&&Y(e,"alias node should not have any properties")):Ga(e,A,Xt===a)&&(S=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):g===0&&(S=m&&xi(e,L))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&Y(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),_=0,k=e.implicitTypes.length;_<k;_+=1)if(M=e.implicitTypes[_],M.resolve(e.result)){e.result=M.construct(e.result),e.tag=M.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(lt.call(e.typeMap[e.kind||"fallback"],e.tag))M=e.typeMap[e.kind||"fallback"][e.tag];else for(M=null,T=e.typeMap.multi[e.kind||"fallback"],_=0,k=T.length;_<k;_+=1)if(e.tag.slice(0,T[_].tag.length)===T[_].tag){M=T[_];break}M||Y(e,"unknown tag !<"+e.tag+">"),e.result!==null&&M.kind!==e.kind&&Y(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+M.kind+'", not "'+e.kind+'"'),M.resolve(e.result,e.tag)?(e.result=M.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):Y(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||S}function is(e){var r=e.position,a,d,l,u=!1,h;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(h=e.input.charCodeAt(e.position))!==0&&(fe(e,!0,-1),h=e.input.charCodeAt(e.position),!(e.lineIndent>0||h!==37));){for(u=!0,h=e.input.charCodeAt(++e.position),a=e.position;h!==0&&!Le(h);)h=e.input.charCodeAt(++e.position);for(d=e.input.slice(a,e.position),l=[],d.length<1&&Y(e,"directive name must not be less than one character in length");h!==0;){for(;ft(h);)h=e.input.charCodeAt(++e.position);if(h===35){do h=e.input.charCodeAt(++e.position);while(h!==0&&!We(h));break}if(We(h))break;for(a=e.position;h!==0&&!Le(h);)h=e.input.charCodeAt(++e.position);l.push(e.input.slice(a,e.position))}h!==0&&On(e),lt.call(yi,d)?yi[d](e,d,l):Jt(e,'unknown document directive "'+d+'"')}if(fe(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,fe(e,!0,-1)):u&&Y(e,"directives end mark is expected"),Et(e,e.lineIndent-1,Vt,!1,!0),fe(e,!0,-1),e.checkLineBreaks&&qa.test(e.input.slice(r,e.position))&&Jt(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&en(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,fe(e,!0,-1));return}if(e.position<e.length-1)Y(e,"end of the stream or a document separator is expected");else return}function ir(e,r){e=String(e),r=r||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var a=new Wa(e,r),d=e.indexOf("\0");for(d!==-1&&(a.position=d,Y(a,"null byte is not allowed in input")),a.input+="\0";a.input.charCodeAt(a.position)===32;)a.lineIndent+=1,a.position+=1;for(;a.position<a.length-1;)is(a);return a.documents}function rs(e,r,a){r!==null&&typeof r=="object"&&typeof a=="undefined"&&(a=r,r=null);var d=ir(e,a);if(typeof r!="function")return d;for(var l=0,u=d.length;l<u;l+=1)r(d[l])}function os(e,r){var a=ir(e,r);if(a.length!==0){if(a.length===1)return a[0];throw new Te("expected a single document in the stream, but found more")}}var as=rs,ss=os,rr={loadAll:as,load:ss},or=Object.prototype.toString,ar=Object.prototype.hasOwnProperty,Pn=65279,ls=9,Ft=10,cs=13,ds=32,us=33,ps=34,Sn=35,hs=37,fs=38,gs=39,ms=42,sr=44,vs=45,Qt=58,ys=61,bs=62,xs=63,_s=64,lr=91,cr=93,ws=96,dr=123,Ss=124,ur=125,ke={};ke[0]="\\0";ke[7]="\\a";ke[8]="\\b";ke[9]="\\t";ke[10]="\\n";ke[11]="\\v";ke[12]="\\f";ke[13]="\\r";ke[27]="\\e";ke[34]='\\"';ke[92]="\\\\";ke[133]="\\N";ke[160]="\\_";ke[8232]="\\L";ke[8233]="\\P";var ks=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Es=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Cs(e,r){var a,d,l,u,h,m,g;if(r===null)return{};for(a={},d=Object.keys(r),l=0,u=d.length;l<u;l+=1)h=d[l],m=String(r[h]),h.slice(0,2)==="!!"&&(h="tag:yaml.org,2002:"+h.slice(2)),g=e.compiledTypeMap.fallback[h],g&&ar.call(g.styleAliases,m)&&(m=g.styleAliases[m]),a[h]=m;return a}function As(e){var r,a,d;if(r=e.toString(16).toUpperCase(),e<=255)a="x",d=2;else if(e<=65535)a="u",d=4;else if(e<=4294967295)a="U",d=8;else throw new Te("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+a+me.repeat("0",d-r.length)+r}var Ts=1,Dt=2;function Os(e){this.schema=e.schema||Tn,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=me.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Cs(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Dt:Ts,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function _i(e,r){for(var a=me.repeat(" ",r),d=0,l=-1,u="",h,m=e.length;d<m;)l=e.indexOf(`
`,d),l===-1?(h=e.slice(d),d=m):(h=e.slice(d,l+1),d=l+1),h.length&&h!==`
`&&(u+=a),u+=h;return u}function kn(e,r){return`
`+me.repeat(" ",e.indent*r)}function Ms(e,r){var a,d,l;for(a=0,d=e.implicitTypes.length;a<d;a+=1)if(l=e.implicitTypes[a],l.resolve(r))return!0;return!1}function Zt(e){return e===ds||e===ls}function Rt(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Pn||65536<=e&&e<=1114111}function wi(e){return Rt(e)&&e!==Pn&&e!==cs&&e!==Ft}function Si(e,r,a){var d=wi(e),l=d&&!Zt(e);return(a?d:d&&e!==sr&&e!==lr&&e!==cr&&e!==dr&&e!==ur)&&e!==Sn&&!(r===Qt&&!l)||wi(r)&&!Zt(r)&&e===Sn||r===Qt&&l}function Ps(e){return Rt(e)&&e!==Pn&&!Zt(e)&&e!==vs&&e!==xs&&e!==Qt&&e!==sr&&e!==lr&&e!==cr&&e!==dr&&e!==ur&&e!==Sn&&e!==fs&&e!==ms&&e!==us&&e!==Ss&&e!==ys&&e!==bs&&e!==gs&&e!==ps&&e!==hs&&e!==_s&&e!==ws}function Is(e){return!Zt(e)&&e!==Qt}function Lt(e,r){var a=e.charCodeAt(r),d;return a>=55296&&a<=56319&&r+1<e.length&&(d=e.charCodeAt(r+1),d>=56320&&d<=57343)?(a-55296)*1024+d-56320+65536:a}function pr(e){var r=/^\n* /;return r.test(e)}var hr=1,En=2,fr=3,gr=4,wt=5;function Ls(e,r,a,d,l,u,h,m){var g,b=0,S=null,_=!1,k=!1,T=d!==-1,M=-1,A=Ps(Lt(e,0))&&Is(Lt(e,e.length-1));if(r||h)for(g=0;g<e.length;b>=65536?g+=2:g++){if(b=Lt(e,g),!Rt(b))return wt;A=A&&Si(b,S,m),S=b}else{for(g=0;g<e.length;b>=65536?g+=2:g++){if(b=Lt(e,g),b===Ft)_=!0,T&&(k=k||g-M-1>d&&e[M+1]!==" ",M=g);else if(!Rt(b))return wt;A=A&&Si(b,S,m),S=b}k=k||T&&g-M-1>d&&e[M+1]!==" "}return!_&&!k?A&&!h&&!l(e)?hr:u===Dt?wt:En:a>9&&pr(e)?wt:h?u===Dt?wt:En:k?gr:fr}function zs(e,r,a,d,l){e.dump=(function(){if(r.length===0)return e.quotingType===Dt?'""':"''";if(!e.noCompatMode&&(ks.indexOf(r)!==-1||Es.test(r)))return e.quotingType===Dt?'"'+r+'"':"'"+r+"'";var u=e.indent*Math.max(1,a),h=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-u),m=d||e.flowLevel>-1&&a>=e.flowLevel;function g(b){return Ms(e,b)}switch(Ls(r,m,e.indent,h,g,e.quotingType,e.forceQuotes&&!d,l)){case hr:return r;case En:return"'"+r.replace(/'/g,"''")+"'";case fr:return"|"+ki(r,e.indent)+Ei(_i(r,u));case gr:return">"+ki(r,e.indent)+Ei(_i(Fs(r,h),u));case wt:return'"'+Ds(r)+'"';default:throw new Te("impossible error: invalid scalar style")}})()}function ki(e,r){var a=pr(e)?String(r):"",d=e[e.length-1]===`
`,l=d&&(e[e.length-2]===`
`||e===`
`),u=l?"+":d?"":"-";return a+u+`
`}function Ei(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Fs(e,r){for(var a=/(\n+)([^\n]*)/g,d=(function(){var b=e.indexOf(`
`);return b=b!==-1?b:e.length,a.lastIndex=b,Ci(e.slice(0,b),r)})(),l=e[0]===`
`||e[0]===" ",u,h;h=a.exec(e);){var m=h[1],g=h[2];u=g[0]===" ",d+=m+(!l&&!u&&g!==""?`
`:"")+Ci(g,r),l=u}return d}function Ci(e,r){if(e===""||e[0]===" ")return e;for(var a=/ [^ ]/g,d,l=0,u,h=0,m=0,g="";d=a.exec(e);)m=d.index,m-l>r&&(u=h>l?h:m,g+=`
`+e.slice(l,u),l=u+1),h=m;return g+=`
`,e.length-l>r&&h>l?g+=e.slice(l,h)+`
`+e.slice(h+1):g+=e.slice(l),g.slice(1)}function Ds(e){for(var r="",a=0,d,l=0;l<e.length;a>=65536?l+=2:l++)a=Lt(e,l),d=ke[a],!d&&Rt(a)?(r+=e[l],a>=65536&&(r+=e[l+1])):r+=d||As(a);return r}function Rs(e,r,a){var d="",l=e.tag,u,h,m;for(u=0,h=a.length;u<h;u+=1)m=a[u],e.replacer&&(m=e.replacer.call(a,String(u),m)),(Ze(e,r,m,!1,!1)||typeof m=="undefined"&&Ze(e,r,null,!1,!1))&&(d!==""&&(d+=","+(e.condenseFlow?"":" ")),d+=e.dump);e.tag=l,e.dump="["+d+"]"}function Ai(e,r,a,d){var l="",u=e.tag,h,m,g;for(h=0,m=a.length;h<m;h+=1)g=a[h],e.replacer&&(g=e.replacer.call(a,String(h),g)),(Ze(e,r+1,g,!0,!0,!1,!0)||typeof g=="undefined"&&Ze(e,r+1,null,!0,!0,!1,!0))&&((!d||l!=="")&&(l+=kn(e,r)),e.dump&&Ft===e.dump.charCodeAt(0)?l+="-":l+="- ",l+=e.dump);e.tag=u,e.dump=l||"[]"}function Bs(e,r,a){var d="",l=e.tag,u=Object.keys(a),h,m,g,b,S;for(h=0,m=u.length;h<m;h+=1)S="",d!==""&&(S+=", "),e.condenseFlow&&(S+='"'),g=u[h],b=a[g],e.replacer&&(b=e.replacer.call(a,g,b)),Ze(e,r,g,!1,!1)&&(e.dump.length>1024&&(S+="? "),S+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Ze(e,r,b,!1,!1)&&(S+=e.dump,d+=S));e.tag=l,e.dump="{"+d+"}"}function js(e,r,a,d){var l="",u=e.tag,h=Object.keys(a),m,g,b,S,_,k;if(e.sortKeys===!0)h.sort();else if(typeof e.sortKeys=="function")h.sort(e.sortKeys);else if(e.sortKeys)throw new Te("sortKeys must be a boolean or a function");for(m=0,g=h.length;m<g;m+=1)k="",(!d||l!=="")&&(k+=kn(e,r)),b=h[m],S=a[b],e.replacer&&(S=e.replacer.call(a,b,S)),Ze(e,r+1,b,!0,!0,!0)&&(_=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,_&&(e.dump&&Ft===e.dump.charCodeAt(0)?k+="?":k+="? "),k+=e.dump,_&&(k+=kn(e,r)),Ze(e,r+1,S,!0,_)&&(e.dump&&Ft===e.dump.charCodeAt(0)?k+=":":k+=": ",k+=e.dump,l+=k));e.tag=u,e.dump=l||"{}"}function Ti(e,r,a){var d,l,u,h,m,g;for(l=a?e.explicitTypes:e.implicitTypes,u=0,h=l.length;u<h;u+=1)if(m=l[u],(m.instanceOf||m.predicate)&&(!m.instanceOf||typeof r=="object"&&r instanceof m.instanceOf)&&(!m.predicate||m.predicate(r))){if(a?m.multi&&m.representName?e.tag=m.representName(r):e.tag=m.tag:e.tag="?",m.represent){if(g=e.styleMap[m.tag]||m.defaultStyle,or.call(m.represent)==="[object Function]")d=m.represent(r,g);else if(ar.call(m.represent,g))d=m.represent[g](r,g);else throw new Te("!<"+m.tag+'> tag resolver accepts not "'+g+'" style');e.dump=d}return!0}return!1}function Ze(e,r,a,d,l,u,h){e.tag=null,e.dump=a,Ti(e,a,!1)||Ti(e,a,!0);var m=or.call(e.dump),g=d,b;d&&(d=e.flowLevel<0||e.flowLevel>r);var S=m==="[object Object]"||m==="[object Array]",_,k;if(S&&(_=e.duplicates.indexOf(a),k=_!==-1),(e.tag!==null&&e.tag!=="?"||k||e.indent!==2&&r>0)&&(l=!1),k&&e.usedDuplicates[_])e.dump="*ref_"+_;else{if(S&&k&&!e.usedDuplicates[_]&&(e.usedDuplicates[_]=!0),m==="[object Object]")d&&Object.keys(e.dump).length!==0?(js(e,r,e.dump,l),k&&(e.dump="&ref_"+_+e.dump)):(Bs(e,r,e.dump),k&&(e.dump="&ref_"+_+" "+e.dump));else if(m==="[object Array]")d&&e.dump.length!==0?(e.noArrayIndent&&!h&&r>0?Ai(e,r-1,e.dump,l):Ai(e,r,e.dump,l),k&&(e.dump="&ref_"+_+e.dump)):(Rs(e,r,e.dump),k&&(e.dump="&ref_"+_+" "+e.dump));else if(m==="[object String]")e.tag!=="?"&&zs(e,e.dump,r,u,g);else{if(m==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new Te("unacceptable kind of an object to dump "+m)}e.tag!==null&&e.tag!=="?"&&(b=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?b="!"+b:b.slice(0,18)==="tag:yaml.org,2002:"?b="!!"+b.slice(18):b="!<"+b+">",e.dump=b+" "+e.dump)}return!0}function Ns(e,r){var a=[],d=[],l,u;for(Cn(e,a,d),l=0,u=d.length;l<u;l+=1)r.duplicates.push(a[d[l]]);r.usedDuplicates=new Array(u)}function Cn(e,r,a){var d,l,u;if(e!==null&&typeof e=="object")if(l=r.indexOf(e),l!==-1)a.indexOf(l)===-1&&a.push(l);else if(r.push(e),Array.isArray(e))for(l=0,u=e.length;l<u;l+=1)Cn(e[l],r,a);else for(d=Object.keys(e),l=0,u=d.length;l<u;l+=1)Cn(e[d[l]],r,a)}function qs(e,r){r=r||{};var a=new Os(r);a.noRefs||Ns(e,a);var d=e;return a.replacer&&(d=a.replacer.call({"":d},"",d)),Ze(a,0,d,!0,!0)?a.dump+`
`:""}var Hs=qs,Ys={dump:Hs};function In(e,r){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+r+" instead, which is now safe by default.")}}var $s=_e,Us=Pi,Ks=Fi,Ws=Ni,Gs=qi,Xs=Tn,Vs=rr.load,Js=rr.loadAll,Qs=Ys.dump,Zs=Te,el={binary:Ki,float:ji,map:zi,null:Di,pairs:Gi,set:Xi,timestamp:$i,bool:Ri,int:Bi,merge:Ui,omap:Wi,seq:Li,str:Ii},tl=In("safeLoad","load"),nl=In("safeLoadAll","loadAll"),il=In("safeDump","dump"),rl={Type:$s,Schema:Us,FAILSAFE_SCHEMA:Ks,JSON_SCHEMA:Ws,CORE_SCHEMA:Gs,DEFAULT_SCHEMA:Xs,load:Vs,loadAll:Js,dump:Qs,YAMLException:Zs,types:el,safeLoad:tl,safeLoadAll:nl,safeDump:il},mr=rl;window.interact||(window.interact=yr.default);window.jsyaml||(window.jsyaml=mr);var ol="0.1.11";console.info(`%c drag-and-drop-card %c v${ol} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var al=(e,...r)=>console.debug(`[drag-and-drop-card] ${e}`,...r);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var vr=()=>new Promise(e=>requestAnimationFrame(()=>e())),sl=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),Ln=class e extends HTMLElement{static getConfigElement(){let r=document.createElement("div");r.innerHTML=`
      <style>
        .cfg-row{display:flex;gap:12px;align-items:center;margin:8px 0;flex-wrap:wrap}
        input[type="text"],input[type="number"],select{
          padding:6px;border-radius:8px;border:1px solid var(--divider-color);
          background:var(--primary-background-color);color:var(--primary-text-color)
        }
        label{font-weight:600;min-width:130px}
        .inline{display:inline-flex;gap:8px;align-items:center}
        .hint{opacity:.65;font-size:.85rem}
      </style>
  
      <div class="cfg-row">
        <label>Storage key</label>
        <input type="text" id="storage_key" placeholder="e.g. livingroom_layout">
      </div>
  
      <div class="cfg-row">
        <label>Grid (px)</label>
        <input type="number" id="grid" min="5" step="1" value="10">
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="liveSnap"> Snap while dragging (live)</label>
      </div>
  
      <div class="cfg-row">
        <label>Auto-save</label>
        <input type="checkbox" id="autoSave" checked>
        <span style="margin-left:auto">Debounce (ms)</span>
        <input type="number" id="autoSaveDebounce" min="0" step="50" value="800" style="width:90px">
      </div>
  
      <div class="cfg-row">
        <label>Container BG</label>
        <input type="text" id="containerBg" placeholder="transparent">
      </div>
  
      <div class="cfg-row">
        <label>Card BG</label>
        <input type="text" id="cardBg" placeholder="var(--ha-card-background, var(--card-background-color))">
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="debug"> Debug logs</label>
      </div>
  
      <div class="cfg-row">
        <label><input type="checkbox" id="noOverlap"> Disable overlapping</label>
      </div>
  
      <!-- NEW: container sizing -->
      <div class="cfg-row">
        <label>Container size</label>
        <select id="sizeMode">
          <option value="dynamic">Dynamic (auto)</option>
          <option value="fixed_custom">User preference (px)</option>
          <option value="preset">Preset</option>
        </select>
  
        <span id="sizeCustom" class="inline" style="display:none">
          W <input type="number" id="sizeW" min="100" step="10" style="width:110px">
          H <input type="number" id="sizeH" min="100" step="10" style="width:110px">
        </span>
  
        <span id="sizePresetWrap" class="inline" style="display:none">
          <select id="sizePreset" style="min-width:240px"></select>
          <select id="sizeOrientation">
            <option value="auto">Auto</option>
            <option value="portrait">Portrait</option>
            <option value="landscape">Landscape</option>
          </select>
        </span>
        <span class="hint">In fixed mode, cards cannot leave the box.</span>
      </div>
    `;let a=e._sizePresets(),d=r.querySelector("#sizePreset"),l=(g,b)=>{let S=document.createElement("optgroup");S.label=g,b.forEach(_=>{let k=document.createElement("option");k.value=_.key,k.textContent=`${_.label} (${_.w}\xD7${_.h})`,d.appendChild(k)}),d.appendChild(S)};[["Phones",a.filter(g=>g.group==="phone")],["Tablets",a.filter(g=>g.group==="tablet")],["Desktop",a.filter(g=>g.group==="desktop")]].forEach(([g,b])=>{if(!b.length)return;let S=document.createElement("optgroup");S.label=g,b.forEach(_=>{let k=document.createElement("option");k.value=_.key,k.textContent=`${_.label} (${_.w}\xD7${_.h})`,S.appendChild(k)}),d.appendChild(S)});let u=()=>{let g=r.querySelector("#sizeMode").value;r.querySelector("#sizeCustom").style.display=g==="fixed_custom"?"inline-flex":"none",r.querySelector("#sizePresetWrap").style.display=g==="preset"?"inline-flex":"none"};r.setConfig=(g={})=>{var b,S,_,k,T,M;r._config={type:g.type||"custom:drag-and-drop-card",...g},r.querySelector("#storage_key").value=g.storage_key||"",r.querySelector("#grid").value=(b=g.grid)!=null?b:10,r.querySelector("#liveSnap").checked=!!g.drag_live_snap,r.querySelector("#autoSave").checked=g.auto_save!==!1,r.querySelector("#autoSaveDebounce").value=(S=g.auto_save_debounce)!=null?S:800,r.querySelector("#containerBg").value=(_=g.container_background)!=null?_:"transparent",r.querySelector("#cardBg").value=(k=g.card_background)!=null?k:"var(--ha-card-background, var(--card-background-color))",r.querySelector("#debug").checked=!!g.debug,r.querySelector("#noOverlap").checked=!!g.disable_overlap,r.querySelector("#sizeMode").value=g.container_size_mode||"dynamic",r.querySelector("#sizeW").value=(T=g.container_fixed_width)!=null?T:"",r.querySelector("#sizeH").value=(M=g.container_fixed_height)!=null?M:"",r.querySelector("#sizePreset").value=g.container_preset||"fullhd",r.querySelector("#sizeOrientation").value=g.container_preset_orientation||"auto",u()},r.getConfig=()=>{let g={...r._config||{type:"custom:drag-and-drop-card"}};return g.type=g.type||"custom:drag-and-drop-card",g.storage_key=r.querySelector("#storage_key").value||void 0,g.grid=Number(r.querySelector("#grid").value||10),g.drag_live_snap=!!r.querySelector("#liveSnap").checked,g.auto_save=!!r.querySelector("#autoSave").checked,g.auto_save_debounce=Number(r.querySelector("#autoSaveDebounce").value||800),g.container_background=r.querySelector("#containerBg").value||"transparent",g.card_background=r.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",g.debug=!!r.querySelector("#debug").checked,g.disable_overlap=!!r.querySelector("#noOverlap").checked,g.container_size_mode=r.querySelector("#sizeMode").value,g.container_fixed_width=Number(r.querySelector("#sizeW").value||0)||void 0,g.container_fixed_height=Number(r.querySelector("#sizeH").value||0)||void 0,g.container_preset=r.querySelector("#sizePreset").value||void 0,g.container_preset_orientation=r.querySelector("#sizeOrientation").value||"auto",g};let h=()=>{r.dispatchEvent(new CustomEvent("config-changed",{detail:{config:r.getConfig()}}))},m=(g,b="input")=>{var S;return(S=r.querySelector(g))==null?void 0:S.addEventListener(b,()=>{g==="#sizeMode"&&u(),h()})};return m("#storage_key"),m("#grid"),m("#liveSnap","change"),m("#autoSave","change"),m("#autoSaveDebounce"),m("#containerBg"),m("#cardBg"),m("#debug","change"),m("#noOverlap","change"),m("#sizeMode","change"),m("#sizeW"),m("#sizeH"),m("#sizePreset","change"),m("#sizeOrientation","change"),r}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let r=Math.max(100,Number(this.containerFixedWidth||0)),a=Math.max(100,Number(this.containerFixedHeight||0));return{w:r,h:a}}if(this.containerSizeMode==="preset"){let r=e._sizePresets().find(l=>l.key===this.containerPreset)||e._sizePresets().find(l=>l.key==="fhd");if(!r)return{w:1920,h:1080};let a=r.w,d=r.h;return this.containerPresetOrient==="portrait"&&a>d&&([a,d]=[d,a]),this.containerPresetOrient==="landscape"&&d>a&&([a,d]=[d,a]),{w:a,h:d}}return null}_applyContainerSizingFromConfig(r=!1){var d,l;let a=this.cardContainer;if(a)if(this._isContainerFixed()){let{w:u,h}=this._resolveFixedSize();a.style.width=`${u}px`,a.style.height=`${h}px`,a.style.overflow="hidden",r||(d=this._dbgPush)==null||d.call(this,"size","Applied fixed size",{w:u,h,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else a.style.overflow="hidden",r||(l=this._dbgPush)==null||l.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let r=this.cardContainer;if(!r)return{w:0,h:0};let a=parseFloat(getComputedStyle(r).width)||r.getBoundingClientRect().width,d=parseFloat(getComputedStyle(r).height)||r.getBoundingClientRect().height;return{w:a,h:d}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:r,h:a}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(l=>{let u=parseFloat(l.getAttribute("data-x"))||0,h=parseFloat(l.getAttribute("data-y"))||0,m=parseFloat(l.style.width)||l.getBoundingClientRect().width,g=parseFloat(l.style.height)||l.getBoundingClientRect().height,b=Math.max(0,Math.min(u,Math.max(0,r-m))),S=Math.max(0,Math.min(h,Math.max(0,a-g))),_=Math.min(m,r),k=Math.min(g,a);(_!==m||k!==g)&&(l.style.width=`${_}px`,l.style.height=`${k}px`);let T=Math.max(0,Math.min(b,Math.max(0,r-_))),M=Math.max(0,Math.min(S,Math.max(0,a-k)));this._setCardPosition(l,T,M)})}_applyGridVars(){var a;let r=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",r),(a=this.cardContainer)==null||a.style.setProperty("--ddc-grid-size",r)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(r,a,d=null){let l={t:new Date().toISOString(),kind:r,msg:a,extra:d};this._dbgBuffer.push(l),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${r}]%c ${a}`,"color:#03a9f4","color:unset",d!=null?d:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(r){return String(r).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}setConfig(r={}){var a,d,l,u,h,m;if(this._config=r,this.storageKey=r.storage_key||void 0,this.gridSize=Number((a=r.grid)!=null?a:10),this.dragLiveSnap=!!r.drag_live_snap,this.autoSave=r.auto_save!==!1,this.autoSaveDebounce=Number((d=r.auto_save_debounce)!=null?d:800),this.containerBackground=(l=r.container_background)!=null?l:"transparent",this.cardBackground=(u=r.card_background)!=null?u:"var(--ha-card-background, var(--card-background-color))",this.debug=!!r.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!r.disable_overlap,this.containerSizeMode=r.container_size_mode||"dynamic",this.containerFixedWidth=Number((h=r.container_fixed_width)!=null?h:0)||null,this.containerFixedHeight=Number((m=r.container_fixed_height)!=null?m:0)||null,this.containerPreset=r.container_preset||"fullhd",this.containerPresetOrient=r.container_preset_orientation||"auto",this.cardContainer&&this._applyContainerSizingFromConfig(!1),this._applyGridVars(),this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:r.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let g=document.createElement("script");g.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(g)}if(!window.interact){let g=document.createElement("script");g.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",g.onload=()=>this._initInteract(),document.head.appendChild(g)}this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),this._built||(this._built=!0,this.innerHTML=`
        <style>
          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            padding: 10px;
            border: 1px solid var(--divider-color);
            background: var(--ddc-bg, transparent);
            width: auto; height: auto; border-radius: 12px; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }
          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:0;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab; overflow:hidden; border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:1;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
          .chip{
            position:absolute;top:8px;right:8px;display:flex;gap:6px;opacity:0;transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .chip .mini{
            display:inline-flex;align-items:center;gap:6px;
            background:rgba(28,28,30,.78);color:#fff;border:1px solid rgba(255,255,255,.18);
            border-radius:999px;padding:6px 10px;font-size:.76rem;cursor:pointer;letter-spacing:.2px;
            box-shadow:0 2px 6px rgba(0,0,0,.25); transition:transform .08s, background .12s, box-shadow .12s
          }
          .chip .mini:hover{transform:translateY(-1px); background:rgba(28,28,30,.95); box-shadow:0 3px 10px rgba(0,0,0,.35)}
          .chip .mini ha-icon{--mdc-icon-size:18px;width:18px;height:18px}
          .chip .mini.danger{background:rgba(220, 38, 38, .9);border-color:rgba(255,255,255,.22)}
          .chip .mini.danger:hover{background:rgba(220, 38, 38, 1)}
          .chip .mini.pill{padding:6px}

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:none; position:absolute;bottom:6px;right:6px;width:30px;height:30px;border-radius:50%;
            background:var(--primary-color);color:#fff;border:1px solid rgba(255,255,255,.25);
            cursor:se-resize;z-index:22;box-shadow:0 3px 8px rgba(0,0,0,.28);
            align-items:center;justify-content:center;transition:transform .1s, box-shadow .1s, background .12s;
          }
          .resize-handle:hover{transform:scale(1.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{--mdc-icon-size:18px;width:18px;height:18px;pointer-events:none}

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96vw);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{border-right:1px solid var(--divider-color);overflow:auto;background:var(--primary-background-color)}
          #rightPane{overflow:hidden;background:var(--primary-background-color)}
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);overflow:visible;position:relative}
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}

          /* --- FIX: YAML editor should scroll and not overflow --- */
          #yamlSec { min-height: 0; }
          #yamlSec .bd { 
            overflow: auto;        /* allow scrolling inside the YAML section */
            max-height: 320px;     /* keep the section tidy; adjust if you like */
          }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: fixed and scroll inside */
          ha-code-editor { 
            display: block; 
            height: 260px !important; 
          }
          .CodeMirror { 
            height: 260px !important; 
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            max-height: 260px; 
            overflow: auto; 
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            display:flex;align-items:center;justify-content:center;width:100%;height:100%;
            background:repeating-conic-gradient(from 45deg, rgba(0,0,0,.05) 0% 25%, transparent 0% 50%) 50% / 14px 14px;pointer-events: none;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }

          /* --- Card Picker: entrance/exit animation, shimmer & scan --- */
          /* Backdrop \u201Cscan\u201D overlay */
          .modal::after {
            content:"";
            position:absolute; inset:0; pointer-events:none;
            background:
              linear-gradient(120deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,0) 30%, rgba(255,255,255,.06) 60%),
              linear-gradient(180deg, rgba(3,169,244,.06), transparent);
            opacity:0;
          }
          .modal.opening::after {
            animation: ddc-scan 1100ms ease-out forwards;
          }
          @keyframes ddc-scan {
            0%   { opacity:.0; transform: translateX(-10%) }
            25%  { opacity:.7; transform: translateX(0%) }
            100% { opacity:0;  transform: translateX(14%) }
          }

          /* Dialog pop with a touch of blur \u201Cmaterialize\u201D */
          .dialog {
            transform-origin: 50% 44%;
            opacity: 0;
            transform: translateY(8px) scale(.97);
            filter: blur(4px);
            will-change: transform, opacity, filter;
          }
          .modal.opening .dialog {
            animation: ddc-dialog-in 380ms cubic-bezier(.2,.8,.2,1) forwards;
          }
          .modal.closing .dialog {
            animation: ddc-dialog-out 220ms cubic-bezier(.2,.8,.2,1) forwards;
          }
          @keyframes ddc-dialog-in {
            0%   { opacity: 0; transform: translateY(8px) scale(.97); filter: blur(4px); }
            60%  { opacity: 1; transform: translateY(0) scale(1.005); filter: blur(0px); }
            100% { opacity: 1; transform: translateY(0) scale(1);    filter: blur(0px); }
          }
          @keyframes ddc-dialog-out {
            0%   { opacity: 1; transform: translateY(0) scale(1);    filter: blur(0px); }
            100% { opacity: 0; transform: translateY(6px) scale(.985); filter: blur(3px); }
          }

          /* Stagger list items in the left pane for a crisp entrance */
          #leftPane .section-enter {
            opacity: 0; transform: translateY(4px);
            animation: ddc-stagger .28s ease-out forwards;
          }
          @keyframes ddc-stagger {
            to { opacity:1; transform:none; }
          }

          /* Indeterminate top progress bar (subtle) while initial editors mount */
          .ddc-indicator {
            position: absolute; left: 0; right: 0; top: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            opacity: .0; pointer-events: none; z-index: 2;
          }
          .modal.opening .ddc-indicator { opacity: .75; }
          .modal.opened  .ddc-indicator { opacity: .0; transition: opacity .25s ease .2s; }
          .ddc-indicator::before {
            content: "";
            position: absolute; inset: 0;
            transform: translateX(-60%);
            animation: ddc-sweep 1.1s linear infinite;
            background: currentColor;
          }
          @keyframes ddc-sweep {
            0%   { transform: translateX(-60%); }
            100% { transform: translateX(160%); }
          }

          /* Small shimmer for quick-fill placeholders (only visible if your quick-fill adds skeletons) */
          .ddc-shimmer {
            position: relative; overflow: hidden; background: rgba(0,0,0,.06);
          }
          .modal.opened .dialog {
            opacity: 1 !important;
            transform: none !important;
            filter: none !important;
          }

          .ddc-shimmer::after {
            content:""; position:absolute; inset:0;
            background: linear-gradient(110deg, transparent 0%, rgba(255,255,255,.35) 45%, transparent 90%);
            transform: translateX(-100%);
            animation: ddc-shimmer 1.2s ease-in-out infinite;
          }
          @keyframes ddc-shimmer { to { transform: translateX(100%); } }


        </style>
        <div class="ddc-root">
          <div class="toolbar">
            <button class="btn" id="addCardBtn" style="display:none">
              <ha-icon icon="mdi:plus"></ha-icon>
              <span style="margin-left:6px">Add Card</span>
            </button>
            <button class="btn secondary" id="reloadBtn" style="display:none">
              <ha-icon icon="mdi:refresh"></ha-icon>
              <span style="margin-left:6px">Reload</span>
            </button>
            <button class="btn secondary" id="diagBtn" style="display:none">
              <ha-icon icon="mdi:play-circle-outline"></ha-icon>
              <span style="margin-left:6px">Diagnostics</span>
            </button>
            <button class="btn secondary" id="exportBtn" style="display:none">
              <ha-icon icon="mdi:download"></ha-icon>
              <span style="margin-left:6px">Export Design</span>
            </button>
            <button class="btn secondary" id="importBtn" style="display:none">
              <ha-icon icon="mdi:upload"></ha-icon>
              <span style="margin-left:6px">Import Design</span>
            </button>
            <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
              <ha-icon icon="mdi:storefront-outline"></ha-icon>
              <span>Open HADS</span>
            </button>
            <button class="btn warning" id="exitEditBtn" style="display:none">
              <ha-icon icon="mdi:exit-run"></ha-icon>
              <span>Exit edit mode</span>
            </button>
            <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
          </div>
          <div class="card-container" id="cardContainer"></div>
        </div>
      `,this.cardContainer=this.querySelector("#cardContainer"),this.addButton=this.querySelector("#addCardBtn"),this.reloadBtn=this.querySelector("#reloadBtn"),this.diagBtn=this.querySelector("#diagBtn"),this.exitEditBtn=this.querySelector("#exitEditBtn"),this.storeBadge=this.querySelector("#storeBadge"),this.exportBtn=this.querySelector("#exportBtn"),this.importBtn=this.querySelector("#importBtn"),this.exploreBtn=this.querySelector("#exploreBtn"),this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.exploreBtn.addEventListener("click",()=>window.open("https://cardstore.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),this._installLongPressToEnterEdit(),window.addEventListener("keydown",g=>{g.key==="Escape"&&this.editMode&&this._toggleEditMode(!1)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",g=>{this.editMode&&(g.target.closest(".card-wrapper")||!g.shiftKey&&!g.ctrlKey&&!g.metaKey&&this._clearSelection())})),this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),this._initialLoad()}connectedCallback(){this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1)}disconnectedCallback(){if(window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis),this.__lpInstalled&&this.__lpHandlers){let r=this.cardContainer;r==null||r.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),r==null||r.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}}set hass(r){var d;this._hass=r,al("set hass"),!this.__probed&&r&&(this.__probed=!0,this._probeBackend().then(()=>this._initialLoad(!0)));let a=((d=this.cardContainer)==null?void 0:d.children)||[];for(let l of a){let u=l.firstElementChild;u&&u.hass!==r&&(u.hass=r)}}get hass(){return this._hass}async _initialLoad(r=!1){var l,u,h,m,g,b,S,_,k,T,M;r&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:r});let a=null;if(this._backendOK&&this.storageKey&&(a=await this._loadLayoutFromBackend(this.storageKey)),!a&&this.storageKey){let A=null;try{A=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(A&&this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(A).length}),A&&this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,A),this._dbgPush("boot","Migrated local -> backend"),a=A}catch(L){this._dbgPush("boot","Migration failed, staying local",{error:String(L)}),a=A}else A&&(a=A)}!a&&((u=(l=this._config)==null?void 0:l.cards)!=null&&u.length)&&(this._dbgPush("boot","Using embedded config"),a={cards:this._config.cards}),a!=null&&a.options?this._applyImportedOptions(a.options,!0):typeof(a==null?void 0:a.grid)=="number"&&this._applyImportedOptions({grid:a.grid},!0);let d=!1;if((h=a==null?void 0:a.cards)!=null&&h.length){for(let A of a.cards){if(!(A!=null&&A.card)||typeof A.card=="object"&&Object.keys(A.card).length===0){let q=this._makePlaceholderAt(((m=A.position)==null?void 0:m.x)||0,((g=A.position)==null?void 0:g.y)||0,((b=A.size)==null?void 0:b.width)||100,((S=A.size)==null?void 0:S.height)||100);this.cardContainer.appendChild(q),d=!0;continue}let L=await this._createCard(A.card),j=this._makeWrapper(L);this.editMode&&j.classList.add("editing"),this._setCardPosition(j,((_=A.position)==null?void 0:_.x)||0,((k=A.position)==null?void 0:k.y)||0),j.style.width=`${((T=A.size)==null?void 0:T.width)||14*this.gridSize}px`,j.style.height=`${((M=A.size)==null?void 0:M.height)||10*this.gridSize}px`,A.z!=null&&(j.style.zIndex=String(A.z)),this.cardContainer.appendChild(j),this._initCardInteract(j),d=!0}this._resizeContainer(),this._dbgPush("boot","Layout applied",{count:a.cards.length})}d||(this._showEmptyPlaceholder(),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI()}_toggleEditMode(r=null){var u,h,m,g;try{(u=this.__clearPressTimer)==null||u.call(this)}catch{}let a=r===null?!this.editMode:!!r,d=!this.editMode&&a;if(this.editMode=a,this.editMode=a,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(b=>{b.classList.toggle("editing",this.editMode);let S=b.querySelector(".resize-handle");S&&(S.style.display=this.editMode?"flex":"none"),!b.dataset.placeholder&&window.interact&&window.interact(b).draggable(this.editMode).resizable(this.editMode),b.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(h=this.cardContainer)==null||h.querySelectorAll(".card-wrapper.dragging").forEach(b=>b.classList.remove("dragging")),d){let b=(m=this.__lastHoldX)!=null?m:null,S=(g=this.__lastHoldY)!=null?g:null;this._playEditRipple(b,S)}}_isInHaEditorPreview(){let r=this;for(;r;){let a=r.nodeType===1&&r.localName?r.localName.toLowerCase():"";if(a==="hui-card-editor"||a==="hui-dialog-edit-card"||a==="hui-card-preview"||a==="ha-dialog"||a==="mwc-dialog")return!0;let d=r.getRootNode&&r.getRootNode();r=r.parentElement||d&&d.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let r=this.cardContainer;if(!r)return;let a=800,d=18,l=$=>!!$&&typeof $=="object"&&$.nodeType===1,u=($,E)=>{try{return!!($&&E&&typeof $.contains=="function"&&l(E)&&$.contains(E))}catch{return!1}},h=$=>u(this.cardContainer,$),m=$=>{var de,ae,le;let E=(ae=(de=$.target)==null?void 0:de.closest)==null?void 0:ae.call(de,".card-wrapper");if(l(E)&&h(E)&&!E.classList.contains("ddc-placeholder"))return!0;let ne=typeof $.composedPath=="function"?$.composedPath():[];for(let oe of ne)if(l(oe)&&h(oe)&&(le=oe.classList)!=null&&le.contains("card-wrapper")&&!oe.classList.contains("ddc-placeholder"))return!0;return!1},g=($,E)=>{let ne=document.createElement("div");ne.className="ddc-press-ring",document.body.appendChild(ne),Object.assign(ne.style,{position:"fixed",left:`${$}px`,top:`${E}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),ne.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let de=ne.querySelector(".pr-fg"),ae=18,le=2*Math.PI*ae;return de.style.strokeDasharray=`${le}`,de.style.strokeDashoffset=`${le}`,requestAnimationFrame(()=>{de.style.transition=`stroke-dashoffset ${a}ms linear`,de.style.strokeDashoffset="0"}),{el:ne,move(oe,He){ne.style.left=`${oe}px`,ne.style.top=`${He}px`},remove(){try{ne.remove()}catch{}}}},b=null,S=null,_=0,k=0,T=null,M=()=>{b&&clearTimeout(b),b=null,S==null||S.remove(),S=null};this.__clearPressTimer=M;let A=$=>{$.pointerType==="mouse"&&$.button!==0||this._isInHaEditorPreview()||!h($.target)||m($)||(T=$.pointerId,_=$.clientX,k=$.clientY,this.__lastHoldX=_,this.__lastHoldY=k,S=g(_,k),b=setTimeout(()=>{var ne;M();let E=!this.editMode;this._toggleEditMode(E),(ne=this._toast)==null||ne.call(this,`Edit mode ${E?"enabled":"disabled"}`)},a))},L=$=>{b==null||$.pointerId!==T||(S==null||S.move($.clientX,$.clientY),(Math.abs($.clientX-_)>d||Math.abs($.clientY-k)>d)&&M())},j=$=>{$.pointerId===T&&(M(),T=null)},q=$=>{if(b)return $.preventDefault(),$.stopPropagation(),!1},re=$=>{var ne;if(this._isInHaEditorPreview()||!h($.target)||m($))return;let E=!this.editMode;this._toggleEditMode(E),(ne=this._toast)==null||ne.call(this,`Edit mode ${E?"enabled":"disabled"}`)};r.addEventListener("pointerdown",A),window.addEventListener("pointermove",L,{passive:!0}),window.addEventListener("pointerup",j,{passive:!0}),window.addEventListener("pointercancel",j,{passive:!0}),window.addEventListener("contextmenu",q),r.addEventListener("dblclick",re),this.__lpHandlers={onPointerDown:A,onPointerMove:L,onPointerUpOrCancel:j,onContextMenu:q,onDblClick:re}}_isLayoutEmpty(){let r=this.cardContainer;return r?r.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let r=this._isLayoutEmpty();if(this.addButton){let d=this.editMode||r;this.addButton.style.display=d?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&r)}let a=d=>d&&(d.style.display=this.editMode?"inline-block":"none");a(this.reloadBtn),a(this.diagBtn),a(this.exitEditBtn),a(this.exportBtn),a(this.importBtn),a(this.exploreBtn),a(this.storeBadge)}_playEditRipple(r=null,a=null){let d=this.cardContainer;if(!d)return;let l=d.getBoundingClientRect(),u=r==null?l.left+l.width/2:r,h=a==null?l.top+l.height/2:a,m=u-l.left,g=h-l.top,b=document.createElement("div");b.className="ddc-ripple-veil",b.style.setProperty("--rip-x",`${m}px`),b.style.setProperty("--rip-y",`${g}px`),d.appendChild(b),setTimeout(()=>b.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>this._initCardInteract(a))}_initCardInteract(r){if(!window.interact||r.dataset.placeholder)return;let a=this.gridSize,d=!!this.dragLiveSnap;window.interact(r).draggable({enabled:this.editMode,inertia:!1,modifiers:[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})],listeners:{start:l=>{this._selection.has(r)||(!(l!=null&&l.shiftKey)&&!(l!=null&&l.ctrlKey)&&!(l!=null&&l.metaKey)&&this._clearSelection(),this._toggleSelection(r,!0));let u=Array.from(this._selection);this.__groupDrag={leader:r,members:u,startRaw:new Map(u.map(h=>[h,{x:parseFloat(h.getAttribute("data-x-raw"))||parseFloat(h.getAttribute("data-x"))||0,y:parseFloat(h.getAttribute("data-y-raw"))||parseFloat(h.getAttribute("data-y"))||0,w:parseFloat(h.style.width)||h.getBoundingClientRect().width,h:parseFloat(h.style.height)||h.getBoundingClientRect().height}]))},u.forEach(h=>{h.classList.add("dragging"),h.getAttribute("data-x-raw")===null&&h.setAttribute("data-x-raw",h.getAttribute("data-x")||"0"),h.getAttribute("data-y-raw")===null&&h.setAttribute("data-y-raw",h.getAttribute("data-y")||"0")})},move:l=>{if(!this.__groupDrag)return;let u=this.gridSize,h=!!this.dragLiveSnap,m=this.__groupDrag.leader,g=this.__groupDrag.startRaw.get(m),b=(parseFloat(m.getAttribute("data-x-raw"))||g.x)+l.dx,S=(parseFloat(m.getAttribute("data-y-raw"))||g.y)+l.dy,_=b-g.x,k=S-g.y,T=this.__groupDrag.members.map(M=>{let A=this.__groupDrag.startRaw.get(M),L=A.x+_,j=A.y+k,q=h?Math.round(L/u)*u:L,re=h?Math.round(j/u)*u:j;return this._rectFor(M,q,re,A.w,A.h)});if(!(this.disableOverlap&&this._anyCollisionFor(T,new Set(this.__groupDrag.members)))){m.setAttribute("data-x-raw",String(b)),m.setAttribute("data-y-raw",String(S));for(let M=0;M<this.__groupDrag.members.length;M++){let A=this.__groupDrag.members[M],L=T[M];A.setAttribute("data-x-raw",String(L.x)),A.setAttribute("data-y-raw",String(L.y)),this._setCardPosition(A,L.x,L.y)}this._resizeContainer()}},end:()=>{if(!this.__groupDrag)return;let l=this.gridSize,u=this.__groupDrag.members.map(h=>{let m=Math.round((parseFloat(h.getAttribute("data-x-raw"))||0)/l)*l,g=Math.round((parseFloat(h.getAttribute("data-y-raw"))||0)/l)*l,b=parseFloat(h.style.width)||h.getBoundingClientRect().width,S=parseFloat(h.style.height)||h.getBoundingClientRect().height;return this._rectFor(h,m,g,b,S)});if(this.disableOverlap&&this._anyCollisionFor(u,new Set(this.__groupDrag.members)))for(let h of this.__groupDrag.members){let m=this.__groupDrag.startRaw.get(h);this._setCardPosition(h,m.x,m.y),h.setAttribute("data-x-raw",String(m.x)),h.setAttribute("data-y-raw",String(m.y))}else for(let h of u)this._setCardPosition(h.el,h.x,h.y),h.el.setAttribute("data-x-raw",String(h.x)),h.el.setAttribute("data-y-raw",String(h.y));for(let h of this.__groupDrag.members)h.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null}}}),window.interact(r).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:l=>{let u=this.gridSize,h=!!this.dragLiveSnap,m=parseFloat(r.style.width)||r.getBoundingClientRect().width,g=parseFloat(r.style.height)||r.getBoundingClientRect().height,{width:b,height:S}=l.rect,_=h?Math.max(u,Math.round(b/u)*u):b,k=h?Math.max(u,Math.round(S/u)*u):S,T=parseFloat(r.getAttribute("data-x"))||0,M=parseFloat(r.getAttribute("data-y"))||0,A=_,L=k;if(this._isContainerFixed()){let{w:q,h:re}=this._getContainerSize();A=Math.min(_,Math.max(this.gridSize,q-T)),L=Math.min(k,Math.max(this.gridSize,re-M))}let j=[this._rectFor(r,T,M,A,L)];this.disableOverlap&&this._anyCollisionFor(j,new Set([r]))||(r.style.width=`${A}px`,r.style.height=`${L}px`,this._resizeContainer())},end:()=>{let l=this.gridSize,u=parseFloat(r.style.width)||r.getBoundingClientRect().width,h=parseFloat(r.style.height)||r.getBoundingClientRect().height,m=Math.max(l,Math.round(u/l)*l),g=Math.max(l,Math.round(h/l)*l),b=parseFloat(r.getAttribute("data-x"))||0,S=parseFloat(r.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:k,h:T}=this._getContainerSize();m=Math.min(m,Math.max(l,k-b)),g=Math.min(g,Math.max(l,T-S))}let _=[this._rectFor(r,b,S,m,g)];this.disableOverlap&&this._anyCollisionFor(_,new Set([r]))||(r.style.width=`${m}px`,r.style.height=`${g}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),r.addEventListener("mousedown",l=>{this.editMode&&(l.target.closest(".resize-handle")||l.target.closest(".chip")||(l.shiftKey||l.ctrlKey||l.metaKey?(l.stopPropagation(),this._toggleSelection(r)):this._selection.has(r)||(this._clearSelection(),this._toggleSelection(r,!0))))})}async _createCard(r){let d=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(r);return d.hass=this.hass,d}_makeWrapper(r){let a=document.createElement("div");a.classList.add("card-wrapper"),this.editMode&&a.classList.add("editing"),a.style.zIndex||(a.style.zIndex=String(this._highestZ()+1));let d=document.createElement("div");d.className="chip",d.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini danger pill" data-act="delete" title="Delete card" aria-label="Delete card">
        <ha-icon icon="mdi:close-thick"></ha-icon>
      </button>
    `,d.addEventListener("click",async h=>{var g,b,S;h.stopPropagation();let m=(S=(b=(g=h.target)==null?void 0:g.closest("button"))==null?void 0:b.dataset)==null?void 0:S.act;if(m){if(m==="delete")this._selection.size>1&&this._selection.has(a)?(Array.from(this._selection).forEach(k=>k.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(a.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(m==="duplicate"||m==="copy"){let _=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];for(let k of _){let T=this._extractCardConfig(k.firstElementChild)||{},M=await this._createCard(T),A=this._makeWrapper(M);A.style.width=k.style.width,A.style.height=k.style.height;let L=(parseFloat(k.getAttribute("data-x"))||0)+this.gridSize,j=(parseFloat(k.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(A,L,j),A.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(A),this._initCardInteract(A)}this._resizeContainer(),this._queueSave("duplicate")}else if(m==="front")this._adjustZ(a,1);else if(m==="back")this._adjustZ(a,-1);else if(m==="edit"){let _=this._extractCardConfig(a.firstElementChild)||{};await this._openSmartPicker("edit",_,async k=>{let T=await this._createCard(k);T.hass=this.hass,a.replaceChild(T,a.firstElementChild),this._queueSave("edit")})}}});let l=document.createElement("div");l.className="shield";let u=document.createElement("div");return u.classList.add("resize-handle"),u.title="Resize",u.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>',a.append(r,l,d,u),a}_makePlaceholderAt(r=0,a=0,d=100,l=100){let u=document.createElement("div");u.classList.add("card-wrapper","ddc-placeholder"),u.dataset.placeholder="1",this.editMode&&u.classList.add("editing"),this._setCardPosition(u,r,a),u.style.width=`${d}px`,u.style.height=`${l}px`,u.style.zIndex=String(this._highestZ()+1);let h=document.createElement("div");h.className="ddc-placeholder-inner",h.setAttribute("aria-hidden","true");let m=document.createElement("div");return m.className="shield",u.append(h,m),u}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let r=this._makePlaceholderAt(0,0,100,100);this.cardContainer.appendChild(r),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(r=>r.remove())}_ensurePlaceholderIfEmpty(){this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),this._syncEmptyStateUI()}_adjustZ(r,a){let l=parseInt(r.style.zIndex||"1",10)+a;l=Math.max(1,Math.min(9999,l)),r.style.zIndex=String(l),this._queueSave("z-change")}_highestZ(){let r=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>{let d=parseInt(a.style.zIndex||"0",10);d>r&&(r=d)}),r}_setCardPosition(r,a,d){let l=Math.round(a),u=Math.round(d);r.style.transform=`translate3d(${l}px, ${u}px, 0)`,r.setAttribute("data-x",String(l)),r.setAttribute("data-y",String(u)),r.setAttribute("data-x-raw",String(l)),r.setAttribute("data-y-raw",String(u))}_areasList(){var u,h,m,g,b,S;let r=[],a=((u=this.hass)==null?void 0:u.areas)||((m=(h=this.hass)==null?void 0:h.config)==null?void 0:m.areas)||null;Array.isArray(a)&&a.forEach(_=>(_==null?void 0:_.area_id)&&r.push({area_id:_.area_id,name:_.name||_.area_id}));let d=((g=this.hass)==null?void 0:g.areaRegistry)||((S=(b=this.hass)==null?void 0:b.resources)==null?void 0:S.areaRegistry);Array.isArray(d)&&d.forEach(_=>(_==null?void 0:_.area_id)&&r.push({area_id:_.area_id,name:_.name||_.area_id}));let l=new Set;return r.filter(_=>!l.has(_.area_id)&&l.add(_.area_id))}_resizeContainer(){let r=this.cardContainer;if(!r||this._isContainerFixed())return;let a=Array.from(r.querySelectorAll(".card-wrapper")),d=0,l=0;a.forEach(u=>{let h=u.getBoundingClientRect(),m=r.getBoundingClientRect(),g=h.left-m.left+h.width,b=h.top-m.top+h.height;d=Math.max(d,g),l=Math.max(l,b)}),r.style.width=`${Math.ceil(d/this.gridSize)*this.gridSize||100}px`,r.style.height=`${Math.ceil(l/this.gridSize)*this.gridSize||100}px`}_rectFor(r,a=null,d=null,l=null,u=null){let h=a!=null?a:parseFloat(r.getAttribute("data-x"))||0,m=d!=null?d:parseFloat(r.getAttribute("data-y"))||0,g=l!=null?l:parseFloat(r.style.width)||r.getBoundingClientRect().width||0,b=u!=null?u:parseFloat(r.style.height)||r.getBoundingClientRect().height||0;return{x:h,y:m,w:g,h:b,el:r}}_rectsOverlap(r,a,d=.5){return!(r.x+r.w<=a.x+d||a.x+a.w<=r.x+d||r.y+r.h<=a.y+d||a.y+a.h<=r.y+d)}_anyCollisionFor(r,a){let d=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(u=>!a.has(u)&&!u.dataset.placeholder);if(!d.length)return!1;let l=d.map(u=>this._rectFor(u));for(let u of r)for(let h of l)if(this._rectsOverlap(u,h))return!0;return!1}_extractCardConfig(r){return(r==null?void 0:r._config)||(r==null?void 0:r.config)||{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(r,a){let d=await this._helpersPromise||await window.loadCardHelpers(),l=null;try{d.getCardElementClass&&(l=await d.getCardElementClass(r))}catch{}try{let b=d.createCardElement({type:r,...a});if(b.hass=this.hass,typeof b.getConfigElement=="function"){let S=await b.getConfigElement();if(S)return S}}catch{}try{if(l&&typeof l.getConfigElement=="function"){let b=await l.getConfigElement();if(b)return b}}catch{}let u=String(r).replace(/^custom:/,""),m=(Array.isArray(window.customCards)?window.customCards:[]).find(b=>(b==null?void 0:b.type)===u||(b==null?void 0:b.type)===r||(b==null?void 0:b.type)===`custom:${u}`),g=[];m!=null&&m.editor&&g.push(m.editor),g.push(`${u}-editor`,`${u}-config-editor`);for(let b of g)if(!(!b||typeof b!="string"))for(let S of[0,100,300,700])try{if(customElements.get(b)||await Promise.race([customElements.whenDefined(b),new Promise(_=>setTimeout(_,S))]),customElements.get(b))return document.createElement(b)}catch{}return null}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let r=document.createElement("style");r.setAttribute("data-ddc-overlay-fix",""),r.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(r)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(a=>{var d;return{type:(d=a==null?void 0:a.type)!=null&&d.startsWith("custom:")?a.type:`custom:${a==null?void 0:a.type}`,name:(a==null?void 0:a.name)||(a==null?void 0:a.type)||"Custom card",icon:"mdi:puzzle-outline",description:(a==null?void 0:a.description)||"",editorTag:(a==null?void 0:a.editor)||null}}).filter(a=>typeof a.type=="string"&&a.type.startsWith("custom:"))}_schemaForType(r){let a=l=>l,d=[];return{entities:a({fields:[{key:"entities",type:"entities",multi:!0,domains:d,label:"Entities"}]}),entity:a({fields:[{key:"entity",type:"entity",multi:!1,domains:d,label:"Entity"}]}),sensor:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:d,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:a({fields:[{key:"entities",type:"entities",multi:!0,domains:d,label:"Entities (multiselect)"}]}),"picture-glance":a({fields:[{key:"entities",type:"entities",multi:!0,domains:d,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":a({fields:[{key:"entity",type:"entity",multi:!1,domains:d,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:a({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:a({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:a({fields:[{key:"entity",type:"entity",multi:!1,domains:d,label:"Entity"}]}),button:a({fields:[{key:"entity",type:"entity",multi:!1,domains:d,label:"Entity (optional)"}]}),iframe:a({fields:[{key:"url",type:"text",label:"URL"}]}),area:a({fields:[{key:"area",type:"text",label:"Area ID"}]})}[r]||{fields:[]}}_shapeBySchema(r,a={}){let d=this._schemaForType(r)||{fields:[]},l={...a,type:r};for(let u of d.fields){let h=l[u.key];if(u.type==="entities"){let g=(Array.isArray(h)?h:h!=null&&h!==""?[h]:[]).filter(Boolean);g.length?l[u.key]=g:delete l[u.key]}else if(u.type==="entity")Array.isArray(h)&&(h=h[0]),h==null||h===""?delete l[u.key]:l[u.key]=String(h);else if(u.type==="number")if(h==null||h==="")delete l[u.key];else{let m=Number(h);Number.isFinite(m)?l[u.key]=m:delete l[u.key]}else(u.type==="select"||u.type==="text"||u.type==="textarea")&&(h==null||h===""?delete l[u.key]:l[u.key]=h)}return l}_statesList(r){var d;let a=Object.keys(((d=this.hass)==null?void 0:d.states)||{});return!r||!r.length?a:a.filter(l=>r.includes(l.split(".")[0]))}_isNumericEntity(r){var l,u;let a=(u=(l=this.hass)==null?void 0:l.states)==null?void 0:u[r];if(!a)return!1;let d=Number(a.state);return Number.isFinite(d)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(r){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(r)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(r){try{let a=this._getRecent().filter(d=>d!==r);a.unshift(r),a.length>10&&(a.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(a))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let r=document.createElement("link");r.rel="stylesheet",r.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",r.setAttribute("data-cm-core",""),document.head.appendChild(r)}await new Promise(r=>{if(window.CodeMirror)return r();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",a.onload=r,document.head.appendChild(a)}),await new Promise(r=>{var d,l;if((l=(d=window.CodeMirror)==null?void 0:d.mimeModes)!=null&&l.yaml)return r();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",a.onload=r,document.head.appendChild(a)}),this.__cmReady=!0}}async _mountYamlEditor(r,a,d,l){let u=g=>window.jsyaml?window.jsyaml.dump(g):JSON.stringify(g,null,2),h=g=>window.jsyaml?window.jsyaml.load(g):JSON.parse(g);r.innerHTML="";let m=u(a);if(customElements.get("hui-yaml-editor"))try{let g=document.createElement("hui-yaml-editor");g.hass=this.hass,"setValue"in g?g.setValue(m):g.yaml=m,g.style.display="block",g.style.height="260px",r.appendChild(g);let b=!1,S=_=>{var T,M,A,L;if(b)return;let k=(L=(A=(M=(T=_.detail)==null?void 0:T.value)!=null?M:g.value)!=null?A:g.yaml)!=null?L:"";try{d(h(k))}catch(j){l==null||l(j)}};return g.addEventListener("value-changed",S),g.addEventListener("yaml-changed",S),{setValue:_=>{let k=u(_);b=!0,"setValue"in g?g.setValue(k):g.yaml=k,b=!1}}}catch{}if(customElements.get("ha-code-editor")){let g=document.createElement("ha-code-editor");g.mode="yaml",g.hass=this.hass,g.value=m,g.style.display="block",g.style.height="260px",r.appendChild(g);let b=!1;return g.addEventListener("value-changed",S=>{var k,T,M;if(b)return;let _=(M=(T=(k=S.detail)==null?void 0:k.value)!=null?T:g.value)!=null?M:"";try{d(h(_))}catch(A){l==null||l(A)}}),{setValue:S=>{var k;let _=u(S);((k=g.value)!=null?k:"")!==_&&(b=!0,g.value=_,b=!1)}}}}async _openSmartPicker(r="add",a=null,d=null){let l=()=>{u.classList.remove("opened"),u.classList.add("closing"),setTimeout(()=>u.remove(),260)},u=document.createElement("div");u.className="modal",u.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${r==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${r==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${r==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,(document.body||this).appendChild(u),u.classList.add("opening");let h=u.querySelector(".dialog"),m=()=>{u.classList.remove("opening"),u.classList.add("opened"),h.removeEventListener("animationend",m,!0)};h.addEventListener("animationend",m,!0),setTimeout(()=>{u.isConnected&&!u.classList.contains("opened")&&(m(),Object.assign(h.style,{opacity:"1",transform:"none",filter:"none"}))},700);let g=u.querySelector("#leftPane"),b=u.querySelector("#addBtn"),S=u.querySelector("#footAdd"),_=u.querySelector("#cancelBtn"),k=u.querySelector("#footCancel"),T=u.querySelector("#search"),M=u.querySelector("#cardHost"),A=u.querySelector("#editorHost"),L=u.querySelector("#editorSpin"),j=u.querySelector("#quickFill"),q=u.querySelector("#yamlHost"),re=u.querySelector("#yamlErr"),$=u.querySelector("#yamlSec"),E=u.querySelector("#tabVisual"),ne=u.querySelector("#tabYaml"),de=u.querySelector("#err"),ae=u.querySelector("#previewSpin"),le=z=>{b.disabled=S.disabled=!z},oe=z=>{z?(de.hidden=!1,de.textContent=z):(de.hidden=!0,de.textContent="")},He=this._getFaves(),ve=this._getRecent(),ye=this._catalog(),ze=ye.find(z=>z.id==="favorites"),Ge=ye.find(z=>z.id==="recent"),Ct=ye.flatMap(z=>z.items||[]);ze.items=Ct.filter(z=>He.has(z.type)),Ge.items=ve.map(z=>Ct.find(F=>F.type===z)).filter(Boolean);let je=this._customCardsFromRegistry();je.length&&ye.push({id:"custom",name:"Custom (installed)",items:je});let Oe="visual",Ne=z=>{let F=z==="yaml";E.classList.toggle("active",!F),E.setAttribute("aria-selected",String(!F)),ne.classList.toggle("active",F),ne.setAttribute("aria-selected",String(F)),A.parentElement.style.display=F?"none":"",$.style.display=F?"":"none";let G=async J=>{let te=J==="yaml";E.classList.toggle("active",!te),E.setAttribute("aria-selected",String(!te)),ne.classList.toggle("active",te),ne.setAttribute("aria-selected",String(te)),A.parentElement.style.display=te?"none":"",$.style.display=te?"":"none",te&&!ie&&await vt(K||a||{type:Me||"entities"}),te&&$.scrollIntoView({behavior:"smooth",block:"start"}),Oe=te?"yaml":"visual"}};E.addEventListener("click",()=>Ne("visual")),ne.addEventListener("click",()=>Ne("yaml")),Ne("visual");let Bt=()=>{let z=T.value.trim().toLowerCase();return ye.map(F=>({...F,items:(F.items||[]).filter(G=>!z||G.name.toLowerCase().includes(z)||G.type.toLowerCase().includes(z))})).filter(F=>F.items&&F.items.length||F.id==="favorites"||F.id==="recent")},gt=()=>{let z=Bt();g.innerHTML="",z.forEach(F=>{let G=document.createElement("div");G.style.padding="12px",G.style.borderBottom="1px solid var(--divider-color)";let J=document.createElement("h4");if(J.textContent=F.name,J.style.margin="0 0 10px 0",J.style.fontSize=".92rem",J.style.opacity=".85",G.appendChild(J),!F.items.length&&(F.id==="favorites"||F.id==="recent")){let te=document.createElement("div");te.style.opacity=".6",te.style.fontSize=".85rem",te.textContent=F.id==="favorites"?"No favorites yet.":"No recent items yet.",G.appendChild(te)}else F.items.forEach(te=>{let be=document.createElement("button");be.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${te.icon}"></ha-icon><span>${te.name}</span>
            </span>`,Object.assign(be.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),be.addEventListener("click",async()=>{jt(be),await Xe(te.type)}),G.appendChild(be)});g.appendChild(G),G.classList.add("section-enter"),G.style.animationDelay=`${Math.min(150,z.indexOf(F)*40)}ms`})},jt=z=>{g.querySelectorAll("button").forEach(F=>F.classList.remove("active")),z==null||z.classList.add("active"),z&&(z.style.background="rgba(0,0,0,.06)")},K=null,Me=null,ie=null,Fe=null,B=0,mt=(z,F)=>{var Pe,$e,De;let G=this._schemaForType(z);if(j.innerHTML="",!G.fields.length){j.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}if(z==="picture-entity"||z==="picture-glance"){let N=document.createElement("div");N.style.display="grid",N.style.gridTemplateColumns="130px 1fr",N.style.gap="8px",N.style.marginBottom="8px";let ue=document.createElement("label");ue.textContent="Source",N.appendChild(ue);let he=document.createElement("div");he.style.display="grid",he.style.gridTemplateColumns="1fr",he.style.gap="8px";let Ue=this._statesList(["camera"]),pe=document.createElement("div");pe.style.display="flex",pe.style.gap="8px";let Se=document.createElement("select"),Re=document.createElement("option");Re.value="",Re.textContent="(none)",Se.appendChild(Re),Ue.forEach(ge=>{let xe=document.createElement("option");xe.value=ge,xe.textContent=ge,Se.appendChild(xe)}),Se.value=(z==="picture-entity"?(Pe=F.entity)!=null&&Pe.startsWith("camera.")?F.entity:"":($e=F.camera_image)!=null&&$e.startsWith("camera.")?F.camera_image:"")||"",pe.appendChild(Se);let et=document.createElement("div"),Ee=document.createElement("input");Ee.type="text",Ee.placeholder="Image URL (optional)",Ee.value=F.image||"",Object.assign(Ee.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),et.appendChild(Ee);let tt=async()=>{let ge={...F},xe=Se.value.trim(),Z=Ee.value.trim();z==="picture-entity"?(delete ge.camera_image,xe&&(ge.entity=xe),Z?ge.image=Z:delete ge.image):(delete ge.entity,xe?ge.camera_image=xe:delete ge.camera_image,Z?ge.image=Z:delete ge.image),K=this._shapeBySchema(z,ge),await we(K),ie==null||ie.setValue(K)};Se.addEventListener("change",tt),Ee.addEventListener("input",tt),he.appendChild(pe),he.appendChild(et),N.appendChild(he),te.appendChild(N)}let J=Object.keys(((De=this.hass)==null?void 0:De.states)||{}),te=document.createElement("div"),be=(N,ue,he,Ue)=>{let pe=document.createElement("div");Object.assign(pe.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),pe.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${N}</span>`,ue.includes(N)&&(pe.style.background="rgba(3,169,244,.12)",pe.style.borderColor="var(--primary-color)",pe.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),pe.addEventListener("click",async()=>{let Se=ue.indexOf(N);Se>=0?ue.splice(Se,1):ue.push(N);let Re=ue.includes(N);pe.style.background=Re?"rgba(3,169,244,.12)":"",pe.style.borderColor=Re?"var(--primary-color)":"var(--divider-color)",pe.querySelector("ha-icon").setAttribute("icon",Re?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),K=this._shapeBySchema(z,{...K,[Ue]:[...ue]}),await we(K),ie==null||ie.setValue(K)}),he.appendChild(pe)};G.fields.forEach(N=>{var Ue,pe,Se,Re,et,Ee,tt,ge,xe;let ue=document.createElement("div");Object.assign(ue.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let he=document.createElement("label");if(he.textContent=N.label||N.key,he.style.minWidth="130px",N.type==="entities"){let Z=document.createElement("div");Z.style.flex="1";let X=document.createElement("input");Object.assign(X,{placeholder:"Filter entities\u2026"}),Object.assign(X.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let ce=document.createElement("div");Object.assign(ce.style,{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(210px,1fr))",gap:"8px",maxHeight:"220px",overflow:"auto",marginTop:"8px"});let Ie=N.domains&&N.domains.length?this._statesList(N.domains):J,Ke=Array.isArray(F[N.key])?[...F[N.key]]:F[N.key]?[F[N.key]]:[],nt=()=>{let bt=X.value.trim().toLowerCase();ce.innerHTML="",Ie.filter(xt=>!bt||xt.toLowerCase().includes(bt)).forEach(xt=>be(xt,Ke,ce,N.key))};X.addEventListener("input",nt),nt(),Z.append(X,ce),ue.append(he,Z),K=this._shapeBySchema(z,{...F,[N.key]:Ke})}if(N.type==="entity"){let Z=document.createElement("div");Z.style.flex="1",Z.style.position="relative";let X=document.createElement("input");X.setAttribute("list","ddc_entlist_"+N.key),Object.assign(X.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),X.placeholder=`Select ${((Ue=N.label)==null?void 0:Ue.toLowerCase())||"entity"}\u2026`;let ce=document.createElement("ha-icon");ce.setAttribute("icon","mdi:magnify"),Object.assign(ce.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let Ie=document.createElement("datalist");Ie.id="ddc_entlist_"+N.key;let Ke=N.domains&&N.domains.length?this._statesList(N.domains):Object.keys(((pe=this.hass)==null?void 0:pe.states)||{});Ie.innerHTML=Ke.map(nt=>`<option value="${nt}">`).join(""),X.value=Array.isArray(F[N.key])?F[N.key][0]||"":F[N.key]||"",X.addEventListener("change",async()=>{K=this._shapeBySchema(z,{...K,[N.key]:X.value||void 0}),await we(K),ie==null||ie.setValue(K)}),Z.append(ce,X,Ie),ue.append(he,Z)}if(N.type==="number"){let Z=document.createElement("div");Z.style.flex="1",Z.style.position="relative";let X=document.createElement("input");X.type="number",N.step&&(X.step=N.step),Object.assign(X.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let ce=document.createElement("ha-icon");ce.setAttribute("icon","mdi:counter"),Object.assign(ce.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),X.value=(Re=(Se=F[N.key])!=null?Se:N.default)!=null?Re:"",X.addEventListener("input",async()=>{let Ie=X.value===""?void 0:Number(X.value);K=this._shapeBySchema(z,{...K,[N.key]:isNaN(Ie)?void 0:Ie}),await we(K),ie==null||ie.setValue(K)}),Z.append(ce,X),ue.append(he,Z)}if(N.type==="select"){let Z=document.createElement("div");Z.style.flex="1",Z.style.position="relative";let X=document.createElement("select");Object.assign(X.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let ce=document.createElement("ha-icon");ce.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(ce.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(N.options||[]).forEach(Ie=>{let Ke=document.createElement("option");Ke.value=Ie,X.appendChild(Ke)}),X.value=(tt=(et=F[N.key])!=null?et:N.default)!=null?tt:((Ee=N.options)==null?void 0:Ee[0])||"",X.addEventListener("change",async()=>{K=this._shapeBySchema(z,{...K,[N.key]:X.value}),await we(K),ie==null||ie.setValue(K)}),Z.append(ce,X),ue.append(he,Z)}if(N.type==="text"){let Z=document.createElement("div");Z.style.flex="1",Z.style.position="relative";let X=document.createElement("input");X.type="text",Object.assign(X.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let ce=document.createElement("ha-icon");ce.setAttribute("icon","mdi:text"),Object.assign(ce.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),X.value=(ge=F[N.key])!=null?ge:"",X.addEventListener("input",async()=>{K=this._shapeBySchema(z,{...K,[N.key]:X.value||void 0}),await we(K),ie==null||ie.setValue(K)}),Z.append(ce,X),ue.append(he,Z)}if(N.type==="textarea"){let Z=document.createElement("textarea");Object.assign(Z.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),Z.value=(xe=F[N.key])!=null?xe:"",Z.addEventListener("input",async()=>{K=this._shapeBySchema(z,{...K,[N.key]:Z.value||""}),await we(K),ie==null||ie.setValue(K)}),ue.append(he,Z)}te.appendChild(ue)}),j.innerHTML="",j.appendChild(te)},we=async z=>{let F=++B;ae.hidden=!1,M.innerHTML="",await vr();try{let G=await this._helpersPromise||await window.loadCardHelpers();if(F!==B)return;let J=G.createCardElement(z);if(J.hass=this.hass,F!==B)return;M.appendChild(J)}catch{}finally{F===B&&(ae.hidden=!0)}},ct=async z=>{let F=++B;if(L.hidden=!1,A.innerHTML="",await sl(),F!==B)return L.hidden=!0,!1;let G=await this._getEditorElementForType(z.type||Me,z);if(!G){let J=document.createElement("div");return J.style.opacity=".7",J.style.fontSize=".9rem",J.textContent="This card has no visual editor. Use the YAML editor tab.",F===B&&(A.appendChild(J),L.hidden=!0),Fe=null,le(!0),Oe!=="visual"&&Ne("yaml"),!1}try{G.hass=this.hass,G.isConnected||A.appendChild(G),await Promise.resolve();try{G.setConfig(z)}catch{}Fe&&this.__onEditorChange&&(Fe.removeEventListener("config-changed",this.__onEditorChange),Fe.removeEventListener("value-changed",this.__onEditorChange));let J=async te=>{var $e,De,N;let be=(N=($e=te.detail)==null?void 0:$e.config)!=null?N:(De=te.detail)==null?void 0:De.value;if(!be)return;let Pe=be.type||Me;Me=Pe,K=this._shapeBySchema(Pe,be),oe(""),le(!0),mt(Me,K),await we(K),ie==null||ie.setValue(K)};return this.__onEditorChange=J,G.addEventListener("config-changed",J),G.addEventListener("value-changed",J),Fe=G,Oe!=="yaml"&&Ne("visual"),le(!0),!0}finally{F===B&&(L.hidden=!0)}},vt=async z=>{ie=await this._mountYamlEditor(q,z,async F=>{var G;try{let J=(F==null?void 0:F.type)||Me,te=this._shapeBySchema(J,F||{}),be=J!==Me;if(Me=J,K=te,re.hidden=!0,re.textContent="",le(!0),be)mt(Me,K),await ct(K)&&Oe!=="yaml"&&Ne("visual");else{try{(G=Fe==null?void 0:Fe.setConfig)==null||G.call(Fe,K)}catch{}await we(K)}}catch(J){re.hidden=!1,re.textContent=`Invalid config: ${String((J==null?void 0:J.message)||J)}`,le(!1)}},F=>{re.hidden=!1,re.textContent=`Invalid YAML: ${String((F==null?void 0:F.message)||F)}`,le(!1)})},yt=async z=>{var Pe;if(this.__stubCache.has(z))return{...this.__stubCache.get(z)};let F=await this._helpersPromise||await window.loadCardHelpers(),G=null;try{F.getCardElementClass&&(G=await F.getCardElementClass(z))}catch{}let J,te=Object.keys(((Pe=this.hass)==null?void 0:Pe.states)||{}),be=$e=>te.filter(De=>De.startsWith($e+"."));if(G!=null&&G.getStubConfig)try{J=await G.getStubConfig(this.hass,te,be)}catch{}return J||(J=await this._getStubConfigForType(z)),this.__stubCache.set(z,{...J}),{...J}},Xe=async z=>{re.hidden=!0,re.textContent="",oe(""),Me=z;let F=r==="edit"&&a&&a.type===z?{...a}:await yt(z);K=this._shapeBySchema(z,F),mt(z,K),await vr(),await we(K),await ct(K)?(Oe!=="yaml"&&Ne("visual"),le(!0)):(await vt(K),Ne("yaml"),le(!0))};_.addEventListener("click",l),k.addEventListener("click",l),b.addEventListener("click",commit),S.addEventListener("click",commit),u.addEventListener("keydown",z=>{z.key==="Escape"&&l(),z.key==="Enter"&&!b.disabled&&commit()});let Ye=null;T.addEventListener("input",()=>{clearTimeout(Ye),Ye=setTimeout(gt,120)}),gt(),await Xe((()=>{var G;return(((G=this._getRecent)==null?void 0:G.call(this))||[]).find(Boolean)||"entities"})()),le(!0),r==="edit"&&a&&(await Xe(a.type||"entities"),le(!0))}async _getStubConfigForType(r){var S;let a=await this._helpersPromise||await window.loadCardHelpers(),d=null;try{a.getCardElementClass&&(d=await a.getCardElementClass(r))}catch{}let l=Object.keys(((S=this.hass)==null?void 0:S.states)||{}),u=_=>l.filter(k=>k.startsWith(_+".")),h=l[0],m=u("camera")[0]||null;if(d!=null&&d.getStubConfig)try{if(!["picture-entity","picture-glance"].includes(r))return await d.getStubConfig(this.hass,l,u)}catch{}let g={type:r};if(r==="picture-entity")return m?{type:r,entity:m,camera_view:"auto"}:{type:r,image:"/static/icons/favicon-192x192.png",tap_action:{action:"none"}};if(r==="picture-glance"){if(m){let _=l.filter(k=>k!==m).slice(0,4);return{type:r,camera_image:m,entities:_}}return{type:r,image:"/static/icons/favicon-192x192.png",entities:l.slice(0,4)}}if(r==="area"){let _=document.createElement("div");Object.assign(_.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let k=document.createElement("label");k.textContent="Area",k.style.minWidth="130px";let T=document.createElement("select");Object.assign(T.style,{flex:"1",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let M=this._areasList(),A=document.createElement("option");A.value="",A.textContent="(choose an area)",T.appendChild(A),M.forEach(L=>{let j=document.createElement("option");j.value=L.area_id,j.textContent=`${L.name} (${L.area_id})`,T.appendChild(j)}),T.value=cfg.area||"",T.addEventListener("change",async()=>{currentConfig=this._shapeBySchema(r,{...currentConfig,area:T.value||void 0}),await mountPreview(currentConfig),yamlEditorApi==null||yamlEditorApi.setValue(currentConfig)}),_.append(k,T),fieldWrap.appendChild(_)}let b=u("sensor")[0]||h;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","weather-forecast"].includes(r)&&(g.entity={sensor:b,gauge:u("sensor").find(this._isNumericEntity.bind(this))||b,"media-control":u("media_player")[0]||h,light:u("light")[0]||h,thermostat:u("climate")[0]||h,"alarm-panel":u("alarm_control_panel")[0]||h,"weather-forecast":u("weather")[0]||h}[r]||b||h),["entities","glance","history-graph","statistics-graph","map"].includes(r)){let _=k=>(k!=null&&k.length?l.filter(T=>k.includes(T.split(".")[0])):l).slice(0,3);r==="map"?g.entities=_(["device_tracker","person"]):r==="statistics-graph"?g.entities=_(["sensor","number","input_number"]):g.entities=_()}return r==="iframe"&&(g.url="https://www.home-assistant.io"),r==="markdown"&&(g.content="## New card"),g}_getNextAvailablePosition(){let r=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),a=new Set,d=this.gridSize;r.forEach(h=>{let m=parseFloat(h.getAttribute("data-x"))||0,g=parseFloat(h.getAttribute("data-y"))||0,b=parseFloat(getComputedStyle(h).width)||100,S=parseFloat(getComputedStyle(h).height)||100,_=Math.floor(m/d),k=Math.floor(g/d),T=Math.floor((m+b)/d),M=Math.floor((g+S)/d);for(let A=_;A<T;A++)for(let L=k;L<M;L++)a.add(`${A}-${L}`)});let l=0,u=0;for(;a.has(`${l}-${u}`);)l+=6,l>60&&(l=0,u+=6);return{x:l*d,y:u*d}}async _addPickedCardToLayout(r){this._hideEmptyPlaceholder();let a=await this._createCard(r),d=this._makeWrapper(a),l=this._getNextAvailablePosition();this._setCardPosition(d,l.x,l.y),d.style.width=`${14*this.gridSize}px`,d.style.height=`${10*this.gridSize}px`,d.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(d),this._initCardInteract(d),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI()}_toggleSelection(r,a=null){let d=a==null?!this._selection.has(r):!!a;d?this._selection.add(r):this._selection.delete(r),r.classList.toggle("selected",d)}_clearSelection(){for(let r of this._selection)r.classList.remove("selected");this._selection.clear()}_installSelectionMarquee(){let r=this.cardContainer,a=0,d=0,l=null,u=!1,h=_=>{let k=r.getBoundingClientRect(),T="touches"in _&&_.touches[0]?_.touches[0].clientX:_.clientX,M="touches"in _&&_.touches[0]?_.touches[0].clientY:_.clientY;return{x:T-k.left,y:M-k.top}},m=(_,k)=>{let T=Math.min(_,a),M=Math.max(_,a),A=Math.min(k,d),L=Math.max(k,d);l.style.left=`${T}px`,l.style.top=`${A}px`,l.style.width=`${M-T}px`,l.style.height=`${L-A}px`;let j=l.getBoundingClientRect(),q=r.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),q.forEach(re=>{let $=re.getBoundingClientRect();!($.right<j.left||$.left>j.right||$.bottom<j.top||$.top>j.bottom)&&this._toggleSelection(re,!0)})},g=_=>{if(!this.editMode||_.target.closest(".card-wrapper"))return;u=!0;let k=h(_);a=k.x,d=k.y,l=document.createElement("div"),l.className="marquee",l.style.left=`${a}px`,l.style.top=`${d}px`,r.appendChild(l),_.preventDefault()},b=_=>{!u||!l||m(h(_).x,h(_).y)},S=()=>{u&&(u=!1,l&&l.remove(),l=null)};r.addEventListener("mousedown",g),window.addEventListener("mousemove",b),window.addEventListener("mouseup",S),r.addEventListener("touchstart",_=>{this.editMode&&(_.target.closest(".card-wrapper")||g(_))},{passive:!1}),window.addEventListener("touchmove",_=>{b(_)},{passive:!1}),window.addEventListener("touchend",S),window.addEventListener("touchcancel",S)}async _openDiagnostics(){var m,g;let r=document.createElement("div");r.className="modal";let a=this.storageKey||"(none)",d=this._backendOK&&!!this.storageKey,l=b=>b.slice(-200).map(S=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${S.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${S.kind}]</b>
        <span style="margin-left:6px">${this._safe(S.msg)}</span>
        ${S.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(S.extra,null,2))}</pre>`:""}
      </div>`).join("");r.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95vw);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((m=this._config)==null?void 0:m.storage_key)||"")}</code> \u2192 <code>${this._safe(a)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${d?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((g=this.cardContainer)==null?void 0:g.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${l(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let u=()=>r.remove();r.querySelector("#closeDiag").addEventListener("click",u),this.appendChild(r);let h=()=>{let b=r.querySelector("#logArea"),S=_=>_.slice(-200).map(k=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${k.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${k.kind}]</b>
          <span style="margin-left:6px">${this._safe(k.msg)}</span>
          ${k.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(k.extra,null,2))}</pre>`:""}
        </div>`).join("");b.innerHTML=S(this._dbgDump()),b.scrollTop=b.scrollHeight};r.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{h()}}),r.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),h()}),r.querySelector("#exportJson").addEventListener("click",()=>{let S=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(M=>{let A=parseFloat(M.getAttribute("data-x"))||0,L=parseFloat(M.getAttribute("data-y"))||0,j=parseFloat(M.style.width)||M.getBoundingClientRect().width,q=parseFloat(M.style.height)||M.getBoundingClientRect().height,re=parseInt(M.style.zIndex||"1",10);return{card:this._extractCardConfig(M.firstElementChild),position:{x:A,y:L},size:{width:j,height:q},z:re}}),_={version:2,options:this._exportableOptions(),cards:S},k=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),T=document.createElement("a");T.href=URL.createObjectURL(k),T.download=`ddc_${this.storageKey||"layout"}.json`,T.click(),URL.revokeObjectURL(T.href)}),r.querySelector("#importJson").addEventListener("click",async()=>{let b=document.createElement("input");b.type="file",b.accept="application/json",b.onchange=async()=>{var T,M,A,L,j,q,re,$,E,ne;let S=(T=b.files)==null?void 0:T[0];if(!S)return;let _=await S.text();try{let de=JSON.parse(_);if(this._dbgPush("import","Loaded file",{bytes:_.length}),this.cardContainer.innerHTML="",(M=de.cards)!=null&&M.length)for(let ae of de.cards)if(!(ae!=null&&ae.card)||typeof ae.card=="object"&&Object.keys(ae.card).length===0){let le=this._makePlaceholderAt(((A=ae.position)==null?void 0:A.x)||0,((L=ae.position)==null?void 0:L.y)||0,((j=ae.size)==null?void 0:j.width)||100,((q=ae.size)==null?void 0:q.height)||100);this.cardContainer.appendChild(le)}else{let le=await this._createCard(ae.card),oe=this._makeWrapper(le);this._setCardPosition(oe,((re=ae.position)==null?void 0:re.x)||0,(($=ae.position)==null?void 0:$.y)||0),oe.style.width=`${((E=ae.size)==null?void 0:E.width)||140}px`,oe.style.height=`${((ne=ae.size)==null?void 0:ne.height)||100}px`,this.cardContainer.appendChild(oe),this._initCardInteract(oe)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1)}catch(de){this._dbgPush("import","Parse failed",{error:String(de)})}let k=new Event("ddc-logrefresh");window.dispatchEvent(k)},b.click()}),r.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),h();let b=(this.storageKey||"ddc_test")+"_selftest",S={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(b,S);let _=await this._loadLayoutFromBackend(b);this._dbgPush("test","Round-trip result",{wrote:S,read:_})}catch(_){this._dbgPush("test","Round-trip failed",{error:String(_)})}h()}),h()}_exportableOptions(){var a,d;let r={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(a=this.containerFixedWidth)!=null?a:void 0,container_fixed_height:(d=this.containerFixedHeight)!=null?d:void 0,container_preset:this.containerPreset};return Object.keys(r).forEach(l=>r[l]===void 0&&delete r[l]),r}_applyImportedOptions(r={},a=!0){var d,l,u;this._config={...this._config||{},...r},"storage_key"in r&&(this.storageKey=r.storage_key||void 0),"grid"in r&&(this.gridSize=Number(r.grid)||10),"drag_live_snap"in r&&(this.dragLiveSnap=!!r.drag_live_snap),"auto_save"in r&&(this.autoSave=!!r.auto_save),"auto_save_debounce"in r&&(this.autoSaveDebounce=Number(r.auto_save_debounce)||800),"container_background"in r&&(this.containerBackground=(d=r.container_background)!=null?d:"transparent"),"card_background"in r&&(this.cardBackground=(l=r.card_background)!=null?l:"var(--ha-card-background, var(--card-background-color))"),"debug"in r&&(this.debug=!!r.debug),"disable_overlap"in r&&(this.disableOverlap=!!r.disable_overlap),"container_size_mode"in r&&(this.containerSizeMode=r.container_size_mode||"dynamic"),"container_fixed_width"in r&&(this.containerFixedWidth=Number(r.container_fixed_width)||null),"container_fixed_height"in r&&(this.containerFixedHeight=Number(r.container_fixed_height)||null),"container_preset"in r&&(this.containerPreset=r.container_preset||"fhd"),"container_preset_orientation"in r&&(this.containerPresetOrient=r.container_preset_orientation||"auto"),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),a&&(this._applyContainerSizingFromConfig(!0),this._resizeContainer(),(u=this._updateStoreBadge)==null||u.call(this))}_exportDesign(){let a=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(m=>{let g=parseFloat(m.getAttribute("data-x"))||0,b=parseFloat(m.getAttribute("data-y"))||0,S=parseFloat(m.style.width)||m.getBoundingClientRect().width,_=parseFloat(m.style.height)||m.getBoundingClientRect().height,k=parseInt(m.style.zIndex||"1",10);return{card:this._extractCardConfig(m.firstElementChild),position:{x:g,y:b},size:{width:S,height:_},z:k}}),d={version:2,options:this._exportableOptions(),cards:a},l=`ddc_design_${this.storageKey||"layout"}.json`,u=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(u),h.download=l,h.click(),URL.revokeObjectURL(h.href),this._toast("Design exported.")}_importDesign(){let r=document.createElement("input");r.type="file",r.accept="application/json",r.onchange=async()=>{var l,u,h,m,g,b,S,_,k,T;let a=(l=r.files)==null?void 0:l[0];if(!a)return;let d=await a.text();try{let M=JSON.parse(d);if(M.options?this._applyImportedOptions(M.options,!0):typeof M.grid=="number"&&this._applyImportedOptions({grid:M.grid},!0),this.cardContainer.innerHTML="",(u=M.cards)!=null&&u.length)for(let A of M.cards)if(!(A!=null&&A.card)||typeof A.card=="object"&&Object.keys(A.card).length===0){let L=this._makePlaceholderAt(((h=A.position)==null?void 0:h.x)||0,((m=A.position)==null?void 0:m.y)||0,((g=A.size)==null?void 0:g.width)||100,((b=A.size)==null?void 0:b.height)||100);this.cardContainer.appendChild(L)}else{let L=await this._createCard(A.card),j=this._makeWrapper(L);this._setCardPosition(j,((S=A.position)==null?void 0:S.x)||0,((_=A.position)==null?void 0:_.y)||0),j.style.width=`${((k=A.size)==null?void 0:k.width)||140}px`,j.style.height=`${((T=A.size)==null?void 0:T.height)||100}px`,A.z!=null&&(j.style.zIndex=String(A.z)),this.cardContainer.appendChild(j),this._initCardInteract(j)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1),this._toast("Design imported.")}catch(M){console.error("Import failed",M),this._toast("Import failed \u2014 invalid file.")}},r.click()}_queueSave(r="auto"){this.autoSave&&(this._dbgPush("autosave","Queued",{reason:r,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce))}async _saveLayout(r=!0){let d=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(u=>{let h=parseFloat(u.getAttribute("data-x"))||0,m=parseFloat(u.getAttribute("data-y"))||0,g=parseFloat(u.style.width)||u.getBoundingClientRect().width,b=parseFloat(u.style.height)||u.getBoundingClientRect().height,S=parseInt(u.style.zIndex||"1",10);return{card:this._extractCardConfig(u.firstElementChild),position:{x:h,y:m},size:{width:g,height:b},z:S}}),l={version:2,options:this._exportableOptions(),cards:d};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(l))}catch{}if(!this.storageKey){r||this._toast("Saved locally (no storage_key set).");return}try{await this._saveLayoutToBackend(this.storageKey,l),r||this._toast("Layout saved.")}catch(u){console.error("Backend save failed",u),this._dbgPush("save","Backend save failed",{error:String(u)}),r||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let r=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let a=await this.hass.callApi("get","dragdrop_storage"),d=Math.round(performance.now()-r);this._dbgPush("probe",`OK (${d} ms)`,a),this._backendOK=!!a}catch(a){let d=Math.round(performance.now()-r);this._dbgPush("probe",`FAILED (${d} ms)`,{error:String(a)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(r){let a=`dragdrop_storage/${encodeURIComponent(r)}`,d=performance.now();try{this._dbgPush("load",`GET /api/${a}`);let l=await this.hass.callApi("get",a),u=Math.round(performance.now()-d);return this._dbgPush("load",`OK (${u} ms)`,{bytes:JSON.stringify(l||"").length}),l}catch(l){let u=Math.round(performance.now()-d);return this._dbgPush("load",`FAILED (${u} ms)`,{error:String(l)}),null}}async _saveLayoutToBackend(r,a){let d=`dragdrop_storage/${encodeURIComponent(r)}`,l=JSON.stringify(a).length,u=performance.now();try{this._dbgPush("save",`POST /api/${d}`,{bytes:l});let h=await this.hass.callApi("post",d,a),m=Math.round(performance.now()-u);return this._dbgPush("save",`OK (${m} ms)`,h),h}catch(h){let m=Math.round(performance.now()-u);throw this._dbgPush("save",`FAILED (${m} ms)`,{error:String(h),bytes:l}),h}}_updateStoreBadge(){let r=this.storeBadge;if(!r)return;let a=this._backendOK&&!!this.storageKey;r.textContent=a?"storage: backend":"storage: local",r.style.background=a?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",r.style.borderColor=a?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(r){let a=new Event("hass-notification");a.detail={message:r},window.dispatchEvent(a)}_huiRoot(){var r,a,d,l,u,h;try{let m=document.querySelector("home-assistant"),g=(r=m==null?void 0:m.shadowRoot)==null?void 0:r.querySelector("home-assistant-main"),b=((a=g==null?void 0:g.shadowRoot)==null?void 0:a.querySelector("ha-drawer"))||g,S=((d=b==null?void 0:b.shadowRoot)==null?void 0:d.querySelector("partial-panel-resolver"))||b,_=((l=S==null?void 0:S.shadowRoot)==null?void 0:l.querySelector("ha-panel-lovelace"))||((u=b==null?void 0:b.shadowRoot)==null?void 0:u.querySelector("ha-panel-lovelace"));return((h=_==null?void 0:_.shadowRoot)==null?void 0:h.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",Ln);(()=>{try{let e=window.customCards=window.customCards||[];e.some(r=>r.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!0})}catch{}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
