var Io=Object.create;var Si=Object.defineProperty;var Lo=Object.getOwnPropertyDescriptor;var Fo=Object.getOwnPropertyNames;var zo=Object.getPrototypeOf,Do=Object.prototype.hasOwnProperty;var Ro=(e,d,r)=>d in e?Si(e,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[d]=r;var Bo=(e,d)=>()=>(d||e((d={exports:{}}).exports,d),d.exports);var No=(e,d,r,a)=>{if(d&&typeof d=="object"||typeof d=="function")for(let c of Fo(d))!Do.call(e,c)&&c!==r&&Si(e,c,{get:()=>d[c],enumerable:!(a=Lo(d,c))||a.enumerable});return e};var jo=(e,d,r)=>(r=e!=null?Io(zo(e)):{},No(d||!e||!e.__esModule?Si(r,"default",{value:e,enumerable:!0}):r,e));var vn=(e,d,r)=>Ro(e,typeof d!="symbol"?d+"":d,r);var bn=Bo((Ei,mt)=>{(function(e,d){typeof Ei=="object"&&typeof mt!="undefined"?mt.exports=d():typeof define=="function"&&define.amd?define(d):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=d()})(Ei,(function(){"use strict";function e(i,t){var n=Object.keys(i);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);t&&(o=o.filter((function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable}))),n.push.apply(n,o)}return n}function d(i){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e(Object(n),!0).forEach((function(o){l(i,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(o){Object.defineProperty(i,o,Object.getOwnPropertyDescriptor(n,o))}))}return i}function r(i){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(i)}function a(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function c(i,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,k(o.key),o)}}function p(i,t,n){return t&&c(i.prototype,t),n&&c(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function l(i,t,n){return(t=k(t))in i?Object.defineProperty(i,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[t]=n,i}function h(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&_(i,t)}function m(i){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(i)}function _(i,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},_(i,t)}function f(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function v(i){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,o=m(i);if(t){var s=m(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(function(u,g){if(g&&(typeof g=="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return f(u)})(this,n)}}function x(){return x=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(i,t,n){var o=(function(u,g){for(;!Object.prototype.hasOwnProperty.call(u,g)&&(u=m(u))!==null;);return u})(i,t);if(o){var s=Object.getOwnPropertyDescriptor(o,t);return s.get?s.get.call(arguments.length<3?i:n):s.value}},x.apply(this,arguments)}function k(i){var t=(function(n,o){if(typeof n!="object"||n===null)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var u=s.call(n,o||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(n)})(i,"string");return typeof t=="symbol"?t:t+""}var O=function(i){return!(!i||!i.Window)&&i instanceof i.Window},T=void 0,M=void 0;function I(i){T=i;var t=i.document.createTextNode("");t.ownerDocument!==i.document&&typeof i.wrap=="function"&&i.wrap(t)===t&&(i=i.wrap(i)),M=i}function A(i){return O(i)?i:(i.ownerDocument||i).defaultView||M.window}typeof window!="undefined"&&window&&I(window);var Y=function(i){return!!i&&r(i)==="object"},N=function(i){return typeof i=="function"},S={window:function(i){return i===M||O(i)},docFrag:function(i){return Y(i)&&i.nodeType===11},object:Y,func:N,number:function(i){return typeof i=="number"},bool:function(i){return typeof i=="boolean"},string:function(i){return typeof i=="string"},element:function(i){if(!i||r(i)!=="object")return!1;var t=A(i)||M;return/object|function/.test(typeof Element=="undefined"?"undefined":r(Element))?i instanceof Element||i instanceof t.Element:i.nodeType===1&&typeof i.nodeName=="string"},plainObject:function(i){return Y(i)&&!!i.constructor&&/function Object\b/.test(i.constructor.toString())},array:function(i){return Y(i)&&i.length!==void 0&&N(i.splice)}};function K(i){var t=i.interaction;if(t.prepared.name==="drag"){var n=t.prepared.axis;n==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):n==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function D(i){var t=i.iEvent,n=i.interaction;if(n.prepared.name==="drag"){var o=n.prepared.axis;if(o==="x"||o==="y"){var s=o==="x"?"y":"x";t.page[s]=n.coords.start.page[s],t.client[s]=n.coords.start.client[s],t.delta[s]=0}}}var H={id:"actions/drag",install:function(i){var t=i.actions,n=i.Interactable,o=i.defaults;n.prototype.draggable=H.draggable,t.map.drag=H,t.methodDict.drag="draggable",o.actions.drag=H.defaults},listeners:{"interactions:before-action-move":K,"interactions:action-resume":K,"interactions:action-move":D,"auto-start:check":function(i){var t=i.interaction,n=i.interactable,o=i.buttons,s=n.options.drag;if(s&&s.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(o&n.options.drag.mouseButtons)!=0))return i.action={name:"drag",axis:s.lockAxis==="start"?s.startAxis:s.lockAxis},!1}},draggable:function(i){return S.object(i)?(this.options.drag.enabled=i.enabled!==!1,this.setPerAction("drag",i),this.setOnEvents("drag",i),/^(xy|x|y|start)$/.test(i.lockAxis)&&(this.options.drag.lockAxis=i.lockAxis),/^(xy|x|y)$/.test(i.startAxis)&&(this.options.drag.startAxis=i.startAxis),this):S.bool(i)?(this.options.drag.enabled=i,this):this.options.drag},beforeMove:K,move:D,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(i){return i.search("drag")===0}},j=H,$={init:function(i){var t=i;$.document=t.document,$.DocumentFragment=t.DocumentFragment||B,$.SVGElement=t.SVGElement||B,$.SVGSVGElement=t.SVGSVGElement||B,$.SVGElementInstance=t.SVGElementInstance||B,$.Element=t.Element||B,$.HTMLElement=t.HTMLElement||$.Element,$.Event=t.Event,$.Touch=t.Touch||B,$.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function B(){}var z=$,U={init:function(i){var t=z.Element,n=i.navigator||{};U.supportsTouch="ontouchstart"in i||S.func(i.DocumentTouch)&&z.document instanceof i.DocumentTouch,U.supportsPointerEvent=n.pointerEnabled!==!1&&!!z.PointerEvent,U.isIOS=/iP(hone|od|ad)/.test(n.platform),U.isIOS7=/iP(hone|od|ad)/.test(n.platform)&&/OS 7[^\d]/.test(n.appVersion),U.isIe9=/MSIE 9/.test(n.userAgent),U.isOperaMobile=n.appName==="Opera"&&U.supportsTouch&&/Presto/.test(n.userAgent),U.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",U.pEventTypes=U.supportsPointerEvent?z.PointerEvent===i.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,U.wheelEvent=z.document&&"onmousewheel"in z.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},V=U;function oe(i,t){if(i.contains)return i.contains(t);for(;t;){if(t===i)return!0;t=t.parentNode}return!1}function fe(i,t){for(;S.element(i);){if(le(i,t))return i;i=Q(i)}return null}function Q(i){var t=i.parentNode;if(S.docFrag(t)){for(;(t=t.host)&&S.docFrag(t););return t}return t}function le(i,t){return M!==T&&(t=t.replace(/\/deep\//g," ")),i[V.prefixedMatchesSelector](t)}var Ee=function(i){return i.parentNode||i.host};function Ge(i,t){for(var n,o=[],s=i;(n=Ee(s))&&s!==t&&n!==s.ownerDocument;)o.unshift(s),s=n;return o}function De(i,t,n){for(;S.element(i);){if(le(i,t))return!0;if((i=Q(i))===n)return le(i,t)}return!1}function Re(i){return i.correspondingUseElement||i}function ye(i){var t=i instanceof z.SVGElement?i.getBoundingClientRect():i.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function We(i){var t,n=ye(i);if(!V.isIOS7&&n){var o={x:(t=(t=A(i))||M).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};n.left+=o.x,n.right+=o.x,n.top+=o.y,n.bottom+=o.y}return n}function Be(i){for(var t=[];i;)t.push(i),i=Q(i);return t}function Qe(i){return!!S.string(i)&&(z.document.querySelector(i),!0)}function ee(i,t){for(var n in t)i[n]=t[n];return i}function bt(i,t,n){return i==="parent"?Q(n):i==="self"?t.getRect(n):fe(n,i)}function ht(i,t,n,o){var s=i;return S.string(s)?s=bt(s,t,n):S.func(s)&&(s=s.apply(void 0,o)),S.element(s)&&(s=We(s)),s}function ie(i){return i&&{x:"x"in i?i.x:i.left,y:"y"in i?i.y:i.top}}function Se(i){return!i||"x"in i&&"y"in i||((i=ee({},i)).x=i.left||0,i.y=i.top||0,i.width=i.width||(i.right||0)-i.x,i.height=i.height||(i.bottom||0)-i.y),i}function ge(i,t,n){i.left&&(t.left+=n.x),i.right&&(t.right+=n.x),i.top&&(t.top+=n.y),i.bottom&&(t.bottom+=n.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function ve(i,t,n){var o=n&&i.options[n];return ie(ht(o&&o.origin||i.options.origin,i,t,[i&&t]))||{x:0,y:0}}function Ie(i,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(b){return!0},o=arguments.length>3?arguments[3]:void 0;if(o=o||{},S.string(i)&&i.search(" ")!==-1&&(i=xt(i)),S.array(i))return i.forEach((function(b){return Ie(b,t,n,o)})),o;if(S.object(i)&&(t=i,i=""),S.func(t)&&n(i))o[i]=o[i]||[],o[i].push(t);else if(S.array(t))for(var s=0,u=t;s<u.length;s++){var g=u[s];Ie(i,g,n,o)}else if(S.object(t))for(var y in t)Ie(xt(y).map((function(b){return"".concat(i).concat(b)})),t[y],n,o);return o}function xt(i){return i.trim().split(/ +/)}var ot=function(i,t){return Math.sqrt(i*i+t*t)},Lt=["webkit","moz"];function Ne(i,t){i.__set||(i.__set={});var n=function(s){if(Lt.some((function(u){return s.indexOf(u)===0})))return 1;typeof i[s]!="function"&&s!=="__set"&&Object.defineProperty(i,s,{get:function(){return s in i.__set?i.__set[s]:i.__set[s]=t[s]},set:function(u){i.__set[s]=u},configurable:!0})};for(var o in t)n(o);return i}function _t(i,t){i.page=i.page||{},i.page.x=t.page.x,i.page.y=t.page.y,i.client=i.client||{},i.client.x=t.client.x,i.client.y=t.client.y,i.timeStamp=t.timeStamp}function Wt(i){i.page.x=0,i.page.y=0,i.client.x=0,i.client.y=0}function Vt(i){return i instanceof z.Event||i instanceof z.Touch}function at(i,t,n){return i=i||"page",(n=n||{}).x=t[i+"X"],n.y=t[i+"Y"],n}function wt(i,t){return t=t||{x:0,y:0},V.isOperaMobile&&Vt(i)?(at("screen",i,t),t.x+=window.scrollX,t.y+=window.scrollY):at("page",i,t),t}function et(i){return S.number(i.pointerId)?i.pointerId:i.identifier}function qi(i,t,n){var o=t.length>1?W(t):t[0];wt(o,i.page),(function(s,u){u=u||{},V.isOperaMobile&&Vt(s)?at("screen",s,u):at("client",s,u)})(o,i.client),i.timeStamp=n}function q(i){var t=[];return S.array(i)?(t[0]=i[0],t[1]=i[1]):i.type==="touchend"?i.touches.length===1?(t[0]=i.touches[0],t[1]=i.changedTouches[0]):i.touches.length===0&&(t[0]=i.changedTouches[0],t[1]=i.changedTouches[1]):(t[0]=i.touches[0],t[1]=i.touches[1]),t}function W(i){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},n=0;n<i.length;n++){var o=i[n];for(var s in t)t[s]+=o[s]}for(var u in t)t[u]/=i.length;return t}function ue(i){if(!i.length)return null;var t=q(i),n=Math.min(t[0].pageX,t[1].pageX),o=Math.min(t[0].pageY,t[1].pageY),s=Math.max(t[0].pageX,t[1].pageX),u=Math.max(t[0].pageY,t[1].pageY);return{x:n,y:o,left:n,top:o,right:s,bottom:u,width:s-n,height:u-o}}function he(i,t){var n=t+"X",o=t+"Y",s=q(i),u=s[0][n]-s[1][n],g=s[0][o]-s[1][o];return ot(u,g)}function me(i,t){var n=t+"X",o=t+"Y",s=q(i),u=s[1][n]-s[0][n],g=s[1][o]-s[0][o];return 180*Math.atan2(g,u)/Math.PI}function ke(i){return S.string(i.pointerType)?i.pointerType:S.number(i.pointerType)?[void 0,void 0,"touch","pen","mouse"][i.pointerType]:/touch/.test(i.type||"")||i instanceof z.Touch?"touch":"mouse"}function Te(i){var t=S.func(i.composedPath)?i.composedPath():i.path;return[Re(t?t[0]:i.target),Re(i.currentTarget)]}var J=(function(){function i(t){a(this,i),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return p(i,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),i})();Object.defineProperty(J.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var be=function(i,t){for(var n=0;n<t.length;n++){var o=t[n];i.push(o)}return i},Oe=function(i){return be([],i)},Le=function(i,t){for(var n=0;n<i.length;n++)if(t(i[n],n,i))return n;return-1},xe=function(i,t){return i[Le(i,t)]},Ke=(function(i){h(n,i);var t=v(n);function n(o,s,u){var g;a(this,n),(g=t.call(this,s._interaction)).dropzone=void 0,g.dragEvent=void 0,g.relatedTarget=void 0,g.draggable=void 0,g.propagationStopped=!1,g.immediatePropagationStopped=!1;var y=u==="dragleave"?o.prev:o.cur,b=y.element,E=y.dropzone;return g.type=u,g.target=b,g.currentTarget=b,g.dropzone=E,g.dragEvent=s,g.relatedTarget=s.target,g.draggable=s.interactable,g.timeStamp=s.timeStamp,g}return p(n,[{key:"reject",value:function(){var o=this,s=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&s.cur.dropzone===this.dropzone&&s.cur.element===this.target)if(s.prev.dropzone=this.dropzone,s.prev.element=this.target,s.rejected=!0,s.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var u=s.activeDrops,g=Le(u,(function(b){var E=b.dropzone,w=b.element;return E===o.dropzone&&w===o.target}));s.activeDrops.splice(g,1);var y=new n(s,this.dragEvent,"dropdeactivate");y.dropzone=this.dropzone,y.target=this.target,this.dropzone.fire(y)}else this.dropzone.fire(new n(s,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n})(J);function tt(i,t){for(var n=0,o=i.slice();n<o.length;n++){var s=o[n],u=s.dropzone,g=s.element;t.dropzone=u,t.target=g,u.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function kt(i,t){for(var n=(function(u,g){for(var y=[],b=0,E=u.interactables.list;b<E.length;b++){var w=E[b];if(w.options.drop.enabled){var C=w.options.drop.accept;if(!(S.element(C)&&C!==g||S.string(C)&&!le(g,C)||S.func(C)&&!C({dropzone:w,draggableElement:g})))for(var P=0,F=w.getAllElements();P<F.length;P++){var L=F[P];L!==g&&y.push({dropzone:w,element:L,rect:w.getRect(L)})}}}return y})(i,t),o=0;o<n.length;o++){var s=n[o];s.rect=s.dropzone.getRect(s.element)}return n}function Ft(i,t,n){for(var o=i.dropState,s=i.interactable,u=i.element,g=[],y=0,b=o.activeDrops;y<b.length;y++){var E=b[y],w=E.dropzone,C=E.element,P=E.rect,F=w.dropCheck(t,n,s,u,C,P);g.push(F?C:null)}var L=(function(R){for(var G,X,Z,ae=[],de=0;de<R.length;de++){var ne=R[de],se=R[G];if(ne&&de!==G)if(se){var He=Ee(ne),we=Ee(se);if(He!==ne.ownerDocument)if(we!==ne.ownerDocument)if(He!==we){ae=ae.length?ae:Ge(se);var Xe=void 0;if(se instanceof z.HTMLElement&&ne instanceof z.SVGElement&&!(ne instanceof z.SVGSVGElement)){if(ne===we)continue;Xe=ne.ownerSVGElement}else Xe=ne;for(var Je=Ge(Xe,se.ownerDocument),nt=0;Je[nt]&&Je[nt]===ae[nt];)nt++;var ri=[Je[nt-1],Je[nt],ae[nt]];if(ri[0])for(var qt=ri[0].lastChild;qt;){if(qt===ri[1]){G=de,ae=Je;break}if(qt===ri[2])break;qt=qt.previousSibling}}else Z=se,(parseInt(A(X=ne).getComputedStyle(X).zIndex,10)||0)>=(parseInt(A(Z).getComputedStyle(Z).zIndex,10)||0)&&(G=de);else G=de}else G=de}return G})(g);return o.activeDrops[L]||null}function St(i,t,n){var o=i.dropState,s={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return n.type==="dragstart"&&(s.activate=new Ke(o,n,"dropactivate"),s.activate.target=null,s.activate.dropzone=null),n.type==="dragend"&&(s.deactivate=new Ke(o,n,"dropdeactivate"),s.deactivate.target=null,s.deactivate.dropzone=null),o.rejected||(o.cur.element!==o.prev.element&&(o.prev.dropzone&&(s.leave=new Ke(o,n,"dragleave"),n.dragLeave=s.leave.target=o.prev.element,n.prevDropzone=s.leave.dropzone=o.prev.dropzone),o.cur.dropzone&&(s.enter=new Ke(o,n,"dragenter"),n.dragEnter=o.cur.element,n.dropzone=o.cur.dropzone)),n.type==="dragend"&&o.cur.dropzone&&(s.drop=new Ke(o,n,"drop"),n.dropzone=o.cur.dropzone,n.relatedTarget=o.cur.element),n.type==="dragmove"&&o.cur.dropzone&&(s.move=new Ke(o,n,"dropmove"),n.dropzone=o.cur.dropzone)),s}function Et(i,t){var n=i.dropState,o=n.activeDrops,s=n.cur,u=n.prev;t.leave&&u.dropzone.fire(t.leave),t.enter&&s.dropzone.fire(t.enter),t.move&&s.dropzone.fire(t.move),t.drop&&s.dropzone.fire(t.drop),t.deactivate&&tt(o,t.deactivate),n.prev.dropzone=s.dropzone,n.prev.element=s.element}function zt(i,t){var n=i.interaction,o=i.iEvent,s=i.event;if(o.type==="dragmove"||o.type==="dragend"){var u=n.dropState;t.dynamicDrop&&(u.activeDrops=kt(t,n.element));var g=o,y=Ft(n,g,s);u.rejected=u.rejected&&!!y&&y.dropzone===u.cur.dropzone&&y.element===u.cur.element,u.cur.dropzone=y&&y.dropzone,u.cur.element=y&&y.element,u.events=St(n,0,g)}}var pe={id:"actions/drop",install:function(i){var t=i.actions,n=i.interactStatic,o=i.Interactable,s=i.defaults;i.usePlugin(j),o.prototype.dropzone=function(u){return(function(g,y){if(S.object(y)){if(g.options.drop.enabled=y.enabled!==!1,y.listeners){var b=Ie(y.listeners),E=Object.keys(b).reduce((function(C,P){return C[/^(enter|leave)/.test(P)?"drag".concat(P):/^(activate|deactivate|move)/.test(P)?"drop".concat(P):P]=b[P],C}),{}),w=g.options.drop.listeners;w&&g.off(w),g.on(E),g.options.drop.listeners=E}return S.func(y.ondrop)&&g.on("drop",y.ondrop),S.func(y.ondropactivate)&&g.on("dropactivate",y.ondropactivate),S.func(y.ondropdeactivate)&&g.on("dropdeactivate",y.ondropdeactivate),S.func(y.ondragenter)&&g.on("dragenter",y.ondragenter),S.func(y.ondragleave)&&g.on("dragleave",y.ondragleave),S.func(y.ondropmove)&&g.on("dropmove",y.ondropmove),/^(pointer|center)$/.test(y.overlap)?g.options.drop.overlap=y.overlap:S.number(y.overlap)&&(g.options.drop.overlap=Math.max(Math.min(1,y.overlap),0)),"accept"in y&&(g.options.drop.accept=y.accept),"checker"in y&&(g.options.drop.checker=y.checker),g}return S.bool(y)?(g.options.drop.enabled=y,g):g.options.drop})(this,u)},o.prototype.dropCheck=function(u,g,y,b,E,w){return(function(C,P,F,L,R,G,X){var Z=!1;if(!(X=X||C.getRect(G)))return!!C.options.drop.checker&&C.options.drop.checker(P,F,Z,C,G,L,R);var ae=C.options.drop.overlap;if(ae==="pointer"){var de=ve(L,R,"drag"),ne=wt(P);ne.x+=de.x,ne.y+=de.y;var se=ne.x>X.left&&ne.x<X.right,He=ne.y>X.top&&ne.y<X.bottom;Z=se&&He}var we=L.getRect(R);if(we&&ae==="center"){var Xe=we.left+we.width/2,Je=we.top+we.height/2;Z=Xe>=X.left&&Xe<=X.right&&Je>=X.top&&Je<=X.bottom}return we&&S.number(ae)&&(Z=Math.max(0,Math.min(X.right,we.right)-Math.max(X.left,we.left))*Math.max(0,Math.min(X.bottom,we.bottom)-Math.max(X.top,we.top))/(we.width*we.height)>=ae),C.options.drop.checker&&(Z=C.options.drop.checker(P,F,Z,C,G,L,R)),Z})(this,u,g,y,b,E,w)},n.dynamicDrop=function(u){return S.bool(u)?(i.dynamicDrop=u,n):i.dynamicDrop},ee(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",i.dynamicDrop=!1,s.actions.drop=pe.defaults},listeners:{"interactions:before-action-start":function(i){var t=i.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(i,t){var n=i.interaction,o=(i.event,i.iEvent);if(n.prepared.name==="drag"){var s=n.dropState;s.activeDrops=[],s.events={},s.activeDrops=kt(t,n.element),s.events=St(n,0,o),s.events.activate&&(tt(s.activeDrops,s.events.activate),t.fire("actions/drop:start",{interaction:n,dragEvent:o}))}},"interactions:action-move":zt,"interactions:after-action-move":function(i,t){var n=i.interaction,o=i.iEvent;if(n.prepared.name==="drag"){var s=n.dropState;Et(n,s.events),t.fire("actions/drop:move",{interaction:n,dragEvent:o}),s.events={}}},"interactions:action-end":function(i,t){if(i.interaction.prepared.name==="drag"){var n=i.interaction,o=i.iEvent;zt(i,t),Et(n,n.dropState.events),t.fire("actions/drop:end",{interaction:n,dragEvent:o})}},"interactions:stop":function(i){var t=i.interaction;if(t.prepared.name==="drag"){var n=t.dropState;n&&(n.activeDrops=null,n.events=null,n.cur.dropzone=null,n.cur.element=null,n.prev.dropzone=null,n.prev.element=null,n.rejected=!1)}}},getActiveDrops:kt,getDrop:Ft,getDropEvents:St,fireDropEvents:Et,filterEventType:function(i){return i.search("drag")===0||i.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},ce=pe;function _e(i){var t=i.interaction,n=i.iEvent,o=i.phase;if(t.prepared.name==="gesture"){var s=t.pointers.map((function(E){return E.pointer})),u=o==="start",g=o==="end",y=t.interactable.options.deltaSource;if(n.touches=[s[0],s[1]],u)n.distance=he(s,y),n.box=ue(s),n.scale=1,n.ds=0,n.angle=me(s,y),n.da=0,t.gesture.startDistance=n.distance,t.gesture.startAngle=n.angle;else if(g||t.pointers.length<2){var b=t.prevEvent;n.distance=b.distance,n.box=b.box,n.scale=b.scale,n.ds=0,n.angle=b.angle,n.da=0}else n.distance=he(s,y),n.box=ue(s),n.scale=n.distance/t.gesture.startDistance,n.angle=me(s,y),n.ds=n.scale-t.gesture.scale,n.da=n.angle-t.gesture.angle;t.gesture.distance=n.distance,t.gesture.angle=n.angle,S.number(n.scale)&&n.scale!==1/0&&!isNaN(n.scale)&&(t.gesture.scale=n.scale)}}var je={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(i){var t=i.actions,n=i.Interactable,o=i.defaults;n.prototype.gesturable=function(s){return S.object(s)?(this.options.gesture.enabled=s.enabled!==!1,this.setPerAction("gesture",s),this.setOnEvents("gesture",s),this):S.bool(s)?(this.options.gesture.enabled=s,this):this.options.gesture},t.map.gesture=je,t.methodDict.gesture="gesturable",o.actions.gesture=je.defaults},listeners:{"interactions:action-start":_e,"interactions:action-move":_e,"interactions:action-end":_e,"interactions:new":function(i){i.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(i){if(!(i.interaction.pointers.length<2)){var t=i.interactable.options.gesture;if(t&&t.enabled)return i.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(i){return i.search("gesture")===0}},Ve=je;function Ct(i,t,n,o,s,u,g){if(!t)return!1;if(t===!0){var y=S.number(u.width)?u.width:u.right-u.left,b=S.number(u.height)?u.height:u.bottom-u.top;if(g=Math.min(g,Math.abs((i==="left"||i==="right"?y:b)/2)),y<0&&(i==="left"?i="right":i==="right"&&(i="left")),b<0&&(i==="top"?i="bottom":i==="bottom"&&(i="top")),i==="left"){var E=y>=0?u.left:u.right;return n.x<E+g}if(i==="top"){var w=b>=0?u.top:u.bottom;return n.y<w+g}if(i==="right")return n.x>(y>=0?u.right:u.left)-g;if(i==="bottom")return n.y>(b>=0?u.bottom:u.top)-g}return!!S.element(o)&&(S.element(t)?t===o:De(o,t,s))}function At(i){var t=i.iEvent,n=i.interaction;if(n.prepared.name==="resize"&&n.resizeAxes){var o=t;n.interactable.options.resize.square?(n.resizeAxes==="y"?o.delta.x=o.delta.y:o.delta.y=o.delta.x,o.axes="xy"):(o.axes=n.resizeAxes,n.resizeAxes==="x"?o.delta.y=0:n.resizeAxes==="y"&&(o.delta.x=0))}}var Me,Fe,$e={id:"actions/resize",before:["actions/drag"],install:function(i){var t=i.actions,n=i.browser,o=i.Interactable,s=i.defaults;$e.cursors=(function(u){return u.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(n),$e.defaultMargin=n.supportsTouch||n.supportsPointerEvent?20:10,o.prototype.resizable=function(u){return(function(g,y,b){return S.object(y)?(g.options.resize.enabled=y.enabled!==!1,g.setPerAction("resize",y),g.setOnEvents("resize",y),S.string(y.axis)&&/^x$|^y$|^xy$/.test(y.axis)?g.options.resize.axis=y.axis:y.axis===null&&(g.options.resize.axis=b.defaults.actions.resize.axis),S.bool(y.preserveAspectRatio)?g.options.resize.preserveAspectRatio=y.preserveAspectRatio:S.bool(y.square)&&(g.options.resize.square=y.square),g):S.bool(y)?(g.options.resize.enabled=y,g):g.options.resize})(this,u,i)},t.map.resize=$e,t.methodDict.resize="resizable",s.actions.resize=$e.defaults},listeners:{"interactions:new":function(i){i.interaction.resizeAxes="xy"},"interactions:action-start":function(i){(function(t){var n=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=n,u=o.rect;o._rects={start:ee({},u),corrected:ee({},u),previous:ee({},u),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},s.edges=o.prepared.edges,s.rect=o._rects.corrected,s.deltaRect=o._rects.delta}})(i),At(i)},"interactions:action-move":function(i){(function(t){var n=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var s=n,u=o.interactable.options.resize.invert,g=u==="reposition"||u==="negate",y=o.rect,b=o._rects,E=b.start,w=b.corrected,C=b.delta,P=b.previous;if(ee(P,w),g){if(ee(w,y),u==="reposition"){if(w.top>w.bottom){var F=w.top;w.top=w.bottom,w.bottom=F}if(w.left>w.right){var L=w.left;w.left=w.right,w.right=L}}}else w.top=Math.min(y.top,E.bottom),w.bottom=Math.max(y.bottom,E.top),w.left=Math.min(y.left,E.right),w.right=Math.max(y.right,E.left);for(var R in w.width=w.right-w.left,w.height=w.bottom-w.top,w)C[R]=w[R]-P[R];s.edges=o.prepared.edges,s.rect=w,s.deltaRect=C}})(i),At(i)},"interactions:action-end":function(i){var t=i.iEvent,n=i.interaction;if(n.prepared.name==="resize"&&n.prepared.edges){var o=t;o.edges=n.prepared.edges,o.rect=n._rects.corrected,o.deltaRect=n._rects.delta}},"auto-start:check":function(i){var t=i.interaction,n=i.interactable,o=i.element,s=i.rect,u=i.buttons;if(s){var g=ee({},t.coords.cur.page),y=n.options.resize;if(y&&y.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(u&y.mouseButtons)!=0)){if(S.object(y.edges)){var b={left:!1,right:!1,top:!1,bottom:!1};for(var E in b)b[E]=Ct(E,y.edges[E],g,t._latestPointer.eventTarget,o,s,y.margin||$e.defaultMargin);b.left=b.left&&!b.right,b.top=b.top&&!b.bottom,(b.left||b.right||b.top||b.bottom)&&(i.action={name:"resize",edges:b})}else{var w=y.axis!=="y"&&g.x>s.right-$e.defaultMargin,C=y.axis!=="x"&&g.y>s.bottom-$e.defaultMargin;(w||C)&&(i.action={name:"resize",axes:(w?"x":"")+(C?"y":"")})}return!i.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(i){var t=i.edges,n=i.axis,o=i.name,s=$e.cursors,u=null;if(n)u=s[o+n];else if(t){for(var g="",y=0,b=["top","bottom","left","right"];y<b.length;y++){var E=b[y];t[E]&&(g+=E)}u=s[g]}return u},filterEventType:function(i){return i.search("resize")===0},defaultMargin:null},ft=$e,Xt={id:"actions",install:function(i){i.usePlugin(Ve),i.usePlugin(ft),i.usePlugin(j),i.usePlugin(ce)}},it=0,st={request:function(i){return Me(i)},cancel:function(i){return Fe(i)},init:function(i){if(Me=i.requestAnimationFrame,Fe=i.cancelAnimationFrame,!Me)for(var t=["ms","moz","webkit","o"],n=0;n<t.length;n++){var o=t[n];Me=i["".concat(o,"RequestAnimationFrame")],Fe=i["".concat(o,"CancelAnimationFrame")]||i["".concat(o,"CancelRequestAnimationFrame")]}Me=Me&&Me.bind(i),Fe=Fe&&Fe.bind(i),Me||(Me=function(s){var u=Date.now(),g=Math.max(0,16-(u-it)),y=i.setTimeout((function(){s(u+g)}),g);return it=u+g,y},Fe=function(s){return clearTimeout(s)})}},re={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(i){re.isScrolling=!0,st.cancel(re.i),i.autoScroll=re,re.interaction=i,re.prevTime=re.now(),re.i=st.request(re.scroll)},stop:function(){re.isScrolling=!1,re.interaction&&(re.interaction.autoScroll=null),st.cancel(re.i)},scroll:function(){var i=re.interaction,t=i.interactable,n=i.element,o=i.prepared.name,s=t.options[o].autoScroll,u=Hi(s.container,t,n),g=re.now(),y=(g-re.prevTime)/1e3,b=s.speed*y;if(b>=1){var E={x:re.x*b,y:re.y*b};if(E.x||E.y){var w=Yi(u);S.window(u)?u.scrollBy(E.x,E.y):u&&(u.scrollLeft+=E.x,u.scrollTop+=E.y);var C=Yi(u),P={x:C.x-w.x,y:C.y-w.y};(P.x||P.y)&&t.fire({type:"autoscroll",target:n,interactable:t,delta:P,interaction:i,container:u})}re.prevTime=g}re.isScrolling&&(st.cancel(re.i),re.i=st.request(re.scroll))},check:function(i,t){var n;return(n=i.options[t].autoScroll)==null?void 0:n.enabled},onInteractionMove:function(i){var t=i.interaction,n=i.pointer;if(t.interacting()&&re.check(t.interactable,t.prepared.name))if(t.simulation)re.x=re.y=0;else{var o,s,u,g,y=t.interactable,b=t.element,E=t.prepared.name,w=y.options[E].autoScroll,C=Hi(w.container,y,b);if(S.window(C))g=n.clientX<re.margin,o=n.clientY<re.margin,s=n.clientX>C.innerWidth-re.margin,u=n.clientY>C.innerHeight-re.margin;else{var P=ye(C);g=n.clientX<P.left+re.margin,o=n.clientY<P.top+re.margin,s=n.clientX>P.right-re.margin,u=n.clientY>P.bottom-re.margin}re.x=s?1:g?-1:0,re.y=u?1:o?-1:0,re.isScrolling||(re.margin=w.margin,re.speed=w.speed,re.start(t))}}};function Hi(i,t,n){return(S.string(i)?bt(i,t,n):i)||A(n)}function Yi(i){return S.window(i)&&(i=window.document.body),{x:i.scrollLeft,y:i.scrollTop}}var Er={id:"auto-scroll",install:function(i){var t=i.defaults,n=i.actions;i.autoScroll=re,re.now=function(){return i.now()},n.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=re.defaults},listeners:{"interactions:new":function(i){i.interaction.autoScroll=null},"interactions:destroy":function(i){i.interaction.autoScroll=null,re.stop(),re.interaction&&(re.interaction=null)},"interactions:stop":re.stop,"interactions:action-move":function(i){return re.onInteractionMove(i)}}},Cr=Er;function Dt(i,t){var n=!1;return function(){return n||(M.console.warn(t),n=!0),i.apply(this,arguments)}}function ui(i,t){return i.name=t.name,i.axis=t.axis,i.edges=t.edges,i}function Ar(i){return S.bool(i)?(this.options.styleCursor=i,this):i===null?(delete this.options.styleCursor,this):this.options.styleCursor}function Or(i){return S.func(i)?(this.options.actionChecker=i,this):i===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Tr={id:"auto-start/interactableMethods",install:function(i){var t=i.Interactable;t.prototype.getAction=function(n,o,s,u){var g=(function(y,b,E,w,C){var P=y.getRect(w),F=b.buttons||{0:1,1:4,3:8,4:16}[b.button],L={action:null,interactable:y,interaction:E,element:w,rect:P,buttons:F};return C.fire("auto-start:check",L),L.action})(this,o,s,u,i);return this.options.actionChecker?this.options.actionChecker(n,o,g,this,u,s):g},t.prototype.ignoreFrom=Dt((function(n){return this._backCompatOption("ignoreFrom",n)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=Dt((function(n){return this._backCompatOption("allowFrom",n)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Or,t.prototype.styleCursor=Ar}};function Ki(i,t,n,o,s){return t.testIgnoreAllow(t.options[i.name],n,o)&&t.options[i.name].enabled&&Gt(t,n,i,s)?i:null}function Mr(i,t,n,o,s,u,g){for(var y=0,b=o.length;y<b;y++){var E=o[y],w=s[y],C=E.getAction(t,n,i,w);if(C){var P=Ki(C,E,w,u,g);if(P)return{action:P,interactable:E,element:w}}}return{action:null,interactable:null,element:null}}function $i(i,t,n,o,s){var u=[],g=[],y=o;function b(w){u.push(w),g.push(y)}for(;S.element(y);){u=[],g=[],s.interactables.forEachMatch(y,b);var E=Mr(i,t,n,u,g,o,s);if(E.action&&!E.interactable.options[E.action.name].manualStart)return E;y=Q(y)}return{action:null,interactable:null,element:null}}function Ui(i,t,n){var o=t.action,s=t.interactable,u=t.element;o=o||{name:null},i.interactable=s,i.element=u,ui(i.prepared,o),i.rect=s&&o.name?s.getRect(u):null,Vi(i,n),n.fire("autoStart:prepared",{interaction:i})}function Gt(i,t,n,o){var s=i.options,u=s[n.name].max,g=s[n.name].maxPerElement,y=o.autoStart.maxInteractions,b=0,E=0,w=0;if(!(u&&g&&y))return!1;for(var C=0,P=o.interactions.list;C<P.length;C++){var F=P[C],L=F.prepared.name;if(F.interacting()&&(++b>=y||F.interactable===i&&((E+=L===n.name?1:0)>=u||F.element===t&&(w++,L===n.name&&w>=g))))return!1}return y>0}function Wi(i,t){return S.number(i)?(t.autoStart.maxInteractions=i,this):t.autoStart.maxInteractions}function pi(i,t,n){var o=n.autoStart.cursorElement;o&&o!==i&&(o.style.cursor=""),i.ownerDocument.documentElement.style.cursor=t,i.style.cursor=t,n.autoStart.cursorElement=t?i:null}function Vi(i,t){var n=i.interactable,o=i.element,s=i.prepared;if(i.pointerType==="mouse"&&n&&n.options.styleCursor){var u="";if(s.name){var g=n.options[s.name].cursorChecker;u=S.func(g)?g(s,n,o,i._interacting):t.actions.map[s.name].getCursor(s)}pi(i.element,u||"",t)}else t.autoStart.cursorElement&&pi(t.autoStart.cursorElement,"",t)}var Pr={id:"auto-start/base",before:["actions"],install:function(i){var t=i.interactStatic,n=i.defaults;i.usePlugin(Tr),n.base.actionChecker=null,n.base.styleCursor=!0,ee(n.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(o){return Wi(o,i)},i.autoStart={maxInteractions:1/0,withinInteractionLimit:Gt,cursorElement:null}},listeners:{"interactions:down":function(i,t){var n=i.interaction,o=i.pointer,s=i.event,u=i.eventTarget;n.interacting()||Ui(n,$i(n,o,s,u,t),t)},"interactions:move":function(i,t){(function(n,o){var s=n.interaction,u=n.pointer,g=n.event,y=n.eventTarget;s.pointerType!=="mouse"||s.pointerIsDown||s.interacting()||Ui(s,$i(s,u,g,y,o),o)})(i,t),(function(n,o){var s=n.interaction;if(s.pointerIsDown&&!s.interacting()&&s.pointerWasMoved&&s.prepared.name){o.fire("autoStart:before-start",n);var u=s.interactable,g=s.prepared.name;g&&u&&(u.options[g].manualStart||!Gt(u,s.element,s.prepared,o)?s.stop():(s.start(s.prepared,u,s.element),Vi(s,o)))}})(i,t)},"interactions:stop":function(i,t){var n=i.interaction,o=n.interactable;o&&o.options.styleCursor&&pi(n.element,"",t)}},maxInteractions:Wi,withinInteractionLimit:Gt,validateAction:Ki},hi=Pr,Ir={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(i,t){var n=i.interaction,o=i.eventTarget,s=i.dx,u=i.dy;if(n.prepared.name==="drag"){var g=Math.abs(s),y=Math.abs(u),b=n.interactable.options.drag,E=b.startAxis,w=g>y?"x":g<y?"y":"xy";if(n.prepared.axis=b.lockAxis==="start"?w[0]:b.lockAxis,w!=="xy"&&E!=="xy"&&E!==w){n.prepared.name=null;for(var C=o,P=function(L){if(L!==n.interactable){var R=n.interactable.options.drag;if(!R.manualStart&&L.testIgnoreAllow(R,C,o)){var G=L.getAction(n.downPointer,n.downEvent,n,C);if(G&&G.name==="drag"&&(function(X,Z){if(!Z)return!1;var ae=Z.options.drag.startAxis;return X==="xy"||ae==="xy"||ae===X})(w,L)&&hi.validateAction(G,L,C,o,t))return L}}};S.element(C);){var F=t.interactables.forEachMatch(C,P);if(F){n.prepared.name="drag",n.interactable=F,n.element=C;break}C=Q(C)}}}}}};function fi(i){var t=i.prepared&&i.prepared.name;if(!t)return null;var n=i.interactable.options;return n[t].hold||n[t].delay}var Lr={id:"auto-start/hold",install:function(i){var t=i.defaults;i.usePlugin(hi),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(i){i.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(i){var t=i.interaction,n=fi(t);n>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),n))},"interactions:move":function(i){var t=i.interaction,n=i.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!n&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(i){var t=i.interaction;fi(t)>0&&(t.prepared.name=null)}},getHoldDuration:fi},Fr=Lr,zr={id:"auto-start",install:function(i){i.usePlugin(hi),i.usePlugin(Fr),i.usePlugin(Ir)}},Dr=function(i){return/^(always|never|auto)$/.test(i)?(this.options.preventDefault=i,this):S.bool(i)?(this.options.preventDefault=i?"always":"never",this):this.options.preventDefault};function Rr(i){var t=i.interaction,n=i.event;t.interactable&&t.interactable.checkAndPreventDefault(n)}var Xi={id:"core/interactablePreventDefault",install:function(i){var t=i.Interactable;t.prototype.preventDefault=Dr,t.prototype.checkAndPreventDefault=function(n){return(function(o,s,u){var g=o.options.preventDefault;if(g!=="never")if(g!=="always"){if(s.events.supportsPassive&&/^touch(start|move)$/.test(u.type)){var y=A(u.target).document,b=s.getDocOptions(y);if(!b||!b.events||b.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(u.type)||S.element(u.target)&&le(u.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||u.preventDefault()}else u.preventDefault()})(this,i,n)},i.interactions.docEvents.push({type:"dragstart",listener:function(n){for(var o=0,s=i.interactions.list;o<s.length;o++){var u=s[o];if(u.element&&(u.element===n.target||oe(u.element,n.target)))return void u.interactable.checkAndPreventDefault(n)}}})},listeners:["down","move","up","cancel"].reduce((function(i,t){return i["interactions:".concat(t)]=Rr,i}),{})};function Jt(i,t){if(t.phaselessTypes[i])return!0;for(var n in t.map)if(i.indexOf(n)===0&&i.substr(n.length)in t.phases)return!0;return!1}function Ot(i){var t={};for(var n in i){var o=i[n];S.plainObject(o)?t[n]=Ot(o):S.array(o)?t[n]=Oe(o):t[n]=o}return t}var gi=(function(){function i(t){a(this,i),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=Qt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return p(i,[{key:"start",value:function(t,n){var o,s,u=t.phase,g=this.interaction,y=(function(E){var w=E.interactable.options[E.prepared.name],C=w.modifiers;return C&&C.length?C:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(P){var F=w[P];return F&&F.enabled&&{options:F,methods:F._methods}})).filter((function(P){return!!P}))})(g);this.prepareStates(y),this.startEdges=ee({},g.edges),this.edges=ee({},this.startEdges),this.startOffset=(o=g.rect,s=n,o?{left:s.x-o.left,top:s.y-o.top,right:o.right-s.x,bottom:o.bottom-s.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var b=this.fillArg({phase:u,pageCoords:n,preEnd:!1});return this.result=Qt(),this.startAll(b),this.result=this.setAll(b)}},{key:"fillArg",value:function(t){var n=this.interaction;return t.interaction=n,t.interactable=n.interactable,t.element=n.element,t.rect||(t.rect=n.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var n=0,o=this.states;n<o.length;n++){var s=o[n];s.methods.start&&(t.state=s,s.methods.start(t))}}},{key:"setAll",value:function(t){var n=t.phase,o=t.preEnd,s=t.skipModifiers,u=t.rect,g=t.edges;t.coords=ee({},t.pageCoords),t.rect=ee({},u),t.edges=ee({},g);for(var y=s?this.states.slice(s):this.states,b=Qt(t.coords,t.rect),E=0;E<y.length;E++){var w,C=y[E],P=C.options,F=ee({},t.coords),L=null;(w=C.methods)!=null&&w.set&&this.shouldDo(P,o,n)&&(t.state=C,L=C.methods.set(t),ge(t.edges,t.rect,{x:t.coords.x-F.x,y:t.coords.y-F.y})),b.eventProps.push(L)}ee(this.edges,t.edges),b.delta.x=t.coords.x-t.pageCoords.x,b.delta.y=t.coords.y-t.pageCoords.y,b.rectDelta.left=t.rect.left-u.left,b.rectDelta.right=t.rect.right-u.right,b.rectDelta.top=t.rect.top-u.top,b.rectDelta.bottom=t.rect.bottom-u.bottom;var R=this.result.coords,G=this.result.rect;if(R&&G){var X=b.rect.left!==G.left||b.rect.right!==G.right||b.rect.top!==G.top||b.rect.bottom!==G.bottom;b.changed=X||R.x!==b.coords.x||R.y!==b.coords.y}return b}},{key:"applyToInteraction",value:function(t){var n=this.interaction,o=t.phase,s=n.coords.cur,u=n.coords.start,g=this.result,y=this.startDelta,b=g.delta;o==="start"&&ee(this.startDelta,g.delta);for(var E=0,w=[[u,y],[s,b]];E<w.length;E++){var C=w[E],P=C[0],F=C[1];P.page.x+=F.x,P.page.y+=F.y,P.client.x+=F.x,P.client.y+=F.y}var L=this.result.rectDelta,R=t.rect||n.rect;R.left+=L.left,R.right+=L.right,R.top+=L.top,R.bottom+=L.bottom,R.width=R.right-R.left,R.height=R.bottom-R.top}},{key:"setAndApply",value:function(t){var n=this.interaction,o=t.phase,s=t.preEnd,u=t.skipModifiers,g=this.setAll(this.fillArg({preEnd:s,phase:o,pageCoords:t.modifiedCoords||n.coords.cur.page}));if(this.result=g,!g.changed&&(!u||u<this.states.length)&&n.interacting())return!1;if(t.modifiedCoords){var y=n.coords.cur.page,b={x:t.modifiedCoords.x-y.x,y:t.modifiedCoords.y-y.y};g.coords.x+=b.x,g.coords.y+=b.y,g.delta.x+=b.x,g.delta.y+=b.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var n=t.interaction,o=t.event,s=this.states;if(s&&s.length){for(var u=!1,g=0;g<s.length;g++){var y=s[g];t.state=y;var b=y.options,E=y.methods,w=E.beforeEnd&&E.beforeEnd(t);if(w)return this.endResult=w,!1;u=u||!u&&this.shouldDo(b,!0,t.phase,!0)}u&&n.move({event:o,preEnd:!0})}}},{key:"stop",value:function(t){var n=t.interaction;if(this.states&&this.states.length){var o=ee({states:this.states,interactable:n.interactable,element:n.element,rect:null},t);this.fillArg(o);for(var s=0,u=this.states;s<u.length;s++){var g=u[s];o.state=g,g.methods.stop&&g.methods.stop(o)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var n=0;n<t.length;n++){var o=t[n],s=o.options,u=o.methods,g=o.name;this.states.push({options:s,methods:u,index:n,name:g})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var n=t.interaction,o=n.coords,s=n.rect,u=n.modification;if(u.result){for(var g=u.startDelta,y=u.result,b=y.delta,E=y.rectDelta,w=0,C=[[o.start,g],[o.cur,b]];w<C.length;w++){var P=C[w],F=P[0],L=P[1];F.page.x-=L.x,F.page.y-=L.y,F.client.x-=L.x,F.client.y-=L.y}s.left-=E.left,s.right-=E.right,s.top-=E.top,s.bottom-=E.bottom}}},{key:"shouldDo",value:function(t,n,o,s){return!(!t||t.enabled===!1||s&&!t.endOnly||t.endOnly&&!n||o==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(n){return Ot(n)})),this.result=Qt(ee({},t.result.coords),ee({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),i})();function Qt(i,t){return{rect:t,coords:i,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function ct(i,t){var n=i.defaults,o={start:i.start,set:i.set,beforeEnd:i.beforeEnd,stop:i.stop},s=function(u){var g=u||{};for(var y in g.enabled=g.enabled!==!1,n)y in g||(g[y]=n[y]);var b={options:g,methods:o,name:t,enable:function(){return g.enabled=!0,b},disable:function(){return g.enabled=!1,b}};return b};return t&&typeof t=="string"&&(s._defaults=n,s._methods=o),s}function Rt(i){var t=i.iEvent,n=i.interaction.modification.result;n&&(t.modifiers=n.eventProps)}var Br={id:"modifiers/base",before:["actions"],install:function(i){i.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(i){var t=i.interaction;t.modification=new gi(t)},"interactions:before-action-start":function(i){var t=i.interaction,n=i.interaction.modification;n.start(i,t.coords.start.page),t.edges=n.edges,n.applyToInteraction(i)},"interactions:before-action-move":function(i){var t=i.interaction,n=t.modification,o=n.setAndApply(i);return t.edges=n.edges,o},"interactions:before-action-end":function(i){var t=i.interaction,n=t.modification,o=n.beforeEnd(i);return t.edges=n.startEdges,o},"interactions:action-start":Rt,"interactions:action-move":Rt,"interactions:action-end":Rt,"interactions:after-action-start":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-move":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:stop":function(i){return i.interaction.modification.stop(i)}}},Gi=Br,Ji={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},mi=(function(i){h(n,i);var t=v(n);function n(o,s,u,g,y,b,E){var w;a(this,n),(w=t.call(this,o)).relatedTarget=null,w.screenX=void 0,w.screenY=void 0,w.button=void 0,w.buttons=void 0,w.ctrlKey=void 0,w.shiftKey=void 0,w.altKey=void 0,w.metaKey=void 0,w.page=void 0,w.client=void 0,w.delta=void 0,w.rect=void 0,w.x0=void 0,w.y0=void 0,w.t0=void 0,w.dt=void 0,w.duration=void 0,w.clientX0=void 0,w.clientY0=void 0,w.velocity=void 0,w.speed=void 0,w.swipe=void 0,w.axes=void 0,w.preEnd=void 0,y=y||o.element;var C=o.interactable,P=(C&&C.options||Ji).deltaSource,F=ve(C,y,u),L=g==="start",R=g==="end",G=L?f(w):o.prevEvent,X=L?o.coords.start:R?{page:G.page,client:G.client,timeStamp:o.coords.cur.timeStamp}:o.coords.cur;return w.page=ee({},X.page),w.client=ee({},X.client),w.rect=ee({},o.rect),w.timeStamp=X.timeStamp,R||(w.page.x-=F.x,w.page.y-=F.y,w.client.x-=F.x,w.client.y-=F.y),w.ctrlKey=s.ctrlKey,w.altKey=s.altKey,w.shiftKey=s.shiftKey,w.metaKey=s.metaKey,w.button=s.button,w.buttons=s.buttons,w.target=y,w.currentTarget=y,w.preEnd=b,w.type=E||u+(g||""),w.interactable=C,w.t0=L?o.pointers[o.pointers.length-1].downTime:G.t0,w.x0=o.coords.start.page.x-F.x,w.y0=o.coords.start.page.y-F.y,w.clientX0=o.coords.start.client.x-F.x,w.clientY0=o.coords.start.client.y-F.y,w.delta=L||R?{x:0,y:0}:{x:w[P].x-G[P].x,y:w[P].y-G[P].y},w.dt=o.coords.delta.timeStamp,w.duration=w.timeStamp-w.t0,w.velocity=ee({},o.coords.velocity[P]),w.speed=ot(w.velocity.x,w.velocity.y),w.swipe=R||g==="inertiastart"?w.getSwipe():null,w}return p(n,[{key:"getSwipe",value:function(){var o=this._interaction;if(o.prevEvent.speed<600||this.timeStamp-o.prevEvent.timeStamp>150)return null;var s=180*Math.atan2(o.prevEvent.velocityY,o.prevEvent.velocityX)/Math.PI;s<0&&(s+=360);var u=112.5<=s&&s<247.5,g=202.5<=s&&s<337.5;return{up:g,down:!g&&22.5<=s&&s<157.5,left:u,right:!u&&(292.5<=s||s<67.5),angle:s,speed:o.prevEvent.speed,velocity:{x:o.prevEvent.velocityX,y:o.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),n})(J);Object.defineProperties(mi.prototype,{pageX:{get:function(){return this.page.x},set:function(i){this.page.x=i}},pageY:{get:function(){return this.page.y},set:function(i){this.page.y=i}},clientX:{get:function(){return this.client.x},set:function(i){this.client.x=i}},clientY:{get:function(){return this.client.y},set:function(i){this.client.y=i}},dx:{get:function(){return this.delta.x},set:function(i){this.delta.x=i}},dy:{get:function(){return this.delta.y},set:function(i){this.delta.y=i}},velocityX:{get:function(){return this.velocity.x},set:function(i){this.velocity.x=i}},velocityY:{get:function(){return this.velocity.y},set:function(i){this.velocity.y=i}}});var Nr=p((function i(t,n,o,s,u){a(this,i),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=n,this.event=o,this.downTime=s,this.downTarget=u})),jr=(function(i){return i.interactable="",i.element="",i.prepared="",i.pointerIsDown="",i.pointerWasMoved="",i._proxy="",i})({}),Qi=(function(i){return i.start="",i.move="",i.end="",i.stop="",i.interacting="",i})({}),qr=0,Hr=(function(){function i(t){var n=this,o=t.pointerType,s=t.scopeFire;a(this,i),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Dt((function(w){this.move(w)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=qr++,this._scopeFire=s,this.pointerType=o;var u=this;this._proxy={};var g=function(w){Object.defineProperty(n._proxy,w,{get:function(){return u[w]}})};for(var y in jr)g(y);var b=function(w){Object.defineProperty(n._proxy,w,{value:function(){return u[w].apply(u,arguments)}})};for(var E in Qi)b(E);this._scopeFire("interactions:new",{interaction:this})}return p(i,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,n,o){var s=this.updatePointer(t,n,o,!0),u=this.pointers[s];this._scopeFire("interactions:down",{pointer:t,event:n,eventTarget:o,pointerIndex:s,pointerInfo:u,type:"down",interaction:this})}},{key:"start",value:function(t,n,o){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!n.options[t.name].enabled)&&(ui(this.prepared,t),this.interactable=n,this.element=o,this.rect=n.getRect(o),this.edges=this.prepared.edges?ee({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,n,o){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,n,o,!1);var s,u,g=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(s=this.coords.cur.client.x-this.coords.start.client.x,u=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=ot(s,u)>this.pointerMoveTolerance);var y,b,E,w=this.getPointerIndex(t),C={pointer:t,pointerIndex:w,pointerInfo:this.pointers[w],event:n,type:"move",eventTarget:o,dx:s,dy:u,duplicate:g,interaction:this};g||(y=this.coords.velocity,b=this.coords.delta,E=Math.max(b.timeStamp/1e3,.001),y.page.x=b.page.x/E,y.page.y=b.page.y/E,y.client.x=b.client.x/E,y.client.y=b.client.y/E,y.timeStamp=E),this._scopeFire("interactions:move",C),g||this.simulation||(this.interacting()&&(C.type=null,this.move(C)),this.pointerWasMoved&&_t(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||Wt(this.coords.delta),(t=ee({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,n,o,s){var u=this.getPointerIndex(t);u===-1&&(u=this.updatePointer(t,n,o,!1));var g=/cancel$/i.test(n.type)?"cancel":"up";this._scopeFire("interactions:".concat(g),{pointer:t,pointerIndex:u,pointerInfo:this.pointers[u],event:n,eventTarget:o,type:g,curEventTarget:s,interaction:this}),this.simulation||this.end(n),this.removePointer(t,n)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var n;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(n=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,n===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var n=et(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:Le(this.pointers,(function(o){return o.id===n}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,n,o,s){var u,g,y,b=et(t),E=this.getPointerIndex(t),w=this.pointers[E];return s=s!==!1&&(s||/(down|start)$/i.test(n.type)),w?w.pointer=t:(w=new Nr(b,t,n,null,null),E=this.pointers.length,this.pointers.push(w)),qi(this.coords.cur,this.pointers.map((function(C){return C.pointer})),this._now()),u=this.coords.delta,g=this.coords.prev,y=this.coords.cur,u.page.x=y.page.x-g.page.x,u.page.y=y.page.y-g.page.y,u.client.x=y.client.x-g.client.x,u.client.y=y.client.y-g.client.y,u.timeStamp=y.timeStamp-g.timeStamp,s&&(this.pointerIsDown=!0,w.downTime=this.coords.cur.timeStamp,w.downTarget=o,Ne(this.downPointer,t),this.interacting()||(_t(this.coords.start,this.coords.cur),_t(this.coords.prev,this.coords.cur),this.downEvent=n,this.pointerWasMoved=!1)),this._updateLatestPointer(t,n,o),this._scopeFire("interactions:update-pointer",{pointer:t,event:n,eventTarget:o,down:s,pointerInfo:w,pointerIndex:E,interaction:this}),E}},{key:"removePointer",value:function(t,n){var o=this.getPointerIndex(t);if(o!==-1){var s=this.pointers[o];this._scopeFire("interactions:remove-pointer",{pointer:t,event:n,eventTarget:null,pointerIndex:o,pointerInfo:s,interaction:this}),this.pointers.splice(o,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,n,o){this._latestPointer.pointer=t,this._latestPointer.event=n,this._latestPointer.eventTarget=o}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,n,o,s){return new mi(this,t,this.prepared.name,n,this.element,o,s)}},{key:"_fireEvent",value:function(t){var n;(n=this.interactable)==null||n.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var n=t.event,o=t.phase,s=t.preEnd,u=t.type,g=this.rect;if(g&&o==="move"&&(ge(this.edges,g,this.coords.delta[this.interactable.options.deltaSource]),g.width=g.right-g.left,g.height=g.bottom-g.top),this._scopeFire("interactions:before-action-".concat(o),t)===!1)return!1;var y=t.iEvent=this._createPreparedEvent(n,o,s,u);return this._scopeFire("interactions:action-".concat(o),t),o==="start"&&(this.prevEvent=y),this._fireEvent(y),this._scopeFire("interactions:after-action-".concat(o),t),!0}},{key:"_now",value:function(){return Date.now()}}]),i})();function Zi(i){en(i.interaction)}function en(i){if(!(function(n){return!(!n.offset.pending.x&&!n.offset.pending.y)})(i))return!1;var t=i.offset.pending;return yi(i.coords.cur,t),yi(i.coords.delta,t),ge(i.edges,i.rect,t),t.x=0,t.y=0,!0}function Yr(i){var t=i.x,n=i.y;this.offset.pending.x+=t,this.offset.pending.y+=n,this.offset.total.x+=t,this.offset.total.y+=n}function yi(i,t){var n=i.page,o=i.client,s=t.x,u=t.y;n.x+=s,n.y+=u,o.x+=s,o.y+=u}Qi.offsetBy="";var Kr={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(i){i.Interaction.prototype.offsetBy=Yr},listeners:{"interactions:new":function(i){i.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(i){return(function(t){t.pointerIsDown&&(yi(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(i.interaction)},"interactions:before-action-start":Zi,"interactions:before-action-move":Zi,"interactions:before-action-end":function(i){var t=i.interaction;if(en(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(i){var t=i.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},tn=Kr,$r=(function(){function i(t){a(this,i),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return p(i,[{key:"start",value:function(t){var n=this.interaction,o=Zt(n);if(!o||!o.enabled)return!1;var s=n.coords.velocity.client,u=ot(s.x,s.y),g=this.modification||(this.modification=new gi(n));if(g.copyFrom(n.modification),this.t0=n._now(),this.allowResume=o.allowResume,this.v0=u,this.currentOffset={x:0,y:0},this.startCoords=n.coords.cur.page,this.modifierArg=g.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-n.coords.cur.timeStamp<50&&u>o.minSpeed&&u>o.endSpeed)this.startInertia();else{if(g.result=g.setAll(this.modifierArg),!g.result.changed)return!1;this.startSmoothEnd()}return n.modification.result.rect=null,n.offsetBy(this.targetOffset),n._doPhase({interaction:n,event:t,phase:"inertiastart"}),n.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),n.modification.result.rect=null,this.active=!0,n.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,n=this.interaction.coords.velocity.client,o=Zt(this.interaction),s=o.resistance,u=-Math.log(o.endSpeed/this.v0)/s;this.targetOffset={x:(n.x-u)/s,y:(n.y-u)/s},this.te=u,this.lambda_v0=s/this.v0,this.one_ve_v0=1-o.endSpeed/this.v0;var g=this.modification,y=this.modifierArg;y.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},g.result=g.setAll(y),g.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+g.result.delta.x,y:this.targetOffset.y+g.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var n=this;this.timeout=st.request((function(){n.active&&t()}))}},{key:"inertiaTick",value:function(){var t,n,o,s,u,g,y,b=this,E=this.interaction,w=Zt(E).resistance,C=(E._now()-this.t0)/1e3;if(C<this.te){var P,F=1-(Math.exp(-w*C)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,n=0,o=this.targetOffset.x,s=this.targetOffset.y,u=this.modifiedOffset.x,g=this.modifiedOffset.y,P={x:nn(y=F,t,o,u),y:nn(y,n,s,g)}):P={x:this.targetOffset.x*F,y:this.targetOffset.y*F};var L={x:P.x-this.currentOffset.x,y:P.y-this.currentOffset.y};this.currentOffset.x+=L.x,this.currentOffset.y+=L.y,E.offsetBy(L),E.move(),this.onNextFrame((function(){return b.inertiaTick()}))}else E.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,n=this.interaction,o=n._now()-this.t0,s=Zt(n).smoothEndDuration;if(o<s){var u={x:rn(o,0,this.targetOffset.x,s),y:rn(o,0,this.targetOffset.y,s)},g={x:u.x-this.currentOffset.x,y:u.y-this.currentOffset.y};this.currentOffset.x+=g.x,this.currentOffset.y+=g.y,n.offsetBy(g),n.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else n.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var n=t.pointer,o=t.event,s=t.eventTarget,u=this.interaction;u.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),u.updatePointer(n,o,s,!0),u._doPhase({interaction:u,event:o,phase:"resume"}),_t(u.coords.prev,u.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,st.cancel(this.timeout)}}]),i})();function Zt(i){var t=i.interactable,n=i.prepared;return t&&t.options&&n.name&&t.options[n.name].inertia}var Ur={id:"inertia",before:["modifiers","actions"],install:function(i){var t=i.defaults;i.usePlugin(tn),i.usePlugin(Gi),i.actions.phases.inertiastart=!0,i.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(i){var t=i.interaction;t.inertia=new $r(t)},"interactions:before-action-end":function(i){var t=i.interaction,n=i.event;return(!t._interacting||t.simulation||!t.inertia.start(n))&&null},"interactions:down":function(i){var t=i.interaction,n=i.eventTarget,o=t.inertia;if(o.active)for(var s=n;S.element(s);){if(s===t.element){o.resume(i);break}s=Q(s)}},"interactions:stop":function(i){var t=i.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(i){var t=i.interaction.modification;t.stop(i),t.start(i,i.interaction.coords.cur.page),t.applyToInteraction(i)},"interactions:before-action-inertiastart":function(i){return i.interaction.modification.setAndApply(i)},"interactions:action-resume":Rt,"interactions:action-inertiastart":Rt,"interactions:after-action-inertiastart":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-resume":function(i){return i.interaction.modification.restoreInteractionCoords(i)}}};function nn(i,t,n,o){var s=1-i;return s*s*t+2*s*i*n+i*i*o}function rn(i,t,n,o){return-n*(i/=o)*(i-2)+t}var Wr=Ur;function on(i,t){for(var n=0;n<t.length;n++){var o=t[n];if(i.immediatePropagationStopped)break;o(i)}}var an=(function(){function i(t){a(this,i),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=ee({},t||{})}return p(i,[{key:"fire",value:function(t){var n,o=this.global;(n=this.types[t.type])&&on(t,n),!t.propagationStopped&&o&&(n=o[t.type])&&on(t,n)}},{key:"on",value:function(t,n){var o=Ie(t,n);for(t in o)this.types[t]=be(this.types[t]||[],o[t])}},{key:"off",value:function(t,n){var o=Ie(t,n);for(t in o){var s=this.types[t];if(s&&s.length)for(var u=0,g=o[t];u<g.length;u++){var y=g[u],b=s.indexOf(y);b!==-1&&s.splice(b,1)}}}},{key:"getRect",value:function(t){return null}}]),i})(),Vr=(function(){function i(t){a(this,i),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,Ne(this,t)}return p(i,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),i})();function Bt(i){return S.object(i)?{capture:!!i.capture,passive:!!i.passive}:{capture:!!i,passive:!1}}function ei(i,t){return i===t||(typeof i=="boolean"?!!t.capture===i&&!t.passive:!!i.capture==!!t.capture&&!!i.passive==!!t.passive)}var Xr={id:"events",install:function(i){var t,n=[],o={},s=[],u={add:g,remove:y,addDelegate:function(w,C,P,F,L){var R=Bt(L);if(!o[P]){o[P]=[];for(var G=0;G<s.length;G++){var X=s[G];g(X,P,b),g(X,P,E,!0)}}var Z=o[P],ae=xe(Z,(function(de){return de.selector===w&&de.context===C}));ae||(ae={selector:w,context:C,listeners:[]},Z.push(ae)),ae.listeners.push({func:F,options:R})},removeDelegate:function(w,C,P,F,L){var R,G=Bt(L),X=o[P],Z=!1;if(X)for(R=X.length-1;R>=0;R--){var ae=X[R];if(ae.selector===w&&ae.context===C){for(var de=ae.listeners,ne=de.length-1;ne>=0;ne--){var se=de[ne];if(se.func===F&&ei(se.options,G)){de.splice(ne,1),de.length||(X.splice(R,1),y(C,P,b),y(C,P,E,!0)),Z=!0;break}}if(Z)break}}},delegateListener:b,delegateUseCapture:E,delegatedEvents:o,documents:s,targets:n,supportsOptions:!1,supportsPassive:!1};function g(w,C,P,F){if(w.addEventListener){var L=Bt(F),R=xe(n,(function(G){return G.eventTarget===w}));R||(R={eventTarget:w,events:{}},n.push(R)),R.events[C]||(R.events[C]=[]),xe(R.events[C],(function(G){return G.func===P&&ei(G.options,L)}))||(w.addEventListener(C,P,u.supportsOptions?L:L.capture),R.events[C].push({func:P,options:L}))}}function y(w,C,P,F){if(w.addEventListener&&w.removeEventListener){var L=Le(n,(function(He){return He.eventTarget===w})),R=n[L];if(R&&R.events)if(C!=="all"){var G=!1,X=R.events[C];if(X){if(P==="all"){for(var Z=X.length-1;Z>=0;Z--){var ae=X[Z];y(w,C,ae.func,ae.options)}return}for(var de=Bt(F),ne=0;ne<X.length;ne++){var se=X[ne];if(se.func===P&&ei(se.options,de)){w.removeEventListener(C,P,u.supportsOptions?de:de.capture),X.splice(ne,1),X.length===0&&(delete R.events[C],G=!0);break}}}G&&!Object.keys(R.events).length&&n.splice(L,1)}else for(C in R.events)R.events.hasOwnProperty(C)&&y(w,C,"all")}}function b(w,C){for(var P=Bt(C),F=new Vr(w),L=o[w.type],R=Te(w)[0],G=R;S.element(G);){for(var X=0;X<L.length;X++){var Z=L[X],ae=Z.selector,de=Z.context;if(le(G,ae)&&oe(de,R)&&oe(de,G)){var ne=Z.listeners;F.currentTarget=G;for(var se=0;se<ne.length;se++){var He=ne[se];ei(He.options,P)&&He.func(F)}}}G=Q(G)}}function E(w){return b(w,!0)}return(t=i.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return u.supportsOptions=!0},get passive(){return u.supportsPassive=!0}}),i.events=u,u}},vi={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(i){for(var t=0,n=vi.methodOrder;t<n.length;t++){var o=n[t],s=vi[o](i);if(s)return s}return null},simulationResume:function(i){var t=i.pointerType,n=i.eventType,o=i.eventTarget,s=i.scope;if(!/down|start/i.test(n))return null;for(var u=0,g=s.interactions.list;u<g.length;u++){var y=g[u],b=o;if(y.simulation&&y.simulation.allowResume&&y.pointerType===t)for(;b;){if(b===y.element)return y;b=Q(b)}}return null},mouseOrPen:function(i){var t,n=i.pointerId,o=i.pointerType,s=i.eventType,u=i.scope;if(o!=="mouse"&&o!=="pen")return null;for(var g=0,y=u.interactions.list;g<y.length;g++){var b=y[g];if(b.pointerType===o){if(b.simulation&&!sn(b,n))continue;if(b.interacting())return b;t||(t=b)}}if(t)return t;for(var E=0,w=u.interactions.list;E<w.length;E++){var C=w[E];if(!(C.pointerType!==o||/down/i.test(s)&&C.simulation))return C}return null},hasPointer:function(i){for(var t=i.pointerId,n=0,o=i.scope.interactions.list;n<o.length;n++){var s=o[n];if(sn(s,t))return s}return null},idle:function(i){for(var t=i.pointerType,n=0,o=i.scope.interactions.list;n<o.length;n++){var s=o[n];if(s.pointers.length===1){var u=s.interactable;if(u&&(!u.options.gesture||!u.options.gesture.enabled))continue}else if(s.pointers.length>=2)continue;if(!s.interacting()&&t===s.pointerType)return s}return null}};function sn(i,t){return i.pointers.some((function(n){return n.id===t}))}var Gr=vi,bi=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function cn(i,t){return function(n){var o=t.interactions.list,s=ke(n),u=Te(n),g=u[0],y=u[1],b=[];if(/^touch/.test(n.type)){t.prevTouchTime=t.now();for(var E=0,w=n.changedTouches;E<w.length;E++){var C=w[E],P={pointer:C,pointerId:et(C),pointerType:s,eventType:n.type,eventTarget:g,curEventTarget:y,scope:t},F=ln(P);b.push([P.pointer,P.eventTarget,P.curEventTarget,F])}}else{var L=!1;if(!V.supportsPointerEvent&&/mouse/.test(n.type)){for(var R=0;R<o.length&&!L;R++)L=o[R].pointerType!=="mouse"&&o[R].pointerIsDown;L=L||t.now()-t.prevTouchTime<500||n.timeStamp===0}if(!L){var G={pointer:n,pointerId:et(n),pointerType:s,eventType:n.type,curEventTarget:y,eventTarget:g,scope:t},X=ln(G);b.push([G.pointer,G.eventTarget,G.curEventTarget,X])}}for(var Z=0;Z<b.length;Z++){var ae=b[Z],de=ae[0],ne=ae[1],se=ae[2];ae[3][i](de,n,ne,se)}}}function ln(i){var t=i.pointerType,n=i.scope,o={interaction:Gr.search(i),searchDetails:i};return n.fire("interactions:find",o),o.interaction||n.interactions.new({pointerType:t})}function xi(i,t){var n=i.doc,o=i.scope,s=i.options,u=o.interactions.docEvents,g=o.events,y=g[t];for(var b in o.browser.isIOS&&!s.events&&(s.events={passive:!1}),g.delegatedEvents)y(n,b,g.delegateListener),y(n,b,g.delegateUseCapture,!0);for(var E=s&&s.events,w=0;w<u.length;w++){var C=u[w];y(n,C.type,C.listener,E)}}var Jr={id:"core/interactions",install:function(i){for(var t={},n=0;n<bi.length;n++){var o=bi[n];t[o]=cn(o,i)}var s,u=V.pEventTypes;function g(){for(var y=0,b=i.interactions.list;y<b.length;y++){var E=b[y];if(E.pointerIsDown&&E.pointerType==="touch"&&!E._interacting)for(var w=function(){var F=P[C];i.documents.some((function(L){return oe(L.doc,F.downTarget)}))||E.removePointer(F.pointer,F.event)},C=0,P=E.pointers;C<P.length;C++)w()}}(s=z.PointerEvent?[{type:u.down,listener:g},{type:u.down,listener:t.pointerDown},{type:u.move,listener:t.pointerMove},{type:u.up,listener:t.pointerUp},{type:u.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:g},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(y){for(var b=0,E=i.interactions.list;b<E.length;b++)E[b].documentBlur(y)}}),i.prevTouchTime=0,i.Interaction=(function(y){h(E,y);var b=v(E);function E(){return a(this,E),b.apply(this,arguments)}return p(E,[{key:"pointerMoveTolerance",get:function(){return i.interactions.pointerMoveTolerance},set:function(w){i.interactions.pointerMoveTolerance=w}},{key:"_now",value:function(){return i.now()}}]),E})(Hr),i.interactions={list:[],new:function(y){y.scopeFire=function(E,w){return i.fire(E,w)};var b=new i.Interaction(y);return i.interactions.list.push(b),b},listeners:t,docEvents:s,pointerMoveTolerance:1},i.usePlugin(Xi)},listeners:{"scope:add-document":function(i){return xi(i,"add")},"scope:remove-document":function(i){return xi(i,"remove")},"interactable:unset":function(i,t){for(var n=i.interactable,o=t.interactions.list.length-1;o>=0;o--){var s=t.interactions.list[o];s.interactable===n&&(s.stop(),t.fire("interactions:destroy",{interaction:s}),s.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(o,1))}}},onDocSignal:xi,doOnInteractions:cn,methodNames:bi},Qr=Jr,lt=(function(i){return i[i.On=0]="On",i[i.Off=1]="Off",i})(lt||{}),Zr=(function(){function i(t,n,o,s){a(this,i),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new an,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=n.actions,this.target=t,this._context=n.context||o,this._win=A(Qe(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=s,this.set(n)}return p(i,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,n){return S.func(n.onstart)&&this.on("".concat(t,"start"),n.onstart),S.func(n.onmove)&&this.on("".concat(t,"move"),n.onmove),S.func(n.onend)&&this.on("".concat(t,"end"),n.onend),S.func(n.oninertiastart)&&this.on("".concat(t,"inertiastart"),n.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,n,o){var s,u=this,g=(s=this._actions.map[t])==null?void 0:s.filterEventType,y=function(b){return(g==null||g(b))&&Jt(b,u._actions)};(S.array(n)||S.object(n))&&this._onOff(lt.Off,t,n,void 0,y),(S.array(o)||S.object(o))&&this._onOff(lt.On,t,o,void 0,y)}},{key:"setPerAction",value:function(t,n){var o=this._defaults;for(var s in n){var u=s,g=this.options[t],y=n[u];u==="listeners"&&this.updatePerActionListeners(t,g.listeners,y),S.array(y)?g[u]=Oe(y):S.plainObject(y)?(g[u]=ee(g[u]||{},Ot(y)),S.object(o.perAction[u])&&"enabled"in o.perAction[u]&&(g[u].enabled=y.enabled!==!1)):S.bool(y)&&S.object(o.perAction[u])?g[u].enabled=y:g[u]=y}}},{key:"getRect",value:function(t){return t=t||(S.element(this.target)?this.target:null),S.string(this.target)&&(t=t||this._context.querySelector(this.target)),We(t)}},{key:"rectChecker",value:function(t){var n=this;return S.func(t)?(this.getRect=function(o){var s=ee({},t.apply(n,o));return"width"in s||(s.width=s.right-s.left,s.height=s.bottom-s.top),s},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,n){if(Qe(n)||S.object(n)){for(var o in this.options[t]=n,this._actions.map)this.options[o][t]=n;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return S.string(t)?Array.from(this._context.querySelectorAll(t)):S.func(t)&&t.getAllElements?t.getAllElements():S.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||oe(this._context,t)}},{key:"testIgnoreAllow",value:function(t,n,o){return!this.testIgnore(t.ignoreFrom,n,o)&&this.testAllow(t.allowFrom,n,o)}},{key:"testAllow",value:function(t,n,o){return!t||!!S.element(o)&&(S.string(t)?De(o,t,n):!!S.element(t)&&oe(t,o))}},{key:"testIgnore",value:function(t,n,o){return!(!t||!S.element(o))&&(S.string(t)?De(o,t,n):!!S.element(t)&&oe(t,o))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,n,o,s,u){S.object(n)&&!S.array(n)&&(s=o,o=null);var g=Ie(n,o,u);for(var y in g){y==="wheel"&&(y=V.wheelEvent);for(var b=0,E=g[y];b<E.length;b++){var w=E[b];Jt(y,this._actions)?this.events[t===lt.On?"on":"off"](y,w):S.string(this.target)?this._scopeEvents[t===lt.On?"addDelegate":"removeDelegate"](this.target,this._context,y,w,s):this._scopeEvents[t===lt.On?"add":"remove"](this.target,y,w,s)}}return this}},{key:"on",value:function(t,n,o){return this._onOff(lt.On,t,n,o)}},{key:"off",value:function(t,n,o){return this._onOff(lt.Off,t,n,o)}},{key:"set",value:function(t){var n=this._defaults;for(var o in S.object(t)||(t={}),this.options=Ot(n.base),this._actions.methodDict){var s=o,u=this._actions.methodDict[s];this.options[s]={},this.setPerAction(s,ee(ee({},n.perAction),n.actions[s])),this[u](t[s])}for(var g in t)g!=="getRect"?S.func(this[g])&&this[g](t[g]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(S.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var n=this._scopeEvents.delegatedEvents[t],o=n.length-1;o>=0;o--){var s=n[o],u=s.selector,g=s.context,y=s.listeners;u===this.target&&g===this._context&&n.splice(o,1);for(var b=y.length-1;b>=0;b--)this._scopeEvents.removeDelegate(this.target,this._context,t,y[b][0],y[b][1])}else this._scopeEvents.remove(this.target,"all")}}]),i})(),eo=(function(){function i(t){var n=this;a(this,i),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(o){var s=o.interactable,u=s.target,g=S.string(u)?n.selectorMap[u]:u[n.scope.id],y=Le(g,(function(b){return b===s}));g.splice(y,1)}})}return p(i,[{key:"new",value:function(t,n){n=ee(n||{},{actions:this.scope.actions});var o=new this.scope.Interactable(t,n,this.scope.document,this.scope.events);return this.scope.addDocument(o._doc),this.list.push(o),S.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(o)):(o.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(o)),this.scope.fire("interactable:new",{target:t,options:n,interactable:o,win:this.scope._win}),o}},{key:"getExisting",value:function(t,n){var o=n&&n.context||this.scope.document,s=S.string(t),u=s?this.selectorMap[t]:t[this.scope.id];if(u)return xe(u,(function(g){return g._context===o&&(s||g.inContext(t))}))}},{key:"forEachMatch",value:function(t,n){for(var o=0,s=this.list;o<s.length;o++){var u=s[o],g=void 0;if((S.string(u.target)?S.element(t)&&le(t,u.target):t===u.target)&&u.inContext(t)&&(g=n(u)),g!==void 0)return g}}}]),i})(),to=(function(){function i(){var t=this;a(this,i),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=V,this.defaults=Ot(Ji),this.Eventable=an,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(o){var s=function u(g,y){var b=o.interactables.getExisting(g,y);return b||((b=o.interactables.new(g,y)).events.global=u.globalEvents),b};return s.getPointerAverage=W,s.getTouchBBox=ue,s.getTouchDistance=he,s.getTouchAngle=me,s.getElementRect=We,s.getElementClientRect=ye,s.matchesSelector=le,s.closest=fe,s.globalEvents={},s.version="1.10.27",s.scope=o,s.use=function(u,g){return this.scope.usePlugin(u,g),this},s.isSet=function(u,g){return!!this.scope.interactables.get(u,g&&g.context)},s.on=Dt((function(u,g,y){if(S.string(u)&&u.search(" ")!==-1&&(u=u.trim().split(/ +/)),S.array(u)){for(var b=0,E=u;b<E.length;b++){var w=E[b];this.on(w,g,y)}return this}if(S.object(u)){for(var C in u)this.on(C,u[C],g);return this}return Jt(u,this.scope.actions)?this.globalEvents[u]?this.globalEvents[u].push(g):this.globalEvents[u]=[g]:this.scope.events.add(this.scope.document,u,g,{options:y}),this}),"The interact.on() method is being deprecated"),s.off=Dt((function(u,g,y){if(S.string(u)&&u.search(" ")!==-1&&(u=u.trim().split(/ +/)),S.array(u)){for(var b=0,E=u;b<E.length;b++){var w=E[b];this.off(w,g,y)}return this}if(S.object(u)){for(var C in u)this.off(C,u[C],g);return this}var P;return Jt(u,this.scope.actions)?u in this.globalEvents&&(P=this.globalEvents[u].indexOf(g))!==-1&&this.globalEvents[u].splice(P,1):this.scope.events.remove(this.scope.document,u,g,y),this}),"The interact.off() method is being deprecated"),s.debug=function(){return this.scope},s.supportsTouch=function(){return V.supportsTouch},s.supportsPointerEvent=function(){return V.supportsPointerEvent},s.stop=function(){for(var u=0,g=this.scope.interactions.list;u<g.length;u++)g[u].stop();return this},s.pointerMoveTolerance=function(u){return S.number(u)?(this.scope.interactions.pointerMoveTolerance=u,this):this.scope.interactions.pointerMoveTolerance},s.addDocument=function(u,g){this.scope.addDocument(u,g)},s.removeDocument=function(u){this.scope.removeDocument(u)},s})(this),this.InteractEvent=mi,this.Interactable=void 0,this.interactables=new eo(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(o){return t.removeDocument(o.target)};var n=this;this.Interactable=(function(o){h(u,o);var s=v(u);function u(){return a(this,u),s.apply(this,arguments)}return p(u,[{key:"_defaults",get:function(){return n.defaults}},{key:"set",value:function(g){return x(m(u.prototype),"set",this).call(this,g),n.fire("interactable:set",{options:g,interactable:this}),this}},{key:"unset",value:function(){x(m(u.prototype),"unset",this).call(this);var g=n.interactables.list.indexOf(this);g<0||(n.interactables.list.splice(g,1),n.fire("interactable:unset",{interactable:this}))}}]),u})(Zr)}return p(i,[{key:"addListeners",value:function(t,n){this.listenerMaps.push({id:n,map:t})}},{key:"fire",value:function(t,n){for(var o=0,s=this.listenerMaps;o<s.length;o++){var u=s[o].map[t];if(u&&u(n,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(n,o){return n.isInitialized=!0,S.window(o)&&I(o),z.init(o),V.init(o),st.init(o),n.window=o,n.document=o.document,n.usePlugin(Qr),n.usePlugin(Xr),n})(this,t)}},{key:"pluginIsInstalled",value:function(t){var n=t.id;return n?!!this._plugins.map[n]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,n){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,n),t.listeners&&t.before){for(var o=0,s=this.listenerMaps.length,u=t.before.reduce((function(y,b){return y[b]=!0,y[dn(b)]=!0,y}),{});o<s;o++){var g=this.listenerMaps[o].id;if(g&&(u[g]||u[dn(g)]))break}this.listenerMaps.splice(o,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,n){if(this.getDocIndex(t)!==-1)return!1;var o=A(t);n=n?ee({},n):{},this.documents.push({doc:t,options:n}),this.events.documents.push(t),t!==this.document&&this.events.add(o,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:o,scope:this,options:n})}},{key:"removeDocument",value:function(t){var n=this.getDocIndex(t),o=A(t),s=this.documents[n].options;this.events.remove(o,"unload",this.onWindowUnload),this.documents.splice(n,1),this.events.documents.splice(n,1),this.fire("scope:remove-document",{doc:t,window:o,scope:this,options:s})}},{key:"getDocIndex",value:function(t){for(var n=0;n<this.documents.length;n++)if(this.documents[n].doc===t)return n;return-1}},{key:"getDocOptions",value:function(t){var n=this.getDocIndex(t);return n===-1?null:this.documents[n].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),i})();function dn(i){return i&&i.replace(/\/.*$/,"")}var un=new to,qe=un.interactStatic,io=typeof globalThis!="undefined"?globalThis:window;un.init(io);var no=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(i){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(o){var s=o[0],u=o[1];return s in i||u in i})),n=function(o,s){for(var u=i.range,g=i.limits,y=g===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:g,b=i.offset,E=b===void 0?{x:0,y:0}:b,w={range:u,grid:i,x:null,y:null},C=0;C<t.length;C++){var P=t[C],F=P[0],L=P[1],R=Math.round((o-E.x)/i[F]),G=Math.round((s-E.y)/i[L]);w[F]=Math.max(y.left,Math.min(y.right,R*i[F]+E.x)),w[L]=Math.max(y.top,Math.min(y.bottom,G*i[L]+E.y))}return w};return n.grid=i,n.coordFields=t,n}}),ro={id:"snappers",install:function(i){var t=i.interactStatic;t.snappers=ee(t.snappers||{},no),t.createSnapGrid=t.snappers.grid}},oo=ro,ao={start:function(i){var t=i.state,n=i.rect,o=i.edges,s=i.pageCoords,u=t.options,g=u.ratio,y=u.enabled,b=t.options,E=b.equalDelta,w=b.modifiers;g==="preserve"&&(g=n.width/n.height),t.startCoords=ee({},s),t.startRect=ee({},n),t.ratio=g,t.equalDelta=E;var C=t.linkedEdges={top:o.top||o.left&&!o.bottom,left:o.left||o.top&&!o.right,bottom:o.bottom||o.right&&!o.top,right:o.right||o.bottom&&!o.left};if(t.xIsPrimaryAxis=!(!o.left&&!o.right),t.equalDelta){var P=(C.left?1:-1)*(C.top?1:-1);t.edgeSign={x:P,y:P}}else t.edgeSign={x:C.left?-1:1,y:C.top?-1:1};if(y!==!1&&ee(o,C),w!=null&&w.length){var F=new gi(i.interaction);F.copyFrom(i.interaction.modification),F.prepareStates(w),t.subModification=F,F.startAll(d({},i))}},set:function(i){var t=i.state,n=i.rect,o=i.coords,s=t.linkedEdges,u=ee({},o),g=t.equalDelta?so:co;if(ee(i.edges,s),g(t,t.xIsPrimaryAxis,o,n),!t.subModification)return null;var y=ee({},n);ge(s,y,{x:o.x-u.x,y:o.y-u.y});var b=t.subModification.setAll(d(d({},i),{},{rect:y,edges:s,pageCoords:o,prevCoords:o,prevRect:y})),E=b.delta;return b.changed&&(g(t,Math.abs(E.x)>Math.abs(E.y),b.coords,b.rect),ee(o,b.coords)),b.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function so(i,t,n){var o=i.startCoords,s=i.edgeSign;t?n.y=o.y+(n.x-o.x)*s.y:n.x=o.x+(n.y-o.y)*s.x}function co(i,t,n,o){var s=i.startRect,u=i.startCoords,g=i.ratio,y=i.edgeSign;if(t){var b=o.width/g;n.y=u.y+(b-s.height)*y.y}else{var E=o.height*g;n.x=u.x+(E-s.width)*y.x}}var lo=ct(ao,"aspectRatio"),pn=function(){};pn._defaults={};var ti=pn;function gt(i,t,n){return S.func(i)?ht(i,t.interactable,t.element,[n.x,n.y,t]):ht(i,t.interactable,t.element)}var ii={start:function(i){var t=i.rect,n=i.startOffset,o=i.state,s=i.interaction,u=i.pageCoords,g=o.options,y=g.elementRect,b=ee({left:0,top:0,right:0,bottom:0},g.offset||{});if(t&&y){var E=gt(g.restriction,s,u);if(E){var w=E.right-E.left-t.width,C=E.bottom-E.top-t.height;w<0&&(b.left+=w,b.right+=w),C<0&&(b.top+=C,b.bottom+=C)}b.left+=n.left-t.width*y.left,b.top+=n.top-t.height*y.top,b.right+=n.right-t.width*(1-y.right),b.bottom+=n.bottom-t.height*(1-y.bottom)}o.offset=b},set:function(i){var t=i.coords,n=i.interaction,o=i.state,s=o.options,u=o.offset,g=gt(s.restriction,n,t);if(g){var y=(function(b){return!b||"left"in b&&"top"in b||((b=ee({},b)).left=b.x||0,b.top=b.y||0,b.right=b.right||b.left+b.width,b.bottom=b.bottom||b.top+b.height),b})(g);t.x=Math.max(Math.min(y.right-u.right,t.x),y.left+u.left),t.y=Math.max(Math.min(y.bottom-u.bottom,t.y),y.top+u.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},uo=ct(ii,"restrict"),hn={top:1/0,left:1/0,bottom:-1/0,right:-1/0},fn={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function gn(i,t){for(var n=0,o=["top","left","bottom","right"];n<o.length;n++){var s=o[n];s in i||(i[s]=t[s])}return i}var Nt={noInner:hn,noOuter:fn,start:function(i){var t,n=i.interaction,o=i.startOffset,s=i.state,u=s.options;u&&(t=ie(gt(u.offset,n,n.coords.start.page))),t=t||{x:0,y:0},s.offset={top:t.y+o.top,left:t.x+o.left,bottom:t.y-o.bottom,right:t.x-o.right}},set:function(i){var t=i.coords,n=i.edges,o=i.interaction,s=i.state,u=s.offset,g=s.options;if(n){var y=ee({},t),b=gt(g.inner,o,y)||{},E=gt(g.outer,o,y)||{};gn(b,hn),gn(E,fn),n.top?t.y=Math.min(Math.max(E.top+u.top,y.y),b.top+u.top):n.bottom&&(t.y=Math.max(Math.min(E.bottom+u.bottom,y.y),b.bottom+u.bottom)),n.left?t.x=Math.min(Math.max(E.left+u.left,y.x),b.left+u.left):n.right&&(t.x=Math.max(Math.min(E.right+u.right,y.x),b.right+u.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},po=ct(Nt,"restrictEdges"),ho=ee({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(i){}},ii.defaults),fo=ct({start:ii.start,set:ii.set,defaults:ho},"restrictRect"),go={width:-1/0,height:-1/0},mo={width:1/0,height:1/0},yo=ct({start:function(i){return Nt.start(i)},set:function(i){var t=i.interaction,n=i.state,o=i.rect,s=i.edges,u=n.options;if(s){var g=Se(gt(u.min,t,i.coords))||go,y=Se(gt(u.max,t,i.coords))||mo;n.options={endOnly:u.endOnly,inner:ee({},Nt.noInner),outer:ee({},Nt.noOuter)},s.top?(n.options.inner.top=o.bottom-g.height,n.options.outer.top=o.bottom-y.height):s.bottom&&(n.options.inner.bottom=o.top+g.height,n.options.outer.bottom=o.top+y.height),s.left?(n.options.inner.left=o.right-g.width,n.options.outer.left=o.right-y.width):s.right&&(n.options.inner.right=o.left+g.width,n.options.outer.right=o.left+y.width),Nt.set(i),n.options=u}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),_i={start:function(i){var t,n=i.interaction,o=i.interactable,s=i.element,u=i.rect,g=i.state,y=i.startOffset,b=g.options,E=b.offsetWithOrigin?(function(P){var F=P.interaction.element,L=ie(ht(P.state.options.origin,null,null,[F])),R=L||ve(P.interactable,F,P.interaction.prepared.name);return R})(i):{x:0,y:0};if(b.offset==="startCoords")t={x:n.coords.start.page.x,y:n.coords.start.page.y};else{var w=ht(b.offset,o,s,[n]);(t=ie(w)||{x:0,y:0}).x+=E.x,t.y+=E.y}var C=b.relativePoints;g.offsets=u&&C&&C.length?C.map((function(P,F){return{index:F,relativePoint:P,x:y.left-u.width*P.x+t.x,y:y.top-u.height*P.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(i){var t=i.interaction,n=i.coords,o=i.state,s=o.options,u=o.offsets,g=ve(t.interactable,t.element,t.prepared.name),y=ee({},n),b=[];s.offsetWithOrigin||(y.x-=g.x,y.y-=g.y);for(var E=0,w=u;E<w.length;E++)for(var C=w[E],P=y.x-C.x,F=y.y-C.y,L=0,R=s.targets.length;L<R;L++){var G=s.targets[L],X=void 0;(X=S.func(G)?G(P,F,t._proxy,C,L):G)&&b.push({x:(S.number(X.x)?X.x:P)+C.x,y:(S.number(X.y)?X.y:F)+C.y,range:S.number(X.range)?X.range:s.range,source:G,index:L,offset:C})}for(var Z={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},ae=0;ae<b.length;ae++){var de=b[ae],ne=de.range,se=de.x-y.x,He=de.y-y.y,we=ot(se,He),Xe=we<=ne;ne===1/0&&Z.inRange&&Z.range!==1/0&&(Xe=!1),Z.target&&!(Xe?Z.inRange&&ne!==1/0?we/ne<Z.distance/Z.range:ne===1/0&&Z.range!==1/0||we<Z.distance:!Z.inRange&&we<Z.distance)||(Z.target=de,Z.distance=we,Z.range=ne,Z.inRange=Xe,Z.delta.x=se,Z.delta.y=He)}return Z.inRange&&(n.x=Z.target.x,n.y=Z.target.y),o.closest=Z,Z},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},vo=ct(_i,"snap"),ni={start:function(i){var t=i.state,n=i.edges,o=t.options;if(!n)return null;i.state={options:{targets:null,relativePoints:[{x:n.left?0:1,y:n.top?0:1}],offset:o.offset||"self",origin:{x:0,y:0},range:o.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],_i.start(i),t.offsets=i.state.offsets,i.state=t},set:function(i){var t=i.interaction,n=i.state,o=i.coords,s=n.options,u=n.offsets,g={x:o.x-u[0].x,y:o.y-u[0].y};n.options=ee({},s),n.options.targets=[];for(var y=0,b=s.targets||[];y<b.length;y++){var E=b[y],w=void 0;if(w=S.func(E)?E(g.x,g.y,t):E){for(var C=0,P=n.targetFields;C<P.length;C++){var F=P[C],L=F[0],R=F[1];if(L in w||R in w){w.x=w[L],w.y=w[R];break}}n.options.targets.push(w)}}var G=_i.set(i);return n.options=s,G},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},bo=ct(ni,"snapSize"),wi={aspectRatio:lo,restrictEdges:po,restrict:uo,restrictRect:fo,restrictSize:yo,snapEdges:ct({start:function(i){var t=i.edges;return t?(i.state.targetFields=i.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],ni.start(i)):null},set:ni.set,defaults:ee(Ot(ni.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:vo,snapSize:bo,spring:ti,avoid:ti,transform:ti,rubberband:ti},xo={id:"modifiers",install:function(i){var t=i.interactStatic;for(var n in i.usePlugin(Gi),i.usePlugin(oo),t.modifiers=wi,wi){var o=wi[n],s=o._defaults,u=o._methods;s._methods=u,i.defaults.perAction[n]=s}}},_o=xo,mn=(function(i){h(n,i);var t=v(n);function n(o,s,u,g,y,b){var E;if(a(this,n),Ne(f(E=t.call(this,y)),u),u!==s&&Ne(f(E),s),E.timeStamp=b,E.originalEvent=u,E.type=o,E.pointerId=et(s),E.pointerType=ke(s),E.target=g,E.currentTarget=null,o==="tap"){var w=y.getPointerIndex(s);E.dt=E.timeStamp-y.pointers[w].downTime;var C=E.timeStamp-y.tapTime;E.double=!!y.prevTap&&y.prevTap.type!=="doubletap"&&y.prevTap.target===E.target&&C<500}else o==="doubletap"&&(E.dt=s.timeStamp-y.tapTime,E.double=!0);return E}return p(n,[{key:"_subtractOrigin",value:function(o){var s=o.x,u=o.y;return this.pageX-=s,this.pageY-=u,this.clientX-=s,this.clientY-=u,this}},{key:"_addOrigin",value:function(o){var s=o.x,u=o.y;return this.pageX+=s,this.pageY+=u,this.clientX+=s,this.clientY+=u,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),n})(J),jt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(i){i.pointerEvents=jt,i.defaults.actions.pointerEvents=jt.defaults,ee(i.actions.phaselessTypes,jt.types)},listeners:{"interactions:new":function(i){var t=i.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(i){var t=i.down,n=i.pointerInfo;!t&&n.hold||(n.hold={duration:1/0,timeout:null})},"interactions:move":function(i,t){var n=i.interaction,o=i.pointer,s=i.event,u=i.eventTarget;i.duplicate||n.pointerIsDown&&!n.pointerWasMoved||(n.pointerIsDown&&ki(i),dt({interaction:n,pointer:o,event:s,eventTarget:u,type:"move"},t))},"interactions:down":function(i,t){(function(n,o){for(var s=n.interaction,u=n.pointer,g=n.event,y=n.eventTarget,b=n.pointerIndex,E=s.pointers[b].hold,w=Be(y),C={interaction:s,pointer:u,event:g,eventTarget:y,type:"hold",targets:[],path:w,node:null},P=0;P<w.length;P++){var F=w[P];C.node=F,o.fire("pointerEvents:collect-targets",C)}if(C.targets.length){for(var L=1/0,R=0,G=C.targets;R<G.length;R++){var X=G[R].eventable.options.holdDuration;X<L&&(L=X)}E.duration=L,E.timeout=setTimeout((function(){dt({interaction:s,eventTarget:y,pointer:u,event:g,type:"hold"},o)}),L)}})(i,t),dt(i,t)},"interactions:up":function(i,t){ki(i),dt(i,t),(function(n,o){var s=n.interaction,u=n.pointer,g=n.event,y=n.eventTarget;s.pointerWasMoved||dt({interaction:s,eventTarget:y,pointer:u,event:g,type:"tap"},o)})(i,t)},"interactions:cancel":function(i,t){ki(i),dt(i,t)}},PointerEvent:mn,fire:dt,collectEventTargets:yn,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function dt(i,t){var n=i.interaction,o=i.pointer,s=i.event,u=i.eventTarget,g=i.type,y=i.targets,b=y===void 0?yn(i,t):y,E=new mn(g,o,s,u,n,t.now());t.fire("pointerEvents:new",{pointerEvent:E});for(var w={interaction:n,pointer:o,event:s,eventTarget:u,targets:b,type:g,pointerEvent:E},C=0;C<b.length;C++){var P=b[C];for(var F in P.props||{})E[F]=P.props[F];var L=ve(P.eventable,P.node);if(E._subtractOrigin(L),E.eventable=P.eventable,E.currentTarget=P.node,P.eventable.fire(E),E._addOrigin(L),E.immediatePropagationStopped||E.propagationStopped&&C+1<b.length&&b[C+1].node!==E.currentTarget)break}if(t.fire("pointerEvents:fired",w),g==="tap"){var R=E.double?dt({interaction:n,pointer:o,event:s,eventTarget:u,type:"doubletap"},t):E;n.prevTap=R,n.tapTime=R.timeStamp}return E}function yn(i,t){var n=i.interaction,o=i.pointer,s=i.event,u=i.eventTarget,g=i.type,y=n.getPointerIndex(o),b=n.pointers[y];if(g==="tap"&&(n.pointerWasMoved||!b||b.downTarget!==u))return[];for(var E=Be(u),w={interaction:n,pointer:o,event:s,eventTarget:u,type:g,path:E,targets:[],node:null},C=0;C<E.length;C++){var P=E[C];w.node=P,t.fire("pointerEvents:collect-targets",w)}return g==="hold"&&(w.targets=w.targets.filter((function(F){var L,R;return F.eventable.options.holdDuration===((L=n.pointers[y])==null||(R=L.hold)==null?void 0:R.duration)}))),w.targets}function ki(i){var t=i.interaction,n=i.pointerIndex,o=t.pointers[n].hold;o&&o.timeout&&(clearTimeout(o.timeout),o.timeout=null)}var wo=Object.freeze({__proto__:null,default:jt});function ko(i){var t=i.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var So={id:"pointer-events/holdRepeat",install:function(i){i.usePlugin(jt);var t=i.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=i.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(i,t){return i["pointerEvents:".concat(t)]=ko,i}),{"pointerEvents:new":function(i){var t=i.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(i,t){var n=i.interaction,o=i.pointerEvent,s=i.eventTarget,u=i.targets;if(o.type==="hold"&&u.length){var g=u[0].eventable.options.holdRepeatInterval;g<=0||(n.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:n,eventTarget:s,type:"hold",pointer:o,event:o},t)}),g))}}})},Eo=So,Co={id:"pointer-events/interactableTargets",install:function(i){var t=i.Interactable;t.prototype.pointerEvents=function(o){return ee(this.events.options,o),this};var n=t.prototype._backCompatOption;t.prototype._backCompatOption=function(o,s){var u=n.call(this,o,s);return u===this&&(this.events.options[o]=s),u}},listeners:{"pointerEvents:collect-targets":function(i,t){var n=i.targets,o=i.node,s=i.type,u=i.eventTarget;t.interactables.forEachMatch(o,(function(g){var y=g.events,b=y.options;y.types[s]&&y.types[s].length&&g.testIgnoreAllow(b,o,u)&&n.push({node:o,eventable:y,props:{interactable:g}})}))},"interactable:new":function(i){var t=i.interactable;t.events.getRect=function(n){return t.getRect(n)}},"interactable:set":function(i,t){var n=i.interactable,o=i.options;ee(n.events.options,t.pointerEvents.defaults),ee(n.events.options,o.pointerEvents||{})}}},Ao=Co,Oo={id:"pointer-events",install:function(i){i.usePlugin(wo),i.usePlugin(Eo),i.usePlugin(Ao)}},To=Oo,Mo={id:"reflow",install:function(i){var t=i.Interactable;i.actions.phases.reflow=!0,t.prototype.reflow=function(n){return(function(o,s,u){for(var g=o.getAllElements(),y=u.window.Promise,b=y?[]:null,E=function(){var C=g[w],P=o.getRect(C);if(!P)return 1;var F,L=xe(u.interactions.list,(function(X){return X.interacting()&&X.interactable===o&&X.element===C&&X.prepared.name===s.name}));if(L)L.move(),b&&(F=L._reflowPromise||new y((function(X){L._reflowResolve=X})));else{var R=Se(P),G=(function(X){return{coords:X,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:R.x,y:R.y},client:{x:R.x,y:R.y},timeStamp:u.now()});F=(function(X,Z,ae,de,ne){var se=X.interactions.new({pointerType:"reflow"}),He={interaction:se,event:ne,pointer:ne,eventTarget:ae,phase:"reflow"};se.interactable=Z,se.element=ae,se.prevEvent=ne,se.updatePointer(ne,ne,ae,!0),Wt(se.coords.delta),ui(se.prepared,de),se._doPhase(He);var we=X.window,Xe=we.Promise,Je=Xe?new Xe((function(nt){se._reflowResolve=nt})):void 0;return se._reflowPromise=Je,se.start(de,Z,ae),se._interacting?(se.move(He),se.end(ne)):(se.stop(),se._reflowResolve()),se.removePointer(ne,ne),Je})(u,o,C,s,G)}b&&b.push(F)},w=0;w<g.length&&!E();w++);return b&&y.all(b).then((function(){return o}))})(this,n,i)}},listeners:{"interactions:stop":function(i,t){var n=i.interaction;n.pointerType==="reflow"&&(n._reflowResolve&&n._reflowResolve(),(function(o,s){o.splice(o.indexOf(s),1)})(t.interactions.list,n))}}},Po=Mo;if(qe.use(Xi),qe.use(tn),qe.use(To),qe.use(Wr),qe.use(_o),qe.use(zr),qe.use(Xt),qe.use(Cr),qe.use(Po),qe.default=qe,(typeof mt=="undefined"?"undefined":r(mt))==="object"&&mt)try{mt.exports=qe}catch{}return qe.default=qe,qe}))});var Sr=jo(bn(),1);function zn(e){return typeof e=="undefined"||e===null}function qo(e){return typeof e=="object"&&e!==null}function Ho(e){return Array.isArray(e)?e:zn(e)?[]:[e]}function Yo(e,d){var r,a,c,p;if(d)for(p=Object.keys(d),r=0,a=p.length;r<a;r+=1)c=p[r],e[c]=d[c];return e}function Ko(e,d){var r="",a;for(a=0;a<d;a+=1)r+=e;return r}function $o(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Uo=zn,Wo=qo,Vo=Ho,Xo=Ko,Go=$o,Jo=Yo,Ae={isNothing:Uo,isObject:Wo,toArray:Vo,repeat:Xo,isNegativeZero:Go,extend:Jo};function Dn(e,d){var r="",a=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!d&&e.mark.snippet&&(r+=`

`+e.mark.snippet),a+" "+r):a}function Yt(e,d){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=d,this.message=Dn(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Yt.prototype=Object.create(Error.prototype);Yt.prototype.constructor=Yt;Yt.prototype.toString=function(d){return this.name+": "+Dn(this,d)};var Ye=Yt;function Ci(e,d,r,a,c){var p="",l="",h=Math.floor(c/2)-1;return a-d>h&&(p=" ... ",d=a-h+p.length),r-a>h&&(l=" ...",r=a+h-l.length),{str:p+e.slice(d,r).replace(/\t/g,"\u2192")+l,pos:a-d+p.length}}function Ai(e,d){return Ae.repeat(" ",d-e.length)+e}function Qo(e,d){if(d=Object.create(d||null),!e.buffer)return null;d.maxLength||(d.maxLength=79),typeof d.indent!="number"&&(d.indent=1),typeof d.linesBefore!="number"&&(d.linesBefore=3),typeof d.linesAfter!="number"&&(d.linesAfter=2);for(var r=/\r?\n|\r|\0/g,a=[0],c=[],p,l=-1;p=r.exec(e.buffer);)c.push(p.index),a.push(p.index+p[0].length),e.position<=p.index&&l<0&&(l=a.length-2);l<0&&(l=a.length-1);var h="",m,_,f=Math.min(e.line+d.linesAfter,c.length).toString().length,v=d.maxLength-(d.indent+f+3);for(m=1;m<=d.linesBefore&&!(l-m<0);m++)_=Ci(e.buffer,a[l-m],c[l-m],e.position-(a[l]-a[l-m]),v),h=Ae.repeat(" ",d.indent)+Ai((e.line-m+1).toString(),f)+" | "+_.str+`
`+h;for(_=Ci(e.buffer,a[l],c[l],e.position,v),h+=Ae.repeat(" ",d.indent)+Ai((e.line+1).toString(),f)+" | "+_.str+`
`,h+=Ae.repeat("-",d.indent+f+3+_.pos)+`^
`,m=1;m<=d.linesAfter&&!(l+m>=c.length);m++)_=Ci(e.buffer,a[l+m],c[l+m],e.position-(a[l]-a[l+m]),v),h+=Ae.repeat(" ",d.indent)+Ai((e.line+m+1).toString(),f)+" | "+_.str+`
`;return h.replace(/\n$/,"")}var Zo=Qo,ea=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],ta=["scalar","sequence","mapping"];function ia(e){var d={};return e!==null&&Object.keys(e).forEach(function(r){e[r].forEach(function(a){d[String(a)]=r})}),d}function na(e,d){if(d=d||{},Object.keys(d).forEach(function(r){if(ea.indexOf(r)===-1)throw new Ye('Unknown option "'+r+'" is met in definition of "'+e+'" YAML type.')}),this.options=d,this.tag=e,this.kind=d.kind||null,this.resolve=d.resolve||function(){return!0},this.construct=d.construct||function(r){return r},this.instanceOf=d.instanceOf||null,this.predicate=d.predicate||null,this.represent=d.represent||null,this.representName=d.representName||null,this.defaultStyle=d.defaultStyle||null,this.multi=d.multi||!1,this.styleAliases=ia(d.styleAliases||null),ta.indexOf(this.kind)===-1)throw new Ye('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var Pe=na;function xn(e,d){var r=[];return e[d].forEach(function(a){var c=r.length;r.forEach(function(p,l){p.tag===a.tag&&p.kind===a.kind&&p.multi===a.multi&&(c=l)}),r[c]=a}),r}function ra(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},d,r;function a(c){c.multi?(e.multi[c.kind].push(c),e.multi.fallback.push(c)):e[c.kind][c.tag]=e.fallback[c.tag]=c}for(d=0,r=arguments.length;d<r;d+=1)arguments[d].forEach(a);return e}function Ti(e){return this.extend(e)}Ti.prototype.extend=function(d){var r=[],a=[];if(d instanceof Pe)a.push(d);else if(Array.isArray(d))a=a.concat(d);else if(d&&(Array.isArray(d.implicit)||Array.isArray(d.explicit)))d.implicit&&(r=r.concat(d.implicit)),d.explicit&&(a=a.concat(d.explicit));else throw new Ye("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(p){if(!(p instanceof Pe))throw new Ye("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(p.loadKind&&p.loadKind!=="scalar")throw new Ye("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(p.multi)throw new Ye("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),a.forEach(function(p){if(!(p instanceof Pe))throw new Ye("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var c=Object.create(Ti.prototype);return c.implicit=(this.implicit||[]).concat(r),c.explicit=(this.explicit||[]).concat(a),c.compiledImplicit=xn(c,"implicit"),c.compiledExplicit=xn(c,"explicit"),c.compiledTypeMap=ra(c.compiledImplicit,c.compiledExplicit),c};var Rn=Ti,Bn=new Pe("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Nn=new Pe("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),jn=new Pe("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),qn=new Rn({explicit:[Bn,Nn,jn]});function oa(e){if(e===null)return!0;var d=e.length;return d===1&&e==="~"||d===4&&(e==="null"||e==="Null"||e==="NULL")}function aa(){return null}function sa(e){return e===null}var Hn=new Pe("tag:yaml.org,2002:null",{kind:"scalar",resolve:oa,construct:aa,predicate:sa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function ca(e){if(e===null)return!1;var d=e.length;return d===4&&(e==="true"||e==="True"||e==="TRUE")||d===5&&(e==="false"||e==="False"||e==="FALSE")}function la(e){return e==="true"||e==="True"||e==="TRUE"}function da(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Yn=new Pe("tag:yaml.org,2002:bool",{kind:"scalar",resolve:ca,construct:la,predicate:da,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ua(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function pa(e){return 48<=e&&e<=55}function ha(e){return 48<=e&&e<=57}function fa(e){if(e===null)return!1;var d=e.length,r=0,a=!1,c;if(!d)return!1;if(c=e[r],(c==="-"||c==="+")&&(c=e[++r]),c==="0"){if(r+1===d)return!0;if(c=e[++r],c==="b"){for(r++;r<d;r++)if(c=e[r],c!=="_"){if(c!=="0"&&c!=="1")return!1;a=!0}return a&&c!=="_"}if(c==="x"){for(r++;r<d;r++)if(c=e[r],c!=="_"){if(!ua(e.charCodeAt(r)))return!1;a=!0}return a&&c!=="_"}if(c==="o"){for(r++;r<d;r++)if(c=e[r],c!=="_"){if(!pa(e.charCodeAt(r)))return!1;a=!0}return a&&c!=="_"}}if(c==="_")return!1;for(;r<d;r++)if(c=e[r],c!=="_"){if(!ha(e.charCodeAt(r)))return!1;a=!0}return!(!a||c==="_")}function ga(e){var d=e,r=1,a;if(d.indexOf("_")!==-1&&(d=d.replace(/_/g,"")),a=d[0],(a==="-"||a==="+")&&(a==="-"&&(r=-1),d=d.slice(1),a=d[0]),d==="0")return 0;if(a==="0"){if(d[1]==="b")return r*parseInt(d.slice(2),2);if(d[1]==="x")return r*parseInt(d.slice(2),16);if(d[1]==="o")return r*parseInt(d.slice(2),8)}return r*parseInt(d,10)}function ma(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!Ae.isNegativeZero(e)}var Kn=new Pe("tag:yaml.org,2002:int",{kind:"scalar",resolve:fa,construct:ga,predicate:ma,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ya=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function va(e){return!(e===null||!ya.test(e)||e[e.length-1]==="_")}function ba(e){var d,r;return d=e.replace(/_/g,"").toLowerCase(),r=d[0]==="-"?-1:1,"+-".indexOf(d[0])>=0&&(d=d.slice(1)),d===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:d===".nan"?NaN:r*parseFloat(d,10)}var xa=/^[-+]?[0-9]+e/;function _a(e,d){var r;if(isNaN(e))switch(d){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(d){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(d){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Ae.isNegativeZero(e))return"-0.0";return r=e.toString(10),xa.test(r)?r.replace("e",".e"):r}function wa(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||Ae.isNegativeZero(e))}var $n=new Pe("tag:yaml.org,2002:float",{kind:"scalar",resolve:va,construct:ba,predicate:wa,represent:_a,defaultStyle:"lowercase"}),Un=qn.extend({implicit:[Hn,Yn,Kn,$n]}),Wn=Un,Vn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Xn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function ka(e){return e===null?!1:Vn.exec(e)!==null||Xn.exec(e)!==null}function Sa(e){var d,r,a,c,p,l,h,m=0,_=null,f,v,x;if(d=Vn.exec(e),d===null&&(d=Xn.exec(e)),d===null)throw new Error("Date resolve error");if(r=+d[1],a=+d[2]-1,c=+d[3],!d[4])return new Date(Date.UTC(r,a,c));if(p=+d[4],l=+d[5],h=+d[6],d[7]){for(m=d[7].slice(0,3);m.length<3;)m+="0";m=+m}return d[9]&&(f=+d[10],v=+(d[11]||0),_=(f*60+v)*6e4,d[9]==="-"&&(_=-_)),x=new Date(Date.UTC(r,a,c,p,l,h,m)),_&&x.setTime(x.getTime()-_),x}function Ea(e){return e.toISOString()}var Gn=new Pe("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:ka,construct:Sa,instanceOf:Date,represent:Ea});function Ca(e){return e==="<<"||e===null}var Jn=new Pe("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Ca}),Fi=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Aa(e){if(e===null)return!1;var d,r,a=0,c=e.length,p=Fi;for(r=0;r<c;r++)if(d=p.indexOf(e.charAt(r)),!(d>64)){if(d<0)return!1;a+=6}return a%8===0}function Oa(e){var d,r,a=e.replace(/[\r\n=]/g,""),c=a.length,p=Fi,l=0,h=[];for(d=0;d<c;d++)d%4===0&&d&&(h.push(l>>16&255),h.push(l>>8&255),h.push(l&255)),l=l<<6|p.indexOf(a.charAt(d));return r=c%4*6,r===0?(h.push(l>>16&255),h.push(l>>8&255),h.push(l&255)):r===18?(h.push(l>>10&255),h.push(l>>2&255)):r===12&&h.push(l>>4&255),new Uint8Array(h)}function Ta(e){var d="",r=0,a,c,p=e.length,l=Fi;for(a=0;a<p;a++)a%3===0&&a&&(d+=l[r>>18&63],d+=l[r>>12&63],d+=l[r>>6&63],d+=l[r&63]),r=(r<<8)+e[a];return c=p%3,c===0?(d+=l[r>>18&63],d+=l[r>>12&63],d+=l[r>>6&63],d+=l[r&63]):c===2?(d+=l[r>>10&63],d+=l[r>>4&63],d+=l[r<<2&63],d+=l[64]):c===1&&(d+=l[r>>2&63],d+=l[r<<4&63],d+=l[64],d+=l[64]),d}function Ma(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Qn=new Pe("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Aa,construct:Oa,predicate:Ma,represent:Ta}),Pa=Object.prototype.hasOwnProperty,Ia=Object.prototype.toString;function La(e){if(e===null)return!0;var d=[],r,a,c,p,l,h=e;for(r=0,a=h.length;r<a;r+=1){if(c=h[r],l=!1,Ia.call(c)!=="[object Object]")return!1;for(p in c)if(Pa.call(c,p))if(!l)l=!0;else return!1;if(!l)return!1;if(d.indexOf(p)===-1)d.push(p);else return!1}return!0}function Fa(e){return e!==null?e:[]}var Zn=new Pe("tag:yaml.org,2002:omap",{kind:"sequence",resolve:La,construct:Fa}),za=Object.prototype.toString;function Da(e){if(e===null)return!0;var d,r,a,c,p,l=e;for(p=new Array(l.length),d=0,r=l.length;d<r;d+=1){if(a=l[d],za.call(a)!=="[object Object]"||(c=Object.keys(a),c.length!==1))return!1;p[d]=[c[0],a[c[0]]]}return!0}function Ra(e){if(e===null)return[];var d,r,a,c,p,l=e;for(p=new Array(l.length),d=0,r=l.length;d<r;d+=1)a=l[d],c=Object.keys(a),p[d]=[c[0],a[c[0]]];return p}var er=new Pe("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Da,construct:Ra}),Ba=Object.prototype.hasOwnProperty;function Na(e){if(e===null)return!0;var d,r=e;for(d in r)if(Ba.call(r,d)&&r[d]!==null)return!1;return!0}function ja(e){return e!==null?e:{}}var tr=new Pe("tag:yaml.org,2002:set",{kind:"mapping",resolve:Na,construct:ja}),zi=Wn.extend({implicit:[Gn,Jn],explicit:[Qn,Zn,er,tr]}),pt=Object.prototype.hasOwnProperty,oi=1,ir=2,nr=3,ai=4,Oi=1,qa=2,_n=3,Ha=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ya=/[\x85\u2028\u2029]/,Ka=/[,\[\]\{\}]/,rr=/^(?:!|!!|![a-z\-]+!)$/i,or=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function wn(e){return Object.prototype.toString.call(e)}function Ze(e){return e===10||e===13}function vt(e){return e===9||e===32}function Ue(e){return e===9||e===32||e===10||e===13}function Mt(e){return e===44||e===91||e===93||e===123||e===125}function $a(e){var d;return 48<=e&&e<=57?e-48:(d=e|32,97<=d&&d<=102?d-97+10:-1)}function Ua(e){return e===120?2:e===117?4:e===85?8:0}function Wa(e){return 48<=e&&e<=57?e-48:-1}function kn(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Va(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var ar=new Array(256),sr=new Array(256);for(yt=0;yt<256;yt++)ar[yt]=kn(yt)?1:0,sr[yt]=kn(yt);var yt;function Xa(e,d){this.input=e,this.filename=d.filename||null,this.schema=d.schema||zi,this.onWarning=d.onWarning||null,this.legacy=d.legacy||!1,this.json=d.json||!1,this.listener=d.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function cr(e,d){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=Zo(r),new Ye(d,r)}function te(e,d){throw cr(e,d)}function si(e,d){e.onWarning&&e.onWarning.call(null,cr(e,d))}var Sn={YAML:function(d,r,a){var c,p,l;d.version!==null&&te(d,"duplication of %YAML directive"),a.length!==1&&te(d,"YAML directive accepts exactly one argument"),c=/^([0-9]+)\.([0-9]+)$/.exec(a[0]),c===null&&te(d,"ill-formed argument of the YAML directive"),p=parseInt(c[1],10),l=parseInt(c[2],10),p!==1&&te(d,"unacceptable YAML version of the document"),d.version=a[0],d.checkLineBreaks=l<2,l!==1&&l!==2&&si(d,"unsupported YAML version of the document")},TAG:function(d,r,a){var c,p;a.length!==2&&te(d,"TAG directive accepts exactly two arguments"),c=a[0],p=a[1],rr.test(c)||te(d,"ill-formed tag handle (first argument) of the TAG directive"),pt.call(d.tagMap,c)&&te(d,'there is a previously declared suffix for "'+c+'" tag handle'),or.test(p)||te(d,"ill-formed tag prefix (second argument) of the TAG directive");try{p=decodeURIComponent(p)}catch{te(d,"tag prefix is malformed: "+p)}d.tagMap[c]=p}};function ut(e,d,r,a){var c,p,l,h;if(d<r){if(h=e.input.slice(d,r),a)for(c=0,p=h.length;c<p;c+=1)l=h.charCodeAt(c),l===9||32<=l&&l<=1114111||te(e,"expected valid JSON character");else Ha.test(h)&&te(e,"the stream contains non-printable characters");e.result+=h}}function En(e,d,r,a){var c,p,l,h;for(Ae.isObject(r)||te(e,"cannot merge mappings; the provided source object is unacceptable"),c=Object.keys(r),l=0,h=c.length;l<h;l+=1)p=c[l],pt.call(d,p)||(d[p]=r[p],a[p]=!0)}function Pt(e,d,r,a,c,p,l,h,m){var _,f;if(Array.isArray(c))for(c=Array.prototype.slice.call(c),_=0,f=c.length;_<f;_+=1)Array.isArray(c[_])&&te(e,"nested arrays are not supported inside keys"),typeof c=="object"&&wn(c[_])==="[object Object]"&&(c[_]="[object Object]");if(typeof c=="object"&&wn(c)==="[object Object]"&&(c="[object Object]"),c=String(c),d===null&&(d={}),a==="tag:yaml.org,2002:merge")if(Array.isArray(p))for(_=0,f=p.length;_<f;_+=1)En(e,d,p[_],r);else En(e,d,p,r);else!e.json&&!pt.call(r,c)&&pt.call(d,c)&&(e.line=l||e.line,e.lineStart=h||e.lineStart,e.position=m||e.position,te(e,"duplicated mapping key")),c==="__proto__"?Object.defineProperty(d,c,{configurable:!0,enumerable:!0,writable:!0,value:p}):d[c]=p,delete r[c];return d}function Di(e){var d;d=e.input.charCodeAt(e.position),d===10?e.position++:d===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):te(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function Ce(e,d,r){for(var a=0,c=e.input.charCodeAt(e.position);c!==0;){for(;vt(c);)c===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),c=e.input.charCodeAt(++e.position);if(d&&c===35)do c=e.input.charCodeAt(++e.position);while(c!==10&&c!==13&&c!==0);if(Ze(c))for(Di(e),c=e.input.charCodeAt(e.position),a++,e.lineIndent=0;c===32;)e.lineIndent++,c=e.input.charCodeAt(++e.position);else break}return r!==-1&&a!==0&&e.lineIndent<r&&si(e,"deficient indentation"),a}function di(e){var d=e.position,r;return r=e.input.charCodeAt(d),!!((r===45||r===46)&&r===e.input.charCodeAt(d+1)&&r===e.input.charCodeAt(d+2)&&(d+=3,r=e.input.charCodeAt(d),r===0||Ue(r)))}function Ri(e,d){d===1?e.result+=" ":d>1&&(e.result+=Ae.repeat(`
`,d-1))}function Ga(e,d,r){var a,c,p,l,h,m,_,f,v=e.kind,x=e.result,k;if(k=e.input.charCodeAt(e.position),Ue(k)||Mt(k)||k===35||k===38||k===42||k===33||k===124||k===62||k===39||k===34||k===37||k===64||k===96||(k===63||k===45)&&(c=e.input.charCodeAt(e.position+1),Ue(c)||r&&Mt(c)))return!1;for(e.kind="scalar",e.result="",p=l=e.position,h=!1;k!==0;){if(k===58){if(c=e.input.charCodeAt(e.position+1),Ue(c)||r&&Mt(c))break}else if(k===35){if(a=e.input.charCodeAt(e.position-1),Ue(a))break}else{if(e.position===e.lineStart&&di(e)||r&&Mt(k))break;if(Ze(k))if(m=e.line,_=e.lineStart,f=e.lineIndent,Ce(e,!1,-1),e.lineIndent>=d){h=!0,k=e.input.charCodeAt(e.position);continue}else{e.position=l,e.line=m,e.lineStart=_,e.lineIndent=f;break}}h&&(ut(e,p,l,!1),Ri(e,e.line-m),p=l=e.position,h=!1),vt(k)||(l=e.position+1),k=e.input.charCodeAt(++e.position)}return ut(e,p,l,!1),e.result?!0:(e.kind=v,e.result=x,!1)}function Ja(e,d){var r,a,c;if(r=e.input.charCodeAt(e.position),r!==39)return!1;for(e.kind="scalar",e.result="",e.position++,a=c=e.position;(r=e.input.charCodeAt(e.position))!==0;)if(r===39)if(ut(e,a,e.position,!0),r=e.input.charCodeAt(++e.position),r===39)a=e.position,e.position++,c=e.position;else return!0;else Ze(r)?(ut(e,a,c,!0),Ri(e,Ce(e,!1,d)),a=c=e.position):e.position===e.lineStart&&di(e)?te(e,"unexpected end of the document within a single quoted scalar"):(e.position++,c=e.position);te(e,"unexpected end of the stream within a single quoted scalar")}function Qa(e,d){var r,a,c,p,l,h;if(h=e.input.charCodeAt(e.position),h!==34)return!1;for(e.kind="scalar",e.result="",e.position++,r=a=e.position;(h=e.input.charCodeAt(e.position))!==0;){if(h===34)return ut(e,r,e.position,!0),e.position++,!0;if(h===92){if(ut(e,r,e.position,!0),h=e.input.charCodeAt(++e.position),Ze(h))Ce(e,!1,d);else if(h<256&&ar[h])e.result+=sr[h],e.position++;else if((l=Ua(h))>0){for(c=l,p=0;c>0;c--)h=e.input.charCodeAt(++e.position),(l=$a(h))>=0?p=(p<<4)+l:te(e,"expected hexadecimal character");e.result+=Va(p),e.position++}else te(e,"unknown escape sequence");r=a=e.position}else Ze(h)?(ut(e,r,a,!0),Ri(e,Ce(e,!1,d)),r=a=e.position):e.position===e.lineStart&&di(e)?te(e,"unexpected end of the document within a double quoted scalar"):(e.position++,a=e.position)}te(e,"unexpected end of the stream within a double quoted scalar")}function Za(e,d){var r=!0,a,c,p,l=e.tag,h,m=e.anchor,_,f,v,x,k,O=Object.create(null),T,M,I,A;if(A=e.input.charCodeAt(e.position),A===91)f=93,k=!1,h=[];else if(A===123)f=125,k=!0,h={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=h),A=e.input.charCodeAt(++e.position);A!==0;){if(Ce(e,!0,d),A=e.input.charCodeAt(e.position),A===f)return e.position++,e.tag=l,e.anchor=m,e.kind=k?"mapping":"sequence",e.result=h,!0;r?A===44&&te(e,"expected the node content, but found ','"):te(e,"missed comma between flow collection entries"),M=T=I=null,v=x=!1,A===63&&(_=e.input.charCodeAt(e.position+1),Ue(_)&&(v=x=!0,e.position++,Ce(e,!0,d))),a=e.line,c=e.lineStart,p=e.position,It(e,d,oi,!1,!0),M=e.tag,T=e.result,Ce(e,!0,d),A=e.input.charCodeAt(e.position),(x||e.line===a)&&A===58&&(v=!0,A=e.input.charCodeAt(++e.position),Ce(e,!0,d),It(e,d,oi,!1,!0),I=e.result),k?Pt(e,h,O,M,T,I,a,c,p):v?h.push(Pt(e,null,O,M,T,I,a,c,p)):h.push(T),Ce(e,!0,d),A=e.input.charCodeAt(e.position),A===44?(r=!0,A=e.input.charCodeAt(++e.position)):r=!1}te(e,"unexpected end of the stream within a flow collection")}function es(e,d){var r,a,c=Oi,p=!1,l=!1,h=d,m=0,_=!1,f,v;if(v=e.input.charCodeAt(e.position),v===124)a=!1;else if(v===62)a=!0;else return!1;for(e.kind="scalar",e.result="";v!==0;)if(v=e.input.charCodeAt(++e.position),v===43||v===45)Oi===c?c=v===43?_n:qa:te(e,"repeat of a chomping mode identifier");else if((f=Wa(v))>=0)f===0?te(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?te(e,"repeat of an indentation width identifier"):(h=d+f-1,l=!0);else break;if(vt(v)){do v=e.input.charCodeAt(++e.position);while(vt(v));if(v===35)do v=e.input.charCodeAt(++e.position);while(!Ze(v)&&v!==0)}for(;v!==0;){for(Di(e),e.lineIndent=0,v=e.input.charCodeAt(e.position);(!l||e.lineIndent<h)&&v===32;)e.lineIndent++,v=e.input.charCodeAt(++e.position);if(!l&&e.lineIndent>h&&(h=e.lineIndent),Ze(v)){m++;continue}if(e.lineIndent<h){c===_n?e.result+=Ae.repeat(`
`,p?1+m:m):c===Oi&&p&&(e.result+=`
`);break}for(a?vt(v)?(_=!0,e.result+=Ae.repeat(`
`,p?1+m:m)):_?(_=!1,e.result+=Ae.repeat(`
`,m+1)):m===0?p&&(e.result+=" "):e.result+=Ae.repeat(`
`,m):e.result+=Ae.repeat(`
`,p?1+m:m),p=!0,l=!0,m=0,r=e.position;!Ze(v)&&v!==0;)v=e.input.charCodeAt(++e.position);ut(e,r,e.position,!1)}return!0}function Cn(e,d){var r,a=e.tag,c=e.anchor,p=[],l,h=!1,m;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=p),m=e.input.charCodeAt(e.position);m!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,te(e,"tab characters must not be used in indentation")),!(m!==45||(l=e.input.charCodeAt(e.position+1),!Ue(l))));){if(h=!0,e.position++,Ce(e,!0,-1)&&e.lineIndent<=d){p.push(null),m=e.input.charCodeAt(e.position);continue}if(r=e.line,It(e,d,nr,!1,!0),p.push(e.result),Ce(e,!0,-1),m=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>d)&&m!==0)te(e,"bad indentation of a sequence entry");else if(e.lineIndent<d)break}return h?(e.tag=a,e.anchor=c,e.kind="sequence",e.result=p,!0):!1}function ts(e,d,r){var a,c,p,l,h,m,_=e.tag,f=e.anchor,v={},x=Object.create(null),k=null,O=null,T=null,M=!1,I=!1,A;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=v),A=e.input.charCodeAt(e.position);A!==0;){if(!M&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,te(e,"tab characters must not be used in indentation")),a=e.input.charCodeAt(e.position+1),p=e.line,(A===63||A===58)&&Ue(a))A===63?(M&&(Pt(e,v,x,k,O,null,l,h,m),k=O=T=null),I=!0,M=!0,c=!0):M?(M=!1,c=!0):te(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,A=a;else{if(l=e.line,h=e.lineStart,m=e.position,!It(e,r,ir,!1,!0))break;if(e.line===p){for(A=e.input.charCodeAt(e.position);vt(A);)A=e.input.charCodeAt(++e.position);if(A===58)A=e.input.charCodeAt(++e.position),Ue(A)||te(e,"a whitespace character is expected after the key-value separator within a block mapping"),M&&(Pt(e,v,x,k,O,null,l,h,m),k=O=T=null),I=!0,M=!1,c=!1,k=e.tag,O=e.result;else if(I)te(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=_,e.anchor=f,!0}else if(I)te(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=_,e.anchor=f,!0}if((e.line===p||e.lineIndent>d)&&(M&&(l=e.line,h=e.lineStart,m=e.position),It(e,d,ai,!0,c)&&(M?O=e.result:T=e.result),M||(Pt(e,v,x,k,O,T,l,h,m),k=O=T=null),Ce(e,!0,-1),A=e.input.charCodeAt(e.position)),(e.line===p||e.lineIndent>d)&&A!==0)te(e,"bad indentation of a mapping entry");else if(e.lineIndent<d)break}return M&&Pt(e,v,x,k,O,null,l,h,m),I&&(e.tag=_,e.anchor=f,e.kind="mapping",e.result=v),I}function is(e){var d,r=!1,a=!1,c,p,l;if(l=e.input.charCodeAt(e.position),l!==33)return!1;if(e.tag!==null&&te(e,"duplication of a tag property"),l=e.input.charCodeAt(++e.position),l===60?(r=!0,l=e.input.charCodeAt(++e.position)):l===33?(a=!0,c="!!",l=e.input.charCodeAt(++e.position)):c="!",d=e.position,r){do l=e.input.charCodeAt(++e.position);while(l!==0&&l!==62);e.position<e.length?(p=e.input.slice(d,e.position),l=e.input.charCodeAt(++e.position)):te(e,"unexpected end of the stream within a verbatim tag")}else{for(;l!==0&&!Ue(l);)l===33&&(a?te(e,"tag suffix cannot contain exclamation marks"):(c=e.input.slice(d-1,e.position+1),rr.test(c)||te(e,"named tag handle cannot contain such characters"),a=!0,d=e.position+1)),l=e.input.charCodeAt(++e.position);p=e.input.slice(d,e.position),Ka.test(p)&&te(e,"tag suffix cannot contain flow indicator characters")}p&&!or.test(p)&&te(e,"tag name cannot contain such characters: "+p);try{p=decodeURIComponent(p)}catch{te(e,"tag name is malformed: "+p)}return r?e.tag=p:pt.call(e.tagMap,c)?e.tag=e.tagMap[c]+p:c==="!"?e.tag="!"+p:c==="!!"?e.tag="tag:yaml.org,2002:"+p:te(e,'undeclared tag handle "'+c+'"'),!0}function ns(e){var d,r;if(r=e.input.charCodeAt(e.position),r!==38)return!1;for(e.anchor!==null&&te(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),d=e.position;r!==0&&!Ue(r)&&!Mt(r);)r=e.input.charCodeAt(++e.position);return e.position===d&&te(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(d,e.position),!0}function rs(e){var d,r,a;if(a=e.input.charCodeAt(e.position),a!==42)return!1;for(a=e.input.charCodeAt(++e.position),d=e.position;a!==0&&!Ue(a)&&!Mt(a);)a=e.input.charCodeAt(++e.position);return e.position===d&&te(e,"name of an alias node must contain at least one character"),r=e.input.slice(d,e.position),pt.call(e.anchorMap,r)||te(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],Ce(e,!0,-1),!0}function It(e,d,r,a,c){var p,l,h,m=1,_=!1,f=!1,v,x,k,O,T,M;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,p=l=h=ai===r||nr===r,a&&Ce(e,!0,-1)&&(_=!0,e.lineIndent>d?m=1:e.lineIndent===d?m=0:e.lineIndent<d&&(m=-1)),m===1)for(;is(e)||ns(e);)Ce(e,!0,-1)?(_=!0,h=p,e.lineIndent>d?m=1:e.lineIndent===d?m=0:e.lineIndent<d&&(m=-1)):h=!1;if(h&&(h=_||c),(m===1||ai===r)&&(oi===r||ir===r?T=d:T=d+1,M=e.position-e.lineStart,m===1?h&&(Cn(e,M)||ts(e,M,T))||Za(e,T)?f=!0:(l&&es(e,T)||Ja(e,T)||Qa(e,T)?f=!0:rs(e)?(f=!0,(e.tag!==null||e.anchor!==null)&&te(e,"alias node should not have any properties")):Ga(e,T,oi===r)&&(f=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m===0&&(f=h&&Cn(e,M))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&te(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),v=0,x=e.implicitTypes.length;v<x;v+=1)if(O=e.implicitTypes[v],O.resolve(e.result)){e.result=O.construct(e.result),e.tag=O.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(pt.call(e.typeMap[e.kind||"fallback"],e.tag))O=e.typeMap[e.kind||"fallback"][e.tag];else for(O=null,k=e.typeMap.multi[e.kind||"fallback"],v=0,x=k.length;v<x;v+=1)if(e.tag.slice(0,k[v].tag.length)===k[v].tag){O=k[v];break}O||te(e,"unknown tag !<"+e.tag+">"),e.result!==null&&O.kind!==e.kind&&te(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+O.kind+'", not "'+e.kind+'"'),O.resolve(e.result,e.tag)?(e.result=O.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):te(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||f}function os(e){var d=e.position,r,a,c,p=!1,l;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(l=e.input.charCodeAt(e.position))!==0&&(Ce(e,!0,-1),l=e.input.charCodeAt(e.position),!(e.lineIndent>0||l!==37));){for(p=!0,l=e.input.charCodeAt(++e.position),r=e.position;l!==0&&!Ue(l);)l=e.input.charCodeAt(++e.position);for(a=e.input.slice(r,e.position),c=[],a.length<1&&te(e,"directive name must not be less than one character in length");l!==0;){for(;vt(l);)l=e.input.charCodeAt(++e.position);if(l===35){do l=e.input.charCodeAt(++e.position);while(l!==0&&!Ze(l));break}if(Ze(l))break;for(r=e.position;l!==0&&!Ue(l);)l=e.input.charCodeAt(++e.position);c.push(e.input.slice(r,e.position))}l!==0&&Di(e),pt.call(Sn,a)?Sn[a](e,a,c):si(e,'unknown document directive "'+a+'"')}if(Ce(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,Ce(e,!0,-1)):p&&te(e,"directives end mark is expected"),It(e,e.lineIndent-1,ai,!1,!0),Ce(e,!0,-1),e.checkLineBreaks&&Ya.test(e.input.slice(d,e.position))&&si(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&di(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,Ce(e,!0,-1));return}if(e.position<e.length-1)te(e,"end of the stream or a document separator is expected");else return}function lr(e,d){e=String(e),d=d||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var r=new Xa(e,d),a=e.indexOf("\0");for(a!==-1&&(r.position=a,te(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)os(r);return r.documents}function as(e,d,r){d!==null&&typeof d=="object"&&typeof r=="undefined"&&(r=d,d=null);var a=lr(e,r);if(typeof d!="function")return a;for(var c=0,p=a.length;c<p;c+=1)d(a[c])}function ss(e,d){var r=lr(e,d);if(r.length!==0){if(r.length===1)return r[0];throw new Ye("expected a single document in the stream, but found more")}}var cs=as,ls=ss,dr={loadAll:cs,load:ls},ur=Object.prototype.toString,pr=Object.prototype.hasOwnProperty,Bi=65279,ds=9,Kt=10,us=13,ps=32,hs=33,fs=34,Mi=35,gs=37,ms=38,ys=39,vs=42,hr=44,bs=45,ci=58,xs=61,_s=62,ws=63,ks=64,fr=91,gr=93,Ss=96,mr=123,Es=124,yr=125,ze={};ze[0]="\\0";ze[7]="\\a";ze[8]="\\b";ze[9]="\\t";ze[10]="\\n";ze[11]="\\v";ze[12]="\\f";ze[13]="\\r";ze[27]="\\e";ze[34]='\\"';ze[92]="\\\\";ze[133]="\\N";ze[160]="\\_";ze[8232]="\\L";ze[8233]="\\P";var Cs=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],As=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Os(e,d){var r,a,c,p,l,h,m;if(d===null)return{};for(r={},a=Object.keys(d),c=0,p=a.length;c<p;c+=1)l=a[c],h=String(d[l]),l.slice(0,2)==="!!"&&(l="tag:yaml.org,2002:"+l.slice(2)),m=e.compiledTypeMap.fallback[l],m&&pr.call(m.styleAliases,h)&&(h=m.styleAliases[h]),r[l]=h;return r}function Ts(e){var d,r,a;if(d=e.toString(16).toUpperCase(),e<=255)r="x",a=2;else if(e<=65535)r="u",a=4;else if(e<=4294967295)r="U",a=8;else throw new Ye("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+r+Ae.repeat("0",a-d.length)+d}var Ms=1,$t=2;function Ps(e){this.schema=e.schema||zi,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=Ae.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Os(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?$t:Ms,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function An(e,d){for(var r=Ae.repeat(" ",d),a=0,c=-1,p="",l,h=e.length;a<h;)c=e.indexOf(`
`,a),c===-1?(l=e.slice(a),a=h):(l=e.slice(a,c+1),a=c+1),l.length&&l!==`
`&&(p+=r),p+=l;return p}function Pi(e,d){return`
`+Ae.repeat(" ",e.indent*d)}function Is(e,d){var r,a,c;for(r=0,a=e.implicitTypes.length;r<a;r+=1)if(c=e.implicitTypes[r],c.resolve(d))return!0;return!1}function li(e){return e===ps||e===ds}function Ut(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Bi||65536<=e&&e<=1114111}function On(e){return Ut(e)&&e!==Bi&&e!==us&&e!==Kt}function Tn(e,d,r){var a=On(e),c=a&&!li(e);return(r?a:a&&e!==hr&&e!==fr&&e!==gr&&e!==mr&&e!==yr)&&e!==Mi&&!(d===ci&&!c)||On(d)&&!li(d)&&e===Mi||d===ci&&c}function Ls(e){return Ut(e)&&e!==Bi&&!li(e)&&e!==bs&&e!==ws&&e!==ci&&e!==hr&&e!==fr&&e!==gr&&e!==mr&&e!==yr&&e!==Mi&&e!==ms&&e!==vs&&e!==hs&&e!==Es&&e!==xs&&e!==_s&&e!==ys&&e!==fs&&e!==gs&&e!==ks&&e!==Ss}function Fs(e){return!li(e)&&e!==ci}function Ht(e,d){var r=e.charCodeAt(d),a;return r>=55296&&r<=56319&&d+1<e.length&&(a=e.charCodeAt(d+1),a>=56320&&a<=57343)?(r-55296)*1024+a-56320+65536:r}function vr(e){var d=/^\n* /;return d.test(e)}var br=1,Ii=2,xr=3,_r=4,Tt=5;function zs(e,d,r,a,c,p,l,h){var m,_=0,f=null,v=!1,x=!1,k=a!==-1,O=-1,T=Ls(Ht(e,0))&&Fs(Ht(e,e.length-1));if(d||l)for(m=0;m<e.length;_>=65536?m+=2:m++){if(_=Ht(e,m),!Ut(_))return Tt;T=T&&Tn(_,f,h),f=_}else{for(m=0;m<e.length;_>=65536?m+=2:m++){if(_=Ht(e,m),_===Kt)v=!0,k&&(x=x||m-O-1>a&&e[O+1]!==" ",O=m);else if(!Ut(_))return Tt;T=T&&Tn(_,f,h),f=_}x=x||k&&m-O-1>a&&e[O+1]!==" "}return!v&&!x?T&&!l&&!c(e)?br:p===$t?Tt:Ii:r>9&&vr(e)?Tt:l?p===$t?Tt:Ii:x?_r:xr}function Ds(e,d,r,a,c){e.dump=(function(){if(d.length===0)return e.quotingType===$t?'""':"''";if(!e.noCompatMode&&(Cs.indexOf(d)!==-1||As.test(d)))return e.quotingType===$t?'"'+d+'"':"'"+d+"'";var p=e.indent*Math.max(1,r),l=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-p),h=a||e.flowLevel>-1&&r>=e.flowLevel;function m(_){return Is(e,_)}switch(zs(d,h,e.indent,l,m,e.quotingType,e.forceQuotes&&!a,c)){case br:return d;case Ii:return"'"+d.replace(/'/g,"''")+"'";case xr:return"|"+Mn(d,e.indent)+Pn(An(d,p));case _r:return">"+Mn(d,e.indent)+Pn(An(Rs(d,l),p));case Tt:return'"'+Bs(d)+'"';default:throw new Ye("impossible error: invalid scalar style")}})()}function Mn(e,d){var r=vr(e)?String(d):"",a=e[e.length-1]===`
`,c=a&&(e[e.length-2]===`
`||e===`
`),p=c?"+":a?"":"-";return r+p+`
`}function Pn(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Rs(e,d){for(var r=/(\n+)([^\n]*)/g,a=(function(){var _=e.indexOf(`
`);return _=_!==-1?_:e.length,r.lastIndex=_,In(e.slice(0,_),d)})(),c=e[0]===`
`||e[0]===" ",p,l;l=r.exec(e);){var h=l[1],m=l[2];p=m[0]===" ",a+=h+(!c&&!p&&m!==""?`
`:"")+In(m,d),c=p}return a}function In(e,d){if(e===""||e[0]===" ")return e;for(var r=/ [^ ]/g,a,c=0,p,l=0,h=0,m="";a=r.exec(e);)h=a.index,h-c>d&&(p=l>c?l:h,m+=`
`+e.slice(c,p),c=p+1),l=h;return m+=`
`,e.length-c>d&&l>c?m+=e.slice(c,l)+`
`+e.slice(l+1):m+=e.slice(c),m.slice(1)}function Bs(e){for(var d="",r=0,a,c=0;c<e.length;r>=65536?c+=2:c++)r=Ht(e,c),a=ze[r],!a&&Ut(r)?(d+=e[c],r>=65536&&(d+=e[c+1])):d+=a||Ts(r);return d}function Ns(e,d,r){var a="",c=e.tag,p,l,h;for(p=0,l=r.length;p<l;p+=1)h=r[p],e.replacer&&(h=e.replacer.call(r,String(p),h)),(rt(e,d,h,!1,!1)||typeof h=="undefined"&&rt(e,d,null,!1,!1))&&(a!==""&&(a+=","+(e.condenseFlow?"":" ")),a+=e.dump);e.tag=c,e.dump="["+a+"]"}function Ln(e,d,r,a){var c="",p=e.tag,l,h,m;for(l=0,h=r.length;l<h;l+=1)m=r[l],e.replacer&&(m=e.replacer.call(r,String(l),m)),(rt(e,d+1,m,!0,!0,!1,!0)||typeof m=="undefined"&&rt(e,d+1,null,!0,!0,!1,!0))&&((!a||c!=="")&&(c+=Pi(e,d)),e.dump&&Kt===e.dump.charCodeAt(0)?c+="-":c+="- ",c+=e.dump);e.tag=p,e.dump=c||"[]"}function js(e,d,r){var a="",c=e.tag,p=Object.keys(r),l,h,m,_,f;for(l=0,h=p.length;l<h;l+=1)f="",a!==""&&(f+=", "),e.condenseFlow&&(f+='"'),m=p[l],_=r[m],e.replacer&&(_=e.replacer.call(r,m,_)),rt(e,d,m,!1,!1)&&(e.dump.length>1024&&(f+="? "),f+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),rt(e,d,_,!1,!1)&&(f+=e.dump,a+=f));e.tag=c,e.dump="{"+a+"}"}function qs(e,d,r,a){var c="",p=e.tag,l=Object.keys(r),h,m,_,f,v,x;if(e.sortKeys===!0)l.sort();else if(typeof e.sortKeys=="function")l.sort(e.sortKeys);else if(e.sortKeys)throw new Ye("sortKeys must be a boolean or a function");for(h=0,m=l.length;h<m;h+=1)x="",(!a||c!=="")&&(x+=Pi(e,d)),_=l[h],f=r[_],e.replacer&&(f=e.replacer.call(r,_,f)),rt(e,d+1,_,!0,!0,!0)&&(v=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,v&&(e.dump&&Kt===e.dump.charCodeAt(0)?x+="?":x+="? "),x+=e.dump,v&&(x+=Pi(e,d)),rt(e,d+1,f,!0,v)&&(e.dump&&Kt===e.dump.charCodeAt(0)?x+=":":x+=": ",x+=e.dump,c+=x));e.tag=p,e.dump=c||"{}"}function Fn(e,d,r){var a,c,p,l,h,m;for(c=r?e.explicitTypes:e.implicitTypes,p=0,l=c.length;p<l;p+=1)if(h=c[p],(h.instanceOf||h.predicate)&&(!h.instanceOf||typeof d=="object"&&d instanceof h.instanceOf)&&(!h.predicate||h.predicate(d))){if(r?h.multi&&h.representName?e.tag=h.representName(d):e.tag=h.tag:e.tag="?",h.represent){if(m=e.styleMap[h.tag]||h.defaultStyle,ur.call(h.represent)==="[object Function]")a=h.represent(d,m);else if(pr.call(h.represent,m))a=h.represent[m](d,m);else throw new Ye("!<"+h.tag+'> tag resolver accepts not "'+m+'" style');e.dump=a}return!0}return!1}function rt(e,d,r,a,c,p,l){e.tag=null,e.dump=r,Fn(e,r,!1)||Fn(e,r,!0);var h=ur.call(e.dump),m=a,_;a&&(a=e.flowLevel<0||e.flowLevel>d);var f=h==="[object Object]"||h==="[object Array]",v,x;if(f&&(v=e.duplicates.indexOf(r),x=v!==-1),(e.tag!==null&&e.tag!=="?"||x||e.indent!==2&&d>0)&&(c=!1),x&&e.usedDuplicates[v])e.dump="*ref_"+v;else{if(f&&x&&!e.usedDuplicates[v]&&(e.usedDuplicates[v]=!0),h==="[object Object]")a&&Object.keys(e.dump).length!==0?(qs(e,d,e.dump,c),x&&(e.dump="&ref_"+v+e.dump)):(js(e,d,e.dump),x&&(e.dump="&ref_"+v+" "+e.dump));else if(h==="[object Array]")a&&e.dump.length!==0?(e.noArrayIndent&&!l&&d>0?Ln(e,d-1,e.dump,c):Ln(e,d,e.dump,c),x&&(e.dump="&ref_"+v+e.dump)):(Ns(e,d,e.dump),x&&(e.dump="&ref_"+v+" "+e.dump));else if(h==="[object String]")e.tag!=="?"&&Ds(e,e.dump,d,p,m);else{if(h==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new Ye("unacceptable kind of an object to dump "+h)}e.tag!==null&&e.tag!=="?"&&(_=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?_="!"+_:_.slice(0,18)==="tag:yaml.org,2002:"?_="!!"+_.slice(18):_="!<"+_+">",e.dump=_+" "+e.dump)}return!0}function Hs(e,d){var r=[],a=[],c,p;for(Li(e,r,a),c=0,p=a.length;c<p;c+=1)d.duplicates.push(r[a[c]]);d.usedDuplicates=new Array(p)}function Li(e,d,r){var a,c,p;if(e!==null&&typeof e=="object")if(c=d.indexOf(e),c!==-1)r.indexOf(c)===-1&&r.push(c);else if(d.push(e),Array.isArray(e))for(c=0,p=e.length;c<p;c+=1)Li(e[c],d,r);else for(a=Object.keys(e),c=0,p=a.length;c<p;c+=1)Li(e[a[c]],d,r)}function Ys(e,d){d=d||{};var r=new Ps(d);r.noRefs||Hs(e,r);var a=e;return r.replacer&&(a=r.replacer.call({"":a},"",a)),rt(r,0,a,!0,!0)?r.dump+`
`:""}var Ks=Ys,$s={dump:Ks};function Ni(e,d){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+d+" instead, which is now safe by default.")}}var Us=Pe,Ws=Rn,Vs=qn,Xs=Un,Gs=Wn,Js=zi,Qs=dr.load,Zs=dr.loadAll,ec=$s.dump,tc=Ye,ic={binary:Qn,float:$n,map:jn,null:Hn,pairs:er,set:tr,timestamp:Gn,bool:Yn,int:Kn,merge:Jn,omap:Zn,seq:Nn,str:Bn},nc=Ni("safeLoad","load"),rc=Ni("safeLoadAll","loadAll"),oc=Ni("safeDump","dump"),ac={Type:Us,Schema:Ws,FAILSAFE_SCHEMA:Vs,JSON_SCHEMA:Xs,CORE_SCHEMA:Gs,DEFAULT_SCHEMA:Js,load:Qs,loadAll:Zs,dump:ec,YAMLException:tc,types:ic,safeLoad:nc,safeLoadAll:rc,safeDump:oc},wr=ac;window.interact||(window.interact=Sr.default);window.jsyaml||(window.jsyaml=wr);var sc="0.1.161";console.info(`%c drag-and-drop-card %c v${sc} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var cc=(e,...d)=>console.debug(`[drag-and-drop-card] ${e}`,...d);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var kr=()=>new Promise(e=>requestAnimationFrame(()=>e())),lc=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),ji=class e extends HTMLElement{constructor(){super();vn(this,"__booting",!1);this.shadowRoot||this.attachShadow({mode:"open"}),this.__rebuiltCards=new WeakSet}_hasCardModDeep(r){try{if(!r||typeof r!="object")return!1;if(r.card_mod||r.type==="custom:mod-card")return!0;if(r.card)return this._hasCardModDeep(r.card);if(Array.isArray(r.cards)){for(let a of r.cards)if(this._hasCardModDeep(a))return!0}return!1}catch{return!1}}_rebuildOnce(r){try{if(!r||(this.__rebuiltCards||(this.__rebuiltCards=new WeakSet),this.__rebuiltCards.has(r)))return;this.__rebuiltCards.add(r),r.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}}_deepQueryAll(r,a=document){let c=[],p=l=>{if(!l)return;if(l.querySelectorAll)try{l.querySelectorAll(r).forEach(_=>c.push(_))}catch{}let h=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,null),m=l;for(;m;){let _=m.shadowRoot;_&&p(_),m=h.nextNode()}};return p(a),c}_syncEditorsStorageKey(){try{let r=this.storageKey||"";this._deepQueryAll("#storage_key").forEach(c=>{try{c&&c.tagName==="INPUT"&&c.value!==r&&(c.value=r,c.dispatchEvent(new Event("input",{bubbles:!0})),c.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}})}catch{}}static getConfigElement(){var v,x;let r=document.createElement("div");r.innerHTML=`
      <style>
        .cfg-row{display:flex;gap:12px;align-items:center;margin:8px 0;flex-wrap:wrap}
        input[type="text"],input[type="number"],select{
          padding:6px;border-radius:8px;border:1px solid var(--divider-color);
          background:var(--primary-background-color);color:var(--primary-text-color)
        }
        label{font-weight:600;min-width:130px}
        .inline{display:inline-flex;gap:8px;align-items:center}
        .hint{opacity:.65;font-size:.85rem}
      </style>

      <div class="cfg-row">
        <label>Storage key</label>
        <input id="storage_key" type="text" placeholder="my_unique_layout_key" />
      </div>

      <div class="cfg-row">
        <label>Grid size</label>
        <input id="grid" type="number" min="4" max="32" step="1" value="10" style="width:90px" />
        <span class="hint">Grid cell in px; affects snap & default card size</span>
      </div>

      <div class="cfg-row">
        <label><input type="checkbox" id="liveSnap"> Snap while dragging (live)</label>
      </div>

      <div class="cfg-row">
        <label>Auto-save</label>
        <input type="checkbox" id="autoSave" checked>
        <span style="margin-left:auto">Debounce (ms)</span>
        <input type="number" id="autoSaveDebounce" min="0" step="50" value="800" style="width:90px">
      </div>

      <div class="cfg-row">
        <label>Container Background</label>
        <input type="text" id="containerBg"
          placeholder="transparent or css e.g. linear-gradient(...)"
          title="Try: transparent, #232f3e, linear-gradient(...), radial-gradient(...)" />
      </div>

      <div class="cfg-row">
        <label>Card Background</label>
        <input type="text" id="cardBg"
          placeholder="var(--ha-card-background) or css e.g. #ffffffcc"
          title="Try: transparent, #151515aa, linear-gradient(...)" />
      </div>

      <div class="cfg-row">
        <label><input type="checkbox" id="debug"> Debug logs</label>
      </div>

      <div class="cfg-row">
        <label><input type="checkbox" id="noOverlap"> Disable overlap</label>
      </div>

      <!-- Size controls -->
      <div class="cfg-row">
        <label>Container size</label>
        <select id="sizeMode">
          <option value="dynamic">Dynamic (auto)</option>
          <option value="fixed_custom">Fixed (custom)</option>
          <option value="preset">Preset</option>
        </select>

        <span id="sizeCustom" class="inline" style="display:none">
          <span>W</span><input id="sizeW" type="number" min="100" step="10" style="width:90px">
          <span>H</span><input id="sizeH" type="number" min="100" step="10" style="width:90px">
        </span>

        <span id="sizePresetWrap" class="inline" style="display:none">
          <select id="sizePreset"></select>
          <select id="sizeOrientation">
            <option value="auto">Auto</option>
            <option value="landscape">Landscape</option>
            <option value="portrait">Portrait</option>
          </select>
        </span>
      </div>

      <!-- Actions -->
      <div class="cfg-row" style="justify-content:flex-end">
        <mwc-button id="revertBtn" outlined>Revert</mwc-button>
        <mwc-button id="applyBtn" raised disabled>Apply</mwc-button>
      </div>
    `;let a=document.createElement("optgroup");a.label="Presets",(((v=e._sizePresets)==null?void 0:v.call(e))||[]).forEach(k=>{let O=document.createElement("option");O.value=k.key,O.textContent=`${k.label} (${k.w}\xD7${k.h})`,a.appendChild(O)}),(x=r.querySelector("#sizePreset"))==null||x.appendChild(a);let c=()=>{let k=r.querySelector("#sizeMode").value;r.querySelector("#sizeCustom").style.display=k==="fixed_custom"?"inline-flex":"none",r.querySelector("#sizePresetWrap").style.display=k==="preset"?"inline-flex":"none"};r.setConfig=(k={})=>{var M,I,A,Y,N,S,K,D;r._config={type:k.type||"custom:drag-and-drop-card",...k},r.querySelector("#storage_key").value=k.storage_key||"",r.querySelector("#grid").value=(M=k.grid)!=null?M:10,r.querySelector("#liveSnap").checked=!!k.drag_live_snap,r.querySelector("#autoSave").checked=k.auto_save!==!1,r.querySelector("#autoSaveDebounce").value=(I=k.auto_save_debounce)!=null?I:800,r.querySelector("#containerBg").value=(A=k.container_background)!=null?A:"transparent",r.querySelector("#cardBg").value=(Y=k.card_background)!=null?Y:"var(--ha-card-background, var(--card-background-color))",r.querySelector("#debug").checked=!!k.debug,r.querySelector("#noOverlap").checked=!!k.disable_overlap,r.querySelector("#sizeMode").value=k.container_size_mode||"dynamic",r.querySelector("#sizeW").value=(N=k.container_fixed_width)!=null?N:"",r.querySelector("#sizeH").value=(S=k.container_fixed_height)!=null?S:"";let O=r.querySelector("#sizePreset"),T=((K=e._sizePresets)==null?void 0:K.call(e))||[];O&&[...O.options].some(H=>H.value===(k.container_preset||"")),O.value=k.container_preset||((D=T[0])==null?void 0:D.key)||"fhd",r.querySelector("#sizeOrientation").value=k.container_preset_orientation||"auto",c(),m()},r.getConfig=()=>{let k={...r._config||{}};return k.storage_key=r.querySelector("#storage_key").value||"",k.grid=Number(r.querySelector("#grid").value||10),k.drag_live_snap=!!r.querySelector("#liveSnap").checked,k.auto_save=!!r.querySelector("#autoSave").checked,k.auto_save_debounce=Number(r.querySelector("#autoSaveDebounce").value||800),k.container_background=r.querySelector("#containerBg").value||"transparent",k.card_background=r.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",k.debug=!!r.querySelector("#debug").checked,k.disable_overlap=!!r.querySelector("#noOverlap").checked,k.container_size_mode=r.querySelector("#sizeMode").value,k.container_fixed_width=Number(r.querySelector("#sizeW").value||0)||void 0,k.container_fixed_height=Number(r.querySelector("#sizeH").value||0)||void 0,k.container_preset=r.querySelector("#sizePreset").value||void 0,k.container_preset_orientation=r.querySelector("#sizeOrientation").value||"auto",k};let p=r.querySelector("#applyBtn"),l=r.querySelector("#revertBtn"),h=()=>{try{return JSON.stringify(r.getConfig())!==JSON.stringify(r._config)}catch{return!0}},m=()=>{p&&(p.disabled=!h())},_=()=>{r.dispatchEvent(new CustomEvent("config-changed",{detail:{config:r.getConfig()}})),r._config=r.getConfig(),m()},f=(k,O="input")=>{var T;return(T=r.querySelector(k))==null?void 0:T.addEventListener(O,()=>{k==="#sizeMode"&&c(),m()})};return f("#storage_key"),f("#grid"),f("#liveSnap","change"),f("#autoSave","change"),f("#autoSaveDebounce"),f("#containerBg"),f("#cardBg"),f("#debug","change"),f("#noOverlap","change"),f("#sizeMode","change"),f("#sizeW"),f("#sizeH"),f("#sizePreset","change"),f("#sizeOrientation","change"),p==null||p.addEventListener("click",_),l==null||l.addEventListener("click",()=>r.setConfig(r._config)),r}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let r=Math.max(100,Number(this.containerFixedWidth||0)),a=Math.max(100,Number(this.containerFixedHeight||0));return{w:r,h:a}}if(this.containerSizeMode==="preset"){let r=e._sizePresets().find(p=>p.key===this.containerPreset)||e._sizePresets().find(p=>p.key==="fhd");if(!r)return{w:1920,h:1080};let a=r.w,c=r.h;return this.containerPresetOrient==="portrait"&&a>c&&([a,c]=[c,a]),this.containerPresetOrient==="landscape"&&c>a&&([a,c]=[c,a]),{w:a,h:c}}return null}async _persistOptionsToYaml(r){var k,O,T,M,I,A,Y,N,S;let a=["storage_key","grid","container_background","card_background","disable_overlap","drag_live_snap","auto_save","auto_save_debounce","debug","container_size_mode","container_preset_orientation","container_fixed_width","container_fixed_height","container_preset"],c=(A=(I=(M=(T=(O=(k=document.querySelector("home-assistant"))==null?void 0:k.shadowRoot)==null?void 0:O.querySelector("home-assistant-main"))==null?void 0:T.shadowRoot)==null?void 0:M.querySelector("app-drawer-layout partial-panel-resolver ha-panel-lovelace"))==null?void 0:I.shadowRoot)==null?void 0:A.querySelector("hui-root"),p=c==null?void 0:c.lovelace;if(!(p!=null&&p.config)||!p.saveConfig)return console.debug("[ddc:import] YAML persist skipped (no Lovelace save API)"),!1;let l=(Y=p.current_view)!=null?Y:0,h=(N=p.config.views)==null?void 0:N[l];if(!h)return!1;let m={};for(let K of a)K in r&&(m[K]=r[K]);m.type="custom:drag-and-drop-card",m.storage_key||(m.storage_key=this.storageKey||((S=this._config)==null?void 0:S.storage_key));let _=K=>(K==null?void 0:K.type)==="custom:drag-and-drop-card"&&(!m.storage_key||K.storage_key===m.storage_key),f=(h.cards||[]).findIndex(_);if(f===-1&&Array.isArray(h.cards))for(let K=0;K<h.cards.length;K++){let D=h.cards[K];for(let H of["cards","elements","sections"])if(Array.isArray(D==null?void 0:D[H])){let j=D[H].findIndex(_);if(j!==-1){let $={...p.config};$.views=[...$.views];let B={...h,cards:[...h.cards]},z={...B.cards[K],[H]:[...D[H]]};return z[H][j]={...z[H][j],...m},B.cards[K]=z,$.views[l]=B,console.debug("[ddc:import] YAML persist (stack) \u2192 saving",{viewIndex:l,i:K,j,patch:m}),await p.saveConfig($),!0}}}if(f===-1)return console.debug("[ddc:import] YAML persist: card not found in current view"),!1;let v={...p.config};v.views=[...v.views];let x={...h,cards:[...h.cards||[]]};return x.cards[f]={...x.cards[f],...m},v.views[l]=x,console.debug("[ddc:import] YAML persist \u2192 saving",{viewIndex:l,idx:f,patch:m}),await p.saveConfig(v),!0}_applyContainerSizingFromConfig(r=!1){var c,p;let a=this.cardContainer;if(a)if(this._isContainerFixed()){let{w:l,h}=this._resolveFixedSize();a.style.width=`${l}px`,a.style.height=`${h}px`,a.style.overflow="hidden",r||(c=this._dbgPush)==null||c.call(this,"size","Applied fixed size",{w:l,h,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else a.style.overflow="hidden",r||(p=this._dbgPush)==null||p.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getLovelace(){var l,h;let r=0,a=this;for(;a&&r++<20;){let m=(l=a.getRootNode)==null?void 0:l.call(a),_=m==null?void 0:m.host;if((_==null?void 0:_.tagName)==="HUI-ROOT")return _.lovelace;a=_||a.parentElement}let c=new Set,p=[document];for(;p.length;){let m=p.shift();if(!(!m||c.has(m))){if(c.add(m),((h=m.host)==null?void 0:h.tagName)==="HUI-ROOT")return m.host.lovelace;if(m.tagName==="HUI-ROOT")return m.lovelace;if(m.shadowRoot&&p.push(m.shadowRoot),m.children)for(let _ of m.children)p.push(_)}}}_scanDdcCards(r){let a=[],c=(l,h,m)=>{(m==null?void 0:m.type)==="custom:drag-and-drop-card"&&a.push({view:l,path:[...h],card:m})},p=(l,h,m)=>{if(l){if(Array.isArray(l)){l.forEach((_,f)=>p(_,h,m.concat(f)));return}if(typeof l=="object"){"type"in l&&c(h,m,l);for(let[_,f]of Object.entries(l))_==="views"&&Array.isArray(f)?f.forEach((v,x)=>p(v,x,["views",x])):(Array.isArray(f)||f&&typeof f=="object")&&p(f,h,m.concat(_))}}};return p(r,-1,[]),a}async _persistOptionsToYaml(r,{forcePatchCurrentView:a=!0}={}){var v,x;let c=this._getLovelace();if(!c)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof c.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let p=r.storage_key||this.storageKey||((v=this._config)==null?void 0:v.storage_key)||null,l=JSON.parse(JSON.stringify(c.config)),h=this._scanDdcCards(l);console.debug("[ddc:import] persist: found DDC cards",h.map(k=>({view:k.view,path:k.path.join("."),storage_key:k.card.storage_key||null})));let m=(x=c.current_view)!=null?x:0,_=h.filter(k=>p&&k.card.storage_key===p);if(!_.length&&a){let k=h.filter(O=>O.view===m);k.length&&(_=k)}if(!_.length&&h.length===1&&(_=h),!_.length)return console.debug("[ddc:import] persist: no target. Hint: set a unique storage_key on this card and import again.",{key:p}),!1;let f={type:"custom:drag-and-drop-card",...r};p&&!f.storage_key&&(f.storage_key=p);for(let k of _){let O=l;for(let T of k.path)O=O[T];Object.assign(O,f)}return console.debug("[ddc:import] persist \u2192 saving",{patched:_.length,key:p||null,patch:f}),await c.saveConfig(l),!0}_getContainerSize(){let r=this.cardContainer;if(!r)return{w:0,h:0};let a=parseFloat(getComputedStyle(r).width)||r.getBoundingClientRect().width,c=parseFloat(getComputedStyle(r).height)||r.getBoundingClientRect().height;return{w:a,h:c}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:r,h:a}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(p=>{let l=parseFloat(p.getAttribute("data-x"))||0,h=parseFloat(p.getAttribute("data-y"))||0,m=parseFloat(p.style.width)||p.getBoundingClientRect().width,_=parseFloat(p.style.height)||p.getBoundingClientRect().height,f=Math.max(0,Math.min(l,Math.max(0,r-m))),v=Math.max(0,Math.min(h,Math.max(0,a-_))),x=Math.min(m,r),k=Math.min(_,a);(x!==m||k!==_)&&(p.style.width=`${x}px`,p.style.height=`${k}px`);let O=Math.max(0,Math.min(f,Math.max(0,r-x))),T=Math.max(0,Math.min(v,Math.max(0,a-k)));this._setCardPosition(p,O,T)})}_applyGridVars(){var a;let r=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",r),(a=this.cardContainer)==null||a.style.setProperty("--ddc-grid-size",r)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(r,a,c=null){let p={t:new Date().toISOString(),kind:r,msg:a,extra:c};this._dbgBuffer.push(p),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${r}]%c ${a}`,"color:#03a9f4","color:unset",c!=null?c:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(r){return String(r).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}setConfig(r={}){var p,l,h,m,_,f,v;let a=this.storageKey;r.storage_key||(this.storageKey?r={...r,storage_key:this.storageKey}:(this.storageKey=`layout_${((p=crypto==null?void 0:crypto.randomUUID)==null?void 0:p.call(crypto))||Date.now().toString(36)}`,r={...r,storage_key:this.storageKey})),this._config=r,this.storageKey=r.storage_key,this._syncEditorsStorageKey(),this.storageKey=r.storage_key||void 0,this._syncEditorsStorageKey(),this.gridSize=Number((l=r.grid)!=null?l:10),this.dragLiveSnap=!!r.drag_live_snap,this.autoSave=r.auto_save!==!1,this.autoSaveDebounce=Number((h=r.auto_save_debounce)!=null?h:800),this.containerBackground=(m=r.container_background)!=null?m:"transparent",this.cardBackground=(_=r.card_background)!=null?_:"var(--ha-card-background, var(--card-background-color))",this.debug=!!r.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!r.disable_overlap,this.containerSizeMode=r.container_size_mode||"dynamic",this.containerFixedWidth=Number((f=r.container_fixed_width)!=null?f:0)||null,this.containerFixedHeight=Number((v=r.container_fixed_height)!=null?v:0)||null,this.containerPreset=r.container_preset||"fullhd",this.containerPresetOrient=r.container_preset_orientation||"auto",this.cardContainer&&this._applyContainerSizingFromConfig(!1);let c=a!==this.storageKey;if(this.editMode&&!this.__booting&&!c)try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}if(this._applyGridVars(),this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:r.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let x=document.createElement("script");x.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(x)}if(!window.interact){let x=document.createElement("script");x.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",x.onload=()=>this._initInteract(),document.head.appendChild(x)}this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),this._built||(this._built=!0,this.shadowRoot.innerHTML=`
        <style>
          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            padding: 10px;
            border: 1px solid var(--divider-color);
            background: var(--ddc-bg, transparent);
            width: auto; height: auto; border-radius: 12px; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }
          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:0;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab;
            /* ensure buttons and resize handles remain visible on very small cards */
            overflow:auto;
            border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:1;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
        .chip{
            position:absolute;
            top:8px;
            right:8px;
            display:flex;
            gap:6px;
            flex-wrap:wrap;             /* allow chip buttons to wrap when space is limited */
            opacity:0;
            transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .chip .mini{
            display:inline-flex;align-items:center;gap:6px;
            background:rgba(28,28,30,.78);color:#fff;border:1px solid rgba(255,255,255,.18);
            border-radius:999px;padding:6px 10px;font-size:.76rem;cursor:pointer;letter-spacing:.2px;
            box-shadow:0 2px 6px rgba(0,0,0,.25); transition:transform .08s, background .12s, box-shadow .12s
          }
          .chip .mini:hover{transform:translateY(-1px); background:rgba(28,28,30,.95); box-shadow:0 3px 10px rgba(0,0,0,.35)}
          .chip .mini ha-icon{--mdc-icon-size:18px;width:18px;height:18px}
          .chip .mini.danger{background:rgba(220, 38, 38, .9);border-color:rgba(255,255,255,.22)}
          .chip .mini.danger:hover{background:rgba(220, 38, 38, 1)}
          .chip .mini.pill{padding:6px}

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:flex;                 /* shown in edit mode via your existing rule */
            position:absolute;
            bottom:8px;                   /* move INSIDE the wrapper bounds */
            right:8px;                    /* so it can't be clipped by overflow */
            width:28px;
            height:28px;
            border-radius:50%;
            background:var(--primary-color);
            color:#fff;
            border:1px solid rgba(255,255,255,.25);
            cursor:se-resize;
            z-index:999;                  /* above the card content */
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            align-items:center;
            justify-content:center;
          }
          .resize-handle:hover{transform:scale(1.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{--mdc-icon-size:18px;width:18px;height:18px;pointer-events:none}

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96vw);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{border-right:1px solid var(--divider-color);overflow:auto;background:var(--primary-background-color);contain:content}
          #rightPane{overflow:hidden;background:var(--primary-background-color)}
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);overflow:visible;position:relative;contain:content}
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}

          /* --- FIX: YAML editor should scroll and not overflow --- */
          #yamlSec { min-height: 0; }
          #yamlSec .bd { 
            overflow: auto;        /* allow scrolling inside the YAML section */
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec { min-height: 0; }
          #optionsSec .bd {
            overflow: auto;        /* scroll inside the Visual editor section */
            /* allow the visual editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          #editorHost { display:block; min-height: 0; }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: fixed and scroll inside */
          ha-code-editor { 
            display: block; 
            height: 260px !important; 
          }
          .CodeMirror { 
            height: 260px !important; 
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            max-height: 260px; 
            overflow: auto; 
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            display:flex;align-items:center;justify-content:center;width:100%;height:100%;
            background:repeating-conic-gradient(from 45deg, rgba(0,0,0,.05) 0% 25%, transparent 0% 50%) 50% / 14px 14px;pointer-events: none;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }
        </style>
        <div class="ddc-root">
          <div class="toolbar">
            <button class="btn" id="addCardBtn" style="display:none">
              <ha-icon icon="mdi:plus"></ha-icon>
              <span style="margin-left:6px">Add Card</span>
            </button>
            <button class="btn secondary" id="reloadBtn" style="display:none">
              <ha-icon icon="mdi:refresh"></ha-icon>
              <span style="margin-left:6px">Reload</span>
            </button>
            <button class="btn secondary" id="diagBtn" style="display:none">
              <ha-icon icon="mdi:play-circle-outline"></ha-icon>
              <span style="margin-left:6px">Diagnostics</span>
            </button>
            <button class="btn secondary" id="exportBtn" style="display:none">
              <ha-icon icon="mdi:download"></ha-icon>
              <span style="margin-left:6px">Export Design</span>
            </button>
            <button class="btn secondary" id="importBtn" style="display:none">
              <ha-icon icon="mdi:upload"></ha-icon>
              <span style="margin-left:6px">Import Design</span>
            </button>
            <button class="btn" id="applyLayoutBtn" style="display:none">
              <ha-icon icon="mdi:content-save"></ha-icon>
              <span style="margin-left:6px">Apply</span>
            </button>
            <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
              <ha-icon icon="mdi:storefront-outline"></ha-icon>
              <span>Open HADS</span>
            </button>
            <button class="btn warning" id="exitEditBtn" style="display:none">
              <ha-icon icon="mdi:exit-run"></ha-icon>
              <span>Exit edit mode</span>
            </button>
            <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
          </div>
          <div class="card-container" id="cardContainer"></div>
        </div>
      `,this.cardContainer=this.shadowRoot.querySelector("#cardContainer"),this.addButton=this.shadowRoot.querySelector("#addCardBtn"),this.reloadBtn=this.shadowRoot.querySelector("#reloadBtn"),this.diagBtn=this.shadowRoot.querySelector("#diagBtn"),this.exitEditBtn=this.shadowRoot.querySelector("#exitEditBtn"),this.storeBadge=this.shadowRoot.querySelector("#storeBadge"),this.exportBtn=this.shadowRoot.querySelector("#exportBtn"),this.importBtn=this.shadowRoot.querySelector("#importBtn"),this.exploreBtn=this.shadowRoot.querySelector("#exploreBtn"),this.applyLayoutBtn=this.shadowRoot.querySelector("#applyLayoutBtn"),this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.applyLayoutBtn.addEventListener("click",()=>this._saveLayout(!1)),window.addEventListener("keydown",x=>{this.editMode&&(x.ctrlKey||x.metaKey)&&(x.key==="s"||x.key==="S")&&(x.preventDefault(),this._saveLayout(!1))}),this.exploreBtn.addEventListener("click",()=>window.open("https://cardstore.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),this._installLongPressToEnterEdit(),window.addEventListener("keydown",x=>{x.key==="Escape"&&this.editMode&&this._toggleEditMode(!1)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",x=>{this.editMode&&(x.target.closest(".card-wrapper")||!x.shiftKey&&!x.ctrlKey&&!x.metaKey&&this._clearSelection())}));try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),this.__cfgReady=!0,c&&this.__booted?this._initialLoad(!0):!this.__booted&&this.__probed?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),this._resizeContainer())}connectedCallback(){this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1)}disconnectedCallback(){if(window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis),this.__lpInstalled&&this.__lpHandlers){let r=this.cardContainer;r==null||r.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),r==null||r.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}}set hass(r){var c;this._hass=r,cc("set hass"),!this.__probed&&r&&(this.__probed=!0,this._probeBackend().then(()=>{this.__probed=!0,!this.__booted&&this.__cfgReady&&(this.__booted=!0,this._initialLoad(!0))}));let a=((c=this.cardContainer)==null?void 0:c.children)||[];for(let p of a){let l=p.firstElementChild;l&&l.hass!==r&&(l.hass=r)}}get hass(){return this._hass}async _initialLoad(r=!1){var a,c,p,l,h,m,_,f,v,x,k,O,T,M;if(!this.__booting){this.__booting=!0;try{this._loading=!0,r&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:r});let I=[],A=null;if(this._backendOK&&this.storageKey)try{A=await this._loadLayoutFromBackend(this.storageKey)}catch(D){this._dbgPush("boot","Backend load failed",{error:String(D)})}if(!A&&this.storageKey){let D=null;try{D=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(D)if(this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(D).length}),this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,D),this._dbgPush("boot","Migrated local -> backend"),A=D}catch(H){this._dbgPush("boot","Migration failed, staying local",{error:String(H)}),A=D}else A=D}!A&&((c=(a=this._config)==null?void 0:a.cards)!=null&&c.length)&&(this._dbgPush("boot","Using embedded config"),A={cards:this._config.cards});let Y={...this._config||{}};if(A!=null&&A.options){let{storage_key:D,...H}=A.options;this._applyImportedOptions(H,!0)}else typeof(A==null?void 0:A.grid)=="number"&&this._applyImportedOptions({grid:A.grid},!0);let N=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation"],S={};for(let D of N)Y[D]!==void 0&&(S[D]=Y[D]);Object.keys(S).length&&this._applyImportedOptions(S,!0);let K=!1;if((p=A==null?void 0:A.cards)!=null&&p.length){for(let D of A.cards){if(!(D!=null&&D.card)||typeof D.card=="object"&&Object.keys(D.card).length===0){let $=this._makePlaceholderAt(((l=D.position)==null?void 0:l.x)||0,((h=D.position)==null?void 0:h.y)||0,((m=D.size)==null?void 0:m.width)||100,((_=D.size)==null?void 0:_.height)||100);this.cardContainer.appendChild($);try{this._rebuildOnce($.firstElementChild)}catch{}K=!0;continue}let H=await this._createCard(D.card),j=this._makeWrapper(H);this.editMode&&j.classList.add("editing"),this._setCardPosition(j,((f=D.position)==null?void 0:f.x)||0,((v=D.position)==null?void 0:v.y)||0),j.style.width=`${(k=(x=D.size)==null?void 0:x.width)!=null?k:14*this.gridSize}px`,j.style.height=`${(T=(O=D.size)==null?void 0:O.height)!=null?T:10*this.gridSize}px`,D.z!=null&&(j.style.zIndex=String(D.z)),this.cardContainer.appendChild(j);try{this._rebuildOnce(j.firstElementChild)}catch{}this._initCardInteract(j),K=!0}this._resizeContainer(),this._dbgPush("boot","Layout applied",{count:A.cards.length})}K||(this._showEmptyPlaceholder(),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI(),r&&(this._cardModProcessed=!1),setTimeout(()=>{this._processCardModOnce()},100);try{I.forEach(D=>{try{D.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}})}catch{}}finally{this._loading=!1,this.__booting=!1,this.__dirty=!1,(M=this._updateApplyBtn)==null||M.call(this)}}}async _persistOptionsToYaml(r){var f;let a=this._getLovelace();if(!a)return console.debug("[ddc:import] YAML persist skipped (no lovelace root)"),!1;let c=a.mode||(typeof a.saveConfig=="function"?"storage":"yaml");if(typeof a.saveConfig!="function")return console.debug(`[ddc:import] YAML persist skipped (dashboard mode: ${c})`),!1;let p={type:"custom:drag-and-drop-card",...r};p.storage_key||(p.storage_key=this.storageKey||((f=this._config)==null?void 0:f.storage_key));let l=v=>(v==null?void 0:v.type)==="custom:drag-and-drop-card"&&(!p.storage_key||v.storage_key===p.storage_key),h=JSON.parse(JSON.stringify(a.config)),m=0,_=v=>{if(v){if(Array.isArray(v))return v.forEach(_);if(typeof v=="object"){v.type&&l(v)&&(Object.assign(v,p),m++);for(let x of Object.values(v))x&&(typeof x=="object"||Array.isArray(x))&&_(x)}}};return _(h.views),m?(console.debug("[ddc:import] YAML persist \u2192 saving",{mode:c,patched:m,patch:p}),await a.saveConfig(h),!0):(console.debug("[ddc:import] YAML persist: no matching card (check storage_key)"),!1)}_toggleEditMode(r=null){var l,h,m,_;try{(l=this.__clearPressTimer)==null||l.call(this)}catch{}let a=r===null?!this.editMode:!!r,c=!this.editMode&&a;if(this.editMode=a,this.editMode=a,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this.applyLayoutBtn.style.display=this.editMode?"inline-block":"none",this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(f=>{f.classList.toggle("editing",this.editMode);let v=f.querySelector(".resize-handle");v&&(v.style.display=this.editMode?"flex":"none"),!f.dataset.placeholder&&window.interact&&window.interact(f).draggable(this.editMode).resizable(this.editMode),f.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(h=this.cardContainer)==null||h.querySelectorAll(".card-wrapper.dragging").forEach(f=>f.classList.remove("dragging")),c){let f=(m=this.__lastHoldX)!=null?m:null,v=(_=this.__lastHoldY)!=null?_:null;this._playEditRipple(f,v)}}_isInHaEditorPreview(){let r=this;for(;r;){let a=r.nodeType===1&&r.localName?r.localName.toLowerCase():"";if(a==="hui-card-editor"||a==="hui-dialog-edit-card"||a==="hui-card-preview"||a==="ha-dialog"||a==="mwc-dialog")return!0;let c=r.getRootNode&&r.getRootNode();r=r.parentElement||c&&c.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let r=this.cardContainer;if(!r)return;let a=800,c=18,p=S=>!!S&&typeof S=="object"&&S.nodeType===1,l=(S,K)=>{try{return!!(S&&K&&typeof S.contains=="function"&&p(K)&&S.contains(K))}catch{return!1}},h=S=>l(this.cardContainer,S),m=S=>{var H,j,$;let K=(j=(H=S.target)==null?void 0:H.closest)==null?void 0:j.call(H,".card-wrapper");if(p(K)&&h(K)&&!K.classList.contains("ddc-placeholder"))return!0;let D=typeof S.composedPath=="function"?S.composedPath():[];for(let B of D)if(p(B)&&h(B)&&($=B.classList)!=null&&$.contains("card-wrapper")&&!B.classList.contains("ddc-placeholder"))return!0;return!1},_=(S,K)=>{let D=document.createElement("div");D.className="ddc-press-ring",document.body.appendChild(D),Object.assign(D.style,{position:"fixed",left:`${S}px`,top:`${K}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),D.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let H=D.querySelector(".pr-fg"),j=18,$=2*Math.PI*j;return H.style.strokeDasharray=`${$}`,H.style.strokeDashoffset=`${$}`,requestAnimationFrame(()=>{H.style.transition=`stroke-dashoffset ${a}ms linear`,H.style.strokeDashoffset="0"}),{el:D,move(B,z){D.style.left=`${B}px`,D.style.top=`${z}px`},remove(){try{D.remove()}catch{}}}},f=null,v=null,x=0,k=0,O=null,T=()=>{f&&clearTimeout(f),f=null,v==null||v.remove(),v=null};this.__clearPressTimer=T;let M=S=>{S.pointerType==="mouse"&&S.button!==0||this._isInHaEditorPreview()||!h(S.target)||m(S)||(O=S.pointerId,x=S.clientX,k=S.clientY,this.__lastHoldX=x,this.__lastHoldY=k,v=_(x,k),f=setTimeout(()=>{var D;T();let K=!this.editMode;this._toggleEditMode(K),(D=this._toast)==null||D.call(this,`Edit mode ${K?"enabled":"disabled"}`)},a))},I=S=>{f==null||S.pointerId!==O||(v==null||v.move(S.clientX,S.clientY),(Math.abs(S.clientX-x)>c||Math.abs(S.clientY-k)>c)&&T())},A=S=>{S.pointerId===O&&(T(),O=null)},Y=S=>{if(f)return S.preventDefault(),S.stopPropagation(),!1},N=S=>{var D;if(this._isInHaEditorPreview()||!h(S.target)||m(S))return;let K=!this.editMode;this._toggleEditMode(K),(D=this._toast)==null||D.call(this,`Edit mode ${K?"enabled":"disabled"}`)};r.addEventListener("pointerdown",M),window.addEventListener("pointermove",I,{passive:!0}),window.addEventListener("pointerup",A,{passive:!0}),window.addEventListener("pointercancel",A,{passive:!0}),window.addEventListener("contextmenu",Y),r.addEventListener("dblclick",N),this.__lpHandlers={onPointerDown:M,onPointerMove:I,onPointerUpOrCancel:A,onContextMenu:Y,onDblClick:N}}_isLayoutEmpty(){let r=this.cardContainer;return r?r.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let r=this._isLayoutEmpty();if(this.addButton){let c=this.editMode||r;this.addButton.style.display=c?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&r)}let a=c=>c&&(c.style.display=this.editMode?"inline-block":"none");a(this.reloadBtn),a(this.diagBtn),a(this.exitEditBtn),a(this.exportBtn),a(this.importBtn),a(this.exploreBtn),a(this.storeBadge),a(this.applyLayoutBtn)}_updateApplyBtn(){this.applyLayoutBtn&&(this.applyLayoutBtn.disabled=!this.__dirty)}_markDirty(r=""){var a;this.__dirty=!0,this._updateApplyBtn(),(a=this._dbgPush)==null||a.call(this,"dirty","Marked dirty",{reason:r})}_playEditRipple(r=null,a=null){let c=this.cardContainer;if(!c)return;let p=c.getBoundingClientRect(),l=r==null?p.left+p.width/2:r,h=a==null?p.top+p.height/2:a,m=l-p.left,_=h-p.top,f=document.createElement("div");f.className="ddc-ripple-veil",f.style.setProperty("--rip-x",`${m}px`),f.style.setProperty("--rip-y",`${_}px`),c.appendChild(f),setTimeout(()=>f.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>this._initCardInteract(a))}_initCardInteract(r){if(!window.interact||r.dataset.placeholder)return;let a=this.gridSize,c=!!this.dragLiveSnap,l=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let h=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});l.push(window.interact.modifiers.snap({targets:[h],range:1/0,offset:"startCoords"}))}window.interact(r).draggable({enabled:this.editMode,inertia:!1,modifiers:l,listeners:{start:h=>{this._selection.has(r)||(!(h!=null&&h.shiftKey)&&!(h!=null&&h.ctrlKey)&&!(h!=null&&h.metaKey)&&this._clearSelection(),this._toggleSelection(r,!0));let m=Array.from(this._selection);this.__groupDrag={leader:r,members:m,startRaw:new Map(m.map(f=>[f,{x:parseFloat(f.getAttribute("data-x-raw"))||parseFloat(f.getAttribute("data-x"))||0,y:parseFloat(f.getAttribute("data-y-raw"))||parseFloat(f.getAttribute("data-y"))||0,w:parseFloat(f.style.width)||f.getBoundingClientRect().width,h:parseFloat(f.style.height)||f.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(f=>{let v=parseFloat(f.getAttribute("data-x-raw"))||parseFloat(f.getAttribute("data-x"))||0,x=parseFloat(f.getAttribute("data-y-raw"))||parseFloat(f.getAttribute("data-y"))||0;this.__collisionOriginals.set(f,{x:v,y:x})}),m.forEach(f=>{f.classList.add("dragging"),f.getAttribute("data-x-raw")===null&&f.setAttribute("data-x-raw",f.getAttribute("data-x")||"0"),f.getAttribute("data-y-raw")===null&&f.setAttribute("data-y-raw",f.getAttribute("data-y")||"0")})},move:h=>{if(!this.__groupDrag)return;let m=this.gridSize,_=!!this.dragLiveSnap,f=this.__groupDrag.leader,v=this.__groupDrag.startRaw.get(f),x=(parseFloat(f.getAttribute("data-x-raw"))||v.x)+h.dx,k=(parseFloat(f.getAttribute("data-y-raw"))||v.y)+h.dy,O=x-v.x,T=k-v.y,M=this.__groupDrag.members.map(I=>{let A=this.__groupDrag.startRaw.get(I),Y=A.x+O,N=A.y+T,S=_?Math.round(Y/m)*m:Y,K=_?Math.round(N/m)*m:N;return{el:I,rawX:Y,rawY:N,snapX:S,snapY:K,w:A.w,h:A.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(M,O,T,_,m),f.setAttribute("data-x-raw",String(x)),f.setAttribute("data-y-raw",String(k));for(let I of M)I.el.setAttribute("data-x-raw",String(I.rawX)),I.el.setAttribute("data-y-raw",String(I.rawY)),this._setCardPosition(I.el,I.snapX,I.snapY);this._resizeContainer()},end:h=>{if(!this.__groupDrag)return;let m=this.gridSize,_=this.__groupDrag.members.map(f=>{let v=parseFloat(f.getAttribute("data-x-raw"))||parseFloat(f.getAttribute("data-x"))||0,x=parseFloat(f.getAttribute("data-y-raw"))||parseFloat(f.getAttribute("data-y"))||0,k=Math.round(v/m)*m,O=Math.round(x/m)*m,T=parseFloat(f.style.width)||f.getBoundingClientRect().width,M=parseFloat(f.style.height)||f.getBoundingClientRect().height;return{el:f,rawX:v,rawY:x,snapX:k,snapY:O,w:T,h:M}});this.disableOverlap&&this._pushCardsOutOfTheWay(_,0,0,!1,m);for(let f of _)this._setCardPosition(f.el,f.snapX,f.snapY),f.el.setAttribute("data-x-raw",String(f.snapX)),f.el.setAttribute("data-y-raw",String(f.snapY));for(let f of this.__groupDrag.members)f.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(r).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:h=>{let m=this.gridSize,_=!!this.dragLiveSnap,f=parseFloat(r.style.width)||r.getBoundingClientRect().width,v=parseFloat(r.style.height)||r.getBoundingClientRect().height,{width:x,height:k}=h.rect,O=_?Math.max(m,Math.round(x/m)*m):x,T=_?Math.max(m,Math.round(k/m)*m):k,M=parseFloat(r.getAttribute("data-x"))||0,I=parseFloat(r.getAttribute("data-y"))||0,A=O,Y=T;if(this._isContainerFixed()){let{w:S,h:K}=this._getContainerSize();A=Math.min(O,Math.max(this.gridSize,S-M)),Y=Math.min(T,Math.max(this.gridSize,K-I))}let N=[this._rectFor(r,M,I,A,Y)];this.disableOverlap&&this._anyCollisionFor(N,new Set([r]))||(r.style.width=`${A}px`,r.style.height=`${Y}px`,this._resizeContainer())},end:()=>{let h=this.gridSize,m=parseFloat(r.style.width)||r.getBoundingClientRect().width,_=parseFloat(r.style.height)||r.getBoundingClientRect().height,f=Math.max(h,Math.round(m/h)*h),v=Math.max(h,Math.round(_/h)*h),x=parseFloat(r.getAttribute("data-x"))||0,k=parseFloat(r.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:T,h:M}=this._getContainerSize();f=Math.min(f,Math.max(h,T-x)),v=Math.min(v,Math.max(h,M-k))}let O=[this._rectFor(r,x,k,f,v)];this.disableOverlap&&this._anyCollisionFor(O,new Set([r]))||(r.style.width=`${f}px`,r.style.height=`${v}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),r.addEventListener("mousedown",h=>{this.editMode&&(h.target.closest(".resize-handle")||h.target.closest(".chip")||(h.shiftKey||h.ctrlKey||h.metaKey?(h.stopPropagation(),this._toggleSelection(r)):this._selection.has(r)||(this._clearSelection(),this._toggleSelection(r,!0))))})}async _createCard(r){let c=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(r);if(c.hass=this.hass,r.type==="custom:mod-card"&&(await new Promise(p=>setTimeout(p,0)),c.setConfig&&typeof c.setConfig=="function"))try{c.setConfig(r)}catch{}return c}_makeWrapper(r){let a=document.createElement("div");a.classList.add("card-wrapper"),this.editMode&&a.classList.add("editing"),a.style.zIndex||(a.style.zIndex=String(this._highestZ()+1));let c=document.createElement("div");c.className="chip",c.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini danger pill" data-act="delete" title="Delete card" aria-label="Delete card">
        <ha-icon icon="mdi:close-thick"></ha-icon>
      </button>
    `,c.addEventListener("click",async h=>{var _,f,v;h.stopPropagation();let m=(v=(f=(_=h.target)==null?void 0:_.closest("button"))==null?void 0:f.dataset)==null?void 0:v.act;if(m){if(m==="delete")this._selection.size>1&&this._selection.has(a)?(Array.from(this._selection).forEach(k=>k.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(a.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(m==="duplicate"||m==="copy"){let x=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];for(let k of x){let O=this._extractCardConfig(k.firstElementChild)||{},T=await this._createCard(O),M=this._makeWrapper(T);M.style.width=k.style.width,M.style.height=k.style.height;let I=(parseFloat(k.getAttribute("data-x"))||0)+this.gridSize,A=(parseFloat(k.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(M,I,A),M.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(M);try{this._rebuildOnce(M.firstElementChild)}catch{}this._initCardInteract(M)}this._resizeContainer(),this._queueSave("duplicate")}else if(m==="front")this._adjustZ(a,1);else if(m==="back")this._adjustZ(a,-1);else if(m==="edit"){let x=this._extractCardConfig(a.firstElementChild)||{};await this._openSmartPicker("edit",x,async k=>{let O=await this._createCard(k);O.hass=this.hass;try{a.dataset.cfg=JSON.stringify(k)}catch{}a.replaceChild(O,a.firstElementChild);try{this._rebuildOnce(O)}catch{}this._queueSave("edit")})}}});let p=document.createElement("div");p.className="shield";let l=document.createElement("div");l.classList.add("resize-handle"),l.title="Resize",l.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>';try{let h=r._config||r.config;h&&typeof h=="object"&&Object.keys(h).length&&(a.dataset.cfg=JSON.stringify(h),this._hasCardModDeep(h)&&(a.dataset.needsCardMod="true"))}catch{}a.append(r,p,c,l);try{this._rebuildOnce(r)}catch{}return a}_makePlaceholderAt(r=0,a=0,c=100,p=100){let l=document.createElement("div");l.classList.add("card-wrapper","ddc-placeholder"),l.dataset.placeholder="1",this.editMode&&l.classList.add("editing"),this._setCardPosition(l,r,a),l.style.width=`${c}px`,l.style.height=`${p}px`,l.style.zIndex=String(this._highestZ()+1);let h=document.createElement("div");h.className="ddc-placeholder-inner",h.setAttribute("aria-hidden","true");let m=document.createElement("div");return m.className="shield",l.append(h,m),l}_processCardModOnce(){var a;if(this._cardModProcessed)return;this._cardModProcessed=!0,(((a=this.cardContainer)==null?void 0:a.querySelectorAll('[data-needs-card-mod="true"]'))||[]).forEach(c=>{let p=c.firstElementChild;if(!p)return;let l=p._config||p.config;if(l){if(l.type==="custom:mod-card")setTimeout(()=>{if(p.updateComplete)p.updateComplete.then(()=>{p.requestUpdate()});else if(p.setConfig)try{p.setConfig({...l})}catch{}},100);else if(l.card_mod&&p.setConfig)try{p.setConfig({...l})}catch{}}})}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let r=this._makePlaceholderAt(0,0,100,100);this.cardContainer.appendChild(r),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(r=>r.remove())}_ensurePlaceholderIfEmpty(){this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),this._syncEmptyStateUI()}_adjustZ(r,a){let p=parseInt(r.style.zIndex||"1",10)+a;p=Math.max(1,Math.min(9999,p)),r.style.zIndex=String(p),this._queueSave("z-change")}_highestZ(){let r=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>{let c=parseInt(a.style.zIndex||"0",10);c>r&&(r=c)}),r}_setCardPosition(r,a,c){let p=Math.round(a),l=Math.round(c);r.style.transform=`translate3d(${p}px, ${l}px, 0)`,r.setAttribute("data-x",String(p)),r.setAttribute("data-y",String(l)),r.setAttribute("data-x-raw",String(p)),r.setAttribute("data-y-raw",String(l))}_resizeContainer(){let r=this.cardContainer;if(!r||this._isContainerFixed())return;let a=Array.from(r.querySelectorAll(".card-wrapper")),c=0,p=0;a.forEach(l=>{let h=l.getBoundingClientRect(),m=r.getBoundingClientRect(),_=h.left-m.left+h.width,f=h.top-m.top+h.height;c=Math.max(c,_),p=Math.max(p,f)}),r.style.width=`${Math.ceil(c/this.gridSize)*this.gridSize||100}px`,r.style.height=`${Math.ceil(p/this.gridSize)*this.gridSize||100}px`}_pushCardsOutOfTheWay(r,a,c,p,l){if(!this.__collisionOriginals)return;let h=new Set(r.map(A=>A.el)),m=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(A=>!A.dataset.placeholder),_=this._isContainerFixed(),{w:f,h:v}=this._getContainerSize();for(let A of m){if(h.has(A))continue;let Y=this.__collisionOriginals.get(A);if(Y){A.setAttribute("data-x-raw",String(Y.x)),A.setAttribute("data-y-raw",String(Y.y));let N=p?Math.round(Y.x/l)*l:Y.x,S=p?Math.round(Y.y/l)*l:Y.y;this._setCardPosition(A,N,S)}}let x=r.map(A=>({x:A.snapX,y:A.snapY,w:A.w,h:A.h})),k=new Map,O=new Map;for(let A of m){let Y=parseFloat(A.style.width)||A.getBoundingClientRect().width,N=parseFloat(A.style.height)||A.getBoundingClientRect().height;O.set(A,{w:Y,h:N})}let T=a>0?1:a<0?-1:0,M=c>0?1:c<0?-1:0,I=Math.abs(a)>=Math.abs(c);for(let A of m){if(h.has(A))continue;let Y=this.__collisionOriginals.get(A);if(!Y)continue;let{x:N,y:S}=Y,{w:K,h:D}=O.get(A),H=!1;for(let j of x)if(this._rectsOverlap({x:j.x,y:j.y,w:j.w,h:j.h},{x:N,y:S,w:K,h:D})){H=!0,I&&T!==0?N=T>0?j.x+j.w:j.x-K:!I&&M!==0?S=M>0?j.y+j.h:j.y-D:N=j.x+j.w;break}if(H){let j=0,$=I?T!==0?T*l:l:0,B=I?0:M!==0?M*l:l;for(;j<100;){let z={x:N,y:S,w:K,h:D},U=!1;for(let V of x)if(this._rectsOverlap(z,V)){U=!0;break}if(!U){for(let[,V]of k)if(this._rectsOverlap(z,V)){U=!0;break}}if(!U&&_&&(N<0||S<0||N+K>f||S+D>v)&&(U=!0),!U)break;N+=$,S+=B,j++}_&&(N=Math.max(0,Math.min(N,Math.max(0,f-K))),S=Math.max(0,Math.min(S,Math.max(0,v-D))))}k.set(A,{x:N,y:S,w:K,h:D}),x.push({x:N,y:S,w:K,h:D})}for(let[A,Y]of k){A.setAttribute("data-x-raw",String(Y.x)),A.setAttribute("data-y-raw",String(Y.y));let N=p?Math.round(Y.x/l)*l:Y.x,S=p?Math.round(Y.y/l)*l:Y.y;this._setCardPosition(A,N,S)}}_rectFor(r,a=null,c=null,p=null,l=null){let h=a!=null?a:parseFloat(r.getAttribute("data-x"))||0,m=c!=null?c:parseFloat(r.getAttribute("data-y"))||0,_=p!=null?p:parseFloat(r.style.width)||r.getBoundingClientRect().width||0,f=l!=null?l:parseFloat(r.style.height)||r.getBoundingClientRect().height||0;return{x:h,y:m,w:_,h:f,el:r}}_rectsOverlap(r,a,c=.5){return!(r.x+r.w<=a.x+c||a.x+a.w<=r.x+c||r.y+r.h<=a.y+c||a.y+a.h<=r.y+c)}_anyCollisionFor(r,a){let c=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(l=>!a.has(l)&&!l.dataset.placeholder);if(!c.length)return!1;let p=c.map(l=>this._rectFor(l));for(let l of r)for(let h of p)if(this._rectsOverlap(l,h))return!0;return!1}_extractCardConfig(r){var c;if(!r)return{};let a=r._config||r.config;if(a&&typeof a=="object"&&Object.keys(a).length)return a;try{let p=r.closest?r.closest(".card-wrapper"):null,l=(c=p==null?void 0:p.dataset)==null?void 0:c.cfg;if(l){let h=JSON.parse(l);if(h&&typeof h=="object")return h}}catch{}return{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(r,a){try{console.info("[ddc:editor] Requesting editor element",{type:r,cfg:a})}catch{}let c=await this._helpersPromise||await window.loadCardHelpers();try{typeof r=="string"&&r&&!r.startsWith("custom:")&&r!=="custom_card"&&await this._ensureCardModuleLoaded(r,a)}catch{}let p=async()=>{try{if(c.getCardElementClass)return await c.getCardElementClass(r);let f;if(a&&typeof a=="object")f={type:r,...a};else{let x;try{x=await this._getStubConfigForType(r)}catch{}f=x&&typeof x=="object"?{...x}:{type:r}}let v=c.createCardElement(f);return(v==null?void 0:v.constructor)||null}catch{return null}};try{let f=await p();if(f&&typeof f.getConfigElement=="function"){let v=await f.getConfigElement();if(v){try{console.info("[ddc:editor] Found static class editor",{type:r})}catch{}return v}}}catch{}if(typeof r=="string"&&(r.startsWith("custom:")||r==="custom_card"||r==="entity"))try{let f;try{f=await this._getStubConfigForType(r)}catch{}let v=f&&typeof f=="object"?{...f}:{type:r},x=c.createCardElement(v);if(x.hass=this.hass,typeof x.getConfigElement=="function"){let k=await x.getConfigElement();if(k){try{console.info("[ddc:editor] Found instance-level editor",{type:r})}catch{}return k}}}catch{}let l=String(r).replace(/^custom:/,""),m=(Array.isArray(window.customCards)?window.customCards:[]).find(f=>(f==null?void 0:f.type)===l||(f==null?void 0:f.type)===r||(f==null?void 0:f.type)===`custom:${l}`),_=[];m!=null&&m.editor&&_.push(m.editor),_.push(`${l}-editor`,`${l}-config-editor`),l&&typeof l=="string"&&_.push(`hui-${l}-card-editor`);for(let f of _)if(!(!f||typeof f!="string"))for(let v of[0,100,300,700,1500,3e3])try{if(customElements.get(f)||await Promise.race([customElements.whenDefined(f),new Promise(x=>setTimeout(x,v))]),customElements.get(f)){try{console.info("[ddc:editor] Found editor by tag",{type:r,tag:f})}catch{}return document.createElement(f)}}catch{}return null}async _ensureCardModuleLoaded(r,a){try{let c=await this._helpersPromise||await window.loadCardHelpers(),p;if(a&&typeof a=="object")p={type:r,...a};else{let m;try{m=await this._getStubConfigForType(r)}catch{}p=m&&typeof m=="object"?{...m}:{type:r}}let l=c.createCardElement(p);l.hass=this.hass;let h=document.createElement("div");h.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;",h.appendChild(l),document.body.appendChild(h),await new Promise(m=>requestAnimationFrame(m)),h.remove();try{console.info("[ddc:editor] Warmed card module",{type:r})}catch{}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let r=document.createElement("style");r.setAttribute("data-ddc-overlay-fix",""),r.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(r)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(a=>{var c;return{type:(c=a==null?void 0:a.type)!=null&&c.startsWith("custom:")?a.type:`custom:${a==null?void 0:a.type}`,name:(a==null?void 0:a.name)||(a==null?void 0:a.type)||"Custom card",icon:"mdi:puzzle-outline",description:(a==null?void 0:a.description)||"",editorTag:(a==null?void 0:a.editor)||null}}).filter(a=>typeof a.type=="string"&&a.type.startsWith("custom:"))}_schemaForType(r){let a=p=>p,c=[];return{entities:a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities"}]}),entity:a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity"}]}),sensor:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities (multiselect)"}]}),"picture-glance":a({fields:[{key:"entities",type:"entities",multi:!0,domains:c,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:a({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:a({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity"}]}),button:a({fields:[{key:"entity",type:"entity",multi:!1,domains:c,label:"Entity (optional)"}]}),iframe:a({fields:[{key:"url",type:"text",label:"URL"}]}),area:a({fields:[{key:"area",type:"text",label:"Area ID"}]})}[r]||{fields:[]}}_shapeBySchema(r,a={}){let c=this._schemaForType(r)||{fields:[]},p={...a,type:r};for(let l of c.fields){let h=p[l.key];if(l.type==="entities"){let _=(Array.isArray(h)?h:h!=null&&h!==""?[h]:[]).filter(Boolean);_.length?p[l.key]=_:delete p[l.key]}else if(l.type==="entity")Array.isArray(h)&&(h=h[0]),h==null||h===""?delete p[l.key]:p[l.key]=String(h);else if(l.type==="number")if(h==null||h==="")delete p[l.key];else{let m=Number(h);Number.isFinite(m)?p[l.key]=m:delete p[l.key]}else(l.type==="select"||l.type==="text"||l.type==="textarea")&&(h==null||h===""?delete p[l.key]:p[l.key]=h)}return p}_statesList(r){var p;let a=Object.keys(((p=this.hass)==null?void 0:p.states)||{});if(!r||!r.length)return a;if(!this.__domainIndex||this.__domainIndex._gen!==a.length){let l={};for(let h of a){let m=h.split(".")[0];(l[m]||(l[m]=[])).push(h)}this.__domainIndex={_gen:a.length,map:l}}let c=[];for(let l of r)this.__domainIndex.map[l]&&c.push(...this.__domainIndex.map[l]);return c}_isNumericEntity(r){var p,l;let a=(l=(p=this.hass)==null?void 0:p.states)==null?void 0:l[r];if(!a)return!1;let c=Number(a.state);return Number.isFinite(c)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(r){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(r)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(r){try{let a=this._getRecent().filter(c=>c!==r);a.unshift(r),a.length>10&&(a.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(a))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let r=document.createElement("link");r.rel="stylesheet",r.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",r.setAttribute("data-cm-core",""),document.head.appendChild(r)}await new Promise(r=>{if(window.CodeMirror)return r();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",a.onload=r,document.head.appendChild(a)}),await new Promise(r=>{var c,p;if((p=(c=window.CodeMirror)==null?void 0:c.mimeModes)!=null&&p.yaml)return r();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",a.onload=r,document.head.appendChild(a)}),this.__cmReady=!0}}async _mountYamlEditor(r,a,c,p){let l=_=>window.jsyaml?window.jsyaml.dump(_):JSON.stringify(_,null,2),h=_=>window.jsyaml?window.jsyaml.load(_):JSON.parse(_);r.innerHTML="";let m=l(a);if(customElements.get("ha-code-editor")){let _=document.createElement("ha-code-editor");_.mode="yaml",_.hass=this.hass,_.value=m,_.style.display="block",_.style.height="260px",r.appendChild(_);let f=!1;return _.addEventListener("value-changed",v=>{var k,O,T;if(f)return;let x=(T=(O=(k=v.detail)==null?void 0:k.value)!=null?O:_.value)!=null?T:"";try{c(h(x))}catch(M){p==null||p(M)}}),{setValue:v=>{var k;let x=l(v);((k=_.value)!=null?k:"")!==x&&(f=!0,_.value=x,f=!1)}}}try{await this._ensureCodeMirror();let _=window.CodeMirror(r,{value:m,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),f=!1;return _.on("change",()=>{if(f)return;let v=_.getValue();try{c(h(v))}catch(x){p==null||p(x)}}),{setValue:v=>{let x=l(v);_.getValue()!==x&&(f=!0,_.setValue(x),f=!1)}}}catch{let _=document.createElement("textarea");return _.style.width="100%",_.style.height="260px",_.value=m,_.addEventListener("input",()=>{try{c(h(_.value))}catch(f){p==null||p(f)}}),r.appendChild(_),{setValue:f=>{let v=l(f);_.value!==v&&(_.value=v)}}}}_createVirtualList({container:r,items:a,rowHeight:c=36,renderRow:p}){r.style.position="relative",r.style.overflow="auto";let l=document.createElement("div");l.style.height=`${a.length*c}px`,r.innerHTML="",r.appendChild(l);let h=new Map,m=()=>{let _=r.scrollTop,f=r.clientHeight,v=Math.max(0,Math.floor(_/c)-6),x=Math.min(a.length-1,Math.ceil((_+f)/c)+6);for(let[k,O]of h)(k<v||k>x)&&(O.remove(),h.delete(k));for(let k=v;k<=x;k++){if(h.has(k))continue;let O=p(a[k],k);O.style.position="absolute",O.style.left="0",O.style.right="0",O.style.top=`${k*c}px`,h.set(k,O),r.appendChild(O)}};return r.addEventListener("scroll",m,{passive:!0}),new ResizeObserver(m).observe(r),m(),{refresh(_){if(_){a=_,l.style.height=`${a.length*c}px`;for(let[,f]of h)f.remove();h.clear()}m()}}}async _openSmartPicker(r="add",a=null,c=null){let p=()=>l.remove(),l=document.createElement("div");l.className="modal",l.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${r==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${r==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${r==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.shadowRoot.appendChild(l);let h=l.querySelector("#leftPane"),m=l.querySelector("#addBtn"),_=l.querySelector("#footAdd"),f=l.querySelector("#cancelBtn"),v=l.querySelector("#footCancel"),x=l.querySelector("#search"),k=l.querySelector("#cardHost"),O=l.querySelector("#editorHost"),T=l.querySelector("#editorSpin"),M=l.querySelector("#quickFill"),I=l.querySelector("#yamlHost"),A=l.querySelector("#yamlErr"),Y=l.querySelector("#yamlSec"),N=l.querySelector("#tabVisual"),S=l.querySelector("#tabYaml"),K=l.querySelector("#err"),D=l.querySelector("#previewSpin"),H=q=>{m.disabled=_.disabled=!q},j=q=>{q?(K.hidden=!1,K.textContent=q):(K.hidden=!0,K.textContent="")},$=this._getFaves(),B=this._getRecent(),z=this._catalog(),U=z.find(q=>q.id==="favorites"),V=z.find(q=>q.id==="recent"),oe=z.flatMap(q=>q.items||[]);U.items=oe.filter(q=>$.has(q.type)),V.items=B.map(q=>oe.find(W=>W.type===q)).filter(Boolean);let fe=this._customCardsFromRegistry();fe.length&&z.push({id:"custom",name:"Custom (installed)",items:fe});let Q=l.querySelector("#quickFillSec");Q&&(Q.style.display="none");let le=l.querySelector("#optionsSec"),Ee=l.querySelector("#yamlSec");le&&(le.style.gridRow="1"),Ee&&(Ee.style.gridRow="2");let Ge=l.querySelector("#optionsSec .hd"),De,Re,ye=()=>{if(!Re)return;let q=Se&&$.has(Se),W=Re.querySelector("ha-icon");W&&W.setAttribute("icon",q?"mdi:star":"mdi:star-outline")},We=q=>{if(De){let W=oe.find(he=>he.type===q),ue=W?W.name:q||"";De.textContent=ue}ye()};if(Ge&&!Ge.querySelector(".sel-info")){let q=Ge.querySelector("span");q&&(q.style.display="none"),De=document.createElement("span"),De.className="sel-info",De.style.flex="1",De.style.fontWeight="bold",De.style.paddingRight="8px",Ge.insertBefore(De,Ge.firstChild),Re=document.createElement("button"),Re.className="icon-btn",Re.setAttribute("title","Favorite"),Object.assign(Re.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--primary-background-color)",padding:"0",marginLeft:"4px",cursor:"pointer"}),Re.innerHTML='<ha-icon icon="mdi:star-outline"></ha-icon>',Ge.appendChild(Re),Re.addEventListener("click",W=>{W.stopPropagation(),Se&&($.has(Se)?$.delete(Se):$.add(Se),this._setFaves($),ye(),bt())})}let Be="visual",Qe=q=>{let W=q==="yaml";N.classList.toggle("active",!W),N.setAttribute("aria-selected",String(!W)),S.classList.toggle("active",W),S.setAttribute("aria-selected",String(W)),O.parentElement.style.display=W?"none":"",Y.style.display=W?"":"none",W&&Y.scrollIntoView({behavior:"smooth",block:"start"}),Be=W?"yaml":"visual"};N.addEventListener("click",async()=>{var q;if(Qe("visual"),!ve)await _t(ie);else try{(q=ve.setConfig)==null||q.call(ve,ie)}catch{}}),S.addEventListener("click",()=>Qe("yaml")),Qe("yaml");let ee=()=>{let q=x.value.trim().toLowerCase();return z.map(W=>({...W,items:(W.items||[]).filter(ue=>!q||ue.name.toLowerCase().includes(q)||ue.type.toLowerCase().includes(q))})).filter(W=>W.items&&W.items.length||W.id==="favorites"||W.id==="recent")},bt=()=>{let q=ee();h.innerHTML="",q.forEach(W=>{let ue=document.createElement("div");ue.style.padding="12px",ue.style.borderBottom="1px solid var(--divider-color)";let he=document.createElement("h4");if(he.textContent=W.name,he.style.margin="0 0 10px 0",he.style.fontSize=".92rem",he.style.opacity=".85",ue.appendChild(he),!W.items.length&&(W.id==="favorites"||W.id==="recent")){let me=document.createElement("div");me.style.opacity=".6",me.style.fontSize=".85rem",me.textContent=W.id==="favorites"?"No favorites yet.":"No recent items yet.",ue.appendChild(me)}else W.items.forEach(me=>{let ke=document.createElement("button");ke.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${me.icon}"></ha-icon><span>${me.name}</span>
            </span>`,Object.assign(ke.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),ke.addEventListener("click",async()=>{ht(ke),await at(me.type)}),ue.appendChild(ke)});h.appendChild(ue)})},ht=q=>{h.querySelectorAll("button").forEach(W=>{W.classList.remove("active"),W.style.background="transparent",W.style.color=""}),q&&(q.classList.add("active"),q.style.background="rgba(3,169,244,.12)",q.style.color="var(--primary-color)")},ie=null,Se=null,ge=null,ve=null,Ie=0,xt=null,ot="",Lt=(q,W)=>{var Te;let ue=this._schemaForType(q);if(M.innerHTML="",!ue.fields.length){M.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let he=Object.keys(((Te=this.hass)==null?void 0:Te.states)||{}),me=document.createElement("div"),ke=(J,be,Oe,Le)=>{let xe=document.createElement("div");Object.assign(xe.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),xe.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${J}</span>`,be.includes(J)&&(xe.style.background="rgba(3,169,244,.12)",xe.style.borderColor="var(--primary-color)",xe.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),xe.addEventListener("click",async()=>{let Ke=be.indexOf(J);Ke>=0?be.splice(Ke,1):be.push(J);let tt=be.includes(J);xe.style.background=tt?"rgba(3,169,244,.12)":"",xe.style.borderColor=tt?"var(--primary-color)":"var(--divider-color)",xe.querySelector("ha-icon").setAttribute("icon",tt?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),ie=this._shapeBySchema(q,{...ie,[Le]:[...be]}),Ne(ie),ge==null||ge.setValue(ie)}),Oe.appendChild(xe)};ue.fields.forEach(J=>{var Le,xe,Ke,tt,kt,Ft,St,Et,zt;let be=document.createElement("div");Object.assign(be.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let Oe=document.createElement("label");if(Oe.textContent=J.label||J.key,Oe.style.minWidth="130px",J.type==="entities"){let pe=document.createElement("div");pe.style.flex="1";let ce=document.createElement("input");Object.assign(ce,{placeholder:"Filter entities\u2026"}),Object.assign(ce.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let _e=document.createElement("div");Object.assign(_e.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let je=J.domains&&J.domains.length?this._statesList(J.domains):he,Ve=Array.isArray(W[J.key])?[...W[J.key]]:W[J.key]?[W[J.key]]:[],Ct=Me=>{let Fe=document.createElement("div");Object.assign(Fe.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let $e=document.createElement("ha-icon");$e.setAttribute("icon","mdi:checkbox-blank-outline"),$e.style.setProperty("--mdc-icon-size","18px");let ft=document.createElement("span");ft.textContent=Me,ft.style.whiteSpace="nowrap",ft.style.overflow="hidden",ft.style.textOverflow="ellipsis",Fe.append($e,ft);let Xt=()=>{let it=Ve.includes(Me);Fe.style.background=it?"rgba(3,169,244,.12)":"",Fe.style.borderColor=it?"var(--primary-color)":"var(--divider-color)",$e.setAttribute("icon",it?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return Xt(),Fe.addEventListener("click",()=>{let it=Ve.indexOf(Me);it>=0?Ve.splice(it,1):Ve.push(Me),ie=this._shapeBySchema(q,{...ie,[J.key]:[...Ve]}),Ne(ie),ge==null||ge.setValue(ie),Xt()}),Fe},At=je;this._createVirtualList({container:_e,items:At,rowHeight:36,renderRow:Ct}),ce.addEventListener("input",()=>{let Me=ce.value.trim().toLowerCase();At=je.filter(Fe=>!Me||Fe.toLowerCase().includes(Me)),this._createVirtualList({container:_e,items:At,rowHeight:36,renderRow:Ct})}),pe.append(ce,_e),be.append(Oe,pe),ie=this._shapeBySchema(q,{...W,[J.key]:Ve})}if(J.type==="entity"){let pe=document.createElement("div");pe.style.flex="1",pe.style.position="relative";let ce=document.createElement("input");ce.setAttribute("list","ddc_entlist_"+J.key),Object.assign(ce.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),ce.placeholder=`Select ${((Le=J.label)==null?void 0:Le.toLowerCase())||"entity"}\u2026`;let _e=document.createElement("ha-icon");_e.setAttribute("icon","mdi:magnify"),Object.assign(_e.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let je=document.createElement("datalist");je.id="ddc_entlist_"+J.key;let Ve=J.domains&&J.domains.length?this._statesList(J.domains):Object.keys(((xe=this.hass)==null?void 0:xe.states)||{});je.innerHTML=Ve.map(Ct=>`<option value="${Ct}">`).join(""),ce.value=Array.isArray(W[J.key])?W[J.key][0]||"":W[J.key]||"",ce.addEventListener("change",async()=>{ie=this._shapeBySchema(q,{...ie,[J.key]:ce.value||void 0}),Ne(ie),ge==null||ge.setValue(ie)}),pe.append(_e,ce,je),be.append(Oe,pe)}if(J.type==="number"){let pe=document.createElement("div");pe.style.flex="1",pe.style.position="relative";let ce=document.createElement("input");ce.type="number",J.step&&(ce.step=J.step),Object.assign(ce.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let _e=document.createElement("ha-icon");_e.setAttribute("icon","mdi:counter"),Object.assign(_e.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),ce.value=(tt=(Ke=W[J.key])!=null?Ke:J.default)!=null?tt:"",ce.addEventListener("input",async()=>{let je=ce.value===""?void 0:Number(ce.value);ie=this._shapeBySchema(q,{...ie,[J.key]:isNaN(je)?void 0:je}),Ne(ie),ge==null||ge.setValue(ie)}),pe.append(_e,ce),be.append(Oe,pe)}if(J.type==="select"){let pe=document.createElement("div");pe.style.flex="1",pe.style.position="relative";let ce=document.createElement("select");Object.assign(ce.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let _e=document.createElement("ha-icon");_e.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(_e.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(J.options||[]).forEach(je=>{let Ve=document.createElement("option");Ve.value=je,ce.appendChild(Ve)}),ce.value=(St=(kt=W[J.key])!=null?kt:J.default)!=null?St:((Ft=J.options)==null?void 0:Ft[0])||"",ce.addEventListener("change",async()=>{ie=this._shapeBySchema(q,{...ie,[J.key]:ce.value}),Ne(ie),ge==null||ge.setValue(ie)}),pe.append(_e,ce),be.append(Oe,pe)}if(J.type==="text"){let pe=document.createElement("div");pe.style.flex="1",pe.style.position="relative";let ce=document.createElement("input");ce.type="text",Object.assign(ce.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let _e=document.createElement("ha-icon");_e.setAttribute("icon","mdi:text"),Object.assign(_e.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),ce.value=(Et=W[J.key])!=null?Et:"",ce.addEventListener("input",async()=>{ie=this._shapeBySchema(q,{...ie,[J.key]:ce.value||void 0}),Ne(ie),ge==null||ge.setValue(ie)}),pe.append(_e,ce),be.append(Oe,pe)}if(J.type==="textarea"){let pe=document.createElement("textarea");Object.assign(pe.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),pe.value=(zt=W[J.key])!=null?zt:"",pe.addEventListener("input",async()=>{ie=this._shapeBySchema(q,{...ie,[J.key]:pe.value||""}),Ne(ie),ge==null||ge.setValue(ie)}),be.append(Oe,pe)}me.appendChild(be)}),M.innerHTML="",M.appendChild(me)},Ne=q=>{let W=JSON.stringify(q||{});W!==ot&&(ot=W,xt&&clearTimeout(xt),xt=setTimeout(async()=>{let ue=++Ie;D.hidden=!1,k.innerHTML="",await kr();try{let he=await this._helpersPromise||await window.loadCardHelpers();if(ue!==Ie)return;let me=he.createCardElement(q);if(me.hass=this.hass,ue!==Ie)return;k.appendChild(me)}catch{}finally{ue===Ie&&(D.hidden=!0)}},150))},_t=async q=>{var me;let W=++Ie;if(T.hidden=!1,O.innerHTML="",await lc(),W!==Ie)return T.hidden=!0,!1;let ue=q.type||Se,he=await this._getEditorElementForType(ue,q);if(!he){await this._ensureCardModuleLoaded(ue,q);for(let ke of[0,120,250,500,900,2e3,4e3])if(ke&&await new Promise(Te=>setTimeout(Te,ke)),he=await this._getEditorElementForType(ue,q),he)break}if(!he){let ke=document.createElement("div");return ke.style.opacity=".7",ke.style.fontSize=".9rem",ke.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",W===Ie&&(O.appendChild(ke),T.hidden=!0),ve=null,H(!0),Be!=="visual"&&Qe("yaml"),!1}try{he.hass=this.hass,he.isConnected||O.appendChild(he),await Promise.resolve();try{he.setConfig(q)}catch{}try{let Te=await this._helpersPromise||await window.loadCardHelpers(),J=Te.getCardElementClass?await Te.getCardElementClass(q.type||Se):null;if(J!=null&&J.getStubConfig){let be=Object.keys(((me=this.hass)==null?void 0:me.states)||{}),Oe=xe=>be.filter(Ke=>Ke.startsWith(xe+".")),Le=await J.getStubConfig(this.hass,be,Oe);Le&&(q=this._shapeBySchema(q.type||Se,{...Le}))}}catch{}await Promise.resolve();try{he.setConfig(q)}catch{}ve&&this.__onEditorChange&&(ve.removeEventListener("config-changed",this.__onEditorChange),ve.removeEventListener("value-changed",this.__onEditorChange));let ke=async Te=>{var Oe,Le,xe;let J=(xe=(Oe=Te.detail)==null?void 0:Oe.config)!=null?xe:(Le=Te.detail)==null?void 0:Le.value;if(!J)return;let be=J.type||Se;Se=be,ie=this._shapeBySchema(be,J),j(""),H(!0),Lt(Se,ie),Ne(ie),ge==null||ge.setValue(ie)};return this.__onEditorChange=ke,he.addEventListener("config-changed",ke),he.addEventListener("value-changed",ke),ve=he,Be!=="yaml"&&Qe("visual"),H(!0),!0}finally{W===Ie&&(T.hidden=!0)}},Wt=async q=>{ge=await this._mountYamlEditor(I,q,async W=>{var ue,he;try{let me=(W==null?void 0:W.type)||Se,ke=this._shapeBySchema(me,W||{}),Te=me!==Se;if(Se=me,ie=ke,A.hidden=!0,A.textContent="",H(!0),Te){if(Lt(Se,ie),ve){try{(ue=ve.setConfig)==null||ue.call(ve,ie)}catch{}Be!=="yaml"&&Qe("visual")}}else{try{(he=ve==null?void 0:ve.setConfig)==null||he.call(ve,ie)}catch{}Ne(ie)}}catch(me){A.hidden=!1,A.textContent=`Invalid config: ${String((me==null?void 0:me.message)||me)}`,H(!1)}},W=>{A.hidden=!1,A.textContent=`Invalid YAML: ${String((W==null?void 0:W.message)||W)}`,H(!1)})},Vt=async q=>{if(this.__stubCache.has(q))return{...this.__stubCache.get(q)};let W=await this._getStubConfigForType(q);return this.__stubCache.set(q,{...W}),{...W}},at=async q=>{A.hidden=!0,A.textContent="",j(""),Se=q;try{typeof We=="function"&&We(q)}catch{}let W=r==="edit"&&a&&a.type===q?{...a}:await Vt(q);ie=this._shapeBySchema(q,W),ve=null,Lt(q,ie),await Wt(ie),await kr(),Ne(ie),Qe("yaml"),H(!0)},wt=async()=>{if(!ie)return;let q=this._shapeBySchema(Se,ie);r==="edit"&&typeof c=="function"?await c(q):(await this._addPickedCardToLayout(q),this._pushRecent((q||{}).type)),p()};f.addEventListener("click",p),v.addEventListener("click",p),m.addEventListener("click",wt),_.addEventListener("click",wt),l.addEventListener("keydown",q=>{q.key==="Escape"&&p(),q.key==="Enter"&&!m.disabled&&wt()});let et=null;x.addEventListener("input",()=>{et&&clearTimeout(et),et=setTimeout(bt,120)}),bt(),await at((()=>{var ue;return(((ue=this._getRecent)==null?void 0:ue.call(this))||[]).find(Boolean)||"entities"})()),H(!0),r==="edit"&&a&&(await at(a.type||"entities"),H(!0))}async _getStubConfigForType(r){var f;let a=await this._helpersPromise||await window.loadCardHelpers(),c=null;if(r==="custom_card")return{type:"custom_card"};try{a.getCardElementClass&&(c=await a.getCardElementClass(r))}catch{}let p=Object.keys(((f=this.hass)==null?void 0:f.states)||{}),l=v=>p.filter(x=>x.startsWith(v+"."));if(c!=null&&c.getStubConfig)try{return await c.getStubConfig(this.hass,p,l)}catch{}let h={type:r},m=p[0],_=l("sensor")[0]||m;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast","map"].includes(r)){let v={sensor:_,gauge:l("sensor").find(this._isNumericEntity.bind(this))||_,"media-control":l("media_player")[0]||m,light:l("light")[0]||m,thermostat:l("climate")[0]||m,"alarm-panel":l("alarm_control_panel")[0]||m,"weather-forecast":l("weather")[0]||m,map:l("device_tracker")[0]||l("person")[0]||m}[r]||_||m;["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity"].includes(r)?h.entity=v:r==="weather-forecast"?(h.entity=v,h.show_current=!0,h.show_forecast=!0,h.forecast_type="daily"):r==="map"&&(h.entities=[v].filter(Boolean),h.theme_mode="auto")}if(["entities","glance","picture-glance","history-graph","statistics-graph"].includes(r)){let v=x=>(x!=null&&x.length?p.filter(k=>x.includes(k.split(".")[0])):p).slice(0,3);r==="statistics-graph"?h.entities=v(["sensor","number","input_number"]):h.entities=v()}if(r==="markdown"&&(h.content="Markdown card"),r==="sensor"&&(h.graph="line"),r==="button"&&(h.show_name=!0,h.show_icon=!0),r==="tile"&&(h.features_position="bottom",h.vertical=!1),r==="picture-glance"&&(h.title=h.title||"Glance",h.image=h.image||"https://demo.home-assistant.io/stub_config/kitchen.png"),r==="picture-entity"&&(h.image=h.image||"https://demo.home-assistant.io/stub_config/bedroom.png"),r==="iframe"&&(h.url=h.url||"https://www.home-assistant.io",h.aspect_ratio=h.aspect_ratio||"50%"),r==="alarm-panel"&&(h.states=h.states||["arm_home","arm_away"]),r==="area")try{let v=this.hass&&this.hass.areas?Object.values(this.hass.areas):[];v.length?h.area=v[0].area_id||v[0].name||v[0].id:h.area=m?m.split(".")[0]:"default_area",h.display_type="picture",h.alert_classes=h.alert_classes||["moisture","motion"],h.sensor_classes=h.sensor_classes||["temperature","humidity"],h.features_position="bottom"}catch{}return h}_getNextAvailablePosition(){let r=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),a=new Set,c=this.gridSize;r.forEach(h=>{let m=parseFloat(h.getAttribute("data-x"))||0,_=parseFloat(h.getAttribute("data-y"))||0,f=parseFloat(getComputedStyle(h).width)||100,v=parseFloat(getComputedStyle(h).height)||100,x=Math.floor(m/c),k=Math.floor(_/c),O=Math.floor((m+f)/c),T=Math.floor((_+v)/c);for(let M=x;M<O;M++)for(let I=k;I<T;I++)a.add(`${M}-${I}`)});let p=0,l=0;for(;a.has(`${p}-${l}`);)p+=6,p>60&&(p=0,l+=6);return{x:p*c,y:l*c}}async _addPickedCardToLayout(r){this._hideEmptyPlaceholder();let a=await this._createCard(r),c=this._makeWrapper(a),p=this._getNextAvailablePosition();this._setCardPosition(c,p.x,p.y),c.style.width=`${14*this.gridSize}px`,c.style.height=`${10*this.gridSize}px`,c.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(c);try{this._rebuildOnce(c.firstElementChild)}catch{}this._initCardInteract(c),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI()}_toggleSelection(r,a=null){let c=a==null?!this._selection.has(r):!!a;c?this._selection.add(r):this._selection.delete(r),r.classList.toggle("selected",c)}_clearSelection(){for(let r of this._selection)r.classList.remove("selected");this._selection.clear()}_installSelectionMarquee(){let r=this.cardContainer,a=0,c=0,p=null,l=!1,h=x=>{let k=r.getBoundingClientRect(),O="touches"in x&&x.touches[0]?x.touches[0].clientX:x.clientX,T="touches"in x&&x.touches[0]?x.touches[0].clientY:x.clientY;return{x:O-k.left,y:T-k.top}},m=(x,k)=>{let O=Math.min(x,a),T=Math.max(x,a),M=Math.min(k,c),I=Math.max(k,c);p.style.left=`${O}px`,p.style.top=`${M}px`,p.style.width=`${T-O}px`,p.style.height=`${I-M}px`;let A=p.getBoundingClientRect(),Y=r.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),Y.forEach(N=>{let S=N.getBoundingClientRect();!(S.right<A.left||S.left>A.right||S.bottom<A.top||S.top>A.bottom)&&this._toggleSelection(N,!0)})},_=x=>{if(!this.editMode||x.target.closest(".card-wrapper"))return;l=!0;let k=h(x);a=k.x,c=k.y,p=document.createElement("div"),p.className="marquee",p.style.left=`${a}px`,p.style.top=`${c}px`,r.appendChild(p),x.preventDefault()},f=x=>{!l||!p||m(h(x).x,h(x).y)},v=()=>{l&&(l=!1,p&&p.remove(),p=null)};r.addEventListener("mousedown",_),window.addEventListener("mousemove",f),window.addEventListener("mouseup",v),r.addEventListener("touchstart",x=>{this.editMode&&(x.target.closest(".card-wrapper")||_(x))},{passive:!1}),window.addEventListener("touchmove",x=>{f(x)},{passive:!1}),window.addEventListener("touchend",v),window.addEventListener("touchcancel",v)}async _openDiagnostics(){var m,_;let r=document.createElement("div");r.className="modal";let a=this.storageKey||"(none)",c=this._backendOK&&!!this.storageKey,p=f=>f.slice(-200).map(v=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${v.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${v.kind}]</b>
        <span style="margin-left:6px">${this._safe(v.msg)}</span>
        ${v.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(v.extra,null,2))}</pre>`:""}
      </div>`).join("");r.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95vw);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((m=this._config)==null?void 0:m.storage_key)||"")}</code> \u2192 <code>${this._safe(a)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${c?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((_=this.cardContainer)==null?void 0:_.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${p(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let l=()=>r.remove();r.querySelector("#closeDiag").addEventListener("click",l),this.shadowRoot.appendChild(r);let h=()=>{let f=r.querySelector("#logArea"),v=x=>x.slice(-200).map(k=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${k.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${k.kind}]</b>
          <span style="margin-left:6px">${this._safe(k.msg)}</span>
          ${k.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(k.extra,null,2))}</pre>`:""}
        </div>`).join("");f.innerHTML=v(this._dbgDump()),f.scrollTop=f.scrollHeight};r.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{h()}}),r.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),h()}),r.querySelector("#exportJson").addEventListener("click",()=>{let v=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(T=>{let M=parseFloat(T.getAttribute("data-x"))||0,I=parseFloat(T.getAttribute("data-y"))||0,A=parseFloat(T.style.width)||T.getBoundingClientRect().width,Y=parseFloat(T.style.height)||T.getBoundingClientRect().height,N=parseInt(T.style.zIndex||"1",10);return{card:this._extractCardConfig(T.firstElementChild),position:{x:M,y:I},size:{width:A,height:Y},z:N}}),x={version:2,options:this._exportableOptions(),cards:v},k=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),O=document.createElement("a");O.href=URL.createObjectURL(k),O.download=`ddc_${this.storageKey||"layout"}.json`,O.click(),URL.revokeObjectURL(O.href)}),r.querySelector("#importJson").addEventListener("click",async()=>{let f=document.createElement("input");f.type="file",f.accept="application/json",f.onchange=async()=>{var O,T,M,I,A,Y,N,S,K,D;let v=(O=f.files)==null?void 0:O[0];if(!v)return;let x=await v.text();try{let H=JSON.parse(x);if(this._dbgPush("import","Loaded file",{bytes:x.length}),this.cardContainer.innerHTML="",(T=H.cards)!=null&&T.length)for(let j of H.cards)if(!(j!=null&&j.card)||typeof j.card=="object"&&Object.keys(j.card).length===0){let $=this._makePlaceholderAt(((M=j.position)==null?void 0:M.x)||0,((I=j.position)==null?void 0:I.y)||0,((A=j.size)==null?void 0:A.width)||100,((Y=j.size)==null?void 0:Y.height)||100);this.cardContainer.appendChild($)}else{let $=await this._createCard(j.card),B=this._makeWrapper($);this._setCardPosition(B,((N=j.position)==null?void 0:N.x)||0,((S=j.position)==null?void 0:S.y)||0),B.style.width=`${((K=j.size)==null?void 0:K.width)||140}px`,B.style.height=`${((D=j.size)==null?void 0:D.height)||100}px`,this.cardContainer.appendChild(B);try{this._rebuildOnce(B.firstElementChild)}catch{}this._initCardInteract(B)}else this._showEmptyPlaceholder();this._resizeContainer(),await this._saveLayout(!1)}catch(H){this._dbgPush("import","Parse failed",{error:String(H)})}let k=new Event("ddc-logrefresh");window.dispatchEvent(k)},f.click()}),r.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),h();let f=(this.storageKey||"ddc_test")+"_selftest",v={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(f,v);let x=await this._loadLayoutFromBackend(f);this._dbgPush("test","Round-trip result",{wrote:v,read:x})}catch(x){this._dbgPush("test","Round-trip failed",{error:String(x)})}h()}),h()}_exportableOptions(){var a,c;let r={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(a=this.containerFixedWidth)!=null?a:void 0,container_fixed_height:(c=this.containerFixedHeight)!=null?c:void 0,container_preset:this.containerPreset};return Object.keys(r).forEach(p=>r[p]===void 0&&delete r[p]),r}_applyImportedOptions(r={},a=!0){var c,p,l,h,m;try{(c=this._dbgInit)==null||c.call(this),(p=this._dbgPush)==null||p.call(this,"opts","_applyImportedOptions called",{opts:r,recalc:a,before:{...this._config||{}}}),console.debug("[ddc:opts] _applyImportedOptions",{opts:r,recalc:a})}catch{}if(r&&Object.prototype.hasOwnProperty.call(r,"storage_key")&&this._isInHaEditorPreview())try{let _={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:_},bubbles:!0,composed:!0}))}catch{}this._config={...this._config||{},...r},"storage_key"in r&&(this.storageKey=r.storage_key||void 0),this._syncEditorsStorageKey(),"grid"in r&&(this.gridSize=Number(r.grid)||10),"drag_live_snap"in r&&(this.dragLiveSnap=!!r.drag_live_snap),"auto_save"in r&&(this.autoSave=!!r.auto_save),"auto_save_debounce"in r&&(this.autoSaveDebounce=Number(r.auto_save_debounce)||800),"container_background"in r&&(this.containerBackground=(l=r.container_background)!=null?l:"transparent"),"card_background"in r&&(this.cardBackground=(h=r.card_background)!=null?h:"var(--ha-card-background, var(--card-background-color))"),"debug"in r&&(this.debug=!!r.debug),"disable_overlap"in r&&(this.disableOverlap=!!r.disable_overlap),"container_size_mode"in r&&(this.containerSizeMode=r.container_size_mode||"dynamic"),"container_fixed_width"in r&&(this.containerFixedWidth=Number(r.container_fixed_width)||null),"container_fixed_height"in r&&(this.containerFixedHeight=Number(r.container_fixed_height)||null),"container_preset"in r&&(this.containerPreset=r.container_preset||"fhd"),"container_preset_orientation"in r&&(this.containerPresetOrient=r.container_preset_orientation||"auto"),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),a&&(this._applyContainerSizingFromConfig(!0),this._resizeContainer(),(m=this._updateStoreBadge)==null||m.call(this))}_exportDesign(){let a=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(m=>{let _=parseFloat(m.getAttribute("data-x"))||0,f=parseFloat(m.getAttribute("data-y"))||0,v=parseFloat(m.style.width)||m.getBoundingClientRect().width,x=parseFloat(m.style.height)||m.getBoundingClientRect().height,k=parseInt(m.style.zIndex||"1",10);return{card:this._extractCardConfig(m.firstElementChild),position:{x:_,y:f},size:{width:v,height:x},z:k}}),c={version:2,options:this._exportableOptions(),cards:a},p=`ddc_design_${this.storageKey||"layout"}.json`,l=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(l),h.download=p,h.click(),URL.revokeObjectURL(h.href),this._toast("Design exported.")}_importDesign(){var a,c;try{(a=this._dbgInit)==null||a.call(this),(c=this._dbgPush)==null||c.call(this,"import","Begin import"),console.debug("[ddc:import] Begin import")}catch{}let r=document.createElement("input");r.type="file",r.accept="application/json",r.onchange=async()=>{var h,m,_,f,v,x,k,O,T,M,I,A,Y,N,S,K,D,H,j,$;let p=(h=r.files)==null?void 0:h[0];if(!p)return;let l=await p.text();try{let B=JSON.parse(l);if(B.options){let{storage_key:z,...U}=B.options;this._applyImportedOptions(U,!0)}else typeof B.grid=="number"&&this._applyImportedOptions({grid:B.grid},!0);try{(m=this._dbgInit)==null||m.call(this);let z={...this._config||{}},U=B!=null&&B.options?{...B.options}:typeof B.grid=="number"?{grid:B.grid}:{};if((_=this._dbgPush)==null||_.call(this,"import","Incoming options parsed",{incoming:U}),console.debug("[ddc:import] Incoming options parsed",U),U&&Object.keys(U).length){let{storage_key:V,...oe}=U,fe={...this._config||{},...oe};if(V){fe.storage_key=V,this.storageKey=V;try{(f=this._syncEditorsStorageKey)==null||f.call(this)}catch{}}this._config=fe;let Q={};for(let le of Object.keys(fe))z[le]!==fe[le]&&(Q[le]={was:z[le],now:fe[le]});(v=this._dbgPush)==null||v.call(this,"import","YAML config overwritten from import",{changed:Q}),console.debug("[ddc:import] YAML config overwritten from import",Q);try{let le={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:le},bubbles:!0,composed:!0})),(x=this._dbgPush)==null||x.call(this,"import","Dispatched config-changed after overwrite",{updatedCfg:le}),console.debug("[ddc:import] Dispatched config-changed after overwrite",le)}catch(le){console.warn("[ddc] Failed to dispatch config-changed after import overwrite",le)}}}catch(z){console.warn("[ddc] import logging block failed",z)}if((k=B==null?void 0:B.options)!=null&&k.storage_key){let z=B.options.storage_key;this._config={...this._config||{},storage_key:z},this.storageKey=z,this._syncEditorsStorageKey();try{let U={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:U},bubbles:!0,composed:!0}))}catch{}}try{let z=(O=B.options)!=null?O:typeof B.grid=="number"?{grid:B.grid}:null;if(z){let U=await this._persistOptionsToYaml(z);console.debug("[ddc:import] YAML persist result:",U)}}catch(z){console.warn("[ddc:import] YAML persist failed:",z)}try{let z=this.storageKey||this._config&&this._config.storage_key||null,U=B&&B.options?B.options:typeof(B==null?void 0:B.grid)=="number"?{grid:B.grid}:null;if(U){if((T=B==null?void 0:B.options)!=null&&T.storage_key){this.storageKey=B.options.storage_key,this._config={...this._config||{},storage_key:B.options.storage_key};try{(M=this._syncEditorsStorageKey)==null||M.call(this)}catch{}}let V=await(((I=this._persistOptionsToYaml)==null?void 0:I.call(this,U,{prevKey:z,noDownload:!0,strict:!0}))||!1);console.debug("[ddc:import] YAML persist (file import) result:",V);try{let oe={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:oe},bubbles:!0,composed:!0}))}catch{}}}catch(z){console.warn("[ddc:import] persist block failed",z)}if(this.cardContainer.innerHTML="",(A=B.cards)!=null&&A.length)for(let z of B.cards)if(!(z!=null&&z.card)||typeof z.card=="object"&&Object.keys(z.card).length===0){let U=this._makePlaceholderAt(((Y=z.position)==null?void 0:Y.x)||0,((N=z.position)==null?void 0:N.y)||0,((S=z.size)==null?void 0:S.width)||100,((K=z.size)==null?void 0:K.height)||100);this.cardContainer.appendChild(U)}else{let U=await this._createCard(z.card),V=this._makeWrapper(U);this._setCardPosition(V,((D=z.position)==null?void 0:D.x)||0,((H=z.position)==null?void 0:H.y)||0),V.style.width=`${((j=z.size)==null?void 0:j.width)||140}px`,V.style.height=`${(($=z.size)==null?void 0:$.height)||100}px`,z.z!=null&&(V.style.zIndex=String(z.z)),this.cardContainer.appendChild(V);try{this._rebuildOnce(V.firstElementChild)}catch{}this._initCardInteract(V)}else this._showEmptyPlaceholder();this._resizeContainer(),this._markDirty("import"),this._toast("Design imported \u2014 click Apply to save.")}catch(B){console.error("Import failed",B),this._toast("Import failed \u2014 invalid file.")}},r.click()}_queueSave(r="auto"){this._markDirty(r),this.autoSave&&(this._loading||this.editMode&&(this._dbgPush("autosave","Queued",{reason:r,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce)))}async _saveLayout(r=!0){let c=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(l=>{let h=parseFloat(l.getAttribute("data-x"))||0,m=parseFloat(l.getAttribute("data-y"))||0,_=parseFloat(l.style.width)||l.getBoundingClientRect().width,f=parseFloat(l.style.height)||l.getBoundingClientRect().height,v=parseInt(l.style.zIndex||"1",10);return{card:this._extractCardConfig(l.firstElementChild),position:{x:h,y:m},size:{width:_,height:f},z:v}}),p={version:2,options:this._exportableOptions(),cards:c};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(p))}catch{}if(!this.storageKey){r||this._toast("Saved locally (no storage_key set)."),this.__dirty=!1,this._updateApplyBtn();return}try{await this._saveLayoutToBackend(this.storageKey,p),r||this._toast("Layout saved."),this.__dirty=!1,this._updateApplyBtn()}catch(l){console.error("Backend save failed",l),this._dbgPush("save","Backend save failed",{error:String(l)}),r||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let r=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let a=await this.hass.callApi("get","dragdrop_storage"),c=Math.round(performance.now()-r);this._dbgPush("probe",`OK (${c} ms)`,a),this._backendOK=!!a}catch(a){let c=Math.round(performance.now()-r);this._dbgPush("probe",`FAILED (${c} ms)`,{error:String(a)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(r){let a=`dragdrop_storage/${encodeURIComponent(r)}`,c=performance.now();try{this._dbgPush("load",`GET /api/${a}`);let p=await this.hass.callApi("get",a),l=Math.round(performance.now()-c);return this._dbgPush("load",`OK (${l} ms)`,{bytes:JSON.stringify(p||"").length}),p}catch(p){let l=Math.round(performance.now()-c);return this._dbgPush("load",`FAILED (${l} ms)`,{error:String(p)}),null}}async _saveLayoutToBackend(r,a){let c=`dragdrop_storage/${encodeURIComponent(r)}`,p=JSON.stringify(a).length,l=performance.now();try{this._dbgPush("save",`POST /api/${c}`,{bytes:p});let h=await this.hass.callApi("post",c,a),m=Math.round(performance.now()-l);return this._dbgPush("save",`OK (${m} ms)`,h),h}catch(h){let m=Math.round(performance.now()-l);throw this._dbgPush("save",`FAILED (${m} ms)`,{error:String(h),bytes:p}),h}}_updateStoreBadge(){let r=this.storeBadge;if(!r)return;let a=this._backendOK&&!!this.storageKey;r.textContent=a?"storage: backend":"storage: local",r.style.background=a?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",r.style.borderColor=a?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(r){let a=new Event("hass-notification");a.detail={message:r},window.dispatchEvent(a)}_huiRoot(){var r,a,c,p,l,h;try{let m=document.querySelector("home-assistant"),_=(r=m==null?void 0:m.shadowRoot)==null?void 0:r.querySelector("home-assistant-main"),f=((a=_==null?void 0:_.shadowRoot)==null?void 0:a.querySelector("ha-drawer"))||_,v=((c=f==null?void 0:f.shadowRoot)==null?void 0:c.querySelector("partial-panel-resolver"))||f,x=((p=v==null?void 0:v.shadowRoot)==null?void 0:p.querySelector("ha-panel-lovelace"))||((l=f==null?void 0:f.shadowRoot)==null?void 0:l.querySelector("ha-panel-lovelace"));return((h=x==null?void 0:x.shadowRoot)==null?void 0:h.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",ji);(()=>{try{let e=window.customCards=window.customCards||[];e.some(d=>d.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!0})}catch{}})();(()=>{let e=new WeakSet,d=l=>{try{if(!(l instanceof Element))return!1;let h=l.localName||"";return h?!!(h==="ha-card"||h.endsWith("-card")):!1}catch{return!1}},r=l=>{try{if(!l||e.has(l))return;e.add(l),l.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}},a=l=>{var h,m;try{if(!l)return;l instanceof Element&&d(l)&&r(l);let _=(m=(h=(l instanceof ShadowRoot,l)).querySelectorAll)==null?void 0:m.call(h,"*");if(!_)return;for(let f of _){d(f)&&r(f);let v=f.shadowRoot;if(v)try{a(v)}catch{}}}catch{}},c=l=>{try{if(!l||l.__ddcCardModIntegrated)return;l.__ddcCardModIntegrated=!0;let h=l.shadowRoot||l;a(h);let m=new MutationObserver(_=>{for(let f of _)if(!(!f.addedNodes||!f.addedNodes.length))for(let v of f.addedNodes)(v instanceof Element||v instanceof ShadowRoot)&&a(v)});m.observe(h,{childList:!0,subtree:!0}),l.__ddcCardModIntegratedObserver=m,setTimeout(()=>{try{a(h)}catch{}},250),setTimeout(()=>{try{a(h)}catch{}},1e3)}catch{}},p=()=>{try{document.querySelectorAll("drag-and-drop-card").forEach(c)}catch{}};if(window.customElements&&window.customElements.whenDefined)window.customElements.whenDefined("drag-and-drop-card").then(()=>{p();let l=window.customElements.get("drag-and-drop-card");if(l&&l.prototype){let m=l.prototype.connectedCallback;l.prototype.connectedCallback=function(){try{m&&m.call(this)}finally{c(this)}}}new MutationObserver(()=>p()).observe(document.documentElement,{childList:!0,subtree:!0})});else{let l=setInterval(p,1e3);setTimeout(()=>clearInterval(l),1e4)}})();(function(){let d=customElements.get("drag-and-drop-card");if(!d)return;function r(){var f,v;try{let x=0,k=this;for(;k&&x++<20;){let M=(f=k.getRootNode)==null?void 0:f.call(k),I=M==null?void 0:M.host;if((I==null?void 0:I.tagName)==="HUI-ROOT")return I.lovelace;k=I||k.parentElement}let O=new Set,T=[document];for(;T.length;){let M=T.shift();if(!(!M||O.has(M))){if(O.add(M),((v=M.host)==null?void 0:v.tagName)==="HUI-ROOT")return M.host.lovelace;if(M.tagName==="HUI-ROOT")return M.lovelace;if(M.shadowRoot&&T.push(M.shadowRoot),M.children)for(let I of M.children)T.push(I)}}}catch{}}function a(f){let v=[],x=(O,T,M)=>{(M==null?void 0:M.type)==="custom:drag-and-drop-card"&&v.push({view:O,path:[...T],card:M})},k=(O,T,M)=>{if(O){if(Array.isArray(O)){O.forEach((I,A)=>k(I,T,M.concat(A)));return}if(typeof O=="object"){"type"in O&&x(T,M,O);for(let[I,A]of Object.entries(O))I==="views"&&Array.isArray(A)?A.forEach((Y,N)=>k(Y,N,["views",N])):(Array.isArray(A)||A&&typeof A=="object")&&k(A,T,M.concat(I))}}};return k(f,-1,[]),v}async function c(f,{prevKey:v,noDownload:x,strict:k=!0}={}){var K,D;let O=((K=this._getLovelace)==null?void 0:K.call(this))||(function(){var H,j;try{let $=0,B=this;for(;B&&$++<20;){let V=(H=B.getRootNode)==null?void 0:H.call(B),oe=V==null?void 0:V.host;if((oe==null?void 0:oe.tagName)==="HUI-ROOT")return oe.lovelace;B=oe||B.parentElement}let z=new Set,U=[document];for(;U.length;){let V=U.shift();if(!(!V||z.has(V))){if(z.add(V),((j=V.host)==null?void 0:j.tagName)==="HUI-ROOT")return V.host.lovelace;if(V.tagName==="HUI-ROOT")return V.lovelace;if(V.shadowRoot&&U.push(V.shadowRoot),V.children)for(let oe of V.children)U.push(oe)}}}catch{}}).call(this);if(!O||typeof O.saveConfig!="function")return!1;let T=Array.from(new Set([f&&f.storage_key,this.storageKey,this._config&&this._config.storage_key,v].filter(Boolean))),M=JSON.parse(JSON.stringify(O.config)),I=(this._scanDdcCards||(function(j){let $=[],B=(U,V,oe)=>{(oe==null?void 0:oe.type)==="custom:drag-and-drop-card"&&$.push({view:U,path:[...V],card:oe})},z=(U,V,oe)=>{if(U){if(Array.isArray(U)){U.forEach((fe,Q)=>z(fe,V,oe.concat(Q)));return}if(typeof U=="object"){"type"in U&&B(V,oe,U);for(let[fe,Q]of Object.entries(U))fe==="views"&&Array.isArray(Q)?Q.forEach((le,Ee)=>z(le,Ee,["views",Ee])):(Array.isArray(Q)||Q&&typeof Q=="object")&&z(Q,V,oe.concat(fe))}}};return z(j,-1,[]),$}))(M);console.debug("[ddc:import] persist: found DDC cards",I.map(H=>({view:H.view,path:H.path.join("."),storage_key:H.card.storage_key||null})));let A=I.filter(H=>H.card&&T.includes(H.card.storage_key));if(!A.length)try{let H=(D=O.current_view)!=null?D:0,j=this.closest&&this.closest("hui-view")||this.getRootNode&&this.getRootNode().querySelector&&this.getRootNode().querySelector("hui-view")||null;if(j){let $=Array.from(j.querySelectorAll("drag-and-drop-card")),B=$.indexOf(this),z=I.filter(U=>U.view===H);B>=0&&z.length===$.length&&z[B]&&(A=[z[B]],console.debug("[ddc:import] persist: using DOM-index fallback",{index:B,view:H}))}}catch(H){console.debug("[ddc:import] persist: DOM-index fallback failed",H)}if(!A.length){if(k)return console.debug("[ddc:import] persist: no match for storage_key(s)",{keysToTry:T}),!1;if(I.length===1)A=I.slice(0,1);else return console.debug("[ddc:import] persist: ambiguous without key; refusing to patch multiple."),!1}if(A.length>1)return console.warn("[ddc:import] persist: multiple cards match; aborting to avoid cross-updates.",{keysToTry:T,matches:A.map(H=>({view:H.view,path:H.path.join(".")}))}),!1;let Y=A,N=Y[0].card&&Y[0].card.storage_key||T[0]||null,S={type:"custom:drag-and-drop-card",...f};N&&!S.storage_key&&(S.storage_key=N);try{let H=new Date().toISOString().replace(/[:.]/g,"-"),j=Y.map(U=>{let V=O.config;for(let oe of U.path)V=V[oe];return{view:U.view,path:U.path,storage_key:V&&V.storage_key||null,before:V,patch:S}}),$={kind:"ddc-import-backup",created_at:H,count:j.length,items:j},B=`ddc.backup.${H}`;localStorage.setItem(B,JSON.stringify($));let z=Object.keys(localStorage).filter(U=>U.startsWith("ddc.backup.")).sort().reverse();for(let U of z.slice(10))localStorage.removeItem(U)}catch{}for(let H of Y){let j=M;for(let $ of H.path)j=j[$];Object.assign(j,S)}await O.saveConfig(M);try{let H="ddc.recent.keys",j=JSON.parse(localStorage.getItem(H)||"[]");N&&!j.includes(N)&&(j.unshift(N),localStorage.setItem(H,JSON.stringify(j.slice(0,20))))}catch{}return!0}async function p(){var f;try{if((f=this==null?void 0:this.hass)!=null&&f.callApi){let v=await this.hass.callApi("get","dragdrop_storage");if(Array.isArray(v))return v;if(Array.isArray(v==null?void 0:v.keys))return v.keys}}catch{}try{let x=await(await fetch("/api/dragdrop_storage",{cache:"no-store"})).json();if(Array.isArray(x))return x;if(Array.isArray(x==null?void 0:x.keys))return x.keys}catch{}return[]}async function l(f){var v;try{if((v=this==null?void 0:this.hass)!=null&&v.callApi){let x=await this.hass.callApi("get",`dragdrop_storage/${encodeURIComponent(f)}`);if(x&&(x.options||x.cards||x.design||x.payload))return x.design||x.payload||x}}catch{}try{let k=await(await fetch(`/api/dragdrop_storage/${encodeURIComponent(f)}`,{cache:"no-store"})).json();if(k&&(k.options||k.cards||k.design||k.payload))return k.design||k.payload||k}catch{}return null}async function h(f,{source:v="switcher",newKey:x=null}={}){var T,M,I,A,Y,N,S,K,D,H,j,$,B,z,U,V,oe,fe,Q,le,Ee,Ge,De,Re;if(!f||typeof f!="object")throw new Error("Invalid design payload");let k=this.storageKey||((T=this._config)==null?void 0:T.storage_key)||null;if(f.options){let{storage_key:ye,...We}=f.options;(M=this._applyImportedOptions)==null||M.call(this,We,!0)}else typeof f.grid=="number"&&((I=this._applyImportedOptions)==null||I.call(this,{grid:f.grid},!0));let O=x||((A=f==null?void 0:f.options)==null?void 0:A.storage_key)||k;if(O){this.storageKey=O,this._config={...this._config||{},storage_key:O};try{(Y=this._syncEditorsStorageKey)==null||Y.call(this)}catch{}}try{let ye=(N=f.options)!=null?N:typeof f.grid=="number"?{grid:f.grid}:{};await((S=this._persistOptionsToYaml)==null?void 0:S.call(this,{...ye,storage_key:O},{prevKey:k,noDownload:!0,strict:!0}))}catch{}try{if(this.cardContainer.innerHTML="",Array.isArray(f.cards)&&f.cards.length)for(let ye of f.cards)if(!(ye!=null&&ye.card)||typeof ye.card=="object"&&Object.keys(ye.card).length===0){let We=($=this._makePlaceholderAt)==null?void 0:$.call(this,((K=ye.position)==null?void 0:K.x)||0,((D=ye.position)==null?void 0:D.y)||0,((H=ye.size)==null?void 0:H.width)||100,((j=ye.size)==null?void 0:j.height)||100);We&&this.cardContainer.appendChild(We)}else{let We=await this._createCard(ye.card),Be=this._makeWrapper(We);(U=this._setCardPosition)==null||U.call(this,Be,((B=ye.position)==null?void 0:B.x)||0,((z=ye.position)==null?void 0:z.y)||0),Be.style.width=`${((V=ye.size)==null?void 0:V.width)||140}px`,Be.style.height=`${((oe=ye.size)==null?void 0:oe.height)||100}px`,ye.z!=null&&(Be.style.zIndex=String(ye.z)),this.cardContainer.appendChild(Be);try{(fe=this._rebuildOnce)==null||fe.call(this,Be.firstElementChild)}catch{}(Q=this._initCardInteract)==null||Q.call(this,Be)}else(le=this._showEmptyPlaceholder)==null||le.call(this);(Ee=this._resizeContainer)==null||Ee.call(this),(Ge=this._markDirty)==null||Ge.call(this,"import"),(De=this._toast)==null||De.call(this,v==="switcher"?`Loaded layout "${O}"`:"Design imported")}catch(ye){console.error("[ddc:apply] rebuild failed",ye),(Re=this._toast)==null||Re.call(this,"Import failed during rebuild.")}}function m(){var f,v;try{let x=this.shadowRoot||this.renderRoot||this,k=x.querySelector(".ddc-switcher-inline");if(!k)return;let O=((f=this._getLovelace)==null?void 0:f.call(this))||r.call(this),T=!1;try{let M=(v=x.getRootNode&&x.getRootNode())==null?void 0:v.host;T=!!(O&&(O.editMode===!0||M&&M.editMode===!0))}catch{}k.style.display=T?"inline-flex":"none"}catch{}}function _(){try{if(this._ddcSwitcherInstalled)return;let v=(this.shadowRoot||this.renderRoot||this).querySelector(".toolbar");if(!v)return;let x=document.createElement("div");x.className="ddc-switcher-inline",Object.assign(x.style,{display:"inline-flex",gap:"6px",alignItems:"center",marginLeft:"auto"});let k=document.createElement("span");k.textContent="Layout:",k.style.fontSize="12px",k.style.opacity="0.8";let O=document.createElement("select");Object.assign(O.style,{fontSize:"12px",padding:"4px 6px",borderRadius:"8px",border:"1px solid var(--divider-color, #999)",background:"var(--card-background-color, #fff)"}),O.id="ddcKeySelect";let T=document.createElement("button");T.className="btn secondary",T.type="button",T.style.padding="6px 10px",T.innerHTML='<ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh</span>',x.appendChild(k),x.appendChild(O),x.appendChild(T),v.appendChild(x),this._ddcSwitcherInstalled=!0;let M=async()=>{let I=this.storageKey||this._config&&this._config.storage_key||"",A=await p.call(this),Y=(()=>{var B,z;let $=new Set;try{let U=Object.keys(localStorage).filter(V=>V.startsWith("ddc.backup.")).sort().reverse();for(let V of U){let oe=JSON.parse(localStorage.getItem(V)||"null");if(oe&&oe.items)for(let fe of oe.items){let Q=((B=fe==null?void 0:fe.before)==null?void 0:B.storage_key)||((z=fe==null?void 0:fe.patch)==null?void 0:z.storage_key);Q&&$.add(Q)}}}catch{}return Array.from($)})(),N=(()=>{try{return JSON.parse(localStorage.getItem("ddc.recent.keys")||"[]")}catch{return[]}})(),S=$=>Array.from(new Set($.filter(Boolean))),K=S(A),D=S(Y),H=S(N);if(O.innerHTML="",I&&!K.includes(I)&&!D.includes(I)&&!H.includes(I)){let $=document.createElement("option");$.value=I,$.textContent=`${I} (current)`,O.appendChild($)}let j=($,B)=>{if(!B.length)return;let z=document.createElement("optgroup");z.label=$,B.forEach(U=>{let V=document.createElement("option");V.value=U,V.textContent=U,U===I&&(V.selected=!0),z.appendChild(V)}),O.appendChild(z)};if(j("Server",K),j("Backups",D),j("Recent",H),!O.children.length){let $=document.createElement("option");$.value="",$.textContent="\u2014 none \u2014",$.selected=!0,O.appendChild($)}m.call(this)};M(),T.addEventListener("click",M),O.addEventListener("change",async I=>{var Y,N;let A=I.target.value;if(!this._ddcLoadingFromKey){this._ddcLoadingFromKey=!0;try{let S=await l.call(this,A);if(!S){(Y=this._toast)==null||Y.call(this,`No layout found for "${A}"`);return}await h.call(this,S,{source:"switcher",newKey:A})}catch(S){console.warn("[ddc:switcher] load/apply failed",S),(N=this._toast)==null||N.call(this,"Failed to load layout.")}finally{this._ddcLoadingFromKey=!1}}}),this._ddcVisTimer&&clearInterval(this._ddcVisTimer),this._ddcVisTimer=setInterval(()=>m.call(this),800),m.call(this)}catch{}}d.prototype._getLovelace||(d.prototype._getLovelace=r),d.prototype._scanDdcCards||(d.prototype._scanDdcCards=a),d.prototype._persistOptionsToYaml=c,d.prototype._applyDesignObject||(d.prototype._applyDesignObject=h);try{let f=Object.getOwnPropertyDescriptor(d.prototype,"hass");if(f&&(f.set||f.get)){let v=f.set;Object.defineProperty(d.prototype,"hass",{configurable:!0,enumerable:!0,set(x){v&&v.call(this,x);try{_.call(this)}catch{}},get:f.get||function(){return this._hass}})}else if(typeof d.prototype.setHass=="function"){let v=d.prototype.setHass;d.prototype.setHass=function(x){v&&v.call(this,x);try{_.call(this)}catch{}}}else{let v=d.prototype.updated||d.prototype.firstUpdated;d.prototype.updated=function(...x){v&&v.apply(this,x);try{_.call(this)}catch{}}}}catch{}})();(function(){let d=customElements.get("drag-and-drop-card");if(!d||!d.prototype){console.warn("[ddc:switcher] element not found");return}function r(m,_){try{let f=new Date().toISOString().replace(/[:.]/g,"-"),v=`ddc.backup.${f}`,x={kind:m,created_at:f,..._};localStorage.setItem(v,JSON.stringify(x));let k=Object.keys(localStorage).filter(O=>O.startsWith("ddc.backup.")).sort().reverse();for(let O of k.slice(10))localStorage.removeItem(O);return console.debug("[ddc:switcher] backup saved",v),{name:v,data:x}}catch(f){return console.warn("[ddc:switcher] backup failed",f),null}}async function a(){var _;let m=f=>{if(!f)return[];if(Array.isArray(f))return f;if(Array.isArray(f.keys))return f.keys;if(Array.isArray(f.dashboards))return f.dashboards;if(Array.isArray(f.items))return f.items.map(v=>v.key||v.id||v.name).filter(Boolean);if(Array.isArray(f.entries))return f.entries.map(v=>v.key||v.id||v.name).filter(Boolean);for(let v of Object.values(f))if(Array.isArray(v)&&v.every(x=>typeof x=="string"))return v;return[]};try{if((_=this==null?void 0:this.hass)!=null&&_.callApi){let f=await this.hass.callApi("get","dragdrop_storage"),v=m(f);if(v.length)return v}}catch{}try{let v=await(await fetch("/api/dragdrop_storage",{cache:"no-store"})).json(),x=m(v);if(x.length)return x}catch{}return[]}async function c(m){var f;let _=v=>{if(!v)return null;if(v.options||v.cards)return v;if(typeof v.design=="object")return v.design;if(typeof v.payload=="object")return v.payload;try{if(typeof v=="string")return JSON.parse(v)}catch{}return null};try{if((f=this==null?void 0:this.hass)!=null&&f.callApi){let v=await this.hass.callApi("get",`dragdrop_storage/${encodeURIComponent(m)}`),x=_(v);if(x)return x}}catch{}try{let x=await(await fetch(`/api/dragdrop_storage/${encodeURIComponent(m)}`,{cache:"no-store"})).json(),k=_(x);if(k)return k}catch{}return null}async function p(m,_){var v,x,k,O,T,M,I,A,Y,N,S,K,D,H,j,$,B,z,U,V,oe,fe;if(!m)return!1;let f=this.storageKey||this._config&&this._config.storage_key||null;if(r("ddc-switcher-backup",{storage_key_before:f||null,yaml_before:{...this._config||{}},to_persist:(v=m.options)!=null?v:typeof m.grid=="number"?{grid:m.grid}:null,new_key:_||null}),m.options){let{storage_key:Q,...le}=m.options;(x=this._applyImportedOptions)==null||x.call(this,le,!0)}else typeof m.grid=="number"&&((k=this._applyImportedOptions)==null||k.call(this,{grid:m.grid},!0));if(_){this.storageKey=_,this._config={...this._config||{},storage_key:_};try{(O=this._syncEditorsStorageKey)==null||O.call(this)}catch{}}try{let Q=(T=m.options)!=null?T:typeof m.grid=="number"?{grid:m.grid}:null;if(Q&&typeof this._persistOptionsToYaml=="function"){let le=await this._persistOptionsToYaml(Q,{prevKey:f});console.debug("[ddc:switcher] YAML persist from switcher:",le)}}catch(Q){console.warn("[ddc:switcher] persist failed",Q)}try{if(this.cardContainer.innerHTML="",Array.isArray(m.cards)&&m.cards.length)for(let Q of m.cards)if(!(Q!=null&&Q.card)||typeof Q.card=="object"&&Object.keys(Q.card).length===0){let le=(N=this._makePlaceholderAt)==null?void 0:N.call(this,((M=Q.position)==null?void 0:M.x)||0,((I=Q.position)==null?void 0:I.y)||0,((A=Q.size)==null?void 0:A.width)||100,((Y=Q.size)==null?void 0:Y.height)||100);le&&this.cardContainer.appendChild(le)}else{let le=await this._createCard(Q.card),Ee=this._makeWrapper(le);(D=this._setCardPosition)==null||D.call(this,Ee,((S=Q.position)==null?void 0:S.x)||0,((K=Q.position)==null?void 0:K.y)||0),Ee.style.width=`${((H=Q.size)==null?void 0:H.width)||140}px`,Ee.style.height=`${((j=Q.size)==null?void 0:j.height)||100}px`,Q.z!=null&&(Ee.style.zIndex=String(Q.z)),this.cardContainer.appendChild(Ee);try{($=this._rebuildOnce)==null||$.call(this,Ee.firstElementChild)}catch{}(B=this._initCardInteract)==null||B.call(this,Ee)}else(z=this._showEmptyPlaceholder)==null||z.call(this);return(U=this._resizeContainer)==null||U.call(this),(V=this._markDirty)==null||V.call(this,"import"),(oe=this._toast)==null||oe.call(this,"Layout loaded \u2014 click Apply to save."),!0}catch(Q){return console.error("[ddc:switcher] rebuild failed",Q),(fe=this._toast)==null||fe.call(this,"Failed to load layout."),!1}}function l(){var m,_;try{let f=this.shadowRoot||this.renderRoot||this,v=f.querySelector(".ddc-switcher-inline");if(!v)return;let x=(m=this._getLovelace)==null?void 0:m.call(this),k=!1;try{let O=(_=f.getRootNode&&f.getRootNode())==null?void 0:_.host;k=!!(x&&(x.editMode===!0||O&&O.editMode===!0))}catch{}v.style.display=k?"inline-flex":"none"}catch{}}function h(){try{if(this._ddcSwitcherInstalled)return;let _=(this.shadowRoot||this.renderRoot||this).querySelector(".toolbar");if(!_)return;let f=document.createElement("div");f.className="ddc-switcher-inline",Object.assign(f.style,{display:"inline-flex",gap:"6px",alignItems:"center",marginLeft:"auto"});let v=document.createElement("span");v.textContent="Layout:",v.style.fontSize="12px",v.style.opacity="0.8";let x=document.createElement("select");Object.assign(x.style,{fontSize:"12px",padding:"4px 6px",borderRadius:"8px",border:"1px solid var(--divider-color, #999)",background:"var(--card-background-color, #fff)"}),x.title="Select stored layout (storage_key)",x.id="ddcKeySelect";let k=document.createElement("button");k.className="btn secondary",k.type="button",k.style.padding="6px 10px",k.innerHTML='<ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh</span>',f.appendChild(v),f.appendChild(x),f.appendChild(k),_.appendChild(f),this._ddcSwitcherInstalled=!0;let O=async()=>{let T=this.storageKey||this._config&&this._config.storage_key||"",M=await a.call(this),A=(N=>Array.from(new Set(N.filter(Boolean))))(M);if(x.innerHTML="",T&&!A.includes(T)){let N=document.createElement("option");N.value=T,N.textContent=`${T} (current)`,x.appendChild(N)}let Y=document.createElement("optgroup");if(Y.label="Server",A.forEach(N=>{let S=document.createElement("option");S.value=N,S.textContent=N,N===T&&(S.selected=!0),Y.appendChild(S)}),x.appendChild(Y),!x.children.length){let N=document.createElement("option");N.value="",N.textContent="\u2014 none \u2014",N.selected=!0,x.appendChild(N)}l.call(this)};O(),k.addEventListener("click",O),x.addEventListener("change",async T=>{var I;let M=T.target.value;if(!this._ddcLoadingFromKey){this._ddcLoadingFromKey=!0;try{let A=await c.call(this,M);if(!A){(I=this._toast)==null||I.call(this,`No layout found for "${M}"`);return}await p.call(this,A,M)}catch(A){console.warn("[ddc:switcher] apply failed",A)}finally{this._ddcLoadingFromKey=!1}}}),this._ddcVisTimer&&clearInterval(this._ddcVisTimer),this._ddcVisTimer=setInterval(()=>l.call(this),800),l.call(this)}catch(m){console.warn("[ddc:switcher] install failed",m)}}try{let m=Object.getOwnPropertyDescriptor(d.prototype,"hass");if(m&&(m.set||m.get)){let _=m.set;Object.defineProperty(d.prototype,"hass",{configurable:!0,enumerable:!0,set(f){_&&_.call(this,f);try{h.call(this)}catch{}},get:m.get||function(){return this._hass}})}else if(typeof d.prototype.setHass=="function"){let _=d.prototype.setHass;d.prototype.setHass=function(f){_&&_.call(this,f);try{h.call(this)}catch{}}}else{let _=d.prototype.updated||d.prototype.firstUpdated;d.prototype.updated=function(...f){_&&_.apply(this,f);try{h.call(this)}catch{}}}}catch{}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
