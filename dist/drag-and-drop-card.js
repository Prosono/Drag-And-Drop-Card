var Io=Object.create;var Ci=Object.defineProperty;var Lo=Object.getOwnPropertyDescriptor;var zo=Object.getOwnPropertyNames;var Do=Object.getPrototypeOf,Ro=Object.prototype.hasOwnProperty;var Fo=(e,d,n)=>d in e?Ci(e,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[d]=n;var Bo=(e,d)=>()=>(d||e((d={exports:{}}).exports,d),d.exports);var No=(e,d,n,a)=>{if(d&&typeof d=="object"||typeof d=="function")for(let s of zo(d))!Ro.call(e,s)&&s!==n&&Ci(e,s,{get:()=>d[s],enumerable:!(a=Lo(d,s))||a.enumerable});return e};var jo=(e,d,n)=>(n=e!=null?Io(Do(e)):{},No(d||!e||!e.__esModule?Ci(n,"default",{value:e,enumerable:!0}):n,e));var bn=(e,d,n)=>Fo(e,typeof d!="symbol"?d+"":d,n);var _n=Bo((Ei,wt)=>{(function(e,d){typeof Ei=="object"&&typeof wt!="undefined"?wt.exports=d():typeof define=="function"&&define.amd?define(d):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=d()})(Ei,(function(){"use strict";function e(i,t){var r=Object.keys(i);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);t&&(o=o.filter((function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable}))),r.push.apply(r,o)}return r}function d(i){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e(Object(r),!0).forEach((function(o){c(i,o,r[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(o){Object.defineProperty(i,o,Object.getOwnPropertyDescriptor(r,o))}))}return i}function n(i){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(i)}function a(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function s(i,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,O(o.key),o)}}function p(i,t,r){return t&&s(i.prototype,t),r&&s(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function c(i,t,r){return(t=O(t))in i?Object.defineProperty(i,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[t]=r,i}function h(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&x(i,t)}function m(i){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(i)}function x(i,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},x(i,t)}function y(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function w(i){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var r,o=m(i);if(t){var l=m(this).constructor;r=Reflect.construct(o,arguments,l)}else r=o.apply(this,arguments);return(function(u,f){if(f&&(typeof f=="object"||typeof f=="function"))return f;if(f!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y(u)})(this,r)}}function k(){return k=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(i,t,r){var o=(function(u,f){for(;!Object.prototype.hasOwnProperty.call(u,f)&&(u=m(u))!==null;);return u})(i,t);if(o){var l=Object.getOwnPropertyDescriptor(o,t);return l.get?l.get.call(arguments.length<3?i:r):l.value}},k.apply(this,arguments)}function O(i){var t=(function(r,o){if(typeof r!="object"||r===null)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var u=l.call(r,o||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)})(i,"string");return typeof t=="symbol"?t:t+""}var z=function(i){return!(!i||!i.Window)&&i instanceof i.Window},A=void 0,M=void 0;function D(i){A=i;var t=i.document.createTextNode("");t.ownerDocument!==i.document&&typeof i.wrap=="function"&&i.wrap(t)===t&&(i=i.wrap(i)),M=i}function C(i){return z(i)?i:(i.ownerDocument||i).defaultView||M.window}typeof window!="undefined"&&window&&D(window);var P=function(i){return!!i&&n(i)==="object"},T=function(i){return typeof i=="function"},v={window:function(i){return i===M||z(i)},docFrag:function(i){return P(i)&&i.nodeType===11},object:P,func:T,number:function(i){return typeof i=="number"},bool:function(i){return typeof i=="boolean"},string:function(i){return typeof i=="string"},element:function(i){if(!i||n(i)!=="object")return!1;var t=C(i)||M;return/object|function/.test(typeof Element=="undefined"?"undefined":n(Element))?i instanceof Element||i instanceof t.Element:i.nodeType===1&&typeof i.nodeName=="string"},plainObject:function(i){return P(i)&&!!i.constructor&&/function Object\b/.test(i.constructor.toString())},array:function(i){return P(i)&&i.length!==void 0&&T(i.splice)}};function L(i){var t=i.interaction;if(t.prepared.name==="drag"){var r=t.prepared.axis;r==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):r==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function R(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="drag"){var o=r.prepared.axis;if(o==="x"||o==="y"){var l=o==="x"?"y":"x";t.page[l]=r.coords.start.page[l],t.client[l]=r.coords.start.client[l],t.delta[l]=0}}}var V={id:"actions/drag",install:function(i){var t=i.actions,r=i.Interactable,o=i.defaults;r.prototype.draggable=V.draggable,t.map.drag=V,t.methodDict.drag="draggable",o.actions.drag=V.defaults},listeners:{"interactions:before-action-move":L,"interactions:action-resume":L,"interactions:action-move":R,"auto-start:check":function(i){var t=i.interaction,r=i.interactable,o=i.buttons,l=r.options.drag;if(l&&l.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(o&r.options.drag.mouseButtons)!=0))return i.action={name:"drag",axis:l.lockAxis==="start"?l.startAxis:l.lockAxis},!1}},draggable:function(i){return v.object(i)?(this.options.drag.enabled=i.enabled!==!1,this.setPerAction("drag",i),this.setOnEvents("drag",i),/^(xy|x|y|start)$/.test(i.lockAxis)&&(this.options.drag.lockAxis=i.lockAxis),/^(xy|x|y)$/.test(i.startAxis)&&(this.options.drag.startAxis=i.startAxis),this):v.bool(i)?(this.options.drag.enabled=i,this):this.options.drag},beforeMove:L,move:R,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(i){return i.search("drag")===0}},B=V,Y={init:function(i){var t=i;Y.document=t.document,Y.DocumentFragment=t.DocumentFragment||re,Y.SVGElement=t.SVGElement||re,Y.SVGSVGElement=t.SVGSVGElement||re,Y.SVGElementInstance=t.SVGElementInstance||re,Y.Element=t.Element||re,Y.HTMLElement=t.HTMLElement||Y.Element,Y.Event=t.Event,Y.Touch=t.Touch||re,Y.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function re(){}var G=Y,te={init:function(i){var t=G.Element,r=i.navigator||{};te.supportsTouch="ontouchstart"in i||v.func(i.DocumentTouch)&&G.document instanceof i.DocumentTouch,te.supportsPointerEvent=r.pointerEnabled!==!1&&!!G.PointerEvent,te.isIOS=/iP(hone|od|ad)/.test(r.platform),te.isIOS7=/iP(hone|od|ad)/.test(r.platform)&&/OS 7[^\d]/.test(r.appVersion),te.isIe9=/MSIE 9/.test(r.userAgent),te.isOperaMobile=r.appName==="Opera"&&te.supportsTouch&&/Presto/.test(r.userAgent),te.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",te.pEventTypes=te.supportsPointerEvent?G.PointerEvent===i.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,te.wheelEvent=G.document&&"onmousewheel"in G.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},se=te;function pe(i,t){if(i.contains)return i.contains(t);for(;t;){if(t===i)return!0;t=t.parentNode}return!1}function Ae(i,t){for(;v.element(i);){if(be(i,t))return i;i=ve(i)}return null}function ve(i){var t=i.parentNode;if(v.docFrag(t)){for(;(t=t.host)&&v.docFrag(t););return t}return t}function be(i,t){return M!==A&&(t=t.replace(/\/deep\//g," ")),i[se.prefixedMatchesSelector](t)}var xe=function(i){return i.parentNode||i.host};function le(i,t){for(var r,o=[],l=i;(r=xe(l))&&l!==t&&r!==l.ownerDocument;)o.unshift(l),l=r;return o}function Le(i,t,r){for(;v.element(i);){if(be(i,t))return!0;if((i=ve(i))===r)return be(i,t)}return!1}function Oe(i){return i.correspondingUseElement||i}function Ke(i){var t=i instanceof G.SVGElement?i.getBoundingClientRect():i.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function $e(i){var t,r=Ke(i);if(!se.isIOS7&&r){var o={x:(t=(t=C(i))||M).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};r.left+=o.x,r.right+=o.x,r.top+=o.y,r.bottom+=o.y}return r}function Fe(i){for(var t=[];i;)t.push(i),i=ve(i);return t}function Pe(i){return!!v.string(i)&&(G.document.querySelector(i),!0)}function X(i,t){for(var r in t)i[r]=t[r];return i}function Ye(i,t,r){return i==="parent"?ve(r):i==="self"?t.getRect(r):Ae(r,i)}function je(i,t,r,o){var l=i;return v.string(l)?l=Ye(l,t,r):v.func(l)&&(l=l.apply(void 0,o)),v.element(l)&&(l=$e(l)),l}function H(i){return i&&{x:"x"in i?i.x:i.left,y:"y"in i?i.y:i.top}}function fe(i){return!i||"x"in i&&"y"in i||((i=X({},i)).x=i.left||0,i.y=i.top||0,i.width=i.width||(i.right||0)-i.x,i.height=i.height||(i.bottom||0)-i.y),i}function ae(i,t,r){i.left&&(t.left+=r.x),i.right&&(t.right+=r.x),i.top&&(t.top+=r.y),i.bottom&&(t.bottom+=r.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function ye(i,t,r){var o=r&&i.options[r];return H(je(o&&o.origin||i.options.origin,i,t,[i&&t]))||{x:0,y:0}}function De(i,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(b){return!0},o=arguments.length>3?arguments[3]:void 0;if(o=o||{},v.string(i)&&i.search(" ")!==-1&&(i=at(i)),v.array(i))return i.forEach((function(b){return De(b,t,r,o)})),o;if(v.object(i)&&(t=i,i=""),v.func(t)&&r(i))o[i]=o[i]||[],o[i].push(t);else if(v.array(t))for(var l=0,u=t;l<u.length;l++){var f=u[l];De(i,f,r,o)}else if(v.object(t))for(var g in t)De(at(g).map((function(b){return"".concat(i).concat(b)})),t[g],r,o);return o}function at(i){return i.trim().split(/ +/)}var tt=function(i,t){return Math.sqrt(i*i+t*t)},pt=["webkit","moz"];function Re(i,t){i.__set||(i.__set={});var r=function(l){if(pt.some((function(u){return l.indexOf(u)===0})))return 1;typeof i[l]!="function"&&l!=="__set"&&Object.defineProperty(i,l,{get:function(){return l in i.__set?i.__set[l]:i.__set[l]=t[l]},set:function(u){i.__set[l]=u},configurable:!0})};for(var o in t)r(o);return i}function st(i,t){i.page=i.page||{},i.page.x=t.page.x,i.page.y=t.page.y,i.client=i.client||{},i.client.x=t.client.x,i.client.y=t.client.y,i.timeStamp=t.timeStamp}function _e(i){i.page.x=0,i.page.y=0,i.client.x=0,i.client.y=0}function Dt(i){return i instanceof G.Event||i instanceof G.Touch}function rt(i,t,r){return i=i||"page",(r=r||{}).x=t[i+"X"],r.y=t[i+"Y"],r}function ht(i,t){return t=t||{x:0,y:0},se.isOperaMobile&&Dt(i)?(rt("screen",i,t),t.x+=window.scrollX,t.y+=window.scrollY):rt("page",i,t),t}function We(i){return v.number(i.pointerId)?i.pointerId:i.identifier}function Xt(i,t,r){var o=t.length>1?K(t):t[0];ht(o,i.page),(function(l,u){u=u||{},se.isOperaMobile&&Dt(l)?rt("screen",l,u):rt("client",l,u)})(o,i.client),i.timeStamp=r}function q(i){var t=[];return v.array(i)?(t[0]=i[0],t[1]=i[1]):i.type==="touchend"?i.touches.length===1?(t[0]=i.touches[0],t[1]=i.changedTouches[0]):i.touches.length===0&&(t[0]=i.changedTouches[0],t[1]=i.changedTouches[1]):(t[0]=i.touches[0],t[1]=i.touches[1]),t}function K(i){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},r=0;r<i.length;r++){var o=i[r];for(var l in t)t[l]+=o[l]}for(var u in t)t[u]/=i.length;return t}function $(i){if(!i.length)return null;var t=q(i),r=Math.min(t[0].pageX,t[1].pageX),o=Math.min(t[0].pageY,t[1].pageY),l=Math.max(t[0].pageX,t[1].pageX),u=Math.max(t[0].pageY,t[1].pageY);return{x:r,y:o,left:r,top:o,right:l,bottom:u,width:l-r,height:u-o}}function oe(i,t){var r=t+"X",o=t+"Y",l=q(i),u=l[0][r]-l[1][r],f=l[0][o]-l[1][o];return tt(u,f)}function Q(i,t){var r=t+"X",o=t+"Y",l=q(i),u=l[1][r]-l[0][r],f=l[1][o]-l[0][o];return 180*Math.atan2(f,u)/Math.PI}function me(i){return v.string(i.pointerType)?i.pointerType:v.number(i.pointerType)?[void 0,void 0,"touch","pen","mouse"][i.pointerType]:/touch/.test(i.type||"")||i instanceof G.Touch?"touch":"mouse"}function Te(i){var t=v.func(i.composedPath)?i.composedPath():i.path;return[Oe(t?t[0]:i.target),Oe(i.currentTarget)]}var J=(function(){function i(t){a(this,i),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return p(i,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),i})();Object.defineProperty(J.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var we=function(i,t){for(var r=0;r<t.length;r++){var o=t[r];i.push(o)}return i},Me=function(i){return we([],i)},Se=function(i,t){for(var r=0;r<i.length;r++)if(t(i[r],r,i))return r;return-1},ke=function(i,t){return i[Se(i,t)]},it=(function(i){h(r,i);var t=w(r);function r(o,l,u){var f;a(this,r),(f=t.call(this,l._interaction)).dropzone=void 0,f.dragEvent=void 0,f.relatedTarget=void 0,f.draggable=void 0,f.propagationStopped=!1,f.immediatePropagationStopped=!1;var g=u==="dragleave"?o.prev:o.cur,b=g.element,S=g.dropzone;return f.type=u,f.target=b,f.currentTarget=b,f.dropzone=S,f.dragEvent=l,f.relatedTarget=l.target,f.draggable=l.interactable,f.timeStamp=l.timeStamp,f}return p(r,[{key:"reject",value:function(){var o=this,l=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&l.cur.dropzone===this.dropzone&&l.cur.element===this.target)if(l.prev.dropzone=this.dropzone,l.prev.element=this.target,l.rejected=!0,l.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var u=l.activeDrops,f=Se(u,(function(b){var S=b.dropzone,_=b.element;return S===o.dropzone&&_===o.target}));l.activeDrops.splice(f,1);var g=new r(l,this.dragEvent,"dropdeactivate");g.dropzone=this.dropzone,g.target=this.target,this.dropzone.fire(g)}else this.dropzone.fire(new r(l,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),r})(J);function lt(i,t){for(var r=0,o=i.slice();r<o.length;r++){var l=o[r],u=l.dropzone,f=l.element;t.dropzone=u,t.target=f,u.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function Ct(i,t){for(var r=(function(u,f){for(var g=[],b=0,S=u.interactables.list;b<S.length;b++){var _=S[b];if(_.options.drop.enabled){var E=_.options.drop.accept;if(!(v.element(E)&&E!==f||v.string(E)&&!be(f,E)||v.func(E)&&!E({dropzone:_,draggableElement:f})))for(var I=0,N=_.getAllElements();I<N.length;I++){var F=N[I];F!==f&&g.push({dropzone:_,element:F,rect:_.getRect(F)})}}}return g})(i,t),o=0;o<r.length;o++){var l=r[o];l.rect=l.dropzone.getRect(l.element)}return r}function Rt(i,t,r){for(var o=i.dropState,l=i.interactable,u=i.element,f=[],g=0,b=o.activeDrops;g<b.length;g++){var S=b[g],_=S.dropzone,E=S.element,I=S.rect,N=_.dropCheck(t,r,l,u,E,I);f.push(N?E:null)}var F=(function(j){for(var U,W,Z,ce=[],he=0;he<j.length;he++){var ie=j[he],de=j[U];if(ie&&he!==U)if(de){var Xe=xe(ie),Ee=xe(de);if(Xe!==ie.ownerDocument)if(Ee!==ie.ownerDocument)if(Xe!==Ee){ce=ce.length?ce:le(de);var et=void 0;if(de instanceof G.HTMLElement&&ie instanceof G.SVGElement&&!(ie instanceof G.SVGSVGElement)){if(ie===Ee)continue;et=ie.ownerSVGElement}else et=ie;for(var nt=le(et,de.ownerDocument),dt=0;nt[dt]&&nt[dt]===ce[dt];)dt++;var oi=[nt[dt-1],nt[dt],ce[dt]];if(oi[0])for(var Kt=oi[0].lastChild;Kt;){if(Kt===oi[1]){U=he,ce=nt;break}if(Kt===oi[2])break;Kt=Kt.previousSibling}}else Z=de,(parseInt(C(W=ie).getComputedStyle(W).zIndex,10)||0)>=(parseInt(C(Z).getComputedStyle(Z).zIndex,10)||0)&&(U=he);else U=he}else U=he}return U})(f);return o.activeDrops[F]||null}function Et(i,t,r){var o=i.dropState,l={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return r.type==="dragstart"&&(l.activate=new it(o,r,"dropactivate"),l.activate.target=null,l.activate.dropzone=null),r.type==="dragend"&&(l.deactivate=new it(o,r,"dropdeactivate"),l.deactivate.target=null,l.deactivate.dropzone=null),o.rejected||(o.cur.element!==o.prev.element&&(o.prev.dropzone&&(l.leave=new it(o,r,"dragleave"),r.dragLeave=l.leave.target=o.prev.element,r.prevDropzone=l.leave.dropzone=o.prev.dropzone),o.cur.dropzone&&(l.enter=new it(o,r,"dragenter"),r.dragEnter=o.cur.element,r.dropzone=o.cur.dropzone)),r.type==="dragend"&&o.cur.dropzone&&(l.drop=new it(o,r,"drop"),r.dropzone=o.cur.dropzone,r.relatedTarget=o.cur.element),r.type==="dragmove"&&o.cur.dropzone&&(l.move=new it(o,r,"dropmove"),r.dropzone=o.cur.dropzone)),l}function At(i,t){var r=i.dropState,o=r.activeDrops,l=r.cur,u=r.prev;t.leave&&u.dropzone.fire(t.leave),t.enter&&l.dropzone.fire(t.enter),t.move&&l.dropzone.fire(t.move),t.drop&&l.dropzone.fire(t.drop),t.deactivate&&lt(o,t.deactivate),r.prev.dropzone=l.dropzone,r.prev.element=l.element}function Ft(i,t){var r=i.interaction,o=i.iEvent,l=i.event;if(o.type==="dragmove"||o.type==="dragend"){var u=r.dropState;t.dynamicDrop&&(u.activeDrops=Ct(t,r.element));var f=o,g=Rt(r,f,l);u.rejected=u.rejected&&!!g&&g.dropzone===u.cur.dropzone&&g.element===u.cur.element,u.cur.dropzone=g&&g.dropzone,u.cur.element=g&&g.element,u.events=Et(r,0,f)}}var ge={id:"actions/drop",install:function(i){var t=i.actions,r=i.interactStatic,o=i.Interactable,l=i.defaults;i.usePlugin(B),o.prototype.dropzone=function(u){return(function(f,g){if(v.object(g)){if(f.options.drop.enabled=g.enabled!==!1,g.listeners){var b=De(g.listeners),S=Object.keys(b).reduce((function(E,I){return E[/^(enter|leave)/.test(I)?"drag".concat(I):/^(activate|deactivate|move)/.test(I)?"drop".concat(I):I]=b[I],E}),{}),_=f.options.drop.listeners;_&&f.off(_),f.on(S),f.options.drop.listeners=S}return v.func(g.ondrop)&&f.on("drop",g.ondrop),v.func(g.ondropactivate)&&f.on("dropactivate",g.ondropactivate),v.func(g.ondropdeactivate)&&f.on("dropdeactivate",g.ondropdeactivate),v.func(g.ondragenter)&&f.on("dragenter",g.ondragenter),v.func(g.ondragleave)&&f.on("dragleave",g.ondragleave),v.func(g.ondropmove)&&f.on("dropmove",g.ondropmove),/^(pointer|center)$/.test(g.overlap)?f.options.drop.overlap=g.overlap:v.number(g.overlap)&&(f.options.drop.overlap=Math.max(Math.min(1,g.overlap),0)),"accept"in g&&(f.options.drop.accept=g.accept),"checker"in g&&(f.options.drop.checker=g.checker),f}return v.bool(g)?(f.options.drop.enabled=g,f):f.options.drop})(this,u)},o.prototype.dropCheck=function(u,f,g,b,S,_){return(function(E,I,N,F,j,U,W){var Z=!1;if(!(W=W||E.getRect(U)))return!!E.options.drop.checker&&E.options.drop.checker(I,N,Z,E,U,F,j);var ce=E.options.drop.overlap;if(ce==="pointer"){var he=ye(F,j,"drag"),ie=ht(I);ie.x+=he.x,ie.y+=he.y;var de=ie.x>W.left&&ie.x<W.right,Xe=ie.y>W.top&&ie.y<W.bottom;Z=de&&Xe}var Ee=F.getRect(j);if(Ee&&ce==="center"){var et=Ee.left+Ee.width/2,nt=Ee.top+Ee.height/2;Z=et>=W.left&&et<=W.right&&nt>=W.top&&nt<=W.bottom}return Ee&&v.number(ce)&&(Z=Math.max(0,Math.min(W.right,Ee.right)-Math.max(W.left,Ee.left))*Math.max(0,Math.min(W.bottom,Ee.bottom)-Math.max(W.top,Ee.top))/(Ee.width*Ee.height)>=ce),E.options.drop.checker&&(Z=E.options.drop.checker(I,N,Z,E,U,F,j)),Z})(this,u,f,g,b,S,_)},r.dynamicDrop=function(u){return v.bool(u)?(i.dynamicDrop=u,r):i.dynamicDrop},X(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",i.dynamicDrop=!1,l.actions.drop=ge.defaults},listeners:{"interactions:before-action-start":function(i){var t=i.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(i,t){var r=i.interaction,o=(i.event,i.iEvent);if(r.prepared.name==="drag"){var l=r.dropState;l.activeDrops=[],l.events={},l.activeDrops=Ct(t,r.element),l.events=Et(r,0,o),l.events.activate&&(lt(l.activeDrops,l.events.activate),t.fire("actions/drop:start",{interaction:r,dragEvent:o}))}},"interactions:action-move":Ft,"interactions:after-action-move":function(i,t){var r=i.interaction,o=i.iEvent;if(r.prepared.name==="drag"){var l=r.dropState;At(r,l.events),t.fire("actions/drop:move",{interaction:r,dragEvent:o}),l.events={}}},"interactions:action-end":function(i,t){if(i.interaction.prepared.name==="drag"){var r=i.interaction,o=i.iEvent;Ft(i,t),At(r,r.dropState.events),t.fire("actions/drop:end",{interaction:r,dragEvent:o})}},"interactions:stop":function(i){var t=i.interaction;if(t.prepared.name==="drag"){var r=t.dropState;r&&(r.activeDrops=null,r.events=null,r.cur.dropzone=null,r.cur.element=null,r.prev.dropzone=null,r.prev.element=null,r.rejected=!1)}}},getActiveDrops:Ct,getDrop:Rt,getDropEvents:Et,fireDropEvents:At,filterEventType:function(i){return i.search("drag")===0||i.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},ue=ge;function Ce(i){var t=i.interaction,r=i.iEvent,o=i.phase;if(t.prepared.name==="gesture"){var l=t.pointers.map((function(S){return S.pointer})),u=o==="start",f=o==="end",g=t.interactable.options.deltaSource;if(r.touches=[l[0],l[1]],u)r.distance=oe(l,g),r.box=$(l),r.scale=1,r.ds=0,r.angle=Q(l,g),r.da=0,t.gesture.startDistance=r.distance,t.gesture.startAngle=r.angle;else if(f||t.pointers.length<2){var b=t.prevEvent;r.distance=b.distance,r.box=b.box,r.scale=b.scale,r.ds=0,r.angle=b.angle,r.da=0}else r.distance=oe(l,g),r.box=$(l),r.scale=r.distance/t.gesture.startDistance,r.angle=Q(l,g),r.ds=r.scale-t.gesture.scale,r.da=r.angle-t.gesture.angle;t.gesture.distance=r.distance,t.gesture.angle=r.angle,v.number(r.scale)&&r.scale!==1/0&&!isNaN(r.scale)&&(t.gesture.scale=r.scale)}}var Ue={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(i){var t=i.actions,r=i.Interactable,o=i.defaults;r.prototype.gesturable=function(l){return v.object(l)?(this.options.gesture.enabled=l.enabled!==!1,this.setPerAction("gesture",l),this.setOnEvents("gesture",l),this):v.bool(l)?(this.options.gesture.enabled=l,this):this.options.gesture},t.map.gesture=Ue,t.methodDict.gesture="gesturable",o.actions.gesture=Ue.defaults},listeners:{"interactions:action-start":Ce,"interactions:action-move":Ce,"interactions:action-end":Ce,"interactions:new":function(i){i.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(i){if(!(i.interaction.pointers.length<2)){var t=i.interactable.options.gesture;if(t&&t.enabled)return i.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(i){return i.search("gesture")===0}},Ze=Ue;function Ot(i,t,r,o,l,u,f){if(!t)return!1;if(t===!0){var g=v.number(u.width)?u.width:u.right-u.left,b=v.number(u.height)?u.height:u.bottom-u.top;if(f=Math.min(f,Math.abs((i==="left"||i==="right"?g:b)/2)),g<0&&(i==="left"?i="right":i==="right"&&(i="left")),b<0&&(i==="top"?i="bottom":i==="bottom"&&(i="top")),i==="left"){var S=g>=0?u.left:u.right;return r.x<S+f}if(i==="top"){var _=b>=0?u.top:u.bottom;return r.y<_+f}if(i==="right")return r.x>(g>=0?u.right:u.left)-f;if(i==="bottom")return r.y>(b>=0?u.bottom:u.top)-f}return!!v.element(o)&&(v.element(t)?t===o:Le(o,t,l))}function Tt(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="resize"&&r.resizeAxes){var o=t;r.interactable.options.resize.square?(r.resizeAxes==="y"?o.delta.x=o.delta.y:o.delta.y=o.delta.x,o.axes="xy"):(o.axes=r.resizeAxes,r.resizeAxes==="x"?o.delta.y=0:r.resizeAxes==="y"&&(o.delta.x=0))}}var Be,qe,Je={id:"actions/resize",before:["actions/drag"],install:function(i){var t=i.actions,r=i.browser,o=i.Interactable,l=i.defaults;Je.cursors=(function(u){return u.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(r),Je.defaultMargin=r.supportsTouch||r.supportsPointerEvent?20:10,o.prototype.resizable=function(u){return(function(f,g,b){return v.object(g)?(f.options.resize.enabled=g.enabled!==!1,f.setPerAction("resize",g),f.setOnEvents("resize",g),v.string(g.axis)&&/^x$|^y$|^xy$/.test(g.axis)?f.options.resize.axis=g.axis:g.axis===null&&(f.options.resize.axis=b.defaults.actions.resize.axis),v.bool(g.preserveAspectRatio)?f.options.resize.preserveAspectRatio=g.preserveAspectRatio:v.bool(g.square)&&(f.options.resize.square=g.square),f):v.bool(g)?(f.options.resize.enabled=g,f):f.options.resize})(this,u,i)},t.map.resize=Je,t.methodDict.resize="resizable",l.actions.resize=Je.defaults},listeners:{"interactions:new":function(i){i.interaction.resizeAxes="xy"},"interactions:action-start":function(i){(function(t){var r=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var l=r,u=o.rect;o._rects={start:X({},u),corrected:X({},u),previous:X({},u),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},l.edges=o.prepared.edges,l.rect=o._rects.corrected,l.deltaRect=o._rects.delta}})(i),Tt(i)},"interactions:action-move":function(i){(function(t){var r=t.iEvent,o=t.interaction;if(o.prepared.name==="resize"&&o.prepared.edges){var l=r,u=o.interactable.options.resize.invert,f=u==="reposition"||u==="negate",g=o.rect,b=o._rects,S=b.start,_=b.corrected,E=b.delta,I=b.previous;if(X(I,_),f){if(X(_,g),u==="reposition"){if(_.top>_.bottom){var N=_.top;_.top=_.bottom,_.bottom=N}if(_.left>_.right){var F=_.left;_.left=_.right,_.right=F}}}else _.top=Math.min(g.top,S.bottom),_.bottom=Math.max(g.bottom,S.top),_.left=Math.min(g.left,S.right),_.right=Math.max(g.right,S.left);for(var j in _.width=_.right-_.left,_.height=_.bottom-_.top,_)E[j]=_[j]-I[j];l.edges=o.prepared.edges,l.rect=_,l.deltaRect=E}})(i),Tt(i)},"interactions:action-end":function(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="resize"&&r.prepared.edges){var o=t;o.edges=r.prepared.edges,o.rect=r._rects.corrected,o.deltaRect=r._rects.delta}},"auto-start:check":function(i){var t=i.interaction,r=i.interactable,o=i.element,l=i.rect,u=i.buttons;if(l){var f=X({},t.coords.cur.page),g=r.options.resize;if(g&&g.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(u&g.mouseButtons)!=0)){if(v.object(g.edges)){var b={left:!1,right:!1,top:!1,bottom:!1};for(var S in b)b[S]=Ot(S,g.edges[S],f,t._latestPointer.eventTarget,o,l,g.margin||Je.defaultMargin);b.left=b.left&&!b.right,b.top=b.top&&!b.bottom,(b.left||b.right||b.top||b.bottom)&&(i.action={name:"resize",edges:b})}else{var _=g.axis!=="y"&&f.x>l.right-Je.defaultMargin,E=g.axis!=="x"&&f.y>l.bottom-Je.defaultMargin;(_||E)&&(i.action={name:"resize",axes:(_?"x":"")+(E?"y":"")})}return!i.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(i){var t=i.edges,r=i.axis,o=i.name,l=Je.cursors,u=null;if(r)u=l[o+r];else if(t){for(var f="",g=0,b=["top","bottom","left","right"];g<b.length;g++){var S=b[g];t[S]&&(f+=S)}u=l[f]}return u},filterEventType:function(i){return i.search("resize")===0},defaultMargin:null},_t=Je,Gt={id:"actions",install:function(i){i.usePlugin(Ze),i.usePlugin(_t),i.usePlugin(B),i.usePlugin(ue)}},ct=0,ft={request:function(i){return Be(i)},cancel:function(i){return qe(i)},init:function(i){if(Be=i.requestAnimationFrame,qe=i.cancelAnimationFrame,!Be)for(var t=["ms","moz","webkit","o"],r=0;r<t.length;r++){var o=t[r];Be=i["".concat(o,"RequestAnimationFrame")],qe=i["".concat(o,"CancelAnimationFrame")]||i["".concat(o,"CancelRequestAnimationFrame")]}Be=Be&&Be.bind(i),qe=qe&&qe.bind(i),Be||(Be=function(l){var u=Date.now(),f=Math.max(0,16-(u-ct)),g=i.setTimeout((function(){l(u+f)}),f);return ct=u+f,g},qe=function(l){return clearTimeout(l)})}},ne={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(i){ne.isScrolling=!0,ft.cancel(ne.i),i.autoScroll=ne,ne.interaction=i,ne.prevTime=ne.now(),ne.i=ft.request(ne.scroll)},stop:function(){ne.isScrolling=!1,ne.interaction&&(ne.interaction.autoScroll=null),ft.cancel(ne.i)},scroll:function(){var i=ne.interaction,t=i.interactable,r=i.element,o=i.prepared.name,l=t.options[o].autoScroll,u=Ki(l.container,t,r),f=ne.now(),g=(f-ne.prevTime)/1e3,b=l.speed*g;if(b>=1){var S={x:ne.x*b,y:ne.y*b};if(S.x||S.y){var _=$i(u);v.window(u)?u.scrollBy(S.x,S.y):u&&(u.scrollLeft+=S.x,u.scrollTop+=S.y);var E=$i(u),I={x:E.x-_.x,y:E.y-_.y};(I.x||I.y)&&t.fire({type:"autoscroll",target:r,interactable:t,delta:I,interaction:i,container:u})}ne.prevTime=f}ne.isScrolling&&(ft.cancel(ne.i),ne.i=ft.request(ne.scroll))},check:function(i,t){var r;return(r=i.options[t].autoScroll)==null?void 0:r.enabled},onInteractionMove:function(i){var t=i.interaction,r=i.pointer;if(t.interacting()&&ne.check(t.interactable,t.prepared.name))if(t.simulation)ne.x=ne.y=0;else{var o,l,u,f,g=t.interactable,b=t.element,S=t.prepared.name,_=g.options[S].autoScroll,E=Ki(_.container,g,b);if(v.window(E))f=r.clientX<ne.margin,o=r.clientY<ne.margin,l=r.clientX>E.innerWidth-ne.margin,u=r.clientY>E.innerHeight-ne.margin;else{var I=Ke(E);f=r.clientX<I.left+ne.margin,o=r.clientY<I.top+ne.margin,l=r.clientX>I.right-ne.margin,u=r.clientY>I.bottom-ne.margin}ne.x=l?1:f?-1:0,ne.y=u?1:o?-1:0,ne.isScrolling||(ne.margin=_.margin,ne.speed=_.speed,ne.start(t))}}};function Ki(i,t,r){return(v.string(i)?Ye(i,t,r):i)||C(r)}function $i(i){return v.window(i)&&(i=window.document.body),{x:i.scrollLeft,y:i.scrollTop}}var Cr={id:"auto-scroll",install:function(i){var t=i.defaults,r=i.actions;i.autoScroll=ne,ne.now=function(){return i.now()},r.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=ne.defaults},listeners:{"interactions:new":function(i){i.interaction.autoScroll=null},"interactions:destroy":function(i){i.interaction.autoScroll=null,ne.stop(),ne.interaction&&(ne.interaction=null)},"interactions:stop":ne.stop,"interactions:action-move":function(i){return ne.onInteractionMove(i)}}},Er=Cr;function Bt(i,t){var r=!1;return function(){return r||(M.console.warn(t),r=!0),i.apply(this,arguments)}}function pi(i,t){return i.name=t.name,i.axis=t.axis,i.edges=t.edges,i}function Ar(i){return v.bool(i)?(this.options.styleCursor=i,this):i===null?(delete this.options.styleCursor,this):this.options.styleCursor}function Or(i){return v.func(i)?(this.options.actionChecker=i,this):i===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Tr={id:"auto-start/interactableMethods",install:function(i){var t=i.Interactable;t.prototype.getAction=function(r,o,l,u){var f=(function(g,b,S,_,E){var I=g.getRect(_),N=b.buttons||{0:1,1:4,3:8,4:16}[b.button],F={action:null,interactable:g,interaction:S,element:_,rect:I,buttons:N};return E.fire("auto-start:check",F),F.action})(this,o,l,u,i);return this.options.actionChecker?this.options.actionChecker(r,o,f,this,u,l):f},t.prototype.ignoreFrom=Bt((function(r){return this._backCompatOption("ignoreFrom",r)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=Bt((function(r){return this._backCompatOption("allowFrom",r)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Or,t.prototype.styleCursor=Ar}};function Yi(i,t,r,o,l){return t.testIgnoreAllow(t.options[i.name],r,o)&&t.options[i.name].enabled&&Jt(t,r,i,l)?i:null}function Mr(i,t,r,o,l,u,f){for(var g=0,b=o.length;g<b;g++){var S=o[g],_=l[g],E=S.getAction(t,r,i,_);if(E){var I=Yi(E,S,_,u,f);if(I)return{action:I,interactable:S,element:_}}}return{action:null,interactable:null,element:null}}function Wi(i,t,r,o,l){var u=[],f=[],g=o;function b(_){u.push(_),f.push(g)}for(;v.element(g);){u=[],f=[],l.interactables.forEachMatch(g,b);var S=Mr(i,t,r,u,f,o,l);if(S.action&&!S.interactable.options[S.action.name].manualStart)return S;g=ve(g)}return{action:null,interactable:null,element:null}}function Ui(i,t,r){var o=t.action,l=t.interactable,u=t.element;o=o||{name:null},i.interactable=l,i.element=u,pi(i.prepared,o),i.rect=l&&o.name?l.getRect(u):null,Xi(i,r),r.fire("autoStart:prepared",{interaction:i})}function Jt(i,t,r,o){var l=i.options,u=l[r.name].max,f=l[r.name].maxPerElement,g=o.autoStart.maxInteractions,b=0,S=0,_=0;if(!(u&&f&&g))return!1;for(var E=0,I=o.interactions.list;E<I.length;E++){var N=I[E],F=N.prepared.name;if(N.interacting()&&(++b>=g||N.interactable===i&&((S+=F===r.name?1:0)>=u||N.element===t&&(_++,F===r.name&&_>=f))))return!1}return g>0}function Vi(i,t){return v.number(i)?(t.autoStart.maxInteractions=i,this):t.autoStart.maxInteractions}function hi(i,t,r){var o=r.autoStart.cursorElement;o&&o!==i&&(o.style.cursor=""),i.ownerDocument.documentElement.style.cursor=t,i.style.cursor=t,r.autoStart.cursorElement=t?i:null}function Xi(i,t){var r=i.interactable,o=i.element,l=i.prepared;if(i.pointerType==="mouse"&&r&&r.options.styleCursor){var u="";if(l.name){var f=r.options[l.name].cursorChecker;u=v.func(f)?f(l,r,o,i._interacting):t.actions.map[l.name].getCursor(l)}hi(i.element,u||"",t)}else t.autoStart.cursorElement&&hi(t.autoStart.cursorElement,"",t)}var Pr={id:"auto-start/base",before:["actions"],install:function(i){var t=i.interactStatic,r=i.defaults;i.usePlugin(Tr),r.base.actionChecker=null,r.base.styleCursor=!0,X(r.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(o){return Vi(o,i)},i.autoStart={maxInteractions:1/0,withinInteractionLimit:Jt,cursorElement:null}},listeners:{"interactions:down":function(i,t){var r=i.interaction,o=i.pointer,l=i.event,u=i.eventTarget;r.interacting()||Ui(r,Wi(r,o,l,u,t),t)},"interactions:move":function(i,t){(function(r,o){var l=r.interaction,u=r.pointer,f=r.event,g=r.eventTarget;l.pointerType!=="mouse"||l.pointerIsDown||l.interacting()||Ui(l,Wi(l,u,f,g,o),o)})(i,t),(function(r,o){var l=r.interaction;if(l.pointerIsDown&&!l.interacting()&&l.pointerWasMoved&&l.prepared.name){o.fire("autoStart:before-start",r);var u=l.interactable,f=l.prepared.name;f&&u&&(u.options[f].manualStart||!Jt(u,l.element,l.prepared,o)?l.stop():(l.start(l.prepared,u,l.element),Xi(l,o)))}})(i,t)},"interactions:stop":function(i,t){var r=i.interaction,o=r.interactable;o&&o.options.styleCursor&&hi(r.element,"",t)}},maxInteractions:Vi,withinInteractionLimit:Jt,validateAction:Yi},fi=Pr,Ir={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(i,t){var r=i.interaction,o=i.eventTarget,l=i.dx,u=i.dy;if(r.prepared.name==="drag"){var f=Math.abs(l),g=Math.abs(u),b=r.interactable.options.drag,S=b.startAxis,_=f>g?"x":f<g?"y":"xy";if(r.prepared.axis=b.lockAxis==="start"?_[0]:b.lockAxis,_!=="xy"&&S!=="xy"&&S!==_){r.prepared.name=null;for(var E=o,I=function(F){if(F!==r.interactable){var j=r.interactable.options.drag;if(!j.manualStart&&F.testIgnoreAllow(j,E,o)){var U=F.getAction(r.downPointer,r.downEvent,r,E);if(U&&U.name==="drag"&&(function(W,Z){if(!Z)return!1;var ce=Z.options.drag.startAxis;return W==="xy"||ce==="xy"||ce===W})(_,F)&&fi.validateAction(U,F,E,o,t))return F}}};v.element(E);){var N=t.interactables.forEachMatch(E,I);if(N){r.prepared.name="drag",r.interactable=N,r.element=E;break}E=ve(E)}}}}}};function gi(i){var t=i.prepared&&i.prepared.name;if(!t)return null;var r=i.interactable.options;return r[t].hold||r[t].delay}var Lr={id:"auto-start/hold",install:function(i){var t=i.defaults;i.usePlugin(fi),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(i){i.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(i){var t=i.interaction,r=gi(t);r>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),r))},"interactions:move":function(i){var t=i.interaction,r=i.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!r&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(i){var t=i.interaction;gi(t)>0&&(t.prepared.name=null)}},getHoldDuration:gi},zr=Lr,Dr={id:"auto-start",install:function(i){i.usePlugin(fi),i.usePlugin(zr),i.usePlugin(Ir)}},Rr=function(i){return/^(always|never|auto)$/.test(i)?(this.options.preventDefault=i,this):v.bool(i)?(this.options.preventDefault=i?"always":"never",this):this.options.preventDefault};function Fr(i){var t=i.interaction,r=i.event;t.interactable&&t.interactable.checkAndPreventDefault(r)}var Gi={id:"core/interactablePreventDefault",install:function(i){var t=i.Interactable;t.prototype.preventDefault=Rr,t.prototype.checkAndPreventDefault=function(r){return(function(o,l,u){var f=o.options.preventDefault;if(f!=="never")if(f!=="always"){if(l.events.supportsPassive&&/^touch(start|move)$/.test(u.type)){var g=C(u.target).document,b=l.getDocOptions(g);if(!b||!b.events||b.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(u.type)||v.element(u.target)&&be(u.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||u.preventDefault()}else u.preventDefault()})(this,i,r)},i.interactions.docEvents.push({type:"dragstart",listener:function(r){for(var o=0,l=i.interactions.list;o<l.length;o++){var u=l[o];if(u.element&&(u.element===r.target||pe(u.element,r.target)))return void u.interactable.checkAndPreventDefault(r)}}})},listeners:["down","move","up","cancel"].reduce((function(i,t){return i["interactions:".concat(t)]=Fr,i}),{})};function Qt(i,t){if(t.phaselessTypes[i])return!0;for(var r in t.map)if(i.indexOf(r)===0&&i.substr(r.length)in t.phases)return!0;return!1}function Mt(i){var t={};for(var r in i){var o=i[r];v.plainObject(o)?t[r]=Mt(o):v.array(o)?t[r]=Me(o):t[r]=o}return t}var mi=(function(){function i(t){a(this,i),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=Zt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return p(i,[{key:"start",value:function(t,r){var o,l,u=t.phase,f=this.interaction,g=(function(S){var _=S.interactable.options[S.prepared.name],E=_.modifiers;return E&&E.length?E:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(I){var N=_[I];return N&&N.enabled&&{options:N,methods:N._methods}})).filter((function(I){return!!I}))})(f);this.prepareStates(g),this.startEdges=X({},f.edges),this.edges=X({},this.startEdges),this.startOffset=(o=f.rect,l=r,o?{left:l.x-o.left,top:l.y-o.top,right:o.right-l.x,bottom:o.bottom-l.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var b=this.fillArg({phase:u,pageCoords:r,preEnd:!1});return this.result=Zt(),this.startAll(b),this.result=this.setAll(b)}},{key:"fillArg",value:function(t){var r=this.interaction;return t.interaction=r,t.interactable=r.interactable,t.element=r.element,t.rect||(t.rect=r.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var r=0,o=this.states;r<o.length;r++){var l=o[r];l.methods.start&&(t.state=l,l.methods.start(t))}}},{key:"setAll",value:function(t){var r=t.phase,o=t.preEnd,l=t.skipModifiers,u=t.rect,f=t.edges;t.coords=X({},t.pageCoords),t.rect=X({},u),t.edges=X({},f);for(var g=l?this.states.slice(l):this.states,b=Zt(t.coords,t.rect),S=0;S<g.length;S++){var _,E=g[S],I=E.options,N=X({},t.coords),F=null;(_=E.methods)!=null&&_.set&&this.shouldDo(I,o,r)&&(t.state=E,F=E.methods.set(t),ae(t.edges,t.rect,{x:t.coords.x-N.x,y:t.coords.y-N.y})),b.eventProps.push(F)}X(this.edges,t.edges),b.delta.x=t.coords.x-t.pageCoords.x,b.delta.y=t.coords.y-t.pageCoords.y,b.rectDelta.left=t.rect.left-u.left,b.rectDelta.right=t.rect.right-u.right,b.rectDelta.top=t.rect.top-u.top,b.rectDelta.bottom=t.rect.bottom-u.bottom;var j=this.result.coords,U=this.result.rect;if(j&&U){var W=b.rect.left!==U.left||b.rect.right!==U.right||b.rect.top!==U.top||b.rect.bottom!==U.bottom;b.changed=W||j.x!==b.coords.x||j.y!==b.coords.y}return b}},{key:"applyToInteraction",value:function(t){var r=this.interaction,o=t.phase,l=r.coords.cur,u=r.coords.start,f=this.result,g=this.startDelta,b=f.delta;o==="start"&&X(this.startDelta,f.delta);for(var S=0,_=[[u,g],[l,b]];S<_.length;S++){var E=_[S],I=E[0],N=E[1];I.page.x+=N.x,I.page.y+=N.y,I.client.x+=N.x,I.client.y+=N.y}var F=this.result.rectDelta,j=t.rect||r.rect;j.left+=F.left,j.right+=F.right,j.top+=F.top,j.bottom+=F.bottom,j.width=j.right-j.left,j.height=j.bottom-j.top}},{key:"setAndApply",value:function(t){var r=this.interaction,o=t.phase,l=t.preEnd,u=t.skipModifiers,f=this.setAll(this.fillArg({preEnd:l,phase:o,pageCoords:t.modifiedCoords||r.coords.cur.page}));if(this.result=f,!f.changed&&(!u||u<this.states.length)&&r.interacting())return!1;if(t.modifiedCoords){var g=r.coords.cur.page,b={x:t.modifiedCoords.x-g.x,y:t.modifiedCoords.y-g.y};f.coords.x+=b.x,f.coords.y+=b.y,f.delta.x+=b.x,f.delta.y+=b.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var r=t.interaction,o=t.event,l=this.states;if(l&&l.length){for(var u=!1,f=0;f<l.length;f++){var g=l[f];t.state=g;var b=g.options,S=g.methods,_=S.beforeEnd&&S.beforeEnd(t);if(_)return this.endResult=_,!1;u=u||!u&&this.shouldDo(b,!0,t.phase,!0)}u&&r.move({event:o,preEnd:!0})}}},{key:"stop",value:function(t){var r=t.interaction;if(this.states&&this.states.length){var o=X({states:this.states,interactable:r.interactable,element:r.element,rect:null},t);this.fillArg(o);for(var l=0,u=this.states;l<u.length;l++){var f=u[l];o.state=f,f.methods.stop&&f.methods.stop(o)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var r=0;r<t.length;r++){var o=t[r],l=o.options,u=o.methods,f=o.name;this.states.push({options:l,methods:u,index:r,name:f})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var r=t.interaction,o=r.coords,l=r.rect,u=r.modification;if(u.result){for(var f=u.startDelta,g=u.result,b=g.delta,S=g.rectDelta,_=0,E=[[o.start,f],[o.cur,b]];_<E.length;_++){var I=E[_],N=I[0],F=I[1];N.page.x-=F.x,N.page.y-=F.y,N.client.x-=F.x,N.client.y-=F.y}l.left-=S.left,l.right-=S.right,l.top-=S.top,l.bottom-=S.bottom}}},{key:"shouldDo",value:function(t,r,o,l){return!(!t||t.enabled===!1||l&&!t.endOnly||t.endOnly&&!r||o==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(r){return Mt(r)})),this.result=Zt(X({},t.result.coords),X({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),i})();function Zt(i,t){return{rect:t,coords:i,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function gt(i,t){var r=i.defaults,o={start:i.start,set:i.set,beforeEnd:i.beforeEnd,stop:i.stop},l=function(u){var f=u||{};for(var g in f.enabled=f.enabled!==!1,r)g in f||(f[g]=r[g]);var b={options:f,methods:o,name:t,enable:function(){return f.enabled=!0,b},disable:function(){return f.enabled=!1,b}};return b};return t&&typeof t=="string"&&(l._defaults=r,l._methods=o),l}function Nt(i){var t=i.iEvent,r=i.interaction.modification.result;r&&(t.modifiers=r.eventProps)}var Br={id:"modifiers/base",before:["actions"],install:function(i){i.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(i){var t=i.interaction;t.modification=new mi(t)},"interactions:before-action-start":function(i){var t=i.interaction,r=i.interaction.modification;r.start(i,t.coords.start.page),t.edges=r.edges,r.applyToInteraction(i)},"interactions:before-action-move":function(i){var t=i.interaction,r=t.modification,o=r.setAndApply(i);return t.edges=r.edges,o},"interactions:before-action-end":function(i){var t=i.interaction,r=t.modification,o=r.beforeEnd(i);return t.edges=r.startEdges,o},"interactions:action-start":Nt,"interactions:action-move":Nt,"interactions:action-end":Nt,"interactions:after-action-start":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-move":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:stop":function(i){return i.interaction.modification.stop(i)}}},Ji=Br,Qi={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},yi=(function(i){h(r,i);var t=w(r);function r(o,l,u,f,g,b,S){var _;a(this,r),(_=t.call(this,o)).relatedTarget=null,_.screenX=void 0,_.screenY=void 0,_.button=void 0,_.buttons=void 0,_.ctrlKey=void 0,_.shiftKey=void 0,_.altKey=void 0,_.metaKey=void 0,_.page=void 0,_.client=void 0,_.delta=void 0,_.rect=void 0,_.x0=void 0,_.y0=void 0,_.t0=void 0,_.dt=void 0,_.duration=void 0,_.clientX0=void 0,_.clientY0=void 0,_.velocity=void 0,_.speed=void 0,_.swipe=void 0,_.axes=void 0,_.preEnd=void 0,g=g||o.element;var E=o.interactable,I=(E&&E.options||Qi).deltaSource,N=ye(E,g,u),F=f==="start",j=f==="end",U=F?y(_):o.prevEvent,W=F?o.coords.start:j?{page:U.page,client:U.client,timeStamp:o.coords.cur.timeStamp}:o.coords.cur;return _.page=X({},W.page),_.client=X({},W.client),_.rect=X({},o.rect),_.timeStamp=W.timeStamp,j||(_.page.x-=N.x,_.page.y-=N.y,_.client.x-=N.x,_.client.y-=N.y),_.ctrlKey=l.ctrlKey,_.altKey=l.altKey,_.shiftKey=l.shiftKey,_.metaKey=l.metaKey,_.button=l.button,_.buttons=l.buttons,_.target=g,_.currentTarget=g,_.preEnd=b,_.type=S||u+(f||""),_.interactable=E,_.t0=F?o.pointers[o.pointers.length-1].downTime:U.t0,_.x0=o.coords.start.page.x-N.x,_.y0=o.coords.start.page.y-N.y,_.clientX0=o.coords.start.client.x-N.x,_.clientY0=o.coords.start.client.y-N.y,_.delta=F||j?{x:0,y:0}:{x:_[I].x-U[I].x,y:_[I].y-U[I].y},_.dt=o.coords.delta.timeStamp,_.duration=_.timeStamp-_.t0,_.velocity=X({},o.coords.velocity[I]),_.speed=tt(_.velocity.x,_.velocity.y),_.swipe=j||f==="inertiastart"?_.getSwipe():null,_}return p(r,[{key:"getSwipe",value:function(){var o=this._interaction;if(o.prevEvent.speed<600||this.timeStamp-o.prevEvent.timeStamp>150)return null;var l=180*Math.atan2(o.prevEvent.velocityY,o.prevEvent.velocityX)/Math.PI;l<0&&(l+=360);var u=112.5<=l&&l<247.5,f=202.5<=l&&l<337.5;return{up:f,down:!f&&22.5<=l&&l<157.5,left:u,right:!u&&(292.5<=l||l<67.5),angle:l,speed:o.prevEvent.speed,velocity:{x:o.prevEvent.velocityX,y:o.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),r})(J);Object.defineProperties(yi.prototype,{pageX:{get:function(){return this.page.x},set:function(i){this.page.x=i}},pageY:{get:function(){return this.page.y},set:function(i){this.page.y=i}},clientX:{get:function(){return this.client.x},set:function(i){this.client.x=i}},clientY:{get:function(){return this.client.y},set:function(i){this.client.y=i}},dx:{get:function(){return this.delta.x},set:function(i){this.delta.x=i}},dy:{get:function(){return this.delta.y},set:function(i){this.delta.y=i}},velocityX:{get:function(){return this.velocity.x},set:function(i){this.velocity.x=i}},velocityY:{get:function(){return this.velocity.y},set:function(i){this.velocity.y=i}}});var Nr=p((function i(t,r,o,l,u){a(this,i),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=r,this.event=o,this.downTime=l,this.downTarget=u})),jr=(function(i){return i.interactable="",i.element="",i.prepared="",i.pointerIsDown="",i.pointerWasMoved="",i._proxy="",i})({}),Zi=(function(i){return i.start="",i.move="",i.end="",i.stop="",i.interacting="",i})({}),qr=0,Hr=(function(){function i(t){var r=this,o=t.pointerType,l=t.scopeFire;a(this,i),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Bt((function(_){this.move(_)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=qr++,this._scopeFire=l,this.pointerType=o;var u=this;this._proxy={};var f=function(_){Object.defineProperty(r._proxy,_,{get:function(){return u[_]}})};for(var g in jr)f(g);var b=function(_){Object.defineProperty(r._proxy,_,{value:function(){return u[_].apply(u,arguments)}})};for(var S in Zi)b(S);this._scopeFire("interactions:new",{interaction:this})}return p(i,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,r,o){var l=this.updatePointer(t,r,o,!0),u=this.pointers[l];this._scopeFire("interactions:down",{pointer:t,event:r,eventTarget:o,pointerIndex:l,pointerInfo:u,type:"down",interaction:this})}},{key:"start",value:function(t,r,o){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!r.options[t.name].enabled)&&(pi(this.prepared,t),this.interactable=r,this.element=o,this.rect=r.getRect(o),this.edges=this.prepared.edges?X({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,r,o){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,r,o,!1);var l,u,f=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(l=this.coords.cur.client.x-this.coords.start.client.x,u=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=tt(l,u)>this.pointerMoveTolerance);var g,b,S,_=this.getPointerIndex(t),E={pointer:t,pointerIndex:_,pointerInfo:this.pointers[_],event:r,type:"move",eventTarget:o,dx:l,dy:u,duplicate:f,interaction:this};f||(g=this.coords.velocity,b=this.coords.delta,S=Math.max(b.timeStamp/1e3,.001),g.page.x=b.page.x/S,g.page.y=b.page.y/S,g.client.x=b.client.x/S,g.client.y=b.client.y/S,g.timeStamp=S),this._scopeFire("interactions:move",E),f||this.simulation||(this.interacting()&&(E.type=null,this.move(E)),this.pointerWasMoved&&st(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||_e(this.coords.delta),(t=X({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,r,o,l){var u=this.getPointerIndex(t);u===-1&&(u=this.updatePointer(t,r,o,!1));var f=/cancel$/i.test(r.type)?"cancel":"up";this._scopeFire("interactions:".concat(f),{pointer:t,pointerIndex:u,pointerInfo:this.pointers[u],event:r,eventTarget:o,type:f,curEventTarget:l,interaction:this}),this.simulation||this.end(r),this.removePointer(t,r)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var r;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(r=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,r===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var r=We(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:Se(this.pointers,(function(o){return o.id===r}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,r,o,l){var u,f,g,b=We(t),S=this.getPointerIndex(t),_=this.pointers[S];return l=l!==!1&&(l||/(down|start)$/i.test(r.type)),_?_.pointer=t:(_=new Nr(b,t,r,null,null),S=this.pointers.length,this.pointers.push(_)),Xt(this.coords.cur,this.pointers.map((function(E){return E.pointer})),this._now()),u=this.coords.delta,f=this.coords.prev,g=this.coords.cur,u.page.x=g.page.x-f.page.x,u.page.y=g.page.y-f.page.y,u.client.x=g.client.x-f.client.x,u.client.y=g.client.y-f.client.y,u.timeStamp=g.timeStamp-f.timeStamp,l&&(this.pointerIsDown=!0,_.downTime=this.coords.cur.timeStamp,_.downTarget=o,Re(this.downPointer,t),this.interacting()||(st(this.coords.start,this.coords.cur),st(this.coords.prev,this.coords.cur),this.downEvent=r,this.pointerWasMoved=!1)),this._updateLatestPointer(t,r,o),this._scopeFire("interactions:update-pointer",{pointer:t,event:r,eventTarget:o,down:l,pointerInfo:_,pointerIndex:S,interaction:this}),S}},{key:"removePointer",value:function(t,r){var o=this.getPointerIndex(t);if(o!==-1){var l=this.pointers[o];this._scopeFire("interactions:remove-pointer",{pointer:t,event:r,eventTarget:null,pointerIndex:o,pointerInfo:l,interaction:this}),this.pointers.splice(o,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,r,o){this._latestPointer.pointer=t,this._latestPointer.event=r,this._latestPointer.eventTarget=o}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,r,o,l){return new yi(this,t,this.prepared.name,r,this.element,o,l)}},{key:"_fireEvent",value:function(t){var r;(r=this.interactable)==null||r.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var r=t.event,o=t.phase,l=t.preEnd,u=t.type,f=this.rect;if(f&&o==="move"&&(ae(this.edges,f,this.coords.delta[this.interactable.options.deltaSource]),f.width=f.right-f.left,f.height=f.bottom-f.top),this._scopeFire("interactions:before-action-".concat(o),t)===!1)return!1;var g=t.iEvent=this._createPreparedEvent(r,o,l,u);return this._scopeFire("interactions:action-".concat(o),t),o==="start"&&(this.prevEvent=g),this._fireEvent(g),this._scopeFire("interactions:after-action-".concat(o),t),!0}},{key:"_now",value:function(){return Date.now()}}]),i})();function en(i){tn(i.interaction)}function tn(i){if(!(function(r){return!(!r.offset.pending.x&&!r.offset.pending.y)})(i))return!1;var t=i.offset.pending;return vi(i.coords.cur,t),vi(i.coords.delta,t),ae(i.edges,i.rect,t),t.x=0,t.y=0,!0}function Kr(i){var t=i.x,r=i.y;this.offset.pending.x+=t,this.offset.pending.y+=r,this.offset.total.x+=t,this.offset.total.y+=r}function vi(i,t){var r=i.page,o=i.client,l=t.x,u=t.y;r.x+=l,r.y+=u,o.x+=l,o.y+=u}Zi.offsetBy="";var $r={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(i){i.Interaction.prototype.offsetBy=Kr},listeners:{"interactions:new":function(i){i.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(i){return(function(t){t.pointerIsDown&&(vi(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(i.interaction)},"interactions:before-action-start":en,"interactions:before-action-move":en,"interactions:before-action-end":function(i){var t=i.interaction;if(tn(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(i){var t=i.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},nn=$r,Yr=(function(){function i(t){a(this,i),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return p(i,[{key:"start",value:function(t){var r=this.interaction,o=ei(r);if(!o||!o.enabled)return!1;var l=r.coords.velocity.client,u=tt(l.x,l.y),f=this.modification||(this.modification=new mi(r));if(f.copyFrom(r.modification),this.t0=r._now(),this.allowResume=o.allowResume,this.v0=u,this.currentOffset={x:0,y:0},this.startCoords=r.coords.cur.page,this.modifierArg=f.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-r.coords.cur.timeStamp<50&&u>o.minSpeed&&u>o.endSpeed)this.startInertia();else{if(f.result=f.setAll(this.modifierArg),!f.result.changed)return!1;this.startSmoothEnd()}return r.modification.result.rect=null,r.offsetBy(this.targetOffset),r._doPhase({interaction:r,event:t,phase:"inertiastart"}),r.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),r.modification.result.rect=null,this.active=!0,r.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,r=this.interaction.coords.velocity.client,o=ei(this.interaction),l=o.resistance,u=-Math.log(o.endSpeed/this.v0)/l;this.targetOffset={x:(r.x-u)/l,y:(r.y-u)/l},this.te=u,this.lambda_v0=l/this.v0,this.one_ve_v0=1-o.endSpeed/this.v0;var f=this.modification,g=this.modifierArg;g.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},f.result=f.setAll(g),f.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+f.result.delta.x,y:this.targetOffset.y+f.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var r=this;this.timeout=ft.request((function(){r.active&&t()}))}},{key:"inertiaTick",value:function(){var t,r,o,l,u,f,g,b=this,S=this.interaction,_=ei(S).resistance,E=(S._now()-this.t0)/1e3;if(E<this.te){var I,N=1-(Math.exp(-_*E)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,r=0,o=this.targetOffset.x,l=this.targetOffset.y,u=this.modifiedOffset.x,f=this.modifiedOffset.y,I={x:rn(g=N,t,o,u),y:rn(g,r,l,f)}):I={x:this.targetOffset.x*N,y:this.targetOffset.y*N};var F={x:I.x-this.currentOffset.x,y:I.y-this.currentOffset.y};this.currentOffset.x+=F.x,this.currentOffset.y+=F.y,S.offsetBy(F),S.move(),this.onNextFrame((function(){return b.inertiaTick()}))}else S.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,r=this.interaction,o=r._now()-this.t0,l=ei(r).smoothEndDuration;if(o<l){var u={x:on(o,0,this.targetOffset.x,l),y:on(o,0,this.targetOffset.y,l)},f={x:u.x-this.currentOffset.x,y:u.y-this.currentOffset.y};this.currentOffset.x+=f.x,this.currentOffset.y+=f.y,r.offsetBy(f),r.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else r.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var r=t.pointer,o=t.event,l=t.eventTarget,u=this.interaction;u.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),u.updatePointer(r,o,l,!0),u._doPhase({interaction:u,event:o,phase:"resume"}),st(u.coords.prev,u.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,ft.cancel(this.timeout)}}]),i})();function ei(i){var t=i.interactable,r=i.prepared;return t&&t.options&&r.name&&t.options[r.name].inertia}var Wr={id:"inertia",before:["modifiers","actions"],install:function(i){var t=i.defaults;i.usePlugin(nn),i.usePlugin(Ji),i.actions.phases.inertiastart=!0,i.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(i){var t=i.interaction;t.inertia=new Yr(t)},"interactions:before-action-end":function(i){var t=i.interaction,r=i.event;return(!t._interacting||t.simulation||!t.inertia.start(r))&&null},"interactions:down":function(i){var t=i.interaction,r=i.eventTarget,o=t.inertia;if(o.active)for(var l=r;v.element(l);){if(l===t.element){o.resume(i);break}l=ve(l)}},"interactions:stop":function(i){var t=i.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(i){var t=i.interaction.modification;t.stop(i),t.start(i,i.interaction.coords.cur.page),t.applyToInteraction(i)},"interactions:before-action-inertiastart":function(i){return i.interaction.modification.setAndApply(i)},"interactions:action-resume":Nt,"interactions:action-inertiastart":Nt,"interactions:after-action-inertiastart":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-resume":function(i){return i.interaction.modification.restoreInteractionCoords(i)}}};function rn(i,t,r,o){var l=1-i;return l*l*t+2*l*i*r+i*i*o}function on(i,t,r,o){return-r*(i/=o)*(i-2)+t}var Ur=Wr;function an(i,t){for(var r=0;r<t.length;r++){var o=t[r];if(i.immediatePropagationStopped)break;o(i)}}var sn=(function(){function i(t){a(this,i),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=X({},t||{})}return p(i,[{key:"fire",value:function(t){var r,o=this.global;(r=this.types[t.type])&&an(t,r),!t.propagationStopped&&o&&(r=o[t.type])&&an(t,r)}},{key:"on",value:function(t,r){var o=De(t,r);for(t in o)this.types[t]=we(this.types[t]||[],o[t])}},{key:"off",value:function(t,r){var o=De(t,r);for(t in o){var l=this.types[t];if(l&&l.length)for(var u=0,f=o[t];u<f.length;u++){var g=f[u],b=l.indexOf(g);b!==-1&&l.splice(b,1)}}}},{key:"getRect",value:function(t){return null}}]),i})(),Vr=(function(){function i(t){a(this,i),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,Re(this,t)}return p(i,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),i})();function jt(i){return v.object(i)?{capture:!!i.capture,passive:!!i.passive}:{capture:!!i,passive:!1}}function ti(i,t){return i===t||(typeof i=="boolean"?!!t.capture===i&&!t.passive:!!i.capture==!!t.capture&&!!i.passive==!!t.passive)}var Xr={id:"events",install:function(i){var t,r=[],o={},l=[],u={add:f,remove:g,addDelegate:function(_,E,I,N,F){var j=jt(F);if(!o[I]){o[I]=[];for(var U=0;U<l.length;U++){var W=l[U];f(W,I,b),f(W,I,S,!0)}}var Z=o[I],ce=ke(Z,(function(he){return he.selector===_&&he.context===E}));ce||(ce={selector:_,context:E,listeners:[]},Z.push(ce)),ce.listeners.push({func:N,options:j})},removeDelegate:function(_,E,I,N,F){var j,U=jt(F),W=o[I],Z=!1;if(W)for(j=W.length-1;j>=0;j--){var ce=W[j];if(ce.selector===_&&ce.context===E){for(var he=ce.listeners,ie=he.length-1;ie>=0;ie--){var de=he[ie];if(de.func===N&&ti(de.options,U)){he.splice(ie,1),he.length||(W.splice(j,1),g(E,I,b),g(E,I,S,!0)),Z=!0;break}}if(Z)break}}},delegateListener:b,delegateUseCapture:S,delegatedEvents:o,documents:l,targets:r,supportsOptions:!1,supportsPassive:!1};function f(_,E,I,N){if(_.addEventListener){var F=jt(N),j=ke(r,(function(U){return U.eventTarget===_}));j||(j={eventTarget:_,events:{}},r.push(j)),j.events[E]||(j.events[E]=[]),ke(j.events[E],(function(U){return U.func===I&&ti(U.options,F)}))||(_.addEventListener(E,I,u.supportsOptions?F:F.capture),j.events[E].push({func:I,options:F}))}}function g(_,E,I,N){if(_.addEventListener&&_.removeEventListener){var F=Se(r,(function(Xe){return Xe.eventTarget===_})),j=r[F];if(j&&j.events)if(E!=="all"){var U=!1,W=j.events[E];if(W){if(I==="all"){for(var Z=W.length-1;Z>=0;Z--){var ce=W[Z];g(_,E,ce.func,ce.options)}return}for(var he=jt(N),ie=0;ie<W.length;ie++){var de=W[ie];if(de.func===I&&ti(de.options,he)){_.removeEventListener(E,I,u.supportsOptions?he:he.capture),W.splice(ie,1),W.length===0&&(delete j.events[E],U=!0);break}}}U&&!Object.keys(j.events).length&&r.splice(F,1)}else for(E in j.events)j.events.hasOwnProperty(E)&&g(_,E,"all")}}function b(_,E){for(var I=jt(E),N=new Vr(_),F=o[_.type],j=Te(_)[0],U=j;v.element(U);){for(var W=0;W<F.length;W++){var Z=F[W],ce=Z.selector,he=Z.context;if(be(U,ce)&&pe(he,j)&&pe(he,U)){var ie=Z.listeners;N.currentTarget=U;for(var de=0;de<ie.length;de++){var Xe=ie[de];ti(Xe.options,I)&&Xe.func(N)}}}U=ve(U)}}function S(_){return b(_,!0)}return(t=i.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return u.supportsOptions=!0},get passive(){return u.supportsPassive=!0}}),i.events=u,u}},bi={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(i){for(var t=0,r=bi.methodOrder;t<r.length;t++){var o=r[t],l=bi[o](i);if(l)return l}return null},simulationResume:function(i){var t=i.pointerType,r=i.eventType,o=i.eventTarget,l=i.scope;if(!/down|start/i.test(r))return null;for(var u=0,f=l.interactions.list;u<f.length;u++){var g=f[u],b=o;if(g.simulation&&g.simulation.allowResume&&g.pointerType===t)for(;b;){if(b===g.element)return g;b=ve(b)}}return null},mouseOrPen:function(i){var t,r=i.pointerId,o=i.pointerType,l=i.eventType,u=i.scope;if(o!=="mouse"&&o!=="pen")return null;for(var f=0,g=u.interactions.list;f<g.length;f++){var b=g[f];if(b.pointerType===o){if(b.simulation&&!ln(b,r))continue;if(b.interacting())return b;t||(t=b)}}if(t)return t;for(var S=0,_=u.interactions.list;S<_.length;S++){var E=_[S];if(!(E.pointerType!==o||/down/i.test(l)&&E.simulation))return E}return null},hasPointer:function(i){for(var t=i.pointerId,r=0,o=i.scope.interactions.list;r<o.length;r++){var l=o[r];if(ln(l,t))return l}return null},idle:function(i){for(var t=i.pointerType,r=0,o=i.scope.interactions.list;r<o.length;r++){var l=o[r];if(l.pointers.length===1){var u=l.interactable;if(u&&(!u.options.gesture||!u.options.gesture.enabled))continue}else if(l.pointers.length>=2)continue;if(!l.interacting()&&t===l.pointerType)return l}return null}};function ln(i,t){return i.pointers.some((function(r){return r.id===t}))}var Gr=bi,_i=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function cn(i,t){return function(r){var o=t.interactions.list,l=me(r),u=Te(r),f=u[0],g=u[1],b=[];if(/^touch/.test(r.type)){t.prevTouchTime=t.now();for(var S=0,_=r.changedTouches;S<_.length;S++){var E=_[S],I={pointer:E,pointerId:We(E),pointerType:l,eventType:r.type,eventTarget:f,curEventTarget:g,scope:t},N=dn(I);b.push([I.pointer,I.eventTarget,I.curEventTarget,N])}}else{var F=!1;if(!se.supportsPointerEvent&&/mouse/.test(r.type)){for(var j=0;j<o.length&&!F;j++)F=o[j].pointerType!=="mouse"&&o[j].pointerIsDown;F=F||t.now()-t.prevTouchTime<500||r.timeStamp===0}if(!F){var U={pointer:r,pointerId:We(r),pointerType:l,eventType:r.type,curEventTarget:g,eventTarget:f,scope:t},W=dn(U);b.push([U.pointer,U.eventTarget,U.curEventTarget,W])}}for(var Z=0;Z<b.length;Z++){var ce=b[Z],he=ce[0],ie=ce[1],de=ce[2];ce[3][i](he,r,ie,de)}}}function dn(i){var t=i.pointerType,r=i.scope,o={interaction:Gr.search(i),searchDetails:i};return r.fire("interactions:find",o),o.interaction||r.interactions.new({pointerType:t})}function xi(i,t){var r=i.doc,o=i.scope,l=i.options,u=o.interactions.docEvents,f=o.events,g=f[t];for(var b in o.browser.isIOS&&!l.events&&(l.events={passive:!1}),f.delegatedEvents)g(r,b,f.delegateListener),g(r,b,f.delegateUseCapture,!0);for(var S=l&&l.events,_=0;_<u.length;_++){var E=u[_];g(r,E.type,E.listener,S)}}var Jr={id:"core/interactions",install:function(i){for(var t={},r=0;r<_i.length;r++){var o=_i[r];t[o]=cn(o,i)}var l,u=se.pEventTypes;function f(){for(var g=0,b=i.interactions.list;g<b.length;g++){var S=b[g];if(S.pointerIsDown&&S.pointerType==="touch"&&!S._interacting)for(var _=function(){var N=I[E];i.documents.some((function(F){return pe(F.doc,N.downTarget)}))||S.removePointer(N.pointer,N.event)},E=0,I=S.pointers;E<I.length;E++)_()}}(l=G.PointerEvent?[{type:u.down,listener:f},{type:u.down,listener:t.pointerDown},{type:u.move,listener:t.pointerMove},{type:u.up,listener:t.pointerUp},{type:u.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:f},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(g){for(var b=0,S=i.interactions.list;b<S.length;b++)S[b].documentBlur(g)}}),i.prevTouchTime=0,i.Interaction=(function(g){h(S,g);var b=w(S);function S(){return a(this,S),b.apply(this,arguments)}return p(S,[{key:"pointerMoveTolerance",get:function(){return i.interactions.pointerMoveTolerance},set:function(_){i.interactions.pointerMoveTolerance=_}},{key:"_now",value:function(){return i.now()}}]),S})(Hr),i.interactions={list:[],new:function(g){g.scopeFire=function(S,_){return i.fire(S,_)};var b=new i.Interaction(g);return i.interactions.list.push(b),b},listeners:t,docEvents:l,pointerMoveTolerance:1},i.usePlugin(Gi)},listeners:{"scope:add-document":function(i){return xi(i,"add")},"scope:remove-document":function(i){return xi(i,"remove")},"interactable:unset":function(i,t){for(var r=i.interactable,o=t.interactions.list.length-1;o>=0;o--){var l=t.interactions.list[o];l.interactable===r&&(l.stop(),t.fire("interactions:destroy",{interaction:l}),l.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(o,1))}}},onDocSignal:xi,doOnInteractions:cn,methodNames:_i},Qr=Jr,mt=(function(i){return i[i.On=0]="On",i[i.Off=1]="Off",i})(mt||{}),Zr=(function(){function i(t,r,o,l){a(this,i),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new sn,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=r.actions,this.target=t,this._context=r.context||o,this._win=C(Pe(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=l,this.set(r)}return p(i,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,r){return v.func(r.onstart)&&this.on("".concat(t,"start"),r.onstart),v.func(r.onmove)&&this.on("".concat(t,"move"),r.onmove),v.func(r.onend)&&this.on("".concat(t,"end"),r.onend),v.func(r.oninertiastart)&&this.on("".concat(t,"inertiastart"),r.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,r,o){var l,u=this,f=(l=this._actions.map[t])==null?void 0:l.filterEventType,g=function(b){return(f==null||f(b))&&Qt(b,u._actions)};(v.array(r)||v.object(r))&&this._onOff(mt.Off,t,r,void 0,g),(v.array(o)||v.object(o))&&this._onOff(mt.On,t,o,void 0,g)}},{key:"setPerAction",value:function(t,r){var o=this._defaults;for(var l in r){var u=l,f=this.options[t],g=r[u];u==="listeners"&&this.updatePerActionListeners(t,f.listeners,g),v.array(g)?f[u]=Me(g):v.plainObject(g)?(f[u]=X(f[u]||{},Mt(g)),v.object(o.perAction[u])&&"enabled"in o.perAction[u]&&(f[u].enabled=g.enabled!==!1)):v.bool(g)&&v.object(o.perAction[u])?f[u].enabled=g:f[u]=g}}},{key:"getRect",value:function(t){return t=t||(v.element(this.target)?this.target:null),v.string(this.target)&&(t=t||this._context.querySelector(this.target)),$e(t)}},{key:"rectChecker",value:function(t){var r=this;return v.func(t)?(this.getRect=function(o){var l=X({},t.apply(r,o));return"width"in l||(l.width=l.right-l.left,l.height=l.bottom-l.top),l},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,r){if(Pe(r)||v.object(r)){for(var o in this.options[t]=r,this._actions.map)this.options[o][t]=r;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return v.string(t)?Array.from(this._context.querySelectorAll(t)):v.func(t)&&t.getAllElements?t.getAllElements():v.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||pe(this._context,t)}},{key:"testIgnoreAllow",value:function(t,r,o){return!this.testIgnore(t.ignoreFrom,r,o)&&this.testAllow(t.allowFrom,r,o)}},{key:"testAllow",value:function(t,r,o){return!t||!!v.element(o)&&(v.string(t)?Le(o,t,r):!!v.element(t)&&pe(t,o))}},{key:"testIgnore",value:function(t,r,o){return!(!t||!v.element(o))&&(v.string(t)?Le(o,t,r):!!v.element(t)&&pe(t,o))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,r,o,l,u){v.object(r)&&!v.array(r)&&(l=o,o=null);var f=De(r,o,u);for(var g in f){g==="wheel"&&(g=se.wheelEvent);for(var b=0,S=f[g];b<S.length;b++){var _=S[b];Qt(g,this._actions)?this.events[t===mt.On?"on":"off"](g,_):v.string(this.target)?this._scopeEvents[t===mt.On?"addDelegate":"removeDelegate"](this.target,this._context,g,_,l):this._scopeEvents[t===mt.On?"add":"remove"](this.target,g,_,l)}}return this}},{key:"on",value:function(t,r,o){return this._onOff(mt.On,t,r,o)}},{key:"off",value:function(t,r,o){return this._onOff(mt.Off,t,r,o)}},{key:"set",value:function(t){var r=this._defaults;for(var o in v.object(t)||(t={}),this.options=Mt(r.base),this._actions.methodDict){var l=o,u=this._actions.methodDict[l];this.options[l]={},this.setPerAction(l,X(X({},r.perAction),r.actions[l])),this[u](t[l])}for(var f in t)f!=="getRect"?v.func(this[f])&&this[f](t[f]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(v.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var r=this._scopeEvents.delegatedEvents[t],o=r.length-1;o>=0;o--){var l=r[o],u=l.selector,f=l.context,g=l.listeners;u===this.target&&f===this._context&&r.splice(o,1);for(var b=g.length-1;b>=0;b--)this._scopeEvents.removeDelegate(this.target,this._context,t,g[b][0],g[b][1])}else this._scopeEvents.remove(this.target,"all")}}]),i})(),eo=(function(){function i(t){var r=this;a(this,i),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(o){var l=o.interactable,u=l.target,f=v.string(u)?r.selectorMap[u]:u[r.scope.id],g=Se(f,(function(b){return b===l}));f.splice(g,1)}})}return p(i,[{key:"new",value:function(t,r){r=X(r||{},{actions:this.scope.actions});var o=new this.scope.Interactable(t,r,this.scope.document,this.scope.events);return this.scope.addDocument(o._doc),this.list.push(o),v.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(o)):(o.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(o)),this.scope.fire("interactable:new",{target:t,options:r,interactable:o,win:this.scope._win}),o}},{key:"getExisting",value:function(t,r){var o=r&&r.context||this.scope.document,l=v.string(t),u=l?this.selectorMap[t]:t[this.scope.id];if(u)return ke(u,(function(f){return f._context===o&&(l||f.inContext(t))}))}},{key:"forEachMatch",value:function(t,r){for(var o=0,l=this.list;o<l.length;o++){var u=l[o],f=void 0;if((v.string(u.target)?v.element(t)&&be(t,u.target):t===u.target)&&u.inContext(t)&&(f=r(u)),f!==void 0)return f}}}]),i})(),to=(function(){function i(){var t=this;a(this,i),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=se,this.defaults=Mt(Qi),this.Eventable=sn,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(o){var l=function u(f,g){var b=o.interactables.getExisting(f,g);return b||((b=o.interactables.new(f,g)).events.global=u.globalEvents),b};return l.getPointerAverage=K,l.getTouchBBox=$,l.getTouchDistance=oe,l.getTouchAngle=Q,l.getElementRect=$e,l.getElementClientRect=Ke,l.matchesSelector=be,l.closest=Ae,l.globalEvents={},l.version="1.10.27",l.scope=o,l.use=function(u,f){return this.scope.usePlugin(u,f),this},l.isSet=function(u,f){return!!this.scope.interactables.get(u,f&&f.context)},l.on=Bt((function(u,f,g){if(v.string(u)&&u.search(" ")!==-1&&(u=u.trim().split(/ +/)),v.array(u)){for(var b=0,S=u;b<S.length;b++){var _=S[b];this.on(_,f,g)}return this}if(v.object(u)){for(var E in u)this.on(E,u[E],f);return this}return Qt(u,this.scope.actions)?this.globalEvents[u]?this.globalEvents[u].push(f):this.globalEvents[u]=[f]:this.scope.events.add(this.scope.document,u,f,{options:g}),this}),"The interact.on() method is being deprecated"),l.off=Bt((function(u,f,g){if(v.string(u)&&u.search(" ")!==-1&&(u=u.trim().split(/ +/)),v.array(u)){for(var b=0,S=u;b<S.length;b++){var _=S[b];this.off(_,f,g)}return this}if(v.object(u)){for(var E in u)this.off(E,u[E],f);return this}var I;return Qt(u,this.scope.actions)?u in this.globalEvents&&(I=this.globalEvents[u].indexOf(f))!==-1&&this.globalEvents[u].splice(I,1):this.scope.events.remove(this.scope.document,u,f,g),this}),"The interact.off() method is being deprecated"),l.debug=function(){return this.scope},l.supportsTouch=function(){return se.supportsTouch},l.supportsPointerEvent=function(){return se.supportsPointerEvent},l.stop=function(){for(var u=0,f=this.scope.interactions.list;u<f.length;u++)f[u].stop();return this},l.pointerMoveTolerance=function(u){return v.number(u)?(this.scope.interactions.pointerMoveTolerance=u,this):this.scope.interactions.pointerMoveTolerance},l.addDocument=function(u,f){this.scope.addDocument(u,f)},l.removeDocument=function(u){this.scope.removeDocument(u)},l})(this),this.InteractEvent=yi,this.Interactable=void 0,this.interactables=new eo(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(o){return t.removeDocument(o.target)};var r=this;this.Interactable=(function(o){h(u,o);var l=w(u);function u(){return a(this,u),l.apply(this,arguments)}return p(u,[{key:"_defaults",get:function(){return r.defaults}},{key:"set",value:function(f){return k(m(u.prototype),"set",this).call(this,f),r.fire("interactable:set",{options:f,interactable:this}),this}},{key:"unset",value:function(){k(m(u.prototype),"unset",this).call(this);var f=r.interactables.list.indexOf(this);f<0||(r.interactables.list.splice(f,1),r.fire("interactable:unset",{interactable:this}))}}]),u})(Zr)}return p(i,[{key:"addListeners",value:function(t,r){this.listenerMaps.push({id:r,map:t})}},{key:"fire",value:function(t,r){for(var o=0,l=this.listenerMaps;o<l.length;o++){var u=l[o].map[t];if(u&&u(r,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(r,o){return r.isInitialized=!0,v.window(o)&&D(o),G.init(o),se.init(o),ft.init(o),r.window=o,r.document=o.document,r.usePlugin(Qr),r.usePlugin(Xr),r})(this,t)}},{key:"pluginIsInstalled",value:function(t){var r=t.id;return r?!!this._plugins.map[r]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,r){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,r),t.listeners&&t.before){for(var o=0,l=this.listenerMaps.length,u=t.before.reduce((function(g,b){return g[b]=!0,g[un(b)]=!0,g}),{});o<l;o++){var f=this.listenerMaps[o].id;if(f&&(u[f]||u[un(f)]))break}this.listenerMaps.splice(o,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,r){if(this.getDocIndex(t)!==-1)return!1;var o=C(t);r=r?X({},r):{},this.documents.push({doc:t,options:r}),this.events.documents.push(t),t!==this.document&&this.events.add(o,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:o,scope:this,options:r})}},{key:"removeDocument",value:function(t){var r=this.getDocIndex(t),o=C(t),l=this.documents[r].options;this.events.remove(o,"unload",this.onWindowUnload),this.documents.splice(r,1),this.events.documents.splice(r,1),this.fire("scope:remove-document",{doc:t,window:o,scope:this,options:l})}},{key:"getDocIndex",value:function(t){for(var r=0;r<this.documents.length;r++)if(this.documents[r].doc===t)return r;return-1}},{key:"getDocOptions",value:function(t){var r=this.getDocIndex(t);return r===-1?null:this.documents[r].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),i})();function un(i){return i&&i.replace(/\/.*$/,"")}var pn=new to,Ve=pn.interactStatic,io=typeof globalThis!="undefined"?globalThis:window;pn.init(io);var no=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(i){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(o){var l=o[0],u=o[1];return l in i||u in i})),r=function(o,l){for(var u=i.range,f=i.limits,g=f===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:f,b=i.offset,S=b===void 0?{x:0,y:0}:b,_={range:u,grid:i,x:null,y:null},E=0;E<t.length;E++){var I=t[E],N=I[0],F=I[1],j=Math.round((o-S.x)/i[N]),U=Math.round((l-S.y)/i[F]);_[N]=Math.max(g.left,Math.min(g.right,j*i[N]+S.x)),_[F]=Math.max(g.top,Math.min(g.bottom,U*i[F]+S.y))}return _};return r.grid=i,r.coordFields=t,r}}),ro={id:"snappers",install:function(i){var t=i.interactStatic;t.snappers=X(t.snappers||{},no),t.createSnapGrid=t.snappers.grid}},oo=ro,ao={start:function(i){var t=i.state,r=i.rect,o=i.edges,l=i.pageCoords,u=t.options,f=u.ratio,g=u.enabled,b=t.options,S=b.equalDelta,_=b.modifiers;f==="preserve"&&(f=r.width/r.height),t.startCoords=X({},l),t.startRect=X({},r),t.ratio=f,t.equalDelta=S;var E=t.linkedEdges={top:o.top||o.left&&!o.bottom,left:o.left||o.top&&!o.right,bottom:o.bottom||o.right&&!o.top,right:o.right||o.bottom&&!o.left};if(t.xIsPrimaryAxis=!(!o.left&&!o.right),t.equalDelta){var I=(E.left?1:-1)*(E.top?1:-1);t.edgeSign={x:I,y:I}}else t.edgeSign={x:E.left?-1:1,y:E.top?-1:1};if(g!==!1&&X(o,E),_!=null&&_.length){var N=new mi(i.interaction);N.copyFrom(i.interaction.modification),N.prepareStates(_),t.subModification=N,N.startAll(d({},i))}},set:function(i){var t=i.state,r=i.rect,o=i.coords,l=t.linkedEdges,u=X({},o),f=t.equalDelta?so:lo;if(X(i.edges,l),f(t,t.xIsPrimaryAxis,o,r),!t.subModification)return null;var g=X({},r);ae(l,g,{x:o.x-u.x,y:o.y-u.y});var b=t.subModification.setAll(d(d({},i),{},{rect:g,edges:l,pageCoords:o,prevCoords:o,prevRect:g})),S=b.delta;return b.changed&&(f(t,Math.abs(S.x)>Math.abs(S.y),b.coords,b.rect),X(o,b.coords)),b.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function so(i,t,r){var o=i.startCoords,l=i.edgeSign;t?r.y=o.y+(r.x-o.x)*l.y:r.x=o.x+(r.y-o.y)*l.x}function lo(i,t,r,o){var l=i.startRect,u=i.startCoords,f=i.ratio,g=i.edgeSign;if(t){var b=o.width/f;r.y=u.y+(b-l.height)*g.y}else{var S=o.height*f;r.x=u.x+(S-l.width)*g.x}}var co=gt(ao,"aspectRatio"),hn=function(){};hn._defaults={};var ii=hn;function xt(i,t,r){return v.func(i)?je(i,t.interactable,t.element,[r.x,r.y,t]):je(i,t.interactable,t.element)}var ni={start:function(i){var t=i.rect,r=i.startOffset,o=i.state,l=i.interaction,u=i.pageCoords,f=o.options,g=f.elementRect,b=X({left:0,top:0,right:0,bottom:0},f.offset||{});if(t&&g){var S=xt(f.restriction,l,u);if(S){var _=S.right-S.left-t.width,E=S.bottom-S.top-t.height;_<0&&(b.left+=_,b.right+=_),E<0&&(b.top+=E,b.bottom+=E)}b.left+=r.left-t.width*g.left,b.top+=r.top-t.height*g.top,b.right+=r.right-t.width*(1-g.right),b.bottom+=r.bottom-t.height*(1-g.bottom)}o.offset=b},set:function(i){var t=i.coords,r=i.interaction,o=i.state,l=o.options,u=o.offset,f=xt(l.restriction,r,t);if(f){var g=(function(b){return!b||"left"in b&&"top"in b||((b=X({},b)).left=b.x||0,b.top=b.y||0,b.right=b.right||b.left+b.width,b.bottom=b.bottom||b.top+b.height),b})(f);t.x=Math.max(Math.min(g.right-u.right,t.x),g.left+u.left),t.y=Math.max(Math.min(g.bottom-u.bottom,t.y),g.top+u.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},uo=gt(ni,"restrict"),fn={top:1/0,left:1/0,bottom:-1/0,right:-1/0},gn={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function mn(i,t){for(var r=0,o=["top","left","bottom","right"];r<o.length;r++){var l=o[r];l in i||(i[l]=t[l])}return i}var qt={noInner:fn,noOuter:gn,start:function(i){var t,r=i.interaction,o=i.startOffset,l=i.state,u=l.options;u&&(t=H(xt(u.offset,r,r.coords.start.page))),t=t||{x:0,y:0},l.offset={top:t.y+o.top,left:t.x+o.left,bottom:t.y-o.bottom,right:t.x-o.right}},set:function(i){var t=i.coords,r=i.edges,o=i.interaction,l=i.state,u=l.offset,f=l.options;if(r){var g=X({},t),b=xt(f.inner,o,g)||{},S=xt(f.outer,o,g)||{};mn(b,fn),mn(S,gn),r.top?t.y=Math.min(Math.max(S.top+u.top,g.y),b.top+u.top):r.bottom&&(t.y=Math.max(Math.min(S.bottom+u.bottom,g.y),b.bottom+u.bottom)),r.left?t.x=Math.min(Math.max(S.left+u.left,g.x),b.left+u.left):r.right&&(t.x=Math.max(Math.min(S.right+u.right,g.x),b.right+u.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},po=gt(qt,"restrictEdges"),ho=X({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(i){}},ni.defaults),fo=gt({start:ni.start,set:ni.set,defaults:ho},"restrictRect"),go={width:-1/0,height:-1/0},mo={width:1/0,height:1/0},yo=gt({start:function(i){return qt.start(i)},set:function(i){var t=i.interaction,r=i.state,o=i.rect,l=i.edges,u=r.options;if(l){var f=fe(xt(u.min,t,i.coords))||go,g=fe(xt(u.max,t,i.coords))||mo;r.options={endOnly:u.endOnly,inner:X({},qt.noInner),outer:X({},qt.noOuter)},l.top?(r.options.inner.top=o.bottom-f.height,r.options.outer.top=o.bottom-g.height):l.bottom&&(r.options.inner.bottom=o.top+f.height,r.options.outer.bottom=o.top+g.height),l.left?(r.options.inner.left=o.right-f.width,r.options.outer.left=o.right-g.width):l.right&&(r.options.inner.right=o.left+f.width,r.options.outer.right=o.left+g.width),qt.set(i),r.options=u}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),wi={start:function(i){var t,r=i.interaction,o=i.interactable,l=i.element,u=i.rect,f=i.state,g=i.startOffset,b=f.options,S=b.offsetWithOrigin?(function(I){var N=I.interaction.element,F=H(je(I.state.options.origin,null,null,[N])),j=F||ye(I.interactable,N,I.interaction.prepared.name);return j})(i):{x:0,y:0};if(b.offset==="startCoords")t={x:r.coords.start.page.x,y:r.coords.start.page.y};else{var _=je(b.offset,o,l,[r]);(t=H(_)||{x:0,y:0}).x+=S.x,t.y+=S.y}var E=b.relativePoints;f.offsets=u&&E&&E.length?E.map((function(I,N){return{index:N,relativePoint:I,x:g.left-u.width*I.x+t.x,y:g.top-u.height*I.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(i){var t=i.interaction,r=i.coords,o=i.state,l=o.options,u=o.offsets,f=ye(t.interactable,t.element,t.prepared.name),g=X({},r),b=[];l.offsetWithOrigin||(g.x-=f.x,g.y-=f.y);for(var S=0,_=u;S<_.length;S++)for(var E=_[S],I=g.x-E.x,N=g.y-E.y,F=0,j=l.targets.length;F<j;F++){var U=l.targets[F],W=void 0;(W=v.func(U)?U(I,N,t._proxy,E,F):U)&&b.push({x:(v.number(W.x)?W.x:I)+E.x,y:(v.number(W.y)?W.y:N)+E.y,range:v.number(W.range)?W.range:l.range,source:U,index:F,offset:E})}for(var Z={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},ce=0;ce<b.length;ce++){var he=b[ce],ie=he.range,de=he.x-g.x,Xe=he.y-g.y,Ee=tt(de,Xe),et=Ee<=ie;ie===1/0&&Z.inRange&&Z.range!==1/0&&(et=!1),Z.target&&!(et?Z.inRange&&ie!==1/0?Ee/ie<Z.distance/Z.range:ie===1/0&&Z.range!==1/0||Ee<Z.distance:!Z.inRange&&Ee<Z.distance)||(Z.target=he,Z.distance=Ee,Z.range=ie,Z.inRange=et,Z.delta.x=de,Z.delta.y=Xe)}return Z.inRange&&(r.x=Z.target.x,r.y=Z.target.y),o.closest=Z,Z},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},vo=gt(wi,"snap"),ri={start:function(i){var t=i.state,r=i.edges,o=t.options;if(!r)return null;i.state={options:{targets:null,relativePoints:[{x:r.left?0:1,y:r.top?0:1}],offset:o.offset||"self",origin:{x:0,y:0},range:o.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],wi.start(i),t.offsets=i.state.offsets,i.state=t},set:function(i){var t=i.interaction,r=i.state,o=i.coords,l=r.options,u=r.offsets,f={x:o.x-u[0].x,y:o.y-u[0].y};r.options=X({},l),r.options.targets=[];for(var g=0,b=l.targets||[];g<b.length;g++){var S=b[g],_=void 0;if(_=v.func(S)?S(f.x,f.y,t):S){for(var E=0,I=r.targetFields;E<I.length;E++){var N=I[E],F=N[0],j=N[1];if(F in _||j in _){_.x=_[F],_.y=_[j];break}}r.options.targets.push(_)}}var U=wi.set(i);return r.options=l,U},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},bo=gt(ri,"snapSize"),Si={aspectRatio:co,restrictEdges:po,restrict:uo,restrictRect:fo,restrictSize:yo,snapEdges:gt({start:function(i){var t=i.edges;return t?(i.state.targetFields=i.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],ri.start(i)):null},set:ri.set,defaults:X(Mt(ri.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:vo,snapSize:bo,spring:ii,avoid:ii,transform:ii,rubberband:ii},_o={id:"modifiers",install:function(i){var t=i.interactStatic;for(var r in i.usePlugin(Ji),i.usePlugin(oo),t.modifiers=Si,Si){var o=Si[r],l=o._defaults,u=o._methods;l._methods=u,i.defaults.perAction[r]=l}}},xo=_o,yn=(function(i){h(r,i);var t=w(r);function r(o,l,u,f,g,b){var S;if(a(this,r),Re(y(S=t.call(this,g)),u),u!==l&&Re(y(S),l),S.timeStamp=b,S.originalEvent=u,S.type=o,S.pointerId=We(l),S.pointerType=me(l),S.target=f,S.currentTarget=null,o==="tap"){var _=g.getPointerIndex(l);S.dt=S.timeStamp-g.pointers[_].downTime;var E=S.timeStamp-g.tapTime;S.double=!!g.prevTap&&g.prevTap.type!=="doubletap"&&g.prevTap.target===S.target&&E<500}else o==="doubletap"&&(S.dt=l.timeStamp-g.tapTime,S.double=!0);return S}return p(r,[{key:"_subtractOrigin",value:function(o){var l=o.x,u=o.y;return this.pageX-=l,this.pageY-=u,this.clientX-=l,this.clientY-=u,this}},{key:"_addOrigin",value:function(o){var l=o.x,u=o.y;return this.pageX+=l,this.pageY+=u,this.clientX+=l,this.clientY+=u,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),r})(J),Ht={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(i){i.pointerEvents=Ht,i.defaults.actions.pointerEvents=Ht.defaults,X(i.actions.phaselessTypes,Ht.types)},listeners:{"interactions:new":function(i){var t=i.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(i){var t=i.down,r=i.pointerInfo;!t&&r.hold||(r.hold={duration:1/0,timeout:null})},"interactions:move":function(i,t){var r=i.interaction,o=i.pointer,l=i.event,u=i.eventTarget;i.duplicate||r.pointerIsDown&&!r.pointerWasMoved||(r.pointerIsDown&&ki(i),yt({interaction:r,pointer:o,event:l,eventTarget:u,type:"move"},t))},"interactions:down":function(i,t){(function(r,o){for(var l=r.interaction,u=r.pointer,f=r.event,g=r.eventTarget,b=r.pointerIndex,S=l.pointers[b].hold,_=Fe(g),E={interaction:l,pointer:u,event:f,eventTarget:g,type:"hold",targets:[],path:_,node:null},I=0;I<_.length;I++){var N=_[I];E.node=N,o.fire("pointerEvents:collect-targets",E)}if(E.targets.length){for(var F=1/0,j=0,U=E.targets;j<U.length;j++){var W=U[j].eventable.options.holdDuration;W<F&&(F=W)}S.duration=F,S.timeout=setTimeout((function(){yt({interaction:l,eventTarget:g,pointer:u,event:f,type:"hold"},o)}),F)}})(i,t),yt(i,t)},"interactions:up":function(i,t){ki(i),yt(i,t),(function(r,o){var l=r.interaction,u=r.pointer,f=r.event,g=r.eventTarget;l.pointerWasMoved||yt({interaction:l,eventTarget:g,pointer:u,event:f,type:"tap"},o)})(i,t)},"interactions:cancel":function(i,t){ki(i),yt(i,t)}},PointerEvent:yn,fire:yt,collectEventTargets:vn,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function yt(i,t){var r=i.interaction,o=i.pointer,l=i.event,u=i.eventTarget,f=i.type,g=i.targets,b=g===void 0?vn(i,t):g,S=new yn(f,o,l,u,r,t.now());t.fire("pointerEvents:new",{pointerEvent:S});for(var _={interaction:r,pointer:o,event:l,eventTarget:u,targets:b,type:f,pointerEvent:S},E=0;E<b.length;E++){var I=b[E];for(var N in I.props||{})S[N]=I.props[N];var F=ye(I.eventable,I.node);if(S._subtractOrigin(F),S.eventable=I.eventable,S.currentTarget=I.node,I.eventable.fire(S),S._addOrigin(F),S.immediatePropagationStopped||S.propagationStopped&&E+1<b.length&&b[E+1].node!==S.currentTarget)break}if(t.fire("pointerEvents:fired",_),f==="tap"){var j=S.double?yt({interaction:r,pointer:o,event:l,eventTarget:u,type:"doubletap"},t):S;r.prevTap=j,r.tapTime=j.timeStamp}return S}function vn(i,t){var r=i.interaction,o=i.pointer,l=i.event,u=i.eventTarget,f=i.type,g=r.getPointerIndex(o),b=r.pointers[g];if(f==="tap"&&(r.pointerWasMoved||!b||b.downTarget!==u))return[];for(var S=Fe(u),_={interaction:r,pointer:o,event:l,eventTarget:u,type:f,path:S,targets:[],node:null},E=0;E<S.length;E++){var I=S[E];_.node=I,t.fire("pointerEvents:collect-targets",_)}return f==="hold"&&(_.targets=_.targets.filter((function(N){var F,j;return N.eventable.options.holdDuration===((F=r.pointers[g])==null||(j=F.hold)==null?void 0:j.duration)}))),_.targets}function ki(i){var t=i.interaction,r=i.pointerIndex,o=t.pointers[r].hold;o&&o.timeout&&(clearTimeout(o.timeout),o.timeout=null)}var wo=Object.freeze({__proto__:null,default:Ht});function So(i){var t=i.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var ko={id:"pointer-events/holdRepeat",install:function(i){i.usePlugin(Ht);var t=i.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=i.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(i,t){return i["pointerEvents:".concat(t)]=So,i}),{"pointerEvents:new":function(i){var t=i.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(i,t){var r=i.interaction,o=i.pointerEvent,l=i.eventTarget,u=i.targets;if(o.type==="hold"&&u.length){var f=u[0].eventable.options.holdRepeatInterval;f<=0||(r.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:r,eventTarget:l,type:"hold",pointer:o,event:o},t)}),f))}}})},Co=ko,Eo={id:"pointer-events/interactableTargets",install:function(i){var t=i.Interactable;t.prototype.pointerEvents=function(o){return X(this.events.options,o),this};var r=t.prototype._backCompatOption;t.prototype._backCompatOption=function(o,l){var u=r.call(this,o,l);return u===this&&(this.events.options[o]=l),u}},listeners:{"pointerEvents:collect-targets":function(i,t){var r=i.targets,o=i.node,l=i.type,u=i.eventTarget;t.interactables.forEachMatch(o,(function(f){var g=f.events,b=g.options;g.types[l]&&g.types[l].length&&f.testIgnoreAllow(b,o,u)&&r.push({node:o,eventable:g,props:{interactable:f}})}))},"interactable:new":function(i){var t=i.interactable;t.events.getRect=function(r){return t.getRect(r)}},"interactable:set":function(i,t){var r=i.interactable,o=i.options;X(r.events.options,t.pointerEvents.defaults),X(r.events.options,o.pointerEvents||{})}}},Ao=Eo,Oo={id:"pointer-events",install:function(i){i.usePlugin(wo),i.usePlugin(Co),i.usePlugin(Ao)}},To=Oo,Mo={id:"reflow",install:function(i){var t=i.Interactable;i.actions.phases.reflow=!0,t.prototype.reflow=function(r){return(function(o,l,u){for(var f=o.getAllElements(),g=u.window.Promise,b=g?[]:null,S=function(){var E=f[_],I=o.getRect(E);if(!I)return 1;var N,F=ke(u.interactions.list,(function(W){return W.interacting()&&W.interactable===o&&W.element===E&&W.prepared.name===l.name}));if(F)F.move(),b&&(N=F._reflowPromise||new g((function(W){F._reflowResolve=W})));else{var j=fe(I),U=(function(W){return{coords:W,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:j.x,y:j.y},client:{x:j.x,y:j.y},timeStamp:u.now()});N=(function(W,Z,ce,he,ie){var de=W.interactions.new({pointerType:"reflow"}),Xe={interaction:de,event:ie,pointer:ie,eventTarget:ce,phase:"reflow"};de.interactable=Z,de.element=ce,de.prevEvent=ie,de.updatePointer(ie,ie,ce,!0),_e(de.coords.delta),pi(de.prepared,he),de._doPhase(Xe);var Ee=W.window,et=Ee.Promise,nt=et?new et((function(dt){de._reflowResolve=dt})):void 0;return de._reflowPromise=nt,de.start(he,Z,ce),de._interacting?(de.move(Xe),de.end(ie)):(de.stop(),de._reflowResolve()),de.removePointer(ie,ie),nt})(u,o,E,l,U)}b&&b.push(N)},_=0;_<f.length&&!S();_++);return b&&g.all(b).then((function(){return o}))})(this,r,i)}},listeners:{"interactions:stop":function(i,t){var r=i.interaction;r.pointerType==="reflow"&&(r._reflowResolve&&r._reflowResolve(),(function(o,l){o.splice(o.indexOf(l),1)})(t.interactions.list,r))}}},Po=Mo;if(Ve.use(Gi),Ve.use(nn),Ve.use(To),Ve.use(Ur),Ve.use(xo),Ve.use(Dr),Ve.use(Gt),Ve.use(Er),Ve.use(Po),Ve.default=Ve,(typeof wt=="undefined"?"undefined":n(wt))==="object"&&wt)try{wt.exports=Ve}catch{}return Ve.default=Ve,Ve}))});var kr=jo(_n(),1);function Rn(e){return typeof e=="undefined"||e===null}function qo(e){return typeof e=="object"&&e!==null}function Ho(e){return Array.isArray(e)?e:Rn(e)?[]:[e]}function Ko(e,d){var n,a,s,p;if(d)for(p=Object.keys(d),n=0,a=p.length;n<a;n+=1)s=p[n],e[s]=d[s];return e}function $o(e,d){var n="",a;for(a=0;a<d;a+=1)n+=e;return n}function Yo(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Wo=Rn,Uo=qo,Vo=Ho,Xo=$o,Go=Yo,Jo=Ko,ze={isNothing:Wo,isObject:Uo,toArray:Vo,repeat:Xo,isNegativeZero:Go,extend:Jo};function Fn(e,d){var n="",a=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!d&&e.mark.snippet&&(n+=`

`+e.mark.snippet),a+" "+n):a}function Yt(e,d){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=d,this.message=Fn(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Yt.prototype=Object.create(Error.prototype);Yt.prototype.constructor=Yt;Yt.prototype.toString=function(d){return this.name+": "+Fn(this,d)};var Ge=Yt;function Ai(e,d,n,a,s){var p="",c="",h=Math.floor(s/2)-1;return a-d>h&&(p=" ... ",d=a-h+p.length),n-a>h&&(c=" ...",n=a+h-c.length),{str:p+e.slice(d,n).replace(/\t/g,"\u2192")+c,pos:a-d+p.length}}function Oi(e,d){return ze.repeat(" ",d-e.length)+e}function Qo(e,d){if(d=Object.create(d||null),!e.buffer)return null;d.maxLength||(d.maxLength=79),typeof d.indent!="number"&&(d.indent=1),typeof d.linesBefore!="number"&&(d.linesBefore=3),typeof d.linesAfter!="number"&&(d.linesAfter=2);for(var n=/\r?\n|\r|\0/g,a=[0],s=[],p,c=-1;p=n.exec(e.buffer);)s.push(p.index),a.push(p.index+p[0].length),e.position<=p.index&&c<0&&(c=a.length-2);c<0&&(c=a.length-1);var h="",m,x,y=Math.min(e.line+d.linesAfter,s.length).toString().length,w=d.maxLength-(d.indent+y+3);for(m=1;m<=d.linesBefore&&!(c-m<0);m++)x=Ai(e.buffer,a[c-m],s[c-m],e.position-(a[c]-a[c-m]),w),h=ze.repeat(" ",d.indent)+Oi((e.line-m+1).toString(),y)+" | "+x.str+`
`+h;for(x=Ai(e.buffer,a[c],s[c],e.position,w),h+=ze.repeat(" ",d.indent)+Oi((e.line+1).toString(),y)+" | "+x.str+`
`,h+=ze.repeat("-",d.indent+y+3+x.pos)+`^
`,m=1;m<=d.linesAfter&&!(c+m>=s.length);m++)x=Ai(e.buffer,a[c+m],s[c+m],e.position-(a[c]-a[c+m]),w),h+=ze.repeat(" ",d.indent)+Oi((e.line+m+1).toString(),y)+" | "+x.str+`
`;return h.replace(/\n$/,"")}var Zo=Qo,ea=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],ta=["scalar","sequence","mapping"];function ia(e){var d={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(a){d[String(a)]=n})}),d}function na(e,d){if(d=d||{},Object.keys(d).forEach(function(n){if(ea.indexOf(n)===-1)throw new Ge('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=d,this.tag=e,this.kind=d.kind||null,this.resolve=d.resolve||function(){return!0},this.construct=d.construct||function(n){return n},this.instanceOf=d.instanceOf||null,this.predicate=d.predicate||null,this.represent=d.represent||null,this.representName=d.representName||null,this.defaultStyle=d.defaultStyle||null,this.multi=d.multi||!1,this.styleAliases=ia(d.styleAliases||null),ta.indexOf(this.kind)===-1)throw new Ge('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var Ne=na;function xn(e,d){var n=[];return e[d].forEach(function(a){var s=n.length;n.forEach(function(p,c){p.tag===a.tag&&p.kind===a.kind&&p.multi===a.multi&&(s=c)}),n[s]=a}),n}function ra(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},d,n;function a(s){s.multi?(e.multi[s.kind].push(s),e.multi.fallback.push(s)):e[s.kind][s.tag]=e.fallback[s.tag]=s}for(d=0,n=arguments.length;d<n;d+=1)arguments[d].forEach(a);return e}function Mi(e){return this.extend(e)}Mi.prototype.extend=function(d){var n=[],a=[];if(d instanceof Ne)a.push(d);else if(Array.isArray(d))a=a.concat(d);else if(d&&(Array.isArray(d.implicit)||Array.isArray(d.explicit)))d.implicit&&(n=n.concat(d.implicit)),d.explicit&&(a=a.concat(d.explicit));else throw new Ge("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(p){if(!(p instanceof Ne))throw new Ge("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(p.loadKind&&p.loadKind!=="scalar")throw new Ge("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(p.multi)throw new Ge("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),a.forEach(function(p){if(!(p instanceof Ne))throw new Ge("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var s=Object.create(Mi.prototype);return s.implicit=(this.implicit||[]).concat(n),s.explicit=(this.explicit||[]).concat(a),s.compiledImplicit=xn(s,"implicit"),s.compiledExplicit=xn(s,"explicit"),s.compiledTypeMap=ra(s.compiledImplicit,s.compiledExplicit),s};var Bn=Mi,Nn=new Ne("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),jn=new Ne("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),qn=new Ne("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Hn=new Bn({explicit:[Nn,jn,qn]});function oa(e){if(e===null)return!0;var d=e.length;return d===1&&e==="~"||d===4&&(e==="null"||e==="Null"||e==="NULL")}function aa(){return null}function sa(e){return e===null}var Kn=new Ne("tag:yaml.org,2002:null",{kind:"scalar",resolve:oa,construct:aa,predicate:sa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function la(e){if(e===null)return!1;var d=e.length;return d===4&&(e==="true"||e==="True"||e==="TRUE")||d===5&&(e==="false"||e==="False"||e==="FALSE")}function ca(e){return e==="true"||e==="True"||e==="TRUE"}function da(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var $n=new Ne("tag:yaml.org,2002:bool",{kind:"scalar",resolve:la,construct:ca,predicate:da,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ua(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function pa(e){return 48<=e&&e<=55}function ha(e){return 48<=e&&e<=57}function fa(e){if(e===null)return!1;var d=e.length,n=0,a=!1,s;if(!d)return!1;if(s=e[n],(s==="-"||s==="+")&&(s=e[++n]),s==="0"){if(n+1===d)return!0;if(s=e[++n],s==="b"){for(n++;n<d;n++)if(s=e[n],s!=="_"){if(s!=="0"&&s!=="1")return!1;a=!0}return a&&s!=="_"}if(s==="x"){for(n++;n<d;n++)if(s=e[n],s!=="_"){if(!ua(e.charCodeAt(n)))return!1;a=!0}return a&&s!=="_"}if(s==="o"){for(n++;n<d;n++)if(s=e[n],s!=="_"){if(!pa(e.charCodeAt(n)))return!1;a=!0}return a&&s!=="_"}}if(s==="_")return!1;for(;n<d;n++)if(s=e[n],s!=="_"){if(!ha(e.charCodeAt(n)))return!1;a=!0}return!(!a||s==="_")}function ga(e){var d=e,n=1,a;if(d.indexOf("_")!==-1&&(d=d.replace(/_/g,"")),a=d[0],(a==="-"||a==="+")&&(a==="-"&&(n=-1),d=d.slice(1),a=d[0]),d==="0")return 0;if(a==="0"){if(d[1]==="b")return n*parseInt(d.slice(2),2);if(d[1]==="x")return n*parseInt(d.slice(2),16);if(d[1]==="o")return n*parseInt(d.slice(2),8)}return n*parseInt(d,10)}function ma(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!ze.isNegativeZero(e)}var Yn=new Ne("tag:yaml.org,2002:int",{kind:"scalar",resolve:fa,construct:ga,predicate:ma,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ya=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function va(e){return!(e===null||!ya.test(e)||e[e.length-1]==="_")}function ba(e){var d,n;return d=e.replace(/_/g,"").toLowerCase(),n=d[0]==="-"?-1:1,"+-".indexOf(d[0])>=0&&(d=d.slice(1)),d===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:d===".nan"?NaN:n*parseFloat(d,10)}var _a=/^[-+]?[0-9]+e/;function xa(e,d){var n;if(isNaN(e))switch(d){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(d){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(d){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(ze.isNegativeZero(e))return"-0.0";return n=e.toString(10),_a.test(n)?n.replace("e",".e"):n}function wa(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||ze.isNegativeZero(e))}var Wn=new Ne("tag:yaml.org,2002:float",{kind:"scalar",resolve:va,construct:ba,predicate:wa,represent:xa,defaultStyle:"lowercase"}),Un=Hn.extend({implicit:[Kn,$n,Yn,Wn]}),Vn=Un,Xn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Gn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Sa(e){return e===null?!1:Xn.exec(e)!==null||Gn.exec(e)!==null}function ka(e){var d,n,a,s,p,c,h,m=0,x=null,y,w,k;if(d=Xn.exec(e),d===null&&(d=Gn.exec(e)),d===null)throw new Error("Date resolve error");if(n=+d[1],a=+d[2]-1,s=+d[3],!d[4])return new Date(Date.UTC(n,a,s));if(p=+d[4],c=+d[5],h=+d[6],d[7]){for(m=d[7].slice(0,3);m.length<3;)m+="0";m=+m}return d[9]&&(y=+d[10],w=+(d[11]||0),x=(y*60+w)*6e4,d[9]==="-"&&(x=-x)),k=new Date(Date.UTC(n,a,s,p,c,h,m)),x&&k.setTime(k.getTime()-x),k}function Ca(e){return e.toISOString()}var Jn=new Ne("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:Sa,construct:ka,instanceOf:Date,represent:Ca});function Ea(e){return e==="<<"||e===null}var Qn=new Ne("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Ea}),Di=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Aa(e){if(e===null)return!1;var d,n,a=0,s=e.length,p=Di;for(n=0;n<s;n++)if(d=p.indexOf(e.charAt(n)),!(d>64)){if(d<0)return!1;a+=6}return a%8===0}function Oa(e){var d,n,a=e.replace(/[\r\n=]/g,""),s=a.length,p=Di,c=0,h=[];for(d=0;d<s;d++)d%4===0&&d&&(h.push(c>>16&255),h.push(c>>8&255),h.push(c&255)),c=c<<6|p.indexOf(a.charAt(d));return n=s%4*6,n===0?(h.push(c>>16&255),h.push(c>>8&255),h.push(c&255)):n===18?(h.push(c>>10&255),h.push(c>>2&255)):n===12&&h.push(c>>4&255),new Uint8Array(h)}function Ta(e){var d="",n=0,a,s,p=e.length,c=Di;for(a=0;a<p;a++)a%3===0&&a&&(d+=c[n>>18&63],d+=c[n>>12&63],d+=c[n>>6&63],d+=c[n&63]),n=(n<<8)+e[a];return s=p%3,s===0?(d+=c[n>>18&63],d+=c[n>>12&63],d+=c[n>>6&63],d+=c[n&63]):s===2?(d+=c[n>>10&63],d+=c[n>>4&63],d+=c[n<<2&63],d+=c[64]):s===1&&(d+=c[n>>2&63],d+=c[n<<4&63],d+=c[64],d+=c[64]),d}function Ma(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Zn=new Ne("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Aa,construct:Oa,predicate:Ma,represent:Ta}),Pa=Object.prototype.hasOwnProperty,Ia=Object.prototype.toString;function La(e){if(e===null)return!0;var d=[],n,a,s,p,c,h=e;for(n=0,a=h.length;n<a;n+=1){if(s=h[n],c=!1,Ia.call(s)!=="[object Object]")return!1;for(p in s)if(Pa.call(s,p))if(!c)c=!0;else return!1;if(!c)return!1;if(d.indexOf(p)===-1)d.push(p);else return!1}return!0}function za(e){return e!==null?e:[]}var er=new Ne("tag:yaml.org,2002:omap",{kind:"sequence",resolve:La,construct:za}),Da=Object.prototype.toString;function Ra(e){if(e===null)return!0;var d,n,a,s,p,c=e;for(p=new Array(c.length),d=0,n=c.length;d<n;d+=1){if(a=c[d],Da.call(a)!=="[object Object]"||(s=Object.keys(a),s.length!==1))return!1;p[d]=[s[0],a[s[0]]]}return!0}function Fa(e){if(e===null)return[];var d,n,a,s,p,c=e;for(p=new Array(c.length),d=0,n=c.length;d<n;d+=1)a=c[d],s=Object.keys(a),p[d]=[s[0],a[s[0]]];return p}var tr=new Ne("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Ra,construct:Fa}),Ba=Object.prototype.hasOwnProperty;function Na(e){if(e===null)return!0;var d,n=e;for(d in n)if(Ba.call(n,d)&&n[d]!==null)return!1;return!0}function ja(e){return e!==null?e:{}}var ir=new Ne("tag:yaml.org,2002:set",{kind:"mapping",resolve:Na,construct:ja}),Ri=Vn.extend({implicit:[Jn,Qn],explicit:[Zn,er,tr,ir]}),bt=Object.prototype.hasOwnProperty,ai=1,nr=2,rr=3,si=4,Ti=1,qa=2,wn=3,Ha=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ka=/[\x85\u2028\u2029]/,$a=/[,\[\]\{\}]/,or=/^(?:!|!!|![a-z\-]+!)$/i,ar=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Sn(e){return Object.prototype.toString.call(e)}function ot(e){return e===10||e===13}function kt(e){return e===9||e===32}function Qe(e){return e===9||e===32||e===10||e===13}function It(e){return e===44||e===91||e===93||e===123||e===125}function Ya(e){var d;return 48<=e&&e<=57?e-48:(d=e|32,97<=d&&d<=102?d-97+10:-1)}function Wa(e){return e===120?2:e===117?4:e===85?8:0}function Ua(e){return 48<=e&&e<=57?e-48:-1}function kn(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Va(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var sr=new Array(256),lr=new Array(256);for(St=0;St<256;St++)sr[St]=kn(St)?1:0,lr[St]=kn(St);var St;function Xa(e,d){this.input=e,this.filename=d.filename||null,this.schema=d.schema||Ri,this.onWarning=d.onWarning||null,this.legacy=d.legacy||!1,this.json=d.json||!1,this.listener=d.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function cr(e,d){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=Zo(n),new Ge(d,n)}function ee(e,d){throw cr(e,d)}function li(e,d){e.onWarning&&e.onWarning.call(null,cr(e,d))}var Cn={YAML:function(d,n,a){var s,p,c;d.version!==null&&ee(d,"duplication of %YAML directive"),a.length!==1&&ee(d,"YAML directive accepts exactly one argument"),s=/^([0-9]+)\.([0-9]+)$/.exec(a[0]),s===null&&ee(d,"ill-formed argument of the YAML directive"),p=parseInt(s[1],10),c=parseInt(s[2],10),p!==1&&ee(d,"unacceptable YAML version of the document"),d.version=a[0],d.checkLineBreaks=c<2,c!==1&&c!==2&&li(d,"unsupported YAML version of the document")},TAG:function(d,n,a){var s,p;a.length!==2&&ee(d,"TAG directive accepts exactly two arguments"),s=a[0],p=a[1],or.test(s)||ee(d,"ill-formed tag handle (first argument) of the TAG directive"),bt.call(d.tagMap,s)&&ee(d,'there is a previously declared suffix for "'+s+'" tag handle'),ar.test(p)||ee(d,"ill-formed tag prefix (second argument) of the TAG directive");try{p=decodeURIComponent(p)}catch{ee(d,"tag prefix is malformed: "+p)}d.tagMap[s]=p}};function vt(e,d,n,a){var s,p,c,h;if(d<n){if(h=e.input.slice(d,n),a)for(s=0,p=h.length;s<p;s+=1)c=h.charCodeAt(s),c===9||32<=c&&c<=1114111||ee(e,"expected valid JSON character");else Ha.test(h)&&ee(e,"the stream contains non-printable characters");e.result+=h}}function En(e,d,n,a){var s,p,c,h;for(ze.isObject(n)||ee(e,"cannot merge mappings; the provided source object is unacceptable"),s=Object.keys(n),c=0,h=s.length;c<h;c+=1)p=s[c],bt.call(d,p)||(d[p]=n[p],a[p]=!0)}function Lt(e,d,n,a,s,p,c,h,m){var x,y;if(Array.isArray(s))for(s=Array.prototype.slice.call(s),x=0,y=s.length;x<y;x+=1)Array.isArray(s[x])&&ee(e,"nested arrays are not supported inside keys"),typeof s=="object"&&Sn(s[x])==="[object Object]"&&(s[x]="[object Object]");if(typeof s=="object"&&Sn(s)==="[object Object]"&&(s="[object Object]"),s=String(s),d===null&&(d={}),a==="tag:yaml.org,2002:merge")if(Array.isArray(p))for(x=0,y=p.length;x<y;x+=1)En(e,d,p[x],n);else En(e,d,p,n);else!e.json&&!bt.call(n,s)&&bt.call(d,s)&&(e.line=c||e.line,e.lineStart=h||e.lineStart,e.position=m||e.position,ee(e,"duplicated mapping key")),s==="__proto__"?Object.defineProperty(d,s,{configurable:!0,enumerable:!0,writable:!0,value:p}):d[s]=p,delete n[s];return d}function Fi(e){var d;d=e.input.charCodeAt(e.position),d===10?e.position++:d===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):ee(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function Ie(e,d,n){for(var a=0,s=e.input.charCodeAt(e.position);s!==0;){for(;kt(s);)s===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),s=e.input.charCodeAt(++e.position);if(d&&s===35)do s=e.input.charCodeAt(++e.position);while(s!==10&&s!==13&&s!==0);if(ot(s))for(Fi(e),s=e.input.charCodeAt(e.position),a++,e.lineIndent=0;s===32;)e.lineIndent++,s=e.input.charCodeAt(++e.position);else break}return n!==-1&&a!==0&&e.lineIndent<n&&li(e,"deficient indentation"),a}function ui(e){var d=e.position,n;return n=e.input.charCodeAt(d),!!((n===45||n===46)&&n===e.input.charCodeAt(d+1)&&n===e.input.charCodeAt(d+2)&&(d+=3,n=e.input.charCodeAt(d),n===0||Qe(n)))}function Bi(e,d){d===1?e.result+=" ":d>1&&(e.result+=ze.repeat(`
`,d-1))}function Ga(e,d,n){var a,s,p,c,h,m,x,y,w=e.kind,k=e.result,O;if(O=e.input.charCodeAt(e.position),Qe(O)||It(O)||O===35||O===38||O===42||O===33||O===124||O===62||O===39||O===34||O===37||O===64||O===96||(O===63||O===45)&&(s=e.input.charCodeAt(e.position+1),Qe(s)||n&&It(s)))return!1;for(e.kind="scalar",e.result="",p=c=e.position,h=!1;O!==0;){if(O===58){if(s=e.input.charCodeAt(e.position+1),Qe(s)||n&&It(s))break}else if(O===35){if(a=e.input.charCodeAt(e.position-1),Qe(a))break}else{if(e.position===e.lineStart&&ui(e)||n&&It(O))break;if(ot(O))if(m=e.line,x=e.lineStart,y=e.lineIndent,Ie(e,!1,-1),e.lineIndent>=d){h=!0,O=e.input.charCodeAt(e.position);continue}else{e.position=c,e.line=m,e.lineStart=x,e.lineIndent=y;break}}h&&(vt(e,p,c,!1),Bi(e,e.line-m),p=c=e.position,h=!1),kt(O)||(c=e.position+1),O=e.input.charCodeAt(++e.position)}return vt(e,p,c,!1),e.result?!0:(e.kind=w,e.result=k,!1)}function Ja(e,d){var n,a,s;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,a=s=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(vt(e,a,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)a=e.position,e.position++,s=e.position;else return!0;else ot(n)?(vt(e,a,s,!0),Bi(e,Ie(e,!1,d)),a=s=e.position):e.position===e.lineStart&&ui(e)?ee(e,"unexpected end of the document within a single quoted scalar"):(e.position++,s=e.position);ee(e,"unexpected end of the stream within a single quoted scalar")}function Qa(e,d){var n,a,s,p,c,h;if(h=e.input.charCodeAt(e.position),h!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=a=e.position;(h=e.input.charCodeAt(e.position))!==0;){if(h===34)return vt(e,n,e.position,!0),e.position++,!0;if(h===92){if(vt(e,n,e.position,!0),h=e.input.charCodeAt(++e.position),ot(h))Ie(e,!1,d);else if(h<256&&sr[h])e.result+=lr[h],e.position++;else if((c=Wa(h))>0){for(s=c,p=0;s>0;s--)h=e.input.charCodeAt(++e.position),(c=Ya(h))>=0?p=(p<<4)+c:ee(e,"expected hexadecimal character");e.result+=Va(p),e.position++}else ee(e,"unknown escape sequence");n=a=e.position}else ot(h)?(vt(e,n,a,!0),Bi(e,Ie(e,!1,d)),n=a=e.position):e.position===e.lineStart&&ui(e)?ee(e,"unexpected end of the document within a double quoted scalar"):(e.position++,a=e.position)}ee(e,"unexpected end of the stream within a double quoted scalar")}function Za(e,d){var n=!0,a,s,p,c=e.tag,h,m=e.anchor,x,y,w,k,O,z=Object.create(null),A,M,D,C;if(C=e.input.charCodeAt(e.position),C===91)y=93,O=!1,h=[];else if(C===123)y=125,O=!0,h={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=h),C=e.input.charCodeAt(++e.position);C!==0;){if(Ie(e,!0,d),C=e.input.charCodeAt(e.position),C===y)return e.position++,e.tag=c,e.anchor=m,e.kind=O?"mapping":"sequence",e.result=h,!0;n?C===44&&ee(e,"expected the node content, but found ','"):ee(e,"missed comma between flow collection entries"),M=A=D=null,w=k=!1,C===63&&(x=e.input.charCodeAt(e.position+1),Qe(x)&&(w=k=!0,e.position++,Ie(e,!0,d))),a=e.line,s=e.lineStart,p=e.position,zt(e,d,ai,!1,!0),M=e.tag,A=e.result,Ie(e,!0,d),C=e.input.charCodeAt(e.position),(k||e.line===a)&&C===58&&(w=!0,C=e.input.charCodeAt(++e.position),Ie(e,!0,d),zt(e,d,ai,!1,!0),D=e.result),O?Lt(e,h,z,M,A,D,a,s,p):w?h.push(Lt(e,null,z,M,A,D,a,s,p)):h.push(A),Ie(e,!0,d),C=e.input.charCodeAt(e.position),C===44?(n=!0,C=e.input.charCodeAt(++e.position)):n=!1}ee(e,"unexpected end of the stream within a flow collection")}function es(e,d){var n,a,s=Ti,p=!1,c=!1,h=d,m=0,x=!1,y,w;if(w=e.input.charCodeAt(e.position),w===124)a=!1;else if(w===62)a=!0;else return!1;for(e.kind="scalar",e.result="";w!==0;)if(w=e.input.charCodeAt(++e.position),w===43||w===45)Ti===s?s=w===43?wn:qa:ee(e,"repeat of a chomping mode identifier");else if((y=Ua(w))>=0)y===0?ee(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):c?ee(e,"repeat of an indentation width identifier"):(h=d+y-1,c=!0);else break;if(kt(w)){do w=e.input.charCodeAt(++e.position);while(kt(w));if(w===35)do w=e.input.charCodeAt(++e.position);while(!ot(w)&&w!==0)}for(;w!==0;){for(Fi(e),e.lineIndent=0,w=e.input.charCodeAt(e.position);(!c||e.lineIndent<h)&&w===32;)e.lineIndent++,w=e.input.charCodeAt(++e.position);if(!c&&e.lineIndent>h&&(h=e.lineIndent),ot(w)){m++;continue}if(e.lineIndent<h){s===wn?e.result+=ze.repeat(`
`,p?1+m:m):s===Ti&&p&&(e.result+=`
`);break}for(a?kt(w)?(x=!0,e.result+=ze.repeat(`
`,p?1+m:m)):x?(x=!1,e.result+=ze.repeat(`
`,m+1)):m===0?p&&(e.result+=" "):e.result+=ze.repeat(`
`,m):e.result+=ze.repeat(`
`,p?1+m:m),p=!0,c=!0,m=0,n=e.position;!ot(w)&&w!==0;)w=e.input.charCodeAt(++e.position);vt(e,n,e.position,!1)}return!0}function An(e,d){var n,a=e.tag,s=e.anchor,p=[],c,h=!1,m;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=p),m=e.input.charCodeAt(e.position);m!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ee(e,"tab characters must not be used in indentation")),!(m!==45||(c=e.input.charCodeAt(e.position+1),!Qe(c))));){if(h=!0,e.position++,Ie(e,!0,-1)&&e.lineIndent<=d){p.push(null),m=e.input.charCodeAt(e.position);continue}if(n=e.line,zt(e,d,rr,!1,!0),p.push(e.result),Ie(e,!0,-1),m=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>d)&&m!==0)ee(e,"bad indentation of a sequence entry");else if(e.lineIndent<d)break}return h?(e.tag=a,e.anchor=s,e.kind="sequence",e.result=p,!0):!1}function ts(e,d,n){var a,s,p,c,h,m,x=e.tag,y=e.anchor,w={},k=Object.create(null),O=null,z=null,A=null,M=!1,D=!1,C;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=w),C=e.input.charCodeAt(e.position);C!==0;){if(!M&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ee(e,"tab characters must not be used in indentation")),a=e.input.charCodeAt(e.position+1),p=e.line,(C===63||C===58)&&Qe(a))C===63?(M&&(Lt(e,w,k,O,z,null,c,h,m),O=z=A=null),D=!0,M=!0,s=!0):M?(M=!1,s=!0):ee(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,C=a;else{if(c=e.line,h=e.lineStart,m=e.position,!zt(e,n,nr,!1,!0))break;if(e.line===p){for(C=e.input.charCodeAt(e.position);kt(C);)C=e.input.charCodeAt(++e.position);if(C===58)C=e.input.charCodeAt(++e.position),Qe(C)||ee(e,"a whitespace character is expected after the key-value separator within a block mapping"),M&&(Lt(e,w,k,O,z,null,c,h,m),O=z=A=null),D=!0,M=!1,s=!1,O=e.tag,z=e.result;else if(D)ee(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=x,e.anchor=y,!0}else if(D)ee(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=x,e.anchor=y,!0}if((e.line===p||e.lineIndent>d)&&(M&&(c=e.line,h=e.lineStart,m=e.position),zt(e,d,si,!0,s)&&(M?z=e.result:A=e.result),M||(Lt(e,w,k,O,z,A,c,h,m),O=z=A=null),Ie(e,!0,-1),C=e.input.charCodeAt(e.position)),(e.line===p||e.lineIndent>d)&&C!==0)ee(e,"bad indentation of a mapping entry");else if(e.lineIndent<d)break}return M&&Lt(e,w,k,O,z,null,c,h,m),D&&(e.tag=x,e.anchor=y,e.kind="mapping",e.result=w),D}function is(e){var d,n=!1,a=!1,s,p,c;if(c=e.input.charCodeAt(e.position),c!==33)return!1;if(e.tag!==null&&ee(e,"duplication of a tag property"),c=e.input.charCodeAt(++e.position),c===60?(n=!0,c=e.input.charCodeAt(++e.position)):c===33?(a=!0,s="!!",c=e.input.charCodeAt(++e.position)):s="!",d=e.position,n){do c=e.input.charCodeAt(++e.position);while(c!==0&&c!==62);e.position<e.length?(p=e.input.slice(d,e.position),c=e.input.charCodeAt(++e.position)):ee(e,"unexpected end of the stream within a verbatim tag")}else{for(;c!==0&&!Qe(c);)c===33&&(a?ee(e,"tag suffix cannot contain exclamation marks"):(s=e.input.slice(d-1,e.position+1),or.test(s)||ee(e,"named tag handle cannot contain such characters"),a=!0,d=e.position+1)),c=e.input.charCodeAt(++e.position);p=e.input.slice(d,e.position),$a.test(p)&&ee(e,"tag suffix cannot contain flow indicator characters")}p&&!ar.test(p)&&ee(e,"tag name cannot contain such characters: "+p);try{p=decodeURIComponent(p)}catch{ee(e,"tag name is malformed: "+p)}return n?e.tag=p:bt.call(e.tagMap,s)?e.tag=e.tagMap[s]+p:s==="!"?e.tag="!"+p:s==="!!"?e.tag="tag:yaml.org,2002:"+p:ee(e,'undeclared tag handle "'+s+'"'),!0}function ns(e){var d,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&ee(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),d=e.position;n!==0&&!Qe(n)&&!It(n);)n=e.input.charCodeAt(++e.position);return e.position===d&&ee(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(d,e.position),!0}function rs(e){var d,n,a;if(a=e.input.charCodeAt(e.position),a!==42)return!1;for(a=e.input.charCodeAt(++e.position),d=e.position;a!==0&&!Qe(a)&&!It(a);)a=e.input.charCodeAt(++e.position);return e.position===d&&ee(e,"name of an alias node must contain at least one character"),n=e.input.slice(d,e.position),bt.call(e.anchorMap,n)||ee(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],Ie(e,!0,-1),!0}function zt(e,d,n,a,s){var p,c,h,m=1,x=!1,y=!1,w,k,O,z,A,M;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,p=c=h=si===n||rr===n,a&&Ie(e,!0,-1)&&(x=!0,e.lineIndent>d?m=1:e.lineIndent===d?m=0:e.lineIndent<d&&(m=-1)),m===1)for(;is(e)||ns(e);)Ie(e,!0,-1)?(x=!0,h=p,e.lineIndent>d?m=1:e.lineIndent===d?m=0:e.lineIndent<d&&(m=-1)):h=!1;if(h&&(h=x||s),(m===1||si===n)&&(ai===n||nr===n?A=d:A=d+1,M=e.position-e.lineStart,m===1?h&&(An(e,M)||ts(e,M,A))||Za(e,A)?y=!0:(c&&es(e,A)||Ja(e,A)||Qa(e,A)?y=!0:rs(e)?(y=!0,(e.tag!==null||e.anchor!==null)&&ee(e,"alias node should not have any properties")):Ga(e,A,ai===n)&&(y=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m===0&&(y=h&&An(e,M))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&ee(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),w=0,k=e.implicitTypes.length;w<k;w+=1)if(z=e.implicitTypes[w],z.resolve(e.result)){e.result=z.construct(e.result),e.tag=z.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(bt.call(e.typeMap[e.kind||"fallback"],e.tag))z=e.typeMap[e.kind||"fallback"][e.tag];else for(z=null,O=e.typeMap.multi[e.kind||"fallback"],w=0,k=O.length;w<k;w+=1)if(e.tag.slice(0,O[w].tag.length)===O[w].tag){z=O[w];break}z||ee(e,"unknown tag !<"+e.tag+">"),e.result!==null&&z.kind!==e.kind&&ee(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+z.kind+'", not "'+e.kind+'"'),z.resolve(e.result,e.tag)?(e.result=z.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):ee(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||y}function os(e){var d=e.position,n,a,s,p=!1,c;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(c=e.input.charCodeAt(e.position))!==0&&(Ie(e,!0,-1),c=e.input.charCodeAt(e.position),!(e.lineIndent>0||c!==37));){for(p=!0,c=e.input.charCodeAt(++e.position),n=e.position;c!==0&&!Qe(c);)c=e.input.charCodeAt(++e.position);for(a=e.input.slice(n,e.position),s=[],a.length<1&&ee(e,"directive name must not be less than one character in length");c!==0;){for(;kt(c);)c=e.input.charCodeAt(++e.position);if(c===35){do c=e.input.charCodeAt(++e.position);while(c!==0&&!ot(c));break}if(ot(c))break;for(n=e.position;c!==0&&!Qe(c);)c=e.input.charCodeAt(++e.position);s.push(e.input.slice(n,e.position))}c!==0&&Fi(e),bt.call(Cn,a)?Cn[a](e,a,s):li(e,'unknown document directive "'+a+'"')}if(Ie(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,Ie(e,!0,-1)):p&&ee(e,"directives end mark is expected"),zt(e,e.lineIndent-1,si,!1,!0),Ie(e,!0,-1),e.checkLineBreaks&&Ka.test(e.input.slice(d,e.position))&&li(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&ui(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,Ie(e,!0,-1));return}if(e.position<e.length-1)ee(e,"end of the stream or a document separator is expected");else return}function dr(e,d){e=String(e),d=d||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new Xa(e,d),a=e.indexOf("\0");for(a!==-1&&(n.position=a,ee(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)os(n);return n.documents}function as(e,d,n){d!==null&&typeof d=="object"&&typeof n=="undefined"&&(n=d,d=null);var a=dr(e,n);if(typeof d!="function")return a;for(var s=0,p=a.length;s<p;s+=1)d(a[s])}function ss(e,d){var n=dr(e,d);if(n.length!==0){if(n.length===1)return n[0];throw new Ge("expected a single document in the stream, but found more")}}var ls=as,cs=ss,ur={loadAll:ls,load:cs},pr=Object.prototype.toString,hr=Object.prototype.hasOwnProperty,Ni=65279,ds=9,Wt=10,us=13,ps=32,hs=33,fs=34,Pi=35,gs=37,ms=38,ys=39,vs=42,fr=44,bs=45,ci=58,_s=61,xs=62,ws=63,Ss=64,gr=91,mr=93,ks=96,yr=123,Cs=124,vr=125,He={};He[0]="\\0";He[7]="\\a";He[8]="\\b";He[9]="\\t";He[10]="\\n";He[11]="\\v";He[12]="\\f";He[13]="\\r";He[27]="\\e";He[34]='\\"';He[92]="\\\\";He[133]="\\N";He[160]="\\_";He[8232]="\\L";He[8233]="\\P";var Es=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],As=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Os(e,d){var n,a,s,p,c,h,m;if(d===null)return{};for(n={},a=Object.keys(d),s=0,p=a.length;s<p;s+=1)c=a[s],h=String(d[c]),c.slice(0,2)==="!!"&&(c="tag:yaml.org,2002:"+c.slice(2)),m=e.compiledTypeMap.fallback[c],m&&hr.call(m.styleAliases,h)&&(h=m.styleAliases[h]),n[c]=h;return n}function Ts(e){var d,n,a;if(d=e.toString(16).toUpperCase(),e<=255)n="x",a=2;else if(e<=65535)n="u",a=4;else if(e<=4294967295)n="U",a=8;else throw new Ge("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+ze.repeat("0",a-d.length)+d}var Ms=1,Ut=2;function Ps(e){this.schema=e.schema||Ri,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=ze.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Os(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Ut:Ms,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function On(e,d){for(var n=ze.repeat(" ",d),a=0,s=-1,p="",c,h=e.length;a<h;)s=e.indexOf(`
`,a),s===-1?(c=e.slice(a),a=h):(c=e.slice(a,s+1),a=s+1),c.length&&c!==`
`&&(p+=n),p+=c;return p}function Ii(e,d){return`
`+ze.repeat(" ",e.indent*d)}function Is(e,d){var n,a,s;for(n=0,a=e.implicitTypes.length;n<a;n+=1)if(s=e.implicitTypes[n],s.resolve(d))return!0;return!1}function di(e){return e===ps||e===ds}function Vt(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Ni||65536<=e&&e<=1114111}function Tn(e){return Vt(e)&&e!==Ni&&e!==us&&e!==Wt}function Mn(e,d,n){var a=Tn(e),s=a&&!di(e);return(n?a:a&&e!==fr&&e!==gr&&e!==mr&&e!==yr&&e!==vr)&&e!==Pi&&!(d===ci&&!s)||Tn(d)&&!di(d)&&e===Pi||d===ci&&s}function Ls(e){return Vt(e)&&e!==Ni&&!di(e)&&e!==bs&&e!==ws&&e!==ci&&e!==fr&&e!==gr&&e!==mr&&e!==yr&&e!==vr&&e!==Pi&&e!==ms&&e!==vs&&e!==hs&&e!==Cs&&e!==_s&&e!==xs&&e!==ys&&e!==fs&&e!==gs&&e!==Ss&&e!==ks}function zs(e){return!di(e)&&e!==ci}function $t(e,d){var n=e.charCodeAt(d),a;return n>=55296&&n<=56319&&d+1<e.length&&(a=e.charCodeAt(d+1),a>=56320&&a<=57343)?(n-55296)*1024+a-56320+65536:n}function br(e){var d=/^\n* /;return d.test(e)}var _r=1,Li=2,xr=3,wr=4,Pt=5;function Ds(e,d,n,a,s,p,c,h){var m,x=0,y=null,w=!1,k=!1,O=a!==-1,z=-1,A=Ls($t(e,0))&&zs($t(e,e.length-1));if(d||c)for(m=0;m<e.length;x>=65536?m+=2:m++){if(x=$t(e,m),!Vt(x))return Pt;A=A&&Mn(x,y,h),y=x}else{for(m=0;m<e.length;x>=65536?m+=2:m++){if(x=$t(e,m),x===Wt)w=!0,O&&(k=k||m-z-1>a&&e[z+1]!==" ",z=m);else if(!Vt(x))return Pt;A=A&&Mn(x,y,h),y=x}k=k||O&&m-z-1>a&&e[z+1]!==" "}return!w&&!k?A&&!c&&!s(e)?_r:p===Ut?Pt:Li:n>9&&br(e)?Pt:c?p===Ut?Pt:Li:k?wr:xr}function Rs(e,d,n,a,s){e.dump=(function(){if(d.length===0)return e.quotingType===Ut?'""':"''";if(!e.noCompatMode&&(Es.indexOf(d)!==-1||As.test(d)))return e.quotingType===Ut?'"'+d+'"':"'"+d+"'";var p=e.indent*Math.max(1,n),c=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-p),h=a||e.flowLevel>-1&&n>=e.flowLevel;function m(x){return Is(e,x)}switch(Ds(d,h,e.indent,c,m,e.quotingType,e.forceQuotes&&!a,s)){case _r:return d;case Li:return"'"+d.replace(/'/g,"''")+"'";case xr:return"|"+Pn(d,e.indent)+In(On(d,p));case wr:return">"+Pn(d,e.indent)+In(On(Fs(d,c),p));case Pt:return'"'+Bs(d)+'"';default:throw new Ge("impossible error: invalid scalar style")}})()}function Pn(e,d){var n=br(e)?String(d):"",a=e[e.length-1]===`
`,s=a&&(e[e.length-2]===`
`||e===`
`),p=s?"+":a?"":"-";return n+p+`
`}function In(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Fs(e,d){for(var n=/(\n+)([^\n]*)/g,a=(function(){var x=e.indexOf(`
`);return x=x!==-1?x:e.length,n.lastIndex=x,Ln(e.slice(0,x),d)})(),s=e[0]===`
`||e[0]===" ",p,c;c=n.exec(e);){var h=c[1],m=c[2];p=m[0]===" ",a+=h+(!s&&!p&&m!==""?`
`:"")+Ln(m,d),s=p}return a}function Ln(e,d){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,a,s=0,p,c=0,h=0,m="";a=n.exec(e);)h=a.index,h-s>d&&(p=c>s?c:h,m+=`
`+e.slice(s,p),s=p+1),c=h;return m+=`
`,e.length-s>d&&c>s?m+=e.slice(s,c)+`
`+e.slice(c+1):m+=e.slice(s),m.slice(1)}function Bs(e){for(var d="",n=0,a,s=0;s<e.length;n>=65536?s+=2:s++)n=$t(e,s),a=He[n],!a&&Vt(n)?(d+=e[s],n>=65536&&(d+=e[s+1])):d+=a||Ts(n);return d}function Ns(e,d,n){var a="",s=e.tag,p,c,h;for(p=0,c=n.length;p<c;p+=1)h=n[p],e.replacer&&(h=e.replacer.call(n,String(p),h)),(ut(e,d,h,!1,!1)||typeof h=="undefined"&&ut(e,d,null,!1,!1))&&(a!==""&&(a+=","+(e.condenseFlow?"":" ")),a+=e.dump);e.tag=s,e.dump="["+a+"]"}function zn(e,d,n,a){var s="",p=e.tag,c,h,m;for(c=0,h=n.length;c<h;c+=1)m=n[c],e.replacer&&(m=e.replacer.call(n,String(c),m)),(ut(e,d+1,m,!0,!0,!1,!0)||typeof m=="undefined"&&ut(e,d+1,null,!0,!0,!1,!0))&&((!a||s!=="")&&(s+=Ii(e,d)),e.dump&&Wt===e.dump.charCodeAt(0)?s+="-":s+="- ",s+=e.dump);e.tag=p,e.dump=s||"[]"}function js(e,d,n){var a="",s=e.tag,p=Object.keys(n),c,h,m,x,y;for(c=0,h=p.length;c<h;c+=1)y="",a!==""&&(y+=", "),e.condenseFlow&&(y+='"'),m=p[c],x=n[m],e.replacer&&(x=e.replacer.call(n,m,x)),ut(e,d,m,!1,!1)&&(e.dump.length>1024&&(y+="? "),y+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),ut(e,d,x,!1,!1)&&(y+=e.dump,a+=y));e.tag=s,e.dump="{"+a+"}"}function qs(e,d,n,a){var s="",p=e.tag,c=Object.keys(n),h,m,x,y,w,k;if(e.sortKeys===!0)c.sort();else if(typeof e.sortKeys=="function")c.sort(e.sortKeys);else if(e.sortKeys)throw new Ge("sortKeys must be a boolean or a function");for(h=0,m=c.length;h<m;h+=1)k="",(!a||s!=="")&&(k+=Ii(e,d)),x=c[h],y=n[x],e.replacer&&(y=e.replacer.call(n,x,y)),ut(e,d+1,x,!0,!0,!0)&&(w=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,w&&(e.dump&&Wt===e.dump.charCodeAt(0)?k+="?":k+="? "),k+=e.dump,w&&(k+=Ii(e,d)),ut(e,d+1,y,!0,w)&&(e.dump&&Wt===e.dump.charCodeAt(0)?k+=":":k+=": ",k+=e.dump,s+=k));e.tag=p,e.dump=s||"{}"}function Dn(e,d,n){var a,s,p,c,h,m;for(s=n?e.explicitTypes:e.implicitTypes,p=0,c=s.length;p<c;p+=1)if(h=s[p],(h.instanceOf||h.predicate)&&(!h.instanceOf||typeof d=="object"&&d instanceof h.instanceOf)&&(!h.predicate||h.predicate(d))){if(n?h.multi&&h.representName?e.tag=h.representName(d):e.tag=h.tag:e.tag="?",h.represent){if(m=e.styleMap[h.tag]||h.defaultStyle,pr.call(h.represent)==="[object Function]")a=h.represent(d,m);else if(hr.call(h.represent,m))a=h.represent[m](d,m);else throw new Ge("!<"+h.tag+'> tag resolver accepts not "'+m+'" style');e.dump=a}return!0}return!1}function ut(e,d,n,a,s,p,c){e.tag=null,e.dump=n,Dn(e,n,!1)||Dn(e,n,!0);var h=pr.call(e.dump),m=a,x;a&&(a=e.flowLevel<0||e.flowLevel>d);var y=h==="[object Object]"||h==="[object Array]",w,k;if(y&&(w=e.duplicates.indexOf(n),k=w!==-1),(e.tag!==null&&e.tag!=="?"||k||e.indent!==2&&d>0)&&(s=!1),k&&e.usedDuplicates[w])e.dump="*ref_"+w;else{if(y&&k&&!e.usedDuplicates[w]&&(e.usedDuplicates[w]=!0),h==="[object Object]")a&&Object.keys(e.dump).length!==0?(qs(e,d,e.dump,s),k&&(e.dump="&ref_"+w+e.dump)):(js(e,d,e.dump),k&&(e.dump="&ref_"+w+" "+e.dump));else if(h==="[object Array]")a&&e.dump.length!==0?(e.noArrayIndent&&!c&&d>0?zn(e,d-1,e.dump,s):zn(e,d,e.dump,s),k&&(e.dump="&ref_"+w+e.dump)):(Ns(e,d,e.dump),k&&(e.dump="&ref_"+w+" "+e.dump));else if(h==="[object String]")e.tag!=="?"&&Rs(e,e.dump,d,p,m);else{if(h==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new Ge("unacceptable kind of an object to dump "+h)}e.tag!==null&&e.tag!=="?"&&(x=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?x="!"+x:x.slice(0,18)==="tag:yaml.org,2002:"?x="!!"+x.slice(18):x="!<"+x+">",e.dump=x+" "+e.dump)}return!0}function Hs(e,d){var n=[],a=[],s,p;for(zi(e,n,a),s=0,p=a.length;s<p;s+=1)d.duplicates.push(n[a[s]]);d.usedDuplicates=new Array(p)}function zi(e,d,n){var a,s,p;if(e!==null&&typeof e=="object")if(s=d.indexOf(e),s!==-1)n.indexOf(s)===-1&&n.push(s);else if(d.push(e),Array.isArray(e))for(s=0,p=e.length;s<p;s+=1)zi(e[s],d,n);else for(a=Object.keys(e),s=0,p=a.length;s<p;s+=1)zi(e[a[s]],d,n)}function Ks(e,d){d=d||{};var n=new Ps(d);n.noRefs||Hs(e,n);var a=e;return n.replacer&&(a=n.replacer.call({"":a},"",a)),ut(n,0,a,!0,!0)?n.dump+`
`:""}var $s=Ks,Ys={dump:$s};function ji(e,d){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+d+" instead, which is now safe by default.")}}var Ws=Ne,Us=Bn,Vs=Hn,Xs=Un,Gs=Vn,Js=Ri,Qs=ur.load,Zs=ur.loadAll,el=Ys.dump,tl=Ge,il={binary:Zn,float:Wn,map:qn,null:Kn,pairs:tr,set:ir,timestamp:Jn,bool:$n,int:Yn,merge:Qn,omap:er,seq:jn,str:Nn},nl=ji("safeLoad","load"),rl=ji("safeLoadAll","loadAll"),ol=ji("safeDump","dump"),al={Type:Ws,Schema:Us,FAILSAFE_SCHEMA:Vs,JSON_SCHEMA:Xs,CORE_SCHEMA:Gs,DEFAULT_SCHEMA:Js,load:Qs,loadAll:Zs,dump:el,YAMLException:tl,types:il,safeLoad:nl,safeLoadAll:rl,safeDump:ol},Sr=al;window.interact||(window.interact=kr.default);window.jsyaml||(window.jsyaml=Sr);var sl="0.9.5";console.info(`%c drag-and-drop-card %c v${sl} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var ll=(e,...d)=>console.debug(`[drag-and-drop-card] ${e}`,...d);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var qi=()=>new Promise(e=>requestAnimationFrame(()=>e())),cl=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),Hi=class e extends HTMLElement{constructor(){super();bn(this,"__booting",!1);this.shadowRoot||this.attachShadow({mode:"open"}),this.__rebuiltCards=new WeakSet}_scheduleReflowAndScale(){this.__reflowRAF||(this.__reflowRAF=requestAnimationFrame(()=>{var n,a;this.__reflowRAF=null;try{(this.containerSizeMode||this.container_size_mode||"dynamic").toLowerCase()==="dynamic"&&((n=this._resizeContainer)==null||n.call(this))}catch{}try{(a=this._applyAutoScale)==null||a.call(this)}catch{}}))}__ddcBindPointerListeners(){if(!this.__ddcPtrBound){this.__ddcPtrBound=!0,this.__onDDCPointerDown=n=>{var a,s;try{if(n.button!==void 0&&n.button!==0)return;let p=((a=n.composedPath)==null?void 0:a.call(n))||[],c=null;for(let h of p)if(h&&h.classList&&h.classList.contains("card-wrapper")){c=h;break}if(!c)return;this.__ddcDragging=!0,this.__scaleOuter&&(this.__prevOverflow=this.__scaleOuter.style.overflow,this.__scaleOuter.style.overflow="visible"),(s=this._scheduleReflowAndScale)==null||s.call(this)}catch{}},this.__onDDCPointerMove=n=>{var a;try{if(!this.__ddcDragging)return;(a=this._scheduleReflowAndScale)==null||a.call(this)}catch{}},this.__onDDCPointerUp=n=>{var a;try{if(!this.__ddcDragging)return;this.__ddcDragging=!1,this.__scaleOuter&&(this.__scaleOuter.style.overflow=this.__prevOverflow||"");try{(a=this._applyAutoScale)==null||a.call(this)}catch{}}catch{}};try{this.addEventListener("pointerdown",this.__onDDCPointerDown,{passive:!0})}catch{}try{this.addEventListener("pointermove",this.__onDDCPointerMove,{passive:!0})}catch{}try{window.addEventListener("pointerup",this.__onDDCPointerUp,{passive:!0})}catch{}try{window.addEventListener("pointercancel",this.__onDDCPointerUp,{passive:!0})}catch{}}}_ensureScaleWrapper(){let n=this.cardContainer;if(!n||this.__scaleOuter&&this.__scaleOuter.contains(n))return;let a=document.createElement("div");a.className="ddc-scale-outer",Object.assign(a.style,{position:"relative",width:"100%",overflow:"hidden"}),n.parentNode&&(n.parentNode.insertBefore(a,n),a.appendChild(n)),Object.assign(n.style,{position:"absolute",top:"0",left:"0",transformOrigin:"top left"}),this.__scaleOuter=a}_hasCardModDeep(n){try{if(!n||typeof n!="object")return!1;if(n.card_mod||n.type==="custom:mod-card")return!0;if(n.card)return this._hasCardModDeep(n.card);if(Array.isArray(n.cards)){for(let a of n.cards)if(this._hasCardModDeep(a))return!0}return!1}catch{return!1}}_rebuildOnce(n){try{if(!n||(this.__rebuiltCards||(this.__rebuiltCards=new WeakSet),this.__rebuiltCards.has(n)))return;this.__rebuiltCards.add(n),n.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}}_deepQueryAll(n,a=document){let s=[],p=c=>{if(!c)return;if(c.querySelectorAll)try{c.querySelectorAll(n).forEach(x=>s.push(x))}catch{}let h=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,null),m=c;for(;m;){let x=m.shadowRoot;x&&p(x),m=h.nextNode()}};return p(a),s}_syncEditorsStorageKey(){try{let n=this.storageKey||"";this._deepQueryAll("#storage_key").forEach(s=>{try{s&&s.tagName==="INPUT"&&s.value!==n&&(s.value=n,s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}})}catch{}}static _genKey(){var a,s;return`layout_${((s=(a=globalThis.crypto)==null?void 0:a.randomUUID)==null?void 0:s.call(a))||`${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}`}static getStubConfig(){return{type:"custom:drag-and-drop-card",storage_key:this._genKey(),grid:10,drag_live_snap:!1,auto_save:!0,auto_save_debounce:800,container_size_mode:"dynamic",hero_image:"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png"}}static getConfigElement(){let n=document.createElement("div");n.innerHTML=`
    <style>
      :host, .ddc-editor { font-family: var(--paper-font-body1_-_font-family, Roboto, system-ui, sans-serif); color: var(--primary-text-color); }

      .ddc-editor { display: grid; grid-template-columns: 220px 1fr; gap: 10px 16px; align-items: center; box-sizing: border-box; padding: 8px 4px; }
      .section { grid-column: 1 / -1; margin: 10px 0 2px; font-weight: 600; opacity: 0.9; }
      .row-spacer { grid-column: 1 / -1; height: 2px; background: var(--divider-color); opacity: .2; border-radius: 2px; }

      .label { align-self: flex-start; padding-top: 6px; font-weight: 600; opacity: .9; }
      .helper { grid-column: 2 / 3; font-size: .85rem; opacity: .7; margin-top: -6px; }

      .inline { display: inline-flex; align-items: center; gap: 8px; }
      .two-col { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }

      .actions { grid-column: 1 / -1; display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px; }
      .actions ha-button[disabled] { opacity: .6; }

      /* Subtle pulse for enabled Apply button */
      @keyframes ddcPulse {
        0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0,0,0,0); }
        50% { transform: scale(1.035); box-shadow: 0 0 12px 2px rgba(255,255,255,.22); }
      }
      #applyBtn:not([disabled]) { animation: ddcPulse 1.8s ease-in-out infinite; }

      /* Make HA inputs fill width nicely */
      ha-textfield, ha-select { width: 100%; }

      /* Checkbox rows: keep left column reserved so alignment stays consistent */
      .left-empty { visibility: hidden; }
    
      </style>

     <div class="ddc-editor">
      <div class="section">Layout & Behavior</div>

      <div class="label">Storage key</div>
      <ha-textfield id="storage_key" label="Storage key" placeholder="my_unique_layout_key"></ha-textfield>
      <div class="helper">Unique key for saving layout positions. Auto-generated if empty.</div>

      <div class="label">Grid size</div>
      <ha-textfield id="grid" label="Grid (px)" type="number" min="4" max="32" step="1" value="10"></ha-textfield>
      <div class="helper">Pixel size of each grid cell. Affects snap and default card size.</div>

      <div class="label">Snap while dragging</div>
      <ha-formfield label="Snap to grid during drag (live)">
        <ha-checkbox id="liveSnap"></ha-checkbox>
      </ha-formfield>
      <div class="helper">If on, elements snap to grid while dragging. If off, snap occurs on drop.</div>

      <div class="label">Auto-save</div>
      <div class="two-col">
        <ha-formfield label="Auto-save changes">
          <ha-checkbox id="autoSave"></ha-checkbox>
        </ha-formfield>
        <ha-textfield id="autoSaveDebounce" label="Debounce (ms)" type="number" min="0" step="50" value="800"></ha-textfield>
      </div>
      <div class="helper">When enabled, layout changes are saved automatically after a short delay.</div>

      <div class="row-spacer"></div>
      <div class="section">Appearance</div>

      <div class="label">Container background</div>
      <ha-textfield id="containerBg" label="CSS color/gradient" placeholder="transparent, #232f3e, linear-gradient(...)" helper=""></ha-textfield>
      <div class="helper">Examples: <code>transparent</code>, <code>#232f3e</code>, <code>linear-gradient(...)</code>.</div>

      <div class="label">Card background</div>
      <ha-textfield id="cardBg" label="CSS color/gradient" placeholder="var(--ha-card-background) or #ffffffcc"></ha-textfield>
      <div class="helper">Background for each card in the layout; can use theme vars.</div>

      <div class="label">Debug logs</div>
      <ha-formfield label="Enable console debug">
        <ha-checkbox id="debug"></ha-checkbox>
      </ha-formfield>

      <div class="label">Disable overlap</div>
      <ha-formfield label="Prevent cards from overlapping">
        <ha-checkbox id="noOverlap"></ha-checkbox>
      </ha-formfield>

      <div class="label">Auto-resize cards</div>
      <ha-formfield label="Scale layout to fit parent (view mode)">
        <ha-checkbox id="autoResize"></ha-checkbox>
      </ha-formfield>


      <div class="row-spacer"></div>
      <div class="section">Container Size</div>

      <div class="label">Mode</div>
      <ha-select id="sizeMode" label="Container size mode">
        <mwc-list-item value="dynamic">Dynamic (auto)</mwc-list-item>
        <mwc-list-item value="fixed_custom">Fixed (custom)</mwc-list-item>
        <mwc-list-item value="preset">Preset</mwc-list-item>
      </ha-select>

      <div class="label">Fixed size</div>
      <div class="inline" id="sizeCustom" style="display:none">
        <ha-textfield id="sizeW" type="number" label="W" min="100" step="10"></ha-textfield>
        <ha-textfield id="sizeH" type="number" label="H" min="100" step="10"></ha-textfield>
      </div>

      <div class="label">Preset</div>
      <div class="inline" id="sizePresetWrap" style="display:none">
        <ha-select id="sizePreset" label="Preset"></ha-select>
        <ha-select id="sizeOrientation" label="Orientation">
          <mwc-list-item value="auto">Auto</mwc-list-item>
          <mwc-list-item value="landscape">Landscape</mwc-list-item>
          <mwc-list-item value="portrait">Portrait</mwc-list-item>
        </ha-select>
      </div>

      <div class="actions">
        <ha-button id="revertBtn">Revert</ha-button>
        <ha-button id="applyBtn" raised disabled>Apply</ha-button>
      </div>
    </div>
  `;let a=()=>{let y=m();c.disabled=!y},s=()=>{let y=n.getConfig();n.dispatchEvent(new CustomEvent("config-changed",{detail:{config:y}})),a()},p=()=>{let y=n.querySelector("#sizeMode").value;n.querySelector("#sizeCustom").style.display=y==="fixed_custom"?"inline-flex":"none",n.querySelector("#sizePresetWrap").style.display=y==="preset"?"inline-flex":"none"},c=n.querySelector("#applyBtn"),h=n.querySelector("#revertBtn");["#sizeMode","#sizePreset","#sizeOrientation"].forEach(y=>{let w=n.querySelector(y);if(w){try{w.fixedMenuPosition=!0}catch{}w.addEventListener("closed",k=>k.stopPropagation())}}),n.setConfig=(y={})=>{var k,O,z,A,M,D,C,P;n._config={type:y.type||"custom:drag-and-drop-card",...y},n._config.storage_key||(n._config.storage_key=`layout_${((k=crypto==null?void 0:crypto.randomUUID)==null?void 0:k.call(crypto))||Date.now().toString(36)}`,n.__autokeyPending=!0),n.querySelector("#storage_key").value=n._config.storage_key||"",n.querySelector("#grid").value=(O=n._config.grid)!=null?O:10,n.querySelector("#liveSnap").checked=!!n._config.drag_live_snap,n.querySelector("#autoSave").checked=n._config.auto_save!==!1,n.querySelector("#autoSaveDebounce").value=(z=n._config.auto_save_debounce)!=null?z:800,n.querySelector("#containerBg").value=(A=n._config.container_background)!=null?A:"transparent",n.querySelector("#cardBg").value=(M=n._config.card_background)!=null?M:"var(--ha-card-background, var(--card-background-color))",n.querySelector("#debug").checked=!!n._config.debug,n.querySelector("#noOverlap").checked=!!n._config.disable_overlap,n.querySelector("#autoResize").checked=!!n._config.auto_resize_cards,n.querySelector("#sizeMode").value=n._config.container_size_mode||"dynamic",n.querySelector("#sizeW").value=(D=n._config.container_fixed_width)!=null?D:"",n.querySelector("#sizeH").value=(C=n._config.container_fixed_height)!=null?C:"",n.querySelector("#sizeOrientation").value=n._config.container_preset_orientation||"auto";let w=n.querySelector("#sizePreset");if(!w.__filled){let T=(((P=this._sizePresets)==null?void 0:P.call(this))||[]).reduce((v,L)=>{var R;return(v[R=L.group||"other"]||(v[R]=[])).push(L),v},{});w.innerHTML="";for(let[v,L]of Object.entries(T)){let R=document.createElement("optgroup");R.label=v.replace(/(^.|-.?)/g,B=>B.toUpperCase()),L.forEach(B=>{let Y=document.createElement("mwc-list-item");Y.value=B.key,Y.textContent=`${B.label} (${B.w}\xD7${B.h})`,R.appendChild(Y)});let V=document.createElement("mwc-list-item");V.setAttribute("disabled",""),V.textContent=`\u2014 ${R.label} \u2014`,w.appendChild(V),Array.from(R.children).forEach(B=>w.appendChild(B))}w.__filled=!0}n._config.container_preset&&(w.value=n._config.container_preset),p(),a(),n.__autokeyPending&&(n.__autokeyPending=!1,s())},n.getConfig=()=>{let y={...n._config||{}};return y.storage_key=n.querySelector("#storage_key").value||"",y.grid=Number(n.querySelector("#grid").value||10),y.drag_live_snap=!!n.querySelector("#liveSnap").checked,y.auto_save=!!n.querySelector("#autoSave").checked,y.auto_save_debounce=Number(n.querySelector("#autoSaveDebounce").value||800),y.container_background=n.querySelector("#containerBg").value||"transparent",y.card_background=n.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",y.debug=!!n.querySelector("#debug").checked,y.disable_overlap=!!n.querySelector("#noOverlap").checked,y.auto_resize_cards=!!n.querySelector("#autoResize").checked,y.container_size_mode=n.querySelector("#sizeMode").value,y.container_fixed_width=Number(n.querySelector("#sizeW").value||0)||void 0,y.container_fixed_height=Number(n.querySelector("#sizeH").value||0)||void 0,y.container_preset=n.querySelector("#sizePreset").value||void 0,y.container_preset_orientation=n.querySelector("#sizeOrientation").value||"auto",y};let m=()=>{let y=n.getConfig(),w=n._config||{};try{return JSON.stringify(y)!==JSON.stringify(w)}catch{return!0}},x=(y,w="input")=>{var k;return(k=n.querySelector(y))==null?void 0:k.addEventListener(w,()=>{y==="#sizeMode"&&p(),a()})};return x("#storage_key"),x("#grid"),x("#liveSnap","change"),x("#autoSave","change"),x("#autoSaveDebounce"),x("#containerBg"),x("#cardBg"),x("#debug","change"),x("#noOverlap","change"),x("#autoResize","change"),x("#sizeMode","change"),x("#sizeW"),x("#sizeH"),x("#sizePreset","selected"),x("#sizeOrientation","selected"),c==null||c.addEventListener("click",()=>{s()}),h==null||h.addEventListener("click",()=>n.setConfig(n._config)),n}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let n=Math.max(100,Number(this.containerFixedWidth||0)),a=Math.max(100,Number(this.containerFixedHeight||0));return{w:n,h:a}}if(this.containerSizeMode==="preset"){let n=e._sizePresets().find(p=>p.key===this.containerPreset)||e._sizePresets().find(p=>p.key==="fhd");if(!n)return{w:1920,h:1080};let a=n.w,s=n.h;return this.containerPresetOrient==="portrait"&&a>s&&([a,s]=[s,a]),this.containerPresetOrient==="landscape"&&s>a&&([a,s]=[s,a]),{w:a,h:s}}return null}_applyContainerSizingFromConfig(n=!1){var s,p;let a=this.cardContainer;if(a)if(this._isContainerFixed()){let{w:c,h}=this._resolveFixedSize();a.style.width=`${c}px`,a.style.height=`${h}px`,a.style.overflow="hidden",n||(s=this._dbgPush)==null||s.call(this,"size","Applied fixed size",{w:c,h,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else a.style.overflow="hidden",n||(p=this._dbgPush)==null||p.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let n=this.cardContainer;if(!n)return{w:0,h:0};let a=parseFloat(getComputedStyle(n).width)||n.getBoundingClientRect().width,s=parseFloat(getComputedStyle(n).height)||n.getBoundingClientRect().height;return{w:a,h:s}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:n,h:a}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(p=>{let c=parseFloat(p.getAttribute("data-x"))||0,h=parseFloat(p.getAttribute("data-y"))||0,m=parseFloat(p.style.width)||p.getBoundingClientRect().width,x=parseFloat(p.style.height)||p.getBoundingClientRect().height,y=Math.max(0,Math.min(c,Math.max(0,n-m))),w=Math.max(0,Math.min(h,Math.max(0,a-x))),k=Math.min(m,n),O=Math.min(x,a);(k!==m||O!==x)&&(p.style.width=`${k}px`,p.style.height=`${O}px`);let z=Math.max(0,Math.min(y,Math.max(0,n-k))),A=Math.max(0,Math.min(w,Math.max(0,a-O)));this._setCardPosition(p,z,A)})}_applyGridVars(){var a;let n=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",n),(a=this.cardContainer)==null||a.style.setProperty("--ddc-grid-size",n)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(n,a,s=null){let p={t:new Date().toISOString(),kind:n,msg:a,extra:s};this._dbgBuffer.push(p),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${n}]%c ${a}`,"color:#03a9f4","color:unset",s!=null?s:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(n){return String(n).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}setConfig(n={}){var p,c,h,m,x,y,w,k,O,z,A,M,D,C,P;let a=this.storageKey;this.config={...n},(!this.config.storage_key||this.config.storage_key==="")&&(this.config.storage_key=this.constructor._genKey()),this.storageKey=this.config.storage_key,n.storage_key||(this.storageKey?n={...n,storage_key:this.storageKey}:(this.storageKey=`layout_${((p=crypto==null?void 0:crypto.randomUUID)==null?void 0:p.call(crypto))||Date.now().toString(36)}`,n={...n,storage_key:this.storageKey})),this._config=n,this.storageKey=n.storage_key,this._syncEditorsStorageKey(),this.storageKey=n.storage_key||void 0,this._syncEditorsStorageKey(),this.gridSize=Number((c=n.grid)!=null?c:10),this.dragLiveSnap=!!n.drag_live_snap,this.autoSave=n.auto_save!==!1,this.autoSaveDebounce=Number((h=n.auto_save_debounce)!=null?h:800),this.containerBackground=(m=n.container_background)!=null?m:"transparent",this.cardBackground=(x=n.card_background)!=null?x:"var(--ha-card-background, var(--card-background-color))",this.debug=!!n.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!n.disable_overlap,this.containerSizeMode=n.container_size_mode||"dynamic",this.autoResizeCards=!!n.auto_resize_cards,this.autoResizeCards?(y=this._startScaleWatch)==null||y.call(this):(w=this._stopScaleWatch)==null||w.call(this),(k=this._applyAutoScale)==null||k.call(this),this.containerFixedWidth=Number((O=n.container_fixed_width)!=null?O:0)||null,this.containerFixedHeight=Number((z=n.container_fixed_height)!=null?z:0)||null,this.containerPreset=n.container_preset||"fullhd",this.containerPresetOrient=n.container_preset_orientation||"auto",this.heroImage=(n==null?void 0:n.hero_image)||"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png",this.tabs=Array.isArray(n.tabs)?n.tabs:[],this.tabsPosition=n.tabs_position==="left"?"left":"top",this.defaultTab=n.default_tab||((M=(A=this.tabs[0])==null?void 0:A.id)!=null?M:"default"),this.hideTabsWhenSingle=n.hide_tabs_when_single!==!1,this.activeTab=this.defaultTab;try{let T=localStorage.getItem(`ddc_lasttab_${this.storageKey}`);T&&this.tabs.some(v=>v.id===T)&&(this.activeTab=T)}catch{}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left"),this.cardContainer&&this._applyContainerSizingFromConfig(!1);let s=a!==this.storageKey;if(this.editMode&&!this.__booting&&!s)try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}if(this._applyGridVars(),this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:n.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let T=document.createElement("script");T.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(T)}if(!window.interact){let T=document.createElement("script");T.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",T.onload=()=>this._initInteract(),document.head.appendChild(T)}if(this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),!this._built){this._built=!0,this.shadowRoot.innerHTML=`
        <style>
          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            transform-origin: top left;
            padding: 10px;
            border: 1px solid var(--divider-color);
            background: var(--ddc-bg, transparent);
            width: auto; height: auto; border-radius: 12px; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }
          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:0;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab;
            /* ensure buttons and resize handles remain visible on very small cards */
            overflow:auto;
            border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:1;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
        .chip{
            position:absolute;
            top:8px;
            right:8px;
            display:flex;
            gap:6px;
            flex-wrap:wrap;             /* allow chip buttons to wrap when space is limited */
            opacity:0;
            transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .chip .mini{
            display:inline-flex;align-items:center;gap:6px;
            background:rgba(28,28,30,.78);color:#fff;border:1px solid rgba(255,255,255,.18);
            border-radius:999px;padding:6px 10px;font-size:.76rem;cursor:pointer;letter-spacing:.2px;
            box-shadow:0 2px 6px rgba(0,0,0,.25); transition:transform .08s, background .12s, box-shadow .12s
          }
          .chip .mini:hover{transform:translateY(-1px); background:rgba(28,28,30,.95); box-shadow:0 3px 10px rgba(0,0,0,.35)}
          .chip .mini ha-icon{--mdc-icon-size:18px;width:18px;height:18px}
          .chip .mini.danger{background:rgba(220, 38, 38, .9);border-color:rgba(255,255,255,.22)}
          .chip .mini.danger:hover{background:rgba(220, 38, 38, 1)}
          .chip .mini.pill{padding:6px}

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:none;                 /* shown in edit mode via your existing rule */
            position:absolute;
            bottom:8px;                   /* move INSIDE the wrapper bounds */
            right:8px;                    /* so it can't be clipped by overflow */
            width:28px;
            height:28px;
            border-radius:50%;
            background:var(--primary-color);
            color:#fff;
            border:1px solid rgba(255,255,255,.25);
            cursor:se-resize;
            z-index:999;                  /* above the card content */
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            align-items:center;
            justify-content:center;
          }
          .resize-handle:hover{transform:scale(1.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{--mdc-icon-size:18px;width:18px;height:18px;pointer-events:none}

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96vw);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{border-right:1px solid var(--divider-color);overflow:auto;background:var(--primary-background-color);contain:content}
          #rightPane{overflow:hidden;background:var(--primary-background-color)}
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);overflow:visible;position:relative;contain:content;}
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}
          .cm-editor{height: 100%}
          /* --- FIX: YAML editor should scroll and not overflow --- */
          #yamlSec { min-height: 0; height: 700px !important; }
          #yamlSec .bd { 
            overflow: auto;        /* allow scrolling inside the YAML section */
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            max-height: none;
            height: 100%;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec { min-height: 0; overflow: auto;}
          #optionsSec .bd {
            position: relative;
            overflow: auto;
            height: auto;
            max-height: 100%;
          }
          #editorHost { display:block; min-height: 0; }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: fixed and scroll inside */
          ha-code-editor { 
            display: block; 
            height: 260px !important; 
          }
          .CodeMirror { 
            height: 260px !important; 
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            overflow: visible; 
            height: auto;
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            position: relative;
            display:flex; align-items:center; justify-content:center;
            width:100%; height:100%;
            border-radius:16px;
            overflow: hidden;
            /* cool gradient derived from HA primary color */
            background:
              radial-gradient(120% 120% at 100% 0%,
                color-mix(in srgb, var(--primary-color) 18%, #000 0%) 0%,
                transparent 60%),
              linear-gradient(135deg,
                color-mix(in srgb, var(--primary-color) 70%, #000 0%) 0%,
                color-mix(in srgb, var(--primary-color) 35%, #000 0%) 100%);
          }

          /* subtle shine */
          .ddc-placeholder-inner::after{
            content:"";
            position:absolute; inset:0;
            background: radial-gradient(120% 90% at 0% 100%, rgba(255,255,255,.15), transparent 60%);
            pointer-events:none;
          }

          /* center stack */
          .ddc-hero{
            position:absolute; inset:0;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            gap:16px; text-align:center; padding:24px;
            color:rgba(255,255,255,.98);
            text-shadow:0 1px 2px rgba(0,0,0,.35);
            user-select:none; pointer-events:none; /* click goes to shield below */
          }

          .ddc-hero img{
            width:128px; height:128px; object-fit:contain; opacity:.95; filter: drop-shadow(0 4px 14px rgba(0,0,0,.25));
          }

          .ddc-hero .ddc-title{
            font-weight:800; font-size:1.25rem; letter-spacing:.2px;
          }

          .ddc-hero .ddc-sub{
            font-weight:600; opacity:.95;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }

                /* --- Tabs bar (DDC) --- */
      /* --- Tabs bar (DDC) --- */
      .ddc-tabs{
        /* Full-width, equal columns */
        display:grid;
        grid-auto-flow:column;
        grid-auto-columns:1fr;
        gap:6px;
        padding:6px;
        align-items:stretch;
        border-bottom:1px solid var(--divider-color, rgba(0,0,0,.12));
        width:100%;
        /* If you prefer flex instead of grid, see the fallback below */
      }

      /* Vertical/left variant unchanged */
      .ddc-tabs-left{
        display:flex;
        flex-direction:column;
        width:160px; min-width:160px;
        border-bottom:none;
        border-right:1px solid var(--divider-color, rgba(0,0,0,.12));
      }

      /* Tab button */
      .ddc-tab{
        display:flex;
        align-items:center;
        justify-content:center;        /* centers label+icon */
        gap:8px;
        padding:10px 12px;
        min-width:0;                   /* allow text ellipsis */
        border-radius:12px;
        border:1px solid
          var(--ha-card-border-color, color-mix(in oklab, var(--primary-text-color) 12%, transparent));
        background:var(--ha-card-background, rgba(0,0,0,.02));
        cursor:pointer;
        font:inherit;
        position:relative;
        transition:background .2s ease, border-color .2s ease, box-shadow .2s ease, transform .2s ease;
      }
      .ddc-tab ha-icon{ --mdc-icon-size:18px; }
      .ddc-tab span{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

      /* Hover */
      .ddc-tab:hover{
        background:color-mix(in oklab, var(--primary-color) 8%, transparent);
        border-color:color-mix(in oklab, var(--primary-color) 40%, transparent);
        box-shadow:0 1px 2px rgba(0,0,0,.15);
      }

      /* Active */
      .ddc-tab.active{
        border-color:var(--primary-color);
        background:color-mix(in oklab, var(--primary-color) 14%, transparent);
        box-shadow:0 2px 6px rgba(0,0,0,.16);
      }

      /* Active "ink bar" */
      .ddc-tab.active::after{
        content:"";
        position:absolute;
        left:8px; right:8px; bottom:-6px;
        height:3px;
        border-radius:2px;
        background:var(--primary-color);
        box-shadow:0 0 0 1px color-mix(in oklab, var(--primary-color) 25%, transparent);
      }

      /* Focus accessibility */
      .ddc-tab:focus-visible{
        outline:3px solid color-mix(in oklab, var(--primary-color) 55%, transparent);
        outline-offset:2px;
      }

      /* Layout helper when using vertical tabs alongside content */
      .ddc-tabs-left-layout{
        display: grid;
        grid-template-columns: 160px 1fr;   /* tabs | content */
        grid-template-rows: auto 1fr;       /* toolbar | main */
        grid-template-areas:
          "toolbar toolbar"
          "tabs    content";
      } 

      /* Place children into the intended areas */
      .ddc-tabs-left-layout .toolbar{ grid-area: toolbar; }
      .ddc-tabs-left-layout #tabsBar{ grid-area: tabs; }
      .ddc-tabs-left-layout #cardContainer{ grid-area: content; }
      
        </style>
        <div class="ddc-root">
          <div class="toolbar">
            <button class="btn" id="addCardBtn" style="display:none">
              <ha-icon icon="mdi:plus"></ha-icon>
              <span style="margin-left:6px">Add Card</span>
            </button>
            <button class="btn secondary" id="reloadBtn" style="display:none">
              <ha-icon icon="mdi:refresh"></ha-icon>
              <span style="margin-left:6px">Reload</span>
            </button>
            <button class="btn secondary" id="diagBtn" style="display:none">
              <ha-icon icon="mdi:play-circle-outline"></ha-icon>
              <span style="margin-left:6px">Diagnostics</span>
            </button>
            <button class="btn secondary" id="exportBtn" style="display:none">
              <ha-icon icon="mdi:download"></ha-icon>
              <span style="margin-left:6px">Export Design</span>
            </button>
            <button class="btn secondary" id="importBtn" style="display:none">
              <ha-icon icon="mdi:upload"></ha-icon>
              <span style="margin-left:6px">Import Design</span>
            </button>
            <button class="btn" id="applyLayoutBtn" style="display:none">
              <ha-icon icon="mdi:content-save"></ha-icon>
              <span style="margin-left:6px">Apply</span>
            </button>
            <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
              <ha-icon icon="mdi:storefront-outline"></ha-icon>
              <span>Open HADS</span>
            </button>
            <button class="btn warning" id="exitEditBtn" style="display:none">
              <ha-icon icon="mdi:exit-run"></ha-icon>
              <span>Exit edit mode</span>
            </button>
            <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
          </div>
          <div class="ddc-tabs" id="tabsBar" style="display:none"></div>
          <div class="card-container" id="cardContainer"></div>
        </div>
      `,this.cardContainer=this.shadowRoot.querySelector("#cardContainer"),this.addButton=this.shadowRoot.querySelector("#addCardBtn"),this.reloadBtn=this.shadowRoot.querySelector("#reloadBtn"),this.diagBtn=this.shadowRoot.querySelector("#diagBtn"),this.exitEditBtn=this.shadowRoot.querySelector("#exitEditBtn"),this.storeBadge=this.shadowRoot.querySelector("#storeBadge"),this.exportBtn=this.shadowRoot.querySelector("#exportBtn"),this.importBtn=this.shadowRoot.querySelector("#importBtn"),this.exploreBtn=this.shadowRoot.querySelector("#exploreBtn"),this.applyLayoutBtn=this.shadowRoot.querySelector("#applyLayoutBtn"),this.tabsBar=this.shadowRoot.querySelector("#tabsBar"),this.rootEl=this.shadowRoot.querySelector(".ddc-root");try{this._renderTabs(),this._applyActiveTab()}catch{}this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.applyLayoutBtn.addEventListener("click",()=>this._saveLayout(!1)),window.addEventListener("keydown",T=>{var v;if(this.editMode){if((T.ctrlKey||T.metaKey)&&(T.key==="s"||T.key==="S")&&(T.preventDefault(),this._saveLayout(!1)),!this.__ddcResizeObs&&this.autoResizeCards){this.__ddcResizeObs=new ResizeObserver(()=>{var L;return(L=this._applyAutoScale)==null?void 0:L.call(this)});try{this.__ddcResizeObs.observe(this)}catch{}try{this.__ddcResizeObs.observe(this.cardContainer)}catch{}try{this.parentElement&&this.__ddcResizeObs.observe(this.parentElement)}catch{}try{this.offsetParent&&this.__ddcResizeObs.observe(this.offsetParent)}catch{}window.addEventListener("resize",this.__ddcOnWinResize=()=>{var L;return(L=this._applyAutoScale)==null?void 0:L.call(this)})}(v=this._applyAutoScale)==null||v.call(this)}}),this.exploreBtn.addEventListener("click",()=>window.open("https://hads.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),(D=this._applyAutoScale)==null||D.call(this),this._installLongPressToEnterEdit(),(C=this._startScaleWatch)==null||C.call(this),window.addEventListener("keydown",T=>{var v;T.key==="Escape"&&this.editMode&&this._toggleEditMode(!1),this.__ddcResizeObs||(this.__ddcResizeObs=new ResizeObserver(()=>{var L;return(L=this._applyAutoScale)==null?void 0:L.call(this)}),this.__ddcResizeObs.observe(this),this.__ddcResizeObs.observe(this.cardContainer),window.addEventListener("resize",this.__ddcOnWinResize=()=>{var L;return(L=this._applyAutoScale)==null?void 0:L.call(this)})),(v=this._applyAutoScale)==null||v.call(this)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",T=>{this.editMode&&(T.target.closest(".card-wrapper")||!T.shiftKey&&!T.ctrlKey&&!T.metaKey&&this._clearSelection())})}try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),this.__cfgReady=!0,s&&this.__booted?this._initialLoad(!0):!this.__booted&&this.__probed?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),(P=this._applyAutoScale)==null||P.call(this),this._resizeContainer())}connectedCallback(){var n;if(this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1),!this.__visObs){let a=new IntersectionObserver(s=>{s.some(p=>p.isIntersecting)&&requestAnimationFrame(()=>this._applyAutoScale&&this._applyAutoScale())},{root:null,threshold:0});a.observe(this),this.__visObs=a}this.__ddcOnWinResize=this.__ddcOnWinResize||(()=>this._applyAutoScale&&this._applyAutoScale()),window.addEventListener("resize",this.__ddcOnWinResize);try{(n=this.__ddcBindPointerListeners)==null||n.call(this)}catch{}}disconnectedCallback(){var n,a;window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis);try{(n=this.__ddcResizeObs)==null||n.disconnect()}catch{}if(this.__ddcResizeObs=null,(a=this._stopScaleWatch)==null||a.call(this),this.__ddcOnWinResize&&(window.removeEventListener("resize",this.__ddcOnWinResize),this.__ddcOnWinResize=null),this.__lpInstalled&&this.__lpHandlers){let s=this.cardContainer;s==null||s.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),s==null||s.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}try{this.__visObs&&this.__visObs.disconnect()}catch{}this.__visObs=null,this.__ddcOnWinResize&&window.removeEventListener("resize",this.__ddcOnWinResize);try{this.__ddcPtrBound&&(this.removeEventListener("pointerdown",this.__onDDCPointerDown),this.removeEventListener("pointermove",this.__onDDCPointerMove),window.removeEventListener("pointerup",this.__onDDCPointerUp),window.removeEventListener("pointercancel",this.__onDDCPointerUp),this.__ddcPtrBound=!1)}catch{}}set hass(n){var s;this._hass=n,ll("set hass"),!this.__probed&&n&&(this.__probed=!0,this._probeBackend().then(()=>{this.__probed=!0,!this.__booted&&this.__cfgReady&&(this.__booted=!0,this._initialLoad(!0))}));let a=((s=this.cardContainer)==null?void 0:s.children)||[];for(let p of a){let c=p.firstElementChild;c&&c.hass!==n&&(c.hass=n)}}get hass(){return this._hass}async _initialLoad(n=!1){var a,s,p,c,h,m,x,y,w,k,O,z,A,M,D,C;if(!this.__booting){this.__booting=!0;try{this._loading=!0,n&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:n});let P=[],T=null;if(this._backendOK&&this.storageKey)try{T=await this._loadLayoutFromBackend(this.storageKey)}catch(B){this._dbgPush("boot","Backend load failed",{error:String(B)})}if(!T&&this.storageKey){let B=null;try{B=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(B)if(this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(B).length}),this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,B),this._dbgPush("boot","Migrated local -> backend"),T=B}catch(Y){this._dbgPush("boot","Migration failed, staying local",{error:String(Y)}),T=B}else T=B}!T&&((s=(a=this._config)==null?void 0:a.cards)!=null&&s.length)&&(this._dbgPush("boot","Using embedded config"),T={cards:this._config.cards});let v={...this._config||{}};if(T!=null&&T.options){let{storage_key:B,...Y}=T.options;this._applyImportedOptions(Y,!0)}else typeof(T==null?void 0:T.grid)=="number"&&this._applyImportedOptions({grid:T.grid},!0);let L=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","auto_resize_cards"],R={};for(let B of L)v[B]!==void 0&&(R[B]=v[B]);Object.keys(R).length&&this._applyImportedOptions(R,!0);let V=!1;if((p=T==null?void 0:T.cards)!=null&&p.length){for(let B of T.cards){if(!(B!=null&&B.card)||typeof B.card=="object"&&Object.keys(B.card).length===0){let G=this._makePlaceholderAt(((c=B.position)==null?void 0:c.x)||0,((h=B.position)==null?void 0:h.y)||0,((m=B.size)==null?void 0:m.width)||200,((x=B.size)==null?void 0:x.height)||200);this.cardContainer.appendChild(G);try{this._rebuildOnce(G.firstElementChild)}catch{}V=!0;continue}let Y=await this._createCard(B.card),re=this._makeWrapper(Y);this.editMode&&re.classList.add("editing"),re.dataset.tabId=this._normalizeTabId(B.tabId||B.tab_id||this.defaultTab),this._setCardPosition(re,((y=B.position)==null?void 0:y.x)||0,((w=B.position)==null?void 0:w.y)||0),re.style.width=`${(O=(k=B.size)==null?void 0:k.width)!=null?O:14*this.gridSize}px`,re.style.height=`${(A=(z=B.size)==null?void 0:z.height)!=null?A:10*this.gridSize}px`,B.z!=null&&(re.style.zIndex=String(B.z)),this.cardContainer.appendChild(re);try{this._rebuildOnce(re.firstElementChild)}catch{}this._initCardInteract(re),V=!0}this._resizeContainer(),(M=this._applyAutoScale)==null||M.call(this),this._dbgPush("boot","Layout applied",{count:T.cards.length})}V||(this._showEmptyPlaceholder(),(D=this._applyAutoScale)==null||D.call(this),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI(),n&&(this._cardModProcessed=!1),setTimeout(()=>{this._processCardModOnce()},100);try{P.forEach(B=>{try{B.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}})}catch{}}finally{this._loading=!1,this.__booting=!1,this.__dirty=!1,(C=this._updateApplyBtn)==null||C.call(this);try{this._renderTabs(),this._applyActiveTab()}catch{}}}}_normalizeTabId(n){let a=Array.isArray(this.tabs)?this.tabs.map(s=>s.id):[];return a.length?n&&a.includes(n)?n:this.defaultTab||a[0]:this.defaultTab||"default"}_renderTabs(){var s;let n=this.tabsBar;if(!n)return;let a=Array.isArray(this.tabs)?this.tabs:[];if(!a.length||a.length===1&&this.hideTabsWhenSingle){n.style.display="none";return}n.style.display="",n.className="ddc-tabs "+(this.tabsPosition==="left"?"ddc-tabs-left":""),n.innerHTML="";for(let p of a){let c=document.createElement("button");c.className="ddc-tab"+(p.id===this.activeTab?" active":""),c.dataset.tabId=p.id,c.title=p.label||p.id,c.innerHTML=`${p.icon?`<ha-icon icon="${p.icon}"></ha-icon>`:""}<span class="ddc-tab-label">${(s=p.label)!=null?s:p.id}</span>`,c.addEventListener("click",()=>{if(this.activeTab!==p.id){this.activeTab=p.id;try{localStorage.setItem(`ddc_lasttab_${this.storageKey}`,p.id)}catch{}this._applyActiveTab(),this._renderTabs()}}),n.appendChild(c)}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left")}_applyActiveTab(){var s,p;let n=this._normalizeTabId(this.activeTab);(((p=(s=this.cardContainer)==null?void 0:s.querySelectorAll)==null?void 0:p.call(s,".card-wrapper"))||[]).forEach(c=>{var m;let h=c.dataset.tabId?this._normalizeTabId(c.dataset.tabId):this.defaultTab;if(!this.tabs||!this.tabs.length){c.style.display="",c.inert=!1,c.classList.remove("ddc-hidden");return}h===n?(c.style.display="",c.inert=!1,c.classList.remove("ddc-hidden")):(c.style.display="none",c.inert=!0,c.classList.add("ddc-hidden"),c.classList.remove("ddc-selected"),(m=this._applyAutoScale)==null||m.call(this))});try{this._clearSelection()}catch{}}_addTabSelectorToChip(n,a=null){if(!this.tabs||!this.tabs.length)return;let s=n.querySelector(".chip");if(!s)return;let p=s.querySelector("select.ddc-chip-tab");p||(p=document.createElement("select"),p.className="ddc-chip-tab",p.style.marginLeft="6px",p.title="Assign to tab",s.appendChild(p)),p.innerHTML="";for(let h of this.tabs){let m=document.createElement("option");m.value=h.id,m.textContent=h.label||h.id,p.appendChild(m)}let c=this._normalizeTabId(a||n.dataset.tabId||this.activeTab||this.defaultTab);p.value=c,n.dataset.tabId=c,p.onchange=()=>{n.dataset.tabId=this._normalizeTabId(p.value),this._applyActiveTab();try{this._queueSave("tab-change")}catch{}}}_toggleEditMode(n=null){var c,h,m,x;try{(c=this.__clearPressTimer)==null||c.call(this)}catch{}let a=n===null?!this.editMode:!!n,s=!this.editMode&&a;if(this.editMode=a,this.editMode=a,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this.applyLayoutBtn.style.display=this.editMode?"inline-block":"none",this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(y=>{y.classList.toggle("editing",this.editMode);let w=y.querySelector(".resize-handle");w&&(w.style.display=this.editMode?"flex":"none"),!y.dataset.placeholder&&window.interact&&window.interact(y).draggable(this.editMode).resizable(this.editMode),y.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(h=this.cardContainer)==null||h.querySelectorAll(".card-wrapper.dragging").forEach(y=>y.classList.remove("dragging")),s){let y=(m=this.__lastHoldX)!=null?m:null,w=(x=this.__lastHoldY)!=null?x:null;this._playEditRipple(y,w)}}_isInHaEditorPreview(){let n=this;for(;n;){let a=n.nodeType===1&&n.localName?n.localName.toLowerCase():"";if(a==="hui-card-editor"||a==="hui-dialog-edit-card"||a==="hui-card-preview"||a==="ha-dialog"||a==="mwc-dialog")return!0;let s=n.getRootNode&&n.getRootNode();n=n.parentElement||s&&s.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let n=this.cardContainer;if(!n)return;let a=800,s=18,p=v=>!!v&&typeof v=="object"&&v.nodeType===1,c=(v,L)=>{try{return!!(v&&L&&typeof v.contains=="function"&&p(L)&&v.contains(L))}catch{return!1}},h=v=>c(this.cardContainer,v),m=v=>{var V,B,Y;let L=(B=(V=v.target)==null?void 0:V.closest)==null?void 0:B.call(V,".card-wrapper");if(p(L)&&h(L)&&!L.classList.contains("ddc-placeholder"))return!0;let R=typeof v.composedPath=="function"?v.composedPath():[];for(let re of R)if(p(re)&&h(re)&&(Y=re.classList)!=null&&Y.contains("card-wrapper")&&!re.classList.contains("ddc-placeholder"))return!0;return!1},x=(v,L)=>{let R=document.createElement("div");R.className="ddc-press-ring",document.body.appendChild(R),Object.assign(R.style,{position:"fixed",left:`${v}px`,top:`${L}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),R.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let V=R.querySelector(".pr-fg"),B=18,Y=2*Math.PI*B;return V.style.strokeDasharray=`${Y}`,V.style.strokeDashoffset=`${Y}`,requestAnimationFrame(()=>{V.style.transition=`stroke-dashoffset ${a}ms linear`,V.style.strokeDashoffset="0"}),{el:R,move(re,G){R.style.left=`${re}px`,R.style.top=`${G}px`},remove(){try{R.remove()}catch{}}}},y=null,w=null,k=0,O=0,z=null,A=()=>{y&&clearTimeout(y),y=null,w==null||w.remove(),w=null};this.__clearPressTimer=A;let M=v=>{v.pointerType==="mouse"&&v.button!==0||this._isInHaEditorPreview()||!h(v.target)||m(v)||(z=v.pointerId,k=v.clientX,O=v.clientY,this.__lastHoldX=k,this.__lastHoldY=O,w=x(k,O),y=setTimeout(()=>{var R;A();let L=!this.editMode;this._toggleEditMode(L),(R=this._toast)==null||R.call(this,`Edit mode ${L?"enabled":"disabled"}`)},a))},D=v=>{y==null||v.pointerId!==z||(w==null||w.move(v.clientX,v.clientY),(Math.abs(v.clientX-k)>s||Math.abs(v.clientY-O)>s)&&A())},C=v=>{v.pointerId===z&&(A(),z=null)},P=v=>{if(y)return v.preventDefault(),v.stopPropagation(),!1},T=v=>{var R;if(this._isInHaEditorPreview()||!h(v.target)||m(v))return;let L=!this.editMode;this._toggleEditMode(L),(R=this._toast)==null||R.call(this,`Edit mode ${L?"enabled":"disabled"}`)};n.addEventListener("pointerdown",M),window.addEventListener("pointermove",D,{passive:!0}),window.addEventListener("pointerup",C,{passive:!0}),window.addEventListener("pointercancel",C,{passive:!0}),window.addEventListener("contextmenu",P),n.addEventListener("dblclick",T),this.__lpHandlers={onPointerDown:M,onPointerMove:D,onPointerUpOrCancel:C,onContextMenu:P,onDblClick:T}}_isLayoutEmpty(){let n=this.cardContainer;return n?n.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let n=this._isLayoutEmpty();if(this.addButton){let s=this.editMode||n;this.addButton.style.display=s?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&n)}let a=s=>s&&(s.style.display=this.editMode?"inline-block":"none");a(this.reloadBtn),a(this.diagBtn),a(this.exitEditBtn),a(this.exportBtn),a(this.importBtn),a(this.exploreBtn),a(this.storeBadge),a(this.applyLayoutBtn)}_updateApplyBtn(){this.applyLayoutBtn&&(this.applyLayoutBtn.disabled=!this.__dirty)}_markDirty(n=""){var a;this.__dirty=!0,this._updateApplyBtn(),(a=this._dbgPush)==null||a.call(this,"dirty","Marked dirty",{reason:n})}_playEditRipple(n=null,a=null){let s=this.cardContainer;if(!s)return;let p=s.getBoundingClientRect(),c=n==null?p.left+p.width/2:n,h=a==null?p.top+p.height/2:a,m=c-p.left,x=h-p.top,y=document.createElement("div");y.className="ddc-ripple-veil",y.style.setProperty("--rip-x",`${m}px`),y.style.setProperty("--rip-y",`${x}px`),s.appendChild(y),setTimeout(()=>y.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>this._initCardInteract(a))}_initCardInteract(n){if(!window.interact||n.dataset.placeholder)return;let a=this.gridSize,s=!!this.dragLiveSnap,c=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let h=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});c.push(window.interact.modifiers.snap({targets:[h],range:1/0,offset:"startCoords"}))}window.interact(n).draggable({enabled:this.editMode,inertia:!1,modifiers:c,listeners:{start:h=>{this._selection.has(n)||(!(h!=null&&h.shiftKey)&&!(h!=null&&h.ctrlKey)&&!(h!=null&&h.metaKey)&&this._clearSelection(),this._toggleSelection(n,!0));let m=Array.from(this._selection);this.__groupDrag={leader:n,members:m,startRaw:new Map(m.map(y=>[y,{x:parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,y:parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0,w:parseFloat(y.style.width)||y.getBoundingClientRect().width,h:parseFloat(y.style.height)||y.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(y=>{let w=parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,k=parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0;this.__collisionOriginals.set(y,{x:w,y:k})}),m.forEach(y=>{y.classList.add("dragging"),y.getAttribute("data-x-raw")===null&&y.setAttribute("data-x-raw",y.getAttribute("data-x")||"0"),y.getAttribute("data-y-raw")===null&&y.setAttribute("data-y-raw",y.getAttribute("data-y")||"0")})},move:h=>{if(!this.__groupDrag)return;let m=this.gridSize,x=!!this.dragLiveSnap,y=this.__groupDrag.leader,w=this.__groupDrag.startRaw.get(y),k=(parseFloat(y.getAttribute("data-x-raw"))||w.x)+h.dx,O=(parseFloat(y.getAttribute("data-y-raw"))||w.y)+h.dy,z=k-w.x,A=O-w.y,M=this.__groupDrag.members.map(D=>{let C=this.__groupDrag.startRaw.get(D),P=C.x+z,T=C.y+A,v=x?Math.round(P/m)*m:P,L=x?Math.round(T/m)*m:T;return{el:D,rawX:P,rawY:T,snapX:v,snapY:L,w:C.w,h:C.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(M,z,A,x,m),y.setAttribute("data-x-raw",String(k)),y.setAttribute("data-y-raw",String(O));for(let D of M)D.el.setAttribute("data-x-raw",String(D.rawX)),D.el.setAttribute("data-y-raw",String(D.rawY)),this._setCardPosition(D.el,D.snapX,D.snapY);this._resizeContainer()},end:h=>{if(!this.__groupDrag)return;let m=this.gridSize,x=this.__groupDrag.members.map(y=>{let w=parseFloat(y.getAttribute("data-x-raw"))||parseFloat(y.getAttribute("data-x"))||0,k=parseFloat(y.getAttribute("data-y-raw"))||parseFloat(y.getAttribute("data-y"))||0,O=Math.round(w/m)*m,z=Math.round(k/m)*m,A=parseFloat(y.style.width)||y.getBoundingClientRect().width,M=parseFloat(y.style.height)||y.getBoundingClientRect().height;return{el:y,rawX:w,rawY:k,snapX:O,snapY:z,w:A,h:M}});this.disableOverlap&&this._pushCardsOutOfTheWay(x,0,0,!1,m);for(let y of x)this._setCardPosition(y.el,y.snapX,y.snapY),y.el.setAttribute("data-x-raw",String(y.snapX)),y.el.setAttribute("data-y-raw",String(y.snapY));for(let y of this.__groupDrag.members)y.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(n).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:h=>{let m=this.gridSize,x=!!this.dragLiveSnap,y=parseFloat(n.style.width)||n.getBoundingClientRect().width,w=parseFloat(n.style.height)||n.getBoundingClientRect().height,{width:k,height:O}=h.rect,z=x?Math.max(m,Math.round(k/m)*m):k,A=x?Math.max(m,Math.round(O/m)*m):O,M=parseFloat(n.getAttribute("data-x"))||0,D=parseFloat(n.getAttribute("data-y"))||0,C=z,P=A;if(this._isContainerFixed()){let{w:v,h:L}=this._getContainerSize();C=Math.min(z,Math.max(this.gridSize,v-M)),P=Math.min(A,Math.max(this.gridSize,L-D))}let T=[this._rectFor(n,M,D,C,P)];this.disableOverlap&&this._anyCollisionFor(T,new Set([n]))||(n.style.width=`${C}px`,n.style.height=`${P}px`,this._resizeContainer())},end:()=>{let h=this.gridSize,m=parseFloat(n.style.width)||n.getBoundingClientRect().width,x=parseFloat(n.style.height)||n.getBoundingClientRect().height,y=Math.max(h,Math.round(m/h)*h),w=Math.max(h,Math.round(x/h)*h),k=parseFloat(n.getAttribute("data-x"))||0,O=parseFloat(n.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:A,h:M}=this._getContainerSize();y=Math.min(y,Math.max(h,A-k)),w=Math.min(w,Math.max(h,M-O))}let z=[this._rectFor(n,k,O,y,w)];this.disableOverlap&&this._anyCollisionFor(z,new Set([n]))||(n.style.width=`${y}px`,n.style.height=`${w}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),n.addEventListener("mousedown",h=>{this.editMode&&(h.target.closest(".resize-handle")||h.target.closest(".chip")||(h.shiftKey||h.ctrlKey||h.metaKey?(h.stopPropagation(),this._toggleSelection(n)):this._selection.has(n)||(this._clearSelection(),this._toggleSelection(n,!0))))})}async _createCard(n){let s=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(n);if(s.hass=this.hass,n.type==="custom:mod-card"&&(await new Promise(p=>setTimeout(p,0)),s.setConfig&&typeof s.setConfig=="function"))try{s.setConfig(n)}catch{}return s}_makeWrapper(n){let a=document.createElement("div");a.classList.add("card-wrapper"),a.dataset.tabId=this._normalizeTabId(this.activeTab||this.defaultTab),this.editMode&&a.classList.add("editing"),a.style.zIndex||(a.style.zIndex=String(this._highestZ()+1));let s=document.createElement("div");s.className="chip",s.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini danger pill" data-act="delete" title="Delete card" aria-label="Delete card">
        <ha-icon icon="mdi:close-thick"></ha-icon>
      </button>
    `;try{this._addTabSelectorToChip(a,a.dataset.tabId)}catch{}s.addEventListener("click",async h=>{var x,y,w;h.stopPropagation();let m=(w=(y=(x=h.target)==null?void 0:x.closest("button"))==null?void 0:y.dataset)==null?void 0:w.act;if(m){if(m==="delete")this._selection.size>1&&this._selection.has(a)?(Array.from(this._selection).forEach(O=>O.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(a.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(m==="duplicate"||m==="copy"){let k=this._selection.size>1&&this._selection.has(a)?Array.from(this._selection):[a];for(let O of k){let z=this._extractCardConfig(O.firstElementChild)||{},A=await this._createCard(z),M=this._makeWrapper(A);M.style.width=O.style.width,M.style.height=O.style.height;let D=(parseFloat(O.getAttribute("data-x"))||0)+this.gridSize,C=(parseFloat(O.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(M,D,C),M.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(M);try{this._rebuildOnce(M.firstElementChild)}catch{}this._initCardInteract(M)}this._resizeContainer(),this._queueSave("duplicate")}else if(m==="front")this._adjustZ(a,1);else if(m==="back")this._adjustZ(a,-1);else if(m==="edit"){let k=this._extractCardConfig(a.firstElementChild)||{};await this._openSmartPicker("edit",k,async O=>{var M,D,C;let z=a.firstElementChild,A=await this._createCard(O);try{a.dataset.cfg=JSON.stringify(O),(M=this._hasCardModDeep)!=null&&M.call(this,O)?a.dataset.needsCardMod="true":delete a.dataset.needsCardMod}catch{}a.replaceChild(A,z),await qi();try{if(A.hass=this.hass,(D=A.requestUpdate)==null||D.call(A),A.updateComplete)try{await A.updateComplete}catch{}}catch{}try{this._rebuildOnce(A)}catch{}try{A.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}(C=this._resizeContainer)==null||C.call(this);try{clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(P){console.warn("Save before reload failed",P)}window.location.reload()})}}});let p=document.createElement("div");p.className="shield";let c=document.createElement("div");c.classList.add("resize-handle"),this.editMode||(c.style.display="none"),c.title="Resize",c.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>';try{let h=n._config||n.config;h&&typeof h=="object"&&Object.keys(h).length&&(a.dataset.cfg=JSON.stringify(h),this._hasCardModDeep(h)&&(a.dataset.needsCardMod="true"))}catch{}a.append(n,p,s,c);try{this._rebuildOnce(n)}catch{}return a}_makePlaceholderAt(n=0,a=0,s=400,p=400){let c=document.createElement("div");c.classList.add("card-wrapper","ddc-placeholder"),c.dataset.placeholder="1",this.editMode&&c.classList.add("editing"),this._setCardPosition(c,n,a),c.style.width=`${s}px`,c.style.height=`${p}px`,c.style.zIndex=String(this._highestZ()+1);let h=document.createElement("div");h.className="ddc-placeholder-inner",h.setAttribute("aria-hidden","true");let m=document.createElement("div");m.className="ddc-hero";let x=this.heroImage;if(x){let O=document.createElement("img");O.src=x,O.alt="",m.appendChild(O)}let y=document.createElement("div");y.className="ddc-title",y.textContent="Drag & Drop Card";let w=document.createElement("div");w.className="ddc-sub",w.textContent="Hold me / double click me to enter Edit mode",m.append(y,w),h.appendChild(m),c.addEventListener("dblclick",O=>{O.stopPropagation(),this._toggleEditMode(!0)});let k=document.createElement("div");return k.className="shield",c.append(h,k),c}_processCardModOnce(){var a;if(this._cardModProcessed)return;this._cardModProcessed=!0,(((a=this.cardContainer)==null?void 0:a.querySelectorAll('[data-needs-card-mod="true"]'))||[]).forEach(s=>{let p=s.firstElementChild;if(!p)return;let c=p._config||p.config;if(c){if(c.type==="custom:mod-card")setTimeout(()=>{if(p.updateComplete)p.updateComplete.then(()=>{p.requestUpdate()});else if(p.setConfig)try{p.setConfig({...c})}catch{}},100);else if(c.card_mod&&p.setConfig)try{p.setConfig({...c})}catch{}}})}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let n=this._makePlaceholderAt(0,0,200,200);this.cardContainer.appendChild(n),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(n=>n.remove())}_ensurePlaceholderIfEmpty(){var a;this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),(a=this._applyAutoScale)==null||a.call(this),this._syncEmptyStateUI()}_adjustZ(n,a){let p=parseInt(n.style.zIndex||"1",10)+a;p=Math.max(1,Math.min(9999,p)),n.style.zIndex=String(p),this._queueSave("z-change")}_highestZ(){let n=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(a=>{let s=parseInt(a.style.zIndex||"0",10);s>n&&(n=s)}),n}_setCardPosition(n,a,s){let p=Math.round(a),c=Math.round(s);n.style.transform=`translate3d(${p}px, ${c}px, 0)`,n.setAttribute("data-x",String(p)),n.setAttribute("data-y",String(c)),n.setAttribute("data-x-raw",String(p)),n.setAttribute("data-y-raw",String(c))}_computeDesignSize(){let n=this.cardContainer;if(!n)return{w:1,h:1};if(this._isContainerFixed()){let{w:h,h:m}=this._resolveFixedSize();return{w:Math.max(1,h),h:Math.max(1,m)}}let a=0,s=0,p=Array.from(n.querySelectorAll(".card-wrapper"));if(!p.length){let h=n.getBoundingClientRect();return{w:Math.max(1,h.width||1),h:Math.max(1,h.height||1)}}for(let h of p){let m=parseFloat(h.getAttribute("data-x-raw")||h.getAttribute("data-x")||"0")||0,x=parseFloat(h.getAttribute("data-y-raw")||h.getAttribute("data-y")||"0")||0,y=parseFloat(h.style.width)||h.getBoundingClientRect().width||0,w=parseFloat(h.style.height)||h.getBoundingClientRect().height||0,k=m+y,O=x+w;k>a&&(a=k),O>s&&(s=O)}let c=Math.max(1,this.gridSize||10);return a=Math.ceil(a/c)*c,s=Math.ceil(s/c)*c,{w:Math.max(1,a),h:Math.max(1,s)}}_startScaleWatch(){if(!this.autoResizeCards||this.__scaleRAF)return;let n=()=>{var p;if(!this.autoResizeCards){this.__scaleRAF=null;return}let a=this.getBoundingClientRect(),s=Math.max(1,a.width||0);s!==this.__lastScaleW&&(this.__lastScaleW=s,(p=this._applyAutoScale)==null||p.call(this)),this.__scaleRAF=requestAnimationFrame(n)};this.__scaleRAF=requestAnimationFrame(n)}_stopScaleWatch(){if(this.__scaleRAF){try{cancelAnimationFrame(this.__scaleRAF)}catch{}this.__scaleRAF=null}}_applyAutoScale(){var h,m,x,y,w,k,O,z;let n=this.cardContainer;if(!n)return;if(typeof this._ensureScaleWrapper=="function"&&this._ensureScaleWrapper(),!this.autoResizeCards){let A=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:n.offsetWidth||1,h:n.offsetHeight||1};if(n.style.width=`${A.w}px`,n.style.height=`${A.h}px`,n.style.transform="scale(1)",n.style.transformOrigin="top left",n.style.position="absolute",n.style.top="0",n.style.left="0",this.__scaleOuter){let M=this.parentElement&&((m=(h=this.parentElement).getBoundingClientRect)==null?void 0:m.call(h).width)||this.offsetParent&&((y=(x=this.offsetParent).getBoundingClientRect)==null?void 0:y.call(x).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||A.w;this.__scaleOuter.style.width=`${Math.max(1,M)}px`,this.__scaleOuter.style.height=`${Math.max(1,A.h)}px`}return}let a=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:n.offsetWidth||1,h:n.offsetHeight||1},s=this.parentElement&&((k=(w=this.parentElement).getBoundingClientRect)==null?void 0:k.call(w).width)||this.offsetParent&&((z=(O=this.offsetParent).getBoundingClientRect)==null?void 0:z.call(O).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||a.w,p=Math.max(1,s),c=Math.min(p/Math.max(1,a.w),1);this.__scaleOuter&&(this.__scaleOuter.style.width=`${p}px`,this.__scaleOuter.style.height=`${Math.max(1,a.h*c)}px`),n.style.width=`${a.w}px`,n.style.height=`${a.h}px`,n.style.transform=`scale(${c})`,n.style.transformOrigin="top left",n.style.position="absolute",n.style.top="0",n.style.left="0"}_resizeContainer(){let n=this.cardContainer;if(!n||this._isContainerFixed())return;let a=Array.from(n.querySelectorAll(".card-wrapper")),s=0,p=0;a.forEach(c=>{let h=c.getBoundingClientRect(),m=n.getBoundingClientRect(),x=h.left-m.left+h.width,y=h.top-m.top+h.height;s=Math.max(s,x),p=Math.max(p,y)}),n.style.width=`${Math.ceil(s/this.gridSize)*this.gridSize||100}px`,n.style.height=`${Math.ceil(p/this.gridSize)*this.gridSize||100}px`}_pushCardsOutOfTheWay(n,a,s,p,c){if(!this.__collisionOriginals)return;let h=new Set(n.map(C=>C.el)),m=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(C=>!C.dataset.placeholder),x=this._isContainerFixed(),{w:y,h:w}=this._getContainerSize();for(let C of m){if(h.has(C))continue;let P=this.__collisionOriginals.get(C);if(P){C.setAttribute("data-x-raw",String(P.x)),C.setAttribute("data-y-raw",String(P.y));let T=p?Math.round(P.x/c)*c:P.x,v=p?Math.round(P.y/c)*c:P.y;this._setCardPosition(C,T,v)}}let k=n.map(C=>({x:C.snapX,y:C.snapY,w:C.w,h:C.h})),O=new Map,z=new Map;for(let C of m){let P=parseFloat(C.style.width)||C.getBoundingClientRect().width,T=parseFloat(C.style.height)||C.getBoundingClientRect().height;z.set(C,{w:P,h:T})}let A=a>0?1:a<0?-1:0,M=s>0?1:s<0?-1:0,D=Math.abs(a)>=Math.abs(s);for(let C of m){if(h.has(C))continue;let P=this.__collisionOriginals.get(C);if(!P)continue;let{x:T,y:v}=P,{w:L,h:R}=z.get(C),V=!1;for(let B of k)if(this._rectsOverlap({x:B.x,y:B.y,w:B.w,h:B.h},{x:T,y:v,w:L,h:R})){V=!0,D&&A!==0?T=A>0?B.x+B.w:B.x-L:!D&&M!==0?v=M>0?B.y+B.h:B.y-R:T=B.x+B.w;break}if(V){let B=0,Y=D?A!==0?A*c:c:0,re=D?0:M!==0?M*c:c;for(;B<100;){let G={x:T,y:v,w:L,h:R},te=!1;for(let se of k)if(this._rectsOverlap(G,se)){te=!0;break}if(!te){for(let[,se]of O)if(this._rectsOverlap(G,se)){te=!0;break}}if(!te&&x&&(T<0||v<0||T+L>y||v+R>w)&&(te=!0),!te)break;T+=Y,v+=re,B++}x&&(T=Math.max(0,Math.min(T,Math.max(0,y-L))),v=Math.max(0,Math.min(v,Math.max(0,w-R))))}O.set(C,{x:T,y:v,w:L,h:R}),k.push({x:T,y:v,w:L,h:R})}for(let[C,P]of O){C.setAttribute("data-x-raw",String(P.x)),C.setAttribute("data-y-raw",String(P.y));let T=p?Math.round(P.x/c)*c:P.x,v=p?Math.round(P.y/c)*c:P.y;this._setCardPosition(C,T,v)}}_rectFor(n,a=null,s=null,p=null,c=null){let h=a!=null?a:parseFloat(n.getAttribute("data-x"))||0,m=s!=null?s:parseFloat(n.getAttribute("data-y"))||0,x=p!=null?p:parseFloat(n.style.width)||n.getBoundingClientRect().width||0,y=c!=null?c:parseFloat(n.style.height)||n.getBoundingClientRect().height||0;return{x:h,y:m,w:x,h:y,el:n}}_rectsOverlap(n,a,s=.5){return!(n.x+n.w<=a.x+s||a.x+a.w<=n.x+s||n.y+n.h<=a.y+s||a.y+a.h<=n.y+s)}_anyCollisionFor(n,a){let s=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(c=>!a.has(c)&&!c.dataset.placeholder);if(!s.length)return!1;let p=s.map(c=>this._rectFor(c));for(let c of n)for(let h of p)if(this._rectsOverlap(c,h))return!0;return!1}_extractCardConfig(n){var s;if(!n)return{};let a=n._config||n.config;if(a&&typeof a=="object"&&Object.keys(a).length)return a;try{let p=n.closest?n.closest(".card-wrapper"):null,c=(s=p==null?void 0:p.dataset)==null?void 0:s.cfg;if(c){let h=JSON.parse(c);if(h&&typeof h=="object")return h}}catch{}return{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(n,a){try{console.info("[ddc:editor] Requesting editor element",{type:n,cfg:a})}catch{}let s=await this._helpersPromise||await window.loadCardHelpers();try{typeof n=="string"&&n&&!n.startsWith("custom:")&&n!=="custom_card"&&await this._ensureCardModuleLoaded(n,a)}catch{}let p=async()=>{try{if(s.getCardElementClass)return await s.getCardElementClass(n);let y;if(a&&typeof a=="object")y={type:n,...a};else{let k;try{k=await this._getStubConfigForType(n)}catch{}y=k&&typeof k=="object"?{...k}:{type:n}}let w=s.createCardElement(y);return(w==null?void 0:w.constructor)||null}catch{return null}};try{let y=await p();if(y&&typeof y.getConfigElement=="function"){let w=await y.getConfigElement();if(w){try{console.info("[ddc:editor] Found static class editor",{type:n})}catch{}return w}}}catch{}if(typeof n=="string"&&(n.startsWith("custom:")||n==="custom_card"||n==="entity"))try{let y;try{y=await this._getStubConfigForType(n)}catch{}let w=y&&typeof y=="object"?{...y}:{type:n},k=s.createCardElement(w);if(k.hass=this.hass,typeof k.getConfigElement=="function"){let O=await k.getConfigElement();if(O){try{console.info("[ddc:editor] Found instance-level editor",{type:n})}catch{}return O}}}catch{}let c=String(n).replace(/^custom:/,""),m=(Array.isArray(window.customCards)?window.customCards:[]).find(y=>(y==null?void 0:y.type)===c||(y==null?void 0:y.type)===n||(y==null?void 0:y.type)===`custom:${c}`),x=[];m!=null&&m.editor&&x.push(m.editor),x.push(`${c}-editor`,`${c}-config-editor`),c&&typeof c=="string"&&x.push(`hui-${c}-card-editor`);for(let y of x)if(!(!y||typeof y!="string"))for(let w of[0,100,300,700,1500,3e3])try{if(customElements.get(y)||await Promise.race([customElements.whenDefined(y),new Promise(k=>setTimeout(k,w))]),customElements.get(y)){try{console.info("[ddc:editor] Found editor by tag",{type:n,tag:y})}catch{}return document.createElement(y)}}catch{}return null}async _ensureCardModuleLoaded(n,a){try{let s=await this._helpersPromise||await window.loadCardHelpers(),p;if(a&&typeof a=="object")p={type:n,...a};else{let m;try{m=await this._getStubConfigForType(n)}catch{}p=m&&typeof m=="object"?{...m}:{type:n}}let c=s.createCardElement(p);c.hass=this.hass;let h=document.createElement("div");h.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;",h.appendChild(c),document.body.appendChild(h),await new Promise(m=>requestAnimationFrame(m)),h.remove();try{console.info("[ddc:editor] Warmed card module",{type:n})}catch{}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let n=document.createElement("style");n.setAttribute("data-ddc-overlay-fix",""),n.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(n)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(a=>{var s;return{type:(s=a==null?void 0:a.type)!=null&&s.startsWith("custom:")?a.type:`custom:${a==null?void 0:a.type}`,name:(a==null?void 0:a.name)||(a==null?void 0:a.type)||"Custom card",icon:"mdi:puzzle-outline",description:(a==null?void 0:a.description)||"",editorTag:(a==null?void 0:a.editor)||null}}).filter(a=>typeof a.type=="string"&&a.type.startsWith("custom:"))}_schemaForType(n){let a=p=>p,s=[];return{entities:a({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities"}]}),entity:a({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"}]}),sensor:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":a({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:a({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"}]}),"picture-glance":a({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":a({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:a({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:a({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":a({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:a({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:a({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"}]}),button:a({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity (optional)"}]}),iframe:a({fields:[{key:"url",type:"text",label:"URL"}]}),area:a({fields:[{key:"area",type:"text",label:"Area ID"}]})}[n]||{fields:[]}}_shapeBySchema(n,a={}){let s=this._schemaForType(n)||{fields:[]},p={...a,type:n};for(let c of s.fields){let h=p[c.key];if(c.type==="entities"){let x=(Array.isArray(h)?h:h!=null&&h!==""?[h]:[]).filter(Boolean);x.length?p[c.key]=x:delete p[c.key]}else if(c.type==="entity")Array.isArray(h)&&(h=h[0]),h==null||h===""?delete p[c.key]:p[c.key]=String(h);else if(c.type==="number")if(h==null||h==="")delete p[c.key];else{let m=Number(h);Number.isFinite(m)?p[c.key]=m:delete p[c.key]}else(c.type==="select"||c.type==="text"||c.type==="textarea")&&(h==null||h===""?delete p[c.key]:p[c.key]=h)}return p}_statesList(n){var p;let a=Object.keys(((p=this.hass)==null?void 0:p.states)||{});if(!n||!n.length)return a;if(!this.__domainIndex||this.__domainIndex._gen!==a.length){let c={};for(let h of a){let m=h.split(".")[0];(c[m]||(c[m]=[])).push(h)}this.__domainIndex={_gen:a.length,map:c}}let s=[];for(let c of n)this.__domainIndex.map[c]&&s.push(...this.__domainIndex.map[c]);return s}_isNumericEntity(n){var p,c;let a=(c=(p=this.hass)==null?void 0:p.states)==null?void 0:c[n];if(!a)return!1;let s=Number(a.state);return Number.isFinite(s)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(n){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(n)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(n){try{let a=this._getRecent().filter(s=>s!==n);a.unshift(n),a.length>10&&(a.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(a))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let n=document.createElement("link");n.rel="stylesheet",n.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",n.setAttribute("data-cm-core",""),document.head.appendChild(n)}await new Promise(n=>{if(window.CodeMirror)return n();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",a.onload=n,document.head.appendChild(a)}),await new Promise(n=>{var s,p;if((p=(s=window.CodeMirror)==null?void 0:s.mimeModes)!=null&&p.yaml)return n();let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",a.onload=n,document.head.appendChild(a)}),this.__cmReady=!0}}async _mountYamlEditor(n,a,s,p){let c=x=>window.jsyaml?window.jsyaml.dump(x):JSON.stringify(x,null,2),h=x=>window.jsyaml?window.jsyaml.load(x):JSON.parse(x);n.innerHTML="";let m=c(a);if(customElements.get("ha-code-editor")){let x=document.createElement("ha-code-editor");x.mode="yaml",x.hass=this.hass,x.value=m,x.style.display="block",x.style.height="260px",n.appendChild(x);let y=!1;return x.addEventListener("value-changed",w=>{var O,z,A;if(y)return;let k=(A=(z=(O=w.detail)==null?void 0:O.value)!=null?z:x.value)!=null?A:"";try{s(h(k))}catch(M){p==null||p(M)}}),{setValue:w=>{var O;let k=c(w);((O=x.value)!=null?O:"")!==k&&(y=!0,x.value=k,y=!1)}}}try{await this._ensureCodeMirror();let x=window.CodeMirror(n,{value:m,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),y=!1;return x.on("change",()=>{if(y)return;let w=x.getValue();try{s(h(w))}catch(k){p==null||p(k)}}),{setValue:w=>{let k=c(w);x.getValue()!==k&&(y=!0,x.setValue(k),y=!1)}}}catch{let x=document.createElement("textarea");return x.style.width="100%",x.style.height="260px",x.value=m,x.addEventListener("input",()=>{try{s(h(x.value))}catch(y){p==null||p(y)}}),n.appendChild(x),{setValue:y=>{let w=c(y);x.value!==w&&(x.value=w)}}}}_createVirtualList({container:n,items:a,rowHeight:s=36,renderRow:p}){n.style.position="relative",n.style.overflow="auto";let c=document.createElement("div");c.style.height=`${a.length*s}px`,n.innerHTML="",n.appendChild(c);let h=new Map,m=()=>{let x=n.scrollTop,y=n.clientHeight,w=Math.max(0,Math.floor(x/s)-6),k=Math.min(a.length-1,Math.ceil((x+y)/s)+6);for(let[O,z]of h)(O<w||O>k)&&(z.remove(),h.delete(O));for(let O=w;O<=k;O++){if(h.has(O))continue;let z=p(a[O],O);z.style.position="absolute",z.style.left="0",z.style.right="0",z.style.top=`${O*s}px`,h.set(O,z),n.appendChild(z)}};return n.addEventListener("scroll",m,{passive:!0}),new ResizeObserver(m).observe(n),m(),{refresh(x){if(x){a=x,c.style.height=`${a.length*s}px`;for(let[,y]of h)y.remove();h.clear()}m()}}}async _openSmartPicker(n="add",a=null,s=null){let p=()=>c.remove(),c=document.createElement("div");c.className="modal",c.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${n==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${n==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${n==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.shadowRoot.appendChild(c);let h=c.querySelector("#leftPane"),m=c.querySelector("#addBtn"),x=c.querySelector("#footAdd"),y=c.querySelector("#cancelBtn"),w=c.querySelector("#footCancel"),k=c.querySelector("#search"),O=c.querySelector("#cardHost"),z=c.querySelector("#editorHost"),A=c.querySelector("#editorSpin"),M=c.querySelector("#quickFill"),D=c.querySelector("#yamlHost"),C=c.querySelector("#yamlErr"),P=c.querySelector("#yamlSec"),T=c.querySelector("#tabVisual"),v=c.querySelector("#tabYaml"),L=c.querySelector("#err"),R=c.querySelector("#previewSpin"),V=q=>{m.disabled=x.disabled=!q},B=q=>{q?(L.hidden=!1,L.textContent=q):(L.hidden=!0,L.textContent="")},Y=this._getFaves(),re=this._getRecent(),G=this._catalog(),te=G.find(q=>q.id==="favorites"),se=G.find(q=>q.id==="recent"),pe=G.flatMap(q=>q.items||[]);te.items=pe.filter(q=>Y.has(q.type)),se.items=re.map(q=>pe.find(K=>K.type===q)).filter(Boolean);let Ae=this._customCardsFromRegistry();Ae.length&&G.push({id:"custom",name:"Custom (installed)",items:Ae});let ve=c.querySelector("#quickFillSec");ve&&(ve.style.display="none");let be=c.querySelector("#optionsSec"),xe=c.querySelector("#yamlSec");be&&(be.style.gridRow="1"),xe&&(xe.style.gridRow="2");let le=c.querySelector("#optionsSec .hd"),Le,Oe,Ke=()=>{if(!Oe)return;let q=fe&&Y.has(fe),K=Oe.querySelector("ha-icon");K&&K.setAttribute("icon",q?"mdi:star":"mdi:star-outline")},$e=q=>{if(Le){let K=pe.find(oe=>oe.type===q),$=K?K.name:q||"";Le.textContent=$}Ke()};if(le&&!le.querySelector(".sel-info")){let q=le.querySelector("span");q&&(q.style.display="none"),Le=document.createElement("span"),Le.className="sel-info",Le.style.flex="1",Le.style.fontWeight="bold",Le.style.paddingRight="8px",le.insertBefore(Le,le.firstChild),Oe=document.createElement("button"),Oe.className="icon-btn",Oe.setAttribute("title","Favorite"),Object.assign(Oe.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--primary-background-color)",padding:"0",marginLeft:"4px",cursor:"pointer"}),Oe.innerHTML='<ha-icon icon="mdi:star-outline"></ha-icon>',le.appendChild(Oe),Oe.addEventListener("click",K=>{K.stopPropagation(),fe&&(Y.has(fe)?Y.delete(fe):Y.add(fe),this._setFaves(Y),Ke(),Ye())})}let Fe="visual",Pe=q=>{let K=q==="yaml";T.classList.toggle("active",!K),T.setAttribute("aria-selected",String(!K)),v.classList.toggle("active",K),v.setAttribute("aria-selected",String(K)),z.parentElement.style.display=K?"none":"",P.style.display=K?"":"none",K&&P.scrollIntoView({behavior:"smooth",block:"start"}),Fe=K?"yaml":"visual"};T.addEventListener("click",async()=>{var q;if(Pe("visual"),!ye)await st(H);else try{(q=ye.setConfig)==null||q.call(ye,H)}catch{}}),v.addEventListener("click",()=>Pe("yaml")),Pe("visual");let X=()=>{let q=k.value.trim().toLowerCase();return G.map(K=>({...K,items:(K.items||[]).filter($=>!q||$.name.toLowerCase().includes(q)||$.type.toLowerCase().includes(q))})).filter(K=>K.items&&K.items.length||K.id==="favorites"||K.id==="recent")},Ye=()=>{let q=X();h.innerHTML="",q.forEach(K=>{let $=document.createElement("div");$.style.padding="12px",$.style.borderBottom="1px solid var(--divider-color)";let oe=document.createElement("h4");if(oe.textContent=K.name,oe.style.margin="0 0 10px 0",oe.style.fontSize=".92rem",oe.style.opacity=".85",$.appendChild(oe),!K.items.length&&(K.id==="favorites"||K.id==="recent")){let Q=document.createElement("div");Q.style.opacity=".6",Q.style.fontSize=".85rem",Q.textContent=K.id==="favorites"?"No favorites yet.":"No recent items yet.",$.appendChild(Q)}else K.items.forEach(Q=>{let me=document.createElement("button");me.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${Q.icon}"></ha-icon><span>${Q.name}</span>
            </span>`,Object.assign(me.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),me.addEventListener("click",async()=>{je(me),await rt(Q.type)}),$.appendChild(me)});h.appendChild($)})},je=q=>{h.querySelectorAll("button").forEach(K=>{K.classList.remove("active"),K.style.background="transparent",K.style.color=""}),q&&(q.classList.add("active"),q.style.background="rgba(3,169,244,.12)",q.style.color="var(--primary-color)")},H=null,fe=null,ae=null,ye=null,De=0,at=null,tt="",pt=(q,K)=>{var Te;let $=this._schemaForType(q);if(M.innerHTML="",!$.fields.length){M.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let oe=Object.keys(((Te=this.hass)==null?void 0:Te.states)||{}),Q=document.createElement("div"),me=(J,we,Me,Se)=>{let ke=document.createElement("div");Object.assign(ke.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),ke.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${J}</span>`,we.includes(J)&&(ke.style.background="rgba(3,169,244,.12)",ke.style.borderColor="var(--primary-color)",ke.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),ke.addEventListener("click",async()=>{let it=we.indexOf(J);it>=0?we.splice(it,1):we.push(J);let lt=we.includes(J);ke.style.background=lt?"rgba(3,169,244,.12)":"",ke.style.borderColor=lt?"var(--primary-color)":"var(--divider-color)",ke.querySelector("ha-icon").setAttribute("icon",lt?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),H=this._shapeBySchema(q,{...H,[Se]:[...we]}),Re(H),ae==null||ae.setValue(H)}),Me.appendChild(ke)};$.fields.forEach(J=>{var Se,ke,it,lt,Ct,Rt,Et,At,Ft;let we=document.createElement("div");Object.assign(we.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let Me=document.createElement("label");if(Me.textContent=J.label||J.key,Me.style.minWidth="130px",J.type==="entities"){let ge=document.createElement("div");ge.style.flex="1";let ue=document.createElement("input");Object.assign(ue,{placeholder:"Filter entities\u2026"}),Object.assign(ue.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let Ce=document.createElement("div");Object.assign(Ce.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let Ue=J.domains&&J.domains.length?this._statesList(J.domains):oe,Ze=Array.isArray(K[J.key])?[...K[J.key]]:K[J.key]?[K[J.key]]:[],Ot=Be=>{let qe=document.createElement("div");Object.assign(qe.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let Je=document.createElement("ha-icon");Je.setAttribute("icon","mdi:checkbox-blank-outline"),Je.style.setProperty("--mdc-icon-size","18px");let _t=document.createElement("span");_t.textContent=Be,_t.style.whiteSpace="nowrap",_t.style.overflow="hidden",_t.style.textOverflow="ellipsis",qe.append(Je,_t);let Gt=()=>{let ct=Ze.includes(Be);qe.style.background=ct?"rgba(3,169,244,.12)":"",qe.style.borderColor=ct?"var(--primary-color)":"var(--divider-color)",Je.setAttribute("icon",ct?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return Gt(),qe.addEventListener("click",()=>{let ct=Ze.indexOf(Be);ct>=0?Ze.splice(ct,1):Ze.push(Be),H=this._shapeBySchema(q,{...H,[J.key]:[...Ze]}),Re(H),ae==null||ae.setValue(H),Gt()}),qe},Tt=Ue;this._createVirtualList({container:Ce,items:Tt,rowHeight:36,renderRow:Ot}),ue.addEventListener("input",()=>{let Be=ue.value.trim().toLowerCase();Tt=Ue.filter(qe=>!Be||qe.toLowerCase().includes(Be)),this._createVirtualList({container:Ce,items:Tt,rowHeight:36,renderRow:Ot})}),ge.append(ue,Ce),we.append(Me,ge),H=this._shapeBySchema(q,{...K,[J.key]:Ze})}if(J.type==="entity"){let ge=document.createElement("div");ge.style.flex="1",ge.style.position="relative";let ue=document.createElement("input");ue.setAttribute("list","ddc_entlist_"+J.key),Object.assign(ue.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),ue.placeholder=`Select ${((Se=J.label)==null?void 0:Se.toLowerCase())||"entity"}\u2026`;let Ce=document.createElement("ha-icon");Ce.setAttribute("icon","mdi:magnify"),Object.assign(Ce.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let Ue=document.createElement("datalist");Ue.id="ddc_entlist_"+J.key;let Ze=J.domains&&J.domains.length?this._statesList(J.domains):Object.keys(((ke=this.hass)==null?void 0:ke.states)||{});Ue.innerHTML=Ze.map(Ot=>`<option value="${Ot}">`).join(""),ue.value=Array.isArray(K[J.key])?K[J.key][0]||"":K[J.key]||"",ue.addEventListener("change",async()=>{H=this._shapeBySchema(q,{...H,[J.key]:ue.value||void 0}),Re(H),ae==null||ae.setValue(H)}),ge.append(Ce,ue,Ue),we.append(Me,ge)}if(J.type==="number"){let ge=document.createElement("div");ge.style.flex="1",ge.style.position="relative";let ue=document.createElement("input");ue.type="number",J.step&&(ue.step=J.step),Object.assign(ue.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let Ce=document.createElement("ha-icon");Ce.setAttribute("icon","mdi:counter"),Object.assign(Ce.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),ue.value=(lt=(it=K[J.key])!=null?it:J.default)!=null?lt:"",ue.addEventListener("input",async()=>{let Ue=ue.value===""?void 0:Number(ue.value);H=this._shapeBySchema(q,{...H,[J.key]:isNaN(Ue)?void 0:Ue}),Re(H),ae==null||ae.setValue(H)}),ge.append(Ce,ue),we.append(Me,ge)}if(J.type==="select"){let ge=document.createElement("div");ge.style.flex="1",ge.style.position="relative";let ue=document.createElement("select");Object.assign(ue.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let Ce=document.createElement("ha-icon");Ce.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(Ce.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(J.options||[]).forEach(Ue=>{let Ze=document.createElement("option");Ze.value=Ue,ue.appendChild(Ze)}),ue.value=(Et=(Ct=K[J.key])!=null?Ct:J.default)!=null?Et:((Rt=J.options)==null?void 0:Rt[0])||"",ue.addEventListener("change",async()=>{H=this._shapeBySchema(q,{...H,[J.key]:ue.value}),Re(H),ae==null||ae.setValue(H)}),ge.append(Ce,ue),we.append(Me,ge)}if(J.type==="text"){let ge=document.createElement("div");ge.style.flex="1",ge.style.position="relative";let ue=document.createElement("input");ue.type="text",Object.assign(ue.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let Ce=document.createElement("ha-icon");Ce.setAttribute("icon","mdi:text"),Object.assign(Ce.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),ue.value=(At=K[J.key])!=null?At:"",ue.addEventListener("input",async()=>{H=this._shapeBySchema(q,{...H,[J.key]:ue.value||void 0}),Re(H),ae==null||ae.setValue(H)}),ge.append(Ce,ue),we.append(Me,ge)}if(J.type==="textarea"){let ge=document.createElement("textarea");Object.assign(ge.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),ge.value=(Ft=K[J.key])!=null?Ft:"",ge.addEventListener("input",async()=>{H=this._shapeBySchema(q,{...H,[J.key]:ge.value||""}),Re(H),ae==null||ae.setValue(H)}),we.append(Me,ge)}Q.appendChild(we)}),M.innerHTML="",M.appendChild(Q)},Re=q=>{if(((q==null?void 0:q.type)||"")==="custom_card"){tt=JSON.stringify(q||{}),O.innerHTML='<div style="opacity:.6;font-size:.9rem;padding:8px">Preview not available for the custom card placeholder. Use the YAML editor.</div>',R.hidden=!0;return}let K=JSON.stringify(q||{});K!==tt&&(tt=K,at&&clearTimeout(at),at=setTimeout(async()=>{let $=++De;R.hidden=!1,O.innerHTML="",await qi();try{let oe=await this._helpersPromise||await window.loadCardHelpers();if($!==De)return;let Q=oe.createCardElement(q);if(Q.hass=this.hass,$!==De)return;O.appendChild(Q)}catch{}finally{$===De&&(R.hidden=!0)}},150))},st=async q=>{var oe;let K=++De;if(A.hidden=!1,z.innerHTML="",await cl(),(q.type||fe)==="custom_card"){let Q=document.createElement("div");return Q.style.opacity=".7",Q.style.fontSize=".9rem",Q.textContent="Custom card placeholder: use the YAML editor to paste the card type and options.",z.appendChild(Q),ye=null,Fe!=="yaml"&&Pe("yaml"),V(!0),A.hidden=!0,!1}if(!editor){let Q=document.createElement("div");return Q.style.opacity=".7",Q.style.fontSize=".9rem",Q.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",K===De&&(z.appendChild(Q),A.hidden=!0),ye=null,V(!0),Fe!=="visual"&&Pe("yaml"),!1}try{editor.hass=this.hass,editor.isConnected||z.appendChild(editor),await Promise.resolve();try{editor.setConfig(q)}catch{}try{let me=await this._helpersPromise||await window.loadCardHelpers(),Te=me.getCardElementClass?await me.getCardElementClass(q.type||fe):null;if(Te!=null&&Te.getStubConfig){let J=Object.keys(((oe=this.hass)==null?void 0:oe.states)||{}),we=Se=>J.filter(ke=>ke.startsWith(Se+".")),Me=await Te.getStubConfig(this.hass,J,we);Me&&(q=this._shapeBySchema(q.type||fe,{...Me}))}}catch{}await Promise.resolve();try{editor.setConfig(q)}catch{}ye&&this.__onEditorChange&&(ye.removeEventListener("config-changed",this.__onEditorChange),ye.removeEventListener("value-changed",this.__onEditorChange));let Q=async me=>{var we,Me,Se;let Te=(Se=(we=me.detail)==null?void 0:we.config)!=null?Se:(Me=me.detail)==null?void 0:Me.value;if(!Te)return;let J=Te.type||fe;fe=J,H=this._shapeBySchema(J,Te),B(""),V(!0),pt(fe,H),Re(H),ae==null||ae.setValue(H)};return this.__onEditorChange=Q,editor.addEventListener("config-changed",Q),editor.addEventListener("value-changed",Q),ye=editor,Fe!=="yaml"&&Pe("visual"),V(!0),!0}finally{K===De&&(A.hidden=!0)}},_e=async q=>{ae=await this._mountYamlEditor(D,q,async K=>{var $,oe;try{let Q=(K==null?void 0:K.type)||fe,me=this._shapeBySchema(Q,K||{}),Te=Q!==fe;if(fe=Q,H=me,C.hidden=!0,C.textContent="",V(!0),Te){if(pt(fe,H),ye){try{($=ye.setConfig)==null||$.call(ye,H)}catch{}Fe!=="yaml"&&Pe("visual")}}else{try{(oe=ye==null?void 0:ye.setConfig)==null||oe.call(ye,H)}catch{}Re(H)}}catch(Q){C.hidden=!1,C.textContent=`Invalid config: ${String((Q==null?void 0:Q.message)||Q)}`,V(!1)}},K=>{C.hidden=!1,C.textContent=`Invalid YAML: ${String((K==null?void 0:K.message)||K)}`,V(!1)})},Dt=async q=>{if(this.__stubCache.has(q))return{...this.__stubCache.get(q)};let K=await this._getStubConfigForType(q);return this.__stubCache.set(q,{...K}),{...K}},rt=async q=>{C.hidden=!0,C.textContent="",B(""),fe=q;try{typeof $e=="function"&&$e(q)}catch{}let K=n==="edit"&&a&&a.type===q?{...a}:await Dt(q);H=this._shapeBySchema(q,K),ye=null,pt(q,H),await _e(H),await qi(),Re(H),Pe("yaml"),V(!0)},ht=async()=>{if(!H)return;let q=this._shapeBySchema(fe,H);n==="edit"&&typeof s=="function"?await s(q):(await this._addPickedCardToLayout(q),this._pushRecent((q||{}).type)),p()};y.addEventListener("click",p),w.addEventListener("click",p),m.addEventListener("click",ht),x.addEventListener("click",ht),c.addEventListener("keydown",q=>{q.key==="Escape"&&p(),q.key==="Enter"&&!m.disabled&&ht()});let We=null;k.addEventListener("input",()=>{We&&clearTimeout(We),We=setTimeout(Ye,120)}),Ye(),await rt((()=>{var $;return((($=this._getRecent)==null?void 0:$.call(this))||[]).find(Boolean)||"entities"})()),V(!0),n==="edit"&&a&&(await rt(a.type||"entities"),V(!0))}async _getStubConfigForType(n){var y;let a=await this._helpersPromise||await window.loadCardHelpers(),s=null;if(n==="custom_card")return null;try{a.getCardElementClass&&(s=await a.getCardElementClass(n))}catch{}let p=Object.keys(((y=this.hass)==null?void 0:y.states)||{}),c=w=>p.filter(k=>k.startsWith(w+".")),h={type:n};if(s!=null&&s.getStubConfig)try{let w=await s.getStubConfig(this.hass,p,c);if(n!=="entity")return w;w&&typeof w=="object"&&(h={...h,...w})}catch{}let m=p[0],x=c("sensor")[0]||m;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast","map"].includes(n)){let w={sensor:x,gauge:c("sensor").find(this._isNumericEntity.bind(this))||x,"media-control":c("media_player")[0]||m,light:c("light")[0]||m,thermostat:c("climate")[0]||m,"alarm-panel":c("alarm_control_panel")[0]||m,"weather-forecast":c("weather")[0]||m,map:c("device_tracker")[0]||c("person")[0]||m}[n]||x||m;["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity"].includes(n)?h.entity=w:n==="weather-forecast"?(h.entity=w,h.show_current=!0,h.show_forecast=!0,h.forecast_type="daily"):n==="map"&&(h.entities=[w].filter(Boolean),h.theme_mode="auto")}if(["entities","glance","picture-glance","history-graph","statistics-graph"].includes(n)){let w=k=>(k!=null&&k.length?p.filter(O=>k.includes(O.split(".")[0])):p).slice(0,3);n==="statistics-graph"?h.entities=w(["sensor","number","input_number"]):h.entities=w()}if(n==="markdown"&&(h.content="Markdown card"),n==="sensor"&&(h.graph="line"),n==="button"&&(h.show_name=!0,h.show_icon=!0),n==="tile"&&(h.features_position="bottom",h.vertical=!1),n==="picture-glance"&&(h.title=h.title||"Glance",h.image=h.image||"https://demo.home-assistant.io/stub_config/kitchen.png"),n==="picture-entity"&&(h.image=h.image||"https://demo.home-assistant.io/stub_config/bedroom.png"),n==="iframe"&&(h.url=h.url||"https://www.home-assistant.io",h.aspect_ratio=h.aspect_ratio||"50%"),n==="alarm-panel"&&(h.states=h.states||["arm_home","arm_away"]),n==="area")try{let w=this.hass&&this.hass.areas?Object.values(this.hass.areas):[];w.length?h.area=w[0].area_id||w[0].name||w[0].id:h.area=m?m.split(".")[0]:"default_area",h.display_type="picture",h.alert_classes=h.alert_classes||["moisture","motion"],h.sensor_classes=h.sensor_classes||["temperature","humidity"],h.features_position="bottom"}catch{}return h}_getNextAvailablePosition(){let n=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),a=new Set,s=this.gridSize;n.forEach(h=>{let m=parseFloat(h.getAttribute("data-x"))||0,x=parseFloat(h.getAttribute("data-y"))||0,y=parseFloat(getComputedStyle(h).width)||100,w=parseFloat(getComputedStyle(h).height)||100,k=Math.floor(m/s),O=Math.floor(x/s),z=Math.floor((m+y)/s),A=Math.floor((x+w)/s);for(let M=k;M<z;M++)for(let D=O;D<A;D++)a.add(`${M}-${D}`)});let p=0,c=0;for(;a.has(`${p}-${c}`);)p+=6,p>60&&(p=0,c+=6);return{x:p*s,y:c*s}}async _addPickedCardToLayout(n){this._hideEmptyPlaceholder();let a=await this._createCard(n),s=this._makeWrapper(a),p=this._getNextAvailablePosition();this._setCardPosition(s,p.x,p.y),s.style.width=`${14*this.gridSize}px`,s.style.height=`${10*this.gridSize}px`,s.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(s);try{this._rebuildOnce(s.firstElementChild)}catch{}this._initCardInteract(s),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI()}_toggleSelection(n,a=null){let s=a==null?!this._selection.has(n):!!a;s?this._selection.add(n):this._selection.delete(n),n.classList.toggle("selected",s)}_clearSelection(){for(let n of this._selection)n.classList.remove("selected");this._selection.clear()}_installSelectionMarquee(){let n=this.cardContainer,a=0,s=0,p=null,c=!1,h=k=>{let O=n.getBoundingClientRect(),z="touches"in k&&k.touches[0]?k.touches[0].clientX:k.clientX,A="touches"in k&&k.touches[0]?k.touches[0].clientY:k.clientY;return{x:z-O.left,y:A-O.top}},m=(k,O)=>{let z=Math.min(k,a),A=Math.max(k,a),M=Math.min(O,s),D=Math.max(O,s);p.style.left=`${z}px`,p.style.top=`${M}px`,p.style.width=`${A-z}px`,p.style.height=`${D-M}px`;let C=p.getBoundingClientRect(),P=n.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),P.forEach(T=>{let v=T.getBoundingClientRect();!(v.right<C.left||v.left>C.right||v.bottom<C.top||v.top>C.bottom)&&this._toggleSelection(T,!0)})},x=k=>{if(!this.editMode||k.target.closest(".card-wrapper"))return;c=!0;let O=h(k);a=O.x,s=O.y,p=document.createElement("div"),p.className="marquee",p.style.left=`${a}px`,p.style.top=`${s}px`,n.appendChild(p),k.preventDefault()},y=k=>{!c||!p||m(h(k).x,h(k).y)},w=()=>{c&&(c=!1,p&&p.remove(),p=null)};n.addEventListener("mousedown",x),window.addEventListener("mousemove",y),window.addEventListener("mouseup",w),n.addEventListener("touchstart",k=>{this.editMode&&(k.target.closest(".card-wrapper")||x(k))},{passive:!1}),window.addEventListener("touchmove",k=>{y(k)},{passive:!1}),window.addEventListener("touchend",w),window.addEventListener("touchcancel",w)}async _openDiagnostics(){var m,x;let n=document.createElement("div");n.className="modal";let a=this.storageKey||"(none)",s=this._backendOK&&!!this.storageKey,p=y=>y.slice(-200).map(w=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${w.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${w.kind}]</b>
        <span style="margin-left:6px">${this._safe(w.msg)}</span>
        ${w.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(w.extra,null,2))}</pre>`:""}
      </div>`).join("");n.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95vw);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((m=this._config)==null?void 0:m.storage_key)||"")}</code> \u2192 <code>${this._safe(a)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${s?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((x=this.cardContainer)==null?void 0:x.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${p(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let c=()=>n.remove();n.querySelector("#closeDiag").addEventListener("click",c),this.shadowRoot.appendChild(n);let h=()=>{let y=n.querySelector("#logArea"),w=k=>k.slice(-200).map(O=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${O.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${O.kind}]</b>
          <span style="margin-left:6px">${this._safe(O.msg)}</span>
          ${O.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(O.extra,null,2))}</pre>`:""}
        </div>`).join("");y.innerHTML=w(this._dbgDump()),y.scrollTop=y.scrollHeight};n.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{h()}}),n.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),h()}),n.querySelector("#exportJson").addEventListener("click",()=>{let w=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(A=>{let M=parseFloat(A.getAttribute("data-x"))||0,D=parseFloat(A.getAttribute("data-y"))||0,C=parseFloat(A.style.width)||A.getBoundingClientRect().width,P=parseFloat(A.style.height)||A.getBoundingClientRect().height,T=parseInt(A.style.zIndex||"1",10),v=this._extractCardConfig(A.firstElementChild),L=A.dataset.tabId||this.defaultTab;return{card:v,position:{x:M,y:D},size:{width:C,height:P},z:T,tabId:L}}),k={version:2,options:this._exportableOptions(),cards:w},O=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),z=document.createElement("a");z.href=URL.createObjectURL(O),z.download=`ddc_${this.storageKey||"layout"}.json`,z.click(),URL.revokeObjectURL(z.href)}),n.querySelector("#importJson").addEventListener("click",async()=>{let y=document.createElement("input");y.type="file",y.accept="application/json",y.onchange=async()=>{var z,A,M,D,C,P,T,v,L,R,V,B,Y;let w=(z=y.files)==null?void 0:z[0];if(!w)return;let k=await w.text();try{let re=JSON.parse(k);if(this._dbgPush("import","Loaded file",{bytes:k.length}),this.cardContainer.innerHTML="",(A=re.cards)!=null&&A.length)for(let G of re.cards)if(!(G!=null&&G.card)||typeof G.card=="object"&&Object.keys(G.card).length===0){let te=this._makePlaceholderAt(((M=G.position)==null?void 0:M.x)||0,((D=G.position)==null?void 0:D.y)||0,((C=G.size)==null?void 0:C.width)||200,((P=G.size)==null?void 0:P.height)||200);this.cardContainer.appendChild(te)}else{let te=await this._createCard(G.card),se=this._makeWrapper(te);this._setCardPosition(se,((T=G.position)==null?void 0:T.x)||0,((v=G.position)==null?void 0:v.y)||0),se.dataset.tabId=this._normalizeTabId(G.tabId||G.tab_id||this.defaultTab),this._setCardPosition(se,((L=G.position)==null?void 0:L.x)||0,((R=G.position)==null?void 0:R.y)||0),se.style.width=`${((V=G.size)==null?void 0:V.width)||140}px`,se.style.height=`${((B=G.size)==null?void 0:B.height)||100}px`,this.cardContainer.appendChild(se);try{this._rebuildOnce(se.firstElementChild)}catch{}this._initCardInteract(se)}else this._showEmptyPlaceholder(),(Y=this._applyAutoScale)==null||Y.call(this);this._resizeContainer(),await this._saveLayout(!1)}catch(re){this._dbgPush("import","Parse failed",{error:String(re)})}let O=new Event("ddc-logrefresh");window.dispatchEvent(O)},y.click()}),n.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),h();let y=(this.storageKey||"ddc_test")+"_selftest",w={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(y,w);let k=await this._loadLayoutFromBackend(y);this._dbgPush("test","Round-trip result",{wrote:w,read:k})}catch(k){this._dbgPush("test","Round-trip failed",{error:String(k)})}h()}),h()}_exportableOptions(){var a,s;let n={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(a=this.containerFixedWidth)!=null?a:void 0,container_fixed_height:(s=this.containerFixedHeight)!=null?s:void 0,container_preset:this.containerPreset,tabs:this.tabs,tabs_position:this.tabsPosition,default_tab:this.defaultTab,hide_tabs_when_single:!!this.hideTabsWhenSingle,auto_resize_cards:!!this.autoResizeCards};return Object.keys(n).forEach(p=>n[p]===void 0&&delete n[p]),n}_applyImportedOptions(n={},a=!0){var s,p,c,h,m,x,y,w;if(n&&Object.prototype.hasOwnProperty.call(n,"storage_key")&&this._isInHaEditorPreview())try{let k={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:k},bubbles:!0,composed:!0}))}catch{}this._config={...this._config||{},...n},"storage_key"in n&&(this.storageKey=n.storage_key||void 0),this._syncEditorsStorageKey(),"grid"in n&&(this.gridSize=Number(n.grid)||10),"drag_live_snap"in n&&(this.dragLiveSnap=!!n.drag_live_snap),"auto_save"in n&&(this.autoSave=!!n.auto_save),"auto_save_debounce"in n&&(this.autoSaveDebounce=Number(n.auto_save_debounce)||800),"container_background"in n&&(this.containerBackground=(s=n.container_background)!=null?s:"transparent"),"card_background"in n&&(this.cardBackground=(p=n.card_background)!=null?p:"var(--ha-card-background, var(--card-background-color))"),"debug"in n&&(this.debug=!!n.debug),"disable_overlap"in n&&(this.disableOverlap=!!n.disable_overlap),"container_size_mode"in n&&(this.containerSizeMode=n.container_size_mode||"dynamic"),"container_fixed_width"in n&&(this.containerFixedWidth=Number(n.container_fixed_width)||null),"container_fixed_height"in n&&(this.containerFixedHeight=Number(n.container_fixed_height)||null),"container_preset"in n&&(this.containerPreset=n.container_preset||"fhd"),"container_preset_orientation"in n&&(this.containerPresetOrient=n.container_preset_orientation||"auto"),"auto_resize_cards"in n&&(this.autoResizeCards=!!n.auto_resize_cards,this.autoResizeCards?(c=this._startScaleWatch)==null||c.call(this):(h=this._stopScaleWatch)==null||h.call(this),(m=this._applyAutoScale)==null||m.call(this)),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),a&&(this._applyContainerSizingFromConfig(!0),(x=this._applyAutoScale)==null||x.call(this),this._resizeContainer(),(y=this._updateStoreBadge)==null||y.call(this),(w=this._applyAutoScale)==null||w.call(this))}_exportDesign(){let a=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(m=>{let x=parseFloat(m.getAttribute("data-x"))||0,y=parseFloat(m.getAttribute("data-y"))||0,w=parseFloat(m.style.width)||m.getBoundingClientRect().width,k=parseFloat(m.style.height)||m.getBoundingClientRect().height,O=parseInt(m.style.zIndex||"1",10),z=this._extractCardConfig(m.firstElementChild),A=m.dataset.tabId||this.defaultTab;return{card:z,position:{x,y},size:{width:w,height:k},z:O,tabId:A}}),s={version:2,options:this._exportableOptions(),cards:a};this._config&&this._config.card_mod&&(s.options=s.options||{},s.options.card_mod=this._config.card_mod);let p=`DragAndDrop_Design_${this.storageKey||"layout"}.json`,c=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(c),h.download=p,h.click(),URL.revokeObjectURL(h.href),this._toast("Design exported.")}_importDesign(){let n=document.createElement("input");n.type="file",n.accept="application/json";let a=!0,s=!1,p=["grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","card_mod","storage_key"];n.onchange=async()=>{var m,x,y,w,k,O,z,A,M,D,C,P,T,v,L,R,V,B,Y,re,G,te,se,pe,Ae,ve,be,xe,le,Le,Oe,Ke,$e,Fe,Pe,X,Ye,je,H,fe,ae,ye,De,at,tt,pt,Re,st;let c=(m=n.files)==null?void 0:m[0];if(!c)return;let h=await c.text();try{let _e=JSON.parse(h),Dt=this.storageKey||((x=this._config)==null?void 0:x.storage_key)||null,rt=!!(_e.options&&Array.isArray(_e.options.tabs)),ht=Array.isArray(_e.cards)&&_e.cards.some($=>($==null?void 0:$.tabId)||($==null?void 0:$.tab_id)),We=[];rt?We=_e.options.tabs:ht?We=Array.from(new Set(_e.cards.map(oe=>(oe==null?void 0:oe.tabId)||(oe==null?void 0:oe.tab_id)).filter(Boolean))).map(oe=>({id:oe,label:oe})):We=[{id:"default",label:"Layout"}];let Xt=((y=_e.options)==null?void 0:y.tabs_position)==="left"?"left":this.tabsPosition||"top",q=((w=_e.options)==null?void 0:w.default_tab)||((k=We[0])==null?void 0:k.id)||"default",K=((O=_e.options)==null?void 0:O.hide_tabs_when_single)!==void 0?!!_e.options.hide_tabs_when_single:!0;if(_e.options){let $={..._e.options};if(s||delete $.storage_key,a){let oe=this._config||{type:"custom:drag-and-drop-card"};for(let Q of p)Q==="storage_key"&&!s||!(Q in $)&&Q in oe&&delete oe[Q];try{this.cardContainer&&(this.cardContainer.style.background="",this.cardContainer.style.width="",this.cardContainer.style.height=""),(A=(z=this.style)==null?void 0:z.removeProperty)==null||A.call(z,"--ddc-container-bg"),(D=(M=this.style)==null?void 0:M.removeProperty)==null||D.call(M,"--ddc-card-bg")}catch{}if(this._config={...oe,...$},"card_mod"in $||delete this._config.card_mod,s&&$.storage_key&&(this.storageKey=$.storage_key),this._opts){this._opts={...this._opts,...$};for(let Q of p)Q in $||delete this._opts[Q]}(C=this._applyOptionsToDom)==null||C.call(this,this._config),(P=this.requestUpdate)==null||P.call(this)}else this._applyImportedOptions($,!0),$.card_mod!==void 0&&(this._config=this._config||{},this._config.card_mod=$.card_mod,(T=this.requestUpdate)==null||T.call(this))}else if(typeof _e.grid=="number"){let $={grid:_e.grid};a?this._config={...this._config||{},...$}:this._applyImportedOptions($,!0),(v=this.requestUpdate)==null||v.call(this)}(!Array.isArray(this.tabs)||!this.tabs.length)&&(this.tabs=We),this.tabsPosition||(this.tabsPosition=Xt),this.defaultTab||(this.defaultTab=q),this.hideTabsWhenSingle===void 0&&(this.hideTabsWhenSingle=K),(V=(R=(L=this.rootEl)==null?void 0:L.classList)==null?void 0:R.toggle)==null||V.call(R,"ddc-tabs-left-layout",this.tabsPosition==="left");try{let $=((B=this._config)==null?void 0:B.storage_key)||this.storageKey||null,oe=(Y=_e.options)!=null?Y:typeof _e.grid=="number"?{grid:_e.grid}:{},Q={...oe,tabs:(G=(re=oe.tabs)!=null?re:this.tabs)!=null?G:[],tabs_position:(se=(te=oe.tabs_position)!=null?te:this.tabsPosition)!=null?se:"top",default_tab:(le=(pe=oe.default_tab)!=null?pe:this.defaultTab)!=null?le:((ve=(Ae=oe.tabs)==null?void 0:Ae[0])==null?void 0:ve.id)||((xe=(be=this.tabs)==null?void 0:be[0])==null?void 0:xe.id)||"default",hide_tabs_when_single:(Oe=oe.hide_tabs_when_single)!=null?Oe:(Le=this.hideTabsWhenSingle)!=null?Le:!0};if(s||delete Q.storage_key,!$)console.warn("[ddc:import] No storage_key on this card; aborting YAML persist.");else{let me=await((Ke=this._persistOptionsToYaml)==null?void 0:Ke.call(this,Q,{forceTargetKey:String($),noDownload:!0,replace:!0,wipeUnknownKeys:!0})),Te=!!(me&&me.yamlSaved);($e=console.debug)==null||$e.call(console,"[ddc:import] YAML persist result:",Te)}try{let me={type:"custom:drag-and-drop-card",...this._config||{}};me.tabs=Q.tabs,me.tabs_position=Q.tabs_position,me.default_tab=Q.default_tab,me.hide_tabs_when_single=!!Q.hide_tabs_when_single,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:me},bubbles:!0,composed:!0}))}catch{}}catch($){console.warn("[ddc:import] YAML persist failed:",$)}if(this.cardContainer.innerHTML="",Array.isArray(_e.cards)&&_e.cards.length)for(let $ of _e.cards){let oe=((Fe=$.position)==null?void 0:Fe.x)||0,Q=((Pe=$.position)==null?void 0:Pe.y)||0,me=((X=$.size)==null?void 0:X.width)||140,Te=((Ye=$.size)==null?void 0:Ye.height)||100,J=$.z,we=this._normalizeTabId($.tabId||$.tab_id||this.defaultTab);if(!($!=null&&$.card)||typeof $.card=="object"&&!Object.keys($.card).length){let ke=this._makePlaceholderAt(oe,Q,me,Te);ke.dataset.tabId=we,this.cardContainer.appendChild(ke);continue}let Me=await this._createCard($.card),Se=this._makeWrapper(Me);Se.dataset.tabId=we,this._setCardPosition(Se,oe,Q),Se.style.width=`${me}px`,Se.style.height=`${Te}px`,J!=null&&(Se.style.zIndex=String(J)),this.cardContainer.appendChild(Se);try{this._rebuildOnce(Se.firstElementChild)}catch{}this._initCardInteract(Se)}else this._showEmptyPlaceholder(),(je=this._applyAutoScale)==null||je.call(this);(H=this._applyOptionsToDom)==null||H.call(this,this._config),this._resizeContainer();try{(ye=(ae=(fe=this.rootEl)==null?void 0:fe.classList)==null?void 0:ae.toggle)==null||ye.call(ae,"ddc-tabs-left-layout",this.tabsPosition==="left"),(De=this._renderTabs)==null||De.call(this),(at=this._applyActiveTab)==null||at.call(this)}catch{}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0),(tt=this._toast)==null||tt.call(this,"Design imported & saved. Reloading..."),window.location.reload()}catch($){console.warn("[ddc:import] saveLayout failed",$),(pt=this._markDirty)==null||pt.call(this,"import"),(Re=this._toast)==null||Re.call(this,"Design imported \u2014 click Apply to save.")}}catch(_e){console.error("Import failed",_e),(st=this._toast)==null||st.call(this,"Import failed \u2014 invalid file.")}},n.click()}_getLovelace(){var c,h;let n=0,a=this;for(;a&&n++<20;){let m=(c=a.getRootNode)==null?void 0:c.call(a),x=m==null?void 0:m.host;if((x==null?void 0:x.tagName)==="HUI-ROOT")return x.lovelace;a=x||a.parentElement}let s=new Set,p=[document];for(;p.length;){let m=p.shift();if(!(!m||s.has(m))){if(s.add(m),((h=m.host)==null?void 0:h.tagName)==="HUI-ROOT")return m.host.lovelace;if(m.tagName==="HUI-ROOT")return m.lovelace;if(m.shadowRoot&&p.push(m.shadowRoot),m.children)for(let x of m.children)p.push(x)}}}_scanDdcCards(n){let a=[],s=(c,h,m)=>{(m==null?void 0:m.type)==="custom:drag-and-drop-card"&&a.push({view:c,path:[...h],card:m})},p=(c,h,m)=>{if(c){if(Array.isArray(c)){c.forEach((x,y)=>p(x,h,m.concat(y)));return}if(typeof c=="object"){"type"in c&&s(h,m,c);for(let[x,y]of Object.entries(c))x==="views"&&Array.isArray(y)?y.forEach((w,k)=>p(w,k,["views",k])):(Array.isArray(y)||y&&typeof y=="object")&&p(y,h,m.concat(x))}}};return p(n,-1,[]),a}async _persistOptionsToYaml(n,{prevKey:a=null,patchAllInCurrentViewIfNoKey:s=!1}={}){var p,c,h,m,x,y,w,k,O;try{let z=this._getLovelace();if(!z)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof z.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let A=JSON.parse(JSON.stringify(z.config)),M=this._scanDdcCards(A),D=(p=z.current_view)!=null?p:0;console.debug("[ddc:import] persist: found DDC cards",M.map(L=>({view:L.view,path:L.path.join("."),storage_key:L.card.storage_key||null})));let C=(c=n==null?void 0:n.storage_key)!=null?c:null,P=[];a&&P.push(a),C&&P.push(C),this.storageKey&&P.push(this.storageKey),(h=this._config)!=null&&h.storage_key&&P.push(this._config.storage_key);let T=M.filter(L=>L.card.storage_key&&P.includes(L.card.storage_key));if(!T.length){let L=M.filter(R=>R.view===D);L.length===1&&(T=L)}if(!T.length&&M.length===1&&(T=M),!T.length)return console.debug("[ddc:import] persist: no target. Provide a unique storage_key on this card and import again.",{prevKey:a,newKey:C,storageKey:this.storageKey}),!1;let v={type:"custom:drag-and-drop-card",...n};"storage_key"in v&&delete v.storage_key,"storageKey"in v&&delete v.storageKey;for(let L of T){let R=A;for(let Y of L.path)R=R[Y];let V=(O=(k=(y=(m=R==null?void 0:R.storage_key)!=null?m:R==null?void 0:R.storageKey)!=null?y:(x=R==null?void 0:R.options)==null?void 0:x.storage_key)!=null?k:(w=R==null?void 0:R.options)==null?void 0:w.storageKey)!=null?O:null,B=!!(a&&C&&V===a&&C!==a);Object.assign(R,v),B?R.storage_key=String(C):V&&(R.storage_key=String(V)),"storageKey"in R&&delete R.storageKey}return console.debug("[ddc:import] persist \u2192 saving",{patched:T.length,keysTried:P,patch}),await z.saveConfig(A),!0}catch(z){return console.warn("[ddc:import] persist error",z),!1}}_queueSave(n="auto"){this._markDirty(n),this.autoSave&&(this._loading||this.editMode&&(this._dbgPush("autosave","Queued",{reason:n,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce)))}async _saveLayout(n=!0){let s=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(c=>{let h=parseFloat(c.getAttribute("data-x"))||0,m=parseFloat(c.getAttribute("data-y"))||0,x=parseFloat(c.style.width)||c.getBoundingClientRect().width,y=parseFloat(c.style.height)||c.getBoundingClientRect().height,w=parseInt(c.style.zIndex||"1",10),k=this._extractCardConfig(c.firstElementChild),O=c.dataset.tabId||this.defaultTab;return{card:k,position:{x:h,y:m},size:{width:x,height:y},z:w,tabId:O}}),p={version:2,options:this._exportableOptions(),cards:s};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(p))}catch{}if(!this.storageKey){n||this._toast("Saved locally (no storage_key set)."),this.__dirty=!1,this._updateApplyBtn();return}try{await this._saveLayoutToBackend(this.storageKey,p),n||this._toast("Layout saved."),this.__dirty=!1,this._updateApplyBtn()}catch(c){console.error("Backend save failed",c),this._dbgPush("save","Backend save failed",{error:String(c)}),n||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let n=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let a=await this.hass.callApi("get","dragdrop_storage"),s=Math.round(performance.now()-n);this._dbgPush("probe",`OK (${s} ms)`,a),this._backendOK=!!a}catch(a){let s=Math.round(performance.now()-n);this._dbgPush("probe",`FAILED (${s} ms)`,{error:String(a)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(n){let a=`dragdrop_storage/${encodeURIComponent(n)}`,s=performance.now();try{this._dbgPush("load",`GET /api/${a}`);let p=await this.hass.callApi("get",a),c=Math.round(performance.now()-s);return this._dbgPush("load",`OK (${c} ms)`,{bytes:JSON.stringify(p||"").length}),p}catch(p){let c=Math.round(performance.now()-s);return this._dbgPush("load",`FAILED (${c} ms)`,{error:String(p)}),null}}async _saveLayoutToBackend(n,a){let s=`dragdrop_storage/${encodeURIComponent(n)}`,p=JSON.stringify(a).length,c=performance.now();try{this._dbgPush("save",`POST /api/${s}`,{bytes:p});let h=await this.hass.callApi("post",s,a),m=Math.round(performance.now()-c);return this._dbgPush("save",`OK (${m} ms)`,h),h}catch(h){let m=Math.round(performance.now()-c);throw this._dbgPush("save",`FAILED (${m} ms)`,{error:String(h),bytes:p}),h}}_updateStoreBadge(){let n=this.storeBadge;if(!n)return;let a=this._backendOK&&!!this.storageKey;n.textContent=a?"storage: backend - OK":"storage: local. Your Changes are NOT being SAVED. You need to download the Drag and Drop Card backend integration",n.style.background=a?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",n.style.borderColor=a?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(n){let a=new Event("hass-notification");a.detail={message:n},window.dispatchEvent(a)}_huiRoot(){var n,a,s,p,c,h;try{let m=document.querySelector("home-assistant"),x=(n=m==null?void 0:m.shadowRoot)==null?void 0:n.querySelector("home-assistant-main"),y=((a=x==null?void 0:x.shadowRoot)==null?void 0:a.querySelector("ha-drawer"))||x,w=((s=y==null?void 0:y.shadowRoot)==null?void 0:s.querySelector("partial-panel-resolver"))||y,k=((p=w==null?void 0:w.shadowRoot)==null?void 0:p.querySelector("ha-panel-lovelace"))||((c=y==null?void 0:y.shadowRoot)==null?void 0:c.querySelector("ha-panel-lovelace"));return((h=k==null?void 0:k.shadowRoot)==null?void 0:h.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",Hi);(()=>{try{let e=window.customCards=window.customCards||[];e.some(d=>d.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!1})}catch{}})();(()=>{let e=new WeakSet,d=c=>{try{if(!(c instanceof Element))return!1;let h=c.localName||"";return h?!!(h==="ha-card"||h.endsWith("-card")):!1}catch{return!1}},n=c=>{try{if(!c||e.has(c))return;e.add(c),c.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}},a=c=>{var h,m;try{if(!c)return;c instanceof Element&&d(c)&&n(c);let x=(m=(h=(c instanceof ShadowRoot,c)).querySelectorAll)==null?void 0:m.call(h,"*");if(!x)return;for(let y of x){d(y)&&n(y);let w=y.shadowRoot;if(w)try{a(w)}catch{}}}catch{}},s=c=>{try{if(!c||c.__ddcCardModIntegrated)return;c.__ddcCardModIntegrated=!0;let h=c.shadowRoot||c;a(h);let m=new MutationObserver(x=>{for(let y of x)if(!(!y.addedNodes||!y.addedNodes.length))for(let w of y.addedNodes)(w instanceof Element||w instanceof ShadowRoot)&&a(w)});m.observe(h,{childList:!0,subtree:!0}),c.__ddcCardModIntegratedObserver=m,setTimeout(()=>{try{a(h)}catch{}},250),setTimeout(()=>{try{a(h)}catch{}},1e3)}catch{}},p=()=>{try{document.querySelectorAll("drag-and-drop-card").forEach(s)}catch{}};if(window.customElements&&window.customElements.whenDefined)window.customElements.whenDefined("drag-and-drop-card").then(()=>{p();let c=window.customElements.get("drag-and-drop-card");if(c&&c.prototype){let m=c.prototype.connectedCallback;c.prototype.connectedCallback=function(){try{m&&m.call(this)}finally{s(this)}}}new MutationObserver(()=>p()).observe(document.documentElement,{childList:!0,subtree:!0})});else{let c=setInterval(p,1e3);setTimeout(()=>clearInterval(c),1e4)}})();(function(){let e="drag-and-drop-card",d=customElements.get(e);if(!d){console.warn("[ddc:augment] Could not find custom element",e);return}function n(){var A,M;try{let D=0,C=this;for(;C&&D++<20;){let v=(A=C.getRootNode)==null?void 0:A.call(C),L=v==null?void 0:v.host;if((L==null?void 0:L.tagName)==="HUI-ROOT")return L.lovelace;C=L||C.parentElement}let P=new Set,T=[document];for(;T.length;){let v=T.shift();if(!(!v||P.has(v))){if(P.add(v),((M=v.host)==null?void 0:M.tagName)==="HUI-ROOT")return v.host.lovelace;if(v.tagName==="HUI-ROOT")return v.lovelace;if(v.shadowRoot&&T.push(v.shadowRoot),v.children)for(let L of v.children)T.push(L)}}}catch{}}function a(A){let M=[],D=(P,T,v)=>{(v==null?void 0:v.type)==="custom:drag-and-drop-card"&&M.push({view:P,path:[...T],card:v})},C=(P,T,v)=>{if(P){if(Array.isArray(P)){P.forEach((L,R)=>C(L,T,v.concat(R)));return}if(typeof P=="object"){"type"in P&&D(T,v,P);for(let[L,R]of Object.entries(P))L==="views"&&Array.isArray(R)?R.forEach((V,B)=>C(V,B,["views",B])):(Array.isArray(R)||R&&typeof R=="object")&&C(R,T,v.concat(L))}}};return C(A,-1,[]),M}function s(A,M,D){let C=new Date().toISOString().replace(/[:.]/g,"-"),P=M.map(v=>{let L=A;for(let R of v.path)L=L[R];return{view:v.view,path:v.path,storage_key:L&&L.storage_key||null,before:L,patch:D}}),T={kind:"ddc-import-backup",created_at:C,count:P.length,items:P};try{let v=`ddc.backup.${C}`;localStorage.setItem(v,JSON.stringify(T));let L=Object.keys(localStorage).filter(R=>R.startsWith("ddc.backup.")).sort().reverse();for(let R of L.slice(10))localStorage.removeItem(R)}catch{}return{name:`ddc_backup_${C}.json`,data:T}}function p(A,M){try{let D=new Blob([JSON.stringify(M,null,2)],{type:"application/json"}),C=URL.createObjectURL(D),P=document.createElement("a");P.href=C,P.download=A,document.body.appendChild(P),P.click(),P.remove(),setTimeout(()=>URL.revokeObjectURL(C),1500)}catch(D){console.warn("[ddc:backup] download failed",D)}}function c(A){if(A)try{let M="ddc.recent.keys",D=JSON.parse(localStorage.getItem(M)||"[]");D.includes(A)||D.unshift(A),localStorage.setItem(M,JSON.stringify(D.slice(0,20)))}catch{}}function h(){try{return JSON.parse(localStorage.getItem("ddc.recent.keys")||"[]")}catch{return[]}}function m(){var M,D;let A=new Set;try{let C=Object.keys(localStorage).filter(P=>P.startsWith("ddc.backup.")).sort().reverse();for(let P of C)try{let T=JSON.parse(localStorage.getItem(P)||"null");if(T&&T.items)for(let v of T.items){let L=((M=v==null?void 0:v.before)==null?void 0:M.storage_key)||((D=v==null?void 0:v.patch)==null?void 0:D.storage_key);L&&A.add(L)}}catch{}}catch{}return Array.from(A)}async function x(A,{forceTargetKey:M=null,onlyThisCard:D=!1,prevKey:C,noDownload:P}={}){var pe,Ae,ve,be,xe;let T=((pe=this._getLovelace)==null?void 0:pe.call(this))||n.call(this);if(!T)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof T.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let v=le=>typeof le=="string"?le.trim():null,L=v(M)||v((Ae=this==null?void 0:this._config)==null?void 0:Ae.storage_key)||v(this==null?void 0:this.storageKey)||v(C);if(!L)return console.warn("[ddc:import] persist: missing target storage_key on this card; aborting"),!1;let R=JSON.parse(JSON.stringify(T.config)),V=(this._scanDdcCards||a)(R);console.debug("[ddc:import] persist: found DDC cards",V.map(le=>({view:le.view,path:le.path.join("."),storage_key:le.card&&(le.card.storage_key||le.card.storageKey)||null})));let B=V.filter(le=>{var Oe,Ke,$e,Fe,Pe,X,Ye,je,H;return((H=(X=($e=v((Oe=le.card)==null?void 0:Oe.storage_key))!=null?$e:v((Ke=le.card)==null?void 0:Ke.storageKey))!=null?X:v((Pe=(Fe=le.card)==null?void 0:Fe.options)==null?void 0:Pe.storage_key))!=null?H:v((je=(Ye=le.card)==null?void 0:Ye.options)==null?void 0:je.storageKey))===L});if(B.length!==1)return console.warn("[ddc:import] persist: expected exactly one target with key, got",B.length,{myKey:L}),!1;let Y={type:"custom:drag-and-drop-card",...A||{}};"storage_key"in Y&&delete Y.storage_key,"storageKey"in Y&&delete Y.storageKey,Y!=null&&Y.options&&("storage_key"in Y.options&&delete Y.options.storage_key,"storageKey"in Y.options&&delete Y.options.storageKey);let re=Array.isArray(Y.cards)?Y.cards:null;delete Y.cards;try{let le=s==null?void 0:s(T.config,B,Y);le&&(console.debug("[ddc:import] backup created",{file:le.name,items:(ve=le.data)==null?void 0:ve.count}),!P&&typeof p=="function"&&p(le.name,le.data))}catch(le){console.debug("[ddc:import] backup skipped/error:",(le==null?void 0:le.message)||le)}let G=B[0],te=R;for(let le of G.path)te=te[le];let se=(xe=(be=v(te==null?void 0:te.storage_key))!=null?be:v(te==null?void 0:te.storageKey))!=null?xe:null;return Object.assign(te,Y),se?te.storage_key=se:te.storage_key=L,"storageKey"in te&&delete te.storageKey,console.debug("[ddc:import] persist \u2192 saving",{patched:1,into_key:te.storage_key,ignored_file_key:v(A==null?void 0:A.storage_key)||v(A==null?void 0:A.storageKey)||null}),await T.saveConfig(R),{yamlSaved:!0,cardsForStorage:re}}async function y(){var D;let A=C=>{if(!C)return[];if(Array.isArray(C))return C;if(Array.isArray(C==null?void 0:C.keys))return C.keys;if(Array.isArray(C==null?void 0:C.dashboards))return C.dashboards;if(Array.isArray(C==null?void 0:C.entries))return C.entries.map(P=>P.key||P.id||P.name).filter(Boolean);if(Array.isArray(C==null?void 0:C.items))return C.items.map(P=>P.key||P.id||P.name).filter(Boolean);if(typeof C=="object"){for(let P of Object.values(C))if(Array.isArray(P)&&P.every(T=>typeof T=="string"))return P}return[]};try{if((D=this==null?void 0:this.hass)!=null&&D.callApi){let C=await this.hass.callApi("get","dragdrop_storage"),P=A(C);if(P.length)return P}}catch(C){console.debug("[ddc:switcher] hass.callApi dragdrop_storage failed",C)}let M=["/api/dragdrop_storage","/api/dragdrop_storage/keys","/api/dragdrop_storage/list","/api/dragdrop_storage?all=1"];for(let C of M)try{let T=await(await fetch(C,{cache:"no-store"})).json(),v=A(T);if(v.length)return v}catch{}return[]}async function w(A){let M=T=>{if(!T)return null;if(T.options||T.cards)return T;if(typeof T.design=="object")return T.design;if(typeof T.payload=="object")return T.payload;try{if(typeof T=="string")return JSON.parse(T)}catch{}return null},D=async(T,v,L)=>{var R;try{if((R=this==null?void 0:this.hass)!=null&&R.callApi){let V=await this.hass.callApi(T,v,L),B=M(V);if(B)return B}}catch{}return null},C=async T=>{try{let v=await fetch(T,{cache:"no-store"}),L=v.headers.get("content-type")||"";if(L.includes("application/json")||L.includes("text/plain")){let R=await v.json().catch(()=>null)||await v.text().catch(()=>null),V=M(R);if(V)return V}}catch{}return null},P=encodeURIComponent(A);return await(D("get",`dragdrop_storage/${P}`)||C(`/api/dragdrop_storage/${P}`)||C(`/api/dragdrop_storage?key=${P}`)||D("post","dragdrop_storage/get",{key:A})||null)}async function k(A,{source:M="switcher",newKey:D=null}={}){var T,v,L,R,V,B,Y,re,G,te,se,pe,Ae,ve,be,xe,le,Le,Oe,Ke,$e,Fe,Pe,X,Ye,je;if(!A||typeof A!="object")throw new Error("Invalid design payload");let C=this.storageKey||((T=this._config)==null?void 0:T.storage_key)||null;try{(v=this._dbgInit)==null||v.call(this),(L=this._dbgPush)==null||L.call(this,"import","Begin import (programmatic)",{source:M,newKey:D})}catch{}if(A.options){let{storage_key:H,...fe}=A.options;(R=this._applyImportedOptions)==null||R.call(this,fe,!0)}else typeof A.grid=="number"&&((V=this._applyImportedOptions)==null||V.call(this,{grid:A.grid},!0));let P=D||((B=A==null?void 0:A.options)==null?void 0:B.storage_key)||C;if(P){this.storageKey=P,this._config={...this._config||{},storage_key:P};try{(Y=this._syncEditorsStorageKey)==null||Y.call(this)}catch{}}try{let H=(re=A.options)!=null?re:typeof A.grid=="number"?{grid:A.grid}:{};await((G=this._persistOptionsToYaml)==null?void 0:G.call(this,{...H,storage_key:P},{prevKey:C,noDownload:M==="switcher"}))}catch(H){console.warn("[ddc:apply] persist failed",H)}try{if(this.cardContainer.innerHTML="",Array.isArray(A.cards)&&A.cards.length)for(let H of A.cards)if(!(H!=null&&H.card)||typeof H.card=="object"&&Object.keys(H.card).length===0){let fe=(ve=this._makePlaceholderAt)==null?void 0:ve.call(this,((te=H.position)==null?void 0:te.x)||0,((se=H.position)==null?void 0:se.y)||0,((pe=H.size)==null?void 0:pe.width)||200,((Ae=H.size)==null?void 0:Ae.height)||200);fe&&this.cardContainer.appendChild(fe)}else{let fe=await this._createCard(H.card),ae=this._makeWrapper(fe);(le=this._setCardPosition)==null||le.call(this,ae,((be=H.position)==null?void 0:be.x)||0,((xe=H.position)==null?void 0:xe.y)||0),ae.style.width=`${((Le=H.size)==null?void 0:Le.width)||140}px`,ae.style.height=`${((Oe=H.size)==null?void 0:Oe.height)||100}px`,H.z!=null&&(ae.style.zIndex=String(H.z)),this.cardContainer.appendChild(ae);try{(Ke=this._rebuildOnce)==null||Ke.call(this,ae.firstElementChild)}catch{}($e=this._initCardInteract)==null||$e.call(this,ae)}else(Fe=this._showEmptyPlaceholder)==null||Fe.call(this);(Pe=this._resizeContainer)==null||Pe.call(this),(X=this._markDirty)==null||X.call(this,"import"),(Ye=this._toast)==null||Ye.call(this,M==="switcher"?`Loaded layout "${P}"`:"Design imported")}catch(H){console.error("[ddc:apply] rebuild failed",H),(je=this._toast)==null||je.call(this,"Import failed during rebuild.")}}function O(){var A,M;try{let D=this.shadowRoot||this.renderRoot||this,C=D.querySelector(".ddc-switcher-inline");if(!C)return;let P=((A=this._getLovelace)==null?void 0:A.call(this))||n.call(this),T=!1;try{let v=(M=D.getRootNode&&D.getRootNode())==null?void 0:M.host;T=!!(P&&(P.editMode===!0||v&&v.editMode===!0))}catch{}C.style.display=T?"inline-flex":"none"}catch{}}function z(){try{if(this._ddcSwitcherInstalled)return;let M=(this.shadowRoot||this.renderRoot||this).querySelector(".toolbar");if(!M)return;let D=document.createElement("div");D.className="ddc-switcher-inline",Object.assign(D.style,{display:"inline-flex",gap:"6px",alignItems:"center",marginLeft:"auto"});let C=document.createElement("span");C.textContent="Layout:",C.style.fontSize="12px",C.style.opacity="0.8";let P=document.createElement("select");Object.assign(P.style,{fontSize:"12px",padding:"4px 6px",borderRadius:"8px",border:"1px solid var(--divider-color, #999)",background:"var(--card-background-color, #fff)"}),P.title="Select stored layout (storage_key)",P.id="ddcKeySelect";let T=document.createElement("button");T.className="btn secondary",T.type="button",T.style.padding="6px 10px",T.innerHTML='<ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh</span>',D.appendChild(C),D.appendChild(P),D.appendChild(T),M.appendChild(D),this._ddcSwitcherInstalled=!0;let v=async()=>{let L=this.storageKey||this._config&&this._config.storage_key||"",R=await y.call(this),V=m(),B=h(),Y=pe=>Array.from(new Set(pe.filter(Boolean))),re=Y(R),G=Y(V),te=Y(B);if(P.innerHTML="",L&&!re.includes(L)&&!G.includes(L)&&!te.includes(L)){let pe=document.createElement("option");pe.value=L,pe.textContent=`${L} (current)`,pe.selected=!0,P.appendChild(pe)}let se=(pe,Ae)=>{if(!Ae.length)return;let ve=document.createElement("optgroup");ve.label=pe,Ae.forEach(be=>{let xe=document.createElement("option");xe.value=be,xe.textContent=be,be===L&&(xe.selected=!0),ve.appendChild(xe)}),P.appendChild(ve)};if(se("Server",re),se("Backups",G),se("Recent",te),!P.children.length){let pe=document.createElement("option");pe.value="",pe.textContent="\u2014 none \u2014",pe.selected=!0,P.appendChild(pe)}O.call(this)};v(),T.addEventListener("click",v),P.addEventListener("change",async L=>{var V,B,Y,re,G,te,se,pe;let R=String(L.target.value||"");if(R&&!this._ddcLoadingFromKey){this._ddcLoadingFromKey=!0;try{let Ae=await w.call(this,R);if(!Ae){(V=this._toast)==null||V.call(this,`No layout found for "${R}"`);return}await k.call(this,Ae,{source:"switcher",newKey:R}),(B=this._resizeContainer)==null||B.call(this),(Y=this._toast)==null||Y.call(this,`Loaded layout "${R}"`);let ve=String(((re=this._config)==null?void 0:re.storage_key)||this.storageKey||""),be=!1;try{let xe=ve?{forceTargetKey:ve,noDownload:!0}:{noDownload:!0};be=await this._persistOptionsToYaml({storage_key:R},xe)}catch(xe){console.warn("[ddc:switcher] failed to persist storage_key to YAML",xe),(G=this._toast)==null||G.call(this,"Failed to persist selected layout. Keeping current.");return}if(this.storageKey=R,this._config&&(this._config.storage_key=R),!be){console.warn("[ddc:switcher] persist returned false (likely YAML mode). Skipping reload.");return}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(xe){console.warn("[ddc:switcher] saveLayout failed",xe),(te=this._markDirty)==null||te.call(this,"switcher"),(se=this._toast)==null||se.call(this,"Layout loaded \u2014 click Apply to save.");return}window.location.reload(),window.location.reload()}catch(Ae){console.warn("[ddc:switcher] load/apply failed",Ae),(pe=this._toast)==null||pe.call(this,"Failed to load layout.")}finally{this._ddcLoadingFromKey=!1}}}),this._ddcVisTimer&&clearInterval(this._ddcVisTimer),this._ddcVisTimer=setInterval(()=>O.call(this),800),O.call(this)}catch(A){console.warn("[ddc:switcher] inline install failed",A)}}d.prototype._getLovelace||(d.prototype._getLovelace=n),d.prototype._scanDdcCards||(d.prototype._scanDdcCards=a),d.prototype._persistOptionsToYaml=x,d.prototype._applyDesignObject||(d.prototype._applyDesignObject=k);try{let A=Object.getOwnPropertyDescriptor(d.prototype,"hass");if(A&&(A.set||A.get)){let M=A.set;Object.defineProperty(d.prototype,"hass",{configurable:!0,enumerable:!0,set(D){M&&M.call(this,D);try{z.call(this)}catch{}},get:A.get||function(){return this._hass}})}else if(typeof d.prototype.setHass=="function"){let M=d.prototype.setHass;d.prototype.setHass=function(D){M&&M.call(this,D);try{z.call(this)}catch{}}}else{let M=d.prototype.updated||d.prototype.firstUpdated;d.prototype.updated=function(...D){M&&M.apply(this,D);try{z.call(this)}catch{}}}}catch(A){console.warn("[ddc:switcher] wrap hass setter failed",A)}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
