var Po=Object.create;var Mi=Object.defineProperty;var Lo=Object.getOwnPropertyDescriptor;var Io=Object.getOwnPropertyNames;var Do=Object.getPrototypeOf,Ro=Object.prototype.hasOwnProperty;var Fo=(e,p,n)=>p in e?Mi(e,p,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[p]=n;var Bo=(e,p)=>()=>(p||e((p={exports:{}}).exports,p),p.exports);var No=(e,p,n,o)=>{if(p&&typeof p=="object"||typeof p=="function")for(let s of Io(p))!Ro.call(e,s)&&s!==n&&Mi(e,s,{get:()=>p[s],enumerable:!(o=Lo(p,s))||o.enumerable});return e};var qo=(e,p,n)=>(n=e!=null?Po(Do(e)):{},No(p||!e||!e.__esModule?Mi(n,"default",{value:e,enumerable:!0}):n,e));var kn=(e,p,n)=>Fo(e,typeof p!="symbol"?p+"":p,n);var Sn=Bo((Pi,Bt)=>{(function(e,p){typeof Pi=="object"&&typeof Bt!="undefined"?Bt.exports=p():typeof define=="function"&&define.amd?define(p):(e=typeof globalThis!="undefined"?globalThis:e||self).interact=p()})(Pi,(function(){"use strict";function e(i,t){var r=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);t&&(a=a.filter((function(d){return Object.getOwnPropertyDescriptor(i,d).enumerable}))),r.push.apply(r,a)}return r}function p(i){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e(Object(r),!0).forEach((function(a){l(i,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(r,a))}))}return i}function n(i){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(i)}function o(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function s(i,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,C(a.key),a)}}function c(i,t,r){return t&&s(i.prototype,t),r&&s(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function l(i,t,r){return(t=C(t))in i?Object.defineProperty(i,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[t]=r,i}function u(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&x(i,t)}function f(i){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(i)}function x(i,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},x(i,t)}function m(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function y(i){var t=(function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var r,a=f(i);if(t){var d=f(this).constructor;r=Reflect.construct(a,arguments,d)}else r=a.apply(this,arguments);return(function(h,g){if(g&&(typeof g=="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m(h)})(this,r)}}function _(){return _=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(i,t,r){var a=(function(h,g){for(;!Object.prototype.hasOwnProperty.call(h,g)&&(h=f(h))!==null;);return h})(i,t);if(a){var d=Object.getOwnPropertyDescriptor(a,t);return d.get?d.get.call(arguments.length<3?i:r):d.value}},_.apply(this,arguments)}function C(i){var t=(function(r,a){if(typeof r!="object"||r===null)return r;var d=r[Symbol.toPrimitive];if(d!==void 0){var h=d.call(r,a||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)})(i,"string");return typeof t=="symbol"?t:t+""}var P=function(i){return!(!i||!i.Window)&&i instanceof i.Window},E=void 0,z=void 0;function I(i){E=i;var t=i.document.createTextNode("");t.ownerDocument!==i.document&&typeof i.wrap=="function"&&i.wrap(t)===t&&(i=i.wrap(i)),z=i}function S(i){return P(i)?i:(i.ownerDocument||i).defaultView||z.window}typeof window!="undefined"&&window&&I(window);var O=function(i){return!!i&&n(i)==="object"},T=function(i){return typeof i=="function"},b={window:function(i){return i===z||P(i)},docFrag:function(i){return O(i)&&i.nodeType===11},object:O,func:T,number:function(i){return typeof i=="number"},bool:function(i){return typeof i=="boolean"},string:function(i){return typeof i=="string"},element:function(i){if(!i||n(i)!=="object")return!1;var t=S(i)||z;return/object|function/.test(typeof Element=="undefined"?"undefined":n(Element))?i instanceof Element||i instanceof t.Element:i.nodeType===1&&typeof i.nodeName=="string"},plainObject:function(i){return O(i)&&!!i.constructor&&/function Object\b/.test(i.constructor.toString())},array:function(i){return O(i)&&i.length!==void 0&&T(i.splice)}};function L(i){var t=i.interaction;if(t.prepared.name==="drag"){var r=t.prepared.axis;r==="x"?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):r==="y"&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function D(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="drag"){var a=r.prepared.axis;if(a==="x"||a==="y"){var d=a==="x"?"y":"x";t.page[d]=r.coords.start.page[d],t.client[d]=r.coords.start.client[d],t.delta[d]=0}}}var Q={id:"actions/drag",install:function(i){var t=i.actions,r=i.Interactable,a=i.defaults;r.prototype.draggable=Q.draggable,t.map.drag=Q,t.methodDict.drag="draggable",a.actions.drag=Q.defaults},listeners:{"interactions:before-action-move":L,"interactions:action-resume":L,"interactions:action-move":D,"auto-start:check":function(i){var t=i.interaction,r=i.interactable,a=i.buttons,d=r.options.drag;if(d&&d.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(a&r.options.drag.mouseButtons)!=0))return i.action={name:"drag",axis:d.lockAxis==="start"?d.startAxis:d.lockAxis},!1}},draggable:function(i){return b.object(i)?(this.options.drag.enabled=i.enabled!==!1,this.setPerAction("drag",i),this.setOnEvents("drag",i),/^(xy|x|y|start)$/.test(i.lockAxis)&&(this.options.drag.lockAxis=i.lockAxis),/^(xy|x|y)$/.test(i.startAxis)&&(this.options.drag.startAxis=i.startAxis),this):b.bool(i)?(this.options.drag.enabled=i,this):this.options.drag},beforeMove:L,move:D,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(i){return i.search("drag")===0}},B=Q,J={init:function(i){var t=i;J.document=t.document,J.DocumentFragment=t.DocumentFragment||K,J.SVGElement=t.SVGElement||K,J.SVGSVGElement=t.SVGSVGElement||K,J.SVGElementInstance=t.SVGElementInstance||K,J.Element=t.Element||K,J.HTMLElement=t.HTMLElement||J.Element,J.Event=t.Event,J.Touch=t.Touch||K,J.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function K(){}var X=J,W={init:function(i){var t=X.Element,r=i.navigator||{};W.supportsTouch="ontouchstart"in i||b.func(i.DocumentTouch)&&X.document instanceof i.DocumentTouch,W.supportsPointerEvent=r.pointerEnabled!==!1&&!!X.PointerEvent,W.isIOS=/iP(hone|od|ad)/.test(r.platform),W.isIOS7=/iP(hone|od|ad)/.test(r.platform)&&/OS 7[^\d]/.test(r.appVersion),W.isIe9=/MSIE 9/.test(r.userAgent),W.isOperaMobile=r.appName==="Opera"&&W.supportsTouch&&/Presto/.test(r.userAgent),W.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",W.pEventTypes=W.supportsPointerEvent?X.PointerEvent===i.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,W.wheelEvent=X.document&&"onmousewheel"in X.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},ue=W;function _e(i,t){if(i.contains)return i.contains(t);for(;t;){if(t===i)return!0;t=t.parentNode}return!1}function Ae(i,t){for(;b.element(i);){if(ge(i,t))return i;i=Me(i)}return null}function Me(i){var t=i.parentNode;if(b.docFrag(t)){for(;(t=t.host)&&b.docFrag(t););return t}return t}function ge(i,t){return z!==E&&(t=t.replace(/\/deep\//g," ")),i[ue.prefixedMatchesSelector](t)}var Oe=function(i){return i.parentNode||i.host};function pe(i,t){for(var r,a=[],d=i;(r=Oe(d))&&d!==t&&r!==d.ownerDocument;)a.unshift(d),d=r;return a}function De(i,t,r){for(;b.element(i);){if(ge(i,t))return!0;if((i=Me(i))===r)return ge(i,t)}return!1}function Ge(i){return i.correspondingUseElement||i}function $e(i){var t=i instanceof X.SVGElement?i.getBoundingClientRect():i.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function st(i){var t,r=$e(i);if(!ue.isIOS7&&r){var a={x:(t=(t=S(i))||z).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};r.left+=a.x,r.right+=a.x,r.top+=a.y,r.bottom+=a.y}return r}function lt(i){for(var t=[];i;)t.push(i),i=Me(i);return t}function tt(i){return!!b.string(i)&&(X.document.querySelector(i),!0)}function ie(i,t){for(var r in t)i[r]=t[r];return i}function dt(i,t,r){return i==="parent"?Me(r):i==="self"?t.getRect(r):Ae(r,i)}function Ze(i,t,r,a){var d=i;return b.string(d)?d=dt(d,t,r):b.func(d)&&(d=d.apply(void 0,a)),b.element(d)&&(d=st(d)),d}function Te(i){return i&&{x:"x"in i?i.x:i.left,y:"y"in i?i.y:i.top}}function Z(i){return!i||"x"in i&&"y"in i||((i=ie({},i)).x=i.left||0,i.y=i.top||0,i.width=i.width||(i.right||0)-i.x,i.height=i.height||(i.bottom||0)-i.y),i}function ze(i,t,r){i.left&&(t.left+=r.x),i.right&&(t.right+=r.x),i.top&&(t.top+=r.y),i.bottom&&(t.bottom+=r.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function ke(i,t,r){var a=r&&i.options[r];return Te(Ze(a&&a.origin||i.options.origin,i,t,[i&&t]))||{x:0,y:0}}function we(i,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(w){return!0},a=arguments.length>3?arguments[3]:void 0;if(a=a||{},b.string(i)&&i.search(" ")!==-1&&(i=it(i)),b.array(i))return i.forEach((function(w){return we(w,t,r,a)})),a;if(b.object(i)&&(t=i,i=""),b.func(t)&&r(i))a[i]=a[i]||[],a[i].push(t);else if(b.array(t))for(var d=0,h=t;d<h.length;d++){var g=h[d];we(i,g,r,a)}else if(b.object(t))for(var v in t)we(it(v).map((function(w){return"".concat(i).concat(w)})),t[v],r,a);return a}function it(i){return i.trim().split(/ +/)}var nt=function(i,t){return Math.sqrt(i*i+t*t)},xt=["webkit","moz"];function gt(i,t){i.__set||(i.__set={});var r=function(d){if(xt.some((function(h){return d.indexOf(h)===0})))return 1;typeof i[d]!="function"&&d!=="__set"&&Object.defineProperty(i,d,{get:function(){return d in i.__set?i.__set[d]:i.__set[d]=t[d]},set:function(h){i.__set[d]=h},configurable:!0})};for(var a in t)r(a);return i}function mt(i,t){i.page=i.page||{},i.page.x=t.page.x,i.page.y=t.page.y,i.client=i.client||{},i.client.x=t.client.x,i.client.y=t.client.y,i.timeStamp=t.timeStamp}function Fe(i){i.page.x=0,i.page.y=0,i.client.x=0,i.client.y=0}function Ot(i){return i instanceof X.Event||i instanceof X.Touch}function yt(i,t,r){return i=i||"page",(r=r||{}).x=t[i+"X"],r.y=t[i+"Y"],r}function rt(i,t){return t=t||{x:0,y:0},ue.isOperaMobile&&Ot(i)?(yt("screen",i,t),t.x+=window.scrollX,t.y+=window.scrollY):yt("page",i,t),t}function Ve(i){return b.number(i.pointerId)?i.pointerId:i.identifier}function St(i,t,r){var a=t.length>1?Tt(t):t[0];rt(a,i.page),(function(d,h){h=h||{},ue.isOperaMobile&&Ot(d)?yt("screen",d,h):yt("client",d,h)})(a,i.client),i.timeStamp=r}function Dt(i){var t=[];return b.array(i)?(t[0]=i[0],t[1]=i[1]):i.type==="touchend"?i.touches.length===1?(t[0]=i.touches[0],t[1]=i.changedTouches[0]):i.touches.length===0&&(t[0]=i.changedTouches[0],t[1]=i.changedTouches[1]):(t[0]=i.touches[0],t[1]=i.touches[1]),t}function Tt(i){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},r=0;r<i.length;r++){var a=i[r];for(var d in t)t[d]+=a[d]}for(var h in t)t[h]/=i.length;return t}function fe(i){if(!i.length)return null;var t=Dt(i),r=Math.min(t[0].pageX,t[1].pageX),a=Math.min(t[0].pageY,t[1].pageY),d=Math.max(t[0].pageX,t[1].pageX),h=Math.max(t[0].pageY,t[1].pageY);return{x:r,y:a,left:r,top:a,right:d,bottom:h,width:d-r,height:h-a}}function Be(i,t){var r=t+"X",a=t+"Y",d=Dt(i),h=d[0][r]-d[1][r],g=d[0][a]-d[1][a];return nt(h,g)}function Je(i,t){var r=t+"X",a=t+"Y",d=Dt(i),h=d[1][r]-d[0][r],g=d[1][a]-d[0][a];return 180*Math.atan2(g,h)/Math.PI}function H(i){return b.string(i.pointerType)?i.pointerType:b.number(i.pointerType)?[void 0,void 0,"touch","pen","mouse"][i.pointerType]:/touch/.test(i.type||"")||i instanceof X.Touch?"touch":"mouse"}function Y(i){var t=b.func(i.composedPath)?i.composedPath():i.path;return[Ge(t?t[0]:i.target),Ge(i.currentTarget)]}var he=(function(){function i(t){o(this,i),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return c(i,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),i})();Object.defineProperty(he.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var me=function(i,t){for(var r=0;r<t.length;r++){var a=t[r];i.push(a)}return i},ae=function(i){return me([],i)},ye=function(i,t){for(var r=0;r<i.length;r++)if(t(i[r],r,i))return r;return-1},F=function(i,t){return i[ye(i,t)]},ee=(function(i){u(r,i);var t=y(r);function r(a,d,h){var g;o(this,r),(g=t.call(this,d._interaction)).dropzone=void 0,g.dragEvent=void 0,g.relatedTarget=void 0,g.draggable=void 0,g.propagationStopped=!1,g.immediatePropagationStopped=!1;var v=h==="dragleave"?a.prev:a.cur,w=v.element,A=v.dropzone;return g.type=h,g.target=w,g.currentTarget=w,g.dropzone=A,g.dragEvent=d,g.relatedTarget=d.target,g.draggable=d.interactable,g.timeStamp=d.timeStamp,g}return c(r,[{key:"reject",value:function(){var a=this,d=this._interaction.dropState;if(this.type==="dropactivate"||this.dropzone&&d.cur.dropzone===this.dropzone&&d.cur.element===this.target)if(d.prev.dropzone=this.dropzone,d.prev.element=this.target,d.rejected=!0,d.events.enter=null,this.stopImmediatePropagation(),this.type==="dropactivate"){var h=d.activeDrops,g=ye(h,(function(w){var A=w.dropzone,k=w.element;return A===a.dropzone&&k===a.target}));d.activeDrops.splice(g,1);var v=new r(d,this.dragEvent,"dropdeactivate");v.dropzone=this.dropzone,v.target=this.target,this.dropzone.fire(v)}else this.dropzone.fire(new r(d,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),r})(he);function Re(i,t){for(var r=0,a=i.slice();r<a.length;r++){var d=a[r],h=d.dropzone,g=d.element;t.dropzone=h,t.target=g,h.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function q(i,t){for(var r=(function(h,g){for(var v=[],w=0,A=h.interactables.list;w<A.length;w++){var k=A[w];if(k.options.drop.enabled){var M=k.options.drop.accept;if(!(b.element(M)&&M!==g||b.string(M)&&!ge(g,M)||b.func(M)&&!M({dropzone:k,draggableElement:g})))for(var R=0,$=k.getAllElements();R<$.length;R++){var j=$[R];j!==g&&v.push({dropzone:k,element:j,rect:k.getRect(j)})}}}return v})(i,t),a=0;a<r.length;a++){var d=r[a];d.rect=d.dropzone.getRect(d.element)}return r}function je(i,t,r){for(var a=i.dropState,d=i.interactable,h=i.element,g=[],v=0,w=a.activeDrops;v<w.length;v++){var A=w[v],k=A.dropzone,M=A.element,R=A.rect,$=k.dropCheck(t,r,d,h,M,R);g.push($?M:null)}var j=(function(G){for(var oe,ne,ce,Ee=[],Ie=0;Ie<G.length;Ie++){var ve=G[Ie],Ce=G[oe];if(ve&&Ie!==oe)if(Ce){var ht=Oe(ve),Ue=Oe(Ce);if(ht!==ve.ownerDocument)if(Ue!==ve.ownerDocument)if(ht!==Ue){Ee=Ee.length?Ee:pe(Ce);var bt=void 0;if(Ce instanceof X.HTMLElement&&ve instanceof X.SVGElement&&!(ve instanceof X.SVGSVGElement)){if(ve===Ue)continue;bt=ve.ownerSVGElement}else bt=ve;for(var wt=pe(bt,Ce.ownerDocument),Ct=0;wt[Ct]&&wt[Ct]===Ee[Ct];)Ct++;var pi=[wt[Ct-1],wt[Ct],Ee[Ct]];if(pi[0])for(var Jt=pi[0].lastChild;Jt;){if(Jt===pi[1]){oe=Ie,Ee=wt;break}if(Jt===pi[2])break;Jt=Jt.previousSibling}}else ce=Ce,(parseInt(S(ne=ve).getComputedStyle(ne).zIndex,10)||0)>=(parseInt(S(ce).getComputedStyle(ce).zIndex,10)||0)&&(oe=Ie);else oe=Ie}else oe=Ie}return oe})(g);return a.activeDrops[j]||null}function Ne(i,t,r){var a=i.dropState,d={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return r.type==="dragstart"&&(d.activate=new ee(a,r,"dropactivate"),d.activate.target=null,d.activate.dropzone=null),r.type==="dragend"&&(d.deactivate=new ee(a,r,"dropdeactivate"),d.deactivate.target=null,d.deactivate.dropzone=null),a.rejected||(a.cur.element!==a.prev.element&&(a.prev.dropzone&&(d.leave=new ee(a,r,"dragleave"),r.dragLeave=d.leave.target=a.prev.element,r.prevDropzone=d.leave.dropzone=a.prev.dropzone),a.cur.dropzone&&(d.enter=new ee(a,r,"dragenter"),r.dragEnter=a.cur.element,r.dropzone=a.cur.dropzone)),r.type==="dragend"&&a.cur.dropzone&&(d.drop=new ee(a,r,"drop"),r.dropzone=a.cur.dropzone,r.relatedTarget=a.cur.element),r.type==="dragmove"&&a.cur.dropzone&&(d.move=new ee(a,r,"dropmove"),r.dropzone=a.cur.dropzone)),d}function Xe(i,t){var r=i.dropState,a=r.activeDrops,d=r.cur,h=r.prev;t.leave&&h.dropzone.fire(t.leave),t.enter&&d.dropzone.fire(t.enter),t.move&&d.dropzone.fire(t.move),t.drop&&d.dropzone.fire(t.drop),t.deactivate&&Re(a,t.deactivate),r.prev.dropzone=d.dropzone,r.prev.element=d.element}function Le(i,t){var r=i.interaction,a=i.iEvent,d=i.event;if(a.type==="dragmove"||a.type==="dragend"){var h=r.dropState;t.dynamicDrop&&(h.activeDrops=q(t,r.element));var g=a,v=je(r,g,d);h.rejected=h.rejected&&!!v&&v.dropzone===h.cur.dropzone&&v.element===h.cur.element,h.cur.dropzone=v&&v.dropzone,h.cur.element=v&&v.element,h.events=Ne(r,0,g)}}var Qe={id:"actions/drop",install:function(i){var t=i.actions,r=i.interactStatic,a=i.Interactable,d=i.defaults;i.usePlugin(B),a.prototype.dropzone=function(h){return(function(g,v){if(b.object(v)){if(g.options.drop.enabled=v.enabled!==!1,v.listeners){var w=we(v.listeners),A=Object.keys(w).reduce((function(M,R){return M[/^(enter|leave)/.test(R)?"drag".concat(R):/^(activate|deactivate|move)/.test(R)?"drop".concat(R):R]=w[R],M}),{}),k=g.options.drop.listeners;k&&g.off(k),g.on(A),g.options.drop.listeners=A}return b.func(v.ondrop)&&g.on("drop",v.ondrop),b.func(v.ondropactivate)&&g.on("dropactivate",v.ondropactivate),b.func(v.ondropdeactivate)&&g.on("dropdeactivate",v.ondropdeactivate),b.func(v.ondragenter)&&g.on("dragenter",v.ondragenter),b.func(v.ondragleave)&&g.on("dragleave",v.ondragleave),b.func(v.ondropmove)&&g.on("dropmove",v.ondropmove),/^(pointer|center)$/.test(v.overlap)?g.options.drop.overlap=v.overlap:b.number(v.overlap)&&(g.options.drop.overlap=Math.max(Math.min(1,v.overlap),0)),"accept"in v&&(g.options.drop.accept=v.accept),"checker"in v&&(g.options.drop.checker=v.checker),g}return b.bool(v)?(g.options.drop.enabled=v,g):g.options.drop})(this,h)},a.prototype.dropCheck=function(h,g,v,w,A,k){return(function(M,R,$,j,G,oe,ne){var ce=!1;if(!(ne=ne||M.getRect(oe)))return!!M.options.drop.checker&&M.options.drop.checker(R,$,ce,M,oe,j,G);var Ee=M.options.drop.overlap;if(Ee==="pointer"){var Ie=ke(j,G,"drag"),ve=rt(R);ve.x+=Ie.x,ve.y+=Ie.y;var Ce=ve.x>ne.left&&ve.x<ne.right,ht=ve.y>ne.top&&ve.y<ne.bottom;ce=Ce&&ht}var Ue=j.getRect(G);if(Ue&&Ee==="center"){var bt=Ue.left+Ue.width/2,wt=Ue.top+Ue.height/2;ce=bt>=ne.left&&bt<=ne.right&&wt>=ne.top&&wt<=ne.bottom}return Ue&&b.number(Ee)&&(ce=Math.max(0,Math.min(ne.right,Ue.right)-Math.max(ne.left,Ue.left))*Math.max(0,Math.min(ne.bottom,Ue.bottom)-Math.max(ne.top,Ue.top))/(Ue.width*Ue.height)>=Ee),M.options.drop.checker&&(ce=M.options.drop.checker(R,$,ce,M,oe,j,G)),ce})(this,h,g,v,w,A,k)},r.dynamicDrop=function(h){return b.bool(h)?(i.dynamicDrop=h,r):i.dynamicDrop},ie(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",i.dynamicDrop=!1,d.actions.drop=Qe.defaults},listeners:{"interactions:before-action-start":function(i){var t=i.interaction;t.prepared.name==="drag"&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(i,t){var r=i.interaction,a=(i.event,i.iEvent);if(r.prepared.name==="drag"){var d=r.dropState;d.activeDrops=[],d.events={},d.activeDrops=q(t,r.element),d.events=Ne(r,0,a),d.events.activate&&(Re(d.activeDrops,d.events.activate),t.fire("actions/drop:start",{interaction:r,dragEvent:a}))}},"interactions:action-move":Le,"interactions:after-action-move":function(i,t){var r=i.interaction,a=i.iEvent;if(r.prepared.name==="drag"){var d=r.dropState;Xe(r,d.events),t.fire("actions/drop:move",{interaction:r,dragEvent:a}),d.events={}}},"interactions:action-end":function(i,t){if(i.interaction.prepared.name==="drag"){var r=i.interaction,a=i.iEvent;Le(i,t),Xe(r,r.dropState.events),t.fire("actions/drop:end",{interaction:r,dragEvent:a})}},"interactions:stop":function(i){var t=i.interaction;if(t.prepared.name==="drag"){var r=t.dropState;r&&(r.activeDrops=null,r.events=null,r.cur.dropzone=null,r.cur.element=null,r.prev.dropzone=null,r.prev.element=null,r.rejected=!1)}}},getActiveDrops:q,getDrop:je,getDropEvents:Ne,fireDropEvents:Xe,filterEventType:function(i){return i.search("drag")===0||i.search("drop")===0},defaults:{enabled:!1,accept:null,overlap:"pointer"}},Ye=Qe;function We(i){var t=i.interaction,r=i.iEvent,a=i.phase;if(t.prepared.name==="gesture"){var d=t.pointers.map((function(A){return A.pointer})),h=a==="start",g=a==="end",v=t.interactable.options.deltaSource;if(r.touches=[d[0],d[1]],h)r.distance=Be(d,v),r.box=fe(d),r.scale=1,r.ds=0,r.angle=Je(d,v),r.da=0,t.gesture.startDistance=r.distance,t.gesture.startAngle=r.angle;else if(g||t.pointers.length<2){var w=t.prevEvent;r.distance=w.distance,r.box=w.box,r.scale=w.scale,r.ds=0,r.angle=w.angle,r.da=0}else r.distance=Be(d,v),r.box=fe(d),r.scale=r.distance/t.gesture.startDistance,r.angle=Je(d,v),r.ds=r.scale-t.gesture.scale,r.da=r.angle-t.gesture.angle;t.gesture.distance=r.distance,t.gesture.angle=r.angle,b.number(r.scale)&&r.scale!==1/0&&!isNaN(r.scale)&&(t.gesture.scale=r.scale)}}var qe={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(i){var t=i.actions,r=i.Interactable,a=i.defaults;r.prototype.gesturable=function(d){return b.object(d)?(this.options.gesture.enabled=d.enabled!==!1,this.setPerAction("gesture",d),this.setOnEvents("gesture",d),this):b.bool(d)?(this.options.gesture.enabled=d,this):this.options.gesture},t.map.gesture=qe,t.methodDict.gesture="gesturable",a.actions.gesture=qe.defaults},listeners:{"interactions:action-start":We,"interactions:action-move":We,"interactions:action-end":We,"interactions:new":function(i){i.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(i){if(!(i.interaction.pointers.length<2)){var t=i.interactable.options.gesture;if(t&&t.enabled)return i.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(i){return i.search("gesture")===0}},He=qe;function Se(i,t,r,a,d,h,g){if(!t)return!1;if(t===!0){var v=b.number(h.width)?h.width:h.right-h.left,w=b.number(h.height)?h.height:h.bottom-h.top;if(g=Math.min(g,Math.abs((i==="left"||i==="right"?v:w)/2)),v<0&&(i==="left"?i="right":i==="right"&&(i="left")),w<0&&(i==="top"?i="bottom":i==="bottom"&&(i="top")),i==="left"){var A=v>=0?h.left:h.right;return r.x<A+g}if(i==="top"){var k=w>=0?h.top:h.bottom;return r.y<k+g}if(i==="right")return r.x>(v>=0?h.right:h.left)-g;if(i==="bottom")return r.y>(w>=0?h.bottom:h.top)-g}return!!b.element(a)&&(b.element(t)?t===a:De(a,t,d))}function se(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="resize"&&r.resizeAxes){var a=t;r.interactable.options.resize.square?(r.resizeAxes==="y"?a.delta.x=a.delta.y:a.delta.y=a.delta.x,a.axes="xy"):(a.axes=r.resizeAxes,r.resizeAxes==="x"?a.delta.y=0:r.resizeAxes==="y"&&(a.delta.x=0))}}var xe,Pe,be={id:"actions/resize",before:["actions/drag"],install:function(i){var t=i.actions,r=i.browser,a=i.Interactable,d=i.defaults;be.cursors=(function(h){return h.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}})(r),be.defaultMargin=r.supportsTouch||r.supportsPointerEvent?20:10,a.prototype.resizable=function(h){return(function(g,v,w){return b.object(v)?(g.options.resize.enabled=v.enabled!==!1,g.setPerAction("resize",v),g.setOnEvents("resize",v),b.string(v.axis)&&/^x$|^y$|^xy$/.test(v.axis)?g.options.resize.axis=v.axis:v.axis===null&&(g.options.resize.axis=w.defaults.actions.resize.axis),b.bool(v.preserveAspectRatio)?g.options.resize.preserveAspectRatio=v.preserveAspectRatio:b.bool(v.square)&&(g.options.resize.square=v.square),g):b.bool(v)?(g.options.resize.enabled=v,g):g.options.resize})(this,h,i)},t.map.resize=be,t.methodDict.resize="resizable",d.actions.resize=be.defaults},listeners:{"interactions:new":function(i){i.interaction.resizeAxes="xy"},"interactions:action-start":function(i){(function(t){var r=t.iEvent,a=t.interaction;if(a.prepared.name==="resize"&&a.prepared.edges){var d=r,h=a.rect;a._rects={start:ie({},h),corrected:ie({},h),previous:ie({},h),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},d.edges=a.prepared.edges,d.rect=a._rects.corrected,d.deltaRect=a._rects.delta}})(i),se(i)},"interactions:action-move":function(i){(function(t){var r=t.iEvent,a=t.interaction;if(a.prepared.name==="resize"&&a.prepared.edges){var d=r,h=a.interactable.options.resize.invert,g=h==="reposition"||h==="negate",v=a.rect,w=a._rects,A=w.start,k=w.corrected,M=w.delta,R=w.previous;if(ie(R,k),g){if(ie(k,v),h==="reposition"){if(k.top>k.bottom){var $=k.top;k.top=k.bottom,k.bottom=$}if(k.left>k.right){var j=k.left;k.left=k.right,k.right=j}}}else k.top=Math.min(v.top,A.bottom),k.bottom=Math.max(v.bottom,A.top),k.left=Math.min(v.left,A.right),k.right=Math.max(v.right,A.left);for(var G in k.width=k.right-k.left,k.height=k.bottom-k.top,k)M[G]=k[G]-R[G];d.edges=a.prepared.edges,d.rect=k,d.deltaRect=M}})(i),se(i)},"interactions:action-end":function(i){var t=i.iEvent,r=i.interaction;if(r.prepared.name==="resize"&&r.prepared.edges){var a=t;a.edges=r.prepared.edges,a.rect=r._rects.corrected,a.deltaRect=r._rects.delta}},"auto-start:check":function(i){var t=i.interaction,r=i.interactable,a=i.element,d=i.rect,h=i.buttons;if(d){var g=ie({},t.coords.cur.page),v=r.options.resize;if(v&&v.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||(h&v.mouseButtons)!=0)){if(b.object(v.edges)){var w={left:!1,right:!1,top:!1,bottom:!1};for(var A in w)w[A]=Se(A,v.edges[A],g,t._latestPointer.eventTarget,a,d,v.margin||be.defaultMargin);w.left=w.left&&!w.right,w.top=w.top&&!w.bottom,(w.left||w.right||w.top||w.bottom)&&(i.action={name:"resize",edges:w})}else{var k=v.axis!=="y"&&g.x>d.right-be.defaultMargin,M=v.axis!=="x"&&g.y>d.bottom-be.defaultMargin;(k||M)&&(i.action={name:"resize",axes:(k?"x":"")+(M?"y":"")})}return!i.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(i){var t=i.edges,r=i.axis,a=i.name,d=be.cursors,h=null;if(r)h=d[a+r];else if(t){for(var g="",v=0,w=["top","bottom","left","right"];v<w.length;v++){var A=w[v];t[A]&&(g+=A)}h=d[g]}return h},filterEventType:function(i){return i.search("resize")===0},defaultMargin:null},re=be,te={id:"actions",install:function(i){i.usePlugin(He),i.usePlugin(re),i.usePlugin(B),i.usePlugin(Ye)}},V=0,U={request:function(i){return xe(i)},cancel:function(i){return Pe(i)},init:function(i){if(xe=i.requestAnimationFrame,Pe=i.cancelAnimationFrame,!xe)for(var t=["ms","moz","webkit","o"],r=0;r<t.length;r++){var a=t[r];xe=i["".concat(a,"RequestAnimationFrame")],Pe=i["".concat(a,"CancelAnimationFrame")]||i["".concat(a,"CancelRequestAnimationFrame")]}xe=xe&&xe.bind(i),Pe=Pe&&Pe.bind(i),xe||(xe=function(d){var h=Date.now(),g=Math.max(0,16-(h-V)),v=i.setTimeout((function(){d(h+g)}),g);return V=h+g,v},Pe=function(d){return clearTimeout(d)})}},N={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(i){N.isScrolling=!0,U.cancel(N.i),i.autoScroll=N,N.interaction=i,N.prevTime=N.now(),N.i=U.request(N.scroll)},stop:function(){N.isScrolling=!1,N.interaction&&(N.interaction.autoScroll=null),U.cancel(N.i)},scroll:function(){var i=N.interaction,t=i.interactable,r=i.element,a=i.prepared.name,d=t.options[a].autoScroll,h=le(d.container,t,r),g=N.now(),v=(g-N.prevTime)/1e3,w=d.speed*v;if(w>=1){var A={x:N.x*w,y:N.y*w};if(A.x||A.y){var k=Ke(h);b.window(h)?h.scrollBy(A.x,A.y):h&&(h.scrollLeft+=A.x,h.scrollTop+=A.y);var M=Ke(h),R={x:M.x-k.x,y:M.y-k.y};(R.x||R.y)&&t.fire({type:"autoscroll",target:r,interactable:t,delta:R,interaction:i,container:h})}N.prevTime=g}N.isScrolling&&(U.cancel(N.i),N.i=U.request(N.scroll))},check:function(i,t){var r;return(r=i.options[t].autoScroll)==null?void 0:r.enabled},onInteractionMove:function(i){var t=i.interaction,r=i.pointer;if(t.interacting()&&N.check(t.interactable,t.prepared.name))if(t.simulation)N.x=N.y=0;else{var a,d,h,g,v=t.interactable,w=t.element,A=t.prepared.name,k=v.options[A].autoScroll,M=le(k.container,v,w);if(b.window(M))g=r.clientX<N.margin,a=r.clientY<N.margin,d=r.clientX>M.innerWidth-N.margin,h=r.clientY>M.innerHeight-N.margin;else{var R=$e(M);g=r.clientX<R.left+N.margin,a=r.clientY<R.top+N.margin,d=r.clientX>R.right-N.margin,h=r.clientY>R.bottom-N.margin}N.x=d?1:g?-1:0,N.y=h?1:a?-1:0,N.isScrolling||(N.margin=k.margin,N.speed=k.speed,N.start(t))}}};function le(i,t,r){return(b.string(i)?dt(i,t,r):i)||S(r)}function Ke(i){return b.window(i)&&(i=window.document.body),{x:i.scrollLeft,y:i.scrollTop}}var ot={id:"auto-scroll",install:function(i){var t=i.defaults,r=i.actions;i.autoScroll=N,N.now=function(){return i.now()},r.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=N.defaults},listeners:{"interactions:new":function(i){i.interaction.autoScroll=null},"interactions:destroy":function(i){i.interaction.autoScroll=null,N.stop(),N.interaction&&(N.interaction=null)},"interactions:stop":N.stop,"interactions:action-move":function(i){return N.onInteractionMove(i)}}},Et=ot;function _t(i,t){var r=!1;return function(){return r||(z.console.warn(t),r=!0),i.apply(this,arguments)}}function Ht(i,t){return i.name=t.name,i.axis=t.axis,i.edges=t.edges,i}function Rt(i){return b.bool(i)?(this.options.styleCursor=i,this):i===null?(delete this.options.styleCursor,this):this.options.styleCursor}function ni(i){return b.func(i)?(this.options.actionChecker=i,this):i===null?(delete this.options.actionChecker,this):this.options.actionChecker}var Tr={id:"auto-start/interactableMethods",install:function(i){var t=i.Interactable;t.prototype.getAction=function(r,a,d,h){var g=(function(v,w,A,k,M){var R=v.getRect(k),$=w.buttons||{0:1,1:4,3:8,4:16}[w.button],j={action:null,interactable:v,interaction:A,element:k,rect:R,buttons:$};return M.fire("auto-start:check",j),j.action})(this,a,d,h,i);return this.options.actionChecker?this.options.actionChecker(r,a,g,this,h,d):g},t.prototype.ignoreFrom=_t((function(r){return this._backCompatOption("ignoreFrom",r)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=_t((function(r){return this._backCompatOption("allowFrom",r)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=ni,t.prototype.styleCursor=Rt}};function Xi(i,t,r,a,d){return t.testIgnoreAllow(t.options[i.name],r,a)&&t.options[i.name].enabled&&ri(t,r,i,d)?i:null}function zr(i,t,r,a,d,h,g){for(var v=0,w=a.length;v<w;v++){var A=a[v],k=d[v],M=A.getAction(t,r,i,k);if(M){var R=Xi(M,A,k,h,g);if(R)return{action:R,interactable:A,element:k}}}return{action:null,interactable:null,element:null}}function Gi(i,t,r,a,d){var h=[],g=[],v=a;function w(k){h.push(k),g.push(v)}for(;b.element(v);){h=[],g=[],d.interactables.forEachMatch(v,w);var A=zr(i,t,r,h,g,a,d);if(A.action&&!A.interactable.options[A.action.name].manualStart)return A;v=Me(v)}return{action:null,interactable:null,element:null}}function Ji(i,t,r){var a=t.action,d=t.interactable,h=t.element;a=a||{name:null},i.interactable=d,i.element=h,Ht(i.prepared,a),i.rect=d&&a.name?d.getRect(h):null,Zi(i,r),r.fire("autoStart:prepared",{interaction:i})}function ri(i,t,r,a){var d=i.options,h=d[r.name].max,g=d[r.name].maxPerElement,v=a.autoStart.maxInteractions,w=0,A=0,k=0;if(!(h&&g&&v))return!1;for(var M=0,R=a.interactions.list;M<R.length;M++){var $=R[M],j=$.prepared.name;if($.interacting()&&(++w>=v||$.interactable===i&&((A+=j===r.name?1:0)>=h||$.element===t&&(k++,j===r.name&&k>=g))))return!1}return v>0}function Qi(i,t){return b.number(i)?(t.autoStart.maxInteractions=i,this):t.autoStart.maxInteractions}function bi(i,t,r){var a=r.autoStart.cursorElement;a&&a!==i&&(a.style.cursor=""),i.ownerDocument.documentElement.style.cursor=t,i.style.cursor=t,r.autoStart.cursorElement=t?i:null}function Zi(i,t){var r=i.interactable,a=i.element,d=i.prepared;if(i.pointerType==="mouse"&&r&&r.options.styleCursor){var h="";if(d.name){var g=r.options[d.name].cursorChecker;h=b.func(g)?g(d,r,a,i._interacting):t.actions.map[d.name].getCursor(d)}bi(i.element,h||"",t)}else t.autoStart.cursorElement&&bi(t.autoStart.cursorElement,"",t)}var Mr={id:"auto-start/base",before:["actions"],install:function(i){var t=i.interactStatic,r=i.defaults;i.usePlugin(Tr),r.base.actionChecker=null,r.base.styleCursor=!0,ie(r.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(a){return Qi(a,i)},i.autoStart={maxInteractions:1/0,withinInteractionLimit:ri,cursorElement:null}},listeners:{"interactions:down":function(i,t){var r=i.interaction,a=i.pointer,d=i.event,h=i.eventTarget;r.interacting()||Ji(r,Gi(r,a,d,h,t),t)},"interactions:move":function(i,t){(function(r,a){var d=r.interaction,h=r.pointer,g=r.event,v=r.eventTarget;d.pointerType!=="mouse"||d.pointerIsDown||d.interacting()||Ji(d,Gi(d,h,g,v,a),a)})(i,t),(function(r,a){var d=r.interaction;if(d.pointerIsDown&&!d.interacting()&&d.pointerWasMoved&&d.prepared.name){a.fire("autoStart:before-start",r);var h=d.interactable,g=d.prepared.name;g&&h&&(h.options[g].manualStart||!ri(h,d.element,d.prepared,a)?d.stop():(d.start(d.prepared,h,d.element),Zi(d,a)))}})(i,t)},"interactions:stop":function(i,t){var r=i.interaction,a=r.interactable;a&&a.options.styleCursor&&bi(r.element,"",t)}},maxInteractions:Qi,withinInteractionLimit:ri,validateAction:Xi},xi=Mr,Pr={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(i,t){var r=i.interaction,a=i.eventTarget,d=i.dx,h=i.dy;if(r.prepared.name==="drag"){var g=Math.abs(d),v=Math.abs(h),w=r.interactable.options.drag,A=w.startAxis,k=g>v?"x":g<v?"y":"xy";if(r.prepared.axis=w.lockAxis==="start"?k[0]:w.lockAxis,k!=="xy"&&A!=="xy"&&A!==k){r.prepared.name=null;for(var M=a,R=function(j){if(j!==r.interactable){var G=r.interactable.options.drag;if(!G.manualStart&&j.testIgnoreAllow(G,M,a)){var oe=j.getAction(r.downPointer,r.downEvent,r,M);if(oe&&oe.name==="drag"&&(function(ne,ce){if(!ce)return!1;var Ee=ce.options.drag.startAxis;return ne==="xy"||Ee==="xy"||Ee===ne})(k,j)&&xi.validateAction(oe,j,M,a,t))return j}}};b.element(M);){var $=t.interactables.forEachMatch(M,R);if($){r.prepared.name="drag",r.interactable=$,r.element=M;break}M=Me(M)}}}}}};function _i(i){var t=i.prepared&&i.prepared.name;if(!t)return null;var r=i.interactable.options;return r[t].hold||r[t].delay}var Lr={id:"auto-start/hold",install:function(i){var t=i.defaults;i.usePlugin(xi),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(i){i.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(i){var t=i.interaction,r=_i(t);r>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),r))},"interactions:move":function(i){var t=i.interaction,r=i.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!r&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(i){var t=i.interaction;_i(t)>0&&(t.prepared.name=null)}},getHoldDuration:_i},Ir=Lr,Dr={id:"auto-start",install:function(i){i.usePlugin(xi),i.usePlugin(Ir),i.usePlugin(Pr)}},Rr=function(i){return/^(always|never|auto)$/.test(i)?(this.options.preventDefault=i,this):b.bool(i)?(this.options.preventDefault=i?"always":"never",this):this.options.preventDefault};function Fr(i){var t=i.interaction,r=i.event;t.interactable&&t.interactable.checkAndPreventDefault(r)}var en={id:"core/interactablePreventDefault",install:function(i){var t=i.Interactable;t.prototype.preventDefault=Rr,t.prototype.checkAndPreventDefault=function(r){return(function(a,d,h){var g=a.options.preventDefault;if(g!=="never")if(g!=="always"){if(d.events.supportsPassive&&/^touch(start|move)$/.test(h.type)){var v=S(h.target).document,w=d.getDocOptions(v);if(!w||!w.events||w.events.passive!==!1)return}/^(mouse|pointer|touch)*(down|start)/i.test(h.type)||b.element(h.target)&&ge(h.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||h.preventDefault()}else h.preventDefault()})(this,i,r)},i.interactions.docEvents.push({type:"dragstart",listener:function(r){for(var a=0,d=i.interactions.list;a<d.length;a++){var h=d[a];if(h.element&&(h.element===r.target||_e(h.element,r.target)))return void h.interactable.checkAndPreventDefault(r)}}})},listeners:["down","move","up","cancel"].reduce((function(i,t){return i["interactions:".concat(t)]=Fr,i}),{})};function oi(i,t){if(t.phaselessTypes[i])return!0;for(var r in t.map)if(i.indexOf(r)===0&&i.substr(r.length)in t.phases)return!0;return!1}function jt(i){var t={};for(var r in i){var a=i[r];b.plainObject(a)?t[r]=jt(a):b.array(a)?t[r]=ae(a):t[r]=a}return t}var wi=(function(){function i(t){o(this,i),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=ai(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return c(i,[{key:"start",value:function(t,r){var a,d,h=t.phase,g=this.interaction,v=(function(A){var k=A.interactable.options[A.prepared.name],M=k.modifiers;return M&&M.length?M:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(R){var $=k[R];return $&&$.enabled&&{options:$,methods:$._methods}})).filter((function(R){return!!R}))})(g);this.prepareStates(v),this.startEdges=ie({},g.edges),this.edges=ie({},this.startEdges),this.startOffset=(a=g.rect,d=r,a?{left:d.x-a.left,top:d.y-a.top,right:a.right-d.x,bottom:a.bottom-d.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var w=this.fillArg({phase:h,pageCoords:r,preEnd:!1});return this.result=ai(),this.startAll(w),this.result=this.setAll(w)}},{key:"fillArg",value:function(t){var r=this.interaction;return t.interaction=r,t.interactable=r.interactable,t.element=r.element,t.rect||(t.rect=r.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var r=0,a=this.states;r<a.length;r++){var d=a[r];d.methods.start&&(t.state=d,d.methods.start(t))}}},{key:"setAll",value:function(t){var r=t.phase,a=t.preEnd,d=t.skipModifiers,h=t.rect,g=t.edges;t.coords=ie({},t.pageCoords),t.rect=ie({},h),t.edges=ie({},g);for(var v=d?this.states.slice(d):this.states,w=ai(t.coords,t.rect),A=0;A<v.length;A++){var k,M=v[A],R=M.options,$=ie({},t.coords),j=null;(k=M.methods)!=null&&k.set&&this.shouldDo(R,a,r)&&(t.state=M,j=M.methods.set(t),ze(t.edges,t.rect,{x:t.coords.x-$.x,y:t.coords.y-$.y})),w.eventProps.push(j)}ie(this.edges,t.edges),w.delta.x=t.coords.x-t.pageCoords.x,w.delta.y=t.coords.y-t.pageCoords.y,w.rectDelta.left=t.rect.left-h.left,w.rectDelta.right=t.rect.right-h.right,w.rectDelta.top=t.rect.top-h.top,w.rectDelta.bottom=t.rect.bottom-h.bottom;var G=this.result.coords,oe=this.result.rect;if(G&&oe){var ne=w.rect.left!==oe.left||w.rect.right!==oe.right||w.rect.top!==oe.top||w.rect.bottom!==oe.bottom;w.changed=ne||G.x!==w.coords.x||G.y!==w.coords.y}return w}},{key:"applyToInteraction",value:function(t){var r=this.interaction,a=t.phase,d=r.coords.cur,h=r.coords.start,g=this.result,v=this.startDelta,w=g.delta;a==="start"&&ie(this.startDelta,g.delta);for(var A=0,k=[[h,v],[d,w]];A<k.length;A++){var M=k[A],R=M[0],$=M[1];R.page.x+=$.x,R.page.y+=$.y,R.client.x+=$.x,R.client.y+=$.y}var j=this.result.rectDelta,G=t.rect||r.rect;G.left+=j.left,G.right+=j.right,G.top+=j.top,G.bottom+=j.bottom,G.width=G.right-G.left,G.height=G.bottom-G.top}},{key:"setAndApply",value:function(t){var r=this.interaction,a=t.phase,d=t.preEnd,h=t.skipModifiers,g=this.setAll(this.fillArg({preEnd:d,phase:a,pageCoords:t.modifiedCoords||r.coords.cur.page}));if(this.result=g,!g.changed&&(!h||h<this.states.length)&&r.interacting())return!1;if(t.modifiedCoords){var v=r.coords.cur.page,w={x:t.modifiedCoords.x-v.x,y:t.modifiedCoords.y-v.y};g.coords.x+=w.x,g.coords.y+=w.y,g.delta.x+=w.x,g.delta.y+=w.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var r=t.interaction,a=t.event,d=this.states;if(d&&d.length){for(var h=!1,g=0;g<d.length;g++){var v=d[g];t.state=v;var w=v.options,A=v.methods,k=A.beforeEnd&&A.beforeEnd(t);if(k)return this.endResult=k,!1;h=h||!h&&this.shouldDo(w,!0,t.phase,!0)}h&&r.move({event:a,preEnd:!0})}}},{key:"stop",value:function(t){var r=t.interaction;if(this.states&&this.states.length){var a=ie({states:this.states,interactable:r.interactable,element:r.element,rect:null},t);this.fillArg(a);for(var d=0,h=this.states;d<h.length;d++){var g=h[d];a.state=g,g.methods.stop&&g.methods.stop(a)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var r=0;r<t.length;r++){var a=t[r],d=a.options,h=a.methods,g=a.name;this.states.push({options:d,methods:h,index:r,name:g})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var r=t.interaction,a=r.coords,d=r.rect,h=r.modification;if(h.result){for(var g=h.startDelta,v=h.result,w=v.delta,A=v.rectDelta,k=0,M=[[a.start,g],[a.cur,w]];k<M.length;k++){var R=M[k],$=R[0],j=R[1];$.page.x-=j.x,$.page.y-=j.y,$.client.x-=j.x,$.client.y-=j.y}d.left-=A.left,d.right-=A.right,d.top-=A.top,d.bottom-=A.bottom}}},{key:"shouldDo",value:function(t,r,a,d){return!(!t||t.enabled===!1||d&&!t.endOnly||t.endOnly&&!r||a==="start"&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map((function(r){return jt(r)})),this.result=ai(ie({},t.result.coords),ie({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),i})();function ai(i,t){return{rect:t,coords:i,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function zt(i,t){var r=i.defaults,a={start:i.start,set:i.set,beforeEnd:i.beforeEnd,stop:i.stop},d=function(h){var g=h||{};for(var v in g.enabled=g.enabled!==!1,r)v in g||(g[v]=r[v]);var w={options:g,methods:a,name:t,enable:function(){return g.enabled=!0,w},disable:function(){return g.enabled=!1,w}};return w};return t&&typeof t=="string"&&(d._defaults=r,d._methods=a),d}function Ut(i){var t=i.iEvent,r=i.interaction.modification.result;r&&(t.modifiers=r.eventProps)}var Br={id:"modifiers/base",before:["actions"],install:function(i){i.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(i){var t=i.interaction;t.modification=new wi(t)},"interactions:before-action-start":function(i){var t=i.interaction,r=i.interaction.modification;r.start(i,t.coords.start.page),t.edges=r.edges,r.applyToInteraction(i)},"interactions:before-action-move":function(i){var t=i.interaction,r=t.modification,a=r.setAndApply(i);return t.edges=r.edges,a},"interactions:before-action-end":function(i){var t=i.interaction,r=t.modification,a=r.beforeEnd(i);return t.edges=r.startEdges,a},"interactions:action-start":Ut,"interactions:action-move":Ut,"interactions:action-end":Ut,"interactions:after-action-start":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-move":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:stop":function(i){return i.interaction.modification.stop(i)}}},tn=Br,nn={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},ki=(function(i){u(r,i);var t=y(r);function r(a,d,h,g,v,w,A){var k;o(this,r),(k=t.call(this,a)).relatedTarget=null,k.screenX=void 0,k.screenY=void 0,k.button=void 0,k.buttons=void 0,k.ctrlKey=void 0,k.shiftKey=void 0,k.altKey=void 0,k.metaKey=void 0,k.page=void 0,k.client=void 0,k.delta=void 0,k.rect=void 0,k.x0=void 0,k.y0=void 0,k.t0=void 0,k.dt=void 0,k.duration=void 0,k.clientX0=void 0,k.clientY0=void 0,k.velocity=void 0,k.speed=void 0,k.swipe=void 0,k.axes=void 0,k.preEnd=void 0,v=v||a.element;var M=a.interactable,R=(M&&M.options||nn).deltaSource,$=ke(M,v,h),j=g==="start",G=g==="end",oe=j?m(k):a.prevEvent,ne=j?a.coords.start:G?{page:oe.page,client:oe.client,timeStamp:a.coords.cur.timeStamp}:a.coords.cur;return k.page=ie({},ne.page),k.client=ie({},ne.client),k.rect=ie({},a.rect),k.timeStamp=ne.timeStamp,G||(k.page.x-=$.x,k.page.y-=$.y,k.client.x-=$.x,k.client.y-=$.y),k.ctrlKey=d.ctrlKey,k.altKey=d.altKey,k.shiftKey=d.shiftKey,k.metaKey=d.metaKey,k.button=d.button,k.buttons=d.buttons,k.target=v,k.currentTarget=v,k.preEnd=w,k.type=A||h+(g||""),k.interactable=M,k.t0=j?a.pointers[a.pointers.length-1].downTime:oe.t0,k.x0=a.coords.start.page.x-$.x,k.y0=a.coords.start.page.y-$.y,k.clientX0=a.coords.start.client.x-$.x,k.clientY0=a.coords.start.client.y-$.y,k.delta=j||G?{x:0,y:0}:{x:k[R].x-oe[R].x,y:k[R].y-oe[R].y},k.dt=a.coords.delta.timeStamp,k.duration=k.timeStamp-k.t0,k.velocity=ie({},a.coords.velocity[R]),k.speed=nt(k.velocity.x,k.velocity.y),k.swipe=G||g==="inertiastart"?k.getSwipe():null,k}return c(r,[{key:"getSwipe",value:function(){var a=this._interaction;if(a.prevEvent.speed<600||this.timeStamp-a.prevEvent.timeStamp>150)return null;var d=180*Math.atan2(a.prevEvent.velocityY,a.prevEvent.velocityX)/Math.PI;d<0&&(d+=360);var h=112.5<=d&&d<247.5,g=202.5<=d&&d<337.5;return{up:g,down:!g&&22.5<=d&&d<157.5,left:h,right:!h&&(292.5<=d||d<67.5),angle:d,speed:a.prevEvent.speed,velocity:{x:a.prevEvent.velocityX,y:a.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),r})(he);Object.defineProperties(ki.prototype,{pageX:{get:function(){return this.page.x},set:function(i){this.page.x=i}},pageY:{get:function(){return this.page.y},set:function(i){this.page.y=i}},clientX:{get:function(){return this.client.x},set:function(i){this.client.x=i}},clientY:{get:function(){return this.client.y},set:function(i){this.client.y=i}},dx:{get:function(){return this.delta.x},set:function(i){this.delta.x=i}},dy:{get:function(){return this.delta.y},set:function(i){this.delta.y=i}},velocityX:{get:function(){return this.velocity.x},set:function(i){this.velocity.x=i}},velocityY:{get:function(){return this.velocity.y},set:function(i){this.velocity.y=i}}});var Nr=c((function i(t,r,a,d,h){o(this,i),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=r,this.event=a,this.downTime=d,this.downTarget=h})),qr=(function(i){return i.interactable="",i.element="",i.prepared="",i.pointerIsDown="",i.pointerWasMoved="",i._proxy="",i})({}),rn=(function(i){return i.start="",i.move="",i.end="",i.stop="",i.interacting="",i})({}),Hr=0,jr=(function(){function i(t){var r=this,a=t.pointerType,d=t.scopeFire;o(this,i),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=_t((function(k){this.move(k)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=Hr++,this._scopeFire=d,this.pointerType=a;var h=this;this._proxy={};var g=function(k){Object.defineProperty(r._proxy,k,{get:function(){return h[k]}})};for(var v in qr)g(v);var w=function(k){Object.defineProperty(r._proxy,k,{value:function(){return h[k].apply(h,arguments)}})};for(var A in rn)w(A);this._scopeFire("interactions:new",{interaction:this})}return c(i,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,r,a){var d=this.updatePointer(t,r,a,!0),h=this.pointers[d];this._scopeFire("interactions:down",{pointer:t,event:r,eventTarget:a,pointerIndex:d,pointerInfo:h,type:"down",interaction:this})}},{key:"start",value:function(t,r,a){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<(t.name==="gesture"?2:1)||!r.options[t.name].enabled)&&(Ht(this.prepared,t),this.interactable=r,this.element=a,this.rect=r.getRect(a),this.edges=this.prepared.edges?ie({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,r,a){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,r,a,!1);var d,h,g=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(d=this.coords.cur.client.x-this.coords.start.client.x,h=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=nt(d,h)>this.pointerMoveTolerance);var v,w,A,k=this.getPointerIndex(t),M={pointer:t,pointerIndex:k,pointerInfo:this.pointers[k],event:r,type:"move",eventTarget:a,dx:d,dy:h,duplicate:g,interaction:this};g||(v=this.coords.velocity,w=this.coords.delta,A=Math.max(w.timeStamp/1e3,.001),v.page.x=w.page.x/A,v.page.y=w.page.y/A,v.client.x=w.client.x/A,v.client.y=w.client.y/A,v.timeStamp=A),this._scopeFire("interactions:move",M),g||this.simulation||(this.interacting()&&(M.type=null,this.move(M)),this.pointerWasMoved&&mt(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||Fe(this.coords.delta),(t=ie({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,r,a,d){var h=this.getPointerIndex(t);h===-1&&(h=this.updatePointer(t,r,a,!1));var g=/cancel$/i.test(r.type)?"cancel":"up";this._scopeFire("interactions:".concat(g),{pointer:t,pointerIndex:h,pointerInfo:this.pointers[h],event:r,eventTarget:a,type:g,curEventTarget:d,interaction:this}),this.simulation||this.end(r),this.removePointer(t,r)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var r;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(r=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,r===!0&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var r=Ve(t);return this.pointerType==="mouse"||this.pointerType==="pen"?this.pointers.length-1:ye(this.pointers,(function(a){return a.id===r}))}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,r,a,d){var h,g,v,w=Ve(t),A=this.getPointerIndex(t),k=this.pointers[A];return d=d!==!1&&(d||/(down|start)$/i.test(r.type)),k?k.pointer=t:(k=new Nr(w,t,r,null,null),A=this.pointers.length,this.pointers.push(k)),St(this.coords.cur,this.pointers.map((function(M){return M.pointer})),this._now()),h=this.coords.delta,g=this.coords.prev,v=this.coords.cur,h.page.x=v.page.x-g.page.x,h.page.y=v.page.y-g.page.y,h.client.x=v.client.x-g.client.x,h.client.y=v.client.y-g.client.y,h.timeStamp=v.timeStamp-g.timeStamp,d&&(this.pointerIsDown=!0,k.downTime=this.coords.cur.timeStamp,k.downTarget=a,gt(this.downPointer,t),this.interacting()||(mt(this.coords.start,this.coords.cur),mt(this.coords.prev,this.coords.cur),this.downEvent=r,this.pointerWasMoved=!1)),this._updateLatestPointer(t,r,a),this._scopeFire("interactions:update-pointer",{pointer:t,event:r,eventTarget:a,down:d,pointerInfo:k,pointerIndex:A,interaction:this}),A}},{key:"removePointer",value:function(t,r){var a=this.getPointerIndex(t);if(a!==-1){var d=this.pointers[a];this._scopeFire("interactions:remove-pointer",{pointer:t,event:r,eventTarget:null,pointerIndex:a,pointerInfo:d,interaction:this}),this.pointers.splice(a,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,r,a){this._latestPointer.pointer=t,this._latestPointer.event=r,this._latestPointer.eventTarget=a}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,r,a,d){return new ki(this,t,this.prepared.name,r,this.element,a,d)}},{key:"_fireEvent",value:function(t){var r;(r=this.interactable)==null||r.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var r=t.event,a=t.phase,d=t.preEnd,h=t.type,g=this.rect;if(g&&a==="move"&&(ze(this.edges,g,this.coords.delta[this.interactable.options.deltaSource]),g.width=g.right-g.left,g.height=g.bottom-g.top),this._scopeFire("interactions:before-action-".concat(a),t)===!1)return!1;var v=t.iEvent=this._createPreparedEvent(r,a,d,h);return this._scopeFire("interactions:action-".concat(a),t),a==="start"&&(this.prevEvent=v),this._fireEvent(v),this._scopeFire("interactions:after-action-".concat(a),t),!0}},{key:"_now",value:function(){return Date.now()}}]),i})();function on(i){an(i.interaction)}function an(i){if(!(function(r){return!(!r.offset.pending.x&&!r.offset.pending.y)})(i))return!1;var t=i.offset.pending;return Si(i.coords.cur,t),Si(i.coords.delta,t),ze(i.edges,i.rect,t),t.x=0,t.y=0,!0}function Kr(i){var t=i.x,r=i.y;this.offset.pending.x+=t,this.offset.pending.y+=r,this.offset.total.x+=t,this.offset.total.y+=r}function Si(i,t){var r=i.page,a=i.client,d=t.x,h=t.y;r.x+=d,r.y+=h,a.x+=d,a.y+=h}rn.offsetBy="";var $r={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(i){i.Interaction.prototype.offsetBy=Kr},listeners:{"interactions:new":function(i){i.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(i){return(function(t){t.pointerIsDown&&(Si(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)})(i.interaction)},"interactions:before-action-start":on,"interactions:before-action-move":on,"interactions:before-action-end":function(i){var t=i.interaction;if(an(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(i){var t=i.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},sn=$r,Yr=(function(){function i(t){o(this,i),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return c(i,[{key:"start",value:function(t){var r=this.interaction,a=si(r);if(!a||!a.enabled)return!1;var d=r.coords.velocity.client,h=nt(d.x,d.y),g=this.modification||(this.modification=new wi(r));if(g.copyFrom(r.modification),this.t0=r._now(),this.allowResume=a.allowResume,this.v0=h,this.currentOffset={x:0,y:0},this.startCoords=r.coords.cur.page,this.modifierArg=g.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-r.coords.cur.timeStamp<50&&h>a.minSpeed&&h>a.endSpeed)this.startInertia();else{if(g.result=g.setAll(this.modifierArg),!g.result.changed)return!1;this.startSmoothEnd()}return r.modification.result.rect=null,r.offsetBy(this.targetOffset),r._doPhase({interaction:r,event:t,phase:"inertiastart"}),r.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),r.modification.result.rect=null,this.active=!0,r.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,r=this.interaction.coords.velocity.client,a=si(this.interaction),d=a.resistance,h=-Math.log(a.endSpeed/this.v0)/d;this.targetOffset={x:(r.x-h)/d,y:(r.y-h)/d},this.te=h,this.lambda_v0=d/this.v0,this.one_ve_v0=1-a.endSpeed/this.v0;var g=this.modification,v=this.modifierArg;v.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},g.result=g.setAll(v),g.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+g.result.delta.x,y:this.targetOffset.y+g.result.delta.y}),this.onNextFrame((function(){return t.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return t.smoothEndTick()}))}},{key:"onNextFrame",value:function(t){var r=this;this.timeout=U.request((function(){r.active&&t()}))}},{key:"inertiaTick",value:function(){var t,r,a,d,h,g,v,w=this,A=this.interaction,k=si(A).resistance,M=(A._now()-this.t0)/1e3;if(M<this.te){var R,$=1-(Math.exp(-k*M)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=0,r=0,a=this.targetOffset.x,d=this.targetOffset.y,h=this.modifiedOffset.x,g=this.modifiedOffset.y,R={x:ln(v=$,t,a,h),y:ln(v,r,d,g)}):R={x:this.targetOffset.x*$,y:this.targetOffset.y*$};var j={x:R.x-this.currentOffset.x,y:R.y-this.currentOffset.y};this.currentOffset.x+=j.x,this.currentOffset.y+=j.y,A.offsetBy(j),A.move(),this.onNextFrame((function(){return w.inertiaTick()}))}else A.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,r=this.interaction,a=r._now()-this.t0,d=si(r).smoothEndDuration;if(a<d){var h={x:cn(a,0,this.targetOffset.x,d),y:cn(a,0,this.targetOffset.y,d)},g={x:h.x-this.currentOffset.x,y:h.y-this.currentOffset.y};this.currentOffset.x+=g.x,this.currentOffset.y+=g.y,r.offsetBy(g),r.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return t.smoothEndTick()}))}else r.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var r=t.pointer,a=t.event,d=t.eventTarget,h=this.interaction;h.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),h.updatePointer(r,a,d,!0),h._doPhase({interaction:h,event:a,phase:"resume"}),mt(h.coords.prev,h.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,U.cancel(this.timeout)}}]),i})();function si(i){var t=i.interactable,r=i.prepared;return t&&t.options&&r.name&&t.options[r.name].inertia}var Wr={id:"inertia",before:["modifiers","actions"],install:function(i){var t=i.defaults;i.usePlugin(sn),i.usePlugin(tn),i.actions.phases.inertiastart=!0,i.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(i){var t=i.interaction;t.inertia=new Yr(t)},"interactions:before-action-end":function(i){var t=i.interaction,r=i.event;return(!t._interacting||t.simulation||!t.inertia.start(r))&&null},"interactions:down":function(i){var t=i.interaction,r=i.eventTarget,a=t.inertia;if(a.active)for(var d=r;b.element(d);){if(d===t.element){a.resume(i);break}d=Me(d)}},"interactions:stop":function(i){var t=i.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(i){var t=i.interaction.modification;t.stop(i),t.start(i,i.interaction.coords.cur.page),t.applyToInteraction(i)},"interactions:before-action-inertiastart":function(i){return i.interaction.modification.setAndApply(i)},"interactions:action-resume":Ut,"interactions:action-inertiastart":Ut,"interactions:after-action-inertiastart":function(i){return i.interaction.modification.restoreInteractionCoords(i)},"interactions:after-action-resume":function(i){return i.interaction.modification.restoreInteractionCoords(i)}}};function ln(i,t,r,a){var d=1-i;return d*d*t+2*d*i*r+i*i*a}function cn(i,t,r,a){return-r*(i/=a)*(i-2)+t}var Ur=Wr;function dn(i,t){for(var r=0;r<t.length;r++){var a=t[r];if(i.immediatePropagationStopped)break;a(i)}}var un=(function(){function i(t){o(this,i),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=ie({},t||{})}return c(i,[{key:"fire",value:function(t){var r,a=this.global;(r=this.types[t.type])&&dn(t,r),!t.propagationStopped&&a&&(r=a[t.type])&&dn(t,r)}},{key:"on",value:function(t,r){var a=we(t,r);for(t in a)this.types[t]=me(this.types[t]||[],a[t])}},{key:"off",value:function(t,r){var a=we(t,r);for(t in a){var d=this.types[t];if(d&&d.length)for(var h=0,g=a[t];h<g.length;h++){var v=g[h],w=d.indexOf(v);w!==-1&&d.splice(w,1)}}}},{key:"getRect",value:function(t){return null}}]),i})(),Vr=(function(){function i(t){o(this,i),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,gt(this,t)}return c(i,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),i})();function Vt(i){return b.object(i)?{capture:!!i.capture,passive:!!i.passive}:{capture:!!i,passive:!1}}function li(i,t){return i===t||(typeof i=="boolean"?!!t.capture===i&&!t.passive:!!i.capture==!!t.capture&&!!i.passive==!!t.passive)}var Xr={id:"events",install:function(i){var t,r=[],a={},d=[],h={add:g,remove:v,addDelegate:function(k,M,R,$,j){var G=Vt(j);if(!a[R]){a[R]=[];for(var oe=0;oe<d.length;oe++){var ne=d[oe];g(ne,R,w),g(ne,R,A,!0)}}var ce=a[R],Ee=F(ce,(function(Ie){return Ie.selector===k&&Ie.context===M}));Ee||(Ee={selector:k,context:M,listeners:[]},ce.push(Ee)),Ee.listeners.push({func:$,options:G})},removeDelegate:function(k,M,R,$,j){var G,oe=Vt(j),ne=a[R],ce=!1;if(ne)for(G=ne.length-1;G>=0;G--){var Ee=ne[G];if(Ee.selector===k&&Ee.context===M){for(var Ie=Ee.listeners,ve=Ie.length-1;ve>=0;ve--){var Ce=Ie[ve];if(Ce.func===$&&li(Ce.options,oe)){Ie.splice(ve,1),Ie.length||(ne.splice(G,1),v(M,R,w),v(M,R,A,!0)),ce=!0;break}}if(ce)break}}},delegateListener:w,delegateUseCapture:A,delegatedEvents:a,documents:d,targets:r,supportsOptions:!1,supportsPassive:!1};function g(k,M,R,$){if(k.addEventListener){var j=Vt($),G=F(r,(function(oe){return oe.eventTarget===k}));G||(G={eventTarget:k,events:{}},r.push(G)),G.events[M]||(G.events[M]=[]),F(G.events[M],(function(oe){return oe.func===R&&li(oe.options,j)}))||(k.addEventListener(M,R,h.supportsOptions?j:j.capture),G.events[M].push({func:R,options:j}))}}function v(k,M,R,$){if(k.addEventListener&&k.removeEventListener){var j=ye(r,(function(ht){return ht.eventTarget===k})),G=r[j];if(G&&G.events)if(M!=="all"){var oe=!1,ne=G.events[M];if(ne){if(R==="all"){for(var ce=ne.length-1;ce>=0;ce--){var Ee=ne[ce];v(k,M,Ee.func,Ee.options)}return}for(var Ie=Vt($),ve=0;ve<ne.length;ve++){var Ce=ne[ve];if(Ce.func===R&&li(Ce.options,Ie)){k.removeEventListener(M,R,h.supportsOptions?Ie:Ie.capture),ne.splice(ve,1),ne.length===0&&(delete G.events[M],oe=!0);break}}}oe&&!Object.keys(G.events).length&&r.splice(j,1)}else for(M in G.events)G.events.hasOwnProperty(M)&&v(k,M,"all")}}function w(k,M){for(var R=Vt(M),$=new Vr(k),j=a[k.type],G=Y(k)[0],oe=G;b.element(oe);){for(var ne=0;ne<j.length;ne++){var ce=j[ne],Ee=ce.selector,Ie=ce.context;if(ge(oe,Ee)&&_e(Ie,G)&&_e(Ie,oe)){var ve=ce.listeners;$.currentTarget=oe;for(var Ce=0;Ce<ve.length;Ce++){var ht=ve[Ce];li(ht.options,R)&&ht.func($)}}}oe=Me(oe)}}function A(k){return w(k,!0)}return(t=i.document)==null||t.createElement("div").addEventListener("test",null,{get capture(){return h.supportsOptions=!0},get passive(){return h.supportsPassive=!0}}),i.events=h,h}},Ei={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(i){for(var t=0,r=Ei.methodOrder;t<r.length;t++){var a=r[t],d=Ei[a](i);if(d)return d}return null},simulationResume:function(i){var t=i.pointerType,r=i.eventType,a=i.eventTarget,d=i.scope;if(!/down|start/i.test(r))return null;for(var h=0,g=d.interactions.list;h<g.length;h++){var v=g[h],w=a;if(v.simulation&&v.simulation.allowResume&&v.pointerType===t)for(;w;){if(w===v.element)return v;w=Me(w)}}return null},mouseOrPen:function(i){var t,r=i.pointerId,a=i.pointerType,d=i.eventType,h=i.scope;if(a!=="mouse"&&a!=="pen")return null;for(var g=0,v=h.interactions.list;g<v.length;g++){var w=v[g];if(w.pointerType===a){if(w.simulation&&!pn(w,r))continue;if(w.interacting())return w;t||(t=w)}}if(t)return t;for(var A=0,k=h.interactions.list;A<k.length;A++){var M=k[A];if(!(M.pointerType!==a||/down/i.test(d)&&M.simulation))return M}return null},hasPointer:function(i){for(var t=i.pointerId,r=0,a=i.scope.interactions.list;r<a.length;r++){var d=a[r];if(pn(d,t))return d}return null},idle:function(i){for(var t=i.pointerType,r=0,a=i.scope.interactions.list;r<a.length;r++){var d=a[r];if(d.pointers.length===1){var h=d.interactable;if(h&&(!h.options.gesture||!h.options.gesture.enabled))continue}else if(d.pointers.length>=2)continue;if(!d.interacting()&&t===d.pointerType)return d}return null}};function pn(i,t){return i.pointers.some((function(r){return r.id===t}))}var Gr=Ei,Ci=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function hn(i,t){return function(r){var a=t.interactions.list,d=H(r),h=Y(r),g=h[0],v=h[1],w=[];if(/^touch/.test(r.type)){t.prevTouchTime=t.now();for(var A=0,k=r.changedTouches;A<k.length;A++){var M=k[A],R={pointer:M,pointerId:Ve(M),pointerType:d,eventType:r.type,eventTarget:g,curEventTarget:v,scope:t},$=fn(R);w.push([R.pointer,R.eventTarget,R.curEventTarget,$])}}else{var j=!1;if(!ue.supportsPointerEvent&&/mouse/.test(r.type)){for(var G=0;G<a.length&&!j;G++)j=a[G].pointerType!=="mouse"&&a[G].pointerIsDown;j=j||t.now()-t.prevTouchTime<500||r.timeStamp===0}if(!j){var oe={pointer:r,pointerId:Ve(r),pointerType:d,eventType:r.type,curEventTarget:v,eventTarget:g,scope:t},ne=fn(oe);w.push([oe.pointer,oe.eventTarget,oe.curEventTarget,ne])}}for(var ce=0;ce<w.length;ce++){var Ee=w[ce],Ie=Ee[0],ve=Ee[1],Ce=Ee[2];Ee[3][i](Ie,r,ve,Ce)}}}function fn(i){var t=i.pointerType,r=i.scope,a={interaction:Gr.search(i),searchDetails:i};return r.fire("interactions:find",a),a.interaction||r.interactions.new({pointerType:t})}function Ai(i,t){var r=i.doc,a=i.scope,d=i.options,h=a.interactions.docEvents,g=a.events,v=g[t];for(var w in a.browser.isIOS&&!d.events&&(d.events={passive:!1}),g.delegatedEvents)v(r,w,g.delegateListener),v(r,w,g.delegateUseCapture,!0);for(var A=d&&d.events,k=0;k<h.length;k++){var M=h[k];v(r,M.type,M.listener,A)}}var Jr={id:"core/interactions",install:function(i){for(var t={},r=0;r<Ci.length;r++){var a=Ci[r];t[a]=hn(a,i)}var d,h=ue.pEventTypes;function g(){for(var v=0,w=i.interactions.list;v<w.length;v++){var A=w[v];if(A.pointerIsDown&&A.pointerType==="touch"&&!A._interacting)for(var k=function(){var $=R[M];i.documents.some((function(j){return _e(j.doc,$.downTarget)}))||A.removePointer($.pointer,$.event)},M=0,R=A.pointers;M<R.length;M++)k()}}(d=X.PointerEvent?[{type:h.down,listener:g},{type:h.down,listener:t.pointerDown},{type:h.move,listener:t.pointerMove},{type:h.up,listener:t.pointerUp},{type:h.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:g},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(v){for(var w=0,A=i.interactions.list;w<A.length;w++)A[w].documentBlur(v)}}),i.prevTouchTime=0,i.Interaction=(function(v){u(A,v);var w=y(A);function A(){return o(this,A),w.apply(this,arguments)}return c(A,[{key:"pointerMoveTolerance",get:function(){return i.interactions.pointerMoveTolerance},set:function(k){i.interactions.pointerMoveTolerance=k}},{key:"_now",value:function(){return i.now()}}]),A})(jr),i.interactions={list:[],new:function(v){v.scopeFire=function(A,k){return i.fire(A,k)};var w=new i.Interaction(v);return i.interactions.list.push(w),w},listeners:t,docEvents:d,pointerMoveTolerance:1},i.usePlugin(en)},listeners:{"scope:add-document":function(i){return Ai(i,"add")},"scope:remove-document":function(i){return Ai(i,"remove")},"interactable:unset":function(i,t){for(var r=i.interactable,a=t.interactions.list.length-1;a>=0;a--){var d=t.interactions.list[a];d.interactable===r&&(d.stop(),t.fire("interactions:destroy",{interaction:d}),d.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(a,1))}}},onDocSignal:Ai,doOnInteractions:hn,methodNames:Ci},Qr=Jr,Mt=(function(i){return i[i.On=0]="On",i[i.Off=1]="Off",i})(Mt||{}),Zr=(function(){function i(t,r,a,d){o(this,i),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new un,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=r.actions,this.target=t,this._context=r.context||a,this._win=S(tt(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=d,this.set(r)}return c(i,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,r){return b.func(r.onstart)&&this.on("".concat(t,"start"),r.onstart),b.func(r.onmove)&&this.on("".concat(t,"move"),r.onmove),b.func(r.onend)&&this.on("".concat(t,"end"),r.onend),b.func(r.oninertiastart)&&this.on("".concat(t,"inertiastart"),r.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,r,a){var d,h=this,g=(d=this._actions.map[t])==null?void 0:d.filterEventType,v=function(w){return(g==null||g(w))&&oi(w,h._actions)};(b.array(r)||b.object(r))&&this._onOff(Mt.Off,t,r,void 0,v),(b.array(a)||b.object(a))&&this._onOff(Mt.On,t,a,void 0,v)}},{key:"setPerAction",value:function(t,r){var a=this._defaults;for(var d in r){var h=d,g=this.options[t],v=r[h];h==="listeners"&&this.updatePerActionListeners(t,g.listeners,v),b.array(v)?g[h]=ae(v):b.plainObject(v)?(g[h]=ie(g[h]||{},jt(v)),b.object(a.perAction[h])&&"enabled"in a.perAction[h]&&(g[h].enabled=v.enabled!==!1)):b.bool(v)&&b.object(a.perAction[h])?g[h].enabled=v:g[h]=v}}},{key:"getRect",value:function(t){return t=t||(b.element(this.target)?this.target:null),b.string(this.target)&&(t=t||this._context.querySelector(this.target)),st(t)}},{key:"rectChecker",value:function(t){var r=this;return b.func(t)?(this.getRect=function(a){var d=ie({},t.apply(r,a));return"width"in d||(d.width=d.right-d.left,d.height=d.bottom-d.top),d},this):t===null?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,r){if(tt(r)||b.object(r)){for(var a in this.options[t]=r,this._actions.map)this.options[a][t]=r;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return t==="page"||t==="client"?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return b.string(t)?Array.from(this._context.querySelectorAll(t)):b.func(t)&&t.getAllElements?t.getAllElements():b.element(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||_e(this._context,t)}},{key:"testIgnoreAllow",value:function(t,r,a){return!this.testIgnore(t.ignoreFrom,r,a)&&this.testAllow(t.allowFrom,r,a)}},{key:"testAllow",value:function(t,r,a){return!t||!!b.element(a)&&(b.string(t)?De(a,t,r):!!b.element(t)&&_e(t,a))}},{key:"testIgnore",value:function(t,r,a){return!(!t||!b.element(a))&&(b.string(t)?De(a,t,r):!!b.element(t)&&_e(t,a))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,r,a,d,h){b.object(r)&&!b.array(r)&&(d=a,a=null);var g=we(r,a,h);for(var v in g){v==="wheel"&&(v=ue.wheelEvent);for(var w=0,A=g[v];w<A.length;w++){var k=A[w];oi(v,this._actions)?this.events[t===Mt.On?"on":"off"](v,k):b.string(this.target)?this._scopeEvents[t===Mt.On?"addDelegate":"removeDelegate"](this.target,this._context,v,k,d):this._scopeEvents[t===Mt.On?"add":"remove"](this.target,v,k,d)}}return this}},{key:"on",value:function(t,r,a){return this._onOff(Mt.On,t,r,a)}},{key:"off",value:function(t,r,a){return this._onOff(Mt.Off,t,r,a)}},{key:"set",value:function(t){var r=this._defaults;for(var a in b.object(t)||(t={}),this.options=jt(r.base),this._actions.methodDict){var d=a,h=this._actions.methodDict[d];this.options[d]={},this.setPerAction(d,ie(ie({},r.perAction),r.actions[d])),this[h](t[d])}for(var g in t)g!=="getRect"?b.func(this[g])&&this[g](t[g]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(b.string(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var r=this._scopeEvents.delegatedEvents[t],a=r.length-1;a>=0;a--){var d=r[a],h=d.selector,g=d.context,v=d.listeners;h===this.target&&g===this._context&&r.splice(a,1);for(var w=v.length-1;w>=0;w--)this._scopeEvents.removeDelegate(this.target,this._context,t,v[w][0],v[w][1])}else this._scopeEvents.remove(this.target,"all")}}]),i})(),eo=(function(){function i(t){var r=this;o(this,i),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(a){var d=a.interactable,h=d.target,g=b.string(h)?r.selectorMap[h]:h[r.scope.id],v=ye(g,(function(w){return w===d}));g.splice(v,1)}})}return c(i,[{key:"new",value:function(t,r){r=ie(r||{},{actions:this.scope.actions});var a=new this.scope.Interactable(t,r,this.scope.document,this.scope.events);return this.scope.addDocument(a._doc),this.list.push(a),b.string(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(a)):(a.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(a)),this.scope.fire("interactable:new",{target:t,options:r,interactable:a,win:this.scope._win}),a}},{key:"getExisting",value:function(t,r){var a=r&&r.context||this.scope.document,d=b.string(t),h=d?this.selectorMap[t]:t[this.scope.id];if(h)return F(h,(function(g){return g._context===a&&(d||g.inContext(t))}))}},{key:"forEachMatch",value:function(t,r){for(var a=0,d=this.list;a<d.length;a++){var h=d[a],g=void 0;if((b.string(h.target)?b.element(t)&&ge(t,h.target):t===h.target)&&h.inContext(t)&&(g=r(h)),g!==void 0)return g}}}]),i})(),to=(function(){function i(){var t=this;o(this,i),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=ue,this.defaults=jt(nn),this.Eventable=un,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(function(a){var d=function h(g,v){var w=a.interactables.getExisting(g,v);return w||((w=a.interactables.new(g,v)).events.global=h.globalEvents),w};return d.getPointerAverage=Tt,d.getTouchBBox=fe,d.getTouchDistance=Be,d.getTouchAngle=Je,d.getElementRect=st,d.getElementClientRect=$e,d.matchesSelector=ge,d.closest=Ae,d.globalEvents={},d.version="1.10.27",d.scope=a,d.use=function(h,g){return this.scope.usePlugin(h,g),this},d.isSet=function(h,g){return!!this.scope.interactables.get(h,g&&g.context)},d.on=_t((function(h,g,v){if(b.string(h)&&h.search(" ")!==-1&&(h=h.trim().split(/ +/)),b.array(h)){for(var w=0,A=h;w<A.length;w++){var k=A[w];this.on(k,g,v)}return this}if(b.object(h)){for(var M in h)this.on(M,h[M],g);return this}return oi(h,this.scope.actions)?this.globalEvents[h]?this.globalEvents[h].push(g):this.globalEvents[h]=[g]:this.scope.events.add(this.scope.document,h,g,{options:v}),this}),"The interact.on() method is being deprecated"),d.off=_t((function(h,g,v){if(b.string(h)&&h.search(" ")!==-1&&(h=h.trim().split(/ +/)),b.array(h)){for(var w=0,A=h;w<A.length;w++){var k=A[w];this.off(k,g,v)}return this}if(b.object(h)){for(var M in h)this.off(M,h[M],g);return this}var R;return oi(h,this.scope.actions)?h in this.globalEvents&&(R=this.globalEvents[h].indexOf(g))!==-1&&this.globalEvents[h].splice(R,1):this.scope.events.remove(this.scope.document,h,g,v),this}),"The interact.off() method is being deprecated"),d.debug=function(){return this.scope},d.supportsTouch=function(){return ue.supportsTouch},d.supportsPointerEvent=function(){return ue.supportsPointerEvent},d.stop=function(){for(var h=0,g=this.scope.interactions.list;h<g.length;h++)g[h].stop();return this},d.pointerMoveTolerance=function(h){return b.number(h)?(this.scope.interactions.pointerMoveTolerance=h,this):this.scope.interactions.pointerMoveTolerance},d.addDocument=function(h,g){this.scope.addDocument(h,g)},d.removeDocument=function(h){this.scope.removeDocument(h)},d})(this),this.InteractEvent=ki,this.Interactable=void 0,this.interactables=new eo(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(a){return t.removeDocument(a.target)};var r=this;this.Interactable=(function(a){u(h,a);var d=y(h);function h(){return o(this,h),d.apply(this,arguments)}return c(h,[{key:"_defaults",get:function(){return r.defaults}},{key:"set",value:function(g){return _(f(h.prototype),"set",this).call(this,g),r.fire("interactable:set",{options:g,interactable:this}),this}},{key:"unset",value:function(){_(f(h.prototype),"unset",this).call(this);var g=r.interactables.list.indexOf(this);g<0||(r.interactables.list.splice(g,1),r.fire("interactable:unset",{interactable:this}))}}]),h})(Zr)}return c(i,[{key:"addListeners",value:function(t,r){this.listenerMaps.push({id:r,map:t})}},{key:"fire",value:function(t,r){for(var a=0,d=this.listenerMaps;a<d.length;a++){var h=d[a].map[t];if(h&&h(r,this,t)===!1)return!1}}},{key:"init",value:function(t){return this.isInitialized?this:(function(r,a){return r.isInitialized=!0,b.window(a)&&I(a),X.init(a),ue.init(a),U.init(a),r.window=a,r.document=a.document,r.usePlugin(Qr),r.usePlugin(Xr),r})(this,t)}},{key:"pluginIsInstalled",value:function(t){var r=t.id;return r?!!this._plugins.map[r]:this._plugins.list.indexOf(t)!==-1}},{key:"usePlugin",value:function(t,r){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,r),t.listeners&&t.before){for(var a=0,d=this.listenerMaps.length,h=t.before.reduce((function(v,w){return v[w]=!0,v[gn(w)]=!0,v}),{});a<d;a++){var g=this.listenerMaps[a].id;if(g&&(h[g]||h[gn(g)]))break}this.listenerMaps.splice(a,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,r){if(this.getDocIndex(t)!==-1)return!1;var a=S(t);r=r?ie({},r):{},this.documents.push({doc:t,options:r}),this.events.documents.push(t),t!==this.document&&this.events.add(a,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:a,scope:this,options:r})}},{key:"removeDocument",value:function(t){var r=this.getDocIndex(t),a=S(t),d=this.documents[r].options;this.events.remove(a,"unload",this.onWindowUnload),this.documents.splice(r,1),this.events.documents.splice(r,1),this.fire("scope:remove-document",{doc:t,window:a,scope:this,options:d})}},{key:"getDocIndex",value:function(t){for(var r=0;r<this.documents.length;r++)if(this.documents[r].doc===t)return r;return-1}},{key:"getDocOptions",value:function(t){var r=this.getDocIndex(t);return r===-1?null:this.documents[r].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),i})();function gn(i){return i&&i.replace(/\/.*$/,"")}var mn=new to,pt=mn.interactStatic,io=typeof globalThis!="undefined"?globalThis:window;mn.init(io);var no=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(i){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(a){var d=a[0],h=a[1];return d in i||h in i})),r=function(a,d){for(var h=i.range,g=i.limits,v=g===void 0?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:g,w=i.offset,A=w===void 0?{x:0,y:0}:w,k={range:h,grid:i,x:null,y:null},M=0;M<t.length;M++){var R=t[M],$=R[0],j=R[1],G=Math.round((a-A.x)/i[$]),oe=Math.round((d-A.y)/i[j]);k[$]=Math.max(v.left,Math.min(v.right,G*i[$]+A.x)),k[j]=Math.max(v.top,Math.min(v.bottom,oe*i[j]+A.y))}return k};return r.grid=i,r.coordFields=t,r}}),ro={id:"snappers",install:function(i){var t=i.interactStatic;t.snappers=ie(t.snappers||{},no),t.createSnapGrid=t.snappers.grid}},oo=ro,ao={start:function(i){var t=i.state,r=i.rect,a=i.edges,d=i.pageCoords,h=t.options,g=h.ratio,v=h.enabled,w=t.options,A=w.equalDelta,k=w.modifiers;g==="preserve"&&(g=r.width/r.height),t.startCoords=ie({},d),t.startRect=ie({},r),t.ratio=g,t.equalDelta=A;var M=t.linkedEdges={top:a.top||a.left&&!a.bottom,left:a.left||a.top&&!a.right,bottom:a.bottom||a.right&&!a.top,right:a.right||a.bottom&&!a.left};if(t.xIsPrimaryAxis=!(!a.left&&!a.right),t.equalDelta){var R=(M.left?1:-1)*(M.top?1:-1);t.edgeSign={x:R,y:R}}else t.edgeSign={x:M.left?-1:1,y:M.top?-1:1};if(v!==!1&&ie(a,M),k!=null&&k.length){var $=new wi(i.interaction);$.copyFrom(i.interaction.modification),$.prepareStates(k),t.subModification=$,$.startAll(p({},i))}},set:function(i){var t=i.state,r=i.rect,a=i.coords,d=t.linkedEdges,h=ie({},a),g=t.equalDelta?so:lo;if(ie(i.edges,d),g(t,t.xIsPrimaryAxis,a,r),!t.subModification)return null;var v=ie({},r);ze(d,v,{x:a.x-h.x,y:a.y-h.y});var w=t.subModification.setAll(p(p({},i),{},{rect:v,edges:d,pageCoords:a,prevCoords:a,prevRect:v})),A=w.delta;return w.changed&&(g(t,Math.abs(A.x)>Math.abs(A.y),w.coords,w.rect),ie(a,w.coords)),w.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function so(i,t,r){var a=i.startCoords,d=i.edgeSign;t?r.y=a.y+(r.x-a.x)*d.y:r.x=a.x+(r.y-a.y)*d.x}function lo(i,t,r,a){var d=i.startRect,h=i.startCoords,g=i.ratio,v=i.edgeSign;if(t){var w=a.width/g;r.y=h.y+(w-d.height)*v.y}else{var A=a.height*g;r.x=h.x+(A-d.width)*v.x}}var co=zt(ao,"aspectRatio"),yn=function(){};yn._defaults={};var ci=yn;function Ft(i,t,r){return b.func(i)?Ze(i,t.interactable,t.element,[r.x,r.y,t]):Ze(i,t.interactable,t.element)}var di={start:function(i){var t=i.rect,r=i.startOffset,a=i.state,d=i.interaction,h=i.pageCoords,g=a.options,v=g.elementRect,w=ie({left:0,top:0,right:0,bottom:0},g.offset||{});if(t&&v){var A=Ft(g.restriction,d,h);if(A){var k=A.right-A.left-t.width,M=A.bottom-A.top-t.height;k<0&&(w.left+=k,w.right+=k),M<0&&(w.top+=M,w.bottom+=M)}w.left+=r.left-t.width*v.left,w.top+=r.top-t.height*v.top,w.right+=r.right-t.width*(1-v.right),w.bottom+=r.bottom-t.height*(1-v.bottom)}a.offset=w},set:function(i){var t=i.coords,r=i.interaction,a=i.state,d=a.options,h=a.offset,g=Ft(d.restriction,r,t);if(g){var v=(function(w){return!w||"left"in w&&"top"in w||((w=ie({},w)).left=w.x||0,w.top=w.y||0,w.right=w.right||w.left+w.width,w.bottom=w.bottom||w.top+w.height),w})(g);t.x=Math.max(Math.min(v.right-h.right,t.x),v.left+h.left),t.y=Math.max(Math.min(v.bottom-h.bottom,t.y),v.top+h.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},uo=zt(di,"restrict"),vn={top:1/0,left:1/0,bottom:-1/0,right:-1/0},bn={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function xn(i,t){for(var r=0,a=["top","left","bottom","right"];r<a.length;r++){var d=a[r];d in i||(i[d]=t[d])}return i}var Xt={noInner:vn,noOuter:bn,start:function(i){var t,r=i.interaction,a=i.startOffset,d=i.state,h=d.options;h&&(t=Te(Ft(h.offset,r,r.coords.start.page))),t=t||{x:0,y:0},d.offset={top:t.y+a.top,left:t.x+a.left,bottom:t.y-a.bottom,right:t.x-a.right}},set:function(i){var t=i.coords,r=i.edges,a=i.interaction,d=i.state,h=d.offset,g=d.options;if(r){var v=ie({},t),w=Ft(g.inner,a,v)||{},A=Ft(g.outer,a,v)||{};xn(w,vn),xn(A,bn),r.top?t.y=Math.min(Math.max(A.top+h.top,v.y),w.top+h.top):r.bottom&&(t.y=Math.max(Math.min(A.bottom+h.bottom,v.y),w.bottom+h.bottom)),r.left?t.x=Math.min(Math.max(A.left+h.left,v.x),w.left+h.left):r.right&&(t.x=Math.max(Math.min(A.right+h.right,v.x),w.right+h.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},po=zt(Xt,"restrictEdges"),ho=ie({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(i){}},di.defaults),fo=zt({start:di.start,set:di.set,defaults:ho},"restrictRect"),go={width:-1/0,height:-1/0},mo={width:1/0,height:1/0},yo=zt({start:function(i){return Xt.start(i)},set:function(i){var t=i.interaction,r=i.state,a=i.rect,d=i.edges,h=r.options;if(d){var g=Z(Ft(h.min,t,i.coords))||go,v=Z(Ft(h.max,t,i.coords))||mo;r.options={endOnly:h.endOnly,inner:ie({},Xt.noInner),outer:ie({},Xt.noOuter)},d.top?(r.options.inner.top=a.bottom-g.height,r.options.outer.top=a.bottom-v.height):d.bottom&&(r.options.inner.bottom=a.top+g.height,r.options.outer.bottom=a.top+v.height),d.left?(r.options.inner.left=a.right-g.width,r.options.outer.left=a.right-v.width):d.right&&(r.options.inner.right=a.left+g.width,r.options.outer.right=a.left+v.width),Xt.set(i),r.options=h}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),Oi={start:function(i){var t,r=i.interaction,a=i.interactable,d=i.element,h=i.rect,g=i.state,v=i.startOffset,w=g.options,A=w.offsetWithOrigin?(function(R){var $=R.interaction.element,j=Te(Ze(R.state.options.origin,null,null,[$])),G=j||ke(R.interactable,$,R.interaction.prepared.name);return G})(i):{x:0,y:0};if(w.offset==="startCoords")t={x:r.coords.start.page.x,y:r.coords.start.page.y};else{var k=Ze(w.offset,a,d,[r]);(t=Te(k)||{x:0,y:0}).x+=A.x,t.y+=A.y}var M=w.relativePoints;g.offsets=h&&M&&M.length?M.map((function(R,$){return{index:$,relativePoint:R,x:v.left-h.width*R.x+t.x,y:v.top-h.height*R.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(i){var t=i.interaction,r=i.coords,a=i.state,d=a.options,h=a.offsets,g=ke(t.interactable,t.element,t.prepared.name),v=ie({},r),w=[];d.offsetWithOrigin||(v.x-=g.x,v.y-=g.y);for(var A=0,k=h;A<k.length;A++)for(var M=k[A],R=v.x-M.x,$=v.y-M.y,j=0,G=d.targets.length;j<G;j++){var oe=d.targets[j],ne=void 0;(ne=b.func(oe)?oe(R,$,t._proxy,M,j):oe)&&w.push({x:(b.number(ne.x)?ne.x:R)+M.x,y:(b.number(ne.y)?ne.y:$)+M.y,range:b.number(ne.range)?ne.range:d.range,source:oe,index:j,offset:M})}for(var ce={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},Ee=0;Ee<w.length;Ee++){var Ie=w[Ee],ve=Ie.range,Ce=Ie.x-v.x,ht=Ie.y-v.y,Ue=nt(Ce,ht),bt=Ue<=ve;ve===1/0&&ce.inRange&&ce.range!==1/0&&(bt=!1),ce.target&&!(bt?ce.inRange&&ve!==1/0?Ue/ve<ce.distance/ce.range:ve===1/0&&ce.range!==1/0||Ue<ce.distance:!ce.inRange&&Ue<ce.distance)||(ce.target=Ie,ce.distance=Ue,ce.range=ve,ce.inRange=bt,ce.delta.x=Ce,ce.delta.y=ht)}return ce.inRange&&(r.x=ce.target.x,r.y=ce.target.y),a.closest=ce,ce},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},vo=zt(Oi,"snap"),ui={start:function(i){var t=i.state,r=i.edges,a=t.options;if(!r)return null;i.state={options:{targets:null,relativePoints:[{x:r.left?0:1,y:r.top?0:1}],offset:a.offset||"self",origin:{x:0,y:0},range:a.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],Oi.start(i),t.offsets=i.state.offsets,i.state=t},set:function(i){var t=i.interaction,r=i.state,a=i.coords,d=r.options,h=r.offsets,g={x:a.x-h[0].x,y:a.y-h[0].y};r.options=ie({},d),r.options.targets=[];for(var v=0,w=d.targets||[];v<w.length;v++){var A=w[v],k=void 0;if(k=b.func(A)?A(g.x,g.y,t):A){for(var M=0,R=r.targetFields;M<R.length;M++){var $=R[M],j=$[0],G=$[1];if(j in k||G in k){k.x=k[j],k.y=k[G];break}}r.options.targets.push(k)}}var oe=Oi.set(i);return r.options=d,oe},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},bo=zt(ui,"snapSize"),Ti={aspectRatio:co,restrictEdges:po,restrict:uo,restrictRect:fo,restrictSize:yo,snapEdges:zt({start:function(i){var t=i.edges;return t?(i.state.targetFields=i.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],ui.start(i)):null},set:ui.set,defaults:ie(jt(ui.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:vo,snapSize:bo,spring:ci,avoid:ci,transform:ci,rubberband:ci},xo={id:"modifiers",install:function(i){var t=i.interactStatic;for(var r in i.usePlugin(tn),i.usePlugin(oo),t.modifiers=Ti,Ti){var a=Ti[r],d=a._defaults,h=a._methods;d._methods=h,i.defaults.perAction[r]=d}}},_o=xo,_n=(function(i){u(r,i);var t=y(r);function r(a,d,h,g,v,w){var A;if(o(this,r),gt(m(A=t.call(this,v)),h),h!==d&&gt(m(A),d),A.timeStamp=w,A.originalEvent=h,A.type=a,A.pointerId=Ve(d),A.pointerType=H(d),A.target=g,A.currentTarget=null,a==="tap"){var k=v.getPointerIndex(d);A.dt=A.timeStamp-v.pointers[k].downTime;var M=A.timeStamp-v.tapTime;A.double=!!v.prevTap&&v.prevTap.type!=="doubletap"&&v.prevTap.target===A.target&&M<500}else a==="doubletap"&&(A.dt=d.timeStamp-v.tapTime,A.double=!0);return A}return c(r,[{key:"_subtractOrigin",value:function(a){var d=a.x,h=a.y;return this.pageX-=d,this.pageY-=h,this.clientX-=d,this.clientY-=h,this}},{key:"_addOrigin",value:function(a){var d=a.x,h=a.y;return this.pageX+=d,this.pageY+=h,this.clientX+=d,this.clientY+=h,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),r})(he),Gt={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(i){i.pointerEvents=Gt,i.defaults.actions.pointerEvents=Gt.defaults,ie(i.actions.phaselessTypes,Gt.types)},listeners:{"interactions:new":function(i){var t=i.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(i){var t=i.down,r=i.pointerInfo;!t&&r.hold||(r.hold={duration:1/0,timeout:null})},"interactions:move":function(i,t){var r=i.interaction,a=i.pointer,d=i.event,h=i.eventTarget;i.duplicate||r.pointerIsDown&&!r.pointerWasMoved||(r.pointerIsDown&&zi(i),Pt({interaction:r,pointer:a,event:d,eventTarget:h,type:"move"},t))},"interactions:down":function(i,t){(function(r,a){for(var d=r.interaction,h=r.pointer,g=r.event,v=r.eventTarget,w=r.pointerIndex,A=d.pointers[w].hold,k=lt(v),M={interaction:d,pointer:h,event:g,eventTarget:v,type:"hold",targets:[],path:k,node:null},R=0;R<k.length;R++){var $=k[R];M.node=$,a.fire("pointerEvents:collect-targets",M)}if(M.targets.length){for(var j=1/0,G=0,oe=M.targets;G<oe.length;G++){var ne=oe[G].eventable.options.holdDuration;ne<j&&(j=ne)}A.duration=j,A.timeout=setTimeout((function(){Pt({interaction:d,eventTarget:v,pointer:h,event:g,type:"hold"},a)}),j)}})(i,t),Pt(i,t)},"interactions:up":function(i,t){zi(i),Pt(i,t),(function(r,a){var d=r.interaction,h=r.pointer,g=r.event,v=r.eventTarget;d.pointerWasMoved||Pt({interaction:d,eventTarget:v,pointer:h,event:g,type:"tap"},a)})(i,t)},"interactions:cancel":function(i,t){zi(i),Pt(i,t)}},PointerEvent:_n,fire:Pt,collectEventTargets:wn,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function Pt(i,t){var r=i.interaction,a=i.pointer,d=i.event,h=i.eventTarget,g=i.type,v=i.targets,w=v===void 0?wn(i,t):v,A=new _n(g,a,d,h,r,t.now());t.fire("pointerEvents:new",{pointerEvent:A});for(var k={interaction:r,pointer:a,event:d,eventTarget:h,targets:w,type:g,pointerEvent:A},M=0;M<w.length;M++){var R=w[M];for(var $ in R.props||{})A[$]=R.props[$];var j=ke(R.eventable,R.node);if(A._subtractOrigin(j),A.eventable=R.eventable,A.currentTarget=R.node,R.eventable.fire(A),A._addOrigin(j),A.immediatePropagationStopped||A.propagationStopped&&M+1<w.length&&w[M+1].node!==A.currentTarget)break}if(t.fire("pointerEvents:fired",k),g==="tap"){var G=A.double?Pt({interaction:r,pointer:a,event:d,eventTarget:h,type:"doubletap"},t):A;r.prevTap=G,r.tapTime=G.timeStamp}return A}function wn(i,t){var r=i.interaction,a=i.pointer,d=i.event,h=i.eventTarget,g=i.type,v=r.getPointerIndex(a),w=r.pointers[v];if(g==="tap"&&(r.pointerWasMoved||!w||w.downTarget!==h))return[];for(var A=lt(h),k={interaction:r,pointer:a,event:d,eventTarget:h,type:g,path:A,targets:[],node:null},M=0;M<A.length;M++){var R=A[M];k.node=R,t.fire("pointerEvents:collect-targets",k)}return g==="hold"&&(k.targets=k.targets.filter((function($){var j,G;return $.eventable.options.holdDuration===((j=r.pointers[v])==null||(G=j.hold)==null?void 0:G.duration)}))),k.targets}function zi(i){var t=i.interaction,r=i.pointerIndex,a=t.pointers[r].hold;a&&a.timeout&&(clearTimeout(a.timeout),a.timeout=null)}var wo=Object.freeze({__proto__:null,default:Gt});function ko(i){var t=i.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var So={id:"pointer-events/holdRepeat",install:function(i){i.usePlugin(Gt);var t=i.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=i.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(i,t){return i["pointerEvents:".concat(t)]=ko,i}),{"pointerEvents:new":function(i){var t=i.pointerEvent;t.type==="hold"&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(i,t){var r=i.interaction,a=i.pointerEvent,d=i.eventTarget,h=i.targets;if(a.type==="hold"&&h.length){var g=h[0].eventable.options.holdRepeatInterval;g<=0||(r.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:r,eventTarget:d,type:"hold",pointer:a,event:a},t)}),g))}}})},Eo=So,Co={id:"pointer-events/interactableTargets",install:function(i){var t=i.Interactable;t.prototype.pointerEvents=function(a){return ie(this.events.options,a),this};var r=t.prototype._backCompatOption;t.prototype._backCompatOption=function(a,d){var h=r.call(this,a,d);return h===this&&(this.events.options[a]=d),h}},listeners:{"pointerEvents:collect-targets":function(i,t){var r=i.targets,a=i.node,d=i.type,h=i.eventTarget;t.interactables.forEachMatch(a,(function(g){var v=g.events,w=v.options;v.types[d]&&v.types[d].length&&g.testIgnoreAllow(w,a,h)&&r.push({node:a,eventable:v,props:{interactable:g}})}))},"interactable:new":function(i){var t=i.interactable;t.events.getRect=function(r){return t.getRect(r)}},"interactable:set":function(i,t){var r=i.interactable,a=i.options;ie(r.events.options,t.pointerEvents.defaults),ie(r.events.options,a.pointerEvents||{})}}},Ao=Co,Oo={id:"pointer-events",install:function(i){i.usePlugin(wo),i.usePlugin(Eo),i.usePlugin(Ao)}},To=Oo,zo={id:"reflow",install:function(i){var t=i.Interactable;i.actions.phases.reflow=!0,t.prototype.reflow=function(r){return(function(a,d,h){for(var g=a.getAllElements(),v=h.window.Promise,w=v?[]:null,A=function(){var M=g[k],R=a.getRect(M);if(!R)return 1;var $,j=F(h.interactions.list,(function(ne){return ne.interacting()&&ne.interactable===a&&ne.element===M&&ne.prepared.name===d.name}));if(j)j.move(),w&&($=j._reflowPromise||new v((function(ne){j._reflowResolve=ne})));else{var G=Z(R),oe=(function(ne){return{coords:ne,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}})({page:{x:G.x,y:G.y},client:{x:G.x,y:G.y},timeStamp:h.now()});$=(function(ne,ce,Ee,Ie,ve){var Ce=ne.interactions.new({pointerType:"reflow"}),ht={interaction:Ce,event:ve,pointer:ve,eventTarget:Ee,phase:"reflow"};Ce.interactable=ce,Ce.element=Ee,Ce.prevEvent=ve,Ce.updatePointer(ve,ve,Ee,!0),Fe(Ce.coords.delta),Ht(Ce.prepared,Ie),Ce._doPhase(ht);var Ue=ne.window,bt=Ue.Promise,wt=bt?new bt((function(Ct){Ce._reflowResolve=Ct})):void 0;return Ce._reflowPromise=wt,Ce.start(Ie,ce,Ee),Ce._interacting?(Ce.move(ht),Ce.end(ve)):(Ce.stop(),Ce._reflowResolve()),Ce.removePointer(ve,ve),wt})(h,a,M,d,oe)}w&&w.push($)},k=0;k<g.length&&!A();k++);return w&&v.all(w).then((function(){return a}))})(this,r,i)}},listeners:{"interactions:stop":function(i,t){var r=i.interaction;r.pointerType==="reflow"&&(r._reflowResolve&&r._reflowResolve(),(function(a,d){a.splice(a.indexOf(d),1)})(t.interactions.list,r))}}},Mo=zo;if(pt.use(en),pt.use(sn),pt.use(To),pt.use(Ur),pt.use(_o),pt.use(Dr),pt.use(te),pt.use(Et),pt.use(Mo),pt.default=pt,(typeof Bt=="undefined"?"undefined":n(Bt))==="object"&&Bt)try{Bt.exports=pt}catch{}return pt.default=pt,pt}))});var Or=qo(Sn(),1);function qn(e){return typeof e=="undefined"||e===null}function Ho(e){return typeof e=="object"&&e!==null}function jo(e){return Array.isArray(e)?e:qn(e)?[]:[e]}function Ko(e,p){var n,o,s,c;if(p)for(c=Object.keys(p),n=0,o=c.length;n<o;n+=1)s=c[n],e[s]=p[s];return e}function $o(e,p){var n="",o;for(o=0;o<p;o+=1)n+=e;return n}function Yo(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Wo=qn,Uo=Ho,Vo=jo,Xo=$o,Go=Yo,Jo=Ko,at={isNothing:Wo,isObject:Uo,toArray:Vo,repeat:Xo,isNegativeZero:Go,extend:Jo};function Hn(e,p){var n="",o=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!p&&e.mark.snippet&&(n+=`

`+e.mark.snippet),o+" "+n):o}function Zt(e,p){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=p,this.message=Hn(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Zt.prototype=Object.create(Error.prototype);Zt.prototype.constructor=Zt;Zt.prototype.toString=function(p){return this.name+": "+Hn(this,p)};var ft=Zt;function Li(e,p,n,o,s){var c="",l="",u=Math.floor(s/2)-1;return o-p>u&&(c=" ... ",p=o-u+c.length),n-o>u&&(l=" ...",n=o+u-l.length),{str:c+e.slice(p,n).replace(/\t/g,"\u2192")+l,pos:o-p+c.length}}function Ii(e,p){return at.repeat(" ",p-e.length)+e}function Qo(e,p){if(p=Object.create(p||null),!e.buffer)return null;p.maxLength||(p.maxLength=79),typeof p.indent!="number"&&(p.indent=1),typeof p.linesBefore!="number"&&(p.linesBefore=3),typeof p.linesAfter!="number"&&(p.linesAfter=2);for(var n=/\r?\n|\r|\0/g,o=[0],s=[],c,l=-1;c=n.exec(e.buffer);)s.push(c.index),o.push(c.index+c[0].length),e.position<=c.index&&l<0&&(l=o.length-2);l<0&&(l=o.length-1);var u="",f,x,m=Math.min(e.line+p.linesAfter,s.length).toString().length,y=p.maxLength-(p.indent+m+3);for(f=1;f<=p.linesBefore&&!(l-f<0);f++)x=Li(e.buffer,o[l-f],s[l-f],e.position-(o[l]-o[l-f]),y),u=at.repeat(" ",p.indent)+Ii((e.line-f+1).toString(),m)+" | "+x.str+`
`+u;for(x=Li(e.buffer,o[l],s[l],e.position,y),u+=at.repeat(" ",p.indent)+Ii((e.line+1).toString(),m)+" | "+x.str+`
`,u+=at.repeat("-",p.indent+m+3+x.pos)+`^
`,f=1;f<=p.linesAfter&&!(l+f>=s.length);f++)x=Li(e.buffer,o[l+f],s[l+f],e.position-(o[l]-o[l+f]),y),u+=at.repeat(" ",p.indent)+Ii((e.line+f+1).toString(),m)+" | "+x.str+`
`;return u.replace(/\n$/,"")}var Zo=Qo,ea=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],ta=["scalar","sequence","mapping"];function ia(e){var p={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(o){p[String(o)]=n})}),p}function na(e,p){if(p=p||{},Object.keys(p).forEach(function(n){if(ea.indexOf(n)===-1)throw new ft('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=p,this.tag=e,this.kind=p.kind||null,this.resolve=p.resolve||function(){return!0},this.construct=p.construct||function(n){return n},this.instanceOf=p.instanceOf||null,this.predicate=p.predicate||null,this.represent=p.represent||null,this.representName=p.representName||null,this.defaultStyle=p.defaultStyle||null,this.multi=p.multi||!1,this.styleAliases=ia(p.styleAliases||null),ta.indexOf(this.kind)===-1)throw new ft('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var ct=na;function En(e,p){var n=[];return e[p].forEach(function(o){var s=n.length;n.forEach(function(c,l){c.tag===o.tag&&c.kind===o.kind&&c.multi===o.multi&&(s=l)}),n[s]=o}),n}function ra(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},p,n;function o(s){s.multi?(e.multi[s.kind].push(s),e.multi.fallback.push(s)):e[s.kind][s.tag]=e.fallback[s.tag]=s}for(p=0,n=arguments.length;p<n;p+=1)arguments[p].forEach(o);return e}function Ri(e){return this.extend(e)}Ri.prototype.extend=function(p){var n=[],o=[];if(p instanceof ct)o.push(p);else if(Array.isArray(p))o=o.concat(p);else if(p&&(Array.isArray(p.implicit)||Array.isArray(p.explicit)))p.implicit&&(n=n.concat(p.implicit)),p.explicit&&(o=o.concat(p.explicit));else throw new ft("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(c){if(!(c instanceof ct))throw new ft("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(c.loadKind&&c.loadKind!=="scalar")throw new ft("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(c.multi)throw new ft("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),o.forEach(function(c){if(!(c instanceof ct))throw new ft("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var s=Object.create(Ri.prototype);return s.implicit=(this.implicit||[]).concat(n),s.explicit=(this.explicit||[]).concat(o),s.compiledImplicit=En(s,"implicit"),s.compiledExplicit=En(s,"explicit"),s.compiledTypeMap=ra(s.compiledImplicit,s.compiledExplicit),s};var jn=Ri,Kn=new ct("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),$n=new ct("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Yn=new ct("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Wn=new jn({explicit:[Kn,$n,Yn]});function oa(e){if(e===null)return!0;var p=e.length;return p===1&&e==="~"||p===4&&(e==="null"||e==="Null"||e==="NULL")}function aa(){return null}function sa(e){return e===null}var Un=new ct("tag:yaml.org,2002:null",{kind:"scalar",resolve:oa,construct:aa,predicate:sa,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function la(e){if(e===null)return!1;var p=e.length;return p===4&&(e==="true"||e==="True"||e==="TRUE")||p===5&&(e==="false"||e==="False"||e==="FALSE")}function ca(e){return e==="true"||e==="True"||e==="TRUE"}function da(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Vn=new ct("tag:yaml.org,2002:bool",{kind:"scalar",resolve:la,construct:ca,predicate:da,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ua(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function pa(e){return 48<=e&&e<=55}function ha(e){return 48<=e&&e<=57}function fa(e){if(e===null)return!1;var p=e.length,n=0,o=!1,s;if(!p)return!1;if(s=e[n],(s==="-"||s==="+")&&(s=e[++n]),s==="0"){if(n+1===p)return!0;if(s=e[++n],s==="b"){for(n++;n<p;n++)if(s=e[n],s!=="_"){if(s!=="0"&&s!=="1")return!1;o=!0}return o&&s!=="_"}if(s==="x"){for(n++;n<p;n++)if(s=e[n],s!=="_"){if(!ua(e.charCodeAt(n)))return!1;o=!0}return o&&s!=="_"}if(s==="o"){for(n++;n<p;n++)if(s=e[n],s!=="_"){if(!pa(e.charCodeAt(n)))return!1;o=!0}return o&&s!=="_"}}if(s==="_")return!1;for(;n<p;n++)if(s=e[n],s!=="_"){if(!ha(e.charCodeAt(n)))return!1;o=!0}return!(!o||s==="_")}function ga(e){var p=e,n=1,o;if(p.indexOf("_")!==-1&&(p=p.replace(/_/g,"")),o=p[0],(o==="-"||o==="+")&&(o==="-"&&(n=-1),p=p.slice(1),o=p[0]),p==="0")return 0;if(o==="0"){if(p[1]==="b")return n*parseInt(p.slice(2),2);if(p[1]==="x")return n*parseInt(p.slice(2),16);if(p[1]==="o")return n*parseInt(p.slice(2),8)}return n*parseInt(p,10)}function ma(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!at.isNegativeZero(e)}var Xn=new ct("tag:yaml.org,2002:int",{kind:"scalar",resolve:fa,construct:ga,predicate:ma,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ya=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function va(e){return!(e===null||!ya.test(e)||e[e.length-1]==="_")}function ba(e){var p,n;return p=e.replace(/_/g,"").toLowerCase(),n=p[0]==="-"?-1:1,"+-".indexOf(p[0])>=0&&(p=p.slice(1)),p===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:p===".nan"?NaN:n*parseFloat(p,10)}var xa=/^[-+]?[0-9]+e/;function _a(e,p){var n;if(isNaN(e))switch(p){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(p){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(p){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(at.isNegativeZero(e))return"-0.0";return n=e.toString(10),xa.test(n)?n.replace("e",".e"):n}function wa(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||at.isNegativeZero(e))}var Gn=new ct("tag:yaml.org,2002:float",{kind:"scalar",resolve:va,construct:ba,predicate:wa,represent:_a,defaultStyle:"lowercase"}),Jn=Wn.extend({implicit:[Un,Vn,Xn,Gn]}),Qn=Jn,Zn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),er=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function ka(e){return e===null?!1:Zn.exec(e)!==null||er.exec(e)!==null}function Sa(e){var p,n,o,s,c,l,u,f=0,x=null,m,y,_;if(p=Zn.exec(e),p===null&&(p=er.exec(e)),p===null)throw new Error("Date resolve error");if(n=+p[1],o=+p[2]-1,s=+p[3],!p[4])return new Date(Date.UTC(n,o,s));if(c=+p[4],l=+p[5],u=+p[6],p[7]){for(f=p[7].slice(0,3);f.length<3;)f+="0";f=+f}return p[9]&&(m=+p[10],y=+(p[11]||0),x=(m*60+y)*6e4,p[9]==="-"&&(x=-x)),_=new Date(Date.UTC(n,o,s,c,l,u,f)),x&&_.setTime(_.getTime()-x),_}function Ea(e){return e.toISOString()}var tr=new ct("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:ka,construct:Sa,instanceOf:Date,represent:Ea});function Ca(e){return e==="<<"||e===null}var ir=new ct("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Ca}),Hi=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Aa(e){if(e===null)return!1;var p,n,o=0,s=e.length,c=Hi;for(n=0;n<s;n++)if(p=c.indexOf(e.charAt(n)),!(p>64)){if(p<0)return!1;o+=6}return o%8===0}function Oa(e){var p,n,o=e.replace(/[\r\n=]/g,""),s=o.length,c=Hi,l=0,u=[];for(p=0;p<s;p++)p%4===0&&p&&(u.push(l>>16&255),u.push(l>>8&255),u.push(l&255)),l=l<<6|c.indexOf(o.charAt(p));return n=s%4*6,n===0?(u.push(l>>16&255),u.push(l>>8&255),u.push(l&255)):n===18?(u.push(l>>10&255),u.push(l>>2&255)):n===12&&u.push(l>>4&255),new Uint8Array(u)}function Ta(e){var p="",n=0,o,s,c=e.length,l=Hi;for(o=0;o<c;o++)o%3===0&&o&&(p+=l[n>>18&63],p+=l[n>>12&63],p+=l[n>>6&63],p+=l[n&63]),n=(n<<8)+e[o];return s=c%3,s===0?(p+=l[n>>18&63],p+=l[n>>12&63],p+=l[n>>6&63],p+=l[n&63]):s===2?(p+=l[n>>10&63],p+=l[n>>4&63],p+=l[n<<2&63],p+=l[64]):s===1&&(p+=l[n>>2&63],p+=l[n<<4&63],p+=l[64],p+=l[64]),p}function za(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var nr=new ct("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Aa,construct:Oa,predicate:za,represent:Ta}),Ma=Object.prototype.hasOwnProperty,Pa=Object.prototype.toString;function La(e){if(e===null)return!0;var p=[],n,o,s,c,l,u=e;for(n=0,o=u.length;n<o;n+=1){if(s=u[n],l=!1,Pa.call(s)!=="[object Object]")return!1;for(c in s)if(Ma.call(s,c))if(!l)l=!0;else return!1;if(!l)return!1;if(p.indexOf(c)===-1)p.push(c);else return!1}return!0}function Ia(e){return e!==null?e:[]}var rr=new ct("tag:yaml.org,2002:omap",{kind:"sequence",resolve:La,construct:Ia}),Da=Object.prototype.toString;function Ra(e){if(e===null)return!0;var p,n,o,s,c,l=e;for(c=new Array(l.length),p=0,n=l.length;p<n;p+=1){if(o=l[p],Da.call(o)!=="[object Object]"||(s=Object.keys(o),s.length!==1))return!1;c[p]=[s[0],o[s[0]]]}return!0}function Fa(e){if(e===null)return[];var p,n,o,s,c,l=e;for(c=new Array(l.length),p=0,n=l.length;p<n;p+=1)o=l[p],s=Object.keys(o),c[p]=[s[0],o[s[0]]];return c}var or=new ct("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Ra,construct:Fa}),Ba=Object.prototype.hasOwnProperty;function Na(e){if(e===null)return!0;var p,n=e;for(p in n)if(Ba.call(n,p)&&n[p]!==null)return!1;return!0}function qa(e){return e!==null?e:{}}var ar=new ct("tag:yaml.org,2002:set",{kind:"mapping",resolve:Na,construct:qa}),ji=Qn.extend({implicit:[tr,ir],explicit:[nr,rr,or,ar]}),It=Object.prototype.hasOwnProperty,hi=1,sr=2,lr=3,fi=4,Di=1,Ha=2,Cn=3,ja=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Ka=/[\x85\u2028\u2029]/,$a=/[,\[\]\{\}]/,cr=/^(?:!|!!|![a-z\-]+!)$/i,dr=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function An(e){return Object.prototype.toString.call(e)}function kt(e){return e===10||e===13}function qt(e){return e===9||e===32}function vt(e){return e===9||e===32||e===10||e===13}function $t(e){return e===44||e===91||e===93||e===123||e===125}function Ya(e){var p;return 48<=e&&e<=57?e-48:(p=e|32,97<=p&&p<=102?p-97+10:-1)}function Wa(e){return e===120?2:e===117?4:e===85?8:0}function Ua(e){return 48<=e&&e<=57?e-48:-1}function On(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Va(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var ur=new Array(256),pr=new Array(256);for(Nt=0;Nt<256;Nt++)ur[Nt]=On(Nt)?1:0,pr[Nt]=On(Nt);var Nt;function Xa(e,p){this.input=e,this.filename=p.filename||null,this.schema=p.schema||ji,this.onWarning=p.onWarning||null,this.legacy=p.legacy||!1,this.json=p.json||!1,this.listener=p.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function hr(e,p){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=Zo(n),new ft(p,n)}function de(e,p){throw hr(e,p)}function gi(e,p){e.onWarning&&e.onWarning.call(null,hr(e,p))}var Tn={YAML:function(p,n,o){var s,c,l;p.version!==null&&de(p,"duplication of %YAML directive"),o.length!==1&&de(p,"YAML directive accepts exactly one argument"),s=/^([0-9]+)\.([0-9]+)$/.exec(o[0]),s===null&&de(p,"ill-formed argument of the YAML directive"),c=parseInt(s[1],10),l=parseInt(s[2],10),c!==1&&de(p,"unacceptable YAML version of the document"),p.version=o[0],p.checkLineBreaks=l<2,l!==1&&l!==2&&gi(p,"unsupported YAML version of the document")},TAG:function(p,n,o){var s,c;o.length!==2&&de(p,"TAG directive accepts exactly two arguments"),s=o[0],c=o[1],cr.test(s)||de(p,"ill-formed tag handle (first argument) of the TAG directive"),It.call(p.tagMap,s)&&de(p,'there is a previously declared suffix for "'+s+'" tag handle'),dr.test(c)||de(p,"ill-formed tag prefix (second argument) of the TAG directive");try{c=decodeURIComponent(c)}catch{de(p,"tag prefix is malformed: "+c)}p.tagMap[s]=c}};function Lt(e,p,n,o){var s,c,l,u;if(p<n){if(u=e.input.slice(p,n),o)for(s=0,c=u.length;s<c;s+=1)l=u.charCodeAt(s),l===9||32<=l&&l<=1114111||de(e,"expected valid JSON character");else ja.test(u)&&de(e,"the stream contains non-printable characters");e.result+=u}}function zn(e,p,n,o){var s,c,l,u;for(at.isObject(n)||de(e,"cannot merge mappings; the provided source object is unacceptable"),s=Object.keys(n),l=0,u=s.length;l<u;l+=1)c=s[l],It.call(p,c)||(p[c]=n[c],o[c]=!0)}function Yt(e,p,n,o,s,c,l,u,f){var x,m;if(Array.isArray(s))for(s=Array.prototype.slice.call(s),x=0,m=s.length;x<m;x+=1)Array.isArray(s[x])&&de(e,"nested arrays are not supported inside keys"),typeof s=="object"&&An(s[x])==="[object Object]"&&(s[x]="[object Object]");if(typeof s=="object"&&An(s)==="[object Object]"&&(s="[object Object]"),s=String(s),p===null&&(p={}),o==="tag:yaml.org,2002:merge")if(Array.isArray(c))for(x=0,m=c.length;x<m;x+=1)zn(e,p,c[x],n);else zn(e,p,c,n);else!e.json&&!It.call(n,s)&&It.call(p,s)&&(e.line=l||e.line,e.lineStart=u||e.lineStart,e.position=f||e.position,de(e,"duplicated mapping key")),s==="__proto__"?Object.defineProperty(p,s,{configurable:!0,enumerable:!0,writable:!0,value:c}):p[s]=c,delete n[s];return p}function Ki(e){var p;p=e.input.charCodeAt(e.position),p===10?e.position++:p===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):de(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function et(e,p,n){for(var o=0,s=e.input.charCodeAt(e.position);s!==0;){for(;qt(s);)s===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),s=e.input.charCodeAt(++e.position);if(p&&s===35)do s=e.input.charCodeAt(++e.position);while(s!==10&&s!==13&&s!==0);if(kt(s))for(Ki(e),s=e.input.charCodeAt(e.position),o++,e.lineIndent=0;s===32;)e.lineIndent++,s=e.input.charCodeAt(++e.position);else break}return n!==-1&&o!==0&&e.lineIndent<n&&gi(e,"deficient indentation"),o}function vi(e){var p=e.position,n;return n=e.input.charCodeAt(p),!!((n===45||n===46)&&n===e.input.charCodeAt(p+1)&&n===e.input.charCodeAt(p+2)&&(p+=3,n=e.input.charCodeAt(p),n===0||vt(n)))}function $i(e,p){p===1?e.result+=" ":p>1&&(e.result+=at.repeat(`
`,p-1))}function Ga(e,p,n){var o,s,c,l,u,f,x,m,y=e.kind,_=e.result,C;if(C=e.input.charCodeAt(e.position),vt(C)||$t(C)||C===35||C===38||C===42||C===33||C===124||C===62||C===39||C===34||C===37||C===64||C===96||(C===63||C===45)&&(s=e.input.charCodeAt(e.position+1),vt(s)||n&&$t(s)))return!1;for(e.kind="scalar",e.result="",c=l=e.position,u=!1;C!==0;){if(C===58){if(s=e.input.charCodeAt(e.position+1),vt(s)||n&&$t(s))break}else if(C===35){if(o=e.input.charCodeAt(e.position-1),vt(o))break}else{if(e.position===e.lineStart&&vi(e)||n&&$t(C))break;if(kt(C))if(f=e.line,x=e.lineStart,m=e.lineIndent,et(e,!1,-1),e.lineIndent>=p){u=!0,C=e.input.charCodeAt(e.position);continue}else{e.position=l,e.line=f,e.lineStart=x,e.lineIndent=m;break}}u&&(Lt(e,c,l,!1),$i(e,e.line-f),c=l=e.position,u=!1),qt(C)||(l=e.position+1),C=e.input.charCodeAt(++e.position)}return Lt(e,c,l,!1),e.result?!0:(e.kind=y,e.result=_,!1)}function Ja(e,p){var n,o,s;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,o=s=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(Lt(e,o,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)o=e.position,e.position++,s=e.position;else return!0;else kt(n)?(Lt(e,o,s,!0),$i(e,et(e,!1,p)),o=s=e.position):e.position===e.lineStart&&vi(e)?de(e,"unexpected end of the document within a single quoted scalar"):(e.position++,s=e.position);de(e,"unexpected end of the stream within a single quoted scalar")}function Qa(e,p){var n,o,s,c,l,u;if(u=e.input.charCodeAt(e.position),u!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=o=e.position;(u=e.input.charCodeAt(e.position))!==0;){if(u===34)return Lt(e,n,e.position,!0),e.position++,!0;if(u===92){if(Lt(e,n,e.position,!0),u=e.input.charCodeAt(++e.position),kt(u))et(e,!1,p);else if(u<256&&ur[u])e.result+=pr[u],e.position++;else if((l=Wa(u))>0){for(s=l,c=0;s>0;s--)u=e.input.charCodeAt(++e.position),(l=Ya(u))>=0?c=(c<<4)+l:de(e,"expected hexadecimal character");e.result+=Va(c),e.position++}else de(e,"unknown escape sequence");n=o=e.position}else kt(u)?(Lt(e,n,o,!0),$i(e,et(e,!1,p)),n=o=e.position):e.position===e.lineStart&&vi(e)?de(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}de(e,"unexpected end of the stream within a double quoted scalar")}function Za(e,p){var n=!0,o,s,c,l=e.tag,u,f=e.anchor,x,m,y,_,C,P=Object.create(null),E,z,I,S;if(S=e.input.charCodeAt(e.position),S===91)m=93,C=!1,u=[];else if(S===123)m=125,C=!0,u={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),S=e.input.charCodeAt(++e.position);S!==0;){if(et(e,!0,p),S=e.input.charCodeAt(e.position),S===m)return e.position++,e.tag=l,e.anchor=f,e.kind=C?"mapping":"sequence",e.result=u,!0;n?S===44&&de(e,"expected the node content, but found ','"):de(e,"missed comma between flow collection entries"),z=E=I=null,y=_=!1,S===63&&(x=e.input.charCodeAt(e.position+1),vt(x)&&(y=_=!0,e.position++,et(e,!0,p))),o=e.line,s=e.lineStart,c=e.position,Wt(e,p,hi,!1,!0),z=e.tag,E=e.result,et(e,!0,p),S=e.input.charCodeAt(e.position),(_||e.line===o)&&S===58&&(y=!0,S=e.input.charCodeAt(++e.position),et(e,!0,p),Wt(e,p,hi,!1,!0),I=e.result),C?Yt(e,u,P,z,E,I,o,s,c):y?u.push(Yt(e,null,P,z,E,I,o,s,c)):u.push(E),et(e,!0,p),S=e.input.charCodeAt(e.position),S===44?(n=!0,S=e.input.charCodeAt(++e.position)):n=!1}de(e,"unexpected end of the stream within a flow collection")}function es(e,p){var n,o,s=Di,c=!1,l=!1,u=p,f=0,x=!1,m,y;if(y=e.input.charCodeAt(e.position),y===124)o=!1;else if(y===62)o=!0;else return!1;for(e.kind="scalar",e.result="";y!==0;)if(y=e.input.charCodeAt(++e.position),y===43||y===45)Di===s?s=y===43?Cn:Ha:de(e,"repeat of a chomping mode identifier");else if((m=Ua(y))>=0)m===0?de(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?de(e,"repeat of an indentation width identifier"):(u=p+m-1,l=!0);else break;if(qt(y)){do y=e.input.charCodeAt(++e.position);while(qt(y));if(y===35)do y=e.input.charCodeAt(++e.position);while(!kt(y)&&y!==0)}for(;y!==0;){for(Ki(e),e.lineIndent=0,y=e.input.charCodeAt(e.position);(!l||e.lineIndent<u)&&y===32;)e.lineIndent++,y=e.input.charCodeAt(++e.position);if(!l&&e.lineIndent>u&&(u=e.lineIndent),kt(y)){f++;continue}if(e.lineIndent<u){s===Cn?e.result+=at.repeat(`
`,c?1+f:f):s===Di&&c&&(e.result+=`
`);break}for(o?qt(y)?(x=!0,e.result+=at.repeat(`
`,c?1+f:f)):x?(x=!1,e.result+=at.repeat(`
`,f+1)):f===0?c&&(e.result+=" "):e.result+=at.repeat(`
`,f):e.result+=at.repeat(`
`,c?1+f:f),c=!0,l=!0,f=0,n=e.position;!kt(y)&&y!==0;)y=e.input.charCodeAt(++e.position);Lt(e,n,e.position,!1)}return!0}function Mn(e,p){var n,o=e.tag,s=e.anchor,c=[],l,u=!1,f;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=c),f=e.input.charCodeAt(e.position);f!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,de(e,"tab characters must not be used in indentation")),!(f!==45||(l=e.input.charCodeAt(e.position+1),!vt(l))));){if(u=!0,e.position++,et(e,!0,-1)&&e.lineIndent<=p){c.push(null),f=e.input.charCodeAt(e.position);continue}if(n=e.line,Wt(e,p,lr,!1,!0),c.push(e.result),et(e,!0,-1),f=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>p)&&f!==0)de(e,"bad indentation of a sequence entry");else if(e.lineIndent<p)break}return u?(e.tag=o,e.anchor=s,e.kind="sequence",e.result=c,!0):!1}function ts(e,p,n){var o,s,c,l,u,f,x=e.tag,m=e.anchor,y={},_=Object.create(null),C=null,P=null,E=null,z=!1,I=!1,S;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=y),S=e.input.charCodeAt(e.position);S!==0;){if(!z&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,de(e,"tab characters must not be used in indentation")),o=e.input.charCodeAt(e.position+1),c=e.line,(S===63||S===58)&&vt(o))S===63?(z&&(Yt(e,y,_,C,P,null,l,u,f),C=P=E=null),I=!0,z=!0,s=!0):z?(z=!1,s=!0):de(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,S=o;else{if(l=e.line,u=e.lineStart,f=e.position,!Wt(e,n,sr,!1,!0))break;if(e.line===c){for(S=e.input.charCodeAt(e.position);qt(S);)S=e.input.charCodeAt(++e.position);if(S===58)S=e.input.charCodeAt(++e.position),vt(S)||de(e,"a whitespace character is expected after the key-value separator within a block mapping"),z&&(Yt(e,y,_,C,P,null,l,u,f),C=P=E=null),I=!0,z=!1,s=!1,C=e.tag,P=e.result;else if(I)de(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=x,e.anchor=m,!0}else if(I)de(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=x,e.anchor=m,!0}if((e.line===c||e.lineIndent>p)&&(z&&(l=e.line,u=e.lineStart,f=e.position),Wt(e,p,fi,!0,s)&&(z?P=e.result:E=e.result),z||(Yt(e,y,_,C,P,E,l,u,f),C=P=E=null),et(e,!0,-1),S=e.input.charCodeAt(e.position)),(e.line===c||e.lineIndent>p)&&S!==0)de(e,"bad indentation of a mapping entry");else if(e.lineIndent<p)break}return z&&Yt(e,y,_,C,P,null,l,u,f),I&&(e.tag=x,e.anchor=m,e.kind="mapping",e.result=y),I}function is(e){var p,n=!1,o=!1,s,c,l;if(l=e.input.charCodeAt(e.position),l!==33)return!1;if(e.tag!==null&&de(e,"duplication of a tag property"),l=e.input.charCodeAt(++e.position),l===60?(n=!0,l=e.input.charCodeAt(++e.position)):l===33?(o=!0,s="!!",l=e.input.charCodeAt(++e.position)):s="!",p=e.position,n){do l=e.input.charCodeAt(++e.position);while(l!==0&&l!==62);e.position<e.length?(c=e.input.slice(p,e.position),l=e.input.charCodeAt(++e.position)):de(e,"unexpected end of the stream within a verbatim tag")}else{for(;l!==0&&!vt(l);)l===33&&(o?de(e,"tag suffix cannot contain exclamation marks"):(s=e.input.slice(p-1,e.position+1),cr.test(s)||de(e,"named tag handle cannot contain such characters"),o=!0,p=e.position+1)),l=e.input.charCodeAt(++e.position);c=e.input.slice(p,e.position),$a.test(c)&&de(e,"tag suffix cannot contain flow indicator characters")}c&&!dr.test(c)&&de(e,"tag name cannot contain such characters: "+c);try{c=decodeURIComponent(c)}catch{de(e,"tag name is malformed: "+c)}return n?e.tag=c:It.call(e.tagMap,s)?e.tag=e.tagMap[s]+c:s==="!"?e.tag="!"+c:s==="!!"?e.tag="tag:yaml.org,2002:"+c:de(e,'undeclared tag handle "'+s+'"'),!0}function ns(e){var p,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&de(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),p=e.position;n!==0&&!vt(n)&&!$t(n);)n=e.input.charCodeAt(++e.position);return e.position===p&&de(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(p,e.position),!0}function rs(e){var p,n,o;if(o=e.input.charCodeAt(e.position),o!==42)return!1;for(o=e.input.charCodeAt(++e.position),p=e.position;o!==0&&!vt(o)&&!$t(o);)o=e.input.charCodeAt(++e.position);return e.position===p&&de(e,"name of an alias node must contain at least one character"),n=e.input.slice(p,e.position),It.call(e.anchorMap,n)||de(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],et(e,!0,-1),!0}function Wt(e,p,n,o,s){var c,l,u,f=1,x=!1,m=!1,y,_,C,P,E,z;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,c=l=u=fi===n||lr===n,o&&et(e,!0,-1)&&(x=!0,e.lineIndent>p?f=1:e.lineIndent===p?f=0:e.lineIndent<p&&(f=-1)),f===1)for(;is(e)||ns(e);)et(e,!0,-1)?(x=!0,u=c,e.lineIndent>p?f=1:e.lineIndent===p?f=0:e.lineIndent<p&&(f=-1)):u=!1;if(u&&(u=x||s),(f===1||fi===n)&&(hi===n||sr===n?E=p:E=p+1,z=e.position-e.lineStart,f===1?u&&(Mn(e,z)||ts(e,z,E))||Za(e,E)?m=!0:(l&&es(e,E)||Ja(e,E)||Qa(e,E)?m=!0:rs(e)?(m=!0,(e.tag!==null||e.anchor!==null)&&de(e,"alias node should not have any properties")):Ga(e,E,hi===n)&&(m=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):f===0&&(m=u&&Mn(e,z))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&de(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),y=0,_=e.implicitTypes.length;y<_;y+=1)if(P=e.implicitTypes[y],P.resolve(e.result)){e.result=P.construct(e.result),e.tag=P.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(It.call(e.typeMap[e.kind||"fallback"],e.tag))P=e.typeMap[e.kind||"fallback"][e.tag];else for(P=null,C=e.typeMap.multi[e.kind||"fallback"],y=0,_=C.length;y<_;y+=1)if(e.tag.slice(0,C[y].tag.length)===C[y].tag){P=C[y];break}P||de(e,"unknown tag !<"+e.tag+">"),e.result!==null&&P.kind!==e.kind&&de(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+P.kind+'", not "'+e.kind+'"'),P.resolve(e.result,e.tag)?(e.result=P.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):de(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||m}function os(e){var p=e.position,n,o,s,c=!1,l;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(l=e.input.charCodeAt(e.position))!==0&&(et(e,!0,-1),l=e.input.charCodeAt(e.position),!(e.lineIndent>0||l!==37));){for(c=!0,l=e.input.charCodeAt(++e.position),n=e.position;l!==0&&!vt(l);)l=e.input.charCodeAt(++e.position);for(o=e.input.slice(n,e.position),s=[],o.length<1&&de(e,"directive name must not be less than one character in length");l!==0;){for(;qt(l);)l=e.input.charCodeAt(++e.position);if(l===35){do l=e.input.charCodeAt(++e.position);while(l!==0&&!kt(l));break}if(kt(l))break;for(n=e.position;l!==0&&!vt(l);)l=e.input.charCodeAt(++e.position);s.push(e.input.slice(n,e.position))}l!==0&&Ki(e),It.call(Tn,o)?Tn[o](e,o,s):gi(e,'unknown document directive "'+o+'"')}if(et(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,et(e,!0,-1)):c&&de(e,"directives end mark is expected"),Wt(e,e.lineIndent-1,fi,!1,!0),et(e,!0,-1),e.checkLineBreaks&&Ka.test(e.input.slice(p,e.position))&&gi(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&vi(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,et(e,!0,-1));return}if(e.position<e.length-1)de(e,"end of the stream or a document separator is expected");else return}function fr(e,p){e=String(e),p=p||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new Xa(e,p),o=e.indexOf("\0");for(o!==-1&&(n.position=o,de(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)os(n);return n.documents}function as(e,p,n){p!==null&&typeof p=="object"&&typeof n=="undefined"&&(n=p,p=null);var o=fr(e,n);if(typeof p!="function")return o;for(var s=0,c=o.length;s<c;s+=1)p(o[s])}function ss(e,p){var n=fr(e,p);if(n.length!==0){if(n.length===1)return n[0];throw new ft("expected a single document in the stream, but found more")}}var ls=as,cs=ss,gr={loadAll:ls,load:cs},mr=Object.prototype.toString,yr=Object.prototype.hasOwnProperty,Yi=65279,ds=9,ei=10,us=13,ps=32,hs=33,fs=34,Fi=35,gs=37,ms=38,ys=39,vs=42,vr=44,bs=45,mi=58,xs=61,_s=62,ws=63,ks=64,br=91,xr=93,Ss=96,_r=123,Es=124,wr=125,ut={};ut[0]="\\0";ut[7]="\\a";ut[8]="\\b";ut[9]="\\t";ut[10]="\\n";ut[11]="\\v";ut[12]="\\f";ut[13]="\\r";ut[27]="\\e";ut[34]='\\"';ut[92]="\\\\";ut[133]="\\N";ut[160]="\\_";ut[8232]="\\L";ut[8233]="\\P";var Cs=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],As=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Os(e,p){var n,o,s,c,l,u,f;if(p===null)return{};for(n={},o=Object.keys(p),s=0,c=o.length;s<c;s+=1)l=o[s],u=String(p[l]),l.slice(0,2)==="!!"&&(l="tag:yaml.org,2002:"+l.slice(2)),f=e.compiledTypeMap.fallback[l],f&&yr.call(f.styleAliases,u)&&(u=f.styleAliases[u]),n[l]=u;return n}function Ts(e){var p,n,o;if(p=e.toString(16).toUpperCase(),e<=255)n="x",o=2;else if(e<=65535)n="u",o=4;else if(e<=4294967295)n="U",o=8;else throw new ft("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+at.repeat("0",o-p.length)+p}var zs=1,ti=2;function Ms(e){this.schema=e.schema||ji,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=at.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Os(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?ti:zs,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Pn(e,p){for(var n=at.repeat(" ",p),o=0,s=-1,c="",l,u=e.length;o<u;)s=e.indexOf(`
`,o),s===-1?(l=e.slice(o),o=u):(l=e.slice(o,s+1),o=s+1),l.length&&l!==`
`&&(c+=n),c+=l;return c}function Bi(e,p){return`
`+at.repeat(" ",e.indent*p)}function Ps(e,p){var n,o,s;for(n=0,o=e.implicitTypes.length;n<o;n+=1)if(s=e.implicitTypes[n],s.resolve(p))return!0;return!1}function yi(e){return e===ps||e===ds}function ii(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Yi||65536<=e&&e<=1114111}function Ln(e){return ii(e)&&e!==Yi&&e!==us&&e!==ei}function In(e,p,n){var o=Ln(e),s=o&&!yi(e);return(n?o:o&&e!==vr&&e!==br&&e!==xr&&e!==_r&&e!==wr)&&e!==Fi&&!(p===mi&&!s)||Ln(p)&&!yi(p)&&e===Fi||p===mi&&s}function Ls(e){return ii(e)&&e!==Yi&&!yi(e)&&e!==bs&&e!==ws&&e!==mi&&e!==vr&&e!==br&&e!==xr&&e!==_r&&e!==wr&&e!==Fi&&e!==ms&&e!==vs&&e!==hs&&e!==Es&&e!==xs&&e!==_s&&e!==ys&&e!==fs&&e!==gs&&e!==ks&&e!==Ss}function Is(e){return!yi(e)&&e!==mi}function Qt(e,p){var n=e.charCodeAt(p),o;return n>=55296&&n<=56319&&p+1<e.length&&(o=e.charCodeAt(p+1),o>=56320&&o<=57343)?(n-55296)*1024+o-56320+65536:n}function kr(e){var p=/^\n* /;return p.test(e)}var Sr=1,Ni=2,Er=3,Cr=4,Kt=5;function Ds(e,p,n,o,s,c,l,u){var f,x=0,m=null,y=!1,_=!1,C=o!==-1,P=-1,E=Ls(Qt(e,0))&&Is(Qt(e,e.length-1));if(p||l)for(f=0;f<e.length;x>=65536?f+=2:f++){if(x=Qt(e,f),!ii(x))return Kt;E=E&&In(x,m,u),m=x}else{for(f=0;f<e.length;x>=65536?f+=2:f++){if(x=Qt(e,f),x===ei)y=!0,C&&(_=_||f-P-1>o&&e[P+1]!==" ",P=f);else if(!ii(x))return Kt;E=E&&In(x,m,u),m=x}_=_||C&&f-P-1>o&&e[P+1]!==" "}return!y&&!_?E&&!l&&!s(e)?Sr:c===ti?Kt:Ni:n>9&&kr(e)?Kt:l?c===ti?Kt:Ni:_?Cr:Er}function Rs(e,p,n,o,s){e.dump=(function(){if(p.length===0)return e.quotingType===ti?'""':"''";if(!e.noCompatMode&&(Cs.indexOf(p)!==-1||As.test(p)))return e.quotingType===ti?'"'+p+'"':"'"+p+"'";var c=e.indent*Math.max(1,n),l=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-c),u=o||e.flowLevel>-1&&n>=e.flowLevel;function f(x){return Ps(e,x)}switch(Ds(p,u,e.indent,l,f,e.quotingType,e.forceQuotes&&!o,s)){case Sr:return p;case Ni:return"'"+p.replace(/'/g,"''")+"'";case Er:return"|"+Dn(p,e.indent)+Rn(Pn(p,c));case Cr:return">"+Dn(p,e.indent)+Rn(Pn(Fs(p,l),c));case Kt:return'"'+Bs(p)+'"';default:throw new ft("impossible error: invalid scalar style")}})()}function Dn(e,p){var n=kr(e)?String(p):"",o=e[e.length-1]===`
`,s=o&&(e[e.length-2]===`
`||e===`
`),c=s?"+":o?"":"-";return n+c+`
`}function Rn(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Fs(e,p){for(var n=/(\n+)([^\n]*)/g,o=(function(){var x=e.indexOf(`
`);return x=x!==-1?x:e.length,n.lastIndex=x,Fn(e.slice(0,x),p)})(),s=e[0]===`
`||e[0]===" ",c,l;l=n.exec(e);){var u=l[1],f=l[2];c=f[0]===" ",o+=u+(!s&&!c&&f!==""?`
`:"")+Fn(f,p),s=c}return o}function Fn(e,p){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,o,s=0,c,l=0,u=0,f="";o=n.exec(e);)u=o.index,u-s>p&&(c=l>s?l:u,f+=`
`+e.slice(s,c),s=c+1),l=u;return f+=`
`,e.length-s>p&&l>s?f+=e.slice(s,l)+`
`+e.slice(l+1):f+=e.slice(s),f.slice(1)}function Bs(e){for(var p="",n=0,o,s=0;s<e.length;n>=65536?s+=2:s++)n=Qt(e,s),o=ut[n],!o&&ii(n)?(p+=e[s],n>=65536&&(p+=e[s+1])):p+=o||Ts(n);return p}function Ns(e,p,n){var o="",s=e.tag,c,l,u;for(c=0,l=n.length;c<l;c+=1)u=n[c],e.replacer&&(u=e.replacer.call(n,String(c),u)),(At(e,p,u,!1,!1)||typeof u=="undefined"&&At(e,p,null,!1,!1))&&(o!==""&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=s,e.dump="["+o+"]"}function Bn(e,p,n,o){var s="",c=e.tag,l,u,f;for(l=0,u=n.length;l<u;l+=1)f=n[l],e.replacer&&(f=e.replacer.call(n,String(l),f)),(At(e,p+1,f,!0,!0,!1,!0)||typeof f=="undefined"&&At(e,p+1,null,!0,!0,!1,!0))&&((!o||s!=="")&&(s+=Bi(e,p)),e.dump&&ei===e.dump.charCodeAt(0)?s+="-":s+="- ",s+=e.dump);e.tag=c,e.dump=s||"[]"}function qs(e,p,n){var o="",s=e.tag,c=Object.keys(n),l,u,f,x,m;for(l=0,u=c.length;l<u;l+=1)m="",o!==""&&(m+=", "),e.condenseFlow&&(m+='"'),f=c[l],x=n[f],e.replacer&&(x=e.replacer.call(n,f,x)),At(e,p,f,!1,!1)&&(e.dump.length>1024&&(m+="? "),m+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),At(e,p,x,!1,!1)&&(m+=e.dump,o+=m));e.tag=s,e.dump="{"+o+"}"}function Hs(e,p,n,o){var s="",c=e.tag,l=Object.keys(n),u,f,x,m,y,_;if(e.sortKeys===!0)l.sort();else if(typeof e.sortKeys=="function")l.sort(e.sortKeys);else if(e.sortKeys)throw new ft("sortKeys must be a boolean or a function");for(u=0,f=l.length;u<f;u+=1)_="",(!o||s!=="")&&(_+=Bi(e,p)),x=l[u],m=n[x],e.replacer&&(m=e.replacer.call(n,x,m)),At(e,p+1,x,!0,!0,!0)&&(y=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,y&&(e.dump&&ei===e.dump.charCodeAt(0)?_+="?":_+="? "),_+=e.dump,y&&(_+=Bi(e,p)),At(e,p+1,m,!0,y)&&(e.dump&&ei===e.dump.charCodeAt(0)?_+=":":_+=": ",_+=e.dump,s+=_));e.tag=c,e.dump=s||"{}"}function Nn(e,p,n){var o,s,c,l,u,f;for(s=n?e.explicitTypes:e.implicitTypes,c=0,l=s.length;c<l;c+=1)if(u=s[c],(u.instanceOf||u.predicate)&&(!u.instanceOf||typeof p=="object"&&p instanceof u.instanceOf)&&(!u.predicate||u.predicate(p))){if(n?u.multi&&u.representName?e.tag=u.representName(p):e.tag=u.tag:e.tag="?",u.represent){if(f=e.styleMap[u.tag]||u.defaultStyle,mr.call(u.represent)==="[object Function]")o=u.represent(p,f);else if(yr.call(u.represent,f))o=u.represent[f](p,f);else throw new ft("!<"+u.tag+'> tag resolver accepts not "'+f+'" style');e.dump=o}return!0}return!1}function At(e,p,n,o,s,c,l){e.tag=null,e.dump=n,Nn(e,n,!1)||Nn(e,n,!0);var u=mr.call(e.dump),f=o,x;o&&(o=e.flowLevel<0||e.flowLevel>p);var m=u==="[object Object]"||u==="[object Array]",y,_;if(m&&(y=e.duplicates.indexOf(n),_=y!==-1),(e.tag!==null&&e.tag!=="?"||_||e.indent!==2&&p>0)&&(s=!1),_&&e.usedDuplicates[y])e.dump="*ref_"+y;else{if(m&&_&&!e.usedDuplicates[y]&&(e.usedDuplicates[y]=!0),u==="[object Object]")o&&Object.keys(e.dump).length!==0?(Hs(e,p,e.dump,s),_&&(e.dump="&ref_"+y+e.dump)):(qs(e,p,e.dump),_&&(e.dump="&ref_"+y+" "+e.dump));else if(u==="[object Array]")o&&e.dump.length!==0?(e.noArrayIndent&&!l&&p>0?Bn(e,p-1,e.dump,s):Bn(e,p,e.dump,s),_&&(e.dump="&ref_"+y+e.dump)):(Ns(e,p,e.dump),_&&(e.dump="&ref_"+y+" "+e.dump));else if(u==="[object String]")e.tag!=="?"&&Rs(e,e.dump,p,c,f);else{if(u==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new ft("unacceptable kind of an object to dump "+u)}e.tag!==null&&e.tag!=="?"&&(x=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?x="!"+x:x.slice(0,18)==="tag:yaml.org,2002:"?x="!!"+x.slice(18):x="!<"+x+">",e.dump=x+" "+e.dump)}return!0}function js(e,p){var n=[],o=[],s,c;for(qi(e,n,o),s=0,c=o.length;s<c;s+=1)p.duplicates.push(n[o[s]]);p.usedDuplicates=new Array(c)}function qi(e,p,n){var o,s,c;if(e!==null&&typeof e=="object")if(s=p.indexOf(e),s!==-1)n.indexOf(s)===-1&&n.push(s);else if(p.push(e),Array.isArray(e))for(s=0,c=e.length;s<c;s+=1)qi(e[s],p,n);else for(o=Object.keys(e),s=0,c=o.length;s<c;s+=1)qi(e[o[s]],p,n)}function Ks(e,p){p=p||{};var n=new Ms(p);n.noRefs||js(e,n);var o=e;return n.replacer&&(o=n.replacer.call({"":o},"",o)),At(n,0,o,!0,!0)?n.dump+`
`:""}var $s=Ks,Ys={dump:$s};function Wi(e,p){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+p+" instead, which is now safe by default.")}}var Ws=ct,Us=jn,Vs=Wn,Xs=Jn,Gs=Qn,Js=ji,Qs=gr.load,Zs=gr.loadAll,el=Ys.dump,tl=ft,il={binary:nr,float:Gn,map:Yn,null:Un,pairs:or,set:ar,timestamp:tr,bool:Vn,int:Xn,merge:ir,omap:rr,seq:$n,str:Kn},nl=Wi("safeLoad","load"),rl=Wi("safeLoadAll","loadAll"),ol=Wi("safeDump","dump"),al={Type:Ws,Schema:Us,FAILSAFE_SCHEMA:Vs,JSON_SCHEMA:Xs,CORE_SCHEMA:Gs,DEFAULT_SCHEMA:Js,load:Qs,loadAll:Zs,dump:el,YAMLException:tl,types:il,safeLoad:nl,safeLoadAll:rl,safeDump:ol},Ar=al;window.interact||(window.interact=Or.default);window.jsyaml||(window.jsyaml=Ar);var sl="0.9.5";console.info(`%c drag-and-drop-card %c v${sl} `,"color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px","color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0");var ll=(e,...p)=>console.debug(`[drag-and-drop-card] ${e}`,...p);console.info("%c drag-and-drop-card loaded","color:#03a9f4;font-weight:700;");var Ui=()=>new Promise(e=>requestAnimationFrame(()=>e())),cl=()=>new Promise(e=>window.requestIdleCallback?requestIdleCallback(()=>e()):setTimeout(e,0)),Vi=class e extends HTMLElement{constructor(){super();kn(this,"__booting",!1);this.shadowRoot||this.attachShadow({mode:"open"}),this.__rebuiltCards=new WeakSet}_updateTabsA11y_(){var s;let n=this.tabsBar;if(!n)return;n.setAttribute("role","tablist"),n.querySelectorAll(".ddc-tab").forEach((c,l)=>{let u=c.classList.contains("active");c.setAttribute("role","tab"),c.setAttribute("aria-selected",String(u)),c.setAttribute("tabindex",u?"0":"-1"),c.dataset.index=String(l)}),this.__tabsKeyHandler||(this.__tabsKeyHandler=c=>{if(!["ArrowLeft","ArrowRight","Home","End"].includes(c.key))return;let u=Array.from(n.querySelectorAll(".ddc-tab"));if(!u.length)return;c.preventDefault();let f=u.findIndex(_=>_===document.activeElement),x=u.findIndex(_=>_.classList.contains("active")),m=f>=0?f:x>=0?x:0;c.key==="ArrowRight"&&(m=Math.min(u.length-1,m+1)),c.key==="ArrowLeft"&&(m=Math.max(0,m-1)),c.key==="Home"&&(m=0),c.key==="End"&&(m=u.length-1);let y=u[m];if(y){try{y.focus({preventScroll:!1})}catch{}y.click()}},n.addEventListener("keydown",this.__tabsKeyHandler)),this.__tabsScrollHandler||(this.__tabsScrollHandler=()=>{var c;return(c=this._updateTabOverflowShadows_)==null?void 0:c.call(this)},n.addEventListener("scroll",this.__tabsScrollHandler,{passive:!0})),(s=this._updateTabOverflowShadows_)==null||s.call(this)}_setHeaderVisible_(n=!0){var o,s,c,l,u;try{(((o=this._deepQueryAll)==null?void 0:o.call(this,"app-header, ha-top-app-bar, ha-top-app-bar-fixed, mwc-top-app-bar-fixed, ha-header-bar, app-toolbar"))||[]).forEach(y=>{y&&(y.dataset.ddcPrevDisplayHeader===void 0&&(y.dataset.ddcPrevDisplayHeader=y.style.display||"",y.dataset.ddcPrevMinH=y.style.minHeight||"",y.dataset.ddcPrevH=y.style.height||"",y.dataset.ddcPrevVis=y.style.visibility||""),n?(y.style.display=y.dataset.ddcPrevDisplayHeader||"",y.style.minHeight=y.dataset.ddcPrevMinH||"",y.style.height=y.dataset.ddcPrevH||"",y.style.visibility=y.dataset.ddcPrevVis||"",y.removeAttribute("hidden")):(y.style.display="none",y.style.minHeight="0",y.style.height="0",y.style.visibility="hidden",y.setAttribute("hidden","")))}),[...((s=this._deepQueryAll)==null?void 0:s.call(this,"home-assistant-main"))||[],...((c=this._deepQueryAll)==null?void 0:c.call(this,"ha-panel-lovelace"))||[],...((l=this._deepQueryAll)==null?void 0:l.call(this,"hui-root"))||[]].forEach(y=>{if(y)if(y.dataset.ddcPrevHdrVars===void 0&&(y.dataset.ddcPrevHdrVars=JSON.stringify({mdc:y.style.getPropertyValue("--mdc-top-app-bar-height")||"",app:y.style.getPropertyValue("--app-header-height")||"",hdr:y.style.getPropertyValue("--header-height")||""})),n)try{let _=JSON.parse(y.dataset.ddcPrevHdrVars||"{}");y.style.setProperty("--mdc-top-app-bar-height",_.mdc||""),y.style.setProperty("--app-header-height",_.app||""),y.style.setProperty("--header-height",_.hdr||"")}catch{}else y.style.setProperty("--mdc-top-app-bar-height","0px"),y.style.setProperty("--app-header-height","0px"),y.style.setProperty("--header-height","0px")}),(((u=this._deepQueryAll)==null?void 0:u.call(this,"hui-root app-header, hui-root ha-top-app-bar, hui-root mwc-top-app-bar-fixed, hui-root ha-header-bar"))||[]).forEach(y=>{y&&(y.dataset.ddcPrevDisplayHeader2===void 0&&(y.dataset.ddcPrevDisplayHeader2=y.style.display||""),y.style.display=n?y.dataset.ddcPrevDisplayHeader2||"":"none")})}catch{}}_setSidebarVisible_(n=!0){var o,s;try{(((o=this._deepQueryAll)==null?void 0:o.call(this,"ha-sidebar"))||[]).forEach(u=>{u&&(u.dataset.ddcPrevDisplaySidebar===void 0&&(u.dataset.ddcPrevDisplaySidebar=u.style.display||""),u.style.display=n?u.dataset.ddcPrevDisplaySidebar||"":"none")}),(((s=this._deepQueryAll)==null?void 0:s.call(this,"ha-drawer"))||[]).forEach(u=>{if(u){u.dataset.ddcPrevDrawerWidth===void 0&&(u.dataset.ddcPrevDrawerWidth=u.style.getPropertyValue("--mdc-drawer-width")||""),n?u.style.setProperty("--mdc-drawer-width",u.dataset.ddcPrevDrawerWidth||""):u.style.setProperty("--mdc-drawer-width","0px");try{!n&&typeof u.close=="function"&&u.close()}catch{}}})}catch{}}_applyHaChromeVisibility_(){var n;try{let o=!!this.editMode||((n=this._isInHaEditorPreview)==null?void 0:n.call(this));o||!this.hideHaHeader?this._setHeaderVisible_(!0):this._setHeaderVisible_(!1),o||!this.hideHaSidebar?this._setSidebarVisible_(!0):this._setSidebarVisible_(!1)}catch{}}_applyBackgroundImageFromConfig(){var c;let n=this._config||{},o=n.background_image||n.bg_image||null,s=this.cardContainer;if(s)if(o&&o.src){let l=String(o.src).trim(),u=o.repeat===!0||o.repeat==="repeat"?"repeat":"no-repeat",f=Math.max(0,Math.min(1,Number((c=o.opacity)!=null?c:1))),x=o.size||"cover",m=o.position||"center center",y=o.attachment||"scroll",_=o.filter||"none";s.style.setProperty("--ddc-bg-image",l?`url("${l.replace(/"/g,'"')}")`:"none"),s.style.setProperty("--ddc-bg-repeat",u),s.style.setProperty("--ddc-bg-opacity",String(f)),s.style.setProperty("--ddc-bg-size",x),s.style.setProperty("--ddc-bg-position",m),s.style.setProperty("--ddc-bg-attachment",y),s.style.setProperty("--ddc-bg-filter",_),s.classList.add("has-bg-image")}else s.style.removeProperty("--ddc-bg-image"),s.style.removeProperty("--ddc-bg-repeat"),s.style.removeProperty("--ddc-bg-opacity"),s.style.removeProperty("--ddc-bg-size"),s.style.removeProperty("--ddc-bg-position"),s.style.removeProperty("--ddc-bg-attachment"),s.style.removeProperty("--ddc-bg-filter"),s.classList.remove("has-bg-image")}_evaluateVisibility_(n){try{let o=this.hass||this._hass;if(!Array.isArray(n)||n.length===0)return!0;let s=c=>{var u,f,x,m,y;if(!c||typeof c!="object")return!0;let l=c.condition||c.type||"state";if(l==="and"||l==="or"){let _=Array.isArray(c.conditions)?c.conditions:[];return _.length===0?!0:l==="and"?_.every(C=>s(C)):_.some(C=>s(C))}if(l==="state"){let _=c.entity;if(!_)return!0;let C=(u=o==null?void 0:o.states)==null?void 0:u[_];if(!C)return!1;let P=String((f=C.state)!=null?f:"");return c.state!==void 0?(Array.isArray(c.state)?c.state:[c.state]).some(z=>String(z)===P):c.state_not!==void 0?!(Array.isArray(c.state_not)?c.state_not:[c.state_not]).some(z=>String(z)===P):!0}if(l==="numeric_state"){let _=c.entity;if(!_)return!0;let C=(x=o==null?void 0:o.states)==null?void 0:x[_];if(!C)return!1;let P=parseFloat(C.state);return!(isNaN(P)||c.above!==void 0&&!(P>Number(c.above))||c.below!==void 0&&!(P<Number(c.below)))}if(l==="screen"){let _=c.media_query||c.query;if(!_||typeof _!="string")return!0;try{return window.matchMedia(_).matches}catch{return!0}}if(l==="user"){let _=Array.isArray(c.users)?c.users:c.user?[c.user]:[];if(!_.length)return!0;let C=((m=o==null?void 0:o.user)==null?void 0:m.id)||((y=o==null?void 0:o.user)==null?void 0:y.id)||null;return C?_.includes(C):!0}return!0};return n.every(c=>s(c))}catch(o){return console.warn("[ddc:visibility] evaluate error",o),!0}}_applyVisibility_(){var n;try{let o=((n=this.cardContainer)==null?void 0:n.children)||[],s=this._normalizeTabId(this.activeTab);for(let c of o){if(!c||!c.firstElementChild||this._normalizeTabId(c.dataset.tabId)!==s)continue;let f=(this._extractCardConfig(c.firstElementChild)||{}).visibility,x=this.editMode?!0:this._evaluateVisibility_(f);c.style.display=x?"":"none"}}catch(o){console.warn("[ddc:visibility] apply error",o)}}async _onKeyDown_(n){var u,f,x,m,y,_,C,P,E,z;if(!this.editMode||this._isTypingTarget_(n.target))return;let o=Number(this.gridSize||10),s=n.altKey?1:n.shiftKey?o*5:o,c=0,l=0;switch(n.key){case"ArrowLeft":c=-s;break;case"ArrowRight":c=s;break;case"ArrowUp":l=-s;break;case"ArrowDown":l=s;break}if(c||l){n.preventDefault(),this._moveSelectionBy_(c,l,{liveSnap:!n.altKey});return}if(n.key==="Delete"||n.key==="Backspace"){let I=this._selection&&this._selection.size?Array.from(this._selection):[];if(!I.length)return;n.preventDefault(),I.forEach(S=>S.remove()),(u=this._clearSelection)==null||u.call(this),(f=this._resizeContainer)==null||f.call(this),(x=this._queueSave)==null||x.call(this,"delete-key"),(m=this._ensurePlaceholderIfEmpty)==null||m.call(this);return}if((n.ctrlKey||n.metaKey)&&(n.key==="d"||n.key==="D")){n.preventDefault(),await this._duplicateSelection_();return}if((n.ctrlKey||n.metaKey)&&n.key==="]"){n.preventDefault(),this._selection&&((_=(y=this._selection).forEach)==null||_.call(y,I=>{var S;return(S=this._adjustZ)==null?void 0:S.call(this,I,1)})),(C=this._queueSave)==null||C.call(this,"z-up");return}if((n.ctrlKey||n.metaKey)&&n.key==="["){n.preventDefault(),this._selection&&((E=(P=this._selection).forEach)==null||E.call(P,I=>{var S;return(S=this._adjustZ)==null?void 0:S.call(this,I,-1)})),(z=this._queueSave)==null||z.call(this,"z-down");return}}async _duplicateSelection_(){var o,s,c,l,u,f,x,m,y,_,C,P;if(!this._selection||!this._selection.size)return;let n=Array.from(this._selection);for(let E of n)try{let z=((o=this._extractCardConfig)==null?void 0:o.call(this,E.firstElementChild))||{},I=await((s=this._createCard)==null?void 0:s.call(this,z)),S=(c=this._makeWrapper)==null?void 0:c.call(this,I);if(!I||!S)continue;S.style.width=E.style.width,S.style.height=E.style.height;let O=Number(this.gridSize||10),T=(parseFloat(E.getAttribute("data-x"))||0)+O,b=(parseFloat(E.getAttribute("data-y"))||0)+O;(l=this._setCardPosition)==null||l.call(this,S,T,b),S.style.zIndex=String((((u=this._highestZ)==null?void 0:u.call(this))||0)+1);try{let L=(f=E.dataset)==null?void 0:f.tabId;L&&(S.dataset.tabId=L)}catch{}(x=this.cardContainer)==null||x.appendChild(S);try{(m=this._addTabSelectorToChip)==null||m.call(this,S,S.dataset.tabId)}catch{}try{(y=this._rebuildOnce)==null||y.call(this,S.firstElementChild)}catch{}try{(_=this._initCardInteract)==null||_.call(this,S)}catch{}}catch{}try{(C=this._resizeContainer)==null||C.call(this)}catch{}try{(P=this._queueSave)==null||P.call(this,"duplicate")}catch{}}_moveSelectionBy_(n,o,{liveSnap:s=!0}={}){var m,y,_,C,P;if(!this._selection||!this._selection.size)return;let c=Array.from(this._selection),l=Number(this.gridSize||10),u=(m=this._isContainerFixed)==null?void 0:m.call(this),f=((y=this._getContainerSize)==null?void 0:y.call(this))||{w:1/0,h:1/0},x=c.map(E=>{let z=parseFloat(E.getAttribute("data-x-raw"))||parseFloat(E.getAttribute("data-x"))||0,I=parseFloat(E.getAttribute("data-y-raw"))||parseFloat(E.getAttribute("data-y"))||0,S=parseFloat(E.style.width)||E.getBoundingClientRect().width,O=parseFloat(E.style.height)||E.getBoundingClientRect().height,T=z+n,b=I+o;u&&(T=Math.max(0,Math.min(T,Math.max(0,f.w-S))),b=Math.max(0,Math.min(b,Math.max(0,f.h-O))));let L=s?Math.round(T/l)*l:T,D=s?Math.round(b/l)*l:b;return{el:E,rawX:T,rawY:b,snapX:L,snapY:D,w:S,h:O}});if(this.disableOverlap&&typeof this._pushCardsOutOfTheWay=="function")try{this._pushCardsOutOfTheWay(x,n,o,s,l)}catch{}for(let E of x){E.el.setAttribute("data-x-raw",String(E.rawX)),E.el.setAttribute("data-y-raw",String(E.rawY));try{(_=this._setCardPosition)==null||_.call(this,E.el,E.snapX,E.snapY)}catch{}}try{(C=this._resizeContainer)==null||C.call(this)}catch{}try{(P=this._queueSave)==null||P.call(this,"nudge")}catch{}}_syncTabsWidth_(){try{let n=this.tabsBar;if(!n)return;if(this.tabsPosition==="left"){n.style.width="",n.style.maxWidth="";return}let o=this.cardContainer||this.__scaleOuter;if(!o)return;let s=0;try{let c=o.getBoundingClientRect();s=c&&c.width?c.width:0}catch{}if(s<=0&&this.__scaleOuter&&this.__scaleOuter!==o)try{let c=this.__scaleOuter.getBoundingClientRect();s=c&&c.width?c.width:0}catch{}s>0&&(n.style.width=`${s}px`,n.style.maxWidth=`${s}px`)}catch{}}_isTypingTarget_(n){var c,l,u,f;if(!n||n===window||n===document)return!1;let o=(c=n.closest)==null?void 0:c.call(n,'input, textarea, [contenteditable="true"], ha-textfield, mwc-textfield');if(!o)return!1;let s=((u=(l=o.tagName)==null?void 0:l.toLowerCase)==null?void 0:u.call(l))||"";return s==="input"||s==="textarea"||((f=o.hasAttribute)==null?void 0:f.call(o,"contenteditable"))}_scheduleReflowAndScale(){this.__reflowRAF||(this.__reflowRAF=requestAnimationFrame(()=>{var n,o;this.__reflowRAF=null;try{(this.containerSizeMode||this.container_size_mode||"dynamic").toLowerCase()==="dynamic"&&((n=this._resizeContainer)==null||n.call(this))}catch{}try{(o=this._applyAutoScale)==null||o.call(this)}catch{}}))}__ddcBindPointerListeners(){if(!this.__ddcPtrBound){this.__ddcPtrBound=!0,this.__onDDCPointerDown=n=>{var o,s;try{if(n.button!==void 0&&n.button!==0)return;let c=((o=n.composedPath)==null?void 0:o.call(n))||[],l=null;for(let u of c)if(u&&u.classList&&u.classList.contains("card-wrapper")){l=u;break}if(!l)return;this.__ddcDragging=!0,this.__scaleOuter&&(this.__prevOverflow=this.__scaleOuter.style.overflow,this.__scaleOuter.style.overflow="visible"),(s=this._scheduleReflowAndScale)==null||s.call(this)}catch{}},this.__onDDCPointerMove=n=>{var o;try{if(!this.__ddcDragging)return;(o=this._scheduleReflowAndScale)==null||o.call(this)}catch{}},this.__onDDCPointerUp=n=>{var o;try{if(!this.__ddcDragging)return;this.__ddcDragging=!1,this.__scaleOuter&&(this.__scaleOuter.style.overflow=this.__prevOverflow||"");try{(o=this._applyAutoScale)==null||o.call(this)}catch{}}catch{}};try{this.addEventListener("pointerdown",this.__onDDCPointerDown,{passive:!0})}catch{}try{this.addEventListener("pointermove",this.__onDDCPointerMove,{passive:!0})}catch{}try{window.addEventListener("pointerup",this.__onDDCPointerUp,{passive:!0})}catch{}try{window.addEventListener("pointercancel",this.__onDDCPointerUp,{passive:!0})}catch{}}}_ensureScaleWrapper(){let n=this.cardContainer;if(!n||this.__scaleOuter&&this.__scaleOuter.contains(n))return;let o=document.createElement("div");o.className="ddc-scale-outer",Object.assign(o.style,{position:"relative",width:"100%",overflow:"hidden"}),n.parentNode&&(n.parentNode.insertBefore(o,n),o.appendChild(n)),Object.assign(n.style,{position:"absolute",top:"0",left:"0",transformOrigin:"top left"}),this.__scaleOuter=o}_hasCardModDeep(n){try{if(!n||typeof n!="object")return!1;if(n.card_mod||n.type==="custom:mod-card")return!0;if(n.card)return this._hasCardModDeep(n.card);if(Array.isArray(n.cards)){for(let o of n.cards)if(this._hasCardModDeep(o))return!0}return!1}catch{return!1}}_rebuildOnce(n){try{if(!n||(this.__rebuiltCards||(this.__rebuiltCards=new WeakSet),this.__rebuiltCards.has(n)))return;this.__rebuiltCards.add(n),n.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}}_deepQueryAll(n,o=document){let s=[],c=l=>{if(!l)return;if(l.querySelectorAll)try{l.querySelectorAll(n).forEach(x=>s.push(x))}catch{}let u=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,null),f=l;for(;f;){let x=f.shadowRoot;x&&c(x),f=u.nextNode()}};return c(o),s}_syncEditorsStorageKey(){try{let n=this.storageKey||"";this._deepQueryAll("#storage_key").forEach(s=>{try{s&&s.tagName==="INPUT"&&s.value!==n&&(s.value=n,s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}})}catch{}}static _genKey(){var o,s;return`layout_${((s=(o=globalThis.crypto)==null?void 0:o.randomUUID)==null?void 0:s.call(o))||`${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}`}static getStubConfig(){return{type:"custom:drag-and-drop-card",storage_key:this._genKey(),grid:10,drag_live_snap:!1,auto_save:!0,auto_save_debounce:800,container_size_mode:"dynamic",hero_image:"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png"}}static getConfigElement(){let n=document.createElement("div");n.innerHTML=`
    <style>
      :host, .ddc-editor { font-family: var(--paper-font-body1_-_font-family, Roboto, system-ui, sans-serif); color: var(--primary-text-color); }

      .ddc-editor { display: grid; grid-template-columns: 220px 1fr; gap: 10px 16px; align-items: center; box-sizing: border-box; padding: 8px 4px; }
      .section { grid-column: 1 / -1; margin: 10px 0 2px; font-weight: 600; opacity: 0.9; }
      .row-spacer { grid-column: 1 / -1; height: 2px; background: var(--divider-color); opacity: .2; border-radius: 2px; }

      .label { align-self: flex-start; padding-top: 6px; font-weight: 600; opacity: .9; }
      .helper { grid-column: 2 / 3; font-size: .85rem; opacity: .7; margin-top: -6px; }

      .inline { display: inline-flex; align-items: center; gap: 8px; }
      .two-col { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }

      .actions { grid-column: 1 / -1; display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px; }
      .actions ha-button[disabled] { opacity: .6; }

      /* Subtle pulse for enabled Apply button */
      @keyframes ddcPulse {
        0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0,0,0,0); }
        50% { transform: scale(1.035); box-shadow: 0 0 12px 2px rgba(255,255,255,.22); }
      }
      #applyBtn:not([disabled]) { animation: ddcPulse 1.8s ease-in-out infinite; }

      /* Make HA inputs fill width nicely */
      ha-textfield, ha-select { width: 100%; }

      /* Checkbox rows: keep left column reserved so alignment stays consistent */
      .left-empty { visibility: hidden; }

</style>

     <div class="ddc-editor">
      <div class="section">Layout & Behavior</div>

      <div class="label">Storage key</div>
      <ha-textfield id="storage_key" label="Storage key" placeholder="my_unique_layout_key"></ha-textfield>
      <div class="helper">Unique key for saving layout positions. Auto-generated if empty.</div>

      <div class="label">Grid size</div>
      <ha-textfield id="grid" label="Grid (px)" type="number" min="4" max="32" step="1" value="10"></ha-textfield>
      <div class="helper">Pixel size of each grid cell. Affects snap and default card size.</div>

      <div class="label">Snap while dragging</div>
      <ha-formfield label="Snap to grid during drag (live)">
        <ha-checkbox id="liveSnap"></ha-checkbox>
      </ha-formfield>
      <div class="helper">If on, elements snap to grid while dragging. If off, snap occurs on drop.</div>

      <div class="label">Auto-save</div>
      <div class="two-col">
        <ha-formfield label="Auto-save changes">
          <ha-checkbox id="autoSave"></ha-checkbox>
        </ha-formfield>
        <ha-textfield id="autoSaveDebounce" label="Debounce (ms)" type="number" min="0" step="50" value="800"></ha-textfield>
      </div>
      <div class="helper">When enabled, layout changes are saved automatically after a short delay.</div>

      <div class="row-spacer"></div>
      <div class="section">Appearance</div>

      <div class="label">Container background</div>
      <ha-textfield id="containerBg" label="CSS color/gradient" placeholder="transparent, #232f3e, linear-gradient(...)" helper=""></ha-textfield>
      <div class="helper">Examples: <code>transparent</code>, <code>#232f3e</code>, <code>linear-gradient(...)</code>.</div>

      <div class="label">Card background</div>
      <ha-textfield id="cardBg" label="CSS color/gradient" placeholder="var(--ha-card-background) or #ffffffcc"></ha-textfield>
      <div class="helper">Background for each card in the layout; can use theme vars.</div>

      <div class="label">Debug logs</div>
      <ha-formfield label="Enable console debug">
        <ha-checkbox id="debug"></ha-checkbox>
      </ha-formfield>

      <div class="label">Disable overlap</div>
      <ha-formfield label="Prevent cards from overlapping">
        <ha-checkbox id="noOverlap"></ha-checkbox>
      </ha-formfield>

      <div class="label">Auto-resize cards</div>
      <ha-formfield label="Scale layout to fit parent (view mode)">
        <ha-checkbox id="autoResize"></ha-checkbox>
      </ha-formfield>

      <div class="label">Animate cards</div>
      <ha-formfield label="Animate cards on tab switch">
        <ha-checkbox id="animateCards"></ha-checkbox>
      </ha-formfield>
      <div class="helper">If enabled, cards will fly in when switching tabs or on refresh.</div>


      <div class="row-spacer"></div>
      <div class="section">Container Size</div>

      <div class="label">Mode</div>
      <ha-select id="sizeMode" label="Container size mode">
        <mwc-list-item value="dynamic">Dynamic (auto)</mwc-list-item>
        <mwc-list-item value="fixed_custom">Fixed (custom)</mwc-list-item>
        <mwc-list-item value="preset">Preset</mwc-list-item>
      </ha-select>

      <div class="label">Fixed size</div>
      <div class="inline" id="sizeCustom" style="display:none">
        <ha-textfield id="sizeW" type="number" label="W" min="100" step="10"></ha-textfield>
        <ha-textfield id="sizeH" type="number" label="H" min="100" step="10"></ha-textfield>
      </div>

      <div class="label">Preset</div>
      <div class="inline" id="sizePresetWrap" style="display:none">
        <ha-select id="sizePreset" label="Preset"></ha-select>
        <ha-select id="sizeOrientation" label="Orientation">
          <mwc-list-item value="auto">Auto</mwc-list-item>
          <mwc-list-item value="landscape">Landscape</mwc-list-item>
          <mwc-list-item value="portrait">Portrait</mwc-list-item>
        </ha-select>
      </div>

      <div class="actions">
        <ha-button id="revertBtn">Revert</ha-button>
        <ha-button id="applyBtn" raised disabled>Apply</ha-button>
      </div>
    </div>
  `;let o=()=>{let m=f();l.disabled=!m},s=()=>{let m=n.getConfig();n.dispatchEvent(new CustomEvent("config-changed",{detail:{config:m}})),o()},c=()=>{let m=n.querySelector("#sizeMode").value;n.querySelector("#sizeCustom").style.display=m==="fixed_custom"?"inline-flex":"none",n.querySelector("#sizePresetWrap").style.display=m==="preset"?"inline-flex":"none"},l=n.querySelector("#applyBtn"),u=n.querySelector("#revertBtn");["#sizeMode","#sizePreset","#sizeOrientation"].forEach(m=>{let y=n.querySelector(m);if(y){try{y.fixedMenuPosition=!0}catch{}y.addEventListener("closed",_=>_.stopPropagation())}}),n.setConfig=(m={})=>{var _,C,P,E,z,I,S,O;n._config={type:m.type||"custom:drag-and-drop-card",...m},n._config.storage_key||(n._config.storage_key=`layout_${((_=crypto==null?void 0:crypto.randomUUID)==null?void 0:_.call(crypto))||Date.now().toString(36)}`,n.__autokeyPending=!0),n.querySelector("#storage_key").value=n._config.storage_key||"",n.querySelector("#grid").value=(C=n._config.grid)!=null?C:10,n.querySelector("#liveSnap").checked=!!n._config.drag_live_snap,n.querySelector("#autoSave").checked=n._config.auto_save!==!1,n.querySelector("#autoSaveDebounce").value=(P=n._config.auto_save_debounce)!=null?P:800,n.querySelector("#containerBg").value=(E=n._config.container_background)!=null?E:"transparent",n.querySelector("#cardBg").value=(z=n._config.card_background)!=null?z:"var(--ha-card-background, var(--card-background-color))",n.querySelector("#debug").checked=!!n._config.debug,n.querySelector("#noOverlap").checked=!!n._config.disable_overlap,n.querySelector("#autoResize").checked=!!n._config.auto_resize_cards,n.querySelector("#animateCards").checked=!!n._config.animate_cards,n.querySelector("#sizeMode").value=n._config.container_size_mode||"dynamic",n.querySelector("#sizeW").value=(I=n._config.container_fixed_width)!=null?I:"",n.querySelector("#sizeH").value=(S=n._config.container_fixed_height)!=null?S:"",n.querySelector("#sizeOrientation").value=n._config.container_preset_orientation||"auto";let y=n.querySelector("#sizePreset");if(!y.__filled){let T=(((O=this._sizePresets)==null?void 0:O.call(this))||[]).reduce((b,L)=>{var D;return(b[D=L.group||"other"]||(b[D]=[])).push(L),b},{});y.innerHTML="";for(let[b,L]of Object.entries(T)){let D=document.createElement("optgroup");D.label=b.replace(/(^.|-.?)/g,B=>B.toUpperCase()),L.forEach(B=>{let J=document.createElement("mwc-list-item");J.value=B.key,J.textContent=`${B.label} (${B.w}\xD7${B.h})`,D.appendChild(J)});let Q=document.createElement("mwc-list-item");Q.setAttribute("disabled",""),Q.textContent=`\u2014 ${D.label} \u2014`,y.appendChild(Q),Array.from(D.children).forEach(B=>y.appendChild(B))}y.__filled=!0}n._config.container_preset&&(y.value=n._config.container_preset),c(),o(),n.__autokeyPending&&(n.__autokeyPending=!1,s())},n.getConfig=()=>{let m={...n._config||{}};return m.storage_key=n.querySelector("#storage_key").value||"",m.grid=Number(n.querySelector("#grid").value||10),m.drag_live_snap=!!n.querySelector("#liveSnap").checked,m.auto_save=!!n.querySelector("#autoSave").checked,m.auto_save_debounce=Number(n.querySelector("#autoSaveDebounce").value||800),m.container_background=n.querySelector("#containerBg").value||"transparent",m.card_background=n.querySelector("#cardBg").value||"var(--ha-card-background, var(--card-background-color))",m.debug=!!n.querySelector("#debug").checked,m.disable_overlap=!!n.querySelector("#noOverlap").checked,m.auto_resize_cards=!!n.querySelector("#autoResize").checked,m.animate_cards=!!n.querySelector("#animateCards").checked,m.container_size_mode=n.querySelector("#sizeMode").value,m.container_fixed_width=Number(n.querySelector("#sizeW").value||0)||void 0,m.container_fixed_height=Number(n.querySelector("#sizeH").value||0)||void 0,m.container_preset=n.querySelector("#sizePreset").value||void 0,m.container_preset_orientation=n.querySelector("#sizeOrientation").value||"auto",m};let f=()=>{let m=n.getConfig(),y=n._config||{};try{return JSON.stringify(m)!==JSON.stringify(y)}catch{return!0}},x=(m,y="input")=>{var _;return(_=n.querySelector(m))==null?void 0:_.addEventListener(y,()=>{m==="#sizeMode"&&c(),o()})};return x("#storage_key"),x("#grid"),x("#liveSnap","change"),x("#autoSave","change"),x("#autoSaveDebounce"),x("#containerBg"),x("#cardBg"),x("#debug","change"),x("#noOverlap","change"),x("#autoResize","change"),x("#animateCards","change"),x("#sizeMode","change"),x("#sizeW"),x("#sizeH"),x("#sizePreset","selected"),x("#sizeOrientation","selected"),l==null||l.addEventListener("click",()=>{s()}),u==null||u.addEventListener("click",()=>n.setConfig(n._config)),n}static _sizePresets(){return[{key:"iphone-14-pro",label:"iPhone 14 Pro",w:393,h:852,group:"phone"},{key:"iphone-14-pro-max",label:"iPhone 14 Pro Max",w:430,h:932,group:"phone"},{key:"iphone-se-2",label:"iPhone SE (2/3rd gen)",w:375,h:667,group:"phone"},{key:"pixel-7",label:"Pixel 7",w:412,h:915,group:"phone"},{key:"galaxy-s8",label:"Galaxy S8",w:360,h:740,group:"phone"},{key:"galaxy-s20-ultra",label:"Galaxy S20 Ultra",w:412,h:915,group:"phone"},{key:"ipad-9-7",label:'iPad 9.7"',w:768,h:1024,group:"tablet"},{key:"ipad-11-pro",label:'iPad Pro 11"',w:834,h:1194,group:"tablet"},{key:"ipad-12-9-pro",label:'iPad Pro 12.9"',w:1024,h:1366,group:"tablet"},{key:"surface-go-3",label:"Surface Go 3",w:800,h:1280,group:"tablet"},{key:"hd",label:"HD",w:1366,h:768,group:"desktop"},{key:"wxga-plus",label:"WXGA+",w:1440,h:900,group:"desktop"},{key:"fhd",label:"Full HD",w:1920,h:1080,group:"desktop"},{key:"qhd",label:"2K / QHD",w:2560,h:1440,group:"desktop"},{key:"uhd-4k",label:"4K UHD",w:3840,h:2160,group:"desktop"}]}_isContainerFixed(){return this.containerSizeMode!=="dynamic"}_resolveFixedSize(){if(this.containerSizeMode==="fixed_custom"){let n=Math.max(100,Number(this.containerFixedWidth||0)),o=Math.max(100,Number(this.containerFixedHeight||0));return{w:n,h:o}}if(this.containerSizeMode==="preset"){let n=e._sizePresets().find(c=>c.key===this.containerPreset)||e._sizePresets().find(c=>c.key==="fhd");if(!n)return{w:1920,h:1080};let o=n.w,s=n.h;return this.containerPresetOrient==="portrait"&&o>s&&([o,s]=[s,o]),this.containerPresetOrient==="landscape"&&s>o&&([o,s]=[s,o]),{w:o,h:s}}return null}_applyContainerSizingFromConfig(n=!1){var s,c;let o=this.cardContainer;if(o)if(this._isContainerFixed()){let{w:l,h:u}=this._resolveFixedSize();o.style.width=`${l}px`,o.style.height=`${u}px`,o.style.overflow="hidden",n||(s=this._dbgPush)==null||s.call(this,"size","Applied fixed size",{w:l,h:u,mode:this.containerSizeMode,preset:this.containerPreset,orient:this.containerPresetOrient}),this._clampAllCardsInside()}else o.style.overflow="hidden",n||(c=this._dbgPush)==null||c.call(this,"size","Applied dynamic size"),this._resizeContainer()}_getContainerSize(){let n=this.cardContainer;if(!n)return{w:0,h:0};let o=parseFloat(getComputedStyle(n).width)||n.getBoundingClientRect().width,s=parseFloat(getComputedStyle(n).height)||n.getBoundingClientRect().height;return{w:o,h:s}}_clampAllCardsInside(){if(!this._isContainerFixed())return;let{w:n,h:o}=this._getContainerSize();this.cardContainer.querySelectorAll(".card-wrapper").forEach(c=>{let l=parseFloat(c.getAttribute("data-x"))||0,u=parseFloat(c.getAttribute("data-y"))||0,f=parseFloat(c.style.width)||c.getBoundingClientRect().width,x=parseFloat(c.style.height)||c.getBoundingClientRect().height,m=Math.max(0,Math.min(l,Math.max(0,n-f))),y=Math.max(0,Math.min(u,Math.max(0,o-x))),_=Math.min(f,n),C=Math.min(x,o);(_!==f||C!==x)&&(c.style.width=`${_}px`,c.style.height=`${C}px`);let P=Math.max(0,Math.min(m,Math.max(0,n-_))),E=Math.max(0,Math.min(y,Math.max(0,o-C)));this._setCardPosition(c,P,E)})}_applyGridVars(){var o;let n=`${this.gridSize||10}px`;this.style.setProperty("--ddc-grid-size",n),(o=this.cardContainer)==null||o.style.setProperty("--ddc-grid-size",n)}_dbgInit(){if(!this.__dbgReady){this.__dbgReady=!0,this._dbgBuffer=[],this._dbgMax=400;try{window.DDC=this}catch{}}}_dbgPush(n,o,s=null){let c={t:new Date().toISOString(),kind:n,msg:o,extra:s};this._dbgBuffer.push(c),this._dbgBuffer.length>this._dbgMax&&this._dbgBuffer.shift(),this.debug&&console.debug(`%c[ddc:${n}]%c ${o}`,"color:#03a9f4","color:unset",s!=null?s:"")}_dbgDump(){return[...this._dbgBuffer]}_safe(n){return String(n).replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o])}setConfig(n={}){var c,l,u,f,x,m,y,_,C,P,E,z,I,S,O,T,b,L,D,Q,B,J;let o=this.storageKey;this.config={...n},(!this.config.storage_key||this.config.storage_key==="")&&(this.config.storage_key=this.constructor._genKey()),this.storageKey=this.config.storage_key,n.storage_key||(this.storageKey?n={...n,storage_key:this.storageKey}:(this.storageKey=`layout_${((c=crypto==null?void 0:crypto.randomUUID)==null?void 0:c.call(crypto))||Date.now().toString(36)}`,n={...n,storage_key:this.storageKey})),this._config=n,this.storageKey=n.storage_key,this._syncEditorsStorageKey(),this.storageKey=n.storage_key||void 0,this._syncEditorsStorageKey(),this.gridSize=Number((l=n.grid)!=null?l:10),this.dragLiveSnap=!!n.drag_live_snap,this.autoSave=n.auto_save!==!1,this.autoSaveDebounce=Number((u=n.auto_save_debounce)!=null?u:800),this.containerBackground=(f=n.container_background)!=null?f:"transparent",this.cardBackground=(x=n.card_background)!=null?x:"var(--ha-card-background, var(--card-background-color))",this.hideHaHeader=!!((y=(m=n.hide_HA_Header)!=null?m:n.hide_ha_header)!=null&&y),this.hideHaSidebar=!!((C=(_=n.hide_HA_Sidebar)!=null?_:n.hide_ha_sidebar)!=null&&C),this.debug=!!n.debug,this.editMode=!1,this._backendOK=!1,this.disableOverlap=!!n.disable_overlap,this.containerSizeMode=n.container_size_mode||"dynamic",this.autoResizeCards=!!n.auto_resize_cards,this.animateCards=!!n.animate_cards,this.autoResizeCards?(P=this._startScaleWatch)==null||P.call(this):(E=this._stopScaleWatch)==null||E.call(this),(z=this._applyAutoScale)==null||z.call(this),this.containerFixedWidth=Number((I=n.container_fixed_width)!=null?I:0)||null,this.containerFixedHeight=Number((S=n.container_fixed_height)!=null?S:0)||null,this.containerPreset=n.container_preset||"fullhd",this.containerPresetOrient=n.container_preset_orientation||"auto",this.heroImage=(n==null?void 0:n.hero_image)||"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png",this.tabs=Array.isArray(n.tabs)?n.tabs:[],this.tabsPosition=n.tabs_position==="left"?"left":"top",this.defaultTab=n.default_tab||((T=(O=this.tabs[0])==null?void 0:O.id)!=null?T:"default"),this.hideTabsWhenSingle=n.hide_tabs_when_single!==!1,this.activeTab=this.defaultTab;try{let K=localStorage.getItem(`ddc_lasttab_${this.storageKey}`);K&&this.tabs.some(X=>X.id===K)&&(this.activeTab=K)}catch{}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left"),this.cardContainer&&this._applyContainerSizingFromConfig(!1);let s=o!==this.storageKey;if(this.editMode&&!this.__booting&&!s)try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._applyGridVars();try{(b=this._applyBackgroundImageFromConfig)==null||b.call(this)}catch{}try{(L=this._applyHaChromeVisibility_)==null||L.call(this)}catch{}if(this._ensureOverlayZFix(),this._selection=new Set,this.__groupDrag=null,this.__editorCache=new Map,this.__stubCache=new Map,this._dbgInit(),this._dbgPush("init","Card configured",{storageKey_raw:n.storage_key,storageKey_slug:this.storageKey,autoSave:this.autoSave,grid:this.gridSize}),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),!window.jsyaml){let K=document.createElement("script");K.src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js",document.head.appendChild(K)}if(!window.interact){let K=document.createElement("script");K.src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js",K.onload=()=>this._initInteract(),document.head.appendChild(K)}if(this._helpersPromise=typeof window.loadCardHelpers=="function"?window.loadCardHelpers().catch(()=>null):Promise.resolve(null),!this._built){this._built=!0,this.shadowRoot.innerHTML=`
        <style>
          .ddc-root{
            position:relative;
            /* JS will keep this in sync with your \u201CGrid (px)\u201D */
            --ddc-grid-size: 10px;
            /* Good contrast on light/dark themes */
            --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);
          }
          .toolbar{display:flex;gap:8px;margin:6px 0;align-items:center;flex-wrap:wrap}
          .btn{
            background:var(--primary-color);color:#fff;border:none;padding:8px 12px;border-radius:10px;
            cursor:pointer;font:inherit;box-shadow:0 2px 6px rgba(0,0,0,.12)
          }
          .btn.secondary{background:var(--secondary-background-color);color:var(--primary-text-color);border:1px solid var(--divider-color)}
          .btn.ghost{background:transparent;color:var(--primary-text-color);border:1px dashed var(--divider-color)}
          .store-badge {
            margin-left: auto;
            border: 1px solid var(--divider-color);
            border-radius: 999px;
            padding: 4px 10px;
            font-size: .85rem;
            background: rgba(255,193,7,.15);
            display: none; /* hidden by default, shown only in edit mode */
          }

          .card-container{
            position: relative;
            transform-origin: top left;
            padding: 10px;
            border: 1px solid var(--divider-color);
            background: var(--ddc-bg, transparent);
            width: auto; height: auto; border-radius: 12px; overflow: hidden;
            isolation: isolate; z-index: 0; -webkit-touch-callout: none;
            user-select: none;
          }
          /* make the grid only on the background, aligned to the same origin as cards */
          .card-container::before{
            content:'';
            position:absolute; inset:0;                 /* same origin as absolutely positioned children */
            background-image:
              linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),
              linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);
            background-size: var(--ddc-grid-size) var(--ddc-grid-size);
            background-origin: content-box;              /* align pattern to the content/padding edge */
            background-clip: content-box;
            pointer-events:none;
            opacity:0;
            transition: opacity .15s;
            z-index:1;
          }
          .card-container.grid-on::before{
            opacity:.28;
          }
          /* background image layer (always behind grid and cards) */
          .card-container::after{
            content:'';
            position:absolute; inset:0;
            pointer-events:none;
            z-index:0;
            opacity: var(--ddc-bg-opacity, 1);
            background-image: var(--ddc-bg-image, none);
            background-repeat: var(--ddc-bg-repeat, no-repeat);
            background-size: var(--ddc-bg-size, cover);
            background-position: var(--ddc-bg-position, center center);
            background-attachment: var(--ddc-bg-attachment, scroll);
            filter: var(--ddc-bg-filter, none);
          }
    

          .card-wrapper{
            position:absolute;
            left: 0;                     /* <<< important: unify origin with the grid */
            top:  0;                     /* <<< important: unify origin with the grid */
            box-sizing: border-box;      /* include the 2px border in the set width/height */
            border:2px solid transparent;
            background:var(--ddc-card-bg, var(--card-background-color));
            cursor:grab;
            /* ensure buttons and resize handles remain visible on very small cards */
            overflow:auto;
            border-radius:14px;
            box-shadow:var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18));
            will-change:transform,width,height,box-shadow; touch-action:auto;
            z-index:2;
          }
          .card-wrapper.dragging{
            cursor:grabbing;
            touch-action: none;
            }
          .card-wrapper.editing.selected{
            border-color:var(--primary-color,#03a9f4);
            box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;
          }

          /* ---- empty-state of the card---- */
          .btn.cta-empty{
            position:relative;
            padding:12px 16px;
            font-weight:600;
            border-radius:14px;
            display:inline-flex !important;
            align-items:center;
            gap:8px;
            box-shadow:0 6px 18px rgba(3,169,244,.25);
          }
          .btn.cta-empty::after{
            content:"";
            position:absolute; inset:-4px;
            border-radius:16px;
            border:2px solid rgba(3,169,244,.35);
            animation: ddc-cta-pulse 1.8s ease-out infinite;
            pointer-events:none;
          }
          @keyframes ddc-cta-pulse{
            0%   { opacity:.85; transform:scale(.98); }
            70%  { opacity:0;   transform:scale(1.12); }
            100% { opacity:0;   transform:scale(1.18); }
          }    
            
          /* pleasant buttons: info (light blue) & warning (orange) */
          .btn.info{
            background: var(--ddc-info,#4db6ff);
            color:#0b2537;
            border:1px solid color-mix(in srgb, var(--ddc-info,#4db6ff) 55%, #000 15%);
          }
          .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.info:active{ transform: translateY(0) }

          .btn.warning{
            background: var(--ddc-warning,#ff9800);
            color:#210b00;
            border:1px solid color-mix(in srgb, var(--ddc-warning,#ff9800) 55%, #000 15%);
          }
          .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }
          .btn.warning:active{ transform: translateY(0) }

          /* small quality-of-life for all .btn */
          .btn{
            display:inline-flex; align-items:center; gap:8px;
            border-radius:12px; transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
          }
          .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px }

          /* ---- chip ---- */
        .chip{
            position:absolute;
            /* Position the chip horizontally centered above the resize handle */
            bottom:48px;
            left:50%;
            transform:translateX(-50%);
            display:flex;
            gap:6px;
            flex-wrap:wrap;
            opacity:0;
            transition:opacity .15s;
            z-index:30;
            pointer-events: none;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          .card-wrapper.editing .chip{
            opacity:1;
            pointer-events: auto;
          }
          /* Action buttons on cards: icons only, colour-coded and consistent sizing */
          .chip .mini{
            display:flex;
            align-items:center;
            justify-content:center;
            width:32px;
            height:32px;
            /* Use a subtle gradient for a more interesting look */
            background:linear-gradient(135deg, rgba(24,25,27,.7) 0%, rgba(40,41,43,.9) 100%);
            color:#fff;
            border:1px solid rgba(255,255,255,.18);
            border-radius:8px;
            cursor:pointer;
            box-shadow:0 2px 4px rgba(0,0,0,.25);
            /* removed blur for clarity */
            transition:background .15s, transform .1s, box-shadow .15s;
          }
          .chip .mini span{
            display:none;
          }
          .chip .mini:hover{
            transform:translateY(-1px);
            background:linear-gradient(135deg, rgba(24,25,27,.85) 0%, rgba(40,41,43,1) 100%);
            box-shadow:0 3px 8px rgba(0,0,0,.4);
          }
          .chip .mini ha-icon{
            --mdc-icon-size:20px;
            width:20px;
            height:20px;
          }
          .chip .mini.danger{
            background:linear-gradient(135deg, rgba(236,72,72,.9) 0%, rgba(255,105,97,1) 100%);
            border-color:rgba(255,255,255,.22);
          }
          .chip .mini.danger:hover{
            background:linear-gradient(135deg, rgba(236,72,72,1) 0%, rgba(255,105,97,1) 100%);
          }
          /* pill modifier is no longer used, but keep rule for compatibility */
          .chip .mini.pill{
            /* no extra padding needed when using icon-only buttons */
            padding:0;
          }

          /* Edit highlight */
          .card-wrapper.editing{ 
            border-color:var(--primary-color,#03a9f4);
            touch-action: none;
          }
          .card-wrapper.editing::after{
            content:"";position:absolute;inset:0;border:1px dashed var(--primary-color,#03a9f4);
            border-radius:12px;pointer-events:none;opacity:.35;z-index:5;box-sizing:border-box
          }

          .shield{position:absolute;inset:0;z-index:10;background:transparent;pointer-events:none}
          .card-wrapper.editing .shield,
          .card-wrapper.dragging .shield{pointer-events:auto;cursor:grab}

          .resize-handle{
            display:none;                 /* shown in edit mode via your existing rule */
            position:absolute;
            bottom:0;
            right:0;
            width:40px;
            height:40px;
            background:var(--primary-color);
            color:#fff;
            border-top-left-radius:40px;
            border-bottom-left-radius:0;
            border-top-right-radius:0;
            border-bottom-right-radius:0;
            cursor:se-resize;
            z-index:999;                  /* above the card content */
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            display:flex;
            align-items:center;
            justify-content:center;
            transition:background .15s, transform .1s, box-shadow .15s;
          }
          .resize-handle:hover{
            transform:scale(1.05);
            box-shadow:0 6px 16px rgba(0,0,0,.35);
            filter:brightness(1.05);
          }
          .card-wrapper.editing .resize-handle{display:flex}
          .resize-handle ha-icon{
            --mdc-icon-size:20px;
            width:20px;
            height:20px;
            pointer-events:none;
          }

          /* Delete handle: a quarter\u2011circle wedge in the top-left corner */
          .delete-handle{
            display:none;                 /* shown only in edit mode */
            position:absolute;
            top:0;
            left:0;
            width:40px;
            height:40px;
            background:linear-gradient(135deg, rgba(236,72,72,.9) 0%, rgba(255,105,97,1) 100%);
            color:#fff;
            border-bottom-right-radius:40px;
            z-index:999;
            box-shadow:0 3px 8px rgba(0,0,0,.28);
            cursor:pointer;
            align-items:center;
            justify-content:center;
            transition:background .15s, transform .1s, box-shadow .15s;
          }
          .delete-handle:hover{
            transform:scale(1.05);
            box-shadow:0 6px 16px rgba(0,0,0,.35);
            filter:brightness(1.05);
          }
          .card-wrapper.editing .delete-handle{display:flex}
          .delete-handle ha-icon{
            --mdc-icon-size:20px;
            width:20px;
            height:20px;
            pointer-events:none;
          }

          /* modal */
          .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:9000}
          .dialog{
            width:min(1220px,96%);max-height:min(90vh, 900px);display:flex;flex-direction:column;
            background:var(--card-background-color);border-radius:20px;padding:0;border:1px solid var(--divider-color);overflow:visible
          }
          .dlg-head{
            display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--divider-color);
            background:
              radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),
              radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);
          }
          .dlg-head h3{margin:0;font-size:1.1rem;letter-spacing:.2px}
          .dlg-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px;border-top:1px solid var(--divider-color);background:var(--primary-background-color)}
          .btn:disabled{opacity:.6;cursor:not-allowed}

          /* picker layout */
          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}
          #leftPane{
            border-right:1px solid var(--divider-color);
            overflow:auto;
            background:var(--primary-background-color);
            /*
             * Remove contain:content so that fixed-position menus from
             * custom card editors can correctly position themselves
             * relative to the viewport. CSS containment can interfere
             * with anchoring of overlays.
             */
            contain:none;
          }
          /*
           * Allow content like dropdown menus from custom card editors to
           * overflow the right pane without being clipped. Using overflow
           * visible instead of hidden prevents menus from being positioned
           * far away or requiring excessive scrolling when they open.
           */
          #rightPane{
            /* Allow the right-hand editor pane to scroll vertically when
             * content from custom card editors exceeds the available space.
             * We hide horizontal overflow to avoid layout shifts. */
            overflow-y:auto;
            overflow-x:hidden;
            background:var(--primary-background-color);
          }
          .rightGrid{
            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;
          }
          .sec{
            border:1px solid var(--divider-color);
            border-radius:12px;
            background:var(--card-background-color);
            overflow:visible;
            position:relative;
            /* Remove content containment on sections to prevent the
             * creation of an artificial containing block which can
             * disrupt dropdown positioning. */
            contain:none;
          }
          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}
          .sec .bd{padding:12px;overflow:visible}       
          .tabs{display:flex;gap:6px;margin-left:auto}
          .tab{
            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);
            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer
          }
          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}
          .cm-editor{height: 100%}
          /* --- FIX: YAML/Visual editor: ensure the entire content is visible --- */
          /*
           * The YAML editor previously had a fixed height which caused the
           * bottom of longer configurations to be clipped. Removing the fixed
           * height allows the section to flex based on available space within
           * the grid row. A min-height of zero lets it collapse when there
           * isn't much content, while overflow:auto enables scrolling when
           * content exceeds the visible area.
           */
          #yamlSec {
            min-height: 0;
            height: auto !important;
            overflow: auto;
          }
          #yamlSec .bd {
            /* allow the YAML editor to use the full available space instead of a fixed max height */
            overflow: auto;
            max-height: none;
            /* Fill the available grid row height (1fr) so that scrolling
             * happens inside this section rather than expanding the editor
             * beyond the modal boundary. A min-height of zero ensures the
             * section can shrink when little content is present. */
            height: 100%;
            min-height: 0;
          }
          /* --- make Visual editor area scrollable, like YAML --- */
          #optionsSec {
            min-height: 0;
            overflow: auto;
          }
          #optionsSec .bd {
            position: relative;
            overflow: auto;
            height: auto;
            max-height: none;
            min-height: 0;
          }
          #editorHost {
            display: block;
            min-height: 0;
          }

          #quickFillSec { 
            display: flex; 
            flex-direction: column; 
            min-height: 0; 
          }
          #quickFillSec .bd { 
            overflow: auto;          /* scroll inside the card */
            max-height: 320px;       /* keep it contained; tweak as you wish */
          }

          /* ha-code-editor / CodeMirror height: allow growth but set a sensible minimum
           * so that very short snippets don't collapse. Using min-height
           * instead of a fixed height allows the editor to expand when the
           * parent container grows. The !important flag ensures that the
           * component\u2019s inline styles from HA won\u2019t override this sizing.
           */
          ha-code-editor {
            display: block;
            min-height: 260px;
            height: auto !important;
          }
          .CodeMirror {
            min-height: 260px;
            height: auto !important;
          }

          /* host that wraps the editor should also allow scroll if content grows */
          #yamlHost { 
            overflow: visible; 
            height: auto;
          }

          /* CodeMirror */
          .CodeMirror{
            height:260px;border:1px solid var(--divider-color);border-radius:12px;
            background:var(--primary-background-color);color:var(--primary-text-color);
            z-index:6;
          }

          /* YAML editor safety / visibility */
          #yamlSec{ z-index:5; }
          #yamlHost, #yamlHost * { touch-action: auto; }
          ha-code-editor, ha-code-editor * { touch-action: auto; }
          ha-code-editor{ display:block; height:260px; z-index:6; }

          /* loading spinners */
          .spin-center{
            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */
          }


          /* marquee selection rectangle */
          .marquee{
            position:absolute; border:1px dashed var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            pointer-events:none; z-index:50;
          }

          /* placeholder tile */
          .ddc-placeholder-inner{
            position: relative;
            display:flex; align-items:center; justify-content:center;
            width:100%; height:100%;
            border-radius:16px;
            overflow: hidden;
            /* cool gradient derived from HA primary color */
            background:
              radial-gradient(120% 120% at 100% 0%,
                color-mix(in srgb, var(--primary-color) 18%, #000 0%) 0%,
                transparent 60%),
              linear-gradient(135deg,
                color-mix(in srgb, var(--primary-color) 70%, #000 0%) 0%,
                color-mix(in srgb, var(--primary-color) 35%, #000 0%) 100%);
          }

          /* subtle shine */
          .ddc-placeholder-inner::after{
            content:"";
            position:absolute; inset:0;
            background: radial-gradient(120% 90% at 0% 100%, rgba(255,255,255,.15), transparent 60%);
            pointer-events:none;
          }

          /* center stack */
          .ddc-hero{
            position:absolute; inset:0;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            gap:16px; text-align:center; padding:24px;
            color:rgba(255,255,255,.98);
            text-shadow:0 1px 2px rgba(0,0,0,.35);
            user-select:none; pointer-events:none; /* click goes to shield below */
          }

          .ddc-hero img{
            width:128px; height:128px; object-fit:contain; opacity:.95; filter: drop-shadow(0 4px 14px rgba(0,0,0,.25));
          }

          .ddc-hero .ddc-title{
            font-weight:800; font-size:1.25rem; letter-spacing:.2px;
          }

          .ddc-hero .ddc-sub{
            font-weight:600; opacity:.95;
          }

          /* --- hold-to-edit ring (cursor progress) --- */
          .ddc-press-ring{
            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;
            margin-left:-22px; margin-top:-22px;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
          }
          .ddc-press-ring svg{width:44px;height:44px}
          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}
          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}
          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}

          /* --- edit-mode ripple transition --- */
          .ddc-ripple-veil{
            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;
            mix-blend-mode: screen;
          }
          .ddc-ripple-veil::before{
            content:""; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);
            width:0px; height:0px; transform: translate(-50%,-50%);
            border-radius:50%;
            background:
              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),
              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);
            filter: blur(12px);
            animation: ddc-ripple-grow 900ms ease-out forwards;
          }
          .ddc-ripple-veil::after{
            content:""; position:absolute; inset:-20%;
            background:
              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);
            opacity:0;
            animation: ddc-ripple-scan 900ms ease-out forwards;
          }
          @keyframes ddc-ripple-grow{
            0%   { width:0; height:0; opacity:.9 }
            60%  { width:150vmax; height:150vmax; opacity:.9 }
            100% { width:170vmax; height:170vmax; opacity:0 }
          }
          @keyframes ddc-ripple-scan{
            0%   { transform:scale(.96) rotate(0deg); opacity:0 }
            40%  { opacity:.7 }
            100% { transform:scale(1.06) rotate(2deg); opacity:0 }
          }

                /* --- Tabs bar (DDC) --- */
          /* --- WILD DDC Tabs (drop in and replace your block) --- */

          /* --- DDC Tabs \u2014 Chrome-style, no backdrop, mobile-friendly --- */

          /* --- DDC Tabs \u2014 Chrome-style, fills width, steady hover (no bounce), stronger active shadow --- */

          /* Tabs bar (transparent, no backdrop) */
 /* --- DDC Tabs \u2014 Chrome-style, centered content, smooth tab-change, faint inactive outline --- */

        /* Tabs bar (transparent, no backdrop; fills width) */
        .ddc-tabs{
          position: relative;
          display: flex; flex-wrap: wrap;
          align-items: flex-end; /* Chrome-like baseline */
          gap: 6px;
          padding: 6px 10px;
          width: 100%;
          overflow-x: hidden;
          overflow-y: hidden;
          -webkit-overflow-scrolling: touch;
          scroll-snap-type: x proximity;
          background: transparent;
          border-bottom: 1px solid var(--divider-color, rgba(0,0,0,.12));
          scrollbar-width: thin;
          scrollbar-color: color-mix(in oklab, var(--primary-text-color) 35%, transparent) transparent;
        }
        .ddc-tabs::-webkit-scrollbar { height: 8px; }
        .ddc-tabs::-webkit-scrollbar-thumb {
          background: color-mix(in oklab, var(--primary-text-color) 35%, transparent);
          border-radius: 9999px;
        }
        .ddc-tabs::-webkit-scrollbar-track { background: transparent; }

        /* Tab: fills available width, centered icon+text, no hover bounce */
        .ddc-tab{
          -webkit-tap-highlight-color: transparent;
          position: relative;
          z-index: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;             /* 1) center content */
          text-align: center;                  /* 1) center label text */
          gap: 8px;
          padding: 8px 12px;
          font: 500 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
          letter-spacing: .2px;
          color: color-mix(in oklab, var(--primary-text-color) 75%, #000 0%);
          cursor: pointer;

          /* fill width but remain scrollable when crowded */
          flex: 1 1 clamp(120px, 18%, 280px);
          min-width: clamp(120px, 18%, 280px);
          max-width: 100%;
          scroll-snap-align: start;

          margin: 0;                           /* no overlap for steady layout */
          border: 0;
          background: transparent;

          /* 2&3) keep motion minimal; animate only color/shadow/line */
          transition: color .18s ease, filter .18s ease, box-shadow .18s ease, border-color .18s ease;
        }
        .ddc-tab ha-icon{ --mdc-icon-size:18px; }
        .ddc-tab .ddc-tab-label{ max-width: 100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

        /* 3) Inactive tabs have a faint outline */
        .ddc-tab::before{
          content:"";
          position:absolute;
          inset: 0;
          border-top-left-radius: 14px;
          border-top-right-radius: 14px;
          border: 1px solid color-mix(in oklab, var(--primary-text-color) 12%, transparent); /* faint */
          border-bottom: none;
          background: transparent;
          pointer-events: none;
          z-index: -1;
        }

        /* Subtle hover: clearer text only (no movement) */
        .ddc-tab:hover{
          color: var(--primary-text-color);
          filter: saturate(1.05);
        }

        /* Active tab: elevated, stronger shadow */
        .ddc-tab.active{
          color: var(--primary-text-color);
          z-index: 2;
        }
        .ddc-tab.active::before{
          background: var(--card-background-color, #fff);
          border-color: var(--divider-color, rgba(0,0,0,.18));
          box-shadow:
            0 10px 24px rgba(0,0,0,.16),
            0 4px 10px rgba(0,0,0,.10),
            0 0 0 1px color-mix(in oklab, var(--primary-text-color) 10%, transparent);
          animation: ddc-pop .18s ease-out;  /* quick, pleasing shadow pop */
        }

        /* 2) Animated TOP line \u2013 appears quickly when tab becomes active */
        .ddc-tab::after{
          content:"";
          position:absolute;
          top: -2px; left: 10px; right: 10px;
          height: 0;                            /* hidden by default */
          border-radius: 3px 3px 0 0;
          background: linear-gradient(90deg, var(--primary-color), #ff4ecd, #00e0ff, var(--primary-color));
          background-size: 300% 100%;
          opacity: 0;
          transform: scaleX(0);                  /* prepare for quick reveal */
          transform-origin: 50% 50%;
          transition: transform .16s ease-out, height .16s ease-out, opacity .16s ease-out;
          pointer-events: none;
        }
        .ddc-tab.active::after{
          height: 3px;
          opacity: 1;
          transform: scaleX(1);
          animation: ddc-rainbow 4s linear infinite;
        }

        /* Pressed: keep still (no bounce) */
        .ddc-tab:active{ box-shadow: 0 1px 0 rgba(0,0,0,0); }

        /* Focus ring without motion */
        .ddc-tab:focus-visible{
          outline: none;
          box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary-color) 45%, transparent);
        }

        /* Mobile scaling \u2014 smaller min width & tighter paddings */
        @media (max-width: 640px){
          .ddc-tabs{ gap: 4px; padding: 6px 8px; }
          .ddc-tab{
            flex: 1 1 clamp(96px, 34%, 200px);
            min-width: clamp(96px, 34%, 200px);
            padding: 6px 10px;
            font-size: 12px;
          }
          .ddc-tab::after{ left: 8px; right: 8px; }
        }

        /* Vertical tabs rail (transparent) \u2014 centered content too */
        .ddc-tabs-left{
          display:flex;
          flex-direction:column;
          align-items: stretch;
          width: clamp(150px, 28%, 220px);
          padding: 8px 6px;
          gap: 6px;
          overflow-y: auto;
          overflow-x: hidden;
          border-right: 1px solid var(--divider-color, rgba(0,0,0,.12));
          border-bottom: none;
          background: transparent;
        }
        .ddc-tabs-left .ddc-tab{
          justify-content: center;             /* 1) center in vertical list as well */
          margin: 0;
          border: 1px solid color-mix(in oklab, var(--primary-text-color) 12%, transparent);
          border-radius: 10px;
          padding: 8px 10px;
          flex: 0 0 auto;
        }
        .ddc-tabs-left .ddc-tab::before{ display:none; }
        .ddc-tabs-left .ddc-tab.active{
          background: var(--card-background-color, #fff);
          box-shadow: 0 4px 12px rgba(0,0,0,.12);
        }
        .ddc-tabs-left .ddc-tab.active::after{ display:none; } /* top line is only for horizontal */

        /* Animations */
        @keyframes ddc-rainbow{
          0% { background-position: 0% 50%; }
          100% { background-position: 300% 50%; }
        }
        @keyframes ddc-pop{
          0% { box-shadow: 0 0 0 rgba(0,0,0,0); }
          100% {
            box-shadow:
              0 10px 24px rgba(0,0,0,.16),
              0 4px 10px rgba(0,0,0,.10),
              0 0 0 1px color-mix(in oklab, var(--primary-text-color) 10%, transparent);
          }
        }

        /* Fly\u2011in animation for card wrappers. When the animate_cards
           configuration option is enabled, card wrappers will animate
           into view using this keyframe sequence. Cards translate
           upward while fading in to produce a quick, pleasant fly\u2011in. */
        @keyframes ddc-card-fly-in{
          0%   { opacity: 0; transform: translateY(12px); }
          100% { opacity: 1; transform: translateY(0); }
        }
        /* Apply the fly\u2011in animation to visible cards. The animation
           duration and easing mirror other UI animations for cohesion. */
        .card-wrapper.ddc-fly-in{
          animation: ddc-card-fly-in 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

      
        </style>
        <div class="ddc-root">
          <div class="toolbar">
            <button class="btn" id="addCardBtn" style="display:none">
              <ha-icon icon="mdi:plus"></ha-icon>
              <span style="margin-left:6px">Add Card</span>
            </button>
            <button class="btn secondary" id="reloadBtn" style="display:none">
              <ha-icon icon="mdi:refresh"></ha-icon>
              <span style="margin-left:6px">Reload</span>
            </button>
            <button class="btn secondary" id="diagBtn" style="display:none">
              <ha-icon icon="mdi:play-circle-outline"></ha-icon>
              <span style="margin-left:6px">Diagnostics</span>
            </button>
            <button class="btn secondary" id="exportBtn" style="display:none">
              <ha-icon icon="mdi:download"></ha-icon>
              <span style="margin-left:6px">Export Design</span>
            </button>
            <button class="btn secondary" id="importBtn" style="display:none">
              <ha-icon icon="mdi:upload"></ha-icon>
              <span style="margin-left:6px">Import Design</span>
            </button>

            <!-- Copy and Paste buttons for edit mode -->
            <button class="btn secondary" id="copyBtn" style="display:none">
              <ha-icon icon="mdi:content-copy"></ha-icon>
              <span style="margin-left:6px">Copy</span>
            </button>
            <button class="btn secondary" id="pasteBtn" style="display:none">
              <ha-icon icon="mdi:content-paste"></ha-icon>
              <span style="margin-left:6px">Paste</span>
            </button>

            <!-- Dashboard Settings button -->
            <button class="btn secondary" id="settingsBtn" style="display:none">
              <ha-icon icon="mdi:cog"></ha-icon>
              <span style="margin-left:6px">Dashboard Settings</span>
            </button>
            <button class="btn" id="applyLayoutBtn" style="display:none">
              <ha-icon icon="mdi:content-save"></ha-icon>
              <span style="margin-left:6px">Apply</span>
            </button>
            <button class="btn info" id="exploreBtn" style="display:none" title="Open HADS (Home Assistant Dashboard Store)">
              <ha-icon icon="mdi:storefront-outline"></ha-icon>
              <span>Open HADS</span>
            </button>
            <button class="btn warning" id="exitEditBtn" style="display:none">
              <ha-icon icon="mdi:exit-run"></ha-icon>
              <span>Exit edit mode</span>
            </button>
            <span class="store-badge" id="storeBadge" title="where layout is persisted">storage: local</span>
          </div>
          <div class="ddc-tabs" id="tabsBar" style="display:none"></div>
          <div class="card-container" id="cardContainer"></div>
        </div>
      `,this.cardContainer=this.shadowRoot.querySelector("#cardContainer");try{(D=this._applyBackgroundImageFromConfig)==null||D.call(this)}catch{}this.addButton=this.shadowRoot.querySelector("#addCardBtn"),this.reloadBtn=this.shadowRoot.querySelector("#reloadBtn"),this.diagBtn=this.shadowRoot.querySelector("#diagBtn"),this.exitEditBtn=this.shadowRoot.querySelector("#exitEditBtn"),this.storeBadge=this.shadowRoot.querySelector("#storeBadge"),this.exportBtn=this.shadowRoot.querySelector("#exportBtn"),this.importBtn=this.shadowRoot.querySelector("#importBtn"),this.exploreBtn=this.shadowRoot.querySelector("#exploreBtn"),this.applyLayoutBtn=this.shadowRoot.querySelector("#applyLayoutBtn"),this.copyBtn=this.shadowRoot.querySelector("#copyBtn"),this.pasteBtn=this.shadowRoot.querySelector("#pasteBtn"),this.settingsBtn=this.shadowRoot.querySelector("#settingsBtn"),this.tabsBar=this.shadowRoot.querySelector("#tabsBar"),this.rootEl=this.shadowRoot.querySelector(".ddc-root");try{this._renderTabs(),this._applyActiveTab()}catch{}this._applyGridVars(),this.addButton.addEventListener("click",()=>{this.editMode||this._toggleEditMode(!0),this._openCardManager()}),this.reloadBtn.addEventListener("click",()=>this._initialLoad(!0)),this.diagBtn.addEventListener("click",()=>this._openDiagnostics()),this.exitEditBtn.addEventListener("click",()=>this._toggleEditMode(!1)),this.exportBtn.addEventListener("click",()=>this._exportDesign()),this.importBtn.addEventListener("click",()=>this._importDesign()),this.applyLayoutBtn.addEventListener("click",()=>this._saveLayout(!1)),this.copyBtn&&this.copyBtn.addEventListener("click",()=>this._copySelection()),this.pasteBtn&&this.pasteBtn.addEventListener("click",()=>this._pasteClipboard()),this.settingsBtn&&this.settingsBtn.addEventListener("click",()=>this._openDashboardSettings()),window.addEventListener("keydown",K=>{var X;if(this.editMode){if((K.ctrlKey||K.metaKey)&&(K.key==="s"||K.key==="S")&&(K.preventDefault(),this._saveLayout(!1)),!this.__ddcResizeObs&&this.autoResizeCards){this.__ddcResizeObs=new ResizeObserver(()=>{var W;return(W=this._applyAutoScale)==null?void 0:W.call(this)});try{this.__ddcResizeObs.observe(this)}catch{}try{this.__ddcResizeObs.observe(this.cardContainer)}catch{}try{this.parentElement&&this.__ddcResizeObs.observe(this.parentElement)}catch{}try{this.offsetParent&&this.__ddcResizeObs.observe(this.offsetParent)}catch{}window.addEventListener("resize",this.__ddcOnWinResize=()=>{var W;return(W=this._applyAutoScale)==null?void 0:W.call(this)})}(X=this._applyAutoScale)==null||X.call(this)}}),this.exploreBtn.addEventListener("click",()=>window.open("https://hads.smarti.dev/","_blank","noopener,noreferrer")),this._applyContainerSizingFromConfig(!0),(Q=this._applyAutoScale)==null||Q.call(this),this._installLongPressToEnterEdit(),(B=this._startScaleWatch)==null||B.call(this),window.addEventListener("keydown",K=>{var X;K.key==="Escape"&&this.editMode&&this._toggleEditMode(!1),this.__ddcResizeObs||(this.__ddcResizeObs=new ResizeObserver(()=>{var W;return(W=this._applyAutoScale)==null?void 0:W.call(this)}),this.__ddcResizeObs.observe(this),this.__ddcResizeObs.observe(this.cardContainer),window.addEventListener("resize",this.__ddcOnWinResize=()=>{var W;return(W=this._applyAutoScale)==null?void 0:W.call(this)})),(X=this._applyAutoScale)==null||X.call(this)}),this._installSelectionMarquee(),this.cardContainer.addEventListener("mousedown",K=>{this.editMode&&(K.target.closest(".card-wrapper")||!K.shiftKey&&!K.ctrlKey&&!K.metaKey&&this._clearSelection())})}try{this._isInHaEditorPreview()||this._queueSave("config-change")}catch{}this._updateStoreBadge(),this.cardContainer&&this._toggleEditMode(!1),this.__cfgReady=!0,s&&this.__booted?this._initialLoad(!0):!this.__booted&&this.__probed?(this.__booted=!0,this._initialLoad()):(this._applyContainerSizingFromConfig(!0),(J=this._applyAutoScale)==null||J.call(this),this._resizeContainer())}connectedCallback(){var n,o;try{(n=this._applyHaChromeVisibility_)==null||n.call(this)}catch{}if(this.__keyHandlerBound||(this.__keyHandler=s=>this._onKeyDown_(s),window.addEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!0),this.__boundExitEdit||(this.__boundExitEdit=()=>this._toggleEditMode(!1)),window.addEventListener("pagehide",this.__boundExitEdit),window.addEventListener("beforeunload",this.__boundExitEdit),this.__onVis=()=>{document.visibilityState==="hidden"&&this._toggleEditMode(!1)},document.addEventListener("visibilitychange",this.__onVis),this._toggleEditMode(!1),!this.__visObs){let s=new IntersectionObserver(c=>{c.some(l=>l.isIntersecting)&&requestAnimationFrame(()=>this._applyAutoScale&&this._applyAutoScale())},{root:null,threshold:0});s.observe(this),this.__visObs=s}this.__ddcOnWinResize=this.__ddcOnWinResize||(()=>this._applyAutoScale&&this._applyAutoScale()),window.addEventListener("resize",this.__ddcOnWinResize);try{(o=this.__ddcBindPointerListeners)==null||o.call(this)}catch{}}disconnectedCallback(){var n,o,s,c,l;try{(n=this._setHeaderVisible_)==null||n.call(this,!0),(o=this._setSidebarVisible_)==null||o.call(this,!0)}catch{}try{(s=this._applyHaChromeVisibility_)==null||s.call(this)}catch{}this.__keyHandlerBound&&this.__keyHandler&&(window.removeEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!1,this.__keyHandler=null),this.__keyHandlerBound||(this.__keyHandler=u=>this._onKeyDown_(u),window.addEventListener("keydown",this.__keyHandler),this.__keyHandlerBound=!0),window.removeEventListener("pagehide",this.__boundExitEdit),window.removeEventListener("beforeunload",this.__boundExitEdit),document.removeEventListener("visibilitychange",this.__onVis);try{(c=this.__ddcResizeObs)==null||c.disconnect()}catch{}if(this.__ddcResizeObs=null,(l=this._stopScaleWatch)==null||l.call(this),this.__ddcOnWinResize&&(window.removeEventListener("resize",this.__ddcOnWinResize),this.__ddcOnWinResize=null),this.__lpInstalled&&this.__lpHandlers){let u=this.cardContainer;u==null||u.removeEventListener("mousedown",this.__lpHandlers.mouseDown),window.removeEventListener("mousemove",this.__lpHandlers.mouseMove),window.removeEventListener("mouseup",this.__lpHandlers.mouseUp),window.removeEventListener("contextmenu",this.__lpHandlers.contextMenu),u==null||u.removeEventListener("touchstart",this.__lpHandlers.touchStart),window.removeEventListener("touchmove",this.__lpHandlers.touchMove),window.removeEventListener("touchend",this.__lpHandlers.touchEnd),window.removeEventListener("touchcancel",this.__lpHandlers.touchCancel),this.__lpInstalled=!1,this.__lpHandlers=null}try{this.__visObs&&this.__visObs.disconnect()}catch{}this.__visObs=null,this.__ddcOnWinResize&&window.removeEventListener("resize",this.__ddcOnWinResize);try{this.__ddcPtrBound&&(this.removeEventListener("pointerdown",this.__onDDCPointerDown),this.removeEventListener("pointermove",this.__onDDCPointerMove),window.removeEventListener("pointerup",this.__onDDCPointerUp),window.removeEventListener("pointercancel",this.__onDDCPointerUp),this.__ddcPtrBound=!1)}catch{}}set hass(n){var s;this._hass=n,ll("set hass"),!this.__probed&&n&&(this.__probed=!0,this._probeBackend().then(()=>{this.__probed=!0,!this.__booted&&this.__cfgReady&&(this.__booted=!0,this._initialLoad(!0))}));let o=((s=this.cardContainer)==null?void 0:s.children)||[];for(let c of o){let l=c.firstElementChild;l&&l.hass!==n&&(l.hass=n)}try{this._applyVisibility_()}catch{}}get hass(){return this._hass}async _initialLoad(n=!1){var o,s,c,l,u,f,x,m,y,_,C,P,E,z,I,S;if(!this.__booting){this.__booting=!0;try{this._loading=!0,n&&this.cardContainer&&(this.cardContainer.innerHTML=""),this._dbgPush("boot","Initial load start",{force:n});let O=[],T=null;if(this._backendOK&&this.storageKey)try{T=await this._loadLayoutFromBackend(this.storageKey)}catch(B){this._dbgPush("boot","Backend load failed",{error:String(B)})}if(!T&&this.storageKey){let B=null;try{B=JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`)||"null")}catch{}if(B)if(this._dbgPush("boot","Found local snapshot",{bytes:JSON.stringify(B).length}),this._backendOK)try{await this._saveLayoutToBackend(this.storageKey,B),this._dbgPush("boot","Migrated local -> backend"),T=B}catch(J){this._dbgPush("boot","Migration failed, staying local",{error:String(J)}),T=B}else T=B}!T&&((s=(o=this._config)==null?void 0:o.cards)!=null&&s.length)&&(this._dbgPush("boot","Using embedded config"),T={cards:this._config.cards});let b={...this._config||{}};if(T!=null&&T.options){let{storage_key:B,...J}=T.options;this._applyImportedOptions(J,!0)}else typeof(T==null?void 0:T.grid)=="number"&&this._applyImportedOptions({grid:T.grid},!0);let L=["storage_key","grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","auto_resize_cards"],D={};for(let B of L)b[B]!==void 0&&(D[B]=b[B]);Object.keys(D).length&&this._applyImportedOptions(D,!0);let Q=!1;if((c=T==null?void 0:T.cards)!=null&&c.length){for(let B of T.cards){if(!(B!=null&&B.card)||typeof B.card=="object"&&Object.keys(B.card).length===0){let X=this._makePlaceholderAt(((l=B.position)==null?void 0:l.x)||0,((u=B.position)==null?void 0:u.y)||0,((f=B.size)==null?void 0:f.width)||200,((x=B.size)==null?void 0:x.height)||200);this.cardContainer.appendChild(X);try{this._rebuildOnce(X.firstElementChild)}catch{}Q=!0;continue}let J=await this._createCard(B.card),K=this._makeWrapper(J);this.editMode&&K.classList.add("editing"),K.dataset.tabId=this._normalizeTabId(B.tabId||B.tab_id||this.defaultTab),this._setCardPosition(K,((m=B.position)==null?void 0:m.x)||0,((y=B.position)==null?void 0:y.y)||0),K.style.width=`${(C=(_=B.size)==null?void 0:_.width)!=null?C:14*this.gridSize}px`,K.style.height=`${(E=(P=B.size)==null?void 0:P.height)!=null?E:10*this.gridSize}px`,B.z!=null&&(K.style.zIndex=String(B.z)),this.cardContainer.appendChild(K);try{this._rebuildOnce(K.firstElementChild)}catch{}this._initCardInteract(K),Q=!0}this._resizeContainer(),(z=this._applyAutoScale)==null||z.call(this),this._dbgPush("boot","Layout applied",{count:T.cards.length})}Q||(this._showEmptyPlaceholder(),(I=this._applyAutoScale)==null||I.call(this),this._dbgPush("boot","No saved layout found; showing placeholder")),this._updateStoreBadge(),this._syncEmptyStateUI(),n&&(this._cardModProcessed=!1),setTimeout(()=>{this._processCardModOnce()},100);try{O.forEach(B=>{try{B.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}})}catch{}}finally{this._loading=!1,this.__booting=!1,this.__dirty=!1,(S=this._updateApplyBtn)==null||S.call(this);try{this._renderTabs(),this._applyActiveTab()}catch{}try{this._applyVisibility_()}catch{}}}}_normalizeTabId(n){let o=Array.isArray(this.tabs)?this.tabs.map(s=>s.id):[];return o.length?n&&o.includes(n)?n:this.defaultTab||o[0]:this.defaultTab||"default"}_renderTabs(){var s,c,l;let n=this.tabsBar;if(!n)return;let o=Array.isArray(this.tabs)?this.tabs:[];if(!o.length||o.length===1&&this.hideTabsWhenSingle){n.style.display="none";return}n.style.display="",n.className="ddc-tabs "+(this.tabsPosition==="left"?"ddc-tabs-left":""),n.innerHTML="";for(let u of o){let f=document.createElement("button");f.className="ddc-tab"+(u.id===this.activeTab?" active":""),f.dataset.tabId=u.id,f.title=u.label||u.id,f.innerHTML=`${u.icon?`<ha-icon icon="${u.icon}"></ha-icon>`:""}<span class="ddc-tab-label">${(s=u.label)!=null?s:u.id}</span>`,f.addEventListener("click",()=>{if(this.activeTab!==u.id){this.activeTab=u.id;try{localStorage.setItem(`ddc_lasttab_${this.storageKey}`,u.id)}catch{}this._applyActiveTab(),this._renderTabs();try{this._applyVisibility_()}catch{}}}),n.appendChild(f)}this.rootEl&&this.rootEl.classList.toggle("ddc-tabs-left-layout",this.tabsPosition==="left");try{(c=this._updateTabsA11y_)==null||c.call(this)}catch{}try{(l=this._syncTabsWidth_)==null||l.call(this)}catch{}}_applyActiveTab(){var s,c,l;let n=this._normalizeTabId(this.activeTab);(((c=(s=this.cardContainer)==null?void 0:s.querySelectorAll)==null?void 0:c.call(s,".card-wrapper"))||[]).forEach(u=>{var x;let f=u.dataset.tabId?this._normalizeTabId(u.dataset.tabId):this.defaultTab;if(!this.tabs||!this.tabs.length){u.style.display="",u.inert=!1,u.classList.remove("ddc-hidden");return}f===n?(u.style.display="",u.inert=!1,u.classList.remove("ddc-hidden")):(u.style.display="none",u.inert=!0,u.classList.add("ddc-hidden"),u.classList.remove("ddc-selected"),(x=this._applyAutoScale)==null||x.call(this))});try{this._clearSelection()}catch{}try{this.animateCards&&((l=this._animateCards)==null||l.call(this))}catch{}}_animateCards(){var n,o;try{(((o=(n=this.cardContainer)==null?void 0:n.querySelectorAll)==null?void 0:o.call(n,".card-wrapper"))||[]).forEach(c=>{let l=window.getComputedStyle?window.getComputedStyle(c):null;if(c.style.display==="none"||l&&l.display==="none"||c.classList.contains("ddc-hidden"))return;let f=window.getComputedStyle(c),x=f&&f.transform&&f.transform!=="none"?f.transform:"",m=[{opacity:0,transform:`${x} translateY(12px)`},{opacity:1,transform:`${x}`}];try{c.animate(m,{duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"none"})}catch{c.style.opacity="0",requestAnimationFrame(()=>{c.style.transition="opacity .3s ease",c.style.opacity="1"})}})}catch(s){console.warn("[ddc:animate] animation error",s)}}_addTabSelectorToChip(n,o=null){if(!this.tabs||!this.tabs.length)return;let s=n.querySelector(".chip");if(!s)return;let c=s.querySelector("select.ddc-chip-tab");c||(c=document.createElement("select"),c.className="ddc-chip-tab",c.style.marginLeft="6px",c.title="Assign to tab",s.appendChild(c)),c.innerHTML="";for(let u of this.tabs){let f=document.createElement("option");f.value=u.id,f.textContent=u.label||u.id,c.appendChild(f)}let l=this._normalizeTabId(o||n.dataset.tabId||this.activeTab||this.defaultTab);c.value=l,n.dataset.tabId=l,c.onchange=()=>{n.dataset.tabId=this._normalizeTabId(c.value),this._applyActiveTab();try{this._applyVisibility_()}catch{}try{this._queueSave("tab-change")}catch{}}}_toggleEditMode(n=null){var l,u,f,x,m;try{(l=this.__clearPressTimer)==null||l.call(this)}catch{}let o=n===null?!this.editMode:!!n,s=!this.editMode&&o;if(this.editMode=o,this.editMode=o,this.addButton.style.display=this.editMode?"inline-block":"none",this.reloadBtn.style.display=this.editMode?"inline-block":"none",this.diagBtn.style.display=this.editMode?"inline-block":"none",this.exitEditBtn.style.display=this.editMode?"inline-block":"none",this.exportBtn.style.display=this.editMode?"inline-block":"none",this.importBtn.style.display=this.editMode?"inline-block":"none",this.exploreBtn.style.display=this.editMode?"inline-block":"none",this.storeBadge.style.display=this.editMode?"inline-block":"none",this.applyLayoutBtn.style.display=this.editMode?"inline-block":"none",this.copyBtn&&(this.copyBtn.style.display=this.editMode?"inline-block":"none"),this.pasteBtn&&(this.pasteBtn.style.display=this.editMode?"inline-block":"none"),this.settingsBtn&&(this.settingsBtn.style.display=this.editMode?"inline-block":"none"),this._syncEmptyStateUI(),this.cardContainer.classList.toggle("grid-on",this.editMode),this.cardContainer.querySelectorAll(".card-wrapper").forEach(y=>{y.classList.toggle("editing",this.editMode);let _=y.querySelector(".resize-handle");_&&(_.style.display=this.editMode?"flex":"none"),!y.dataset.placeholder&&window.interact&&window.interact(y).draggable(this.editMode).resizable(this.editMode),y.style.touchAction=this.editMode?"none":"auto"}),this.editMode||this._clearSelection(),this.editMode||(u=this.cardContainer)==null||u.querySelectorAll(".card-wrapper.dragging").forEach(y=>y.classList.remove("dragging")),s){let y=(f=this.__lastHoldX)!=null?f:null,_=(x=this.__lastHoldY)!=null?x:null;this._playEditRipple(y,_)}try{(m=this._applyHaChromeVisibility_)==null||m.call(this)}catch{}}_isInHaEditorPreview(){let n=this;for(;n;){let o=n.nodeType===1&&n.localName?n.localName.toLowerCase():"";if(o==="hui-card-editor"||o==="hui-dialog-edit-card"||o==="hui-card-preview"||o==="ha-dialog"||o==="mwc-dialog")return!0;let s=n.getRootNode&&n.getRootNode();n=n.parentElement||s&&s.host||null}return!1}_installLongPressToEnterEdit(){if(this.__lpInstalled)return;this.__lpInstalled=!0;let n=this.cardContainer;if(!n)return;let o=800,s=18,c=b=>!!b&&typeof b=="object"&&b.nodeType===1,l=(b,L)=>{try{return!!(b&&L&&typeof b.contains=="function"&&c(L)&&b.contains(L))}catch{return!1}},u=b=>l(this.cardContainer,b),f=b=>{var Q,B,J;let L=(B=(Q=b.target)==null?void 0:Q.closest)==null?void 0:B.call(Q,".card-wrapper");if(c(L)&&u(L)&&!L.classList.contains("ddc-placeholder"))return!0;let D=typeof b.composedPath=="function"?b.composedPath():[];for(let K of D)if(c(K)&&u(K)&&(J=K.classList)!=null&&J.contains("card-wrapper")&&!K.classList.contains("ddc-placeholder"))return!0;return!1},x=(b,L)=>{let D=document.createElement("div");D.className="ddc-press-ring",document.body.appendChild(D),Object.assign(D.style,{position:"fixed",left:`${b}px`,top:`${L}px`,zIndex:"100000",width:"44px",height:"44px",pointerEvents:"none",marginLeft:"-22px",marginTop:"-22px",filter:"drop-shadow(0 2px 6px rgba(0,0,0,.35))"}),D.innerHTML=`
      <svg viewBox="0 0 44 44" aria-hidden="true" style="width:44px;height:44px">
        <circle cx="22" cy="22" r="18" style="stroke:rgba(255,255,255,.45);stroke-width:4;fill:none"></circle>
        <circle class="pr-fg" cx="22" cy="22" r="18" style="stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round"></circle>
        <circle cx="22" cy="22" r="2" style="fill:var(--primary-color);opacity:.95"></circle>
      </svg>`;let Q=D.querySelector(".pr-fg"),B=18,J=2*Math.PI*B;return Q.style.strokeDasharray=`${J}`,Q.style.strokeDashoffset=`${J}`,requestAnimationFrame(()=>{Q.style.transition=`stroke-dashoffset ${o}ms linear`,Q.style.strokeDashoffset="0"}),{el:D,move(K,X){D.style.left=`${K}px`,D.style.top=`${X}px`},remove(){try{D.remove()}catch{}}}},m=null,y=null,_=0,C=0,P=null,E=()=>{m&&clearTimeout(m),m=null,y==null||y.remove(),y=null};this.__clearPressTimer=E;let z=b=>{b.pointerType==="mouse"&&b.button!==0||this._isInHaEditorPreview()||!u(b.target)||f(b)||(P=b.pointerId,_=b.clientX,C=b.clientY,this.__lastHoldX=_,this.__lastHoldY=C,y=x(_,C),m=setTimeout(()=>{var D;E();let L=!this.editMode;this._toggleEditMode(L),(D=this._toast)==null||D.call(this,`Edit mode ${L?"enabled":"disabled"}`)},o))},I=b=>{m==null||b.pointerId!==P||(y==null||y.move(b.clientX,b.clientY),(Math.abs(b.clientX-_)>s||Math.abs(b.clientY-C)>s)&&E())},S=b=>{b.pointerId===P&&(E(),P=null)},O=b=>{if(m)return b.preventDefault(),b.stopPropagation(),!1},T=b=>{var D;if(this._isInHaEditorPreview()||!u(b.target)||f(b))return;let L=!this.editMode;this._toggleEditMode(L),(D=this._toast)==null||D.call(this,`Edit mode ${L?"enabled":"disabled"}`)};n.addEventListener("pointerdown",z),window.addEventListener("pointermove",I,{passive:!0}),window.addEventListener("pointerup",S,{passive:!0}),window.addEventListener("pointercancel",S,{passive:!0}),window.addEventListener("contextmenu",O),n.addEventListener("dblclick",T),this.__lpHandlers={onPointerDown:z,onPointerMove:I,onPointerUpOrCancel:S,onContextMenu:O,onDblClick:T}}_isLayoutEmpty(){let n=this.cardContainer;return n?n.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0:!0}_syncEmptyStateUI(){let n=this._isLayoutEmpty();if(this.addButton){let s=this.editMode||n;this.addButton.style.display=s?"inline-block":"none",this.addButton.classList.toggle("cta-empty",!this.editMode&&n)}let o=s=>s&&(s.style.display=this.editMode?"inline-block":"none");o(this.reloadBtn),o(this.diagBtn),o(this.exitEditBtn),o(this.exportBtn),o(this.importBtn),o(this.exploreBtn),o(this.storeBadge),o(this.applyLayoutBtn)}_updateApplyBtn(){this.applyLayoutBtn&&(this.applyLayoutBtn.disabled=!this.__dirty)}_markDirty(n=""){var o;this.__dirty=!0,this._updateApplyBtn(),(o=this._dbgPush)==null||o.call(this,"dirty","Marked dirty",{reason:n})}_playEditRipple(n=null,o=null){let s=this.cardContainer;if(!s)return;let c=s.getBoundingClientRect(),l=n==null?c.left+c.width/2:n,u=o==null?c.top+c.height/2:o,f=l-c.left,x=u-c.top,m=document.createElement("div");m.className="ddc-ripple-veil",m.style.setProperty("--rip-x",`${f}px`),m.style.setProperty("--rip-y",`${x}px`),s.appendChild(m),setTimeout(()=>m.remove(),450)}_initInteract(){this.cardContainer.querySelectorAll(".card-wrapper").forEach(o=>this._initCardInteract(o))}_initCardInteract(n){if(!window.interact||n.dataset.placeholder)return;let o=this.gridSize,s=!!this.dragLiveSnap,l=[window.interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})];if(this.dragLiveSnap){let u=window.interact.snappers.grid({x:this.gridSize,y:this.gridSize});l.push(window.interact.modifiers.snap({targets:[u],range:1/0,offset:"startCoords"}))}window.interact(n).draggable({enabled:this.editMode,inertia:!1,modifiers:l,listeners:{start:u=>{this._selection.has(n)||(!(u!=null&&u.shiftKey)&&!(u!=null&&u.ctrlKey)&&!(u!=null&&u.metaKey)&&this._clearSelection(),this._toggleSelection(n,!0));let f=Array.from(this._selection);this.__groupDrag={leader:n,members:f,startRaw:new Map(f.map(m=>[m,{x:parseFloat(m.getAttribute("data-x-raw"))||parseFloat(m.getAttribute("data-x"))||0,y:parseFloat(m.getAttribute("data-y-raw"))||parseFloat(m.getAttribute("data-y"))||0,w:parseFloat(m.style.width)||m.getBoundingClientRect().width,h:parseFloat(m.style.height)||m.getBoundingClientRect().height}]))},this.__collisionOriginals=new Map,this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").forEach(m=>{let y=parseFloat(m.getAttribute("data-x-raw"))||parseFloat(m.getAttribute("data-x"))||0,_=parseFloat(m.getAttribute("data-y-raw"))||parseFloat(m.getAttribute("data-y"))||0;this.__collisionOriginals.set(m,{x:y,y:_})}),f.forEach(m=>{m.classList.add("dragging"),m.getAttribute("data-x-raw")===null&&m.setAttribute("data-x-raw",m.getAttribute("data-x")||"0"),m.getAttribute("data-y-raw")===null&&m.setAttribute("data-y-raw",m.getAttribute("data-y")||"0")})},move:u=>{if(!this.__groupDrag)return;let f=this.gridSize,x=!!this.dragLiveSnap,m=this.__groupDrag.leader,y=this.__groupDrag.startRaw.get(m),_=(parseFloat(m.getAttribute("data-x-raw"))||y.x)+u.dx,C=(parseFloat(m.getAttribute("data-y-raw"))||y.y)+u.dy,P=_-y.x,E=C-y.y,z=this.__groupDrag.members.map(I=>{let S=this.__groupDrag.startRaw.get(I),O=S.x+P,T=S.y+E,b=x?Math.round(O/f)*f:O,L=x?Math.round(T/f)*f:T;return{el:I,rawX:O,rawY:T,snapX:b,snapY:L,w:S.w,h:S.h}});this.disableOverlap&&this._pushCardsOutOfTheWay(z,P,E,x,f),m.setAttribute("data-x-raw",String(_)),m.setAttribute("data-y-raw",String(C));for(let I of z)I.el.setAttribute("data-x-raw",String(I.rawX)),I.el.setAttribute("data-y-raw",String(I.rawY)),this._setCardPosition(I.el,I.snapX,I.snapY);this._resizeContainer()},end:u=>{if(!this.__groupDrag)return;let f=this.gridSize,x=this.__groupDrag.members.map(m=>{let y=parseFloat(m.getAttribute("data-x-raw"))||parseFloat(m.getAttribute("data-x"))||0,_=parseFloat(m.getAttribute("data-y-raw"))||parseFloat(m.getAttribute("data-y"))||0,C=Math.round(y/f)*f,P=Math.round(_/f)*f,E=parseFloat(m.style.width)||m.getBoundingClientRect().width,z=parseFloat(m.style.height)||m.getBoundingClientRect().height;return{el:m,rawX:y,rawY:_,snapX:C,snapY:P,w:E,h:z}});this.disableOverlap&&this._pushCardsOutOfTheWay(x,0,0,!1,f);for(let m of x)this._setCardPosition(m.el,m.snapX,m.snapY),m.el.setAttribute("data-x-raw",String(m.snapX)),m.el.setAttribute("data-y-raw",String(m.snapY));for(let m of this.__groupDrag.members)m.classList.remove("dragging");this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave(this.__groupDrag.members.length>1?"group-drag-end":"drag-end"),this.__groupDrag=null,this.__collisionOriginals=null}}}),window.interact(n).resizable({enabled:this.editMode,edges:{right:".resize-handle",bottom:".resize-handle"},inertia:!1,listeners:{move:u=>{let f=this.gridSize,x=!!this.dragLiveSnap,m=parseFloat(n.style.width)||n.getBoundingClientRect().width,y=parseFloat(n.style.height)||n.getBoundingClientRect().height,{width:_,height:C}=u.rect,P=x?Math.max(f,Math.round(_/f)*f):_,E=x?Math.max(f,Math.round(C/f)*f):C,z=parseFloat(n.getAttribute("data-x"))||0,I=parseFloat(n.getAttribute("data-y"))||0,S=P,O=E;if(this._isContainerFixed()){let{w:b,h:L}=this._getContainerSize();S=Math.min(P,Math.max(this.gridSize,b-z)),O=Math.min(E,Math.max(this.gridSize,L-I))}let T=[this._rectFor(n,z,I,S,O)];this.disableOverlap&&this._anyCollisionFor(T,new Set([n]))||(n.style.width=`${S}px`,n.style.height=`${O}px`,this._resizeContainer())},end:()=>{let u=this.gridSize,f=parseFloat(n.style.width)||n.getBoundingClientRect().width,x=parseFloat(n.style.height)||n.getBoundingClientRect().height,m=Math.max(u,Math.round(f/u)*u),y=Math.max(u,Math.round(x/u)*u),_=parseFloat(n.getAttribute("data-x"))||0,C=parseFloat(n.getAttribute("data-y"))||0;if(this._isContainerFixed()){let{w:E,h:z}=this._getContainerSize();m=Math.min(m,Math.max(u,E-_)),y=Math.min(y,Math.max(u,z-C))}let P=[this._rectFor(n,_,C,m,y)];this.disableOverlap&&this._anyCollisionFor(P,new Set([n]))||(n.style.width=`${m}px`,n.style.height=`${y}px`),this._resizeContainer(),this._isContainerFixed()&&this._clampAllCardsInside(),this._queueSave("resize-end")}}}),n.addEventListener("mousedown",u=>{this.editMode&&(u.target.closest(".resize-handle")||u.target.closest(".delete-handle")||u.target.closest(".chip")||(u.shiftKey||u.ctrlKey||u.metaKey?(u.stopPropagation(),this._toggleSelection(n)):this._selection.has(n)||(this._clearSelection(),this._toggleSelection(n,!0))))})}async _createCard(n){let s=(await this._helpersPromise||await window.loadCardHelpers()).createCardElement(n);if(s.hass=this.hass,n.type==="custom:mod-card"&&(await new Promise(c=>setTimeout(c,0)),s.setConfig&&typeof s.setConfig=="function"))try{s.setConfig(n)}catch{}return s}_makeWrapper(n){let o=document.createElement("div");o.classList.add("card-wrapper"),o.dataset.tabId=this._normalizeTabId(this.activeTab||this.defaultTab),this.editMode&&o.classList.add("editing"),o.style.zIndex||(o.style.zIndex=String(this._highestZ()+1));let s=document.createElement("div");s.className="chip",s.innerHTML=`
      <button class="mini" data-act="edit" title="Edit" aria-label="Edit">
        <ha-icon icon="mdi:pencil"></ha-icon><span>Edit</span>
      </button>
      <button class="mini" data-act="duplicate" title="Duplicate" aria-label="Duplicate">
        <ha-icon icon="mdi:content-copy"></ha-icon><span>Duplicate</span>
      </button>
      <button class="mini pill" data-act="front" title="Bring forward" aria-label="Bring forward">
        <ha-icon icon="mdi:arrange-bring-forward"></ha-icon>
      </button>
      <button class="mini pill" data-act="back" title="Send backward" aria-label="Send backward">
        <ha-icon icon="mdi:arrange-send-backward"></ha-icon>
      </button>
      <button class="mini pill" data-act="front-most" title="Bring to front" aria-label="Bring to front">
        <ha-icon icon="mdi:arrange-bring-to-front"></ha-icon>
      </button>
      <button class="mini pill" data-act="back-most" title="Send to back" aria-label="Send to back">
        <ha-icon icon="mdi:arrange-send-to-back"></ha-icon>
      </button>
    `;let c=document.createElement("div");c.className="delete-handle",c.innerHTML='<ha-icon icon="mdi:close-thick"></ha-icon>',c.addEventListener("click",f=>{var x,m;f.stopPropagation(),this._selection.size>1&&this._selection.has(o)?(Array.from(this._selection).forEach(_=>_.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),(x=this._ensurePlaceholderIfEmpty)==null||x.call(this)):(o.remove(),this._resizeContainer(),this._queueSave("delete"),(m=this._ensurePlaceholderIfEmpty)==null||m.call(this))});try{this._addTabSelectorToChip(o,o.dataset.tabId)}catch{}s.addEventListener("click",async f=>{var m,y,_,C,P;f.stopPropagation();let x=(_=(y=(m=f.target)==null?void 0:m.closest("button"))==null?void 0:y.dataset)==null?void 0:_.act;if(x){if(x==="delete")this._selection.size>1&&this._selection.has(o)?(Array.from(this._selection).forEach(z=>z.remove()),this._clearSelection(),this._resizeContainer(),this._queueSave("delete-multi"),this._ensurePlaceholderIfEmpty()):(o.remove(),this._resizeContainer(),this._queueSave("delete"),this._ensurePlaceholderIfEmpty());else if(x==="duplicate"||x==="copy"){let E=this._selection.size>1&&this._selection.has(o)?Array.from(this._selection):[o];for(let z of E){let I=this._extractCardConfig(z.firstElementChild)||{},S=await this._createCard(I),O=this._makeWrapper(S);O.style.width=z.style.width,O.style.height=z.style.height;let T=(parseFloat(z.getAttribute("data-x"))||0)+this.gridSize,b=(parseFloat(z.getAttribute("data-y"))||0)+this.gridSize;this._setCardPosition(O,T,b),O.style.zIndex=String(this._highestZ()+1);try{let L=(C=z.dataset)==null?void 0:C.tabId;L&&(O.dataset.tabId=L)}catch{}this.cardContainer.appendChild(O);try{(P=this._addTabSelectorToChip)==null||P.call(this,O,O.dataset.tabId)}catch{}try{this._rebuildOnce(O.firstElementChild)}catch{}this._initCardInteract(O)}this._resizeContainer(),this._queueSave("duplicate")}else if(x==="front")this._adjustZ(o,1);else if(x==="back")this._adjustZ(o,-1);else if(x==="front-most"){let E=this._selection.size>1&&this._selection.has(o)?Array.from(this._selection):[o];E.sort((I,S)=>{let O=parseInt(I.style.zIndex||"1",10),T=parseInt(S.style.zIndex||"1",10);return O-T});let z=this._highestZ();for(let I of E)z+=1,I.style.zIndex=String(z);this._queueSave("z-change")}else if(x==="back-most"){let E=this._selection.size>1&&this._selection.has(o)?Array.from(this._selection):[o];E.sort((S,O)=>{let T=parseInt(S.style.zIndex||"1",10);return parseInt(O.style.zIndex||"1",10)-T});let z=1/0;this.cardContainer.querySelectorAll(".card-wrapper").forEach(S=>{let O=parseInt(S.style.zIndex||"1",10);O<z&&(z=O)}),isFinite(z)||(z=1);let I=z;for(let S of E)I-=1,S.style.zIndex=String(Math.max(1,I));this._queueSave("z-change")}else if(x==="edit"){let E=this._extractCardConfig(o.firstElementChild)||{};await this._openSmartPicker("edit",E,async z=>{var O,T,b;let I=o.firstElementChild,S=await this._createCard(z);try{o.dataset.cfg=JSON.stringify(z),(O=this._hasCardModDeep)!=null&&O.call(this,z)?o.dataset.needsCardMod="true":delete o.dataset.needsCardMod}catch{}o.replaceChild(S,I),await Ui();try{if(S.hass=this.hass,(T=S.requestUpdate)==null||T.call(S),S.updateComplete)try{await S.updateComplete}catch{}}catch{}try{this._rebuildOnce(S)}catch{}try{S.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}(b=this._resizeContainer)==null||b.call(this);try{clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(L){console.warn("Save before reload failed",L)}window.location.reload()})}}});let l=document.createElement("div");l.className="shield";let u=document.createElement("div");u.classList.add("resize-handle"),this.editMode||(u.style.display="none"),u.title="Resize",u.innerHTML='<ha-icon icon="mdi:resize-bottom-right"></ha-icon>';try{let f=n._config||n.config;f&&typeof f=="object"&&Object.keys(f).length&&(o.dataset.cfg=JSON.stringify(f),this._hasCardModDeep(f)&&(o.dataset.needsCardMod="true"))}catch{}o.append(n,l,s,c,u);try{this._rebuildOnce(n)}catch{}return o}_makePlaceholderAt(n=0,o=0,s=400,c=400){let l=document.createElement("div");l.classList.add("card-wrapper","ddc-placeholder"),l.dataset.placeholder="1",this.editMode&&l.classList.add("editing"),this._setCardPosition(l,n,o),l.style.width=`${s}px`,l.style.height=`${c}px`,l.style.zIndex=String(this._highestZ()+1);let u=document.createElement("div");u.className="ddc-placeholder-inner",u.setAttribute("aria-hidden","true");let f=document.createElement("div");f.className="ddc-hero";let x=this.heroImage;if(x){let C=document.createElement("img");C.src=x,C.alt="",f.appendChild(C)}let m=document.createElement("div");m.className="ddc-title",m.textContent="Drag & Drop Card";let y=document.createElement("div");y.className="ddc-sub",y.textContent="Hold me / double click me to enter Edit mode",f.append(m,y),u.appendChild(f),l.addEventListener("dblclick",C=>{C.stopPropagation(),this._toggleEditMode(!0)});let _=document.createElement("div");return _.className="shield",l.append(u,_),l}_processCardModOnce(){var o;if(this._cardModProcessed)return;this._cardModProcessed=!0,(((o=this.cardContainer)==null?void 0:o.querySelectorAll('[data-needs-card-mod="true"]'))||[]).forEach(s=>{let c=s.firstElementChild;if(!c)return;let l=c._config||c.config;if(l){if(l.type==="custom:mod-card")setTimeout(()=>{if(c.updateComplete)c.updateComplete.then(()=>{c.requestUpdate()});else if(c.setConfig)try{c.setConfig({...l})}catch{}},100);else if(l.card_mod&&c.setConfig)try{c.setConfig({...l})}catch{}}})}_showEmptyPlaceholder(){if(this.cardContainer.querySelector(".ddc-placeholder"))return;let n=this._makePlaceholderAt(0,0,200,200);this.cardContainer.appendChild(n),this._resizeContainer(),this._syncEmptyStateUI()}_hideEmptyPlaceholder(){this.cardContainer.querySelectorAll(".ddc-placeholder").forEach(n=>n.remove())}_ensurePlaceholderIfEmpty(){var o;this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length===0&&this._showEmptyPlaceholder(),(o=this._applyAutoScale)==null||o.call(this),this._syncEmptyStateUI()}_adjustZ(n,o){let c=parseInt(n.style.zIndex||"1",10)+o;c=Math.max(1,Math.min(9999,c)),n.style.zIndex=String(c),this._queueSave("z-change")}_highestZ(){let n=0;return this.cardContainer.querySelectorAll(".card-wrapper").forEach(o=>{let s=parseInt(o.style.zIndex||"0",10);s>n&&(n=s)}),n}_setCardPosition(n,o,s){let c=Math.round(o),l=Math.round(s);n.style.transform=`translate3d(${c}px, ${l}px, 0)`,n.setAttribute("data-x",String(c)),n.setAttribute("data-y",String(l)),n.setAttribute("data-x-raw",String(c)),n.setAttribute("data-y-raw",String(l))}_computeDesignSize(){let n=this.cardContainer;if(!n)return{w:1,h:1};if(this._isContainerFixed()){let{w:u,h:f}=this._resolveFixedSize();return{w:Math.max(1,u),h:Math.max(1,f)}}let o=0,s=0,c=Array.from(n.querySelectorAll(".card-wrapper"));if(!c.length){let u=n.getBoundingClientRect();return{w:Math.max(1,u.width||1),h:Math.max(1,u.height||1)}}for(let u of c){let f=parseFloat(u.getAttribute("data-x-raw")||u.getAttribute("data-x")||"0")||0,x=parseFloat(u.getAttribute("data-y-raw")||u.getAttribute("data-y")||"0")||0,m=parseFloat(u.style.width)||u.getBoundingClientRect().width||0,y=parseFloat(u.style.height)||u.getBoundingClientRect().height||0,_=f+m,C=x+y;_>o&&(o=_),C>s&&(s=C)}let l=Math.max(1,this.gridSize||10);return o=Math.ceil(o/l)*l,s=Math.ceil(s/l)*l,{w:Math.max(1,o),h:Math.max(1,s)}}_startScaleWatch(){if(!this.autoResizeCards||this.__scaleRAF)return;let n=()=>{var c;if(!this.autoResizeCards){this.__scaleRAF=null;return}let o=this.getBoundingClientRect(),s=Math.max(1,o.width||0);s!==this.__lastScaleW&&(this.__lastScaleW=s,(c=this._applyAutoScale)==null||c.call(this)),this.__scaleRAF=requestAnimationFrame(n)};this.__scaleRAF=requestAnimationFrame(n)}_stopScaleWatch(){if(this.__scaleRAF){try{cancelAnimationFrame(this.__scaleRAF)}catch{}this.__scaleRAF=null}}_applyAutoScale(){var u,f,x,m,y,_,C,P,E,z;let n=this.cardContainer;if(!n)return;if(typeof this._ensureScaleWrapper=="function"&&this._ensureScaleWrapper(),!this.autoResizeCards){let I=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:n.offsetWidth||1,h:n.offsetHeight||1};if(n.style.width=`${I.w}px`,n.style.height=`${I.h}px`,n.style.transform="scale(1)",n.style.transformOrigin="top left",n.style.position="absolute",n.style.top="0",n.style.left="0",this.__scaleOuter){let S=this.parentElement&&((f=(u=this.parentElement).getBoundingClientRect)==null?void 0:f.call(u).width)||this.offsetParent&&((m=(x=this.offsetParent).getBoundingClientRect)==null?void 0:m.call(x).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||I.w;this.__scaleOuter.style.width=`${Math.max(1,S)}px`,this.__scaleOuter.style.height=`${Math.max(1,I.h)}px`}try{(y=this._syncTabsWidth_)==null||y.call(this)}catch{}return}let o=typeof this._computeDesignSize=="function"?this._computeDesignSize():{w:n.offsetWidth||1,h:n.offsetHeight||1},s=this.parentElement&&((C=(_=this.parentElement).getBoundingClientRect)==null?void 0:C.call(_).width)||this.offsetParent&&((E=(P=this.offsetParent).getBoundingClientRect)==null?void 0:E.call(P).width)||this.getBoundingClientRect&&this.getBoundingClientRect().width||this.offsetWidth||o.w,c=Math.max(1,s),l=Math.min(c/Math.max(1,o.w),1);this.__scaleOuter&&(this.__scaleOuter.style.width=`${c}px`,this.__scaleOuter.style.height=`${Math.max(1,o.h*l)}px`),n.style.width=`${o.w}px`,n.style.height=`${o.h}px`,n.style.transform=`scale(${l})`,n.style.transformOrigin="top left",n.style.position="absolute",n.style.top="0",n.style.left="0";try{(z=this._syncTabsWidth_)==null||z.call(this)}catch{}}_resizeContainer(){var l;let n=this.cardContainer;if(!n||this._isContainerFixed())return;let o=Array.from(n.querySelectorAll(".card-wrapper")),s=0,c=0;o.forEach(u=>{let f=u.getBoundingClientRect(),x=n.getBoundingClientRect(),m=f.left-x.left+f.width,y=f.top-x.top+f.height;s=Math.max(s,m),c=Math.max(c,y)}),n.style.width=`${Math.ceil(s/this.gridSize)*this.gridSize||100}px`,n.style.height=`${Math.ceil(c/this.gridSize)*this.gridSize||100}px`;try{(l=this._syncTabsWidth_)==null||l.call(this)}catch{}}_pushCardsOutOfTheWay(n,o,s,c,l){if(!this.__collisionOriginals)return;let u=new Set(n.map(S=>S.el)),f=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(S=>!S.dataset.placeholder),x=this._isContainerFixed(),{w:m,h:y}=this._getContainerSize();for(let S of f){if(u.has(S))continue;let O=this.__collisionOriginals.get(S);if(O){S.setAttribute("data-x-raw",String(O.x)),S.setAttribute("data-y-raw",String(O.y));let T=c?Math.round(O.x/l)*l:O.x,b=c?Math.round(O.y/l)*l:O.y;this._setCardPosition(S,T,b)}}let _=n.map(S=>({x:S.snapX,y:S.snapY,w:S.w,h:S.h})),C=new Map,P=new Map;for(let S of f){let O=parseFloat(S.style.width)||S.getBoundingClientRect().width,T=parseFloat(S.style.height)||S.getBoundingClientRect().height;P.set(S,{w:O,h:T})}let E=o>0?1:o<0?-1:0,z=s>0?1:s<0?-1:0,I=Math.abs(o)>=Math.abs(s);for(let S of f){if(u.has(S))continue;let O=this.__collisionOriginals.get(S);if(!O)continue;let{x:T,y:b}=O,{w:L,h:D}=P.get(S),Q=!1;for(let B of _)if(this._rectsOverlap({x:B.x,y:B.y,w:B.w,h:B.h},{x:T,y:b,w:L,h:D})){Q=!0,I&&E!==0?T=E>0?B.x+B.w:B.x-L:!I&&z!==0?b=z>0?B.y+B.h:B.y-D:T=B.x+B.w;break}if(Q){let B=0,J=I?E!==0?E*l:l:0,K=I?0:z!==0?z*l:l;for(;B<100;){let X={x:T,y:b,w:L,h:D},W=!1;for(let ue of _)if(this._rectsOverlap(X,ue)){W=!0;break}if(!W){for(let[,ue]of C)if(this._rectsOverlap(X,ue)){W=!0;break}}if(!W&&x&&(T<0||b<0||T+L>m||b+D>y)&&(W=!0),!W)break;T+=J,b+=K,B++}x&&(T=Math.max(0,Math.min(T,Math.max(0,m-L))),b=Math.max(0,Math.min(b,Math.max(0,y-D))))}C.set(S,{x:T,y:b,w:L,h:D}),_.push({x:T,y:b,w:L,h:D})}for(let[S,O]of C){S.setAttribute("data-x-raw",String(O.x)),S.setAttribute("data-y-raw",String(O.y));let T=c?Math.round(O.x/l)*l:O.x,b=c?Math.round(O.y/l)*l:O.y;this._setCardPosition(S,T,b)}}_rectFor(n,o=null,s=null,c=null,l=null){let u=o!=null?o:parseFloat(n.getAttribute("data-x"))||0,f=s!=null?s:parseFloat(n.getAttribute("data-y"))||0,x=c!=null?c:parseFloat(n.style.width)||n.getBoundingClientRect().width||0,m=l!=null?l:parseFloat(n.style.height)||n.getBoundingClientRect().height||0;return{x:u,y:f,w:x,h:m,el:n}}_rectsOverlap(n,o,s=.5){return!(n.x+n.w<=o.x+s||o.x+o.w<=n.x+s||n.y+n.h<=o.y+s||o.y+o.h<=n.y+s)}_anyCollisionFor(n,o){let s=Array.from(this.cardContainer.querySelectorAll(".card-wrapper")).filter(l=>!o.has(l)&&!l.dataset.placeholder);if(!s.length)return!1;let c=s.map(l=>this._rectFor(l));for(let l of n)for(let u of c)if(this._rectsOverlap(l,u))return!0;return!1}_extractCardConfig(n){var s;if(!n)return{};let o=n._config||n.config;if(o&&typeof o=="object"&&Object.keys(o).length)return o;try{let c=n.closest?n.closest(".card-wrapper"):null,l=(s=c==null?void 0:c.dataset)==null?void 0:s.cfg;if(l){let u=JSON.parse(l);if(u&&typeof u=="object")return u}}catch{}return{}}async _openCardManager(){await this._openSmartPicker("add")}_catalog(){return[{id:"favorites",name:"Favorites",items:[]},{id:"recent",name:"Recent",items:[]},{id:"basics",name:"Basics",items:[{type:"entities",name:"Entities",icon:"mdi:format-list-bulleted"},{type:"entity",name:"Entity",icon:"mdi:checkbox-blank-circle-outline"},{type:"tile",name:"Tile",icon:"mdi:view-grid-outline"},{type:"button",name:"Button",icon:"mdi:gesture-tap-button"},{type:"glance",name:"Glance",icon:"mdi:eye-outline"},{type:"markdown",name:"Markdown",icon:"mdi:language-markdown"},{type:"custom_card",name:"Custom Card",icon:"mdi:puzzle-outline"}]},{id:"sensors",name:"Sensors",items:[{type:"sensor",name:"Sensor",icon:"mdi:antenna"},{type:"gauge",name:"Gauge",icon:"mdi:gauge"},{type:"history-graph",name:"History graph",icon:"mdi:chart-line"},{type:"statistics-graph",name:"Statistics graph",icon:"mdi:chart-bar"}]},{id:"visual",name:"Visual",items:[{type:"picture-entity",name:"Picture entity",icon:"mdi:image-outline"},{type:"picture-glance",name:"Picture glance",icon:"mdi:image-multiple-outline"},{type:"weather-forecast",name:"Weather",icon:"mdi:weather-partly-cloudy"},{type:"map",name:"Map",icon:"mdi:map"},{type:"iframe",name:"iFrame",icon:"mdi:application"}]},{id:"controls",name:"Controls",items:[{type:"light",name:"Light",icon:"mdi:lightbulb-outline"},{type:"thermostat",name:"Thermostat",icon:"mdi:thermostat"},{type:"media-control",name:"Media control",icon:"mdi:play-circle-outline"},{type:"alarm-panel",name:"Alarm panel",icon:"mdi:shield-home-outline"},{type:"area",name:"Area",icon:"mdi:map-marker"}]}]}async _getEditorElementForType(n,o){try{console.info("[ddc:editor] Requesting editor element",{type:n,cfg:o})}catch{}let s=await this._helpersPromise||await window.loadCardHelpers();try{typeof n=="string"&&n&&!n.startsWith("custom:")&&n!=="custom_card"&&await this._ensureCardModuleLoaded(n,o)}catch{}if(typeof n=="string"&&n==="entity")try{return await this._getEntityCardEditor(o||{})}catch(m){console.warn("[ddc:editor] Custom entity editor failed",m)}let c=async()=>{try{if(s.getCardElementClass)return await s.getCardElementClass(n);let m;if(o&&typeof o=="object")m={type:n,...o};else{let _;try{_=await this._getStubConfigForType(n)}catch{}m=_&&typeof _=="object"?{..._}:{type:n}}let y=s.createCardElement(m);return(y==null?void 0:y.constructor)||null}catch{return null}};try{let m=await c();if(m){if(typeof m.getConfigElement=="function"){let y=await m.getConfigElement();if(y){try{console.info("[ddc:editor] Found static class editor",{type:n})}catch{}return y}}if(typeof m.getConfigForm=="function")try{let y=await m.getConfigForm();if(y&&y.schema){try{await customElements.whenDefined("ha-form")}catch{}let _=document.createElement("ha-form");_.hass=this.hass,_.schema=Array.isArray(y.schema)?y.schema.map(C=>({...C})):y.schema,typeof y.computeLabel=="function"&&(_.computeLabel=y.computeLabel.bind(m)),typeof y.computeHelper=="function"&&(_.computeHelper=y.computeHelper.bind(m)),_.data={...o},_.addEventListener("value-changed",C=>{});try{console.info("[ddc:editor] Generated form editor via getConfigForm",{type:n})}catch{}return _}}catch{}}}catch{}if(typeof n=="string"&&(n.startsWith("custom:")||n==="custom_card"))try{let m;try{m=await this._getStubConfigForType(n)}catch{}let y=m&&typeof m=="object"?{...m}:{type:n},_=s.createCardElement(y);if(_.hass=this.hass,typeof _.getConfigElement=="function"){let C=await _.getConfigElement();if(C){try{console.info("[ddc:editor] Found instance-level editor",{type:n})}catch{}return C}}}catch{}let l=String(n).replace(/^custom:/,""),f=(Array.isArray(window.customCards)?window.customCards:[]).find(m=>(m==null?void 0:m.type)===l||(m==null?void 0:m.type)===n||(m==null?void 0:m.type)===`custom:${l}`),x=[];f!=null&&f.editor&&x.push(f.editor),x.push(`${l}-editor`,`${l}-config-editor`),l&&typeof l=="string"&&x.push(`hui-${l}-card-editor`);for(let m of x)if(!(!m||typeof m!="string"))for(let y of[0,100,300,700,1500,3e3])try{if(customElements.get(m)||await Promise.race([customElements.whenDefined(m),new Promise(_=>setTimeout(_,y))]),customElements.get(m)){try{console.info("[ddc:editor] Found editor by tag",{type:n,tag:m})}catch{}return document.createElement(m)}}catch{}return null}async _ensureCardModuleLoaded(n,o){try{let s=await this._helpersPromise||await window.loadCardHelpers(),c;if(o&&typeof o=="object")c={type:n,...o};else{let f;try{f=await this._getStubConfigForType(n)}catch{}c=f&&typeof f=="object"?{...f}:{type:n}}let l=s.createCardElement(c);l.hass=this.hass;let u=document.createElement("div");u.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;",u.appendChild(l),document.body.appendChild(u),await new Promise(f=>requestAnimationFrame(f)),u.remove();try{console.info("[ddc:editor] Warmed card module",{type:n})}catch{}}catch{}}_ensureOverlayZFix(){if(document.querySelector("style[data-ddc-overlay-fix]"))return;let n=document.createElement("style");n.setAttribute("data-ddc-overlay-fix",""),n.textContent=`
      /* Make common HA overlays float above our modal */
      vaadin-combo-box-overlay,
      vaadin-overlay-backdrop,
      mwc-menu-surface,
      .mdc-menu-surface--open {
        z-index: 1000000 !important;
      }
    `,document.head.appendChild(n)}_customCardsFromRegistry(){return(Array.isArray(window.customCards)?window.customCards:[]).map(o=>{var s;return{type:(s=o==null?void 0:o.type)!=null&&s.startsWith("custom:")?o.type:`custom:${o==null?void 0:o.type}`,name:(o==null?void 0:o.name)||(o==null?void 0:o.type)||"Custom card",icon:"mdi:puzzle-outline",description:(o==null?void 0:o.description)||"",editorTag:(o==null?void 0:o.editor)||null}}).filter(o=>typeof o.type=="string"&&o.type.startsWith("custom:"))}_schemaForType(n){let o=c=>c,s=[];return{entities:o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities"}]}),entity:o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"}]}),sensor:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor"],label:"Sensor"},{key:"name",type:"text",label:"Name (optional)"}]}),gauge:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["sensor","number","input_number"],label:"Numeric entity"},{key:"min",type:"number",label:"Min",step:"any"},{key:"max",type:"number",label:"Max",step:"any"}]}),"history-graph":o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"},{key:"hours_to_show",type:"number",label:"Hours to show",default:24}]}),"statistics-graph":o({fields:[{key:"entities",type:"entities",multi:!0,domains:["sensor","number","input_number"],label:"Entities (multiselect)"},{key:"chart_type",type:"select",options:["line","bar"],label:"Chart type",default:"line"},{key:"statistic",type:"select",options:["mean","min","max","sum"],label:"Statistic",default:"mean"}]}),glance:o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"}]}),"picture-glance":o({fields:[{key:"entities",type:"entities",multi:!0,domains:s,label:"Entities (multiselect)"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"picture-entity":o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"},{key:"image",type:"text",label:"Image URL (optional)"}]}),"weather-forecast":o({fields:[{key:"entity",type:"entity",multi:!1,domains:["weather"],label:"Weather entity"}]}),map:o({fields:[{key:"entities",type:"entities",multi:!0,domains:["device_tracker","person"],label:"Trackers / people (multiselect)"},{key:"default_zoom",type:"number",label:"Default zoom",default:14}]}),"media-control":o({fields:[{key:"entity",type:"entity",multi:!1,domains:["media_player"],label:"Media player"}]}),light:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["light"],label:"Light"}]}),thermostat:o({fields:[{key:"entity",type:"entity",multi:!1,domains:["climate"],label:"Climate"}]}),"alarm-panel":o({fields:[{key:"entity",type:"entity",multi:!1,domains:["alarm_control_panel"],label:"Alarm"}]}),markdown:o({fields:[{key:"content",type:"textarea",label:"Markdown"}]}),tile:o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity"}]}),button:o({fields:[{key:"entity",type:"entity",multi:!1,domains:s,label:"Entity (optional)"}]}),iframe:o({fields:[{key:"url",type:"text",label:"URL"}]}),area:o({fields:[{key:"area",type:"text",label:"Area ID"}]})}[n]||{fields:[]}}async _getEntityCardEditor(n={}){let o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="12px",o.style.padding="8px 0",o.style.overflow="visible",o._cfg={type:"entity",...n||{}};let s=()=>{let O={type:"entity"};["entity","name","icon","attribute","unit","state_color","theme"].forEach(T=>{let b=o._cfg[T];b!==void 0&&b!==""&&b!==null&&(O[T]=b)}),o.dispatchEvent(new CustomEvent("config-changed",{detail:{config:O}}))},c=document.createElement("div");c.style.display="flex",c.style.flexDirection="column",c.style.gap="4px";let l=document.createElement("span");l.textContent="Entity",l.style.fontSize=".8rem",l.style.opacity="0.8";let u=document.createElement("ha-entity-picker");u.setAttribute("label","Select entity"),u.addEventListener("value-changed",O=>{var b,L,D;O.stopPropagation();let T=(D=O.detail&&((b=O.detail.value)!=null?b:O.detail))!=null?D:(L=O.target)==null?void 0:L.value;o._cfg.entity=T||"";try{f()}catch{}s()}),c.appendChild(l),c.appendChild(u),o.appendChild(c);let f=()=>{},x=document.createElement("div");x.style.display="grid",x.style.gridTemplateColumns="1fr 1fr",x.style.columnGap="12px",x.style.rowGap="12px";let m=(O,T)=>{let b=document.createElement("div");b.style.display="flex",b.style.flexDirection="column",b.style.gap="4px";let L=document.createElement("span");L.textContent=O,L.style.fontSize=".8rem",L.style.opacity="0.8",b.appendChild(L),b.appendChild(T),x.appendChild(b)},y;customElements.get("ha-textfield")?(y=document.createElement("ha-textfield"),y.setAttribute("label","Name"),y.addEventListener("input",()=>{o._cfg.name=y.value||void 0,s()})):(y=document.createElement("input"),y.type="text",y.placeholder="Name",y.addEventListener("input",()=>{o._cfg.name=y.value||void 0,s()}),Object.assign(y.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),m("Name",y);let _;customElements.get("ha-icon-picker")?(_=document.createElement("ha-icon-picker"),_.setAttribute("label","Icon"),_.addEventListener("value-changed",O=>{var T;O.stopPropagation(),o._cfg.icon=((T=O.detail)==null?void 0:T.value)||void 0,s()}),Object.assign(_.style,{position:"relative",zIndex:"1000"})):customElements.get("ha-textfield")?(_=document.createElement("ha-textfield"),_.setAttribute("label","Icon"),_.addEventListener("input",()=>{o._cfg.icon=_.value||void 0,s()})):(_=document.createElement("input"),_.type="text",_.placeholder="mdi:icon",_.addEventListener("input",()=>{o._cfg.icon=_.value||void 0,s()}),Object.assign(_.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),m("Icon",_);let C;if(f=()=>{var J,K;let O=[],T=(J=o._cfg)==null?void 0:J.entity,b=o._hass;if(T&&b&&b.states&&b.states[T]&&b.states[T].attributes)try{O=Object.keys(b.states[T].attributes||{}).filter(X=>X&&typeof X=="string"),O.sort()}catch{}let L=C&&typeof C.value!="undefined"?C.value:void 0,D=((C==null?void 0:C.tagName)||"").toLowerCase(),Q={min_color_temp_kelvin:"Minimum color temperature (Kelvin)",max_color_temp_kelvin:"Maximum color temperature (Kelvin)",min_color_temp_mireds:"Minimum color temperature (mireds)",max_color_temp_mireds:"Maximum color temperature (mireds)",min_mireds:"Minimum color temperature (mireds)",max_mireds:"Maximum color temperature (mireds)",effect_list:"Available effects",color_mode:"Color mode",brightness:"Brightness",hs_color:"Hs color",rgb_color:"Rgb color",xy_color:"Xy color",entity_id:"Entity ID",friendly_name:"Friendly name",icon:"Icon"},B=X=>Q[X]?Q[X]:X.split("_").map(W=>W&&(W.toLowerCase()==="kelvin"?"Kelvin":W.toLowerCase()==="mireds"?"mireds":W.charAt(0).toUpperCase()+W.slice(1))).join(" ");if(D==="ha-combo-box"){let X=O.map(W=>({value:W,label:B(W)}));X.unshift({value:"",label:""}),C.items=X,L&&O.includes(L)?C.value=L:C.value=""}else if(D==="ha-select"){C.innerHTML="";let X=document.createElement("mwc-list-item");X.setAttribute("value",""),X.textContent="",C.appendChild(X);for(let W of O){let ue=document.createElement("mwc-list-item");ue.setAttribute("value",W),ue.textContent=B(W),C.appendChild(ue)}L&&O.includes(L)?C.value=L:C.value="",(K=C.requestUpdate)==null||K.call(C)}else if(D==="select"){C.innerHTML="";let X=document.createElement("option");X.value="",X.textContent="",C.appendChild(X);for(let W of O){let ue=document.createElement("option");ue.value=W,ue.textContent=B(W),C.appendChild(ue)}L&&O.includes(L)&&(C.value=L)}},customElements.get("ha-combo-box"))C=document.createElement("ha-combo-box"),C.setAttribute("label","Attribute"),C.setAttribute("item-label-path","label"),C.setAttribute("item-value-path","value"),C.setAttribute("allow-custom-value","false"),C.addEventListener("value-changed",O=>{var b,L;O.stopPropagation();let T=(L=(b=O.detail)==null?void 0:b.value)!=null?L:C.value;o._cfg.attribute=T||void 0,s()});else if(customElements.get("ha-select"))C=document.createElement("ha-select"),C.setAttribute("label","Attribute"),C.addEventListener("selected",O=>{O.stopPropagation(),o._cfg.attribute=C.value||void 0,s()}),Object.assign(C.style,{position:"relative",zIndex:"1000"});else{C=document.createElement("select");let O=document.createElement("option");O.value="",O.textContent="",C.appendChild(O),C.addEventListener("change",T=>{T.stopPropagation(),o._cfg.attribute=C.value||void 0,s()}),Object.assign(C.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),Object.assign(C.style,{position:"relative",zIndex:"1000"})}f(),m("Attribute",C);let P;customElements.get("ha-textfield")?(P=document.createElement("ha-textfield"),P.setAttribute("label","Unit"),P.addEventListener("input",()=>{o._cfg.unit=P.value||void 0,s()})):(P=document.createElement("input"),P.type="text",P.placeholder="Unit",P.addEventListener("input",()=>{o._cfg.unit=P.value||void 0,s()}),Object.assign(P.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),m("Unit",P);let E;if(customElements.get("ha-select"))E=document.createElement("ha-select"),E.setAttribute("label","Theme (optional)"),E.addEventListener("selected",O=>{O.stopPropagation(),o._cfg.theme=E.value||void 0,s()});else{E=document.createElement("select");let O=document.createElement("option");O.value="",O.textContent="",E.appendChild(O),E.addEventListener("change",T=>{T.stopPropagation(),o._cfg.theme=E.value||void 0,s()}),Object.assign(E.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})}m("Theme (optional)",E);let z;customElements.get("ha-switch")?(z=document.createElement("ha-switch"),z.addEventListener("change",()=>{o._cfg.state_color=!!z.checked,s()})):(z=document.createElement("input"),z.type="checkbox",z.addEventListener("change",()=>{o._cfg.state_color=!!z.checked,s()}));let I=document.createElement("div");I.style.display="flex",I.style.alignItems="center",I.style.gap="8px";let S=document.createElement("span");return S.textContent="Show state color",S.style.fontSize=".8rem",S.style.opacity="0.8",I.appendChild(S),I.appendChild(z),x.appendChild(I),o.appendChild(x),o.setConfig=(O={})=>{o._cfg={type:"entity",...O||{}};let T=o._cfg;if(u&&("value"in u&&(u.value=T.entity||""),u.setAttribute&&u.setAttribute("value",T.entity||"")),y&&(y.value=T.name||""),_&&(_.value=T.icon||""),C){try{f()}catch{}C.value=T.attribute||""}P&&(P.value=T.unit||""),E&&(E.value=T.theme||""),z&&"checked"in z&&(z.checked=!!T.state_color)},Object.defineProperty(o,"hass",{get(){return this._hass},set(O){var T;if(this._hass=O,u){try{u.hass=O}catch{}customElements.get("ha-entity-picker")||customElements.whenDefined("ha-entity-picker").then(()=>{var b;try{u.hass=this._hass,(b=u.requestUpdate)==null||b.call(u)}catch{}}).catch(()=>{})}if(_){try{_.hass=O}catch{}customElements.get("ha-icon-picker")||customElements.whenDefined("ha-icon-picker").then(()=>{var b;try{_.hass=this._hass,(b=_.requestUpdate)==null||b.call(_)}catch{}}).catch(()=>{})}if(E){let b=[];O&&O.themes&&(O.themes.themes?b=Object.keys(O.themes.themes):typeof O.themes=="object"&&(b=Object.keys(O.themes).filter(Q=>Q!=="default_theme")));let L=E.value,D=(E.tagName||"").toLowerCase();if(D==="ha-select"){E.innerHTML="";let Q=document.createElement("mwc-list-item");Q.setAttribute("value",""),Q.textContent="",E.appendChild(Q);for(let B of b){let J=document.createElement("mwc-list-item");J.setAttribute("value",B),J.textContent=B,E.appendChild(J)}L&&b.includes(L)?E.value=L:L||(E.value=""),(T=E.requestUpdate)==null||T.call(E)}else if(D==="select"){E.innerHTML="";let Q=document.createElement("option");Q.value="",Q.textContent="",E.appendChild(Q);for(let B of b){let J=document.createElement("option");J.value=B,J.textContent=B,E.appendChild(J)}L&&Array.from(E.options).some(B=>B.value===L)&&(E.value=L)}}try{f()}catch{}}}),o.setConfig(n||{}),o}_shapeBySchema(n,o={}){let s=this._schemaForType(n)||{fields:[]},c={...o,type:n};for(let l of s.fields){let u=c[l.key];if(l.type==="entities"){let x=(Array.isArray(u)?u:u!=null&&u!==""?[u]:[]).filter(Boolean);x.length?c[l.key]=x:delete c[l.key]}else if(l.type==="entity")Array.isArray(u)&&(u=u[0]),u==null||u===""?delete c[l.key]:c[l.key]=String(u);else if(l.type==="number")if(u==null||u==="")delete c[l.key];else{let f=Number(u);Number.isFinite(f)?c[l.key]=f:delete c[l.key]}else(l.type==="select"||l.type==="text"||l.type==="textarea")&&(u==null||u===""?delete c[l.key]:c[l.key]=u)}return c}_statesList(n){var c;let o=Object.keys(((c=this.hass)==null?void 0:c.states)||{});if(!n||!n.length)return o;if(!this.__domainIndex||this.__domainIndex._gen!==o.length){let l={};for(let u of o){let f=u.split(".")[0];(l[f]||(l[f]=[])).push(u)}this.__domainIndex={_gen:o.length,map:l}}let s=[];for(let l of n)this.__domainIndex.map[l]&&s.push(...this.__domainIndex.map[l]);return s}_isNumericEntity(n){var c,l;let o=(l=(c=this.hass)==null?void 0:c.states)==null?void 0:l[n];if(!o)return!1;let s=Number(o.state);return Number.isFinite(s)}_getFaves(){try{return new Set(JSON.parse(localStorage.getItem("ddc_faves")||"[]"))}catch{return new Set}}_setFaves(n){try{localStorage.setItem("ddc_faves",JSON.stringify(Array.from(n)))}catch{}}_getRecent(){try{return JSON.parse(localStorage.getItem("ddc_recent_types")||"[]")}catch{return[]}}_pushRecent(n){try{let o=this._getRecent().filter(s=>s!==n);o.unshift(n),o.length>10&&(o.length=10),localStorage.setItem("ddc_recent_types",JSON.stringify(o))}catch{}}async _ensureCodeMirror(){if(!this.__cmReady){if(!document.querySelector("link[data-cm-core]")){let n=document.createElement("link");n.rel="stylesheet",n.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css",n.setAttribute("data-cm-core",""),document.head.appendChild(n)}await new Promise(n=>{if(window.CodeMirror)return n();let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js",o.onload=n,document.head.appendChild(o)}),await new Promise(n=>{var s,c;if((c=(s=window.CodeMirror)==null?void 0:s.mimeModes)!=null&&c.yaml)return n();let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js",o.onload=n,document.head.appendChild(o)}),this.__cmReady=!0}}async _mountYamlEditor(n,o,s,c){let l=x=>window.jsyaml?window.jsyaml.dump(x):JSON.stringify(x,null,2),u=x=>window.jsyaml?window.jsyaml.load(x):JSON.parse(x);n.innerHTML="";let f=l(o);if(customElements.get("ha-code-editor")){let x=document.createElement("ha-code-editor");x.mode="yaml",x.hass=this.hass,x.value=f,x.style.display="block",x.style.height="260px",n.appendChild(x);let m=!1;return x.addEventListener("value-changed",y=>{var C,P,E;if(m)return;let _=(E=(P=(C=y.detail)==null?void 0:C.value)!=null?P:x.value)!=null?E:"";try{s(u(_))}catch(z){c==null||c(z)}}),{setValue:y=>{var C;let _=l(y);((C=x.value)!=null?C:"")!==_&&(m=!0,x.value=_,m=!1)}}}try{await this._ensureCodeMirror();let x=window.CodeMirror(n,{value:f,mode:"yaml",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),m=!1;return x.on("change",()=>{if(m)return;let y=x.getValue();try{s(u(y))}catch(_){c==null||c(_)}}),{setValue:y=>{let _=l(y);x.getValue()!==_&&(m=!0,x.setValue(_),m=!1)}}}catch{let x=document.createElement("textarea");return x.style.width="100%",x.style.height="260px",x.value=f,x.addEventListener("input",()=>{try{s(u(x.value))}catch(m){c==null||c(m)}}),n.appendChild(x),{setValue:m=>{let y=l(m);x.value!==y&&(x.value=y)}}}}_createVirtualList({container:n,items:o,rowHeight:s=36,renderRow:c}){n.style.position="relative",n.style.overflow="auto";let l=document.createElement("div");l.style.height=`${o.length*s}px`,n.innerHTML="",n.appendChild(l);let u=new Map,f=()=>{let x=n.scrollTop,m=n.clientHeight,y=Math.max(0,Math.floor(x/s)-6),_=Math.min(o.length-1,Math.ceil((x+m)/s)+6);for(let[C,P]of u)(C<y||C>_)&&(P.remove(),u.delete(C));for(let C=y;C<=_;C++){if(u.has(C))continue;let P=c(o[C],C);P.style.position="absolute",P.style.left="0",P.style.right="0",P.style.top=`${C*s}px`,u.set(C,P),n.appendChild(P)}};return n.addEventListener("scroll",f,{passive:!0}),new ResizeObserver(f).observe(n),f(),{refresh(x){if(x){o=x,l.style.height=`${o.length*s}px`;for(let[,m]of u)m.remove();u.clear()}f()}}}async _openSmartPicker(n="add",o=null,s=null){let c=()=>l.remove(),l=document.createElement("div");l.className="modal",l.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true">
        <div class="dlg-head">
          <h3>${n==="edit"?"Edit card":"Add a card"}</h3>
          <div style="display:flex;gap:10px;flex:1">
            <input id="search" placeholder="Search cards (name or type)\u2026" aria-label="search" style="flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)">
          </div>
          <button class="btn secondary" id="cancelBtn"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="addBtn" disabled>${n==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
        <div id="layoutGrid" class="layout">
          <div class="pane" id="leftPane"></div>
          <div class="pane" id="rightPane">
            <div class="rightGrid">
              <div class="sec" id="quickFillSec" style="grid-column:1;grid-row:1">
                <div class="hd">Quick fill <span style="opacity:.7;font-size:.85rem">card-aware</span></div>
                <div class="bd" id="quickFill"></div>
              </div>

              <div class="sec" style="grid-column:2;grid-row:1 / span 3;min-height:0;position:relative">
                <div class="hd">Preview</div>
                <div class="spin-center" id="previewSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0"><div id="cardHost"></div></div>
              </div>

              <div class="sec" id="optionsSec" style="grid-column:1;grid-row:2;min-height:0;position:relative">
                <div class="hd">
                  <span>Card options (official editor)</span>
                  <div id="optTabs" class="tabs">
                    <button id="tabVisual" class="tab active" aria-selected="true">Visual</button>
                    <button id="tabYaml" class="tab">YAML</button>
                    <!-- DDC: Visibility tab allows configuring when the card should be shown -->
                    <button id="tabVis" class="tab">Visibility</button>
                  </div>
                </div>
                <div class="spin-center" id="editorSpin" hidden>
                  <ha-circular-progress indeterminate></ha-circular-progress>
                </div>
                <div class="bd" style="min-height:0">
                  <div id="editorHost"></div>
                  <div id="err" class="err" hidden style="color:var(--error-color);font-size:.9rem"></div>
                </div>
              </div>

              <div class="sec" id="yamlSec" style="grid-column:1;grid-row:3;min-height:0">
                <div class="hd">YAML editor</div>
                <div class="bd" style="min-height:0">
                  <div id="yamlHost"></div>
                  <div id="yamlErr" class="err" hidden style="color:var(--error-color);font-size:.9rem;margin-top:8px"></div>
                </div>
              </div>

              <!-- DDC: Visibility section shares the same grid row as YAML. It is hidden by default and shown when the Visibility tab is selected. -->
              <div class="sec" id="visSec" style="grid-column:1;grid-row:3;min-height:0;display:none">
                <div class="hd">Visibility</div>
                <div class="bd" style="min-height:0">
                  <div id="visHost"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dlg-foot">
          <span style="flex:1;opacity:.75;font-size:.85rem">Tip: use <ha-icon icon="mdi:star-outline"></ha-icon> to favorite cards you use often</span>
          <button class="btn secondary" id="footCancel"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Cancel</span></button>
          <button class="btn" id="footAdd" disabled>${n==="edit"?'<ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Update</span>':'<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add</span>'}
          </button>
        </div>
      </div>`,this.shadowRoot.appendChild(l);let u=l.querySelector("#leftPane"),f=l.querySelector("#addBtn"),x=l.querySelector("#footAdd"),m=l.querySelector("#cancelBtn"),y=l.querySelector("#footCancel"),_=l.querySelector("#search"),C=l.querySelector("#cardHost"),P=l.querySelector("#editorHost"),E=l.querySelector("#editorSpin"),z=l.querySelector("#quickFill"),I=l.querySelector("#yamlHost"),S=l.querySelector("#yamlErr"),O=l.querySelector("#yamlSec"),T=l.querySelector("#tabVisual"),b=l.querySelector("#tabYaml"),L=l.querySelector("#tabVis"),D=l.querySelector("#visSec"),Q=l.querySelector("#visHost"),B=l.querySelector("#err"),J=l.querySelector("#previewSpin"),K=H=>{f.disabled=x.disabled=!H},X=H=>{H?(B.hidden=!1,B.textContent=H):(B.hidden=!0,B.textContent="")},W=this._getFaves(),ue=this._getRecent(),_e=this._catalog(),Ae=_e.find(H=>H.id==="favorites"),Me=_e.find(H=>H.id==="recent"),ge=_e.flatMap(H=>H.items||[]);Ae.items=ge.filter(H=>W.has(H.type)),Me.items=ue.map(H=>ge.find(Y=>Y.type===H)).filter(Boolean);let Oe=this._customCardsFromRegistry();Oe.length&&_e.push({id:"custom",name:"Custom (installed)",items:Oe});let pe=l.querySelector("#quickFillSec");pe&&(pe.style.display="none");let De=l.querySelector("#optionsSec .hd"),Ge,$e,st=()=>{if(!$e)return;let H=ze&&W.has(ze),Y=$e.querySelector("ha-icon");Y&&Y.setAttribute("icon",H?"mdi:star":"mdi:star-outline")},lt=H=>{if(Ge){let Y=ge.find(me=>me.type===H),he=Y?Y.name:H||"";Ge.textContent=he}st()};if(De&&!De.querySelector(".sel-info")){let H=De.querySelector("span");H&&(H.style.display="none"),Ge=document.createElement("span"),Ge.className="sel-info",Ge.style.flex="1",Ge.style.fontWeight="bold",Ge.style.paddingRight="8px",De.insertBefore(Ge,De.firstChild),$e=document.createElement("button"),$e.className="icon-btn",$e.setAttribute("title","Favorite"),Object.assign($e.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--primary-background-color)",padding:"0",marginLeft:"4px",cursor:"pointer"}),$e.innerHTML='<ha-icon icon="mdi:star-outline"></ha-icon>',De.appendChild($e),$e.addEventListener("click",Y=>{Y.stopPropagation(),ze&&(W.has(ze)?W.delete(ze):W.add(ze),this._setFaves(W),st(),Ze())})}let tt="visual",ie=H=>{let Y=H==="yaml",he=H==="vis",me=!Y&&!he;T.classList.toggle("active",me),T.setAttribute("aria-selected",String(me)),b.classList.toggle("active",Y),b.setAttribute("aria-selected",String(Y)),L&&(L.classList.toggle("active",he),L.setAttribute("aria-selected",String(he))),P.parentElement.style.display=me?"":"none",O.style.display=Y?"":"none",D&&(D.style.display=he?"":"none"),Y?O.scrollIntoView({behavior:"smooth",block:"start"}):he&&D&&D.scrollIntoView({behavior:"smooth",block:"start"}),tt=Y?"yaml":he?"vis":"visual"};T.addEventListener("click",async()=>{var H;if(ie("visual"),!we)await Ve(Z);else try{(H=we.setConfig)==null||H.call(we,Z)}catch{}}),b.addEventListener("click",()=>ie("yaml")),L&&L.addEventListener("click",()=>{ie("vis");try{yt(Z)}catch{}}),ie("visual");let dt=()=>{let H=_.value.trim().toLowerCase();return _e.map(Y=>({...Y,items:(Y.items||[]).filter(he=>!H||he.name.toLowerCase().includes(H)||he.type.toLowerCase().includes(H))})).filter(Y=>Y.items&&Y.items.length||Y.id==="favorites"||Y.id==="recent")},Ze=()=>{let H=dt();u.innerHTML="",H.forEach(Y=>{let he=document.createElement("div");he.style.padding="12px",he.style.borderBottom="1px solid var(--divider-color)";let me=document.createElement("h4");if(me.textContent=Y.name,me.style.margin="0 0 10px 0",me.style.fontSize=".92rem",me.style.opacity=".85",he.appendChild(me),!Y.items.length&&(Y.id==="favorites"||Y.id==="recent")){let ae=document.createElement("div");ae.style.opacity=".6",ae.style.fontSize=".85rem",ae.textContent=Y.id==="favorites"?"No favorites yet.":"No recent items yet.",he.appendChild(ae)}else Y.items.forEach(ae=>{let ye=document.createElement("button");ye.innerHTML=`<span style="display:inline-flex;align-items:center;gap:8px">
              <ha-icon icon="${ae.icon}"></ha-icon><span>${ae.name}</span>
            </span>`,Object.assign(ye.style,{display:"block",width:"100%",textAlign:"left",border:"none",background:"transparent",padding:"8px",borderRadius:"10px",cursor:"pointer"}),ye.addEventListener("click",async()=>{Te(ye),await Tt(ae.type)}),he.appendChild(ye)});u.appendChild(he)})},Te=H=>{u.querySelectorAll("button").forEach(Y=>{Y.classList.remove("active"),Y.style.background="transparent",Y.style.color=""}),H&&(H.classList.add("active"),H.style.background="rgba(3,169,244,.12)",H.style.color="var(--primary-color)")},Z=null,ze=null,ke=null,we=null,it=null,nt=0,xt=null,gt="",mt=(H,Y)=>{var F;let he=this._schemaForType(H);if(z.innerHTML="",!he.fields.length){z.innerHTML='<div style="opacity:.7;font-size:.9rem">No quick fill for this card \u2014 use the editors below.</div>';return}let me=Object.keys(((F=this.hass)==null?void 0:F.states)||{}),ae=document.createElement("div"),ye=(ee,Re,q,je)=>{let Ne=document.createElement("div");Object.assign(Ne.style,{padding:"8px 10px",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"8px"}),Ne.innerHTML=`<ha-icon icon="mdi:checkbox-blank-outline"></ha-icon><span>${ee}</span>`,Re.includes(ee)&&(Ne.style.background="rgba(3,169,244,.12)",Ne.style.borderColor="var(--primary-color)",Ne.querySelector("ha-icon").setAttribute("icon","mdi:checkbox-marked")),Ne.addEventListener("click",async()=>{let Xe=Re.indexOf(ee);Xe>=0?Re.splice(Xe,1):Re.push(ee);let Le=Re.includes(ee);Ne.style.background=Le?"rgba(3,169,244,.12)":"",Ne.style.borderColor=Le?"var(--primary-color)":"var(--divider-color)",Ne.querySelector("ha-icon").setAttribute("icon",Le?"mdi:checkbox-marked":"mdi:checkbox-blank-outline"),Z=this._shapeBySchema(H,{...Z,[je]:[...Re]}),rt(Z),ke==null||ke.setValue(Z)}),q.appendChild(Ne)};he.fields.forEach(ee=>{var je,Ne,Xe,Le,Qe,Ye,We,qe,He;let Re=document.createElement("div");Object.assign(Re.style,{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"});let q=document.createElement("label");if(q.textContent=ee.label||ee.key,q.style.minWidth="130px",ee.type==="entities"){let Se=document.createElement("div");Se.style.flex="1";let se=document.createElement("input");Object.assign(se,{placeholder:"Filter entities\u2026"}),Object.assign(se.style,{width:"100%",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)",background:"var(--card-background-color)",color:"var(--primary-text-color)"});let xe=document.createElement("div");Object.assign(xe.style,{maxHeight:"220px",overflow:"auto",marginTop:"8px",border:"1px solid var(--divider-color)",borderRadius:"10px",padding:"6px"});let Pe=ee.domains&&ee.domains.length?this._statesList(ee.domains):me,be=Array.isArray(Y[ee.key])?[...Y[ee.key]]:Y[ee.key]?[Y[ee.key]]:[],re=V=>{let U=document.createElement("div");Object.assign(U.style,{padding:"6px 10px",margin:"4px 0",border:"1px solid var(--divider-color)",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:""});let N=document.createElement("ha-icon");N.setAttribute("icon","mdi:checkbox-blank-outline"),N.style.setProperty("--mdc-icon-size","18px");let le=document.createElement("span");le.textContent=V,le.style.whiteSpace="nowrap",le.style.overflow="hidden",le.style.textOverflow="ellipsis",U.append(N,le);let Ke=()=>{let ot=be.includes(V);U.style.background=ot?"rgba(3,169,244,.12)":"",U.style.borderColor=ot?"var(--primary-color)":"var(--divider-color)",N.setAttribute("icon",ot?"mdi:checkbox-marked":"mdi:checkbox-blank-outline")};return Ke(),U.addEventListener("click",()=>{let ot=be.indexOf(V);ot>=0?be.splice(ot,1):be.push(V),Z=this._shapeBySchema(H,{...Z,[ee.key]:[...be]}),rt(Z),ke==null||ke.setValue(Z),Ke()}),U},te=Pe;this._createVirtualList({container:xe,items:te,rowHeight:36,renderRow:re}),se.addEventListener("input",()=>{let V=se.value.trim().toLowerCase();te=Pe.filter(U=>!V||U.toLowerCase().includes(V)),this._createVirtualList({container:xe,items:te,rowHeight:36,renderRow:re})}),Se.append(se,xe),Re.append(q,Se),Z=this._shapeBySchema(H,{...Y,[ee.key]:be})}if(ee.type==="entity"){let Se=document.createElement("div");Se.style.flex="1",Se.style.position="relative";let se=document.createElement("input");se.setAttribute("list","ddc_entlist_"+ee.key),Object.assign(se.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),se.placeholder=`Select ${((je=ee.label)==null?void 0:je.toLowerCase())||"entity"}\u2026`;let xe=document.createElement("ha-icon");xe.setAttribute("icon","mdi:magnify"),Object.assign(xe.style,{position:"absolute",left:"10px",top:"8px",width:"18px",height:"18px","--mdc-icon-size":"18px",opacity:".7"});let Pe=document.createElement("datalist");Pe.id="ddc_entlist_"+ee.key;let be=ee.domains&&ee.domains.length?this._statesList(ee.domains):Object.keys(((Ne=this.hass)==null?void 0:Ne.states)||{});Pe.innerHTML=be.map(re=>`<option value="${re}">`).join(""),se.value=Array.isArray(Y[ee.key])?Y[ee.key][0]||"":Y[ee.key]||"",se.addEventListener("change",async()=>{Z=this._shapeBySchema(H,{...Z,[ee.key]:se.value||void 0}),rt(Z),ke==null||ke.setValue(Z)}),Se.append(xe,se,Pe),Re.append(q,Se)}if(ee.type==="number"){let Se=document.createElement("div");Se.style.flex="1",Se.style.position="relative";let se=document.createElement("input");se.type="number",ee.step&&(se.step=ee.step),Object.assign(se.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let xe=document.createElement("ha-icon");xe.setAttribute("icon","mdi:counter"),Object.assign(xe.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),se.value=(Le=(Xe=Y[ee.key])!=null?Xe:ee.default)!=null?Le:"",se.addEventListener("input",async()=>{let Pe=se.value===""?void 0:Number(se.value);Z=this._shapeBySchema(H,{...Z,[ee.key]:isNaN(Pe)?void 0:Pe}),rt(Z),ke==null||ke.setValue(Z)}),Se.append(xe,se),Re.append(q,Se)}if(ee.type==="select"){let Se=document.createElement("div");Se.style.flex="1",Se.style.position="relative";let se=document.createElement("select");Object.assign(se.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let xe=document.createElement("ha-icon");xe.setAttribute("icon","mdi:format-list-bulleted"),Object.assign(xe.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),(ee.options||[]).forEach(Pe=>{let be=document.createElement("option");be.value=Pe,se.appendChild(be)}),se.value=(We=(Qe=Y[ee.key])!=null?Qe:ee.default)!=null?We:((Ye=ee.options)==null?void 0:Ye[0])||"",se.addEventListener("change",async()=>{Z=this._shapeBySchema(H,{...Z,[ee.key]:se.value}),rt(Z),ke==null||ke.setValue(Z)}),Se.append(xe,se),Re.append(q,Se)}if(ee.type==="text"){let Se=document.createElement("div");Se.style.flex="1",Se.style.position="relative";let se=document.createElement("input");se.type="text",Object.assign(se.style,{width:"100%",padding:"8px 10px 8px 36px",borderRadius:"10px",border:"1px solid var(--divider-color)"});let xe=document.createElement("ha-icon");xe.setAttribute("icon","mdi:text"),Object.assign(xe.style,{position:"absolute",left:"10px",top:"8px","--mdc-icon-size":"18px",width:"18px",height:"18px",opacity:".7"}),se.value=(qe=Y[ee.key])!=null?qe:"",se.addEventListener("input",async()=>{Z=this._shapeBySchema(H,{...Z,[ee.key]:se.value||void 0}),rt(Z),ke==null||ke.setValue(Z)}),Se.append(xe,se),Re.append(q,Se)}if(ee.type==="textarea"){let Se=document.createElement("textarea");Object.assign(Se.style,{flex:"1",minHeight:"120px",padding:"8px 10px",borderRadius:"10px",border:"1px solid var(--divider-color)"}),Se.value=(He=Y[ee.key])!=null?He:"",Se.addEventListener("input",async()=>{Z=this._shapeBySchema(H,{...Z,[ee.key]:Se.value||""}),rt(Z),ke==null||ke.setValue(Z)}),Re.append(q,Se)}ae.appendChild(Re)}),z.innerHTML="",z.appendChild(ae)},Fe=new WeakMap,Ot=H=>{if(!Q)return;let Y=Array.isArray(H==null?void 0:H.visibility)?H.visibility.map(ye=>({...ye})):[],he=()=>yt(Z),me=()=>{var ye;Y=Y.filter(F=>F&&typeof F=="object"&&F.condition),Z={...Z,visibility:Y};try{ke==null||ke.setValue(Z)}catch{}try{(ye=we==null?void 0:we.setConfig)==null||ye.call(we,Z)}catch{}rt(Z)},ae=()=>{if(Q.innerHTML="",!Y||!Y.length){let F=document.createElement("div");F.style.opacity=".7",F.style.fontSize=".9rem",F.style.marginBottom="8px",F.textContent="No conditions defined \u2013 this card is always visible.",Q.appendChild(F)}Y.forEach((F,ee)=>{let Re=document.createElement("div");Object.assign(Re.style,{display:"flex",flexDirection:"column",gap:"6px",marginBottom:"12px",border:"1px solid var(--divider-color)",borderRadius:"8px",padding:"8px"});let q=document.createElement("div");Object.assign(q.style,{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"});let je=document.createElement("div");je.style.display="flex",je.style.alignItems="center",je.style.gap="6px";let Ne=document.createElement("ha-icon"),Xe="mdi:filter",Le=F.condition||"state";Le==="numeric_state"?Xe="mdi:numeric":Le==="screen"?Xe="mdi:monitor":Le==="user"?Xe="mdi:account":Le==="state"&&(Xe="mdi:state-machine"),Ne.setAttribute("icon",Xe);let Qe=document.createElement("span");Qe.style.fontWeight="bold",Qe.style.textTransform="capitalize",Qe.textContent=Le==="numeric_state"?"Entity numeric state":Le==="state"?"Entity state":Le==="screen"?"Screen":"User",je.appendChild(Ne),je.appendChild(Qe),q.appendChild(je);let Ye=document.createElement("button");Ye.setAttribute("title","Remove condition"),Ye.innerHTML='<ha-icon icon="mdi:trash-can-outline"></ha-icon>',Object.assign(Ye.style,{border:"none",background:"transparent",cursor:"pointer",padding:"4px",display:"inline-flex",alignItems:"center"}),Ye.style.position="relative",Ye.style.zIndex="1000",Ye.addEventListener("click",Pe=>{Pe.preventDefault(),Pe.stopPropagation();let be=Y.indexOf(F);be>-1&&Y.splice(be,1),Z.visibility=Y,ae(),me()}),q.appendChild(Ye),Re.appendChild(q);let We=document.createElement("div");We.style.display="flex",We.style.gap="8px";let qe=document.createElement("label");qe.textContent="Type",qe.style.fontSize=".85rem",qe.style.marginRight="4px";let He=document.createElement("select");["state","numeric_state","screen","user"].forEach(Pe=>{let be=document.createElement("option");be.value=Pe,be.textContent=Pe.replace("_"," "),He.appendChild(be)}),He.value=Le,He.addEventListener("change",()=>{F.condition=He.value,delete F.entity,delete F.state,delete F.state_not,delete F.above,delete F.below,delete F.media_query,delete F.users,ae(),me()}),We.appendChild(qe),We.appendChild(He),Re.appendChild(We);let Se=document.createElement("div");Object.assign(Se.style,{display:"flex",flexWrap:"wrap",gap:"8px",alignItems:"center"});let se=(Pe,be)=>{let re=document.createElement("div");re.style.display="flex",re.style.flexDirection="column",re.style.gap="4px",re.style.minWidth="150px";let te=document.createElement("span");te.textContent=Pe,te.style.fontSize=".75rem",re.appendChild(te),re.appendChild(be),Se.appendChild(re)};(()=>{var Pe,be;if(Se.innerHTML="",F.condition==="state"){let re;customElements.get("ha-entity-picker")?(re=document.createElement("ha-entity-picker"),re.hass=this.hass,re.setAttribute("label","Select entity"),re.removeAttribute("hide-clear-icon"),re.value=F.entity||"",re.addEventListener("value-changed",U=>{U.stopPropagation(),F.entity=U.detail.value||"",me()})):(re=document.createElement("input"),re.value=F.entity||"",re.addEventListener("input",()=>{F.entity=re.value.trim(),me()}),Object.assign(re.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),se("Entity",re);let te;if(customElements.get("ha-select")){te=document.createElement("ha-select");let U=document.createElement("mwc-list-item");U.setAttribute("value","state"),U.textContent="State is equal to";let N=document.createElement("mwc-list-item");N.setAttribute("value","state_not"),N.textContent="State is not equal to",te.appendChild(U),te.appendChild(N),te.value=F.state_not!=null?"state_not":"state",te.addEventListener("selected",le=>{le.stopPropagation();let Ke=F.state_not!=null?F.state_not:F.state;te.value==="state_not"?(F.state_not=Ke,delete F.state):(F.state=Ke,delete F.state_not),me()})}else te=document.createElement("select"),te.innerHTML='<option value="state">State is equal to</option><option value="state_not">State is not equal to</option>',te.value=F.state_not!=null?"state_not":"state",Object.assign(te.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),te.addEventListener("change",U=>{U.stopPropagation();let N=F.state_not!=null?F.state_not:F.state;te.value==="state_not"?(F.state_not=N,delete F.state):(F.state=N,delete F.state_not),me()});se("Match type",te);let V;customElements.get("ha-textfield")?(V=document.createElement("ha-textfield"),V.value=(F.state_not!=null?F.state_not:F.state)||"",V.setAttribute("label",""),V.addEventListener("input",U=>{U.stopPropagation();let N=te.value;F[N]=V.value;let le=N==="state"?"state_not":"state";delete F[le],me()})):(V=document.createElement("input"),V.value=(F.state_not!=null?F.state_not:F.state)||"",Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),V.addEventListener("input",U=>{U.stopPropagation();let N=te.value;F[N]=V.value;let le=N==="state"?"state_not":"state";delete F[le],me()})),se("State",V)}else if(F.condition==="numeric_state"){let re;customElements.get("ha-entity-picker")?(re=document.createElement("ha-entity-picker"),re.hass=this.hass,re.setAttribute("label","Select entity"),re.removeAttribute("hide-clear-icon"),re.value=F.entity||"",re.addEventListener("value-changed",U=>{U.stopPropagation(),F.entity=U.detail.value||"",me()})):(re=document.createElement("input"),re.value=F.entity||"",re.addEventListener("input",()=>{F.entity=re.value.trim(),me()}),Object.assign(re.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})),se("Entity",re);let te;customElements.get("ha-textfield")?(te=document.createElement("ha-textfield"),te.setAttribute("type","number"),te.value=F.above!=null?F.above:"",te.addEventListener("input",U=>{U.stopPropagation();let N=te.value;N===""||isNaN(Number(N))?delete F.above:F.above=Number(N),me()})):(te=document.createElement("input"),te.type="number",te.value=F.above!=null?F.above:"",Object.assign(te.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),te.addEventListener("input",()=>{let U=te.value;U===""||isNaN(Number(U))?delete F.above:F.above=Number(U),me()})),se("Above",te);let V;customElements.get("ha-textfield")?(V=document.createElement("ha-textfield"),V.setAttribute("type","number"),V.value=F.below!=null?F.below:"",V.addEventListener("input",U=>{U.stopPropagation();let N=V.value;N===""||isNaN(Number(N))?delete F.below:F.below=Number(N),me()})):(V=document.createElement("input"),V.type="number",V.value=F.below!=null?F.below:"",Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),V.addEventListener("input",()=>{let U=V.value;U===""||isNaN(Number(U))?delete F.below:F.below=Number(U),me()})),se("Below",V)}else if(F.condition==="screen"){let re=document.createElement("select"),te=[{label:"Custom",value:""},{label:"Mobile (max-width: 599px)",value:"(max-width: 599px)"},{label:"Tablet (600px - 991px)",value:"(min-width: 600px) and (max-width: 991px)"},{label:"Desktop (min-width: 992px)",value:"(min-width: 992px)"}];if(te.forEach(V=>{let U=document.createElement("option");U.value=V.value,U.textContent=V.label,re.appendChild(U)}),re.value=(be=(Pe=te.find(V=>V.value===(F.media_query||"")))==null?void 0:Pe.value)!=null?be:"",re.addEventListener("change",()=>{F.media_query=re.value,me()}),se("Screen size",re),re.value===""){let V=document.createElement("input");V.placeholder="e.g. (min-width: 1280px)",V.value=F.media_query||"",V.addEventListener("input",()=>{F.media_query=V.value,me()}),se("Custom query",V)}}else if(F.condition==="user"){let re;customElements.get("ha-user-picker")?(re=document.createElement("ha-user-picker"),re.hass=this.hass,re.value=Array.isArray(F.users)?F.users:[],re.addEventListener("value-changed",te=>{F.users=Array.isArray(te.detail.value)?te.detail.value:[te.detail.value],me()})):(re=document.createElement("input"),re.value=Array.isArray(F.users)?F.users.join(","):"",re.addEventListener("input",()=>{F.users=re.value.split(",").map(te=>te.trim()).filter(Boolean),me()})),se("Users",re)}})(),Re.appendChild(Se),Q.appendChild(Re)});let ye=document.createElement("button");ye.className="btn",ye.innerHTML='<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add condition</span>',Object.assign(ye.style,{marginTop:"8px"}),ye.addEventListener("click",()=>{Y.push({condition:"state",entity:"",state:""}),Z.visibility=Y,ae(),me()}),Q.appendChild(ye)};ae()},yt=H=>{if(!Q)return;let Y=Array.isArray(H==null?void 0:H.visibility)?H.visibility:[],he=null,me=async()=>{if(he)return he;try{if(this.hass&&typeof this.hass.callWS=="function")try{let ee=await this.hass.callWS({type:"config/auth/list"});if(Array.isArray(ee))return he=ee,ee}catch{}if(this.hass&&typeof this.hass.callApi=="function")try{let ee=await this.hass.callApi("get","users");if(Array.isArray(ee))return he=ee,ee}catch{}let F=[];if(this.hass&&this.hass.users&&Array.isArray(this.hass.users)&&F.push(...this.hass.users),this.hass&&this.hass.userData&&Array.isArray(this.hass.userData.users)&&F.push(...this.hass.userData.users),this.hass&&this.hass.authorizedUsers&&Array.isArray(this.hass.authorizedUsers)&&F.push(...this.hass.authorizedUsers),F.length){let ee=new Map;F.forEach(q=>{let je=q.id||q.user_id||q.uid||q.name||"";ee.has(je)||ee.set(je,q)});let Re=Array.from(ee.values());return he=Re,Re}}catch{}return he=[],[]},ae=()=>{var F;Y=Y.filter(ee=>ee&&typeof ee=="object"&&ee.condition),Z.visibility=Y;try{ke==null||ke.setValue(Z)}catch{}try{(F=we==null?void 0:we.setConfig)==null||F.call(we,Z)}catch{}rt(Z)},ye=()=>{Q.innerHTML="";let F=document.createElement("div");F.style.opacity=".75",F.style.fontSize=".85rem",F.style.marginBottom="12px",F.textContent="The card will be shown when ALL conditions below are fulfilled. If no conditions are set, the card will always be shown.",Q.appendChild(F);let ee=(q,je)=>{q.forEach((Le,Qe)=>{Re(Le,q,Qe,je)});let Ne=document.createElement("div");Ne.style.marginTop="8px";let Xe=document.createElement("button");Xe.className="btn",Xe.innerHTML='<ha-icon icon="mdi:plus"></ha-icon><span style="margin-left:6px">Add condition</span>',Object.assign(Xe.style,{display:"flex",alignItems:"center",gap:"6px",padding:"6px 12px",border:"none",borderRadius:"20px",background:"var(--primary-color)",color:"var(--text-primary-color, #fff)",cursor:"pointer",fontWeight:"500"}),Xe.addEventListener("click",Le=>{Le.stopPropagation();let Qe=Ne.querySelector(".add-menu");if(Qe){Qe.remove();return}let Ye=document.createElement("div");Ye.className="add-menu",Object.assign(Ye.style,{position:"relative",marginTop:"4px",border:"1px solid var(--divider-color)",borderRadius:"8px",background:"var(--card-background-color, var(--secondary-background-color))",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}),[{type:"numeric_state",label:"Entity numeric state",icon:"mdi:numeric"},{type:"state",label:"Entity state",icon:"mdi:state-machine"},{type:"screen",label:"Screen",icon:"mdi:monitor"},{type:"user",label:"User",icon:"mdi:account"},{type:"and",label:"And",icon:"mdi:logic-and"},{type:"or",label:"Or",icon:"mdi:logic-or"}].forEach(qe=>{let He=document.createElement("div");He.style.display="flex",He.style.alignItems="center",He.style.gap="8px",He.style.padding="6px 12px",He.style.cursor="pointer",He.addEventListener("mouseenter",()=>He.style.background="var(--hover-color, #444)"),He.addEventListener("mouseleave",()=>He.style.background=""),He.addEventListener("click",()=>{Ye.remove();let xe;qe.type==="and"||qe.type==="or"?xe={condition:qe.type,conditions:[]}:qe.type==="state"?xe={condition:"state",entity:"",state:""}:qe.type==="numeric_state"?xe={condition:"numeric_state",entity:""}:qe.type==="screen"?xe={condition:"screen",media_query:""}:qe.type==="user"&&(xe={condition:"user",users:[]}),q.push(xe),Fe.set(xe,!0),ae(),ye()});let Se=document.createElement("ha-icon");Se.setAttribute("icon",qe.icon),He.appendChild(Se);let se=document.createElement("span");se.textContent=qe.label,He.appendChild(se),Ye.appendChild(He)}),Ne.appendChild(Ye)}),Ne.appendChild(Xe),je.appendChild(Ne)},Re=(q,je,Ne,Xe)=>{let Le=q.condition||"state",Qe=Fe.get(q);Qe===void 0&&(Qe=Y.length===1);let Ye=document.createElement("div");Object.assign(Ye.style,{display:"flex",flexDirection:"column",border:"1px solid var(--divider-color)",borderLeft:"3px solid var(--primary-color)",borderRadius:"12px",padding:"16px",marginBottom:"20px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",boxShadow:"var(--ha-card-box-shadow, 0 2px 6px rgba(0, 0, 0, 0.15))"});let We=document.createElement("div");We.style.display="flex",We.style.alignItems="center",We.style.justifyContent="space-between",We.style.marginBottom="8px",We.style.borderBottom="1px solid var(--divider-color)",We.style.paddingBottom="4px",We.style.position="relative";let qe=document.createElement("div");qe.style.display="flex",qe.style.alignItems="center",qe.style.gap="6px";let He=document.createElement("button");He.innerHTML=`<ha-icon icon="${Qe?"mdi:chevron-down":"mdi:chevron-right"}"></ha-icon>`,Object.assign(He.style,{border:"none",background:"transparent",cursor:"pointer",padding:"4px",display:"inline-flex",alignItems:"center"}),He.addEventListener("click",be=>{be.stopPropagation(),Fe.set(q,!Qe),ye()}),qe.appendChild(He);let Se=document.createElement("ha-icon"),se="mdi:filter";Le==="numeric_state"?se="mdi:numeric":Le==="screen"?se="mdi:monitor":Le==="user"?se="mdi:account":Le==="state"?se="mdi:state-machine":Le==="and"?se="mdi:logic-and":Le==="or"&&(se="mdi:logic-or"),Se.setAttribute("icon",se),qe.appendChild(Se);let xe=document.createElement("span");xe.style.fontWeight="600",xe.style.fontSize="0.95rem",xe.style.textTransform="capitalize",xe.textContent=Le==="numeric_state"?"Entity numeric state":Le==="state"?"Entity state":Le==="screen"?"Screen":Le==="user"?"User":Le==="and"?"And":"Or",qe.appendChild(xe),We.appendChild(qe);let Pe=document.createElement("button");if(Pe.setAttribute("title","Remove condition"),Pe.innerHTML='<ha-icon icon="mdi:trash-can-outline"></ha-icon>',Object.assign(Pe.style,{border:"none",background:"transparent",cursor:"pointer",padding:"4px",display:"inline-flex",alignItems:"center"}),Pe.style.position="relative",Pe.style.zIndex="1000",Pe.addEventListener("click",be=>{be.preventDefault(),be.stopPropagation();let re=je.indexOf(q);re>-1&&je.splice(re,1),ae(),ye()}),We.appendChild(Pe),Ye.appendChild(We),Le!=="and"&&Le!=="or"){if(Qe){let be=document.createElement("div");Object.assign(be.style,{display:"flex",flexDirection:"column",gap:"14px",alignItems:"stretch"});let re=(te,V)=>{let U=document.createElement("div");U.style.display="flex",U.style.flexDirection="column",U.style.gap="4px";let N=document.createElement("span");N.textContent=te,N.style.fontSize=".75rem",U.appendChild(N),U.appendChild(V),be.appendChild(U);let le=(V.tagName||"").toLowerCase();(le==="input"||le==="select")&&Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"})};if(q.condition==="state"){let te=document.createElement("ha-entity-picker");te.value=q.entity||"",te.hass=this.hass,te.setAttribute("label","Select entity"),te.addEventListener("value-changed",N=>{q.entity=N.detail.value||"",ae()}),customElements.get("ha-entity-picker")||customElements.whenDefined("ha-entity-picker").then(()=>{ye()}).catch(()=>{}),re("Entity",te);let V;if(customElements.get("ha-select")){V=document.createElement("ha-select");let N=document.createElement("mwc-list-item");N.setAttribute("value","state"),N.textContent="State is equal to";let le=document.createElement("mwc-list-item");le.setAttribute("value","state_not"),le.textContent="State is not equal to",V.appendChild(N),V.appendChild(le),V.value=q.state_not!=null?"state_not":"state",V.addEventListener("selected",Ke=>{Ke.stopPropagation();let ot=q.state_not!=null?q.state_not:q.state;V.value==="state_not"?(q.state_not=ot,delete q.state):(q.state=ot,delete q.state_not),ae()})}else V=document.createElement("select"),V.innerHTML='<option value="state">State is equal to</option><option value="state_not">State is not equal to</option>',V.value=q.state_not!=null?"state_not":"state",V.addEventListener("change",N=>{N.stopPropagation();let le=q.state_not!=null?q.state_not:q.state;V.value==="state_not"?(q.state_not=le,delete q.state):(q.state=le,delete q.state_not),ae()}),Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"});re("Match type",V);let U;customElements.get("ha-textfield")?(U=document.createElement("ha-textfield"),U.value=(q.state_not!=null?q.state_not:q.state)||"",U.setAttribute("label",""),U.addEventListener("input",N=>{N.stopPropagation();let le=V.value;q[le]=U.value;let Ke=le==="state"?"state_not":"state";delete q[Ke],ae()})):(U=document.createElement("input"),U.value=(q.state_not!=null?q.state_not:q.state)||"",Object.assign(U.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),U.addEventListener("input",N=>{N.stopPropagation();let le=V.value;q[le]=U.value;let Ke=le==="state"?"state_not":"state";delete q[Ke],ae()})),re("State",U)}else if(q.condition==="numeric_state"){let te=document.createElement("ha-entity-picker");te.value=q.entity||"",te.hass=this.hass,te.setAttribute("label","Select entity"),te.removeAttribute("hide-clear-icon"),te.addEventListener("value-changed",N=>{q.entity=N.detail.value||"",ae()}),customElements.get("ha-entity-picker")||customElements.whenDefined("ha-entity-picker").then(()=>{ye()}).catch(()=>{}),re("Entity",te);let V;customElements.get("ha-textfield")?(V=document.createElement("ha-textfield"),V.setAttribute("type","number"),V.value=q.above!=null?q.above:"",V.addEventListener("input",N=>{N.stopPropagation();let le=V.value;le===""||isNaN(Number(le))?delete q.above:q.above=Number(le),ae()})):(V=document.createElement("input"),V.type="number",V.value=q.above!=null?q.above:"",Object.assign(V.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),V.addEventListener("input",()=>{let N=V.value;N===""||isNaN(Number(N))?delete q.above:q.above=Number(N),ae()})),re("Above",V);let U;customElements.get("ha-textfield")?(U=document.createElement("ha-textfield"),U.setAttribute("type","number"),U.value=q.below!=null?q.below:"",U.addEventListener("input",N=>{N.stopPropagation();let le=U.value;le===""||isNaN(Number(le))?delete q.below:q.below=Number(le),ae()})):(U=document.createElement("input"),U.type="number",U.value=q.below!=null?q.below:"",Object.assign(U.style,{padding:"8px 10px",borderRadius:"8px",background:"var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))",border:"1px solid var(--divider-color)",color:"var(--primary-text-color, inherit)",width:"100%",boxSizing:"border-box"}),U.addEventListener("input",()=>{let N=U.value;N===""||isNaN(Number(N))?delete q.below:q.below=Number(N),ae()})),re("Below",U)}else if(q.condition==="screen"){let te=[{label:"Mobile",query:"(max-width: 599px)"},{label:"Tablet (min: 768px)",query:"(min-width: 768px)"},{label:"Desktop (min: 1024px)",query:"(min-width: 1024px)"},{label:"Wide (min: 1280px)",query:"(min-width: 1280px)"}];Array.isArray(q.media_query_list)||(q.media_query_list=[]);let V=document.createElement("div");V.style.display="flex",V.style.flexDirection="column",V.style.gap="4px",te.forEach(U=>{let N=document.createElement("label");N.style.display="flex",N.style.alignItems="center",N.style.gap="6px";let le=document.createElement("input");le.type="checkbox",le.checked=q.media_query_list.includes(U.query),le.addEventListener("change",()=>{le.checked?q.media_query_list.push(U.query):q.media_query_list=q.media_query_list.filter(ot=>ot!==U.query),q.media_query=q.media_query_list.join(","),ae()});let Ke=document.createElement("span");Ke.textContent=U.label,N.appendChild(le),N.appendChild(Ke),V.appendChild(N)}),re("Screen sizes",V)}else if(q.condition==="user"){let te;if(customElements.get("ha-user-picker"))te=document.createElement("ha-user-picker"),te.hass=this.hass,te.setAttribute("label","Select user"),te.value=Array.isArray(q.users)?q.users:[],te.addEventListener("value-changed",V=>{let U=V.detail.value;q.users=Array.isArray(U)?U:[U],ae()});else{te=document.createElement("div"),te.style.display="flex",te.style.flexDirection="column",te.style.gap="4px";let V=document.createElement("span");V.style.opacity="0.7",V.style.fontSize=".85rem",V.textContent="Loading users\u2026",te.appendChild(V);let U=Array.isArray(q.users)?q.users:[];me().then(N=>{if(te.innerHTML="",Array.isArray(N)&&N.length)N.forEach(le=>{let Ke=le.id||le.user_id||le.uid||le.name||"",ot=le.name||Ke,Et=document.createElement("label");Et.style.display="flex",Et.style.alignItems="center",Et.style.gap="6px",Et.style.padding="4px 0";let _t=document.createElement("input");_t.type="checkbox",_t.checked=U.includes(Ke)||U.includes(ot),_t.addEventListener("change",()=>{let Rt=Array.isArray(q.users)?q.users.slice():[];_t.checked?Rt.includes(Ke)||Rt.push(Ke):Rt=Rt.filter(ni=>ni!==Ke&&ni!==ot),q.users=Rt,ae()});let Ht=document.createElement("span");Ht.textContent=ot,Et.appendChild(_t),Et.appendChild(Ht),te.appendChild(Et)});else{let le=document.createElement("input");le.value=Array.isArray(q.users)?q.users.join(","):"",Object.assign(le.style,{padding:"6px 10px",borderRadius:"6px",border:"1px solid var(--divider-color)",background:"var(--card-background-color, var(--secondary-background-color))",color:"var(--primary-text-color, inherit)"});let Ke=()=>{q.users=le.value.split(",").map(ot=>ot.trim()).filter(Boolean),ae()};le.addEventListener("change",Ke),le.addEventListener("blur",Ke),te.appendChild(le)}})}re("Users",te)}Ye.appendChild(be)}}else if(Qe){Array.isArray(q.conditions)||(q.conditions=[]);let be=document.createElement("div");be.style.marginLeft="16px",ee(q.conditions,be),Ye.appendChild(be)}Xe.appendChild(Ye)};ee(Y,Q)};ye()},rt=H=>{if(((H==null?void 0:H.type)||"")==="custom_card"){gt=JSON.stringify(H||{}),C.innerHTML='<div style="opacity:.6;font-size:.9rem;padding:8px">Preview not available for the custom card placeholder. Use the YAML editor.</div>',J.hidden=!0;return}let Y=JSON.stringify(H||{});Y!==gt&&(gt=Y,xt&&clearTimeout(xt),xt=setTimeout(async()=>{let he=++nt;J.hidden=!1,C.innerHTML="",await Ui();try{let me=await this._helpersPromise||await window.loadCardHelpers();if(he!==nt)return;let ae=me.createCardElement(H);if(ae.hass=this.hass,he!==nt)return;C.appendChild(ae)}catch{}finally{he===nt&&(J.hidden=!0)}},150))},Ve=async H=>{var me;let Y=++nt;E.hidden=!1,P.innerHTML="",await cl();let he=H.type||ze;if(it=await this._getEditorElementForType(he,H),he==="custom_card"){let ae=document.createElement("div");return ae.style.opacity=".7",ae.style.fontSize=".9rem",ae.textContent="Custom card placeholder: use the YAML editor to paste the card type and options.",P.appendChild(ae),we=null,tt!=="yaml"&&ie("yaml"),K(!0),E.hidden=!0,!1}if(!it){let ae=document.createElement("div");return ae.style.opacity=".7",ae.style.fontSize=".9rem",ae.textContent="This card does not support a visual editor. Please use the YAML tab to configure it.",Y===nt&&(P.appendChild(ae),E.hidden=!0),we=null,K(!0),tt!=="visual"&&ie("yaml"),!1}try{it.hass=this.hass,it.isConnected||P.appendChild(it),await Promise.resolve();try{it.setConfig(H)}catch{}try{let ye=await this._helpersPromise||await window.loadCardHelpers(),F=ye.getCardElementClass?await ye.getCardElementClass(H.type||ze):null;if(F!=null&&F.getStubConfig){let ee=Object.keys(((me=this.hass)==null?void 0:me.states)||{}),Re=je=>ee.filter(Ne=>Ne.startsWith(je+".")),q=await F.getStubConfig(this.hass,ee,Re);q&&(H=this._shapeBySchema(H.type||ze,{...q}))}}catch{}await Promise.resolve();try{it.setConfig(H)}catch{}we&&this.__onEditorChange&&(we.removeEventListener("config-changed",this.__onEditorChange),we.removeEventListener("value-changed",this.__onEditorChange));let ae=async ye=>{var Re,q,je;let F=(je=(Re=ye.detail)==null?void 0:Re.config)!=null?je:(q=ye.detail)==null?void 0:q.value;if(!F)return;let ee=F.type||ze;ze=ee,Z=this._shapeBySchema(ee,F),X(""),K(!0),mt(ze,Z),rt(Z),ke==null||ke.setValue(Z)};return this.__onEditorChange=ae,it.addEventListener("config-changed",ae),it.addEventListener("value-changed",ae),we=it,tt!=="yaml"&&ie("visual"),K(!0),!0}finally{Y===nt&&(E.hidden=!0)}},St=async H=>{ke=await this._mountYamlEditor(I,H,async Y=>{var he,me;try{let ae=(Y==null?void 0:Y.type)||ze,ye=this._shapeBySchema(ae,Y||{}),F=ae!==ze;if(ze=ae,Z=ye,S.hidden=!0,S.textContent="",K(!0),F){if(mt(ze,Z),we){try{(he=we.setConfig)==null||he.call(we,Z)}catch{}tt!=="yaml"&&ie("visual")}try{yt(Z)}catch{}}else{try{(me=we==null?void 0:we.setConfig)==null||me.call(we,Z)}catch{}rt(Z);try{yt(Z)}catch{}}}catch(ae){S.hidden=!1,S.textContent=`Invalid config: ${String((ae==null?void 0:ae.message)||ae)}`,K(!1)}},Y=>{S.hidden=!1,S.textContent=`Invalid YAML: ${String((Y==null?void 0:Y.message)||Y)}`,K(!1)})},Dt=async H=>{if(this.__stubCache.has(H))return{...this.__stubCache.get(H)};let Y=await this._getStubConfigForType(H);return this.__stubCache.set(H,{...Y}),{...Y}},Tt=async H=>{S.hidden=!0,S.textContent="",X(""),ze=H;try{typeof lt=="function"&&lt(H)}catch{}let Y=n==="edit"&&o&&o.type===H?{...o}:await Dt(H);Z=this._shapeBySchema(H,Y),we=null,mt(H,Z),await St(Z),await Ui(),rt(Z);try{yt(Z)}catch{}try{let he=await Ve(Z);ie(he?"visual":"yaml")}catch{ie("yaml")}K(!0)},fe=async()=>{if(!Z)return;let H=this._shapeBySchema(ze,Z);n==="edit"&&typeof s=="function"?await s(H):(await this._addPickedCardToLayout(H),this._pushRecent((H||{}).type)),c()};m.addEventListener("click",c),y.addEventListener("click",c),f.addEventListener("click",fe),x.addEventListener("click",fe),l.addEventListener("keydown",H=>{H.key==="Escape"&&c(),H.key==="Enter"&&!f.disabled&&fe()});let Be=null;_.addEventListener("input",()=>{Be&&clearTimeout(Be),Be=setTimeout(Ze,120)}),Ze(),await Tt((()=>{var he;return(((he=this._getRecent)==null?void 0:he.call(this))||[]).find(Boolean)||"entities"})()),K(!0),n==="edit"&&o&&(await Tt(o.type||"entities"),K(!0))}async _getStubConfigForType(n){var m;let o=await this._helpersPromise||await window.loadCardHelpers(),s=null;if(n==="custom_card")return null;try{o.getCardElementClass&&(s=await o.getCardElementClass(n))}catch{}let c=Object.keys(((m=this.hass)==null?void 0:m.states)||{}),l=y=>c.filter(_=>_.startsWith(y+".")),u={type:n};if(s!=null&&s.getStubConfig)try{let y=await s.getStubConfig(this.hass,c,l);if(n!=="entity")return y;y&&typeof y=="object"&&(u={...u,...y})}catch{}let f=c[0],x=l("sensor")[0]||f;if(["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity","weather-forecast","map"].includes(n)){let y={sensor:x,gauge:l("sensor").find(this._isNumericEntity.bind(this))||x,"media-control":l("media_player")[0]||f,light:l("light")[0]||f,thermostat:l("climate")[0]||f,"alarm-panel":l("alarm_control_panel")[0]||f,"weather-forecast":l("weather")[0]||f,map:l("device_tracker")[0]||l("person")[0]||f}[n]||x||f;["entity","sensor","button","gauge","tile","light","thermostat","media-control","alarm-panel","picture-entity"].includes(n)?u.entity=y:n==="weather-forecast"?(u.entity=y,u.show_current=!0,u.show_forecast=!0,u.forecast_type="daily"):n==="map"&&(u.entities=[y].filter(Boolean),u.theme_mode="auto")}if(["entities","glance","picture-glance","history-graph","statistics-graph"].includes(n)){let y=_=>(_!=null&&_.length?c.filter(C=>_.includes(C.split(".")[0])):c).slice(0,3);n==="statistics-graph"?u.entities=y(["sensor","number","input_number"]):u.entities=y()}if(n==="markdown"&&(u.content="Markdown card"),n==="sensor"&&(u.graph="line"),n==="button"&&(u.show_name=!0,u.show_icon=!0),n==="tile"&&(u.features_position="bottom",u.vertical=!1),n==="picture-glance"&&(u.title=u.title||"Glance",u.image=u.image||"https://demo.home-assistant.io/stub_config/kitchen.png"),n==="picture-entity"&&(u.image=u.image||"https://demo.home-assistant.io/stub_config/bedroom.png"),n==="iframe"&&(u.url=u.url||"https://www.home-assistant.io",u.aspect_ratio=u.aspect_ratio||"50%"),n==="alarm-panel"&&(u.states=u.states||["arm_home","arm_away"]),n==="area")try{let y=this.hass&&this.hass.areas?Object.values(this.hass.areas):[];y.length?u.area=y[0].area_id||y[0].name||y[0].id:u.area=f?f.split(".")[0]:"default_area",u.display_type="picture",u.alert_classes=u.alert_classes||["moisture","motion"],u.sensor_classes=u.sensor_classes||["temperature","humidity"],u.features_position="bottom"}catch{}return u}_getNextAvailablePosition(){let n=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")),o=new Set,s=this.gridSize;n.forEach(u=>{let f=parseFloat(u.getAttribute("data-x"))||0,x=parseFloat(u.getAttribute("data-y"))||0,m=parseFloat(getComputedStyle(u).width)||100,y=parseFloat(getComputedStyle(u).height)||100,_=Math.floor(f/s),C=Math.floor(x/s),P=Math.floor((f+m)/s),E=Math.floor((x+y)/s);for(let z=_;z<P;z++)for(let I=C;I<E;I++)o.add(`${z}-${I}`)});let c=0,l=0;for(;o.has(`${c}-${l}`);)c+=6,c>60&&(c=0,l+=6);return{x:c*s,y:l*s}}async _addPickedCardToLayout(n){this._hideEmptyPlaceholder();let o=await this._createCard(n),s=this._makeWrapper(o),c=this._getNextAvailablePosition();this._setCardPosition(s,c.x,c.y),s.style.width=`${14*this.gridSize}px`,s.style.height=`${10*this.gridSize}px`,s.style.zIndex=String(this._highestZ()+1),this.cardContainer.appendChild(s);try{this._rebuildOnce(s.firstElementChild)}catch{}this._initCardInteract(s),this._resizeContainer(),this._queueSave("add"),this._toast("Card added to layout."),this._syncEmptyStateUI();try{this._applyVisibility_()}catch{}}_toggleSelection(n,o=null){let s=o==null?!this._selection.has(n):!!o;s?this._selection.add(n):this._selection.delete(n),n.classList.toggle("selected",s)}_clearSelection(){for(let n of this._selection)n.classList.remove("selected");this._selection.clear()}_copySelection(){var n,o,s;try{let c=this._selection?Array.from(this._selection):[];if(!c.length){(n=this._toast)==null||n.call(this,"Nothing selected to copy.");return}let l=1/0,u=1/0,f=[];for(let x of c){if(x.dataset.placeholder)continue;let m=parseFloat(x.getAttribute("data-x"))||0,y=parseFloat(x.getAttribute("data-y"))||0;m<l&&(l=m),y<u&&(u=y)}for(let x of c){if(x.dataset.placeholder)continue;let m=this._extractCardConfig(x.firstElementChild)||{},y=parseFloat(x.getAttribute("data-x"))||0,_=parseFloat(x.getAttribute("data-y"))||0,C=x.style.width||`${x.getBoundingClientRect().width}px`,P=x.style.height||`${x.getBoundingClientRect().height}px`;f.push({cfg:m,dx:y-l,dy:_-u,width:C,height:P})}window.__DDC_CLIPBOARD__={items:f},(o=this._toast)==null||o.call(this,`Copied ${f.length} card${f.length===1?"":"s"}.`)}catch(c){console.warn("[drag-and-drop-card] Copy failed",c),(s=this._toast)==null||s.call(this,"Copy failed.")}}async _pasteClipboard(){var n,o,s,c;try{let l=window.__DDC_CLIPBOARD__;if(!l||!Array.isArray(l.items)||!l.items.length){(n=this._toast)==null||n.call(this,"Clipboard is empty.");return}let u=l.items,f=1,x;do{let _=this.gridSize*f,C=this.gridSize*f;x=u.map(P=>{let E=parseFloat(P.width)||0,z=parseFloat(P.height)||0;return{x:_+(P.dx||0),y:C+(P.dy||0),w:E,h:z}}),f+=1}while(this._anyCollisionFor(x,new Set));let m=this.gridSize*(f-1),y=this.gridSize*(f-1);for(let _ of u){let C=_.cfg||{},P=await this._createCard(C),E=this._makeWrapper(P);E.style.width=_.width,E.style.height=_.height;let z=m+(_.dx||0),I=y+(_.dy||0);this._setCardPosition(E,z,I),E.style.zIndex=String(this._highestZ()+1);try{let S=this._normalizeTabId(this.activeTab||this.defaultTab);S&&(E.dataset.tabId=S)}catch{}this.cardContainer.appendChild(E);try{this._rebuildOnce(E.firstElementChild)}catch{}this._initCardInteract(E)}this._resizeContainer(),this._applyActiveTab(),(o=this._queueSave)==null||o.call(this,"paste"),(s=this._toast)==null||s.call(this,`Pasted ${u.length} card${u.length===1?"":"s"}.`)}catch(l){console.warn("[drag-and-drop-card] Paste failed",l),(c=this._toast)==null||c.call(this,"Paste failed.")}}_installSelectionMarquee(){let n=this.cardContainer,o=0,s=0,c=null,l=!1,u=_=>{let C=n.getBoundingClientRect(),P="touches"in _&&_.touches[0]?_.touches[0].clientX:_.clientX,E="touches"in _&&_.touches[0]?_.touches[0].clientY:_.clientY;return{x:P-C.left,y:E-C.top}},f=(_,C)=>{let P=Math.min(_,o),E=Math.max(_,o),z=Math.min(C,s),I=Math.max(C,s);c.style.left=`${P}px`,c.style.top=`${z}px`,c.style.width=`${E-P}px`,c.style.height=`${I-z}px`;let S=c.getBoundingClientRect(),O=n.querySelectorAll(".card-wrapper:not(.ddc-placeholder)");this._clearSelection(),O.forEach(T=>{let b=T.getBoundingClientRect();!(b.right<S.left||b.left>S.right||b.bottom<S.top||b.top>S.bottom)&&this._toggleSelection(T,!0)})},x=_=>{if(!this.editMode||_.target.closest(".card-wrapper"))return;l=!0;let C=u(_);o=C.x,s=C.y,c=document.createElement("div"),c.className="marquee",c.style.left=`${o}px`,c.style.top=`${s}px`,n.appendChild(c),_.preventDefault()},m=_=>{!l||!c||f(u(_).x,u(_).y)},y=()=>{l&&(l=!1,c&&c.remove(),c=null)};n.addEventListener("mousedown",x),window.addEventListener("mousemove",m),window.addEventListener("mouseup",y),n.addEventListener("touchstart",_=>{this.editMode&&(_.target.closest(".card-wrapper")||x(_))},{passive:!1}),window.addEventListener("touchmove",_=>{m(_)},{passive:!1}),window.addEventListener("touchend",y),window.addEventListener("touchcancel",y)}async _openDiagnostics(){var f,x;let n=document.createElement("div");n.className="modal";let o=this.storageKey||"(none)",s=this._backendOK&&!!this.storageKey,c=m=>m.slice(-200).map(y=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
        <span style="opacity:.6">${y.t}</span>
        <b style="margin-left:6px;color:#03a9f4">[${y.kind}]</b>
        <span style="margin-left:6px">${this._safe(y.msg)}</span>
        ${y.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(y.extra,null,2))}</pre>`:""}
      </div>`).join("");n.innerHTML=`
      <div class="dialog" style="max-width:1100px;width:min(1100px,95%);height:min(90vh,860px)">
        <div class="dlg-head">
          <h3>Drag & Drop \u2014 Diagnostics</h3>
          <button class="btn secondary" id="closeDiag"><ha-icon icon="mdi:close"></ha-icon><span style="margin-left:6px">Close</span></button>
        </div>
        <div style="display:block;overflow:auto;padding:12px">
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Status</div>
            <div class="bd" style="padding:12px">
              <div style="display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center">
                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(((f=this._config)==null?void 0:f.storage_key)||"")}</code> \u2192 <code>${this._safe(o)}</code></div>
                <div>Backend reachable</div><div><b>${this._backendOK?"YES":"NO"}</b></div>
                <div>Persist target</div><div><b>${s?"Host (backend)":"Browser (localStorage)"}</b></div>
                <div>Auto-save</div><div>${this.autoSave?`ON (${this.autoSaveDebounce} ms)`:"OFF"}</div>
                <div>Cards mounted</div><div>${((x=this.cardContainer)==null?void 0:x.querySelectorAll(".card-wrapper:not(.ddc-placeholder)").length)||0}</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="testRoundtrip"><ha-icon icon="mdi:sync"></ha-icon><span style="margin-left:6px">Test backend round-trip</span></button>
                <button class="btn secondary" id="exportJson"><ha-icon icon="mdi:download"></ha-icon><span style="margin-left:6px">Export JSON</span></button>
                <button class="btn secondary" id="importJson"><ha-icon icon="mdi:upload"></ha-icon><span style="margin-left:6px">Import JSON</span></button>
                <button class="btn" id="forceSave"><ha-icon icon="mdi:content-save"></ha-icon><span style="margin-left:6px">Force save now</span></button>
                <button class="btn secondary" id="refreshKeys"><ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh backend keys</span></button>
              </div>
            </div>
          </div>
          <div class="section" style="border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600">Logs (latest)</div>
            <div class="bd" id="logArea" style="padding:12px;max-height:420px;overflow:auto">${c(this._dbgDump())}</div>
          </div>
        </div>
      </div>`;let l=()=>n.remove();n.querySelector("#closeDiag").addEventListener("click",l),this.shadowRoot.appendChild(n);let u=()=>{let m=n.querySelector("#logArea"),y=_=>_.slice(-200).map(C=>`<div style="font-family:monospace;font-size:.85rem;line-height:1.3">
          <span style="opacity:.6">${C.t}</span>
          <b style="margin-left:6px;color:#03a9f4">[${C.kind}]</b>
          <span style="margin-left:6px">${this._safe(C.msg)}</span>
          ${C.extra?`<pre style="margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto">${this._safe(JSON.stringify(C.extra,null,2))}</pre>`:""}
        </div>`).join("");m.innerHTML=y(this._dbgDump()),m.scrollTop=m.scrollHeight};n.querySelector("#refreshKeys").addEventListener("click",async()=>{try{this._dbgPush("probe","Manual refresh"),await this._probeBackend()}finally{u()}}),n.querySelector("#forceSave").addEventListener("click",async()=>{await this._saveLayout(!1),u()}),n.querySelector("#exportJson").addEventListener("click",()=>{let y=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(E=>{let z=parseFloat(E.getAttribute("data-x"))||0,I=parseFloat(E.getAttribute("data-y"))||0,S=parseFloat(E.style.width)||E.getBoundingClientRect().width,O=parseFloat(E.style.height)||E.getBoundingClientRect().height,T=parseInt(E.style.zIndex||"1",10),b=this._extractCardConfig(E.firstElementChild),L=E.dataset.tabId||this.defaultTab;return{card:b,position:{x:z,y:I},size:{width:S,height:O},z:T,tabId:L}}),_={version:2,options:this._exportableOptions(),cards:y},C=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),P=document.createElement("a");P.href=URL.createObjectURL(C),P.download=`ddc_${this.storageKey||"layout"}.json`,P.click(),URL.revokeObjectURL(P.href)}),n.querySelector("#importJson").addEventListener("click",async()=>{let m=document.createElement("input");m.type="file",m.accept="application/json",m.onchange=async()=>{var P,E,z,I,S,O,T,b,L,D,Q,B,J;let y=(P=m.files)==null?void 0:P[0];if(!y)return;let _=await y.text();try{let K=JSON.parse(_);if(this._dbgPush("import","Loaded file",{bytes:_.length}),this.cardContainer.innerHTML="",(E=K.cards)!=null&&E.length)for(let X of K.cards)if(!(X!=null&&X.card)||typeof X.card=="object"&&Object.keys(X.card).length===0){let W=this._makePlaceholderAt(((z=X.position)==null?void 0:z.x)||0,((I=X.position)==null?void 0:I.y)||0,((S=X.size)==null?void 0:S.width)||200,((O=X.size)==null?void 0:O.height)||200);this.cardContainer.appendChild(W)}else{let W=await this._createCard(X.card),ue=this._makeWrapper(W);this._setCardPosition(ue,((T=X.position)==null?void 0:T.x)||0,((b=X.position)==null?void 0:b.y)||0),ue.dataset.tabId=this._normalizeTabId(X.tabId||X.tab_id||this.defaultTab),this._setCardPosition(ue,((L=X.position)==null?void 0:L.x)||0,((D=X.position)==null?void 0:D.y)||0),ue.style.width=`${((Q=X.size)==null?void 0:Q.width)||140}px`,ue.style.height=`${((B=X.size)==null?void 0:B.height)||100}px`,this.cardContainer.appendChild(ue);try{this._rebuildOnce(ue.firstElementChild)}catch{}this._initCardInteract(ue)}else this._showEmptyPlaceholder(),(J=this._applyAutoScale)==null||J.call(this);this._resizeContainer(),await this._saveLayout(!1)}catch(K){this._dbgPush("import","Parse failed",{error:String(K)})}let C=new Event("ddc-logrefresh");window.dispatchEvent(C)},m.click()}),n.querySelector("#testRoundtrip").addEventListener("click",async()=>{if(!this._backendOK)return this._dbgPush("test","Backend not reachable, aborting"),u();let m=(this.storageKey||"ddc_test")+"_selftest",y={t:Date.now(),msg:"roundtrip"};try{await this._saveLayoutToBackend(m,y);let _=await this._loadLayoutFromBackend(m);this._dbgPush("test","Round-trip result",{wrote:y,read:_})}catch(_){this._dbgPush("test","Round-trip failed",{error:String(_)})}u()}),u()}_openDashboardSettings(){var T,b,L,D,Q,B,J;let n=document.createElement("div");n.className="modal",n.innerHTML=`
      <div class="dialog" role="dialog" aria-modal="true" style="max-width:600px">
        <div class="dlg-head" style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--divider-color,rgba(0,0,0,.12))">
          <h3 style="margin:0;font-size:1.2rem">Dashboard Settings</h3>
          <button class="btn secondary" id="ddc-settings-close" style="margin:0">
            <ha-icon icon="mdi:close"></ha-icon>
          </button>
        </div>
        <div class="settings-body" style="display:flex;flex-direction:column;gap:18px;padding:16px;overflow-y:auto;max-height:70vh">
          <!-- Layout options -->
          <div>
            <h4 style="margin:0 0 8px 0;font-size:1rem;font-weight:600">Layout</h4>
            <label style="display:flex;flex-direction:column;font-size:.95rem;margin-bottom:10px">
              <span style="margin-bottom:4px">Grid size (px)</span>
              <input type="number" id="ddc-setting-gridSize" min="10" max="500" step="1" style="padding:6px;border:1px solid var(--divider-color,rgba(0,0,0,.3));border-radius:6px" />
            </label>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-autoResize" />
              <span>Auto resize cards</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-dragSnap" />
              <span>Drag live snap</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-autoSave" />
              <span>Auto save</span>
            </label>
            <label style="display:flex;flex-direction:column;font-size:.95rem;margin-bottom:10px">
              <span style="margin-bottom:4px">Auto save delay (ms)</span>
              <input type="number" id="ddc-setting-autoSaveDebounce" min="100" max="10000" step="100" style="padding:6px;border:1px solid var(--divider-color,rgba(0,0,0,.3));border-radius:6px" />
            </label>
            <label style="display:flex;flex-direction:column;font-size:.95rem;margin-bottom:10px">
              <span style="margin-bottom:4px">Container size mode</span>
              <select id="ddc-setting-sizeMode" style="padding:6px;border:1px solid var(--divider-color,rgba(0,0,0,.3));border-radius:6px">
                <option value="dynamic">Dynamic</option>
                <option value="preset">Preset</option>
                <option value="fixed_custom">Fixed (custom)</option>
              </select>
            </label>
            <!-- Additional inputs for size mode (custom width/height or preset list) will be injected here -->
            <div id="ddc-setting-sizeExtras"></div>
            <label style="display:flex;flex-direction:column;font-size:.95rem;margin-bottom:10px">
              <span style="margin-bottom:4px">Container orientation</span>
              <select id="ddc-setting-orient" style="padding:6px;border:1px solid var(--divider-color,rgba(0,0,0,.3));border-radius:6px">
                <option value="auto">Auto</option>
                <option value="landscape">Landscape</option>
                <option value="portrait">Portrait</option>
              </select>
            </label>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-disableOverlap" />
              <span>Disable overlap</span>
            </label>
          </div>

          <!-- Appearance options -->
          <div>
            <h4 style="margin:16px 0 8px 0;font-size:1rem;font-weight:600">Appearance</h4>
            <label style="display:flex;flex-direction:column;font-size:.95rem;margin-bottom:10px">
              <span style="margin-bottom:4px">Container background (CSS)</span>
              <input type="text" id="ddc-setting-containerBg" placeholder="e.g. transparent or #123456" style="padding:6px;border:1px solid var(--divider-color,rgba(0,0,0,.3));border-radius:6px" />
            </label>
            <label style="display:flex;flex-direction:column;font-size:.95rem;margin-bottom:10px">
              <span style="margin-bottom:4px">Card background (CSS)</span>
              <input type="text" id="ddc-setting-cardBg" placeholder="e.g. var(--ha-card-background)" style="padding:6px;border:1px solid var(--divider-color,rgba(0,0,0,.3));border-radius:6px" />
            </label>
            <label style="display:flex;flex-direction:column;font-size:.95rem;margin-bottom:10px">
              <span style="margin-bottom:4px">Background image URL</span>
              <input type="text" id="ddc-setting-bgImg" placeholder="Image URL" style="padding:6px;border:1px solid var(--divider-color,rgba(0,0,0,.3));border-radius:6px" />
            </label>
          </div>

          <!-- Behaviour options -->
          <div>
            <h4 style="margin:16px 0 8px 0;font-size:1rem;font-weight:600">Behaviour</h4>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-animate" />
              <span>Animate cards</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-debug" />
              <span>Enable debug logging</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-hideHdr" />
              <span>Hide HA Header</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem;margin-bottom:8px">
              <input type="checkbox" id="ddc-setting-hideSbar" />
              <span>Hide HA Sidebar</span>
            </label>
          </div>

        </div>
        <div style="display:flex;justify-content:flex-end;gap:10px;padding:12px 16px;border-top:1px solid var(--divider-color,rgba(0,0,0,.12))">
          <button class="btn secondary" id="ddc-settings-cancel">Cancel</button>
          <button class="btn" id="ddc-settings-save">Save</button>
        </div>
      </div>
    `;let o=this.shadowRoot.querySelector(".modal");if(o){try{o.remove()}catch{}this.__settingsModal===o&&(this.__settingsModal=null)}if(this.__settingsModal){try{this.__settingsModal.remove()}catch{}this.__settingsModal=null}this.__settingsModal=n,this.shadowRoot.appendChild(n);let s=n.querySelector("#ddc-setting-autoResize"),c=n.querySelector("#ddc-setting-gridSize"),l=n.querySelector("#ddc-setting-animate"),u=n.querySelector("#ddc-setting-hideHdr"),f=n.querySelector("#ddc-setting-hideSbar"),x=n.querySelector("#ddc-setting-dragSnap"),m=n.querySelector("#ddc-setting-autoSave"),y=n.querySelector("#ddc-setting-autoSaveDebounce"),_=n.querySelector("#ddc-setting-sizeMode"),C=n.querySelector("#ddc-setting-orient"),P=n.querySelector("#ddc-setting-disableOverlap"),E=n.querySelector("#ddc-setting-containerBg"),z=n.querySelector("#ddc-setting-cardBg"),I=n.querySelector("#ddc-setting-bgImg"),S=n.querySelector("#ddc-setting-debug");if(s&&(s.checked=!!this.autoResizeCards),c&&(c.value=String(this.gridSize||100)),l&&(l.checked=!!this.animateCards),u&&(u.checked=!!this.hideHaHeader),f&&(f.checked=!!this.hideHaSidebar),x&&(x.checked=!!this.dragLiveSnap),m&&(m.checked=!!this.autoSave),y&&(y.value=String((T=this.autoSaveDebounce)!=null?T:800)),_&&(_.value=String(this.containerSizeMode||"dynamic")),C&&(C.value=String(this.containerPresetOrient||"auto")),P&&(P.checked=!!this.disableOverlap),E&&(E.value=String(this.containerBackground||"")),z&&(z.value=String(this.cardBackground||"")),I){let K=((D=(b=this._config)==null?void 0:b.background_image)!=null?D:(L=this._config)==null?void 0:L.bg_image)||{};I.value=K.src?String(K.src):""}S&&(S.checked=!!this.debug);try{let K=n.querySelector("#ddc-setting-sizeExtras"),X=()=>{var ue,_e;if(!K)return;K.innerHTML="";let W=(_==null?void 0:_.value)||"dynamic";if(W==="fixed_custom"){let Ae=document.createElement("label");Ae.style.display="flex",Ae.style.flexDirection="column",Ae.style.fontSize=".95rem",Ae.style.marginBottom="10px";let Me=document.createElement("span");Me.textContent="Custom width (px)",Me.style.marginBottom="4px";let ge=document.createElement("input");ge.type="number",ge.id="ddc-setting-custW",ge.min="100",ge.max="10000",ge.step="10",ge.style.padding="6px",ge.style.border="1px solid var(--divider-color,rgba(0,0,0,.3))",ge.style.borderRadius="6px",ge.value=String((ue=this.containerFixedWidth)!=null?ue:800),Ae.appendChild(Me),Ae.appendChild(ge);let Oe=document.createElement("label");Oe.style.display="flex",Oe.style.flexDirection="column",Oe.style.fontSize=".95rem",Oe.style.marginBottom="10px";let pe=document.createElement("span");pe.textContent="Custom height (px)",pe.style.marginBottom="4px";let De=document.createElement("input");De.type="number",De.id="ddc-setting-custH",De.min="100",De.max="10000",De.step="10",De.style.padding="6px",De.style.border="1px solid var(--divider-color,rgba(0,0,0,.3))",De.style.borderRadius="6px",De.value=String((_e=this.containerFixedHeight)!=null?_e:600),Oe.appendChild(pe),Oe.appendChild(De),K.appendChild(Ae),K.appendChild(Oe)}else if(W==="preset"){let Ae=document.createElement("label");Ae.style.display="flex",Ae.style.flexDirection="column",Ae.style.fontSize=".95rem",Ae.style.marginBottom="10px";let Me=document.createElement("span");Me.textContent="Preset size",Me.style.marginBottom="4px";let ge=document.createElement("select");ge.id="ddc-setting-preset",ge.style.padding="6px",ge.style.border="1px solid var(--divider-color,rgba(0,0,0,.3))",ge.style.borderRadius="6px",(typeof e!="undefined"&&e._sizePresets?e._sizePresets():[]).forEach(pe=>{let De=document.createElement("option");De.value=pe.key,De.textContent=`${pe.label||pe.key} (${pe.w}\xD7${pe.h})`,ge.appendChild(De)}),ge.value=String(this.containerPreset||"fhd"),Ae.appendChild(Me),Ae.appendChild(ge),K.appendChild(Ae)}};X(),_==null||_.addEventListener("change",X)}catch(K){console.warn("[drag-and-drop-card] Failed to build container size extras",K)}let O=()=>{try{n.remove()}catch{}this.__settingsModal===n&&(this.__settingsModal=null)};(Q=n.querySelector("#ddc-settings-close"))==null||Q.addEventListener("click",K=>{K.stopPropagation(),O()}),(B=n.querySelector("#ddc-settings-cancel"))==null||B.addEventListener("click",K=>{K.stopPropagation(),O()}),(J=n.querySelector("#ddc-settings-save"))==null||J.addEventListener("click",K=>{var ie,dt,Ze,Te,Z,ze,ke,we,it,nt,xt,gt,mt,Fe;K.stopPropagation();let X=!!(s!=null&&s.checked),W=parseInt((c==null?void 0:c.value)||"0",10),ue=!!(l!=null&&l.checked),_e=!!(u!=null&&u.checked),Ae=!!(f!=null&&f.checked),Me=!!(x!=null&&x.checked),ge=!!(m!=null&&m.checked),Oe=parseInt((y==null?void 0:y.value)||"0",10),pe=(_==null?void 0:_.value)||"dynamic",De=(C==null?void 0:C.value)||"auto",Ge=!!(P!=null&&P.checked),$e=((E==null?void 0:E.value)||"").trim(),st=((z==null?void 0:z.value)||"").trim(),lt=((I==null?void 0:I.value)||"").trim(),tt=!!(S!=null&&S.checked);try{this.autoResizeCards=X,this.autoResizeCards?(ie=this._startScaleWatch)==null||ie.call(this):(dt=this._stopScaleWatch)==null||dt.call(this),!isNaN(W)&&W>0&&W!==this.gridSize&&(this.gridSize=W,(Ze=this._applyGridVars)==null||Ze.call(this),(Te=this._resizeContainer)==null||Te.call(this));let Ot=Me!==this.dragLiveSnap;this.dragLiveSnap=Me,Ot&&((Z=this._initInteract)==null||Z.call(this)),this.autoSave=ge,!isNaN(Oe)&&Oe>0&&(this.autoSaveDebounce=Oe);let yt=pe!==this.containerSizeMode;this.containerSizeMode=pe;let rt=De!==this.containerPresetOrient;if(this.containerPresetOrient=De,(yt||rt)&&((ze=this._resizeContainer)==null||ze.call(this)),pe==="fixed_custom"){let Ve=parseInt(((ke=n.querySelector("#ddc-setting-custW"))==null?void 0:ke.value)||"0",10),St=parseInt(((we=n.querySelector("#ddc-setting-custH"))==null?void 0:we.value)||"0",10);!isNaN(Ve)&&Ve>0&&(this.containerFixedWidth=Ve),!isNaN(St)&&St>0&&(this.containerFixedHeight=St),(it=this._resizeContainer)==null||it.call(this)}else if(pe==="preset"){let Ve=(nt=n.querySelector("#ddc-setting-preset"))==null?void 0:nt.value;Ve&&(this.containerPreset=Ve),(xt=this._resizeContainer)==null||xt.call(this)}this.disableOverlap=Ge,$e&&(this.containerBackground=$e,this.style.setProperty("--ddc-bg",this.containerBackground)),st&&(this.cardBackground=st,this.style.setProperty("--ddc-card-bg",this.cardBackground)),lt&&(this._config||(this._config={}),this._config.background_image||(this._config.background_image={}),this._config.background_image.src=lt),this.debug=tt,this.animateCards=ue,this.hideHaHeader=_e,this.hideHaSidebar=Ae,(gt=this._applyHaChromeVisibility_)==null||gt.call(this),lt&&((mt=this._applyBackgroundImageFromConfig)==null||mt.call(this));try{this._config||(this._config={}),this._config.grid=this.gridSize,this._config.auto_resize_cards=!!this.autoResizeCards,this._config.drag_live_snap=!!this.dragLiveSnap,this._config.auto_save=!!this.autoSave,this._config.auto_save_debounce=this.autoSaveDebounce,this._config.container_size_mode=this.containerSizeMode,this._config.container_preset_orientation=this.containerPresetOrient,this._config.container_fixed_width=this.containerFixedWidth,this._config.container_fixed_height=this.containerFixedHeight,this._config.container_preset=this.containerPreset,this._config.disable_overlap=!!this.disableOverlap,this._config.container_background=this.containerBackground,this._config.card_background=this.cardBackground,this._config.debug=!!this.debug,this._config.animate_cards=!!this.animateCards,this._config.hide_HA_Header=!!this.hideHaHeader,this._config.hide_HA_Sidebar=!!this.hideHaSidebar}catch(Ve){console.warn("[drag-and-drop-card] Failed to update config",Ve)}(Fe=this._queueSave)==null||Fe.call(this,"settings")}catch(Ot){console.warn("[drag-and-drop-card] Failed to apply settings",Ot)}O()})}_exportableOptions(){var o,s;let n={storage_key:this.storageKey||void 0,grid:this.gridSize,container_background:this.containerBackground,card_background:this.cardBackground,disable_overlap:!!this.disableOverlap,drag_live_snap:!!this.dragLiveSnap,auto_save:!!this.autoSave,auto_save_debounce:this.autoSaveDebounce,debug:!!this.debug,container_size_mode:this.containerSizeMode,container_preset_orientation:this.containerPresetOrient,container_fixed_width:(o=this.containerFixedWidth)!=null?o:void 0,container_fixed_height:(s=this.containerFixedHeight)!=null?s:void 0,container_preset:this.containerPreset,tabs:this.tabs,tabs_position:this.tabsPosition,default_tab:this.defaultTab,hide_tabs_when_single:!!this.hideTabsWhenSingle,auto_resize_cards:!!this.autoResizeCards};return Object.keys(n).forEach(c=>n[c]===void 0&&delete n[c]),n}_applyImportedOptions(n={},o=!0){var s,c,l,u,f,x,m,y;if(n&&Object.prototype.hasOwnProperty.call(n,"storage_key")&&this._isInHaEditorPreview())try{let _={type:"custom:drag-and-drop-card",...this._config||{}};this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:_},bubbles:!0,composed:!0}))}catch{}this._config={...this._config||{},...n},"storage_key"in n&&(this.storageKey=n.storage_key||void 0),this._syncEditorsStorageKey(),"grid"in n&&(this.gridSize=Number(n.grid)||10),"drag_live_snap"in n&&(this.dragLiveSnap=!!n.drag_live_snap),"auto_save"in n&&(this.autoSave=!!n.auto_save),"auto_save_debounce"in n&&(this.autoSaveDebounce=Number(n.auto_save_debounce)||800),"container_background"in n&&(this.containerBackground=(s=n.container_background)!=null?s:"transparent"),"card_background"in n&&(this.cardBackground=(c=n.card_background)!=null?c:"var(--ha-card-background, var(--card-background-color))"),"debug"in n&&(this.debug=!!n.debug),"disable_overlap"in n&&(this.disableOverlap=!!n.disable_overlap),"container_size_mode"in n&&(this.containerSizeMode=n.container_size_mode||"dynamic"),"container_fixed_width"in n&&(this.containerFixedWidth=Number(n.container_fixed_width)||null),"container_fixed_height"in n&&(this.containerFixedHeight=Number(n.container_fixed_height)||null),"container_preset"in n&&(this.containerPreset=n.container_preset||"fhd"),"container_preset_orientation"in n&&(this.containerPresetOrient=n.container_preset_orientation||"auto"),"auto_resize_cards"in n&&(this.autoResizeCards=!!n.auto_resize_cards,this.autoResizeCards?(l=this._startScaleWatch)==null||l.call(this):(u=this._stopScaleWatch)==null||u.call(this),(f=this._applyAutoScale)==null||f.call(this)),this.style.setProperty("--ddc-bg",this.containerBackground),this.style.setProperty("--ddc-card-bg",this.cardBackground),this._applyGridVars(),o&&(this._applyContainerSizingFromConfig(!0),(x=this._applyAutoScale)==null||x.call(this),this._resizeContainer(),(m=this._updateStoreBadge)==null||m.call(this),(y=this._applyAutoScale)==null||y.call(this))}_exportDesign(){let o=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(f=>{let x=parseFloat(f.getAttribute("data-x"))||0,m=parseFloat(f.getAttribute("data-y"))||0,y=parseFloat(f.style.width)||f.getBoundingClientRect().width,_=parseFloat(f.style.height)||f.getBoundingClientRect().height,C=parseInt(f.style.zIndex||"1",10),P=this._extractCardConfig(f.firstElementChild),E=f.dataset.tabId||this.defaultTab;return{card:P,position:{x,y:m},size:{width:y,height:_},z:C,tabId:E}}),s={version:2,options:this._exportableOptions(),cards:o};this._config&&this._config.card_mod&&(s.options=s.options||{},s.options.card_mod=this._config.card_mod);let c=`DragAndDrop_Design_${this.storageKey||"layout"}.json`,l=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),u=document.createElement("a");u.href=URL.createObjectURL(l),u.download=c,u.click(),URL.revokeObjectURL(u.href),this._toast("Design exported.")}_importDesign(){let n=document.createElement("input");n.type="file",n.accept="application/json";let o=!0,s=!1,c=["grid","drag_live_snap","auto_save","auto_save_debounce","container_background","card_background","debug","disable_overlap","container_size_mode","container_fixed_width","container_fixed_height","container_preset","container_preset_orientation","tabs","tabs_position","default_tab","hide_tabs_when_single","card_mod","storage_key"];n.onchange=async()=>{var f,x,m,y,_,C,P,E,z,I,S,O,T,b,L,D,Q,B,J,K,X,W,ue,_e,Ae,Me,ge,Oe,pe,De,Ge,$e,st,lt,tt,ie,dt,Ze,Te,Z,ze,ke,we,it,nt,xt,gt,mt;let l=(f=n.files)==null?void 0:f[0];if(!l)return;let u=await l.text();try{let Fe=JSON.parse(u),Ot=this.storageKey||((x=this._config)==null?void 0:x.storage_key)||null,yt=!!(Fe.options&&Array.isArray(Fe.options.tabs)),rt=Array.isArray(Fe.cards)&&Fe.cards.some(fe=>(fe==null?void 0:fe.tabId)||(fe==null?void 0:fe.tab_id)),Ve=[];yt?Ve=Fe.options.tabs:rt?Ve=Array.from(new Set(Fe.cards.map(Be=>(Be==null?void 0:Be.tabId)||(Be==null?void 0:Be.tab_id)).filter(Boolean))).map(Be=>({id:Be,label:Be})):Ve=[{id:"default",label:"Layout"}];let St=((m=Fe.options)==null?void 0:m.tabs_position)==="left"?"left":this.tabsPosition||"top",Dt=((y=Fe.options)==null?void 0:y.default_tab)||((_=Ve[0])==null?void 0:_.id)||"default",Tt=((C=Fe.options)==null?void 0:C.hide_tabs_when_single)!==void 0?!!Fe.options.hide_tabs_when_single:!0;if(Fe.options){let fe={...Fe.options};if(s||delete fe.storage_key,o){let Be=this._config||{type:"custom:drag-and-drop-card"};for(let Je of c)Je==="storage_key"&&!s||!(Je in fe)&&Je in Be&&delete Be[Je];try{this.cardContainer&&(this.cardContainer.style.background="",this.cardContainer.style.width="",this.cardContainer.style.height=""),(E=(P=this.style)==null?void 0:P.removeProperty)==null||E.call(P,"--ddc-container-bg"),(I=(z=this.style)==null?void 0:z.removeProperty)==null||I.call(z,"--ddc-card-bg")}catch{}if(this._config={...Be,...fe},"card_mod"in fe||delete this._config.card_mod,s&&fe.storage_key&&(this.storageKey=fe.storage_key),this._opts){this._opts={...this._opts,...fe};for(let Je of c)Je in fe||delete this._opts[Je]}(S=this._applyOptionsToDom)==null||S.call(this,this._config),(O=this.requestUpdate)==null||O.call(this)}else this._applyImportedOptions(fe,!0),fe.card_mod!==void 0&&(this._config=this._config||{},this._config.card_mod=fe.card_mod,(T=this.requestUpdate)==null||T.call(this))}else if(typeof Fe.grid=="number"){let fe={grid:Fe.grid};o?this._config={...this._config||{},...fe}:this._applyImportedOptions(fe,!0),(b=this.requestUpdate)==null||b.call(this)}(!Array.isArray(this.tabs)||!this.tabs.length)&&(this.tabs=Ve),this.tabsPosition||(this.tabsPosition=St),this.defaultTab||(this.defaultTab=Dt),this.hideTabsWhenSingle===void 0&&(this.hideTabsWhenSingle=Tt),(Q=(D=(L=this.rootEl)==null?void 0:L.classList)==null?void 0:D.toggle)==null||Q.call(D,"ddc-tabs-left-layout",this.tabsPosition==="left");try{let fe=((B=this._config)==null?void 0:B.storage_key)||this.storageKey||null,Be=(J=Fe.options)!=null?J:typeof Fe.grid=="number"?{grid:Fe.grid}:{},Je={...Be,tabs:(X=(K=Be.tabs)!=null?K:this.tabs)!=null?X:[],tabs_position:(ue=(W=Be.tabs_position)!=null?W:this.tabsPosition)!=null?ue:"top",default_tab:(pe=(_e=Be.default_tab)!=null?_e:this.defaultTab)!=null?pe:((Me=(Ae=Be.tabs)==null?void 0:Ae[0])==null?void 0:Me.id)||((Oe=(ge=this.tabs)==null?void 0:ge[0])==null?void 0:Oe.id)||"default",hide_tabs_when_single:(Ge=Be.hide_tabs_when_single)!=null?Ge:(De=this.hideTabsWhenSingle)!=null?De:!0};if(s||delete Je.storage_key,!fe)console.warn("[ddc:import] No storage_key on this card; aborting YAML persist.");else{let H=await(($e=this._persistOptionsToYaml)==null?void 0:$e.call(this,Je,{forceTargetKey:String(fe),noDownload:!0,replace:!0,wipeUnknownKeys:!0})),Y=!!(H&&H.yamlSaved);(st=console.debug)==null||st.call(console,"[ddc:import] YAML persist result:",Y)}try{let H={type:"custom:drag-and-drop-card",...this._config||{}};H.tabs=Je.tabs,H.tabs_position=Je.tabs_position,H.default_tab=Je.default_tab,H.hide_tabs_when_single=!!Je.hide_tabs_when_single,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:H},bubbles:!0,composed:!0}))}catch{}}catch(fe){console.warn("[ddc:import] YAML persist failed:",fe)}if(this.cardContainer.innerHTML="",Array.isArray(Fe.cards)&&Fe.cards.length)for(let fe of Fe.cards){let Be=((lt=fe.position)==null?void 0:lt.x)||0,Je=((tt=fe.position)==null?void 0:tt.y)||0,H=((ie=fe.size)==null?void 0:ie.width)||140,Y=((dt=fe.size)==null?void 0:dt.height)||100,he=fe.z,me=this._normalizeTabId(fe.tabId||fe.tab_id||this.defaultTab);if(!(fe!=null&&fe.card)||typeof fe.card=="object"&&!Object.keys(fe.card).length){let F=this._makePlaceholderAt(Be,Je,H,Y);F.dataset.tabId=me,this.cardContainer.appendChild(F);continue}let ae=await this._createCard(fe.card),ye=this._makeWrapper(ae);ye.dataset.tabId=me,this._setCardPosition(ye,Be,Je),ye.style.width=`${H}px`,ye.style.height=`${Y}px`,he!=null&&(ye.style.zIndex=String(he)),this.cardContainer.appendChild(ye);try{this._rebuildOnce(ye.firstElementChild)}catch{}this._initCardInteract(ye)}else this._showEmptyPlaceholder(),(Ze=this._applyAutoScale)==null||Ze.call(this);(Te=this._applyOptionsToDom)==null||Te.call(this,this._config),this._resizeContainer();try{(ke=(ze=(Z=this.rootEl)==null?void 0:Z.classList)==null?void 0:ze.toggle)==null||ke.call(ze,"ddc-tabs-left-layout",this.tabsPosition==="left"),(we=this._renderTabs)==null||we.call(this),(it=this._applyActiveTab)==null||it.call(this)}catch{}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0),(nt=this._toast)==null||nt.call(this,"Design imported & saved. Reloading..."),window.location.reload()}catch(fe){console.warn("[ddc:import] saveLayout failed",fe),(xt=this._markDirty)==null||xt.call(this,"import"),(gt=this._toast)==null||gt.call(this,"Design imported \u2014 click Apply to save.")}}catch(Fe){console.error("Import failed",Fe),(mt=this._toast)==null||mt.call(this,"Import failed \u2014 invalid file.")}},n.click()}_getLovelace(){var l,u;let n=0,o=this;for(;o&&n++<20;){let f=(l=o.getRootNode)==null?void 0:l.call(o),x=f==null?void 0:f.host;if((x==null?void 0:x.tagName)==="HUI-ROOT")return x.lovelace;o=x||o.parentElement}let s=new Set,c=[document];for(;c.length;){let f=c.shift();if(!(!f||s.has(f))){if(s.add(f),((u=f.host)==null?void 0:u.tagName)==="HUI-ROOT")return f.host.lovelace;if(f.tagName==="HUI-ROOT")return f.lovelace;if(f.shadowRoot&&c.push(f.shadowRoot),f.children)for(let x of f.children)c.push(x)}}}_scanDdcCards(n){let o=[],s=(l,u,f)=>{(f==null?void 0:f.type)==="custom:drag-and-drop-card"&&o.push({view:l,path:[...u],card:f})},c=(l,u,f)=>{if(l){if(Array.isArray(l)){l.forEach((x,m)=>c(x,u,f.concat(m)));return}if(typeof l=="object"){"type"in l&&s(u,f,l);for(let[x,m]of Object.entries(l))x==="views"&&Array.isArray(m)?m.forEach((y,_)=>c(y,_,["views",_])):(Array.isArray(m)||m&&typeof m=="object")&&c(m,u,f.concat(x))}}};return c(n,-1,[]),o}async _persistOptionsToYaml(n,{prevKey:o=null,patchAllInCurrentViewIfNoKey:s=!1}={}){var c,l,u,f,x,m,y,_,C;try{let P=this._getLovelace();if(!P)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof P.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let E=JSON.parse(JSON.stringify(P.config)),z=this._scanDdcCards(E),I=(c=P.current_view)!=null?c:0;console.debug("[ddc:import] persist: found DDC cards",z.map(L=>({view:L.view,path:L.path.join("."),storage_key:L.card.storage_key||null})));let S=(l=n==null?void 0:n.storage_key)!=null?l:null,O=[];o&&O.push(o),S&&O.push(S),this.storageKey&&O.push(this.storageKey),(u=this._config)!=null&&u.storage_key&&O.push(this._config.storage_key);let T=z.filter(L=>L.card.storage_key&&O.includes(L.card.storage_key));if(!T.length){let L=z.filter(D=>D.view===I);L.length===1&&(T=L)}if(!T.length&&z.length===1&&(T=z),!T.length)return console.debug("[ddc:import] persist: no target. Provide a unique storage_key on this card and import again.",{prevKey:o,newKey:S,storageKey:this.storageKey}),!1;let b={type:"custom:drag-and-drop-card",...n};"storage_key"in b&&delete b.storage_key,"storageKey"in b&&delete b.storageKey;for(let L of T){let D=E;for(let J of L.path)D=D[J];let Q=(C=(_=(m=(f=D==null?void 0:D.storage_key)!=null?f:D==null?void 0:D.storageKey)!=null?m:(x=D==null?void 0:D.options)==null?void 0:x.storage_key)!=null?_:(y=D==null?void 0:D.options)==null?void 0:y.storageKey)!=null?C:null,B=!!(o&&S&&Q===o&&S!==o);Object.assign(D,b),B?D.storage_key=String(S):Q&&(D.storage_key=String(Q)),"storageKey"in D&&delete D.storageKey}return console.debug("[ddc:import] persist \u2192 saving",{patched:T.length,keysTried:O,patch}),await P.saveConfig(E),!0}catch(P){return console.warn("[ddc:import] persist error",P),!1}}_queueSave(n="auto"){this._markDirty(n),this.autoSave&&(this._loading||this.editMode&&(this._dbgPush("autosave","Queued",{reason:n,debounce:this.autoSaveDebounce}),clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>this._saveLayout(!0),this.autoSaveDebounce)))}async _saveLayout(n=!0){let s=Array.from(this.cardContainer.querySelectorAll(".card-wrapper:not(.ddc-placeholder)")).map(l=>{let u=parseFloat(l.getAttribute("data-x"))||0,f=parseFloat(l.getAttribute("data-y"))||0,x=parseFloat(l.style.width)||l.getBoundingClientRect().width,m=parseFloat(l.style.height)||l.getBoundingClientRect().height,y=parseInt(l.style.zIndex||"1",10),_=this._extractCardConfig(l.firstElementChild),C=l.dataset.tabId||this.defaultTab;return{card:_,position:{x:u,y:f},size:{width:x,height:m},z:y,tabId:C}}),c={version:2,options:this._exportableOptions(),cards:s};try{localStorage.setItem(`ddc_local_${this.storageKey||"default"}`,JSON.stringify(c))}catch{}if(!this.storageKey){n||this._toast("Saved locally (no storage_key set)."),this.__dirty=!1,this._updateApplyBtn();return}try{await this._saveLayoutToBackend(this.storageKey,c),n||this._toast("Layout saved."),this.__dirty=!1,this._updateApplyBtn()}catch(l){console.error("Backend save failed",l),this._dbgPush("save","Backend save failed",{error:String(l)}),n||this._toast("Backend save failed \u2014 kept local copy.")}}async _probeBackend(){this._backendOK=!1;let n=performance.now();try{this._dbgPush("probe","GET /api/dragdrop_storage (list keys)");let o=await this.hass.callApi("get","dragdrop_storage"),s=Math.round(performance.now()-n);this._dbgPush("probe",`OK (${s} ms)`,o),this._backendOK=!!o}catch(o){let s=Math.round(performance.now()-n);this._dbgPush("probe",`FAILED (${s} ms)`,{error:String(o)}),this._backendOK=!1}this._updateStoreBadge()}async _loadLayoutFromBackend(n){let o=`dragdrop_storage/${encodeURIComponent(n)}`,s=performance.now();try{this._dbgPush("load",`GET /api/${o}`);let c=await this.hass.callApi("get",o),l=Math.round(performance.now()-s);return this._dbgPush("load",`OK (${l} ms)`,{bytes:JSON.stringify(c||"").length}),c}catch(c){let l=Math.round(performance.now()-s);return this._dbgPush("load",`FAILED (${l} ms)`,{error:String(c)}),null}}async _saveLayoutToBackend(n,o){let s=`dragdrop_storage/${encodeURIComponent(n)}`,c=JSON.stringify(o).length,l=performance.now();try{this._dbgPush("save",`POST /api/${s}`,{bytes:c});let u=await this.hass.callApi("post",s,o),f=Math.round(performance.now()-l);return this._dbgPush("save",`OK (${f} ms)`,u),u}catch(u){let f=Math.round(performance.now()-l);throw this._dbgPush("save",`FAILED (${f} ms)`,{error:String(u),bytes:c}),u}}_updateStoreBadge(){let n=this.storeBadge;if(!n)return;let o=this._backendOK&&!!this.storageKey;n.textContent=o?"storage: backend - OK":"storage: local. Your Changes are NOT being SAVED. You need to download the Drag and Drop Card backend integration",n.style.background=o?"rgba(76,175,80,.15)":"rgba(255,193,7,.15)",n.style.borderColor=o?"rgba(76,175,80,.45)":"rgba(255,193,7,.45)"}_toast(n){let o=new Event("hass-notification");o.detail={message:n},window.dispatchEvent(o)}_huiRoot(){var n,o,s,c,l,u;try{let f=document.querySelector("home-assistant"),x=(n=f==null?void 0:f.shadowRoot)==null?void 0:n.querySelector("home-assistant-main"),m=((o=x==null?void 0:x.shadowRoot)==null?void 0:o.querySelector("ha-drawer"))||x,y=((s=m==null?void 0:m.shadowRoot)==null?void 0:s.querySelector("partial-panel-resolver"))||m,_=((c=y==null?void 0:y.shadowRoot)==null?void 0:c.querySelector("ha-panel-lovelace"))||((l=m==null?void 0:m.shadowRoot)==null?void 0:l.querySelector("ha-panel-lovelace"));return((u=_==null?void 0:_.shadowRoot)==null?void 0:u.querySelector("hui-root"))||null}catch{return null}}getCardSize(){return 3}};customElements.get("drag-and-drop-card")||customElements.define("drag-and-drop-card",Vi);(()=>{try{let e=window.customCards=window.customCards||[];e.some(p=>p.type==="drag-and-drop-card")||e.push({type:"drag-and-drop-card",name:"Drag & Drop Card",description:"Freeform drag/resize/snap-to-grid canvas for Lovelace cards.",preview:!1})}catch{}})();(()=>{let e=new WeakSet,p=l=>{try{if(!(l instanceof Element))return!1;let u=l.localName||"";return u?!!(u==="ha-card"||u.endsWith("-card")):!1}catch{return!1}},n=l=>{try{if(!l||e.has(l))return;e.add(l),l.dispatchEvent(new Event("ll-rebuild",{bubbles:!0,composed:!0}))}catch{}},o=l=>{var u,f;try{if(!l)return;l instanceof Element&&p(l)&&n(l);let x=(f=(u=(l instanceof ShadowRoot,l)).querySelectorAll)==null?void 0:f.call(u,"*");if(!x)return;for(let m of x){p(m)&&n(m);let y=m.shadowRoot;if(y)try{o(y)}catch{}}}catch{}},s=l=>{try{if(!l||l.__ddcCardModIntegrated)return;l.__ddcCardModIntegrated=!0;let u=l.shadowRoot||l;o(u);let f=new MutationObserver(x=>{for(let m of x)if(!(!m.addedNodes||!m.addedNodes.length))for(let y of m.addedNodes)(y instanceof Element||y instanceof ShadowRoot)&&o(y)});f.observe(u,{childList:!0,subtree:!0}),l.__ddcCardModIntegratedObserver=f,setTimeout(()=>{try{o(u)}catch{}},250),setTimeout(()=>{try{o(u)}catch{}},1e3)}catch{}},c=()=>{try{document.querySelectorAll("drag-and-drop-card").forEach(s)}catch{}};if(window.customElements&&window.customElements.whenDefined)window.customElements.whenDefined("drag-and-drop-card").then(()=>{c();let l=window.customElements.get("drag-and-drop-card");if(l&&l.prototype){let f=l.prototype.connectedCallback;l.prototype.connectedCallback=function(){try{f&&f.call(this)}finally{s(this)}}}new MutationObserver(()=>c()).observe(document.documentElement,{childList:!0,subtree:!0})});else{let l=setInterval(c,1e3);setTimeout(()=>clearInterval(l),1e4)}})();(function(){let e="drag-and-drop-card",p=customElements.get(e);if(!p){console.warn("[ddc:augment] Could not find custom element",e);return}function n(){var E,z;try{let I=0,S=this;for(;S&&I++<20;){let b=(E=S.getRootNode)==null?void 0:E.call(S),L=b==null?void 0:b.host;if((L==null?void 0:L.tagName)==="HUI-ROOT")return L.lovelace;S=L||S.parentElement}let O=new Set,T=[document];for(;T.length;){let b=T.shift();if(!(!b||O.has(b))){if(O.add(b),((z=b.host)==null?void 0:z.tagName)==="HUI-ROOT")return b.host.lovelace;if(b.tagName==="HUI-ROOT")return b.lovelace;if(b.shadowRoot&&T.push(b.shadowRoot),b.children)for(let L of b.children)T.push(L)}}}catch{}}function o(E){let z=[],I=(O,T,b)=>{(b==null?void 0:b.type)==="custom:drag-and-drop-card"&&z.push({view:O,path:[...T],card:b})},S=(O,T,b)=>{if(O){if(Array.isArray(O)){O.forEach((L,D)=>S(L,T,b.concat(D)));return}if(typeof O=="object"){"type"in O&&I(T,b,O);for(let[L,D]of Object.entries(O))L==="views"&&Array.isArray(D)?D.forEach((Q,B)=>S(Q,B,["views",B])):(Array.isArray(D)||D&&typeof D=="object")&&S(D,T,b.concat(L))}}};return S(E,-1,[]),z}function s(E,z,I){let S=new Date().toISOString().replace(/[:.]/g,"-"),O=z.map(b=>{let L=E;for(let D of b.path)L=L[D];return{view:b.view,path:b.path,storage_key:L&&L.storage_key||null,before:L,patch:I}}),T={kind:"ddc-import-backup",created_at:S,count:O.length,items:O};try{let b=`ddc.backup.${S}`;localStorage.setItem(b,JSON.stringify(T));let L=Object.keys(localStorage).filter(D=>D.startsWith("ddc.backup.")).sort().reverse();for(let D of L.slice(10))localStorage.removeItem(D)}catch{}return{name:`ddc_backup_${S}.json`,data:T}}function c(E,z){try{let I=new Blob([JSON.stringify(z,null,2)],{type:"application/json"}),S=URL.createObjectURL(I),O=document.createElement("a");O.href=S,O.download=E,document.body.appendChild(O),O.click(),O.remove(),setTimeout(()=>URL.revokeObjectURL(S),1500)}catch(I){console.warn("[ddc:backup] download failed",I)}}function l(E){if(E)try{let z="ddc.recent.keys",I=JSON.parse(localStorage.getItem(z)||"[]");I.includes(E)||I.unshift(E),localStorage.setItem(z,JSON.stringify(I.slice(0,20)))}catch{}}function u(){try{return JSON.parse(localStorage.getItem("ddc.recent.keys")||"[]")}catch{return[]}}function f(){var z,I;let E=new Set;try{let S=Object.keys(localStorage).filter(O=>O.startsWith("ddc.backup.")).sort().reverse();for(let O of S)try{let T=JSON.parse(localStorage.getItem(O)||"null");if(T&&T.items)for(let b of T.items){let L=((z=b==null?void 0:b.before)==null?void 0:z.storage_key)||((I=b==null?void 0:b.patch)==null?void 0:I.storage_key);L&&E.add(L)}}catch{}}catch{}return Array.from(E)}async function x(E,{forceTargetKey:z=null,onlyThisCard:I=!1,prevKey:S,noDownload:O}={}){var _e,Ae,Me,ge,Oe;let T=((_e=this._getLovelace)==null?void 0:_e.call(this))||n.call(this);if(!T)return console.debug("[ddc:import] persist: no lovelace root"),!1;if(typeof T.saveConfig!="function")return console.debug("[ddc:import] persist: dashboard not in Storage mode"),!1;let b=pe=>typeof pe=="string"?pe.trim():null,L=b(z)||b((Ae=this==null?void 0:this._config)==null?void 0:Ae.storage_key)||b(this==null?void 0:this.storageKey)||b(S);if(!L)return console.warn("[ddc:import] persist: missing target storage_key on this card; aborting"),!1;let D=JSON.parse(JSON.stringify(T.config)),Q=(this._scanDdcCards||o)(D);console.debug("[ddc:import] persist: found DDC cards",Q.map(pe=>({view:pe.view,path:pe.path.join("."),storage_key:pe.card&&(pe.card.storage_key||pe.card.storageKey)||null})));let B=Q.filter(pe=>{var Ge,$e,st,lt,tt,ie,dt,Ze,Te;return((Te=(ie=(st=b((Ge=pe.card)==null?void 0:Ge.storage_key))!=null?st:b(($e=pe.card)==null?void 0:$e.storageKey))!=null?ie:b((tt=(lt=pe.card)==null?void 0:lt.options)==null?void 0:tt.storage_key))!=null?Te:b((Ze=(dt=pe.card)==null?void 0:dt.options)==null?void 0:Ze.storageKey))===L});if(B.length!==1)return console.warn("[ddc:import] persist: expected exactly one target with key, got",B.length,{myKey:L}),!1;let J={type:"custom:drag-and-drop-card",...E||{}};"storage_key"in J&&delete J.storage_key,"storageKey"in J&&delete J.storageKey,J!=null&&J.options&&("storage_key"in J.options&&delete J.options.storage_key,"storageKey"in J.options&&delete J.options.storageKey);let K=Array.isArray(J.cards)?J.cards:null;delete J.cards;try{let pe=s==null?void 0:s(T.config,B,J);pe&&(console.debug("[ddc:import] backup created",{file:pe.name,items:(Me=pe.data)==null?void 0:Me.count}),!O&&typeof c=="function"&&c(pe.name,pe.data))}catch(pe){console.debug("[ddc:import] backup skipped/error:",(pe==null?void 0:pe.message)||pe)}let X=B[0],W=D;for(let pe of X.path)W=W[pe];let ue=(Oe=(ge=b(W==null?void 0:W.storage_key))!=null?ge:b(W==null?void 0:W.storageKey))!=null?Oe:null;return Object.assign(W,J),ue?W.storage_key=ue:W.storage_key=L,"storageKey"in W&&delete W.storageKey,console.debug("[ddc:import] persist \u2192 saving",{patched:1,into_key:W.storage_key,ignored_file_key:b(E==null?void 0:E.storage_key)||b(E==null?void 0:E.storageKey)||null}),await T.saveConfig(D),{yamlSaved:!0,cardsForStorage:K}}async function m(){var I;let E=S=>{if(!S)return[];if(Array.isArray(S))return S;if(Array.isArray(S==null?void 0:S.keys))return S.keys;if(Array.isArray(S==null?void 0:S.dashboards))return S.dashboards;if(Array.isArray(S==null?void 0:S.entries))return S.entries.map(O=>O.key||O.id||O.name).filter(Boolean);if(Array.isArray(S==null?void 0:S.items))return S.items.map(O=>O.key||O.id||O.name).filter(Boolean);if(typeof S=="object"){for(let O of Object.values(S))if(Array.isArray(O)&&O.every(T=>typeof T=="string"))return O}return[]};try{if((I=this==null?void 0:this.hass)!=null&&I.callApi){let S=await this.hass.callApi("get","dragdrop_storage"),O=E(S);if(O.length)return O}}catch(S){console.debug("[ddc:switcher] hass.callApi dragdrop_storage failed",S)}let z=["/api/dragdrop_storage","/api/dragdrop_storage/keys","/api/dragdrop_storage/list","/api/dragdrop_storage?all=1"];for(let S of z)try{let T=await(await fetch(S,{cache:"no-store"})).json(),b=E(T);if(b.length)return b}catch{}return[]}async function y(E){let z=T=>{if(!T)return null;if(T.options||T.cards)return T;if(typeof T.design=="object")return T.design;if(typeof T.payload=="object")return T.payload;try{if(typeof T=="string")return JSON.parse(T)}catch{}return null},I=async(T,b,L)=>{var D;try{if((D=this==null?void 0:this.hass)!=null&&D.callApi){let Q=await this.hass.callApi(T,b,L),B=z(Q);if(B)return B}}catch{}return null},S=async T=>{try{let b=await fetch(T,{cache:"no-store"}),L=b.headers.get("content-type")||"";if(L.includes("application/json")||L.includes("text/plain")){let D=await b.json().catch(()=>null)||await b.text().catch(()=>null),Q=z(D);if(Q)return Q}}catch{}return null},O=encodeURIComponent(E);return await(I("get",`dragdrop_storage/${O}`)||S(`/api/dragdrop_storage/${O}`)||S(`/api/dragdrop_storage?key=${O}`)||I("post","dragdrop_storage/get",{key:E})||null)}async function _(E,{source:z="switcher",newKey:I=null}={}){var T,b,L,D,Q,B,J,K,X,W,ue,_e,Ae,Me,ge,Oe,pe,De,Ge,$e,st,lt,tt,ie,dt,Ze;if(!E||typeof E!="object")throw new Error("Invalid design payload");let S=this.storageKey||((T=this._config)==null?void 0:T.storage_key)||null;try{(b=this._dbgInit)==null||b.call(this),(L=this._dbgPush)==null||L.call(this,"import","Begin import (programmatic)",{source:z,newKey:I})}catch{}if(E.options){let{storage_key:Te,...Z}=E.options;(D=this._applyImportedOptions)==null||D.call(this,Z,!0)}else typeof E.grid=="number"&&((Q=this._applyImportedOptions)==null||Q.call(this,{grid:E.grid},!0));let O=I||((B=E==null?void 0:E.options)==null?void 0:B.storage_key)||S;if(O){this.storageKey=O,this._config={...this._config||{},storage_key:O};try{(J=this._syncEditorsStorageKey)==null||J.call(this)}catch{}}try{let Te=(K=E.options)!=null?K:typeof E.grid=="number"?{grid:E.grid}:{};await((X=this._persistOptionsToYaml)==null?void 0:X.call(this,{...Te,storage_key:O},{prevKey:S,noDownload:z==="switcher"}))}catch(Te){console.warn("[ddc:apply] persist failed",Te)}try{if(this.cardContainer.innerHTML="",Array.isArray(E.cards)&&E.cards.length)for(let Te of E.cards)if(!(Te!=null&&Te.card)||typeof Te.card=="object"&&Object.keys(Te.card).length===0){let Z=(Me=this._makePlaceholderAt)==null?void 0:Me.call(this,((W=Te.position)==null?void 0:W.x)||0,((ue=Te.position)==null?void 0:ue.y)||0,((_e=Te.size)==null?void 0:_e.width)||200,((Ae=Te.size)==null?void 0:Ae.height)||200);Z&&this.cardContainer.appendChild(Z)}else{let Z=await this._createCard(Te.card),ze=this._makeWrapper(Z);(pe=this._setCardPosition)==null||pe.call(this,ze,((ge=Te.position)==null?void 0:ge.x)||0,((Oe=Te.position)==null?void 0:Oe.y)||0),ze.style.width=`${((De=Te.size)==null?void 0:De.width)||140}px`,ze.style.height=`${((Ge=Te.size)==null?void 0:Ge.height)||100}px`,Te.z!=null&&(ze.style.zIndex=String(Te.z)),this.cardContainer.appendChild(ze);try{($e=this._rebuildOnce)==null||$e.call(this,ze.firstElementChild)}catch{}(st=this._initCardInteract)==null||st.call(this,ze)}else(lt=this._showEmptyPlaceholder)==null||lt.call(this);(tt=this._resizeContainer)==null||tt.call(this),(ie=this._markDirty)==null||ie.call(this,"import"),(dt=this._toast)==null||dt.call(this,z==="switcher"?`Loaded layout "${O}"`:"Design imported")}catch(Te){console.error("[ddc:apply] rebuild failed",Te),(Ze=this._toast)==null||Ze.call(this,"Import failed during rebuild.")}}function C(){var E,z;try{let I=this.shadowRoot||this.renderRoot||this,S=I.querySelector(".ddc-switcher-inline");if(!S)return;let O=((E=this._getLovelace)==null?void 0:E.call(this))||n.call(this),T=!1;try{let b=(z=I.getRootNode&&I.getRootNode())==null?void 0:z.host;T=!!(O&&(O.editMode===!0||b&&b.editMode===!0))}catch{}S.style.display=T?"inline-flex":"none"}catch{}}function P(){try{if(this._ddcSwitcherInstalled)return;let z=(this.shadowRoot||this.renderRoot||this).querySelector(".toolbar");if(!z)return;let I=document.createElement("div");I.className="ddc-switcher-inline",Object.assign(I.style,{display:"inline-flex",gap:"6px",alignItems:"center",marginLeft:"auto"});let S=document.createElement("span");S.textContent="Layout:",S.style.fontSize="12px",S.style.opacity="0.8";let O=document.createElement("select");Object.assign(O.style,{fontSize:"12px",padding:"4px 6px",borderRadius:"8px",border:"1px solid var(--divider-color, #999)",background:"var(--card-background-color, #fff)"}),O.title="Select stored layout (storage_key)",O.id="ddcKeySelect";let T=document.createElement("button");T.className="btn secondary",T.type="button",T.style.padding="6px 10px",T.innerHTML='<ha-icon icon="mdi:refresh"></ha-icon><span style="margin-left:6px">Refresh</span>',I.appendChild(S),I.appendChild(O),I.appendChild(T),z.appendChild(I),this._ddcSwitcherInstalled=!0;let b=async()=>{let L=this.storageKey||this._config&&this._config.storage_key||"",D=await m.call(this),Q=f(),B=u(),J=_e=>Array.from(new Set(_e.filter(Boolean))),K=J(D),X=J(Q),W=J(B);if(O.innerHTML="",L&&!K.includes(L)&&!X.includes(L)&&!W.includes(L)){let _e=document.createElement("option");_e.value=L,_e.textContent=`${L} (current)`,_e.selected=!0,O.appendChild(_e)}let ue=(_e,Ae)=>{if(!Ae.length)return;let Me=document.createElement("optgroup");Me.label=_e,Ae.forEach(ge=>{let Oe=document.createElement("option");Oe.value=ge,Oe.textContent=ge,ge===L&&(Oe.selected=!0),Me.appendChild(Oe)}),O.appendChild(Me)};if(ue("Server",K),ue("Backups",X),ue("Recent",W),!O.children.length){let _e=document.createElement("option");_e.value="",_e.textContent="\u2014 none \u2014",_e.selected=!0,O.appendChild(_e)}C.call(this)};b(),T.addEventListener("click",b),O.addEventListener("change",async L=>{var Q,B,J,K,X,W,ue,_e;let D=String(L.target.value||"");if(D&&!this._ddcLoadingFromKey){this._ddcLoadingFromKey=!0;try{let Ae=await y.call(this,D);if(!Ae){(Q=this._toast)==null||Q.call(this,`No layout found for "${D}"`);return}await _.call(this,Ae,{source:"switcher",newKey:D}),(B=this._resizeContainer)==null||B.call(this),(J=this._toast)==null||J.call(this,`Loaded layout "${D}"`);let Me=String(((K=this._config)==null?void 0:K.storage_key)||this.storageKey||""),ge=!1;try{let Oe=Me?{forceTargetKey:Me,noDownload:!0}:{noDownload:!0};ge=await this._persistOptionsToYaml({storage_key:D},Oe)}catch(Oe){console.warn("[ddc:switcher] failed to persist storage_key to YAML",Oe),(X=this._toast)==null||X.call(this,"Failed to persist selected layout. Keeping current.");return}if(this.storageKey=D,this._config&&(this._config.storage_key=D),!ge){console.warn("[ddc:switcher] persist returned false (likely YAML mode). Skipping reload.");return}try{this._saveTimer&&clearTimeout(this._saveTimer),await this._saveLayout(!0)}catch(Oe){console.warn("[ddc:switcher] saveLayout failed",Oe),(W=this._markDirty)==null||W.call(this,"switcher"),(ue=this._toast)==null||ue.call(this,"Layout loaded \u2014 click Apply to save.");return}window.location.reload(),window.location.reload()}catch(Ae){console.warn("[ddc:switcher] load/apply failed",Ae),(_e=this._toast)==null||_e.call(this,"Failed to load layout.")}finally{this._ddcLoadingFromKey=!1}}}),this._ddcVisTimer&&clearInterval(this._ddcVisTimer),this._ddcVisTimer=setInterval(()=>C.call(this),800),C.call(this)}catch(E){console.warn("[ddc:switcher] inline install failed",E)}}p.prototype._getLovelace||(p.prototype._getLovelace=n),p.prototype._scanDdcCards||(p.prototype._scanDdcCards=o),p.prototype._persistOptionsToYaml=x,p.prototype._applyDesignObject||(p.prototype._applyDesignObject=_);try{let E=Object.getOwnPropertyDescriptor(p.prototype,"hass");if(E&&(E.set||E.get)){let z=E.set;Object.defineProperty(p.prototype,"hass",{configurable:!0,enumerable:!0,set(I){z&&z.call(this,I);try{P.call(this)}catch{}},get:E.get||function(){return this._hass}})}else if(typeof p.prototype.setHass=="function"){let z=p.prototype.setHass;p.prototype.setHass=function(I){z&&z.call(this,I);try{P.call(this)}catch{}}}else{let z=p.prototype.updated||p.prototype.firstUpdated;p.prototype.updated=function(...I){z&&z.apply(this,I);try{P.call(this)}catch{}}}}catch(E){console.warn("[ddc:switcher] wrap hass setter failed",E)}})();
/*!
 * Drag & Drop Card (Proprietary)
 * Copyright (c) 2025 <SMARTI AS>
 * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md
 */
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT *)
*/
//# sourceMappingURL=drag-and-drop-card.js.map
