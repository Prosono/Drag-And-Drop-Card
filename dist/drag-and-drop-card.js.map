{
  "version": 3,
  "sources": ["../node_modules/@interactjs/utils/isWindow.ts", "../node_modules/@interactjs/utils/window.ts", "../node_modules/@interactjs/utils/is.ts", "../node_modules/@interactjs/actions/drag/plugin.ts", "../node_modules/@interactjs/utils/domObjects.ts", "../node_modules/@interactjs/utils/browser.ts", "../node_modules/@interactjs/utils/domUtils.ts", "../node_modules/@interactjs/utils/extend.ts", "../node_modules/@interactjs/utils/rect.ts", "../node_modules/@interactjs/utils/getOriginXY.ts", "../node_modules/@interactjs/utils/normalizeListeners.ts", "../node_modules/@interactjs/utils/hypot.ts", "../node_modules/@interactjs/utils/pointerExtend.ts", "../node_modules/@interactjs/utils/pointerUtils.ts", "../node_modules/@interactjs/core/BaseEvent.ts", "../node_modules/@interactjs/utils/arr.ts", "../node_modules/@interactjs/actions/drop/DropEvent.ts", "../node_modules/@interactjs/actions/drop/plugin.ts", "../node_modules/@interactjs/actions/gesture/plugin.ts", "../node_modules/@interactjs/actions/resize/plugin.ts", "../node_modules/@interactjs/utils/raf.ts", "../node_modules/@interactjs/actions/plugin.ts", "../node_modules/@interactjs/auto-scroll/plugin.ts", "../node_modules/@interactjs/utils/misc.ts", "../node_modules/@interactjs/auto-start/InteractableMethods.ts", "../node_modules/@interactjs/auto-start/base.ts", "../node_modules/@interactjs/auto-start/dragAxis.ts", "../node_modules/@interactjs/auto-start/hold.ts", "../node_modules/@interactjs/auto-start/plugin.ts", "../node_modules/@interactjs/core/interactablePreventDefault.ts", "../node_modules/@interactjs/utils/isNonNativeEvent.ts", "../node_modules/@interactjs/utils/clone.ts", "../node_modules/@interactjs/modifiers/Modification.ts", "../node_modules/@interactjs/modifiers/base.ts", "../node_modules/@interactjs/core/options.ts", "../node_modules/@interactjs/core/InteractEvent.ts", "../node_modules/@interactjs/core/PointerInfo.ts", "../node_modules/@interactjs/core/Interaction.ts", "../node_modules/@interactjs/offset/plugin.ts", "../node_modules/@interactjs/inertia/plugin.ts", "../node_modules/@interactjs/core/Eventable.ts", "../node_modules/@interactjs/core/events.ts", "../node_modules/@interactjs/core/interactionFinder.ts", "../node_modules/@interactjs/core/interactions.ts", "../node_modules/@interactjs/core/Interactable.ts", "../node_modules/@interactjs/core/InteractableSet.ts", "../node_modules/@interactjs/core/scope.ts", "../node_modules/@interactjs/core/InteractStatic.ts", "../node_modules/@interactjs/interact/index.ts", "../node_modules/@interactjs/snappers/edgeTarget.ts", "../node_modules/@interactjs/snappers/elements.ts", "../node_modules/@interactjs/snappers/grid.ts", "../node_modules/@interactjs/snappers/plugin.ts", "../node_modules/@interactjs/modifiers/aspectRatio.ts", "../node_modules/@interactjs/modifiers/noop.ts", "../node_modules/@interactjs/modifiers/restrict/pointer.ts", "../node_modules/@interactjs/modifiers/restrict/edges.ts", "../node_modules/@interactjs/modifiers/restrict/rect.ts", "../node_modules/@interactjs/modifiers/restrict/size.ts", "../node_modules/@interactjs/modifiers/snap/pointer.ts", "../node_modules/@interactjs/modifiers/snap/size.ts", "../node_modules/@interactjs/modifiers/snap/edges.ts", "../node_modules/@interactjs/modifiers/all.ts", "../node_modules/@interactjs/modifiers/plugin.ts", "../node_modules/@interactjs/pointer-events/PointerEvent.ts", "../node_modules/@interactjs/pointer-events/base.ts", "../node_modules/@interactjs/pointer-events/holdRepeat.ts", "../node_modules/@interactjs/pointer-events/interactableTargets.ts", "../node_modules/@interactjs/pointer-events/plugin.ts", "../node_modules/@interactjs/reflow/plugin.ts", "../node_modules/interactjs/index.ts", "../node_modules/@interactjs/interactjs/index.ts", "../src/drag-and-drop-card.js", "../node_modules/js-yaml/dist/js-yaml.mjs"],
  "sourcesContent": ["export default (thing: any) => !!(thing && thing.Window) && thing instanceof thing.Window\n", "import isWindow from './isWindow'\n\nexport let realWindow = undefined as Window\n\nlet win = undefined as Window\nexport { win as window }\n\nexport function init(window: Window & { wrap?: (...args: any[]) => any }) {\n  // get wrapped window if using Shadow DOM polyfill\n\n  realWindow = window\n\n  // create a TextNode\n  const el = window.document.createTextNode('')\n\n  // check if it's wrapped by a polyfill\n  if (el.ownerDocument !== window.document && typeof window.wrap === 'function' && window.wrap(el) === el) {\n    // use wrapped window\n    window = window.wrap(window)\n  }\n\n  win = window\n}\n\nif (typeof window !== 'undefined' && !!window) {\n  init(window)\n}\n\nexport function getWindow(node: any) {\n  if (isWindow(node)) {\n    return node\n  }\n\n  const rootNode = node.ownerDocument || node\n\n  return rootNode.defaultView || win.window\n}\n", "import isWindow from './isWindow'\nimport * as win from './window'\n\nconst window = (thing: any): thing is Window => thing === win.window || isWindow(thing)\n\nconst docFrag = (thing: any): thing is DocumentFragment => object(thing) && thing.nodeType === 11\n\nconst object = (thing: any): thing is { [index: string]: any } => !!thing && typeof thing === 'object'\n\nconst func = (thing: any): thing is (...args: any[]) => any => typeof thing === 'function'\n\nconst number = (thing: any): thing is number => typeof thing === 'number'\n\nconst bool = (thing: any): thing is boolean => typeof thing === 'boolean'\n\nconst string = (thing: any): thing is string => typeof thing === 'string'\n\nconst element = (thing: any): thing is HTMLElement | SVGElement => {\n  if (!thing || typeof thing !== 'object') {\n    return false\n  }\n\n  const _window = win.getWindow(thing) || win.window\n\n  return /object|function/.test(typeof Element)\n    ? thing instanceof Element || thing instanceof _window.Element\n    : thing.nodeType === 1 && typeof thing.nodeName === 'string'\n}\n\nconst plainObject: typeof object = (thing: any): thing is { [index: string]: any } =>\n  object(thing) && !!thing.constructor && /function Object\\b/.test(thing.constructor.toString())\n\nconst array = <T extends unknown>(thing: any): thing is T[] =>\n  object(thing) && typeof thing.length !== 'undefined' && func(thing.splice)\n\nexport default {\n  window,\n  docFrag,\n  object,\n  func,\n  number,\n  bool,\n  string,\n  element,\n  plainObject,\n  array,\n}\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { InteractEvent } from '@interactjs/core/InteractEvent'\nimport type { PerActionDefaults } from '@interactjs/core/options'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { ListenersArg, OrBoolean } from '@interactjs/core/types'\nimport is from '@interactjs/utils/is'\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    draggable(options: Partial<OrBoolean<DraggableOptions>> | boolean): this\n    draggable(): DraggableOptions\n    /**\n     * ```js\n     * interact(element).draggable({\n     *     onstart: function (event) {},\n     *     onmove : function (event) {},\n     *     onend  : function (event) {},\n     *\n     *     // the axis in which the first movement must be\n     *     // for the drag sequence to start\n     *     // 'xy' by default - any direction\n     *     startAxis: 'x' || 'y' || 'xy',\n     *\n     *     // 'xy' by default - don't restrict to one axis (move in any direction)\n     *     // 'x' or 'y' to restrict movement to either axis\n     *     // 'start' to restrict movement to the axis the drag started in\n     *     lockAxis: 'x' || 'y' || 'xy' || 'start',\n     *\n     *     // max number of drags that can happen concurrently\n     *     // with elements of this Interactable. Infinity by default\n     *     max: Infinity,\n     *\n     *     // max number of drags that can target the same element+Interactable\n     *     // 1 by default\n     *     maxPerElement: 2\n     * })\n     *\n     * var isDraggable = interact('element').draggable(); // true\n     * ```\n     *\n     * Get or set whether drag actions can be performed on the target\n     *\n     * @param options - true/false or An object with event\n     * listeners to be fired on drag events (object makes the Interactable\n     * draggable)\n     */\n    draggable(options?: Partial<OrBoolean<DraggableOptions>> | boolean): this | DraggableOptions\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface ActionDefaults {\n    drag: DraggableOptions\n  }\n}\n\ndeclare module '@interactjs/core/types' {\n  interface ActionMap {\n    drag?: typeof drag\n  }\n}\n\nexport type DragEvent = InteractEvent<'drag'>\n\nexport interface DraggableOptions extends PerActionDefaults {\n  startAxis?: 'x' | 'y' | 'xy'\n  lockAxis?: 'x' | 'y' | 'xy' | 'start'\n  oninertiastart?: ListenersArg\n  onstart?: ListenersArg\n  onmove?: ListenersArg\n  onend?: ListenersArg\n}\n\nfunction install(scope: Scope) {\n  const { actions, Interactable, defaults } = scope\n\n  Interactable.prototype.draggable = drag.draggable\n\n  actions.map.drag = drag\n  actions.methodDict.drag = 'draggable'\n\n  defaults.actions.drag = drag.defaults\n}\n\nfunction beforeMove({ interaction }) {\n  if (interaction.prepared.name !== 'drag') return\n\n  const axis = interaction.prepared.axis\n\n  if (axis === 'x') {\n    interaction.coords.cur.page.y = interaction.coords.start.page.y\n    interaction.coords.cur.client.y = interaction.coords.start.client.y\n\n    interaction.coords.velocity.client.y = 0\n    interaction.coords.velocity.page.y = 0\n  } else if (axis === 'y') {\n    interaction.coords.cur.page.x = interaction.coords.start.page.x\n    interaction.coords.cur.client.x = interaction.coords.start.client.x\n\n    interaction.coords.velocity.client.x = 0\n    interaction.coords.velocity.page.x = 0\n  }\n}\n\nfunction move({ iEvent, interaction }) {\n  if (interaction.prepared.name !== 'drag') return\n\n  const axis = interaction.prepared.axis\n\n  if (axis === 'x' || axis === 'y') {\n    const opposite = axis === 'x' ? 'y' : 'x'\n\n    iEvent.page[opposite] = interaction.coords.start.page[opposite]\n    iEvent.client[opposite] = interaction.coords.start.client[opposite]\n    iEvent.delta[opposite] = 0\n  }\n}\n\nconst draggable: Interactable['draggable'] = function draggable(\n  this: Interactable,\n  options?: DraggableOptions | boolean,\n): any {\n  if (is.object(options)) {\n    this.options.drag.enabled = options.enabled !== false\n    this.setPerAction('drag', options)\n    this.setOnEvents('drag', options)\n\n    if (/^(xy|x|y|start)$/.test(options.lockAxis)) {\n      this.options.drag.lockAxis = options.lockAxis\n    }\n    if (/^(xy|x|y)$/.test(options.startAxis)) {\n      this.options.drag.startAxis = options.startAxis\n    }\n\n    return this\n  }\n\n  if (is.bool(options)) {\n    this.options.drag.enabled = options\n\n    return this\n  }\n\n  return this.options.drag as DraggableOptions\n}\n\nconst drag: Plugin = {\n  id: 'actions/drag',\n  install,\n  listeners: {\n    'interactions:before-action-move': beforeMove,\n    'interactions:action-resume': beforeMove,\n\n    // dragmove\n    'interactions:action-move': move,\n    'auto-start:check': (arg) => {\n      const { interaction, interactable, buttons } = arg\n      const dragOptions = interactable.options.drag\n\n      if (\n        !(dragOptions && dragOptions.enabled) ||\n        // check mouseButton setting if the pointer is down\n        (interaction.pointerIsDown &&\n          /mouse|pointer/.test(interaction.pointerType) &&\n          (buttons & interactable.options.drag.mouseButtons) === 0)\n      ) {\n        return undefined\n      }\n\n      arg.action = {\n        name: 'drag',\n        axis: dragOptions.lockAxis === 'start' ? dragOptions.startAxis : dragOptions.lockAxis,\n      }\n\n      return false\n    },\n  },\n  draggable,\n  beforeMove,\n  move,\n  defaults: {\n    startAxis: 'xy',\n    lockAxis: 'xy',\n  } as DraggableOptions,\n\n  getCursor() {\n    return 'move'\n  },\n\n  filterEventType: (type: string) => type.search('drag') === 0,\n}\n\nexport default drag\n", "const domObjects: {\n  init: any\n  document: Document\n  DocumentFragment: typeof DocumentFragment\n  SVGElement: typeof SVGElement\n  SVGSVGElement: typeof SVGSVGElement\n  SVGElementInstance: any\n  Element: typeof Element\n  HTMLElement: typeof HTMLElement\n  Event: typeof Event\n  Touch: typeof Touch\n  PointerEvent: typeof PointerEvent\n} = {\n  init,\n  document: null,\n  DocumentFragment: null,\n  SVGElement: null,\n  SVGSVGElement: null,\n  SVGElementInstance: null,\n  Element: null,\n  HTMLElement: null,\n  Event: null,\n  Touch: null,\n  PointerEvent: null,\n}\n\nfunction blank() {}\n\nexport default domObjects\n\nfunction init(window: Window) {\n  const win = window as any\n\n  domObjects.document = win.document\n  domObjects.DocumentFragment = win.DocumentFragment || blank\n  domObjects.SVGElement = win.SVGElement || blank\n  domObjects.SVGSVGElement = win.SVGSVGElement || blank\n  domObjects.SVGElementInstance = win.SVGElementInstance || blank\n  domObjects.Element = win.Element || blank\n  domObjects.HTMLElement = win.HTMLElement || domObjects.Element\n\n  domObjects.Event = win.Event\n  domObjects.Touch = win.Touch || blank\n  domObjects.PointerEvent = win.PointerEvent || win.MSPointerEvent\n}\n", "import domObjects from './domObjects'\nimport is from './is'\n\nconst browser = {\n  init,\n  supportsTouch: null as boolean,\n  supportsPointerEvent: null as boolean,\n  isIOS7: null as boolean,\n  isIOS: null as boolean,\n  isIe9: null as boolean,\n  isOperaMobile: null as boolean,\n  prefixedMatchesSelector: null as 'matches',\n  pEventTypes: null as {\n    up: string\n    down: string\n    over: string\n    out: string\n    move: string\n    cancel: string\n  },\n  wheelEvent: null as string,\n}\n\nfunction init(window: any) {\n  const Element = domObjects.Element\n  const navigator: Partial<Navigator> = window.navigator || {}\n\n  // Does the browser support touch input?\n  browser.supportsTouch =\n    'ontouchstart' in window ||\n    (is.func(window.DocumentTouch) && domObjects.document instanceof window.DocumentTouch)\n\n  // Does the browser support PointerEvents\n  // https://github.com/taye/interact.js/issues/703#issuecomment-471570492\n  browser.supportsPointerEvent = (navigator as any).pointerEnabled !== false && !!domObjects.PointerEvent\n\n  browser.isIOS = /iP(hone|od|ad)/.test(navigator.platform)\n\n  // scrolling doesn't change the result of getClientRects on iOS 7\n  browser.isIOS7 = /iP(hone|od|ad)/.test(navigator.platform) && /OS 7[^\\d]/.test(navigator.appVersion)\n\n  browser.isIe9 = /MSIE 9/.test(navigator.userAgent)\n\n  // Opera Mobile must be handled differently\n  browser.isOperaMobile =\n    navigator.appName === 'Opera' && browser.supportsTouch && /Presto/.test(navigator.userAgent)\n\n  // prefix matchesSelector\n  browser.prefixedMatchesSelector = (\n    'matches' in Element.prototype\n      ? 'matches'\n      : 'webkitMatchesSelector' in Element.prototype\n        ? 'webkitMatchesSelector'\n        : 'mozMatchesSelector' in Element.prototype\n          ? 'mozMatchesSelector'\n          : 'oMatchesSelector' in Element.prototype\n            ? 'oMatchesSelector'\n            : 'msMatchesSelector'\n  ) as 'matches'\n\n  browser.pEventTypes = browser.supportsPointerEvent\n    ? domObjects.PointerEvent === window.MSPointerEvent\n      ? {\n          up: 'MSPointerUp',\n          down: 'MSPointerDown',\n          over: 'mouseover',\n          out: 'mouseout',\n          move: 'MSPointerMove',\n          cancel: 'MSPointerCancel',\n        }\n      : {\n          up: 'pointerup',\n          down: 'pointerdown',\n          over: 'pointerover',\n          out: 'pointerout',\n          move: 'pointermove',\n          cancel: 'pointercancel',\n        }\n    : null\n\n  // because Webkit and Opera still use 'mousewheel' event type\n  browser.wheelEvent = domObjects.document && 'onmousewheel' in domObjects.document ? 'mousewheel' : 'wheel'\n}\n\nexport default browser\n", "import type { Rect, Target, Element } from '@interactjs/core/types'\n\nimport browser from './browser'\nimport domObjects from './domObjects'\nimport is from './is'\nimport * as win from './window'\n\nexport function nodeContains(parent: Node, child: Node) {\n  if (parent.contains) {\n    return parent.contains(child as Node)\n  }\n\n  while (child) {\n    if (child === parent) {\n      return true\n    }\n\n    child = (child as Node).parentNode\n  }\n\n  return false\n}\n\nexport function closest(element: Node, selector: string) {\n  while (is.element(element)) {\n    if (matchesSelector(element, selector)) {\n      return element\n    }\n\n    element = parentNode(element)\n  }\n\n  return null\n}\n\nexport function parentNode(node: Node | Document) {\n  let parent = node.parentNode\n\n  if (is.docFrag(parent)) {\n    // skip past #shado-root fragments\n    // tslint:disable-next-line\n    while ((parent = (parent as any).host) && is.docFrag(parent)) {\n      continue\n    }\n\n    return parent\n  }\n\n  return parent\n}\n\nexport function matchesSelector(element: Element, selector: string) {\n  // remove /deep/ from selectors if shadowDOM polyfill is used\n  if (win.window !== win.realWindow) {\n    selector = selector.replace(/\\/deep\\//g, ' ')\n  }\n\n  return element[browser.prefixedMatchesSelector](selector)\n}\n\nconst getParent = (el: Node | Document | ShadowRoot) => el.parentNode || (el as ShadowRoot).host\n\n// Test for the element that's \"above\" all other qualifiers\nexport function indexOfDeepestElement(elements: Element[] | NodeListOf<globalThis.Element>) {\n  let deepestNodeParents: Node[] = []\n  let deepestNodeIndex: number\n\n  for (let i = 0; i < elements.length; i++) {\n    const currentNode = elements[i]\n    const deepestNode: Node = elements[deepestNodeIndex]\n\n    // node may appear in elements array multiple times\n    if (!currentNode || i === deepestNodeIndex) {\n      continue\n    }\n\n    if (!deepestNode) {\n      deepestNodeIndex = i\n      continue\n    }\n\n    const currentNodeParent = getParent(currentNode)\n    const deepestNodeParent = getParent(deepestNode)\n\n    // check if the deepest or current are document.documentElement/rootElement\n    // - if the current node is, do nothing and continue\n    if (currentNodeParent === currentNode.ownerDocument) {\n      continue\n    }\n    // - if deepest is, update with the current node and continue to next\n    else if (deepestNodeParent === currentNode.ownerDocument) {\n      deepestNodeIndex = i\n      continue\n    }\n\n    // compare zIndex of siblings\n    if (currentNodeParent === deepestNodeParent) {\n      if (zIndexIsHigherThan(currentNode, deepestNode)) {\n        deepestNodeIndex = i\n      }\n\n      continue\n    }\n\n    // populate the ancestry array for the latest deepest node\n    deepestNodeParents = deepestNodeParents.length ? deepestNodeParents : getNodeParents(deepestNode)\n\n    let ancestryStart: Node\n\n    // if the deepest node is an HTMLElement and the current node is a non root svg element\n    if (\n      deepestNode instanceof domObjects.HTMLElement &&\n      currentNode instanceof domObjects.SVGElement &&\n      !(currentNode instanceof domObjects.SVGSVGElement)\n    ) {\n      // TODO: is this check necessary? Was this for HTML elements embedded in SVG?\n      if (currentNode === deepestNodeParent) {\n        continue\n      }\n\n      ancestryStart = currentNode.ownerSVGElement\n    } else {\n      ancestryStart = currentNode\n    }\n\n    const currentNodeParents = getNodeParents(ancestryStart, deepestNode.ownerDocument)\n    let commonIndex = 0\n\n    // get (position of closest common ancestor) + 1\n    while (\n      currentNodeParents[commonIndex] &&\n      currentNodeParents[commonIndex] === deepestNodeParents[commonIndex]\n    ) {\n      commonIndex++\n    }\n\n    const parents = [\n      currentNodeParents[commonIndex - 1],\n      currentNodeParents[commonIndex],\n      deepestNodeParents[commonIndex],\n    ]\n\n    if (parents[0]) {\n      let child = parents[0].lastChild\n\n      while (child) {\n        if (child === parents[1]) {\n          deepestNodeIndex = i\n          deepestNodeParents = currentNodeParents\n\n          break\n        } else if (child === parents[2]) {\n          break\n        }\n\n        child = child.previousSibling\n      }\n    }\n  }\n\n  return deepestNodeIndex\n}\n\nfunction getNodeParents(node: Node, limit?: Node) {\n  const parents: Node[] = []\n  let parent: Node = node\n  let parentParent: Node\n\n  while ((parentParent = getParent(parent)) && parent !== limit && parentParent !== parent.ownerDocument) {\n    parents.unshift(parent)\n    parent = parentParent\n  }\n\n  return parents\n}\n\nfunction zIndexIsHigherThan(higherNode: Node, lowerNode: Node) {\n  const higherIndex = parseInt(win.getWindow(higherNode).getComputedStyle(higherNode).zIndex, 10) || 0\n  const lowerIndex = parseInt(win.getWindow(lowerNode).getComputedStyle(lowerNode).zIndex, 10) || 0\n\n  return higherIndex >= lowerIndex\n}\n\nexport function matchesUpTo(element: Element, selector: string, limit: Node) {\n  while (is.element(element)) {\n    if (matchesSelector(element, selector)) {\n      return true\n    }\n\n    element = parentNode(element) as Element\n\n    if (element === limit) {\n      return matchesSelector(element, selector)\n    }\n  }\n\n  return false\n}\n\nexport function getActualElement(element: Element) {\n  return (element as any).correspondingUseElement || element\n}\n\nexport function getScrollXY(relevantWindow?: Window) {\n  relevantWindow = relevantWindow || win.window\n  return {\n    x: relevantWindow.scrollX || relevantWindow.document.documentElement.scrollLeft,\n    y: relevantWindow.scrollY || relevantWindow.document.documentElement.scrollTop,\n  }\n}\n\nexport function getElementClientRect(element: Element): Required<Rect> {\n  const clientRect =\n    element instanceof domObjects.SVGElement ? element.getBoundingClientRect() : element.getClientRects()[0]\n\n  return (\n    clientRect && {\n      left: clientRect.left,\n      right: clientRect.right,\n      top: clientRect.top,\n      bottom: clientRect.bottom,\n      width: clientRect.width || clientRect.right - clientRect.left,\n      height: clientRect.height || clientRect.bottom - clientRect.top,\n    }\n  )\n}\n\nexport function getElementRect(element: Element) {\n  const clientRect = getElementClientRect(element)\n\n  if (!browser.isIOS7 && clientRect) {\n    const scroll = getScrollXY(win.getWindow(element))\n\n    clientRect.left += scroll.x\n    clientRect.right += scroll.x\n    clientRect.top += scroll.y\n    clientRect.bottom += scroll.y\n  }\n\n  return clientRect\n}\n\nexport function getPath(node: Node | Document) {\n  const path = []\n\n  while (node) {\n    path.push(node)\n    node = parentNode(node)\n  }\n\n  return path\n}\n\nexport function trySelector(value: Target) {\n  if (!is.string(value)) {\n    return false\n  }\n\n  // an exception will be raised if it is invalid\n  domObjects.document.querySelector(value)\n  return true\n}\n", "export default function extend<T, U extends object>(dest: U & Partial<T>, source: T): T & U {\n  for (const prop in source) {\n    ;(dest as unknown as T)[prop] = source[prop]\n  }\n\n  const ret = dest as T & U\n\n  return ret\n}\n", "import type {\n  HasGetRect,\n  RectResolvable,\n  Rect,\n  Element,\n  Point,\n  FullRect,\n  EdgeOptions,\n} from '@interactjs/core/types'\n\nimport { closest, getElementRect, parentNode } from './domUtils'\nimport extend from './extend'\nimport is from './is'\n\nexport function getStringOptionResult(value: any, target: HasGetRect, element: Node) {\n  if (value === 'parent') {\n    return parentNode(element)\n  }\n\n  if (value === 'self') {\n    return target.getRect(element as Element)\n  }\n\n  return closest(element, value)\n}\n\nexport function resolveRectLike<T extends any[]>(\n  value: RectResolvable<T>,\n  target?: HasGetRect,\n  element?: Node,\n  functionArgs?: T,\n) {\n  let returnValue: any = value\n  if (is.string(returnValue)) {\n    returnValue = getStringOptionResult(returnValue, target, element)\n  } else if (is.func(returnValue)) {\n    returnValue = returnValue(...functionArgs)\n  }\n\n  if (is.element(returnValue)) {\n    returnValue = getElementRect(returnValue)\n  }\n\n  return returnValue as Rect\n}\n\nexport function toFullRect(rect: Rect): FullRect {\n  const { top, left, bottom, right } = rect\n  const width = rect.width ?? rect.right - rect.left\n  const height = rect.height ?? rect.bottom - rect.top\n\n  return { top, left, bottom, right, width, height }\n}\n\nexport function rectToXY(rect: Rect | Point) {\n  return (\n    rect && {\n      x: 'x' in rect ? rect.x : rect.left,\n      y: 'y' in rect ? rect.y : rect.top,\n    }\n  )\n}\n\nexport function xywhToTlbr<T extends Partial<Rect & Point>>(rect: T) {\n  if (rect && !('left' in rect && 'top' in rect)) {\n    rect = extend({}, rect)\n\n    rect.left = rect.x || 0\n    rect.top = rect.y || 0\n    rect.right = rect.right || rect.left + rect.width\n    rect.bottom = rect.bottom || rect.top + rect.height\n  }\n\n  return rect as Rect & T\n}\n\nexport function tlbrToXywh(rect: Rect & Partial<Point>) {\n  if (rect && !('x' in rect && 'y' in rect)) {\n    rect = extend({}, rect)\n\n    rect.x = rect.left || 0\n    rect.y = rect.top || 0\n    rect.width = rect.width || (rect.right || 0) - rect.x\n    rect.height = rect.height || (rect.bottom || 0) - rect.y\n  }\n\n  return rect as FullRect & Point\n}\n\nexport function addEdges(edges: EdgeOptions, rect: Rect, delta: Point) {\n  if (edges.left) {\n    rect.left += delta.x\n  }\n  if (edges.right) {\n    rect.right += delta.x\n  }\n  if (edges.top) {\n    rect.top += delta.y\n  }\n  if (edges.bottom) {\n    rect.bottom += delta.y\n  }\n\n  rect.width = rect.right - rect.left\n  rect.height = rect.bottom - rect.top\n}\n", "import type { PerActionDefaults } from '@interactjs/core/options'\nimport type { ActionName, HasGetRect } from '@interactjs/core/types'\n\nimport { rectToXY, resolveRectLike } from './rect'\n\nexport default function getOriginXY(\n  target: HasGetRect & { options: PerActionDefaults },\n  element: Node,\n  actionName?: ActionName,\n) {\n  const actionOptions = actionName && (target.options as any)[actionName]\n  const actionOrigin = actionOptions && actionOptions.origin\n  const origin = actionOrigin || target.options.origin\n\n  const originRect = resolveRectLike(origin, target, element, [target && element])\n\n  return rectToXY(originRect) || { x: 0, y: 0 }\n}\n", "import type { EventTypes, Listener, ListenersArg } from '@interactjs/core/types'\n\nimport is from './is'\n\nexport interface NormalizedListeners {\n  [type: string]: Listener[]\n}\n\nexport default function normalize(\n  type: EventTypes,\n  listeners?: ListenersArg | ListenersArg[] | null,\n  filter = (_typeOrPrefix: string) => true,\n  result?: NormalizedListeners,\n): NormalizedListeners {\n  result = result || {}\n\n  if (is.string(type) && type.search(' ') !== -1) {\n    type = split(type)\n  }\n\n  if (is.array(type)) {\n    type.forEach((t) => normalize(t, listeners, filter, result))\n    return result\n  }\n\n  // before:  type = [{ drag: () => {} }], listeners = undefined\n  // after:   type = ''                  , listeners = [{ drag: () => {} }]\n  if (is.object(type)) {\n    listeners = type\n    type = ''\n  }\n\n  if (is.func(listeners) && filter(type)) {\n    result[type] = result[type] || []\n    result[type].push(listeners)\n  } else if (is.array(listeners)) {\n    for (const l of listeners) {\n      normalize(type, l, filter, result)\n    }\n  } else if (is.object(listeners)) {\n    for (const prefix in listeners) {\n      const combinedTypes = split(prefix).map((p) => `${type}${p}`)\n\n      normalize(combinedTypes, listeners[prefix], filter, result)\n    }\n  }\n\n  return result as NormalizedListeners\n}\n\nfunction split(type: string) {\n  return type.trim().split(/ +/)\n}\n", "export default (x: number, y: number) => Math.sqrt(x * x + y * y)\n", "const VENDOR_PREFIXES = ['webkit', 'moz']\n\nexport default function pointerExtend<T>(dest: Partial<T & { __set?: Partial<T> }>, source: T) {\n  dest.__set ||= {} as any\n\n  for (const prop in source) {\n    // skip deprecated prefixed properties\n    if (VENDOR_PREFIXES.some((prefix) => prop.indexOf(prefix) === 0)) continue\n\n    if (typeof dest[prop] !== 'function' && prop !== '__set') {\n      Object.defineProperty(dest, prop, {\n        get() {\n          if (prop in dest.__set) return dest.__set[prop]\n\n          return (dest.__set[prop] = source[prop] as any)\n        },\n        set(value: any) {\n          dest.__set[prop] = value\n        },\n        configurable: true,\n      })\n    }\n  }\n  return dest\n}\n", "import type { InteractEvent } from '@interactjs/core/InteractEvent'\nimport type { CoordsSetMember, PointerType, Point, PointerEventType, Element } from '@interactjs/core/types'\n\nimport browser from './browser'\nimport dom from './domObjects'\nimport * as domUtils from './domUtils'\nimport hypot from './hypot'\nimport is from './is'\nimport pointerExtend from './pointerExtend'\n\nexport function copyCoords(dest: CoordsSetMember, src: CoordsSetMember) {\n  dest.page = dest.page || ({} as any)\n  dest.page.x = src.page.x\n  dest.page.y = src.page.y\n\n  dest.client = dest.client || ({} as any)\n  dest.client.x = src.client.x\n  dest.client.y = src.client.y\n\n  dest.timeStamp = src.timeStamp\n}\n\nexport function setCoordDeltas(targetObj: CoordsSetMember, prev: CoordsSetMember, cur: CoordsSetMember) {\n  targetObj.page.x = cur.page.x - prev.page.x\n  targetObj.page.y = cur.page.y - prev.page.y\n  targetObj.client.x = cur.client.x - prev.client.x\n  targetObj.client.y = cur.client.y - prev.client.y\n  targetObj.timeStamp = cur.timeStamp - prev.timeStamp\n}\n\nexport function setCoordVelocity(targetObj: CoordsSetMember, delta: CoordsSetMember) {\n  const dt = Math.max(delta.timeStamp / 1000, 0.001)\n\n  targetObj.page.x = delta.page.x / dt\n  targetObj.page.y = delta.page.y / dt\n  targetObj.client.x = delta.client.x / dt\n  targetObj.client.y = delta.client.y / dt\n  targetObj.timeStamp = dt\n}\n\nexport function setZeroCoords(targetObj: CoordsSetMember) {\n  targetObj.page.x = 0\n  targetObj.page.y = 0\n  targetObj.client.x = 0\n  targetObj.client.y = 0\n}\n\nexport function isNativePointer(pointer: any) {\n  return pointer instanceof dom.Event || pointer instanceof dom.Touch\n}\n\n// Get specified X/Y coords for mouse or event.touches[0]\nexport function getXY(type: string, pointer: PointerType | InteractEvent, xy: Point) {\n  xy = xy || ({} as Point)\n  type = type || 'page'\n\n  xy.x = pointer[(type + 'X') as 'pageX']\n  xy.y = pointer[(type + 'Y') as 'pageY']\n\n  return xy\n}\n\nexport function getPageXY(pointer: PointerType | InteractEvent, page?: Point) {\n  page = page || { x: 0, y: 0 }\n\n  // Opera Mobile handles the viewport and scrolling oddly\n  if (browser.isOperaMobile && isNativePointer(pointer)) {\n    getXY('screen', pointer, page)\n\n    page.x += window.scrollX\n    page.y += window.scrollY\n  } else {\n    getXY('page', pointer, page)\n  }\n\n  return page\n}\n\nexport function getClientXY(pointer: PointerType, client: Point) {\n  client = client || ({} as any)\n\n  if (browser.isOperaMobile && isNativePointer(pointer)) {\n    // Opera Mobile handles the viewport and scrolling oddly\n    getXY('screen', pointer, client)\n  } else {\n    getXY('client', pointer, client)\n  }\n\n  return client\n}\n\nexport function getPointerId(pointer: { pointerId?: number; identifier?: number; type?: string }) {\n  return is.number(pointer.pointerId) ? pointer.pointerId! : pointer.identifier!\n}\n\nexport function setCoords(dest: CoordsSetMember, pointers: any[], timeStamp: number) {\n  const pointer = pointers.length > 1 ? pointerAverage(pointers) : pointers[0]\n\n  getPageXY(pointer, dest.page)\n  getClientXY(pointer, dest.client)\n\n  dest.timeStamp = timeStamp\n}\n\nexport function getTouchPair(event: TouchEvent | PointerType[]) {\n  const touches: PointerType[] = []\n\n  // array of touches is supplied\n  if (is.array(event)) {\n    touches[0] = event[0]\n    touches[1] = event[1]\n  }\n  // an event\n  else {\n    if (event.type === 'touchend') {\n      if (event.touches.length === 1) {\n        touches[0] = event.touches[0]\n        touches[1] = event.changedTouches[0]\n      } else if (event.touches.length === 0) {\n        touches[0] = event.changedTouches[0]\n        touches[1] = event.changedTouches[1]\n      }\n    } else {\n      touches[0] = event.touches[0]\n      touches[1] = event.touches[1]\n    }\n  }\n\n  return touches\n}\n\nexport function pointerAverage(pointers: PointerType[]) {\n  const average = {\n    pageX: 0,\n    pageY: 0,\n    clientX: 0,\n    clientY: 0,\n    screenX: 0,\n    screenY: 0,\n  }\n\n  type CoordKeys = keyof typeof average\n\n  for (const pointer of pointers) {\n    for (const prop in average) {\n      average[prop as CoordKeys] += pointer[prop as CoordKeys]\n    }\n  }\n  for (const prop in average) {\n    average[prop as CoordKeys] /= pointers.length\n  }\n\n  return average\n}\n\nexport function touchBBox(event: PointerType[]) {\n  if (!event.length) {\n    return null\n  }\n\n  const touches = getTouchPair(event)\n  const minX = Math.min(touches[0].pageX, touches[1].pageX)\n  const minY = Math.min(touches[0].pageY, touches[1].pageY)\n  const maxX = Math.max(touches[0].pageX, touches[1].pageX)\n  const maxY = Math.max(touches[0].pageY, touches[1].pageY)\n\n  return {\n    x: minX,\n    y: minY,\n    left: minX,\n    top: minY,\n    right: maxX,\n    bottom: maxY,\n    width: maxX - minX,\n    height: maxY - minY,\n  }\n}\n\nexport function touchDistance(event: PointerType[] | TouchEvent, deltaSource: string) {\n  const sourceX = (deltaSource + 'X') as 'pageX'\n  const sourceY = (deltaSource + 'Y') as 'pageY'\n  const touches = getTouchPair(event)\n\n  const dx = touches[0][sourceX] - touches[1][sourceX]\n  const dy = touches[0][sourceY] - touches[1][sourceY]\n\n  return hypot(dx, dy)\n}\n\nexport function touchAngle(event: PointerType[] | TouchEvent, deltaSource: string) {\n  const sourceX = (deltaSource + 'X') as 'pageX'\n  const sourceY = (deltaSource + 'Y') as 'pageY'\n  const touches = getTouchPair(event)\n  const dx = touches[1][sourceX] - touches[0][sourceX]\n  const dy = touches[1][sourceY] - touches[0][sourceY]\n  const angle = (180 * Math.atan2(dy, dx)) / Math.PI\n\n  return angle\n}\n\nexport function getPointerType(pointer: { pointerType?: string; identifier?: number; type?: string }) {\n  return is.string(pointer.pointerType)\n    ? pointer.pointerType\n    : is.number(pointer.pointerType)\n      ? [undefined, undefined, 'touch', 'pen', 'mouse'][pointer.pointerType]!\n      : // if the PointerEvent API isn't available, then the \"pointer\" must\n        // be either a MouseEvent, TouchEvent, or Touch object\n        /touch/.test(pointer.type || '') || pointer instanceof dom.Touch\n        ? 'touch'\n        : 'mouse'\n}\n\n// [ event.target, event.currentTarget ]\nexport function getEventTargets(event: Event) {\n  const path = is.func(event.composedPath)\n    ? (event.composedPath() as Element[])\n    : (event as unknown as { path: Element[] }).path\n\n  return [\n    domUtils.getActualElement(path ? path[0] : (event.target as Element)),\n    domUtils.getActualElement(event.currentTarget as Element),\n  ]\n}\n\nexport function newCoords(): CoordsSetMember {\n  return {\n    page: { x: 0, y: 0 },\n    client: { x: 0, y: 0 },\n    timeStamp: 0,\n  }\n}\n\nexport function coordsToEvent(coords: MockCoords) {\n  const event = {\n    coords,\n    get page() {\n      return this.coords.page\n    },\n    get client() {\n      return this.coords.client\n    },\n    get timeStamp() {\n      return this.coords.timeStamp\n    },\n    get pageX() {\n      return this.coords.page.x\n    },\n    get pageY() {\n      return this.coords.page.y\n    },\n    get clientX() {\n      return this.coords.client.x\n    },\n    get clientY() {\n      return this.coords.client.y\n    },\n    get pointerId() {\n      return this.coords.pointerId\n    },\n    get target() {\n      return this.coords.target\n    },\n    get type() {\n      return this.coords.type\n    },\n    get pointerType() {\n      return this.coords.pointerType\n    },\n    get buttons() {\n      return this.coords.buttons\n    },\n    preventDefault() {},\n  }\n\n  return event as typeof event & PointerType & PointerEventType\n}\n\nexport interface MockCoords {\n  page: Point\n  client: Point\n  timeStamp?: number\n  pointerId?: any\n  target?: any\n  type?: string\n  pointerType?: string\n  buttons?: number\n}\n\nexport { pointerExtend }\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { Interaction, InteractionProxy } from '@interactjs/core/Interaction'\nimport type { ActionName } from '@interactjs/core/types'\n\nexport class BaseEvent<T extends ActionName | null = never> {\n  declare type: string\n  declare target: EventTarget\n  declare currentTarget: Node\n  declare interactable: Interactable\n  /** @internal */\n  declare _interaction: Interaction<T>\n  declare timeStamp: number\n  immediatePropagationStopped = false\n  propagationStopped = false\n\n  constructor(interaction: Interaction<T>) {\n    this._interaction = interaction\n  }\n\n  preventDefault() {}\n\n  /**\n   * Don't call any other listeners (even on the current target)\n   */\n  stopPropagation() {\n    this.propagationStopped = true\n  }\n\n  /**\n   * Don't call listeners on the remaining targets\n   */\n  stopImmediatePropagation() {\n    this.immediatePropagationStopped = this.propagationStopped = true\n  }\n}\n\n// defined outside of class definition to avoid assignment of undefined during\n// construction\nexport interface BaseEvent<T extends ActionName | null = never> {\n  interaction: InteractionProxy<T>\n}\n\n// getters and setters defined here to support typescript 3.6 and below which\n// don't support getter and setters in .d.ts files\nObject.defineProperty(BaseEvent.prototype, 'interaction', {\n  get(this: BaseEvent) {\n    return this._interaction._proxy\n  },\n  set(this: BaseEvent) {},\n})\n", "type Filter<T> = (element: T, index: number, array: T[]) => boolean\n\nexport const contains = <T>(array: T[], target: T) => array.indexOf(target) !== -1\n\nexport const remove = <T>(array: T[], target: T) => array.splice(array.indexOf(target), 1)\n\nexport const merge = <T, U>(target: Array<T | U>, source: U[]) => {\n  for (const item of source) {\n    target.push(item)\n  }\n\n  return target\n}\n\nexport const from = <T = any>(source: ArrayLike<T>) => merge([] as T[], source as T[])\n\nexport const findIndex = <T>(array: T[], func: Filter<T>) => {\n  for (let i = 0; i < array.length; i++) {\n    if (func(array[i], i, array)) {\n      return i\n    }\n  }\n\n  return -1\n}\n\nexport const find = <T = any>(array: T[], func: Filter<T>): T | undefined => array[findIndex(array, func)]\n", "import { BaseEvent } from '@interactjs/core/BaseEvent'\nimport type { Interactable } from '@interactjs/core/Interactable'\nimport type { InteractEvent } from '@interactjs/core/InteractEvent'\nimport type { Element } from '@interactjs/core/types'\nimport * as arr from '@interactjs/utils/arr'\n\nimport type { DropState } from './plugin'\n\nexport class DropEvent extends BaseEvent<'drag'> {\n  declare target: Element\n  dropzone: Interactable\n  dragEvent: InteractEvent<'drag'>\n  relatedTarget: Element\n  draggable: Interactable\n  propagationStopped = false\n  immediatePropagationStopped = false\n\n  /**\n   * Class of events fired on dropzones during drags with acceptable targets.\n   */\n  constructor(dropState: DropState, dragEvent: InteractEvent<'drag'>, type: string) {\n    super(dragEvent._interaction)\n\n    const { element, dropzone } = type === 'dragleave' ? dropState.prev : dropState.cur\n\n    this.type = type\n    this.target = element\n    this.currentTarget = element\n    this.dropzone = dropzone\n    this.dragEvent = dragEvent\n    this.relatedTarget = dragEvent.target\n    this.draggable = dragEvent.interactable\n    this.timeStamp = dragEvent.timeStamp\n  }\n\n  /**\n   * If this is a `dropactivate` event, the dropzone element will be\n   * deactivated.\n   *\n   * If this is a `dragmove` or `dragenter`, a `dragleave` will be fired on the\n   * dropzone element and more.\n   */\n  reject() {\n    const { dropState } = this._interaction\n\n    if (\n      this.type !== 'dropactivate' &&\n      (!this.dropzone || dropState.cur.dropzone !== this.dropzone || dropState.cur.element !== this.target)\n    ) {\n      return\n    }\n\n    dropState.prev.dropzone = this.dropzone\n    dropState.prev.element = this.target\n\n    dropState.rejected = true\n    dropState.events.enter = null\n\n    this.stopImmediatePropagation()\n\n    if (this.type === 'dropactivate') {\n      const activeDrops = dropState.activeDrops\n      const index = arr.findIndex(\n        activeDrops,\n        ({ dropzone, element }) => dropzone === this.dropzone && element === this.target,\n      )\n\n      dropState.activeDrops.splice(index, 1)\n\n      const deactivateEvent = new DropEvent(dropState, this.dragEvent, 'dropdeactivate')\n\n      deactivateEvent.dropzone = this.dropzone\n      deactivateEvent.target = this.target\n\n      this.dropzone.fire(deactivateEvent)\n    } else {\n      this.dropzone.fire(new DropEvent(dropState, this.dragEvent, 'dragleave'))\n    }\n  }\n\n  preventDefault() {}\n\n  stopPropagation() {\n    this.propagationStopped = true\n  }\n\n  stopImmediatePropagation() {\n    this.immediatePropagationStopped = this.propagationStopped = true\n  }\n}\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { EventPhase, InteractEvent } from '@interactjs/core/InteractEvent'\nimport type { Interaction, DoPhaseArg } from '@interactjs/core/Interaction'\nimport type { PerActionDefaults } from '@interactjs/core/options'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { Element, PointerEventType, Rect, ListenersArg } from '@interactjs/core/types'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport extend from '@interactjs/utils/extend'\nimport getOriginXY from '@interactjs/utils/getOriginXY'\nimport is from '@interactjs/utils/is'\nimport normalizeListeners from '@interactjs/utils/normalizeListeners'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport '../drag/plugin'\n\nimport type { DragEvent } from '../drag/plugin'\nimport drag from '../drag/plugin'\n/* eslint-enable import/no-duplicates */\n\nimport { DropEvent } from './DropEvent'\n\nexport type DropFunctionChecker = (\n  dragEvent: any, // related drag operation\n  event: any, // touch or mouse EventEmitter\n  dropped: boolean, // default checker result\n  dropzone: Interactable, // dropzone interactable\n  dropElement: Element, // drop zone element\n  draggable: Interactable, // draggable's Interactable\n  draggableElement: Element, // dragged element\n) => boolean\n\nexport interface DropzoneOptions extends PerActionDefaults {\n  accept?:\n    | string\n    | Element\n    | (({ dropzone, draggableElement }: { dropzone: Interactable; draggableElement: Element }) => boolean)\n  // How the overlap is checked on the drop zone\n  overlap?: 'pointer' | 'center' | number\n  checker?: DropFunctionChecker\n\n  ondropactivate?: ListenersArg\n  ondropdeactivate?: ListenersArg\n  ondragenter?: ListenersArg\n  ondragleave?: ListenersArg\n  ondropmove?: ListenersArg\n  ondrop?: ListenersArg\n}\n\nexport interface DropzoneMethod {\n  (this: Interactable, options: DropzoneOptions | boolean): Interactable\n  (): DropzoneOptions\n}\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    /**\n     *\n     * ```js\n     * interact('.drop').dropzone({\n     *   accept: '.can-drop' || document.getElementById('single-drop'),\n     *   overlap: 'pointer' || 'center' || zeroToOne\n     * }\n     * ```\n     *\n     * Returns or sets whether draggables can be dropped onto this target to\n     * trigger drop events\n     *\n     * Dropzones can receive the following events:\n     *  - `dropactivate` and `dropdeactivate` when an acceptable drag starts and ends\n     *  - `dragenter` and `dragleave` when a draggable enters and leaves the dropzone\n     *  - `dragmove` when a draggable that has entered the dropzone is moved\n     *  - `drop` when a draggable is dropped into this dropzone\n     *\n     * Use the `accept` option to allow only elements that match the given CSS\n     * selector or element. The value can be:\n     *\n     *  - **an Element** - only that element can be dropped into this dropzone.\n     *  - **a string**, - the element being dragged must match it as a CSS selector.\n     *  - **`null`** - accept options is cleared - it accepts any element.\n     *\n     * Use the `overlap` option to set how drops are checked for. The allowed\n     * values are:\n     *\n     *   - `'pointer'`, the pointer must be over the dropzone (default)\n     *   - `'center'`, the draggable element's center must be over the dropzone\n     *   - a number from 0-1 which is the `(intersection area) / (draggable area)`.\n     *   e.g. `0.5` for drop to happen when half of the area of the draggable is\n     *   over the dropzone\n     *\n     * Use the `checker` option to specify a function to check if a dragged element\n     * is over this Interactable.\n     *\n     * @param options - The new options to be set\n     */\n    dropzone(options: DropzoneOptions | boolean): Interactable\n    /** @returns The current setting */\n    dropzone(): DropzoneOptions\n\n    /**\n     * ```js\n     * interact(target)\n     * .dropChecker(function(dragEvent,         // related dragmove or dragend event\n     *                       event,             // TouchEvent/PointerEvent/MouseEvent\n     *                       dropped,           // bool result of the default checker\n     *                       dropzone,          // dropzone Interactable\n     *                       dropElement,       // dropzone elemnt\n     *                       draggable,         // draggable Interactable\n     *                       draggableElement) {// draggable element\n     *\n     *   return dropped && event.target.hasAttribute('allow-drop')\n     * }\n     * ```\n     */\n    dropCheck(\n      dragEvent: InteractEvent,\n      event: PointerEventType,\n      draggable: Interactable,\n      draggableElement: Element,\n      dropElemen: Element,\n      rect: any,\n    ): boolean\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    dropState?: DropState\n  }\n}\n\ndeclare module '@interactjs/core/InteractEvent' {\n  interface InteractEvent {\n    /** @internal */\n    prevDropzone?: Interactable\n    dropzone?: Interactable\n    dragEnter?: Element\n    dragLeave?: Element\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface ActionDefaults {\n    drop: DropzoneOptions\n  }\n}\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    dynamicDrop?: boolean\n  }\n\n  interface SignalArgs {\n    'actions/drop:start': DropSignalArg\n    'actions/drop:move': DropSignalArg\n    'actions/drop:end': DropSignalArg\n  }\n}\n\ndeclare module '@interactjs/core/types' {\n  interface ActionMap {\n    drop?: typeof drop\n  }\n}\n\ndeclare module '@interactjs/core/InteractStatic' {\n  interface InteractStatic {\n    /**\n     * Returns or sets whether the dimensions of dropzone elements are calculated\n     * on every dragmove or only on dragstart for the default dropChecker\n     *\n     * @param {boolean} [newValue] True to check on each move. False to check only\n     * before start\n     * @return {boolean | interact} The current setting or interact\n     */\n    dynamicDrop: (newValue?: boolean) => boolean | this\n  }\n}\n\ninterface DropSignalArg {\n  interaction: Interaction<'drag'>\n  dragEvent: DragEvent\n}\n\nexport interface ActiveDrop {\n  dropzone: Interactable\n  element: Element\n  rect: Rect\n}\n\nexport interface DropState {\n  cur: {\n    // the dropzone a drag target might be dropped into\n    dropzone: Interactable\n    // the element at the time of checking\n    element: Element\n  }\n  prev: {\n    // the dropzone that was recently dragged away from\n    dropzone: Interactable\n    // the element at the time of checking\n    element: Element\n  }\n  // wheather the potential drop was rejected from a listener\n  rejected: boolean\n  // the drop events related to the current drag event\n  events: FiredDropEvents\n  activeDrops: ActiveDrop[]\n}\n\nfunction install(scope: Scope) {\n  const { actions, interactStatic: interact, Interactable, defaults } = scope\n\n  scope.usePlugin(drag)\n\n  Interactable.prototype.dropzone = function (this: Interactable, options) {\n    return dropzoneMethod(this, options)\n  } as Interactable['dropzone']\n\n  Interactable.prototype.dropCheck = function (\n    this: Interactable,\n    dragEvent,\n    event,\n    draggable,\n    draggableElement,\n    dropElement,\n    rect,\n  ) {\n    return dropCheckMethod(this, dragEvent, event, draggable, draggableElement, dropElement, rect)\n  }\n\n  interact.dynamicDrop = function (newValue?: boolean) {\n    if (is.bool(newValue)) {\n      // if (dragging && scope.dynamicDrop !== newValue && !newValue) {\n      //  calcRects(dropzones)\n      // }\n\n      scope.dynamicDrop = newValue\n\n      return interact\n    }\n    return scope.dynamicDrop!\n  }\n\n  extend(actions.phaselessTypes, {\n    dragenter: true,\n    dragleave: true,\n    dropactivate: true,\n    dropdeactivate: true,\n    dropmove: true,\n    drop: true,\n  })\n  actions.methodDict.drop = 'dropzone'\n\n  scope.dynamicDrop = false\n\n  defaults.actions.drop = drop.defaults\n}\n\nfunction collectDropzones({ interactables }: Scope, draggableElement: Element) {\n  const drops: ActiveDrop[] = []\n\n  // collect all dropzones and their elements which qualify for a drop\n  for (const dropzone of interactables.list) {\n    if (!dropzone.options.drop.enabled) {\n      continue\n    }\n\n    const accept = dropzone.options.drop.accept\n\n    // test the draggable draggableElement against the dropzone's accept setting\n    if (\n      (is.element(accept) && accept !== draggableElement) ||\n      (is.string(accept) && !domUtils.matchesSelector(draggableElement, accept)) ||\n      (is.func(accept) && !accept({ dropzone, draggableElement }))\n    ) {\n      continue\n    }\n\n    for (const dropzoneElement of dropzone.getAllElements()) {\n      if (dropzoneElement !== draggableElement) {\n        drops.push({\n          dropzone,\n          element: dropzoneElement,\n          rect: dropzone.getRect(dropzoneElement),\n        })\n      }\n    }\n  }\n\n  return drops\n}\n\nfunction fireActivationEvents(activeDrops: ActiveDrop[], event: DropEvent) {\n  // loop through all active dropzones and trigger event\n  for (const { dropzone, element } of activeDrops.slice()) {\n    event.dropzone = dropzone\n\n    // set current element as event target\n    event.target = element\n    dropzone.fire(event)\n    event.propagationStopped = event.immediatePropagationStopped = false\n  }\n}\n\n// return a new array of possible drops. getActiveDrops should always be\n// called when a drag has just started or a drag event happens while\n// dynamicDrop is true\nfunction getActiveDrops(scope: Scope, dragElement: Element) {\n  // get dropzones and their elements that could receive the draggable\n  const activeDrops = collectDropzones(scope, dragElement)\n\n  for (const activeDrop of activeDrops) {\n    activeDrop.rect = activeDrop.dropzone.getRect(activeDrop.element)\n  }\n\n  return activeDrops\n}\n\nfunction getDrop(\n  { dropState, interactable: draggable, element: dragElement }: Interaction,\n  dragEvent,\n  pointerEvent,\n) {\n  const validDrops: Element[] = []\n\n  // collect all dropzones and their elements which qualify for a drop\n  for (const { dropzone, element: dropzoneElement, rect } of dropState.activeDrops) {\n    const isValid = dropzone.dropCheck(\n      dragEvent,\n      pointerEvent,\n      draggable!,\n      dragElement!,\n      dropzoneElement,\n      rect,\n    )\n    validDrops.push(isValid ? dropzoneElement : null)\n  }\n\n  // get the most appropriate dropzone based on DOM depth and order\n  const dropIndex = domUtils.indexOfDeepestElement(validDrops)\n\n  return dropState!.activeDrops[dropIndex] || null\n}\n\nfunction getDropEvents(interaction: Interaction, _pointerEvent, dragEvent: DragEvent) {\n  const dropState = interaction.dropState!\n  const dropEvents: Record<string, DropEvent | null> = {\n    enter: null,\n    leave: null,\n    activate: null,\n    deactivate: null,\n    move: null,\n    drop: null,\n  }\n\n  if (dragEvent.type === 'dragstart') {\n    dropEvents.activate = new DropEvent(dropState, dragEvent, 'dropactivate')\n\n    dropEvents.activate.target = null as never\n    dropEvents.activate.dropzone = null as never\n  }\n  if (dragEvent.type === 'dragend') {\n    dropEvents.deactivate = new DropEvent(dropState, dragEvent, 'dropdeactivate')\n\n    dropEvents.deactivate.target = null as never\n    dropEvents.deactivate.dropzone = null as never\n  }\n\n  if (dropState.rejected) {\n    return dropEvents\n  }\n\n  if (dropState.cur.element !== dropState.prev.element) {\n    // if there was a previous dropzone, create a dragleave event\n    if (dropState.prev.dropzone) {\n      dropEvents.leave = new DropEvent(dropState, dragEvent, 'dragleave')\n\n      dragEvent.dragLeave = dropEvents.leave.target = dropState.prev.element\n      dragEvent.prevDropzone = dropEvents.leave.dropzone = dropState.prev.dropzone\n    }\n    // if dropzone is not null, create a dragenter event\n    if (dropState.cur.dropzone) {\n      dropEvents.enter = new DropEvent(dropState, dragEvent, 'dragenter')\n\n      dragEvent.dragEnter = dropState.cur.element\n      dragEvent.dropzone = dropState.cur.dropzone\n    }\n  }\n\n  if (dragEvent.type === 'dragend' && dropState.cur.dropzone) {\n    dropEvents.drop = new DropEvent(dropState, dragEvent, 'drop')\n\n    dragEvent.dropzone = dropState.cur.dropzone\n    dragEvent.relatedTarget = dropState.cur.element\n  }\n  if (dragEvent.type === 'dragmove' && dropState.cur.dropzone) {\n    dropEvents.move = new DropEvent(dropState, dragEvent, 'dropmove')\n\n    dragEvent.dropzone = dropState.cur.dropzone\n  }\n\n  return dropEvents\n}\n\ntype FiredDropEvents = Partial<\n  Record<'leave' | 'enter' | 'move' | 'drop' | 'activate' | 'deactivate', DropEvent>\n>\n\nfunction fireDropEvents(interaction: Interaction, events: FiredDropEvents) {\n  const dropState = interaction.dropState!\n  const { activeDrops, cur, prev } = dropState\n\n  if (events.leave) {\n    prev.dropzone.fire(events.leave)\n  }\n  if (events.enter) {\n    cur.dropzone.fire(events.enter)\n  }\n  if (events.move) {\n    cur.dropzone.fire(events.move)\n  }\n  if (events.drop) {\n    cur.dropzone.fire(events.drop)\n  }\n\n  if (events.deactivate) {\n    fireActivationEvents(activeDrops, events.deactivate)\n  }\n\n  dropState.prev.dropzone = cur.dropzone\n  dropState.prev.element = cur.element\n}\n\nfunction onEventCreated({ interaction, iEvent, event }: DoPhaseArg<'drag', EventPhase>, scope: Scope) {\n  if (iEvent.type !== 'dragmove' && iEvent.type !== 'dragend') {\n    return\n  }\n\n  const dropState = interaction.dropState!\n\n  if (scope.dynamicDrop) {\n    dropState.activeDrops = getActiveDrops(scope, interaction.element!)\n  }\n\n  const dragEvent = iEvent\n  const dropResult = getDrop(interaction, dragEvent, event)\n\n  // update rejected status\n  dropState.rejected =\n    dropState.rejected &&\n    !!dropResult &&\n    dropResult.dropzone === dropState.cur.dropzone &&\n    dropResult.element === dropState.cur.element\n\n  dropState.cur.dropzone = dropResult && dropResult.dropzone\n  dropState.cur.element = dropResult && dropResult.element\n\n  dropState.events = getDropEvents(interaction, event, dragEvent)\n}\n\nfunction dropzoneMethod(interactable: Interactable): DropzoneOptions\nfunction dropzoneMethod(interactable: Interactable, options: DropzoneOptions | boolean): Interactable\nfunction dropzoneMethod(interactable: Interactable, options?: DropzoneOptions | boolean) {\n  if (is.object(options)) {\n    interactable.options.drop.enabled = options.enabled !== false\n\n    if (options.listeners) {\n      const normalized = normalizeListeners(options.listeners)\n      // rename 'drop' to '' as it will be prefixed with 'drop'\n      const corrected = Object.keys(normalized).reduce((acc, type) => {\n        const correctedType = /^(enter|leave)/.test(type)\n          ? `drag${type}`\n          : /^(activate|deactivate|move)/.test(type)\n            ? `drop${type}`\n            : type\n\n        acc[correctedType] = normalized[type]\n\n        return acc\n      }, {})\n\n      const prevListeners = interactable.options.drop.listeners\n      prevListeners && interactable.off(prevListeners)\n\n      interactable.on(corrected)\n      interactable.options.drop.listeners = corrected\n    }\n\n    if (is.func(options.ondrop)) {\n      interactable.on('drop', options.ondrop)\n    }\n    if (is.func(options.ondropactivate)) {\n      interactable.on('dropactivate', options.ondropactivate)\n    }\n    if (is.func(options.ondropdeactivate)) {\n      interactable.on('dropdeactivate', options.ondropdeactivate)\n    }\n    if (is.func(options.ondragenter)) {\n      interactable.on('dragenter', options.ondragenter)\n    }\n    if (is.func(options.ondragleave)) {\n      interactable.on('dragleave', options.ondragleave)\n    }\n    if (is.func(options.ondropmove)) {\n      interactable.on('dropmove', options.ondropmove)\n    }\n\n    if (/^(pointer|center)$/.test(options.overlap as string)) {\n      interactable.options.drop.overlap = options.overlap\n    } else if (is.number(options.overlap)) {\n      interactable.options.drop.overlap = Math.max(Math.min(1, options.overlap), 0)\n    }\n    if ('accept' in options) {\n      interactable.options.drop.accept = options.accept\n    }\n    if ('checker' in options) {\n      interactable.options.drop.checker = options.checker\n    }\n\n    return interactable\n  }\n\n  if (is.bool(options)) {\n    interactable.options.drop.enabled = options\n\n    return interactable\n  }\n\n  return interactable.options.drop\n}\n\nfunction dropCheckMethod(\n  interactable: Interactable,\n  dragEvent: InteractEvent,\n  event: PointerEventType,\n  draggable: Interactable,\n  draggableElement: Element,\n  dropElement: Element,\n  rect: any,\n) {\n  let dropped = false\n\n  // if the dropzone has no rect (eg. display: none)\n  // call the custom dropChecker or just return false\n  if (!(rect = rect || interactable.getRect(dropElement))) {\n    return interactable.options.drop.checker\n      ? interactable.options.drop.checker(\n          dragEvent,\n          event,\n          dropped,\n          interactable,\n          dropElement,\n          draggable,\n          draggableElement,\n        )\n      : false\n  }\n\n  const dropOverlap = interactable.options.drop.overlap\n\n  if (dropOverlap === 'pointer') {\n    const origin = getOriginXY(draggable, draggableElement, 'drag')\n    const page = pointerUtils.getPageXY(dragEvent)\n\n    page.x += origin.x\n    page.y += origin.y\n\n    const horizontal = page.x > rect.left && page.x < rect.right\n    const vertical = page.y > rect.top && page.y < rect.bottom\n\n    dropped = horizontal && vertical\n  }\n\n  const dragRect = draggable.getRect(draggableElement)\n\n  if (dragRect && dropOverlap === 'center') {\n    const cx = dragRect.left + dragRect.width / 2\n    const cy = dragRect.top + dragRect.height / 2\n\n    dropped = cx >= rect.left && cx <= rect.right && cy >= rect.top && cy <= rect.bottom\n  }\n\n  if (dragRect && is.number(dropOverlap)) {\n    const overlapArea =\n      Math.max(0, Math.min(rect.right, dragRect.right) - Math.max(rect.left, dragRect.left)) *\n      Math.max(0, Math.min(rect.bottom, dragRect.bottom) - Math.max(rect.top, dragRect.top))\n\n    const overlapRatio = overlapArea / (dragRect.width * dragRect.height)\n\n    dropped = overlapRatio >= dropOverlap\n  }\n\n  if (interactable.options.drop.checker) {\n    dropped = interactable.options.drop.checker(\n      dragEvent,\n      event,\n      dropped,\n      interactable,\n      dropElement,\n      draggable,\n      draggableElement,\n    )\n  }\n\n  return dropped\n}\n\nconst drop: Plugin = {\n  id: 'actions/drop',\n  install,\n  listeners: {\n    'interactions:before-action-start': ({ interaction }) => {\n      if (interaction.prepared.name !== 'drag') {\n        return\n      }\n\n      interaction.dropState = {\n        cur: {\n          dropzone: null,\n          element: null,\n        },\n        prev: {\n          dropzone: null,\n          element: null,\n        },\n        rejected: null,\n        events: null,\n        activeDrops: [],\n      }\n    },\n\n    'interactions:after-action-start': (\n      { interaction, event, iEvent: dragEvent }: DoPhaseArg<'drag', EventPhase>,\n      scope,\n    ) => {\n      if (interaction.prepared.name !== 'drag') {\n        return\n      }\n\n      const dropState = interaction.dropState!\n\n      // reset active dropzones\n      dropState.activeDrops = []\n      dropState.events = {}\n      dropState.activeDrops = getActiveDrops(scope, interaction.element!)\n      dropState.events = getDropEvents(interaction, event, dragEvent)\n\n      if (dropState.events.activate) {\n        fireActivationEvents(dropState.activeDrops, dropState.events.activate)\n        scope.fire('actions/drop:start', { interaction, dragEvent })\n      }\n    },\n\n    'interactions:action-move': onEventCreated,\n\n    'interactions:after-action-move': (\n      { interaction, iEvent: dragEvent }: DoPhaseArg<'drag', EventPhase>,\n      scope,\n    ) => {\n      if (interaction.prepared.name !== 'drag') {\n        return\n      }\n\n      const dropState = interaction.dropState!\n      fireDropEvents(interaction, dropState.events)\n\n      scope.fire('actions/drop:move', { interaction, dragEvent })\n      dropState.events = {}\n    },\n\n    'interactions:action-end': (arg: DoPhaseArg<'drag', EventPhase>, scope) => {\n      if (arg.interaction.prepared.name !== 'drag') {\n        return\n      }\n\n      const { interaction, iEvent: dragEvent } = arg\n\n      onEventCreated(arg, scope)\n      fireDropEvents(interaction, interaction.dropState!.events)\n      scope.fire('actions/drop:end', { interaction, dragEvent })\n    },\n\n    'interactions:stop': ({ interaction }) => {\n      if (interaction.prepared.name !== 'drag') {\n        return\n      }\n\n      const { dropState } = interaction\n\n      if (dropState) {\n        dropState.activeDrops = null as never\n        dropState.events = null as never\n        dropState.cur.dropzone = null as never\n        dropState.cur.element = null as never\n        dropState.prev.dropzone = null as never\n        dropState.prev.element = null as never\n        dropState.rejected = false\n      }\n    },\n  },\n  getActiveDrops,\n  getDrop,\n  getDropEvents,\n  fireDropEvents,\n\n  filterEventType: (type: string) => type.search('drag') === 0 || type.search('drop') === 0,\n\n  defaults: {\n    enabled: false,\n    accept: null as never,\n    overlap: 'pointer',\n  } as DropzoneOptions,\n}\n\nexport default drop\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { InteractEvent, EventPhase } from '@interactjs/core/InteractEvent'\nimport type { Interaction, DoPhaseArg } from '@interactjs/core/Interaction'\nimport type { PerActionDefaults } from '@interactjs/core/options'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { Rect, PointerType, ListenersArg, OrBoolean } from '@interactjs/core/types'\nimport is from '@interactjs/utils/is'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    gesture?: {\n      angle: number // angle from first to second touch\n      distance: number\n      scale: number // gesture.distance / gesture.startDistance\n      startAngle: number // angle of line joining two touches\n      startDistance: number // distance between two touches of touchStart\n    }\n  }\n}\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    gesturable(options: Partial<OrBoolean<GesturableOptions>> | boolean): this\n    gesturable(): GesturableOptions\n    /**\n     * ```js\n     * interact(element).gesturable({\n     *     onstart: function (event) {},\n     *     onmove : function (event) {},\n     *     onend  : function (event) {},\n     *\n     *     // limit multiple gestures.\n     *     // See the explanation in {@link Interactable.draggable} example\n     *     max: Infinity,\n     *     maxPerElement: 1,\n     * })\n     *\n     * var isGestureable = interact(element).gesturable()\n     * ```\n     *\n     * Gets or sets whether multitouch gestures can be performed on the target\n     *\n     * @param options - true/false or An object with event listeners to be fired on gesture events (makes the Interactable gesturable)\n     * @returns A boolean indicating if this can be the target of gesture events, or this Interactable\n     */\n    gesturable(options?: Partial<OrBoolean<GesturableOptions>> | boolean): this | GesturableOptions\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface ActionDefaults {\n    gesture: GesturableOptions\n  }\n}\n\ndeclare module '@interactjs/core/types' {\n  interface ActionMap {\n    gesture?: typeof gesture\n  }\n}\n\nexport interface GesturableOptions extends PerActionDefaults {\n  onstart?: ListenersArg\n  onmove?: ListenersArg\n  onend?: ListenersArg\n}\n\nexport interface GestureEvent extends InteractEvent<'gesture'> {\n  distance: number\n  angle: number\n  da: number // angle change\n  scale: number // ratio of distance start to current event\n  ds: number // scale change\n  box: Rect // enclosing box of all points\n  touches: PointerType[]\n}\n\nexport interface GestureSignalArg extends DoPhaseArg<'gesture', EventPhase> {\n  iEvent: GestureEvent\n  interaction: Interaction<'gesture'>\n}\n\nfunction install(scope: Scope) {\n  const { actions, Interactable, defaults } = scope\n\n  Interactable.prototype.gesturable = function (\n    this: InstanceType<typeof Interactable>,\n    options: GesturableOptions | boolean,\n  ) {\n    if (is.object(options)) {\n      this.options.gesture.enabled = options.enabled !== false\n      this.setPerAction('gesture', options)\n      this.setOnEvents('gesture', options)\n\n      return this\n    }\n\n    if (is.bool(options)) {\n      this.options.gesture.enabled = options\n\n      return this\n    }\n\n    return this.options.gesture as GesturableOptions\n  } as Interactable['gesturable']\n\n  actions.map.gesture = gesture\n  actions.methodDict.gesture = 'gesturable'\n\n  defaults.actions.gesture = gesture.defaults\n}\n\nfunction updateGestureProps({ interaction, iEvent, phase }: GestureSignalArg) {\n  if (interaction.prepared.name !== 'gesture') return\n\n  const pointers = interaction.pointers.map((p) => p.pointer)\n  const starting = phase === 'start'\n  const ending = phase === 'end'\n  const deltaSource = interaction.interactable.options.deltaSource\n\n  iEvent.touches = [pointers[0], pointers[1]]\n\n  if (starting) {\n    iEvent.distance = pointerUtils.touchDistance(pointers, deltaSource)\n    iEvent.box = pointerUtils.touchBBox(pointers)\n    iEvent.scale = 1\n    iEvent.ds = 0\n    iEvent.angle = pointerUtils.touchAngle(pointers, deltaSource)\n    iEvent.da = 0\n\n    interaction.gesture.startDistance = iEvent.distance\n    interaction.gesture.startAngle = iEvent.angle\n  } else if (ending || interaction.pointers.length < 2) {\n    const prevEvent = interaction.prevEvent as GestureEvent\n\n    iEvent.distance = prevEvent.distance\n    iEvent.box = prevEvent.box\n    iEvent.scale = prevEvent.scale\n    iEvent.ds = 0\n    iEvent.angle = prevEvent.angle\n    iEvent.da = 0\n  } else {\n    iEvent.distance = pointerUtils.touchDistance(pointers, deltaSource)\n    iEvent.box = pointerUtils.touchBBox(pointers)\n    iEvent.scale = iEvent.distance / interaction.gesture.startDistance\n    iEvent.angle = pointerUtils.touchAngle(pointers, deltaSource)\n\n    iEvent.ds = iEvent.scale - interaction.gesture.scale\n    iEvent.da = iEvent.angle - interaction.gesture.angle\n  }\n\n  interaction.gesture.distance = iEvent.distance\n  interaction.gesture.angle = iEvent.angle\n\n  if (is.number(iEvent.scale) && iEvent.scale !== Infinity && !isNaN(iEvent.scale)) {\n    interaction.gesture.scale = iEvent.scale\n  }\n}\n\nconst gesture: Plugin = {\n  id: 'actions/gesture',\n  before: ['actions/drag', 'actions/resize'],\n  install,\n  listeners: {\n    'interactions:action-start': updateGestureProps,\n    'interactions:action-move': updateGestureProps,\n    'interactions:action-end': updateGestureProps,\n\n    'interactions:new': ({ interaction }) => {\n      interaction.gesture = {\n        angle: 0,\n        distance: 0,\n        scale: 1,\n        startAngle: 0,\n        startDistance: 0,\n      }\n    },\n\n    'auto-start:check': (arg) => {\n      if (arg.interaction.pointers.length < 2) {\n        return undefined\n      }\n\n      const gestureOptions = arg.interactable.options.gesture\n\n      if (!(gestureOptions && gestureOptions.enabled)) {\n        return undefined\n      }\n\n      arg.action = { name: 'gesture' }\n\n      return false\n    },\n  },\n\n  defaults: {},\n\n  getCursor() {\n    return ''\n  },\n\n  filterEventType: (type: string) => type.search('gesture') === 0,\n}\n\nexport default gesture\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { EventPhase, InteractEvent } from '@interactjs/core/InteractEvent'\nimport type { Interaction } from '@interactjs/core/Interaction'\nimport type { PerActionDefaults } from '@interactjs/core/options'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type {\n  ActionName,\n  ActionProps,\n  EdgeOptions,\n  FullRect,\n  ListenersArg,\n  OrBoolean,\n  Point,\n  Rect,\n} from '@interactjs/core/types'\nimport * as dom from '@interactjs/utils/domUtils'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\n\nexport type EdgeName = 'top' | 'left' | 'bottom' | 'right'\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    resizable(): ResizableOptions\n    resizable(options: Partial<OrBoolean<ResizableOptions>> | boolean): this\n    /**\n     * ```js\n     * interact(element).resizable({\n     *   onstart: function (event) {},\n     *   onmove : function (event) {},\n     *   onend  : function (event) {},\n     *\n     *   edges: {\n     *     top   : true,       // Use pointer coords to check for resize.\n     *     left  : false,      // Disable resizing from left edge.\n     *     bottom: '.resize-s',// Resize if pointer target matches selector\n     *     right : handleEl    // Resize if pointer target is the given Element\n     *   },\n     *\n     *   // Width and height can be adjusted independently. When `true`, width and\n     *   // height are adjusted at a 1:1 ratio.\n     *   square: false,\n     *\n     *   // Width and height can be adjusted independently. When `true`, width and\n     *   // height maintain the aspect ratio they had when resizing started.\n     *   preserveAspectRatio: false,\n     *\n     *   // a value of 'none' will limit the resize rect to a minimum of 0x0\n     *   // 'negate' will allow the rect to have negative width/height\n     *   // 'reposition' will keep the width/height positive by swapping\n     *   // the top and bottom edges and/or swapping the left and right edges\n     *   invert: 'none' || 'negate' || 'reposition'\n     *\n     *   // limit multiple resizes.\n     *   // See the explanation in the {@link Interactable.draggable} example\n     *   max: Infinity,\n     *   maxPerElement: 1,\n     * })\n     *\n     * var isResizeable = interact(element).resizable()\n     * ```\n     *\n     * Gets or sets whether resize actions can be performed on the target\n     *\n     * @param options - true/false or An object with event\n     * listeners to be fired on resize events (object makes the Interactable\n     * resizable)\n     * @returns A boolean indicating if this can be the\n     * target of resize elements, or this Interactable\n     */\n    resizable(options?: Partial<OrBoolean<ResizableOptions>> | boolean): this | ResizableOptions\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction<T extends ActionName | null = ActionName> {\n    resizeAxes: 'x' | 'y' | 'xy'\n    styleCursor(newValue: boolean): this\n    styleCursor(): boolean\n    resizeStartAspectRatio: number\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface ActionDefaults {\n    resize: ResizableOptions\n  }\n}\n\ndeclare module '@interactjs/core/types' {\n  interface ActionMap {\n    resize?: typeof resize\n  }\n}\n\nexport interface ResizableOptions extends PerActionDefaults {\n  square?: boolean\n  preserveAspectRatio?: boolean\n  edges?: EdgeOptions | null\n  axis?: 'x' | 'y' | 'xy' // deprecated\n  invert?: 'none' | 'negate' | 'reposition'\n  margin?: number\n  squareResize?: boolean\n  oninertiastart?: ListenersArg\n  onstart?: ListenersArg\n  onmove?: ListenersArg\n  onend?: ListenersArg\n}\n\nexport interface ResizeEvent<P extends EventPhase = EventPhase> extends InteractEvent<'resize', P> {\n  deltaRect?: FullRect\n  edges?: ActionProps['edges']\n}\n\nfunction install(scope: Scope) {\n  const {\n    actions,\n    browser,\n    Interactable, // tslint:disable-line no-shadowed-variable\n    defaults,\n  } = scope\n\n  // Less Precision with touch input\n\n  resize.cursors = initCursors(browser)\n  resize.defaultMargin = browser.supportsTouch || browser.supportsPointerEvent ? 20 : 10\n\n  Interactable.prototype.resizable = function (this: Interactable, options: ResizableOptions | boolean) {\n    return resizable(this, options, scope)\n  } as Interactable['resizable']\n\n  actions.map.resize = resize\n  actions.methodDict.resize = 'resizable'\n\n  defaults.actions.resize = resize.defaults\n}\n\nfunction resizeChecker(arg) {\n  const { interaction, interactable, element, rect, buttons } = arg\n\n  if (!rect) {\n    return undefined\n  }\n\n  const page = extend({}, interaction.coords.cur.page)\n  const resizeOptions = interactable.options.resize\n\n  if (\n    !(resizeOptions && resizeOptions.enabled) ||\n    // check mouseButton setting if the pointer is down\n    (interaction.pointerIsDown &&\n      /mouse|pointer/.test(interaction.pointerType) &&\n      (buttons & resizeOptions.mouseButtons) === 0)\n  ) {\n    return undefined\n  }\n\n  // if using resize.edges\n  if (is.object(resizeOptions.edges)) {\n    const resizeEdges = {\n      left: false,\n      right: false,\n      top: false,\n      bottom: false,\n    }\n\n    for (const edge in resizeEdges) {\n      resizeEdges[edge] = checkResizeEdge(\n        edge,\n        resizeOptions.edges[edge],\n        page,\n        interaction._latestPointer.eventTarget,\n        element,\n        rect,\n        resizeOptions.margin || resize.defaultMargin,\n      )\n    }\n\n    resizeEdges.left = resizeEdges.left && !resizeEdges.right\n    resizeEdges.top = resizeEdges.top && !resizeEdges.bottom\n\n    if (resizeEdges.left || resizeEdges.right || resizeEdges.top || resizeEdges.bottom) {\n      arg.action = {\n        name: 'resize',\n        edges: resizeEdges,\n      }\n    }\n  } else {\n    const right = resizeOptions.axis !== 'y' && page.x > rect.right - resize.defaultMargin\n    const bottom = resizeOptions.axis !== 'x' && page.y > rect.bottom - resize.defaultMargin\n\n    if (right || bottom) {\n      arg.action = {\n        name: 'resize',\n        axes: (right ? 'x' : '') + (bottom ? 'y' : ''),\n      }\n    }\n  }\n\n  return arg.action ? false : undefined\n}\n\nfunction resizable(interactable: Interactable, options: OrBoolean<ResizableOptions> | boolean, scope: Scope) {\n  if (is.object(options)) {\n    interactable.options.resize.enabled = options.enabled !== false\n    interactable.setPerAction('resize', options)\n    interactable.setOnEvents('resize', options)\n\n    if (is.string(options.axis) && /^x$|^y$|^xy$/.test(options.axis)) {\n      interactable.options.resize.axis = options.axis\n    } else if (options.axis === null) {\n      interactable.options.resize.axis = scope.defaults.actions.resize.axis\n    }\n\n    if (is.bool(options.preserveAspectRatio)) {\n      interactable.options.resize.preserveAspectRatio = options.preserveAspectRatio\n    } else if (is.bool(options.square)) {\n      interactable.options.resize.square = options.square\n    }\n\n    return interactable\n  }\n  if (is.bool(options)) {\n    interactable.options.resize.enabled = options\n\n    return interactable\n  }\n  return interactable.options.resize\n}\n\nfunction checkResizeEdge(\n  name: string,\n  value: any,\n  page: Point,\n  element: Node,\n  interactableElement: Element,\n  rect: Rect,\n  margin: number,\n) {\n  // false, '', undefined, null\n  if (!value) {\n    return false\n  }\n\n  // true value, use pointer coords and element rect\n  if (value === true) {\n    // if dimensions are negative, \"switch\" edges\n    const width = is.number(rect.width) ? rect.width : rect.right - rect.left\n    const height = is.number(rect.height) ? rect.height : rect.bottom - rect.top\n\n    // don't use margin greater than half the relevent dimension\n    margin = Math.min(margin, Math.abs((name === 'left' || name === 'right' ? width : height) / 2))\n\n    if (width < 0) {\n      if (name === 'left') {\n        name = 'right'\n      } else if (name === 'right') {\n        name = 'left'\n      }\n    }\n    if (height < 0) {\n      if (name === 'top') {\n        name = 'bottom'\n      } else if (name === 'bottom') {\n        name = 'top'\n      }\n    }\n\n    if (name === 'left') {\n      const edge = width >= 0 ? rect.left : rect.right\n      return page.x < edge + margin\n    }\n    if (name === 'top') {\n      const edge = height >= 0 ? rect.top : rect.bottom\n      return page.y < edge + margin\n    }\n\n    if (name === 'right') {\n      return page.x > (width >= 0 ? rect.right : rect.left) - margin\n    }\n    if (name === 'bottom') {\n      return page.y > (height >= 0 ? rect.bottom : rect.top) - margin\n    }\n  }\n\n  // the remaining checks require an element\n  if (!is.element(element)) {\n    return false\n  }\n\n  return is.element(value)\n    ? // the value is an element to use as a resize handle\n      value === element\n    : // otherwise check if element matches value as selector\n      dom.matchesUpTo(element, value, interactableElement)\n}\n\n/* eslint-disable multiline-ternary */\n// eslint-disable-next-line @typescript-eslint/consistent-type-imports\nfunction initCursors(browser: typeof import('@interactjs/utils/browser').default) {\n  return browser.isIe9\n    ? {\n        x: 'e-resize',\n        y: 's-resize',\n        xy: 'se-resize',\n\n        top: 'n-resize',\n        left: 'w-resize',\n        bottom: 's-resize',\n        right: 'e-resize',\n        topleft: 'se-resize',\n        bottomright: 'se-resize',\n        topright: 'ne-resize',\n        bottomleft: 'ne-resize',\n      }\n    : {\n        x: 'ew-resize',\n        y: 'ns-resize',\n        xy: 'nwse-resize',\n\n        top: 'ns-resize',\n        left: 'ew-resize',\n        bottom: 'ns-resize',\n        right: 'ew-resize',\n        topleft: 'nwse-resize',\n        bottomright: 'nwse-resize',\n        topright: 'nesw-resize',\n        bottomleft: 'nesw-resize',\n      }\n}\n/* eslint-enable multiline-ternary */\n\nfunction start({ iEvent, interaction }: { iEvent: InteractEvent<any, any>; interaction: Interaction }) {\n  if (interaction.prepared.name !== 'resize' || !interaction.prepared.edges) {\n    return\n  }\n\n  const resizeEvent = iEvent as ResizeEvent\n  const rect = interaction.rect\n\n  interaction._rects = {\n    start: extend({}, rect),\n    corrected: extend({}, rect),\n    previous: extend({}, rect),\n    delta: {\n      left: 0,\n      right: 0,\n      width: 0,\n      top: 0,\n      bottom: 0,\n      height: 0,\n    },\n  }\n\n  resizeEvent.edges = interaction.prepared.edges\n  resizeEvent.rect = interaction._rects.corrected\n  resizeEvent.deltaRect = interaction._rects.delta\n}\n\nfunction move({ iEvent, interaction }: { iEvent: InteractEvent<any, any>; interaction: Interaction }) {\n  if (interaction.prepared.name !== 'resize' || !interaction.prepared.edges) return\n\n  const resizeEvent = iEvent as ResizeEvent\n  const resizeOptions = interaction.interactable.options.resize\n  const invert = resizeOptions.invert\n  const invertible = invert === 'reposition' || invert === 'negate'\n\n  const current = interaction.rect\n  const { start: startRect, corrected, delta: deltaRect, previous } = interaction._rects\n\n  extend(previous, corrected)\n\n  if (invertible) {\n    // if invertible, copy the current rect\n    extend(corrected, current)\n\n    if (invert === 'reposition') {\n      // swap edge values if necessary to keep width/height positive\n      if (corrected.top > corrected.bottom) {\n        const swap = corrected.top\n\n        corrected.top = corrected.bottom\n        corrected.bottom = swap\n      }\n      if (corrected.left > corrected.right) {\n        const swap = corrected.left\n\n        corrected.left = corrected.right\n        corrected.right = swap\n      }\n    }\n  } else {\n    // if not invertible, restrict to minimum of 0x0 rect\n    corrected.top = Math.min(current.top, startRect.bottom)\n    corrected.bottom = Math.max(current.bottom, startRect.top)\n    corrected.left = Math.min(current.left, startRect.right)\n    corrected.right = Math.max(current.right, startRect.left)\n  }\n\n  corrected.width = corrected.right - corrected.left\n  corrected.height = corrected.bottom - corrected.top\n\n  for (const edge in corrected) {\n    deltaRect[edge] = corrected[edge] - previous[edge]\n  }\n\n  resizeEvent.edges = interaction.prepared.edges\n  resizeEvent.rect = corrected\n  resizeEvent.deltaRect = deltaRect\n}\n\nfunction end({ iEvent, interaction }: { iEvent: InteractEvent<any, any>; interaction: Interaction }) {\n  if (interaction.prepared.name !== 'resize' || !interaction.prepared.edges) return\n\n  const resizeEvent = iEvent as ResizeEvent\n\n  resizeEvent.edges = interaction.prepared.edges\n  resizeEvent.rect = interaction._rects.corrected\n  resizeEvent.deltaRect = interaction._rects.delta\n}\n\nfunction updateEventAxes({\n  iEvent,\n  interaction,\n}: {\n  iEvent: InteractEvent<any, any>\n  interaction: Interaction\n}) {\n  if (interaction.prepared.name !== 'resize' || !interaction.resizeAxes) return\n\n  const options = interaction.interactable.options\n  const resizeEvent = iEvent as ResizeEvent\n\n  if (options.resize.square) {\n    if (interaction.resizeAxes === 'y') {\n      resizeEvent.delta.x = resizeEvent.delta.y\n    } else {\n      resizeEvent.delta.y = resizeEvent.delta.x\n    }\n    resizeEvent.axes = 'xy'\n  } else {\n    resizeEvent.axes = interaction.resizeAxes\n\n    if (interaction.resizeAxes === 'x') {\n      resizeEvent.delta.y = 0\n    } else if (interaction.resizeAxes === 'y') {\n      resizeEvent.delta.x = 0\n    }\n  }\n}\n\nconst resize: Plugin = {\n  id: 'actions/resize',\n  before: ['actions/drag'],\n  install,\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.resizeAxes = 'xy'\n    },\n\n    'interactions:action-start': (arg) => {\n      start(arg)\n      updateEventAxes(arg)\n    },\n    'interactions:action-move': (arg) => {\n      move(arg)\n      updateEventAxes(arg)\n    },\n    'interactions:action-end': end,\n    'auto-start:check': resizeChecker,\n  },\n\n  defaults: {\n    square: false,\n    preserveAspectRatio: false,\n    axis: 'xy',\n\n    // use default margin\n    margin: NaN,\n\n    // object with props left, right, top, bottom which are\n    // true/false values to resize when the pointer is over that edge,\n    // CSS selectors to match the handles for each direction\n    // or the Elements for each handle\n    edges: null,\n\n    // a value of 'none' will limit the resize rect to a minimum of 0x0\n    // 'negate' will alow the rect to have negative width/height\n    // 'reposition' will keep the width/height positive by swapping\n    // the top and bottom edges and/or swapping the left and right edges\n    invert: 'none',\n  } as ResizableOptions,\n\n  cursors: null as ReturnType<typeof initCursors>,\n\n  getCursor({ edges, axis, name }: ActionProps) {\n    const cursors = resize.cursors\n    let result: string = null\n\n    if (axis) {\n      result = cursors[name + axis]\n    } else if (edges) {\n      let cursorKey = ''\n\n      for (const edge of ['top', 'bottom', 'left', 'right']) {\n        if (edges[edge]) {\n          cursorKey += edge\n        }\n      }\n\n      result = cursors[cursorKey]\n    }\n\n    return result\n  },\n\n  filterEventType: (type: string) => type.search('resize') === 0,\n\n  defaultMargin: null as number,\n}\n\nexport default resize\n", "let lastTime = 0\nlet request: typeof requestAnimationFrame\nlet cancel: typeof cancelAnimationFrame\n\nfunction init(global: Window | typeof globalThis) {\n  request = global.requestAnimationFrame\n  cancel = global.cancelAnimationFrame\n\n  if (!request) {\n    const vendors = ['ms', 'moz', 'webkit', 'o']\n\n    for (const vendor of vendors) {\n      request = global[`${vendor}RequestAnimationFrame` as 'requestAnimationFrame']\n      cancel =\n        global[`${vendor}CancelAnimationFrame` as 'cancelAnimationFrame'] ||\n        global[`${vendor}CancelRequestAnimationFrame` as 'cancelAnimationFrame']\n    }\n  }\n\n  request = request && request.bind(global)\n  cancel = cancel && cancel.bind(global)\n\n  if (!request) {\n    request = (callback) => {\n      const currTime = Date.now()\n      const timeToCall = Math.max(0, 16 - (currTime - lastTime))\n      const token = global.setTimeout(() => {\n        // eslint-disable-next-line n/no-callback-literal\n        callback(currTime + timeToCall)\n      }, timeToCall)\n\n      lastTime = currTime + timeToCall\n      return token as any\n    }\n\n    cancel = (token) => clearTimeout(token)\n  }\n}\n\nexport default {\n  request: (callback: FrameRequestCallback) => request(callback),\n  cancel: (token: number) => cancel(token),\n  init,\n}\n", "import type { Scope } from '@interactjs/core/scope'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './drag/plugin'\nimport './drop/plugin'\nimport './gesture/plugin'\nimport './resize/plugin'\n\nimport drag from './drag/plugin'\nimport drop from './drop/plugin'\nimport gesture from './gesture/plugin'\nimport resize from './resize/plugin'\n/* eslint-enable import/no-duplicates */\n\nexport default {\n  id: 'actions',\n  install(scope: Scope) {\n    scope.usePlugin(gesture)\n    scope.usePlugin(resize)\n    scope.usePlugin(drag)\n    scope.usePlugin(drop)\n  },\n}\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type Interaction from '@interactjs/core/Interaction'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { ActionName, PointerType } from '@interactjs/core/types'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport is from '@interactjs/utils/is'\nimport raf from '@interactjs/utils/raf'\nimport { getStringOptionResult } from '@interactjs/utils/rect'\nimport { getWindow } from '@interactjs/utils/window'\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    autoScroll: typeof autoScroll\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    autoScroll?: typeof autoScroll\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface PerActionDefaults {\n    autoScroll?: AutoScrollOptions\n  }\n}\n\nexport interface AutoScrollOptions {\n  container?: Window | HTMLElement | string\n  margin?: number\n  distance?: number\n  interval?: number\n  speed?: number\n  enabled?: boolean\n}\n\nfunction install(scope: Scope) {\n  const { defaults, actions } = scope\n\n  scope.autoScroll = autoScroll\n  autoScroll.now = () => scope.now()\n\n  actions.phaselessTypes.autoscroll = true\n  defaults.perAction.autoScroll = autoScroll.defaults\n}\n\nconst autoScroll = {\n  defaults: {\n    enabled: false,\n    margin: 60,\n\n    // the item that is scrolled (Window or HTMLElement)\n    container: null as AutoScrollOptions['container'],\n\n    // the scroll speed in pixels per second\n    speed: 300,\n  } as AutoScrollOptions,\n\n  now: Date.now,\n\n  interaction: null as Interaction<ActionName> | null,\n  i: 0, // the handle returned by window.setInterval\n\n  // Direction each pulse is to scroll in\n  x: 0,\n  y: 0,\n\n  isScrolling: false,\n  prevTime: 0,\n  margin: 0,\n  speed: 0,\n\n  start(interaction: Interaction) {\n    autoScroll.isScrolling = true\n    raf.cancel(autoScroll.i)\n\n    interaction.autoScroll = autoScroll\n    autoScroll.interaction = interaction\n    autoScroll.prevTime = autoScroll.now()\n    autoScroll.i = raf.request(autoScroll.scroll)\n  },\n\n  stop() {\n    autoScroll.isScrolling = false\n    if (autoScroll.interaction) {\n      autoScroll.interaction.autoScroll = null\n    }\n    raf.cancel(autoScroll.i)\n  },\n\n  // scroll the window by the values in scroll.x/y\n  scroll() {\n    const { interaction } = autoScroll\n    const { interactable, element } = interaction\n    const actionName = interaction.prepared.name\n    const options = interactable.options[actionName].autoScroll\n    const container = getContainer(options.container, interactable, element)\n    const now = autoScroll.now()\n    // change in time in seconds\n    const dt = (now - autoScroll.prevTime) / 1000\n    // displacement\n    const s = options.speed * dt\n\n    if (s >= 1) {\n      const scrollBy = {\n        x: autoScroll.x * s,\n        y: autoScroll.y * s,\n      }\n\n      if (scrollBy.x || scrollBy.y) {\n        const prevScroll = getScroll(container)\n\n        if (is.window(container)) {\n          container.scrollBy(scrollBy.x, scrollBy.y)\n        } else if (container) {\n          container.scrollLeft += scrollBy.x\n          container.scrollTop += scrollBy.y\n        }\n\n        const curScroll = getScroll(container)\n        const delta = {\n          x: curScroll.x - prevScroll.x,\n          y: curScroll.y - prevScroll.y,\n        }\n\n        if (delta.x || delta.y) {\n          interactable.fire({\n            type: 'autoscroll',\n            target: element,\n            interactable,\n            delta,\n            interaction,\n            container,\n          })\n        }\n      }\n\n      autoScroll.prevTime = now\n    }\n\n    if (autoScroll.isScrolling) {\n      raf.cancel(autoScroll.i)\n      autoScroll.i = raf.request(autoScroll.scroll)\n    }\n  },\n  check(interactable: Interactable, actionName: ActionName) {\n    const options = interactable.options\n\n    return options[actionName].autoScroll?.enabled\n  },\n  onInteractionMove<T extends ActionName>({\n    interaction,\n    pointer,\n  }: {\n    interaction: Interaction<T>\n    pointer: PointerType\n  }) {\n    if (\n      !(interaction.interacting() && autoScroll.check(interaction.interactable, interaction.prepared.name))\n    ) {\n      return\n    }\n\n    if (interaction.simulation) {\n      autoScroll.x = autoScroll.y = 0\n      return\n    }\n\n    let top: boolean\n    let right: boolean\n    let bottom: boolean\n    let left: boolean\n\n    const { interactable, element } = interaction\n    const actionName = interaction.prepared.name\n    const options = interactable.options[actionName].autoScroll\n    const container = getContainer(options.container, interactable, element)\n\n    if (is.window(container)) {\n      left = pointer.clientX < autoScroll.margin\n      top = pointer.clientY < autoScroll.margin\n      right = pointer.clientX > container.innerWidth - autoScroll.margin\n      bottom = pointer.clientY > container.innerHeight - autoScroll.margin\n    } else {\n      const rect = domUtils.getElementClientRect(container)\n\n      left = pointer.clientX < rect.left + autoScroll.margin\n      top = pointer.clientY < rect.top + autoScroll.margin\n      right = pointer.clientX > rect.right - autoScroll.margin\n      bottom = pointer.clientY > rect.bottom - autoScroll.margin\n    }\n\n    autoScroll.x = right ? 1 : left ? -1 : 0\n    autoScroll.y = bottom ? 1 : top ? -1 : 0\n\n    if (!autoScroll.isScrolling) {\n      // set the autoScroll properties to those of the target\n      autoScroll.margin = options.margin\n      autoScroll.speed = options.speed\n\n      autoScroll.start(interaction)\n    }\n  },\n}\n\nexport function getContainer(value: any, interactable: Interactable, element: Element) {\n  return (\n    (is.string(value) ? getStringOptionResult(value, interactable, element) : value) || getWindow(element)\n  )\n}\n\nexport function getScroll(container: any) {\n  if (is.window(container)) {\n    container = window.document.body\n  }\n\n  return { x: container.scrollLeft, y: container.scrollTop }\n}\n\nexport function getScrollSize(container: any) {\n  if (is.window(container)) {\n    container = window.document.body\n  }\n\n  return { x: container.scrollWidth, y: container.scrollHeight }\n}\n\nexport function getScrollSizeDelta<T extends ActionName>(\n  {\n    interaction,\n    element,\n  }: {\n    interaction: Partial<Interaction<T>>\n    element: Element\n  },\n  func: any,\n) {\n  const scrollOptions = interaction && interaction.interactable.options[interaction.prepared.name].autoScroll\n\n  if (!scrollOptions || !scrollOptions.enabled) {\n    func()\n    return { x: 0, y: 0 }\n  }\n\n  const scrollContainer = getContainer(scrollOptions.container, interaction.interactable, element)\n\n  const prevSize = getScroll(scrollContainer)\n  func()\n  const curSize = getScroll(scrollContainer)\n\n  return {\n    x: curSize.x - prevSize.x,\n    y: curSize.y - prevSize.y,\n  }\n}\n\nconst autoScrollPlugin: Plugin = {\n  id: 'auto-scroll',\n  install,\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.autoScroll = null\n    },\n\n    'interactions:destroy': ({ interaction }) => {\n      interaction.autoScroll = null\n      autoScroll.stop()\n      if (autoScroll.interaction) {\n        autoScroll.interaction = null\n      }\n    },\n\n    'interactions:stop': autoScroll.stop,\n\n    'interactions:action-move': (arg: any) => autoScroll.onInteractionMove(arg),\n  },\n}\n\nexport default autoScrollPlugin\n", "import type { ActionName, ActionProps } from '@interactjs/core/types'\n\nimport { window } from './window'\n\nexport function warnOnce<T>(this: T, method: (...args: any[]) => any, message: string) {\n  let warned = false\n\n  return function (this: T) {\n    if (!warned) {\n      ;(window as any).console.warn(message)\n      warned = true\n    }\n\n    return method.apply(this, arguments)\n  }\n}\n\nexport function copyAction<T extends ActionName>(dest: ActionProps<any>, src: ActionProps<T>) {\n  dest.name = src.name\n  dest.axis = src.axis\n  dest.edges = src.edges\n\n  return dest\n}\n\nexport const sign = (n: number) => (n >= 0 ? 1 : -1)\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { Interaction } from '@interactjs/core/Interaction'\nimport type { Scope } from '@interactjs/core/scope'\nimport type { ActionProps, PointerType, PointerEventType, Element } from '@interactjs/core/types'\nimport is from '@interactjs/utils/is'\nimport { warnOnce } from '@interactjs/utils/misc'\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    getAction: (\n      this: Interactable,\n      pointer: PointerType,\n      event: PointerEventType,\n      interaction: Interaction,\n      element: Element,\n    ) => ActionProps | null\n    styleCursor(newValue: boolean): this\n    styleCursor(): boolean\n    /**\n     * Returns or sets whether the the cursor should be changed depending on the\n     * action that would be performed if the mouse were pressed and dragged.\n     *\n     * @param {boolean} [newValue]\n     * @return {boolean | Interactable} The current setting or this Interactable\n     */\n    styleCursor(newValue?: boolean): boolean | this\n    actionChecker(checker: Function): Interactable\n    actionChecker(): Function\n    /**\n     * ```js\n     * interact('.resize-drag')\n     *   .resizable(true)\n     *   .draggable(true)\n     *   .actionChecker(function (pointer, event, action, interactable, element, interaction) {\n     *\n     *     if (interact.matchesSelector(event.target, '.drag-handle')) {\n     *       // force drag with handle target\n     *       action.name = drag\n     *     }\n     *     else {\n     *       // resize from the top and right edges\n     *       action.name  = 'resize'\n     *       action.edges = { top: true, right: true }\n     *     }\n     *\n     *     return action\n     * })\n     * ```\n     *\n     * Returns or sets the function used to check action to be performed on\n     * pointerDown\n     *\n     * @param checker - A function which takes a pointer event,\n     * defaultAction string, interactable, element and interaction as parameters\n     * and returns an object with name property 'drag' 'resize' or 'gesture' and\n     * optionally an `edges` object with boolean 'top', 'left', 'bottom' and right\n     * props.\n     * @returns The checker function or this Interactable\n     */\n    actionChecker(checker?: Function): Interactable | Function\n    /** @returns This interactable */\n    ignoreFrom(newValue: string | Element | null): Interactable\n    /** @returns The current ignoreFrom value */\n    ignoreFrom(): string | Element | null\n    /**\n     * If the target of the `mousedown`, `pointerdown` or `touchstart` event or any\n     * of it's parents match the given CSS selector or Element, no\n     * drag/resize/gesture is started.\n     *\n     * @deprecated\n     * Don't use this method. Instead set the `ignoreFrom` option for each action\n     * or for `pointerEvents`\n     *\n     * ```js\n     * interact(targett)\n     *   .draggable({\n     *     ignoreFrom: 'input, textarea, a[href]'',\n     *   })\n     *   .pointerEvents({\n     *     ignoreFrom: '[no-pointer]',\n     *   })\n     * ```\n     * Interactable\n     */\n    ignoreFrom(\n      /** a CSS selector string, an Element or `null` to not ignore any elements */\n      newValue?: string | Element | null,\n    ): Interactable | string | Element | null\n    allowFrom(): boolean\n    /**\n     *\n     * A drag/resize/gesture is started only If the target of the `mousedown`,\n     * `pointerdown` or `touchstart` event or any of it's parents match the given\n     * CSS selector or Element.\n     *\n     * @deprecated\n     * Don't use this method. Instead set the `allowFrom` option for each action\n     * or for `pointerEvents`\n     *\n     * ```js\n     * interact(targett)\n     *   .resizable({\n     *     allowFrom: '.resize-handle',\n     *   .pointerEvents({\n     *     allowFrom: '.handle',,\n     *   })\n     * ```\n     *\n     * @param {string | Element | null} [newValue]\n     * @return {string | Element | object} The current allowFrom value or this\n     * Interactable\n     */\n    allowFrom(\n      /** A CSS selector string, an Element or `null` to allow from any element */\n      newValue: string | Element | null,\n    ): Interactable\n  }\n}\n\nfunction install(scope: Scope) {\n  const {\n    Interactable, // tslint:disable-line no-shadowed-variable\n  } = scope\n\n  Interactable.prototype.getAction = function getAction(\n    this: Interactable,\n    pointer: PointerType,\n    event: PointerEventType,\n    interaction: Interaction,\n    element: Element,\n  ): ActionProps {\n    const action = defaultActionChecker(this, event, interaction, element, scope)\n\n    if (this.options.actionChecker) {\n      return this.options.actionChecker(pointer, event, action, this, element, interaction)\n    }\n\n    return action\n  }\n\n  Interactable.prototype.ignoreFrom = warnOnce(function (this: Interactable, newValue) {\n    return this._backCompatOption('ignoreFrom', newValue)\n  }, 'Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue}).')\n\n  Interactable.prototype.allowFrom = warnOnce(function (this: Interactable, newValue) {\n    return this._backCompatOption('allowFrom', newValue)\n  }, 'Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue}).')\n\n  Interactable.prototype.actionChecker = actionChecker\n\n  Interactable.prototype.styleCursor = styleCursor\n}\n\nfunction defaultActionChecker(\n  interactable: Interactable,\n  event: PointerEventType,\n  interaction: Interaction,\n  element: Element,\n  scope: Scope,\n) {\n  const rect = interactable.getRect(element)\n  const buttons =\n    (event as MouseEvent).buttons ||\n    {\n      0: 1,\n      1: 4,\n      3: 8,\n      4: 16,\n    }[(event as MouseEvent).button as 0 | 1 | 3 | 4]\n  const arg = {\n    action: null,\n    interactable,\n    interaction,\n    element,\n    rect,\n    buttons,\n  }\n\n  scope.fire('auto-start:check', arg)\n\n  return arg.action\n}\n\nfunction styleCursor(this: Interactable, newValue?: boolean) {\n  if (is.bool(newValue)) {\n    this.options.styleCursor = newValue\n\n    return this\n  }\n\n  if (newValue === null) {\n    delete this.options.styleCursor\n\n    return this\n  }\n\n  return this.options.styleCursor\n}\n\nfunction actionChecker(this: Interactable, checker?: any) {\n  if (is.func(checker)) {\n    this.options.actionChecker = checker\n\n    return this\n  }\n\n  if (checker === null) {\n    delete this.options.actionChecker\n\n    return this\n  }\n\n  return this.options.actionChecker\n}\n\nexport default {\n  id: 'auto-start/interactableMethods',\n  install,\n}\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { Interaction } from '@interactjs/core/Interaction'\nimport type { Scope, SignalArgs, Plugin } from '@interactjs/core/scope'\nimport type {\n  CursorChecker,\n  PointerType,\n  PointerEventType,\n  Element,\n  ActionName,\n  ActionProps,\n} from '@interactjs/core/types'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport { copyAction } from '@interactjs/utils/misc'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './InteractableMethods'\nimport InteractableMethods from './InteractableMethods'\n/* eslint-enable import/no-duplicates */\n\ndeclare module '@interactjs/core/InteractStatic' {\n  export interface InteractStatic {\n    /**\n     * Returns or sets the maximum number of concurrent interactions allowed.  By\n     * default only 1 interaction is allowed at a time (for backwards\n     * compatibility). To allow multiple interactions on the same Interactables and\n     * elements, you need to enable it in the draggable, resizable and gesturable\n     * `'max'` and `'maxPerElement'` options.\n     *\n     * @param {number} [newValue] Any number. newValue <= 0 means no interactions.\n     */\n    maxInteractions: (newValue: any) => any\n  }\n}\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    autoStart: AutoStart\n  }\n\n  interface SignalArgs {\n    'autoStart:before-start': Omit<SignalArgs['interactions:move'], 'interaction'> & {\n      interaction: Interaction<ActionName>\n    }\n    'autoStart:prepared': { interaction: Interaction }\n    'auto-start:check': CheckSignalArg\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface BaseDefaults {\n    actionChecker?: any\n    cursorChecker?: any\n    styleCursor?: any\n  }\n\n  interface PerActionDefaults {\n    manualStart?: boolean\n    max?: number\n    maxPerElement?: number\n    allowFrom?: string | Element\n    ignoreFrom?: string | Element\n    cursorChecker?: CursorChecker\n\n    // only allow left button by default\n    // see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons#Return_value\n    // TODO: docst\n    mouseButtons?: 0 | 1 | 2 | 4 | 8 | 16\n  }\n}\n\ninterface CheckSignalArg {\n  interactable: Interactable\n  interaction: Interaction\n  element: Element\n  action: ActionProps<ActionName>\n  buttons: number\n}\n\nexport interface AutoStart {\n  // Allow this many interactions to happen simultaneously\n  maxInteractions: number\n  withinInteractionLimit: typeof withinInteractionLimit\n  cursorElement: Element\n}\n\nfunction install(scope: Scope) {\n  const { interactStatic: interact, defaults } = scope\n\n  scope.usePlugin(InteractableMethods)\n\n  defaults.base.actionChecker = null\n  defaults.base.styleCursor = true\n\n  extend(defaults.perAction, {\n    manualStart: false,\n    max: Infinity,\n    maxPerElement: 1,\n    allowFrom: null,\n    ignoreFrom: null,\n\n    // only allow left button by default\n    // see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons#Return_value\n    mouseButtons: 1,\n  })\n\n  interact.maxInteractions = (newValue: number) => maxInteractions(newValue, scope)\n\n  scope.autoStart = {\n    // Allow this many interactions to happen simultaneously\n    maxInteractions: Infinity,\n    withinInteractionLimit,\n    cursorElement: null,\n  }\n}\n\nfunction prepareOnDown(\n  { interaction, pointer, event, eventTarget }: SignalArgs['interactions:down'],\n  scope: Scope,\n) {\n  if (interaction.interacting()) return\n\n  const actionInfo = getActionInfo(interaction, pointer, event, eventTarget, scope)\n  prepare(interaction, actionInfo, scope)\n}\n\nfunction prepareOnMove(\n  { interaction, pointer, event, eventTarget }: SignalArgs['interactions:move'],\n  scope: Scope,\n) {\n  if (interaction.pointerType !== 'mouse' || interaction.pointerIsDown || interaction.interacting()) return\n\n  const actionInfo = getActionInfo(interaction, pointer, event, eventTarget as Element, scope)\n  prepare(interaction, actionInfo, scope)\n}\n\nfunction startOnMove(arg: SignalArgs['interactions:move'], scope: Scope) {\n  const { interaction } = arg\n\n  if (\n    !interaction.pointerIsDown ||\n    interaction.interacting() ||\n    !interaction.pointerWasMoved ||\n    !interaction.prepared.name\n  ) {\n    return\n  }\n\n  scope.fire('autoStart:before-start', arg)\n\n  const { interactable } = interaction\n  const actionName = (interaction as Interaction<ActionName>).prepared.name\n\n  if (actionName && interactable) {\n    // check manualStart and interaction limit\n    if (\n      interactable.options[actionName].manualStart ||\n      !withinInteractionLimit(interactable, interaction.element, interaction.prepared, scope)\n    ) {\n      interaction.stop()\n    } else {\n      interaction.start(interaction.prepared, interactable, interaction.element)\n      setInteractionCursor(interaction, scope)\n    }\n  }\n}\n\nfunction clearCursorOnStop({ interaction }: { interaction: Interaction }, scope: Scope) {\n  const { interactable } = interaction\n\n  if (interactable && interactable.options.styleCursor) {\n    setCursor(interaction.element, '', scope)\n  }\n}\n\n// Check if the current interactable supports the action.\n// If so, return the validated action. Otherwise, return null\nfunction validateAction<T extends ActionName>(\n  action: ActionProps<T>,\n  interactable: Interactable,\n  element: Element,\n  eventTarget: Node,\n  scope: Scope,\n) {\n  if (\n    interactable.testIgnoreAllow(interactable.options[action.name], element, eventTarget) &&\n    interactable.options[action.name].enabled &&\n    withinInteractionLimit(interactable, element, action, scope)\n  ) {\n    return action\n  }\n\n  return null\n}\n\nfunction validateMatches(\n  interaction: Interaction,\n  pointer: PointerType,\n  event: PointerEventType,\n  matches: Interactable[],\n  matchElements: Element[],\n  eventTarget: Node,\n  scope: Scope,\n) {\n  for (let i = 0, len = matches.length; i < len; i++) {\n    const match = matches[i]\n    const matchElement = matchElements[i]\n    const matchAction = match.getAction(pointer, event, interaction, matchElement)\n\n    if (!matchAction) {\n      continue\n    }\n\n    const action = validateAction<ActionName>(matchAction, match, matchElement, eventTarget, scope)\n\n    if (action) {\n      return {\n        action,\n        interactable: match,\n        element: matchElement,\n      }\n    }\n  }\n\n  return { action: null, interactable: null, element: null }\n}\n\nfunction getActionInfo(\n  interaction: Interaction,\n  pointer: PointerType,\n  event: PointerEventType,\n  eventTarget: Node,\n  scope: Scope,\n) {\n  let matches: Interactable[] = []\n  let matchElements: Element[] = []\n\n  let element = eventTarget as Element\n\n  function pushMatches(interactable: Interactable) {\n    matches.push(interactable)\n    matchElements.push(element)\n  }\n\n  while (is.element(element)) {\n    matches = []\n    matchElements = []\n\n    scope.interactables.forEachMatch(element, pushMatches)\n\n    const actionInfo = validateMatches(\n      interaction,\n      pointer,\n      event,\n      matches,\n      matchElements,\n      eventTarget,\n      scope,\n    )\n\n    if (actionInfo.action && !actionInfo.interactable.options[actionInfo.action.name].manualStart) {\n      return actionInfo\n    }\n\n    element = domUtils.parentNode(element) as Element\n  }\n\n  return { action: null, interactable: null, element: null }\n}\n\nfunction prepare(\n  interaction: Interaction,\n  {\n    action,\n    interactable,\n    element,\n  }: {\n    action: ActionProps<any>\n    interactable: Interactable\n    element: Element\n  },\n  scope: Scope,\n) {\n  action = action || { name: null }\n\n  interaction.interactable = interactable\n  interaction.element = element\n  copyAction(interaction.prepared, action)\n\n  interaction.rect = interactable && action.name ? interactable.getRect(element) : null\n\n  setInteractionCursor(interaction, scope)\n\n  scope.fire('autoStart:prepared', { interaction })\n}\n\nfunction withinInteractionLimit<T extends ActionName>(\n  interactable: Interactable,\n  element: Element,\n  action: ActionProps<T>,\n  scope: Scope,\n) {\n  const options = interactable.options\n  const maxActions = options[action.name].max\n  const maxPerElement = options[action.name].maxPerElement\n  const autoStartMax = scope.autoStart.maxInteractions\n  let activeInteractions = 0\n  let interactableCount = 0\n  let elementCount = 0\n\n  // no actions if any of these values == 0\n  if (!(maxActions && maxPerElement && autoStartMax)) {\n    return false\n  }\n\n  for (const interaction of scope.interactions.list) {\n    const otherAction = interaction.prepared.name\n\n    if (!interaction.interacting()) {\n      continue\n    }\n\n    activeInteractions++\n\n    if (activeInteractions >= autoStartMax) {\n      return false\n    }\n\n    if (interaction.interactable !== interactable) {\n      continue\n    }\n\n    interactableCount += otherAction === action.name ? 1 : 0\n\n    if (interactableCount >= maxActions) {\n      return false\n    }\n\n    if (interaction.element === element) {\n      elementCount++\n\n      if (otherAction === action.name && elementCount >= maxPerElement) {\n        return false\n      }\n    }\n  }\n\n  return autoStartMax > 0\n}\n\nfunction maxInteractions(newValue: any, scope: Scope) {\n  if (is.number(newValue)) {\n    scope.autoStart.maxInteractions = newValue\n\n    return this\n  }\n\n  return scope.autoStart.maxInteractions\n}\n\nfunction setCursor(element: Element, cursor: string, scope: Scope) {\n  const { cursorElement: prevCursorElement } = scope.autoStart\n\n  if (prevCursorElement && prevCursorElement !== element) {\n    prevCursorElement.style.cursor = ''\n  }\n\n  element.ownerDocument.documentElement.style.cursor = cursor\n  element.style.cursor = cursor\n  scope.autoStart.cursorElement = cursor ? element : null\n}\n\nfunction setInteractionCursor<T extends ActionName>(interaction: Interaction<T>, scope: Scope) {\n  const { interactable, element, prepared } = interaction\n\n  if (!(interaction.pointerType === 'mouse' && interactable && interactable.options.styleCursor)) {\n    // clear previous target element cursor\n    if (scope.autoStart.cursorElement) {\n      setCursor(scope.autoStart.cursorElement, '', scope)\n    }\n\n    return\n  }\n\n  let cursor = ''\n\n  if (prepared.name) {\n    const cursorChecker = interactable.options[prepared.name].cursorChecker\n\n    if (is.func(cursorChecker)) {\n      cursor = cursorChecker(prepared, interactable, element, interaction._interacting)\n    } else {\n      cursor = scope.actions.map[prepared.name].getCursor(prepared)\n    }\n  }\n\n  setCursor(interaction.element, cursor || '', scope)\n}\n\nconst autoStart: Plugin = {\n  id: 'auto-start/base',\n  before: ['actions'],\n  install,\n  listeners: {\n    'interactions:down': prepareOnDown,\n    'interactions:move': (arg, scope) => {\n      prepareOnMove(arg, scope)\n      startOnMove(arg, scope)\n    },\n    'interactions:stop': clearCursorOnStop,\n  },\n  maxInteractions,\n  withinInteractionLimit,\n  validateAction,\n}\n\nexport default autoStart\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type Interaction from '@interactjs/core/Interaction'\nimport type { SignalArgs, Scope } from '@interactjs/core/scope'\nimport type { ActionName, Element } from '@interactjs/core/types'\nimport { parentNode } from '@interactjs/utils/domUtils'\nimport is from '@interactjs/utils/is'\n\nimport autoStart from './base'\n\nfunction beforeStart({ interaction, eventTarget, dx, dy }: SignalArgs['interactions:move'], scope: Scope) {\n  if (interaction.prepared.name !== 'drag') return\n\n  // check if a drag is in the correct axis\n  const absX = Math.abs(dx)\n  const absY = Math.abs(dy)\n  const targetOptions = interaction.interactable.options.drag\n  const startAxis = targetOptions.startAxis\n  const currentAxis = absX > absY ? 'x' : absX < absY ? 'y' : 'xy'\n\n  interaction.prepared.axis =\n    targetOptions.lockAxis === 'start'\n      ? (currentAxis[0] as 'x' | 'y') // always lock to one axis even if currentAxis === 'xy'\n      : targetOptions.lockAxis\n\n  // if the movement isn't in the startAxis of the interactable\n  if (currentAxis !== 'xy' && startAxis !== 'xy' && startAxis !== currentAxis) {\n    // cancel the prepared action\n    ;(interaction as Interaction<ActionName>).prepared.name = null\n\n    // then try to get a drag from another ineractable\n    let element = eventTarget as Element\n\n    const getDraggable = function (interactable: Interactable): Interactable | void {\n      if (interactable === interaction.interactable) return\n\n      const options = interaction.interactable.options.drag\n\n      if (!options.manualStart && interactable.testIgnoreAllow(options, element, eventTarget)) {\n        const action = interactable.getAction(\n          interaction.downPointer,\n          interaction.downEvent,\n          interaction,\n          element,\n        )\n\n        if (\n          action &&\n          action.name === 'drag' &&\n          checkStartAxis(currentAxis, interactable) &&\n          autoStart.validateAction(action, interactable, element, eventTarget, scope)\n        ) {\n          return interactable\n        }\n      }\n    }\n\n    // check all interactables\n    while (is.element(element)) {\n      const interactable = scope.interactables.forEachMatch(element, getDraggable)\n\n      if (interactable) {\n        ;(interaction as Interaction<ActionName>).prepared.name = 'drag'\n        interaction.interactable = interactable\n        interaction.element = element\n        break\n      }\n\n      element = parentNode(element) as Element\n    }\n  }\n}\n\nfunction checkStartAxis(startAxis: string, interactable: Interactable) {\n  if (!interactable) {\n    return false\n  }\n\n  const thisAxis = interactable.options.drag.startAxis\n\n  return startAxis === 'xy' || thisAxis === 'xy' || thisAxis === startAxis\n}\n\nexport default {\n  id: 'auto-start/dragAxis',\n  listeners: { 'autoStart:before-start': beforeStart },\n}\n", "import type Interaction from '@interactjs/core/Interaction'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './base'\nimport basePlugin from './base'\n/* eslint-enable */\n\ndeclare module '@interactjs/core/options' {\n  interface PerActionDefaults {\n    hold?: number\n    delay?: number\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    autoStartHoldTimer?: any\n  }\n}\n\nfunction install(scope: Scope) {\n  const { defaults } = scope\n\n  scope.usePlugin(basePlugin)\n\n  defaults.perAction.hold = 0\n  defaults.perAction.delay = 0\n}\n\nfunction getHoldDuration(interaction: Interaction) {\n  const actionName = interaction.prepared && interaction.prepared.name\n\n  if (!actionName) {\n    return null\n  }\n\n  const options = interaction.interactable.options\n\n  return options[actionName].hold || options[actionName].delay\n}\n\nconst hold: Plugin = {\n  id: 'auto-start/hold',\n  install,\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.autoStartHoldTimer = null\n    },\n\n    'autoStart:prepared': ({ interaction }) => {\n      const hold = getHoldDuration(interaction)\n\n      if (hold > 0) {\n        interaction.autoStartHoldTimer = setTimeout(() => {\n          interaction.start(interaction.prepared, interaction.interactable, interaction.element)\n        }, hold)\n      }\n    },\n\n    'interactions:move': ({ interaction, duplicate }) => {\n      if (interaction.autoStartHoldTimer && interaction.pointerWasMoved && !duplicate) {\n        clearTimeout(interaction.autoStartHoldTimer)\n        interaction.autoStartHoldTimer = null\n      }\n    },\n\n    // prevent regular down->move autoStart\n    'autoStart:before-start': ({ interaction }) => {\n      const holdDuration = getHoldDuration(interaction)\n\n      if (holdDuration > 0) {\n        interaction.prepared.name = null\n      }\n    },\n  },\n  getHoldDuration,\n}\nexport default hold\n", "import type { Scope } from '@interactjs/core/scope'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './base'\nimport './dragAxis'\nimport './hold'\n\nimport autoStart from './base'\nimport dragAxis from './dragAxis'\nimport hold from './hold'\n/* eslint-enable import/no-duplicates */\n\nexport default {\n  id: 'auto-start',\n  install(scope: Scope) {\n    scope.usePlugin(autoStart)\n    scope.usePlugin(hold)\n    scope.usePlugin(dragAxis)\n  },\n}\n", "import { matchesSelector, nodeContains } from '@interactjs/utils/domUtils'\nimport is from '@interactjs/utils/is'\nimport { getWindow } from '@interactjs/utils/window'\n\nimport type { Interactable } from '@interactjs/core/Interactable'\nimport type Interaction from '@interactjs/core/Interaction'\nimport type { Scope } from '@interactjs/core/scope'\nimport type { PointerEventType } from '@interactjs/core/types'\n\ntype PreventDefaultValue = 'always' | 'never' | 'auto'\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    preventDefault(newValue: PreventDefaultValue): this\n    preventDefault(): PreventDefaultValue\n    /**\n     * Returns or sets whether to prevent the browser's default behaviour in\n     * response to pointer events. Can be set to:\n     *  - `'always'` to always prevent\n     *  - `'never'` to never prevent\n     *  - `'auto'` to let interact.js try to determine what would be best\n     *\n     * @param newValue - `'always'`, `'never'` or `'auto'`\n     * @returns The current setting or this Interactable\n     */\n    preventDefault(newValue?: PreventDefaultValue): PreventDefaultValue | this\n    checkAndPreventDefault(event: Event): void\n  }\n}\n\nconst preventDefault = function preventDefault(this: Interactable, newValue?: PreventDefaultValue) {\n  if (/^(always|never|auto)$/.test(newValue)) {\n    this.options.preventDefault = newValue\n    return this\n  }\n\n  if (is.bool(newValue)) {\n    this.options.preventDefault = newValue ? 'always' : 'never'\n    return this\n  }\n\n  return this.options.preventDefault\n} as Interactable['preventDefault']\n\nfunction checkAndPreventDefault(interactable: Interactable, scope: Scope, event: Event) {\n  const setting = interactable.options.preventDefault\n\n  if (setting === 'never') return\n\n  if (setting === 'always') {\n    event.preventDefault()\n    return\n  }\n\n  // setting === 'auto'\n\n  // if the browser supports passive event listeners and isn't running on iOS,\n  // don't preventDefault of touch{start,move} events. CSS touch-action and\n  // user-select should be used instead of calling event.preventDefault().\n  if (scope.events.supportsPassive && /^touch(start|move)$/.test(event.type)) {\n    const doc = getWindow(event.target).document\n    const docOptions = scope.getDocOptions(doc)\n\n    if (!(docOptions && docOptions.events) || docOptions.events.passive !== false) {\n      return\n    }\n  }\n\n  // don't preventDefault of pointerdown events\n  if (/^(mouse|pointer|touch)*(down|start)/i.test(event.type)) {\n    return\n  }\n\n  // don't preventDefault on editable elements\n  if (\n    is.element(event.target) &&\n    matchesSelector(event.target, 'input,select,textarea,[contenteditable=true],[contenteditable=true] *')\n  ) {\n    return\n  }\n\n  event.preventDefault()\n}\n\nfunction onInteractionEvent({ interaction, event }: { interaction: Interaction; event: PointerEventType }) {\n  if (interaction.interactable) {\n    interaction.interactable.checkAndPreventDefault(event as Event)\n  }\n}\n\nexport function install(scope: Scope) {\n  const { Interactable } = scope\n\n  Interactable.prototype.preventDefault = preventDefault\n\n  Interactable.prototype.checkAndPreventDefault = function (event) {\n    return checkAndPreventDefault(this, scope, event)\n  }\n\n  // prevent native HTML5 drag on interact.js target elements\n  scope.interactions.docEvents.push({\n    type: 'dragstart',\n    listener(event) {\n      for (const interaction of scope.interactions.list) {\n        if (\n          interaction.element &&\n          (interaction.element === event.target || nodeContains(interaction.element, event.target))\n        ) {\n          interaction.interactable.checkAndPreventDefault(event)\n          return\n        }\n      }\n    },\n  })\n}\n\nexport default {\n  id: 'core/interactablePreventDefault',\n  install,\n  listeners: ['down', 'move', 'up', 'cancel'].reduce((acc, eventType) => {\n    acc[`interactions:${eventType}`] = onInteractionEvent\n    return acc\n  }, {} as any),\n}\n", "import type { Actions } from '@interactjs/core/types'\n\nexport default function isNonNativeEvent(type: string, actions: Actions) {\n  if (actions.phaselessTypes[type]) {\n    return true\n  }\n\n  for (const name in actions.map) {\n    if (type.indexOf(name) === 0 && type.substr(name.length) in actions.phases) {\n      return true\n    }\n  }\n\n  return false\n}\n", "import * as arr from './arr'\nimport is from './is'\n\n// tslint:disable-next-line ban-types\nexport default function clone<T extends Object>(source: T): Partial<T> {\n  const dest = {} as Partial<T>\n\n  for (const prop in source) {\n    const value = source[prop]\n\n    if (is.plainObject(value)) {\n      dest[prop] = clone(value) as any\n    } else if (is.array(value)) {\n      dest[prop] = arr.from(value) as typeof value\n    } else {\n      dest[prop] = value\n    }\n  }\n\n  return dest\n}\n", "import type { EventPhase } from '@interactjs/core/InteractEvent'\nimport type { Interaction, DoAnyPhaseArg } from '@interactjs/core/Interaction'\nimport type { EdgeOptions, FullRect, Point, Rect } from '@interactjs/core/types'\nimport clone from '@interactjs/utils/clone'\nimport extend from '@interactjs/utils/extend'\nimport * as rectUtils from '@interactjs/utils/rect'\n\nimport type { Modifier, ModifierArg, ModifierState } from './types'\n\nexport interface ModificationResult {\n  delta: Point\n  rectDelta: Rect\n  coords: Point\n  rect: FullRect\n  eventProps: any[]\n  changed: boolean\n}\n\ninterface MethodArg {\n  phase: EventPhase\n  pageCoords: Point\n  rect: FullRect\n  coords: Point\n  preEnd?: boolean\n  skipModifiers?: number\n}\n\nexport class Modification {\n  states: ModifierState[] = []\n  startOffset: Rect = { left: 0, right: 0, top: 0, bottom: 0 }\n  startDelta!: Point\n  result!: ModificationResult\n  endResult!: Point\n  startEdges!: EdgeOptions\n  edges: EdgeOptions\n  readonly interaction: Readonly<Interaction>\n\n  constructor(interaction: Interaction) {\n    this.interaction = interaction\n    this.result = createResult()\n    this.edges = {\n      left: false,\n      right: false,\n      top: false,\n      bottom: false,\n    }\n  }\n\n  start({ phase }: { phase: EventPhase }, pageCoords: Point) {\n    const { interaction } = this\n    const modifierList = getModifierList(interaction)\n    this.prepareStates(modifierList)\n\n    this.startEdges = extend({}, interaction.edges)\n    this.edges = extend({}, this.startEdges)\n    this.startOffset = getRectOffset(interaction.rect, pageCoords)\n    this.startDelta = { x: 0, y: 0 }\n\n    const arg = this.fillArg({\n      phase,\n      pageCoords,\n      preEnd: false,\n    })\n\n    this.result = createResult()\n    this.startAll(arg)\n\n    const result = (this.result = this.setAll(arg))\n\n    return result\n  }\n\n  fillArg(arg: Partial<ModifierArg>) {\n    const { interaction } = this\n\n    arg.interaction = interaction\n    arg.interactable = interaction.interactable\n    arg.element = interaction.element\n    arg.rect ||= interaction.rect\n    arg.edges ||= this.startEdges\n    arg.startOffset = this.startOffset\n\n    return arg as ModifierArg\n  }\n\n  startAll(arg: MethodArg & Partial<ModifierArg>) {\n    for (const state of this.states) {\n      if (state.methods.start) {\n        arg.state = state\n        state.methods.start(arg as ModifierArg)\n      }\n    }\n  }\n\n  setAll(arg: MethodArg & Partial<ModifierArg>): ModificationResult {\n    const { phase, preEnd, skipModifiers, rect: unmodifiedRect, edges: unmodifiedEdges } = arg\n\n    arg.coords = extend({}, arg.pageCoords)\n    arg.rect = extend({}, unmodifiedRect)\n    arg.edges = extend({}, unmodifiedEdges)\n\n    const states = skipModifiers ? this.states.slice(skipModifiers) : this.states\n\n    const newResult = createResult(arg.coords, arg.rect)\n\n    for (const state of states) {\n      const { options } = state\n      const lastModifierCoords = extend({}, arg.coords)\n      let returnValue = null\n\n      if (state.methods?.set && this.shouldDo(options, preEnd, phase)) {\n        arg.state = state\n        returnValue = state.methods.set(arg as ModifierArg<never>)\n\n        rectUtils.addEdges(arg.edges, arg.rect, {\n          x: arg.coords.x - lastModifierCoords.x,\n          y: arg.coords.y - lastModifierCoords.y,\n        })\n      }\n\n      newResult.eventProps.push(returnValue)\n    }\n\n    extend(this.edges, arg.edges)\n\n    newResult.delta.x = arg.coords.x - arg.pageCoords.x\n    newResult.delta.y = arg.coords.y - arg.pageCoords.y\n\n    newResult.rectDelta.left = arg.rect.left - unmodifiedRect.left\n    newResult.rectDelta.right = arg.rect.right - unmodifiedRect.right\n    newResult.rectDelta.top = arg.rect.top - unmodifiedRect.top\n    newResult.rectDelta.bottom = arg.rect.bottom - unmodifiedRect.bottom\n\n    const prevCoords = this.result.coords\n    const prevRect = this.result.rect\n\n    if (prevCoords && prevRect) {\n      const rectChanged =\n        newResult.rect.left !== prevRect.left ||\n        newResult.rect.right !== prevRect.right ||\n        newResult.rect.top !== prevRect.top ||\n        newResult.rect.bottom !== prevRect.bottom\n\n      newResult.changed =\n        rectChanged || prevCoords.x !== newResult.coords.x || prevCoords.y !== newResult.coords.y\n    }\n\n    return newResult\n  }\n\n  applyToInteraction(arg: { phase: EventPhase; rect?: Rect }) {\n    const { interaction } = this\n    const { phase } = arg\n    const curCoords = interaction.coords.cur\n    const startCoords = interaction.coords.start\n    const { result, startDelta } = this\n    const curDelta = result.delta\n\n    if (phase === 'start') {\n      extend(this.startDelta, result.delta)\n    }\n\n    for (const [coordsSet, delta] of [\n      [startCoords, startDelta],\n      [curCoords, curDelta],\n    ] as const) {\n      coordsSet.page.x += delta.x\n      coordsSet.page.y += delta.y\n      coordsSet.client.x += delta.x\n      coordsSet.client.y += delta.y\n    }\n\n    const { rectDelta } = this.result\n    const rect = arg.rect || interaction.rect\n\n    rect.left += rectDelta.left\n    rect.right += rectDelta.right\n    rect.top += rectDelta.top\n    rect.bottom += rectDelta.bottom\n\n    rect.width = rect.right - rect.left\n    rect.height = rect.bottom - rect.top\n  }\n\n  setAndApply(\n    arg: Partial<DoAnyPhaseArg> & {\n      phase: EventPhase\n      preEnd?: boolean\n      skipModifiers?: number\n      modifiedCoords?: Point\n    },\n  ): void | false {\n    const { interaction } = this\n    const { phase, preEnd, skipModifiers } = arg\n\n    const result = this.setAll(\n      this.fillArg({\n        preEnd,\n        phase,\n        pageCoords: arg.modifiedCoords || interaction.coords.cur.page,\n      }),\n    )\n\n    this.result = result\n\n    // don't fire an action move if a modifier would keep the event in the same\n    // cordinates as before\n    if (\n      !result.changed &&\n      (!skipModifiers || skipModifiers < this.states.length) &&\n      interaction.interacting()\n    ) {\n      return false\n    }\n\n    if (arg.modifiedCoords) {\n      const { page } = interaction.coords.cur\n      const adjustment = {\n        x: arg.modifiedCoords.x - page.x,\n        y: arg.modifiedCoords.y - page.y,\n      }\n\n      result.coords.x += adjustment.x\n      result.coords.y += adjustment.y\n      result.delta.x += adjustment.x\n      result.delta.y += adjustment.y\n    }\n\n    this.applyToInteraction(arg)\n  }\n\n  beforeEnd(arg: Omit<DoAnyPhaseArg, 'iEvent'> & { state?: ModifierState }): void | false {\n    const { interaction, event } = arg\n    const states = this.states\n\n    if (!states || !states.length) {\n      return\n    }\n\n    let doPreend = false\n\n    for (const state of states) {\n      arg.state = state\n      const { options, methods } = state\n\n      const endPosition = methods.beforeEnd && methods.beforeEnd(arg as unknown as ModifierArg)\n\n      if (endPosition) {\n        this.endResult = endPosition\n        return false\n      }\n\n      doPreend = doPreend || (!doPreend && this.shouldDo(options, true, arg.phase, true))\n    }\n\n    if (doPreend) {\n      // trigger a final modified move before ending\n      interaction.move({ event, preEnd: true })\n    }\n  }\n\n  stop(arg: { interaction: Interaction }) {\n    const { interaction } = arg\n\n    if (!this.states || !this.states.length) {\n      return\n    }\n\n    const modifierArg: Partial<ModifierArg> = extend(\n      {\n        states: this.states,\n        interactable: interaction.interactable,\n        element: interaction.element,\n        rect: null,\n      },\n      arg,\n    )\n\n    this.fillArg(modifierArg)\n\n    for (const state of this.states) {\n      modifierArg.state = state\n\n      if (state.methods.stop) {\n        state.methods.stop(modifierArg as ModifierArg)\n      }\n    }\n\n    this.states = null\n    this.endResult = null\n  }\n\n  prepareStates(modifierList: Modifier[]) {\n    this.states = []\n\n    for (let index = 0; index < modifierList.length; index++) {\n      const { options, methods, name } = modifierList[index]\n\n      this.states.push({\n        options,\n        methods,\n        index,\n        name,\n      })\n    }\n\n    return this.states\n  }\n\n  restoreInteractionCoords({ interaction: { coords, rect, modification } }: { interaction: Interaction }) {\n    if (!modification.result) return\n\n    const { startDelta } = modification\n    const { delta: curDelta, rectDelta } = modification.result\n\n    const coordsAndDeltas = [\n      [coords.start, startDelta],\n      [coords.cur, curDelta],\n    ]\n\n    for (const [coordsSet, delta] of coordsAndDeltas as any) {\n      coordsSet.page.x -= delta.x\n      coordsSet.page.y -= delta.y\n      coordsSet.client.x -= delta.x\n      coordsSet.client.y -= delta.y\n    }\n\n    rect.left -= rectDelta.left\n    rect.right -= rectDelta.right\n    rect.top -= rectDelta.top\n    rect.bottom -= rectDelta.bottom\n  }\n\n  shouldDo(options, preEnd?: boolean, phase?: string, requireEndOnly?: boolean) {\n    if (\n      // ignore disabled modifiers\n      !options ||\n      options.enabled === false ||\n      // check if we require endOnly option to fire move before end\n      (requireEndOnly && !options.endOnly) ||\n      // don't apply endOnly modifiers when not ending\n      (options.endOnly && !preEnd) ||\n      // check if modifier should run be applied on start\n      (phase === 'start' && !options.setStart)\n    ) {\n      return false\n    }\n\n    return true\n  }\n\n  copyFrom(other: Modification) {\n    this.startOffset = other.startOffset\n    this.startDelta = other.startDelta\n    this.startEdges = other.startEdges\n    this.edges = other.edges\n    this.states = other.states.map((s) => clone(s) as ModifierState)\n    this.result = createResult(extend({}, other.result.coords), extend({}, other.result.rect))\n  }\n\n  destroy() {\n    for (const prop in this) {\n      this[prop] = null\n    }\n  }\n}\n\nfunction createResult(coords?: Point, rect?: FullRect): ModificationResult {\n  return {\n    rect,\n    coords,\n    delta: { x: 0, y: 0 },\n    rectDelta: {\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    },\n    eventProps: [],\n    changed: true,\n  }\n}\n\nfunction getModifierList(interaction) {\n  const actionOptions = interaction.interactable.options[interaction.prepared.name]\n  const actionModifiers = actionOptions.modifiers\n\n  if (actionModifiers && actionModifiers.length) {\n    return actionModifiers\n  }\n\n  return ['snap', 'snapSize', 'snapEdges', 'restrict', 'restrictEdges', 'restrictSize']\n    .map((type) => {\n      const options = actionOptions[type]\n\n      return (\n        options &&\n        options.enabled && {\n          options,\n          methods: options._methods,\n        }\n      )\n    })\n    .filter((m) => !!m)\n}\n\nexport function getRectOffset(rect, coords) {\n  return rect\n    ? {\n        left: coords.x - rect.left,\n        top: coords.y - rect.top,\n        right: rect.right - coords.x,\n        bottom: rect.bottom - coords.y,\n      }\n    : {\n        left: 0,\n        top: 0,\n        right: 0,\n        bottom: 0,\n      }\n}\n", "import type { InteractEvent } from '@interactjs/core/InteractEvent'\nimport type Interaction from '@interactjs/core/Interaction'\nimport type { Plugin } from '@interactjs/core/scope'\n\nimport { Modification } from './Modification'\nimport type { Modifier, ModifierModule, ModifierState } from './types'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    modification?: Modification\n  }\n}\n\ndeclare module '@interactjs/core/InteractEvent' {\n  interface InteractEvent {\n    modifiers?: Array<{\n      name: string\n      [key: string]: any\n    }>\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface PerActionDefaults {\n    modifiers?: Modifier[]\n  }\n}\n\nexport function makeModifier<\n  Defaults extends { enabled?: boolean },\n  State extends ModifierState,\n  Name extends string,\n  Result,\n>(module: ModifierModule<Defaults, State, Result>, name?: Name) {\n  const { defaults } = module\n  const methods = {\n    start: module.start,\n    set: module.set,\n    beforeEnd: module.beforeEnd,\n    stop: module.stop,\n  }\n\n  const modifier = (_options?: Partial<Defaults>) => {\n    const options = (_options || {}) as Defaults\n\n    options.enabled = options.enabled !== false\n\n    // add missing defaults to options\n    for (const prop in defaults) {\n      if (!(prop in options)) {\n        ;(options as any)[prop] = defaults[prop]\n      }\n    }\n\n    const m: Modifier<Defaults, State, Name, Result> = {\n      options,\n      methods,\n      name,\n      enable: () => {\n        options.enabled = true\n        return m\n      },\n      disable: () => {\n        options.enabled = false\n        return m\n      },\n    }\n\n    return m\n  }\n\n  if (name && typeof name === 'string') {\n    // for backwrads compatibility\n    modifier._defaults = defaults\n    modifier._methods = methods\n  }\n\n  return modifier\n}\n\nexport function addEventModifiers({\n  iEvent,\n  interaction,\n}: {\n  iEvent: InteractEvent<any>\n  interaction: Interaction<any>\n}) {\n  const result = interaction.modification!.result\n\n  if (result) {\n    iEvent.modifiers = result.eventProps\n  }\n}\n\nconst modifiersBase: Plugin = {\n  id: 'modifiers/base',\n  before: ['actions'],\n  install: (scope) => {\n    scope.defaults.perAction.modifiers = []\n  },\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.modification = new Modification(interaction)\n    },\n\n    'interactions:before-action-start': (arg) => {\n      const { interaction } = arg\n      const modification = arg.interaction.modification!\n\n      modification.start(arg, interaction.coords.start.page)\n      interaction.edges = modification.edges\n      modification.applyToInteraction(arg)\n    },\n\n    'interactions:before-action-move': (arg) => {\n      const { interaction } = arg\n      const { modification } = interaction\n      const ret = modification.setAndApply(arg)\n      interaction.edges = modification.edges\n\n      return ret\n    },\n\n    'interactions:before-action-end': (arg) => {\n      const { interaction } = arg\n      const { modification } = interaction\n      const ret = modification.beforeEnd(arg)\n      interaction.edges = modification.startEdges\n\n      return ret\n    },\n\n    'interactions:action-start': addEventModifiers,\n    'interactions:action-move': addEventModifiers,\n    'interactions:action-end': addEventModifiers,\n\n    'interactions:after-action-start': (arg) => arg.interaction.modification.restoreInteractionCoords(arg),\n    'interactions:after-action-move': (arg) => arg.interaction.modification.restoreInteractionCoords(arg),\n\n    'interactions:stop': (arg) => arg.interaction.modification.stop(arg),\n  },\n}\n\nexport default modifiersBase\n", "import type { Point, Listeners, OrBoolean, Element, Rect } from '@interactjs/core/types'\n\nexport interface Defaults {\n  base: BaseDefaults\n  perAction: PerActionDefaults\n  actions: ActionDefaults\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface ActionDefaults {}\n\nexport interface BaseDefaults {\n  preventDefault?: 'always' | 'never' | 'auto'\n  deltaSource?: 'page' | 'client'\n  context?: Node\n  getRect?: (element: Element) => Rect\n}\n\nexport interface PerActionDefaults {\n  enabled?: boolean\n  origin?: Point | string | Element\n  listeners?: Listeners\n  allowFrom?: string | Element\n  ignoreFrom?: string | Element\n}\n\nexport type Options = Partial<BaseDefaults> &\n  Partial<PerActionDefaults> & {\n    [P in keyof ActionDefaults]?: Partial<ActionDefaults[P]>\n  }\n\nexport interface OptionsArg extends BaseDefaults, OrBoolean<Partial<ActionDefaults>> {}\n\nexport const defaults: Defaults = {\n  base: {\n    preventDefault: 'auto',\n    deltaSource: 'page',\n  },\n\n  perAction: {\n    enabled: false,\n    origin: { x: 0, y: 0 },\n  },\n\n  actions: {} as ActionDefaults,\n}\n", "import extend from '@interactjs/utils/extend'\nimport getOriginXY from '@interactjs/utils/getOriginXY'\nimport hypot from '@interactjs/utils/hypot'\n\nimport type { Point, FullRect, PointerEventType, Element, ActionName } from '@interactjs/core/types'\n\nimport { BaseEvent } from './BaseEvent'\nimport type { Interaction } from './Interaction'\nimport { defaults } from './options'\n\nexport type EventPhase = keyof PhaseMap\n\nexport interface PhaseMap {\n  start: true\n  move: true\n  end: true\n}\n\n// defined outside of class definition to avoid assignment of undefined during\n// construction\nexport interface InteractEvent {\n  pageX: number\n  pageY: number\n\n  clientX: number\n  clientY: number\n\n  dx: number\n  dy: number\n\n  velocityX: number\n  velocityY: number\n}\n\nexport class InteractEvent<\n  T extends ActionName = never,\n  P extends EventPhase = EventPhase,\n> extends BaseEvent<T> {\n  declare target: Element\n  declare currentTarget: Element\n  relatedTarget: Element | null = null\n  screenX?: number\n  screenY?: number\n  button: number\n  buttons: number\n  ctrlKey: boolean\n  shiftKey: boolean\n  altKey: boolean\n  metaKey: boolean\n  page: Point\n  client: Point\n  delta: Point\n  rect: FullRect\n  x0: number\n  y0: number\n  t0: number\n  dt: number\n  duration: number\n  clientX0: number\n  clientY0: number\n  velocity: Point\n  speed: number\n  swipe: ReturnType<InteractEvent<T>['getSwipe']>\n  // resize\n  axes?: 'x' | 'y' | 'xy'\n  /** @internal */\n  preEnd?: boolean\n\n  constructor(\n    interaction: Interaction<T>,\n    event: PointerEventType,\n    actionName: T,\n    phase: P,\n    element: Element,\n    preEnd?: boolean,\n    type?: string,\n  ) {\n    super(interaction)\n\n    element = element || interaction.element\n\n    const target = interaction.interactable\n    const deltaSource = (((target && target.options) || defaults) as any).deltaSource as 'page' | 'client'\n    const origin = getOriginXY(target, element, actionName)\n    const starting = phase === 'start'\n    const ending = phase === 'end'\n    const prevEvent = starting ? this : interaction.prevEvent\n    const coords = starting\n      ? interaction.coords.start\n      : ending\n        ? { page: prevEvent.page, client: prevEvent.client, timeStamp: interaction.coords.cur.timeStamp }\n        : interaction.coords.cur\n\n    this.page = extend({}, coords.page)\n    this.client = extend({}, coords.client)\n    this.rect = extend({}, interaction.rect)\n    this.timeStamp = coords.timeStamp\n\n    if (!ending) {\n      this.page.x -= origin.x\n      this.page.y -= origin.y\n\n      this.client.x -= origin.x\n      this.client.y -= origin.y\n    }\n\n    this.ctrlKey = event.ctrlKey\n    this.altKey = event.altKey\n    this.shiftKey = event.shiftKey\n    this.metaKey = event.metaKey\n    this.button = (event as MouseEvent).button\n    this.buttons = (event as MouseEvent).buttons\n    this.target = element\n    this.currentTarget = element\n    this.preEnd = preEnd\n    this.type = type || actionName + (phase || '')\n    this.interactable = target\n\n    this.t0 = starting ? interaction.pointers[interaction.pointers.length - 1].downTime : prevEvent.t0\n\n    this.x0 = interaction.coords.start.page.x - origin.x\n    this.y0 = interaction.coords.start.page.y - origin.y\n    this.clientX0 = interaction.coords.start.client.x - origin.x\n    this.clientY0 = interaction.coords.start.client.y - origin.y\n\n    if (starting || ending) {\n      this.delta = { x: 0, y: 0 }\n    } else {\n      this.delta = {\n        x: this[deltaSource].x - prevEvent[deltaSource].x,\n        y: this[deltaSource].y - prevEvent[deltaSource].y,\n      }\n    }\n\n    this.dt = interaction.coords.delta.timeStamp\n    this.duration = this.timeStamp - this.t0\n\n    // velocity and speed in pixels per second\n    this.velocity = extend({}, interaction.coords.velocity[deltaSource])\n    this.speed = hypot(this.velocity.x, this.velocity.y)\n\n    this.swipe = ending || phase === 'inertiastart' ? this.getSwipe() : null\n  }\n\n  getSwipe() {\n    const interaction = this._interaction\n\n    if (interaction.prevEvent.speed < 600 || this.timeStamp - interaction.prevEvent.timeStamp > 150) {\n      return null\n    }\n\n    let angle = (180 * Math.atan2(interaction.prevEvent.velocityY, interaction.prevEvent.velocityX)) / Math.PI\n    const overlap = 22.5\n\n    if (angle < 0) {\n      angle += 360\n    }\n\n    const left = 135 - overlap <= angle && angle < 225 + overlap\n    const up = 225 - overlap <= angle && angle < 315 + overlap\n\n    const right = !left && (315 - overlap <= angle || angle < 45 + overlap)\n    const down = !up && 45 - overlap <= angle && angle < 135 + overlap\n\n    return {\n      up,\n      down,\n      left,\n      right,\n      angle,\n      speed: interaction.prevEvent.speed,\n      velocity: {\n        x: interaction.prevEvent.velocityX,\n        y: interaction.prevEvent.velocityY,\n      },\n    }\n  }\n\n  preventDefault() {}\n\n  /**\n   * Don't call listeners on the remaining targets\n   */\n  stopImmediatePropagation() {\n    this.immediatePropagationStopped = this.propagationStopped = true\n  }\n\n  /**\n   * Don't call any other listeners (even on the current target)\n   */\n  stopPropagation() {\n    this.propagationStopped = true\n  }\n}\n\n// getters and setters defined here to support typescript 3.6 and below which\n// don't support getter and setters in .d.ts files\nObject.defineProperties(InteractEvent.prototype, {\n  pageX: {\n    get() {\n      return this.page.x\n    },\n    set(value) {\n      this.page.x = value\n    },\n  },\n  pageY: {\n    get() {\n      return this.page.y\n    },\n    set(value) {\n      this.page.y = value\n    },\n  },\n\n  clientX: {\n    get() {\n      return this.client.x\n    },\n    set(value) {\n      this.client.x = value\n    },\n  },\n  clientY: {\n    get() {\n      return this.client.y\n    },\n    set(value) {\n      this.client.y = value\n    },\n  },\n\n  dx: {\n    get() {\n      return this.delta.x\n    },\n    set(value) {\n      this.delta.x = value\n    },\n  },\n  dy: {\n    get() {\n      return this.delta.y\n    },\n    set(value) {\n      this.delta.y = value\n    },\n  },\n\n  velocityX: {\n    get() {\n      return this.velocity.x\n    },\n    set(value) {\n      this.velocity.x = value\n    },\n  },\n  velocityY: {\n    get() {\n      return this.velocity.y\n    },\n    set(value) {\n      this.velocity.y = value\n    },\n  },\n})\n", "import type { PointerEventType, PointerType } from '@interactjs/core/types'\n\nexport class PointerInfo {\n  id: number\n  pointer: PointerType\n  event: PointerEventType\n  downTime: number\n  downTarget: Node\n\n  constructor(id: number, pointer: PointerType, event: PointerEventType, downTime: number, downTarget: Node) {\n    this.id = id\n    this.pointer = pointer\n    this.event = event\n    this.downTime = downTime\n    this.downTarget = downTarget\n  }\n}\n", "import * as arr from '@interactjs/utils/arr'\nimport extend from '@interactjs/utils/extend'\nimport hypot from '@interactjs/utils/hypot'\nimport { warnOnce, copyAction } from '@interactjs/utils/misc'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\nimport * as rectUtils from '@interactjs/utils/rect'\n\nimport type {\n  Element,\n  EdgeOptions,\n  PointerEventType,\n  PointerType,\n  FullRect,\n  CoordsSet,\n  ActionName,\n  ActionProps,\n} from '@interactjs/core/types'\n\nimport type { Interactable } from './Interactable'\nimport type { EventPhase } from './InteractEvent'\nimport { InteractEvent } from './InteractEvent'\nimport type { ActionDefaults } from './options'\nimport { PointerInfo } from './PointerInfo'\nimport type { Scope } from './scope'\n\nexport enum _ProxyValues {\n  interactable = '',\n  element = '',\n  prepared = '',\n  pointerIsDown = '',\n  pointerWasMoved = '',\n  _proxy = '',\n}\n\nexport enum _ProxyMethods {\n  start = '',\n  move = '',\n  end = '',\n  stop = '',\n  interacting = '',\n}\n\nexport type PointerArgProps<T extends {} = {}> = {\n  pointer: PointerType\n  event: PointerEventType\n  eventTarget: Node\n  pointerIndex: number\n  pointerInfo: PointerInfo\n  interaction: Interaction<never>\n} & T\n\nexport interface DoPhaseArg<T extends ActionName, P extends EventPhase> {\n  event: PointerEventType\n  phase: EventPhase\n  interaction: Interaction<T>\n  iEvent: InteractEvent<T, P>\n  preEnd?: boolean\n  type?: string\n}\n\nexport type DoAnyPhaseArg = DoPhaseArg<ActionName, EventPhase>\n\ndeclare module '@interactjs/core/scope' {\n  interface SignalArgs {\n    'interactions:new': { interaction: Interaction<ActionName> }\n    'interactions:down': PointerArgProps<{\n      type: 'down'\n    }>\n    'interactions:move': PointerArgProps<{\n      type: 'move'\n      dx: number\n      dy: number\n      duplicate: boolean\n    }>\n    'interactions:up': PointerArgProps<{\n      type: 'up'\n      curEventTarget: EventTarget\n    }>\n    'interactions:cancel': SignalArgs['interactions:up'] & {\n      type: 'cancel'\n      curEventTarget: EventTarget\n    }\n    'interactions:update-pointer': PointerArgProps<{\n      down: boolean\n    }>\n    'interactions:remove-pointer': PointerArgProps\n    'interactions:blur': { interaction: Interaction<never>; event: Event; type: 'blur' }\n    'interactions:before-action-start': Omit<DoAnyPhaseArg, 'iEvent'>\n    'interactions:action-start': DoAnyPhaseArg\n    'interactions:after-action-start': DoAnyPhaseArg\n    'interactions:before-action-move': Omit<DoAnyPhaseArg, 'iEvent'>\n    'interactions:action-move': DoAnyPhaseArg\n    'interactions:after-action-move': DoAnyPhaseArg\n    'interactions:before-action-end': Omit<DoAnyPhaseArg, 'iEvent'>\n    'interactions:action-end': DoAnyPhaseArg\n    'interactions:after-action-end': DoAnyPhaseArg\n    'interactions:stop': { interaction: Interaction }\n  }\n}\n\nexport type InteractionProxy<T extends ActionName | null = never> = Pick<\n  Interaction<T>,\n  Exclude<keyof typeof _ProxyValues | keyof typeof _ProxyMethods, '_proxy'>\n>\n\nlet idCounter = 0\n\nexport class Interaction<T extends ActionName | null = ActionName> {\n  /** current interactable being interacted with */\n  interactable: Interactable | null = null\n\n  /** the target element of the interactable */\n  element: Element | null = null\n  rect: FullRect | null = null\n  /** @internal */\n  _rects?: {\n    start: FullRect\n    corrected: FullRect\n    previous: FullRect\n    delta: FullRect\n  }\n  /** @internal */\n  edges: EdgeOptions | null = null\n\n  /** @internal */\n  _scopeFire: Scope['fire']\n\n  // action that's ready to be fired on next move event\n  prepared: ActionProps<T> = {\n    name: null,\n    axis: null,\n    edges: null,\n  }\n\n  pointerType: string\n\n  /** @internal keep track of added pointers */\n  pointers: PointerInfo[] = []\n\n  /** @internal pointerdown/mousedown/touchstart event */\n  downEvent: PointerEventType | null = null\n\n  /** @internal */ downPointer: PointerType = {} as PointerType\n\n  /** @internal */\n  _latestPointer: {\n    pointer: PointerType\n    event: PointerEventType\n    eventTarget: Node\n  } = {\n    pointer: null,\n    event: null,\n    eventTarget: null,\n  }\n\n  /** @internal */ prevEvent: InteractEvent<T, EventPhase> = null\n\n  pointerIsDown = false\n  pointerWasMoved = false\n  /** @internal */ _interacting = false\n  /** @internal */ _ending = false\n  /** @internal */ _stopped = true\n  /** @internal */ _proxy: InteractionProxy<T>\n\n  /** @internal */ simulation = null\n\n  /** @internal */ get pointerMoveTolerance() {\n    return 1\n  }\n\n  doMove = warnOnce(function (this: Interaction, signalArg: any) {\n    this.move(signalArg)\n  }, 'The interaction.doMove() method has been renamed to interaction.move()')\n\n  coords: CoordsSet = {\n    // Starting InteractEvent pointer coordinates\n    start: pointerUtils.newCoords(),\n    // Previous native pointer move event coordinates\n    prev: pointerUtils.newCoords(),\n    // current native pointer move event coordinates\n    cur: pointerUtils.newCoords(),\n    // Change in coordinates and time of the pointer\n    delta: pointerUtils.newCoords(),\n    // pointer velocity\n    velocity: pointerUtils.newCoords(),\n  }\n\n  /** @internal */ readonly _id: number = idCounter++\n\n  constructor({ pointerType, scopeFire }: { pointerType?: string; scopeFire: Scope['fire'] }) {\n    this._scopeFire = scopeFire\n    this.pointerType = pointerType\n\n    const that = this\n\n    this._proxy = {} as InteractionProxy<T>\n\n    for (const key in _ProxyValues) {\n      Object.defineProperty(this._proxy, key, {\n        get() {\n          return that[key]\n        },\n      })\n    }\n\n    for (const key in _ProxyMethods) {\n      Object.defineProperty(this._proxy, key, {\n        value: (...args: any[]) => that[key](...args),\n      })\n    }\n\n    this._scopeFire('interactions:new', { interaction: this })\n  }\n\n  pointerDown(pointer: PointerType, event: PointerEventType, eventTarget: Node) {\n    const pointerIndex = this.updatePointer(pointer, event, eventTarget, true)\n    const pointerInfo = this.pointers[pointerIndex]\n\n    this._scopeFire('interactions:down', {\n      pointer,\n      event,\n      eventTarget,\n      pointerIndex,\n      pointerInfo,\n      type: 'down',\n      interaction: this as unknown as Interaction<never>,\n    })\n  }\n\n  /**\n   * ```js\n   * interact(target)\n   *   .draggable({\n   *     // disable the default drag start by down->move\n   *     manualStart: true\n   *   })\n   *   // start dragging after the user holds the pointer down\n   *   .on('hold', function (event) {\n   *     var interaction = event.interaction\n   *\n   *     if (!interaction.interacting()) {\n   *       interaction.start({ name: 'drag' },\n   *                         event.interactable,\n   *                         event.currentTarget)\n   *     }\n   * })\n   * ```\n   *\n   * Start an action with the given Interactable and Element as tartgets. The\n   * action must be enabled for the target Interactable and an appropriate\n   * number of pointers must be held down - 1 for drag/resize, 2 for gesture.\n   *\n   * Use it with `interactable.<action>able({ manualStart: false })` to always\n   * [start actions manually](https://github.com/taye/interact.js/issues/114)\n   *\n   * @param action - The action to be performed - drag, resize, etc.\n   * @param target - The Interactable to target\n   * @param element - The DOM Element to target\n   * @returns Whether the interaction was successfully started\n   */\n  start<A extends ActionName>(action: ActionProps<A>, interactable: Interactable, element: Element): boolean {\n    if (\n      this.interacting() ||\n      !this.pointerIsDown ||\n      this.pointers.length < (action.name === 'gesture' ? 2 : 1) ||\n      !interactable.options[action.name as keyof ActionDefaults].enabled\n    ) {\n      return false\n    }\n\n    copyAction(this.prepared, action)\n\n    this.interactable = interactable\n    this.element = element\n    this.rect = interactable.getRect(element)\n    this.edges = this.prepared.edges\n      ? extend({}, this.prepared.edges)\n      : { left: true, right: true, top: true, bottom: true }\n    this._stopped = false\n    this._interacting =\n      this._doPhase({\n        interaction: this,\n        event: this.downEvent,\n        phase: 'start',\n      }) && !this._stopped\n\n    return this._interacting\n  }\n\n  pointerMove(pointer: PointerType, event: PointerEventType, eventTarget: Node) {\n    if (!this.simulation && !(this.modification && this.modification.endResult)) {\n      this.updatePointer(pointer, event, eventTarget, false)\n    }\n\n    const duplicateMove =\n      this.coords.cur.page.x === this.coords.prev.page.x &&\n      this.coords.cur.page.y === this.coords.prev.page.y &&\n      this.coords.cur.client.x === this.coords.prev.client.x &&\n      this.coords.cur.client.y === this.coords.prev.client.y\n\n    let dx: number\n    let dy: number\n\n    // register movement greater than pointerMoveTolerance\n    if (this.pointerIsDown && !this.pointerWasMoved) {\n      dx = this.coords.cur.client.x - this.coords.start.client.x\n      dy = this.coords.cur.client.y - this.coords.start.client.y\n\n      this.pointerWasMoved = hypot(dx, dy) > this.pointerMoveTolerance\n    }\n\n    const pointerIndex = this.getPointerIndex(pointer)\n    const signalArg = {\n      pointer,\n      pointerIndex,\n      pointerInfo: this.pointers[pointerIndex],\n      event,\n      type: 'move' as const,\n      eventTarget,\n      dx,\n      dy,\n      duplicate: duplicateMove,\n      interaction: this as unknown as Interaction<never>,\n    }\n\n    if (!duplicateMove) {\n      // set pointer coordinate, time changes and velocity\n      pointerUtils.setCoordVelocity(this.coords.velocity, this.coords.delta)\n    }\n\n    this._scopeFire('interactions:move', signalArg)\n\n    if (!duplicateMove && !this.simulation) {\n      // if interacting, fire an 'action-move' signal etc\n      if (this.interacting()) {\n        signalArg.type = null\n        this.move(signalArg)\n      }\n\n      if (this.pointerWasMoved) {\n        pointerUtils.copyCoords(this.coords.prev, this.coords.cur)\n      }\n    }\n  }\n\n  /**\n   * ```js\n   * interact(target)\n   *   .draggable(true)\n   *   .on('dragmove', function (event) {\n   *     if (someCondition) {\n   *       // change the snap settings\n   *       event.interactable.draggable({ snap: { targets: [] }})\n   *       // fire another move event with re-calculated snap\n   *       event.interaction.move()\n   *     }\n   *   })\n   * ```\n   *\n   * Force a move of the current action at the same coordinates. Useful if\n   * snap/restrict has been changed and you want a movement with the new\n   * settings.\n   */\n  move(signalArg?: any) {\n    if (!signalArg || !signalArg.event) {\n      pointerUtils.setZeroCoords(this.coords.delta)\n    }\n\n    signalArg = extend(\n      {\n        pointer: this._latestPointer.pointer,\n        event: this._latestPointer.event,\n        eventTarget: this._latestPointer.eventTarget,\n        interaction: this,\n      },\n      signalArg || {},\n    )\n\n    signalArg.phase = 'move'\n\n    this._doPhase(signalArg)\n  }\n\n  /**\n   * @internal\n   * End interact move events and stop auto-scroll unless simulation is running\n   */\n  pointerUp(pointer: PointerType, event: PointerEventType, eventTarget: Node, curEventTarget: EventTarget) {\n    let pointerIndex = this.getPointerIndex(pointer)\n\n    if (pointerIndex === -1) {\n      pointerIndex = this.updatePointer(pointer, event, eventTarget, false)\n    }\n\n    const type = /cancel$/i.test(event.type) ? 'cancel' : 'up'\n\n    this._scopeFire(`interactions:${type}` as 'interactions:up' | 'interactions:cancel', {\n      pointer,\n      pointerIndex,\n      pointerInfo: this.pointers[pointerIndex],\n      event,\n      eventTarget,\n      type: type as any,\n      curEventTarget,\n      interaction: this as unknown as Interaction<never>,\n    })\n\n    if (!this.simulation) {\n      this.end(event)\n    }\n\n    this.removePointer(pointer, event)\n  }\n\n  /** @internal */\n  documentBlur(event: Event) {\n    this.end(event as any)\n    this._scopeFire('interactions:blur', {\n      event,\n      type: 'blur',\n      interaction: this as unknown as Interaction<never>,\n    })\n  }\n\n  /**\n   * ```js\n   * interact(target)\n   *   .draggable(true)\n   *   .on('move', function (event) {\n   *     if (event.pageX > 1000) {\n   *       // end the current action\n   *       event.interaction.end()\n   *       // stop all further listeners from being called\n   *       event.stopImmediatePropagation()\n   *     }\n   *   })\n   * ```\n   */\n  end(event?: PointerEventType) {\n    this._ending = true\n    event = event || this._latestPointer.event\n    let endPhaseResult: boolean\n\n    if (this.interacting()) {\n      endPhaseResult = this._doPhase({\n        event,\n        interaction: this,\n        phase: 'end',\n      })\n    }\n\n    this._ending = false\n\n    if (endPhaseResult === true) {\n      this.stop()\n    }\n  }\n\n  currentAction() {\n    return this._interacting ? this.prepared.name : null\n  }\n\n  interacting() {\n    return this._interacting\n  }\n\n  stop() {\n    this._scopeFire('interactions:stop', { interaction: this })\n\n    this.interactable = this.element = null\n\n    this._interacting = false\n    this._stopped = true\n    this.prepared.name = this.prevEvent = null\n  }\n\n  /** @internal */\n  getPointerIndex(pointer: any) {\n    const pointerId = pointerUtils.getPointerId(pointer)\n\n    // mouse and pen interactions may have only one pointer\n    return this.pointerType === 'mouse' || this.pointerType === 'pen'\n      ? this.pointers.length - 1\n      : arr.findIndex(this.pointers, (curPointer) => curPointer.id === pointerId)\n  }\n\n  /** @internal */\n  getPointerInfo(pointer: any) {\n    return this.pointers[this.getPointerIndex(pointer)]\n  }\n\n  /** @internal */\n  updatePointer(pointer: PointerType, event: PointerEventType, eventTarget: Node, down?: boolean) {\n    const id = pointerUtils.getPointerId(pointer)\n    let pointerIndex = this.getPointerIndex(pointer)\n    let pointerInfo = this.pointers[pointerIndex]\n\n    down = down === false ? false : down || /(down|start)$/i.test(event.type)\n\n    if (!pointerInfo) {\n      pointerInfo = new PointerInfo(id, pointer, event, null, null)\n\n      pointerIndex = this.pointers.length\n      this.pointers.push(pointerInfo)\n    } else {\n      pointerInfo.pointer = pointer\n    }\n\n    pointerUtils.setCoords(\n      this.coords.cur,\n      this.pointers.map((p) => p.pointer),\n      this._now(),\n    )\n    pointerUtils.setCoordDeltas(this.coords.delta, this.coords.prev, this.coords.cur)\n\n    if (down) {\n      this.pointerIsDown = true\n\n      pointerInfo.downTime = this.coords.cur.timeStamp\n      pointerInfo.downTarget = eventTarget\n      pointerUtils.pointerExtend(this.downPointer, pointer)\n\n      if (!this.interacting()) {\n        pointerUtils.copyCoords(this.coords.start, this.coords.cur)\n        pointerUtils.copyCoords(this.coords.prev, this.coords.cur)\n\n        this.downEvent = event\n        this.pointerWasMoved = false\n      }\n    }\n\n    this._updateLatestPointer(pointer, event, eventTarget)\n\n    this._scopeFire('interactions:update-pointer', {\n      pointer,\n      event,\n      eventTarget,\n      down,\n      pointerInfo,\n      pointerIndex,\n      interaction: this as unknown as Interaction<never>,\n    })\n\n    return pointerIndex\n  }\n\n  /** @internal */\n  removePointer(pointer: PointerType, event: PointerEventType) {\n    const pointerIndex = this.getPointerIndex(pointer)\n\n    if (pointerIndex === -1) return\n\n    const pointerInfo = this.pointers[pointerIndex]\n\n    this._scopeFire('interactions:remove-pointer', {\n      pointer,\n      event,\n      eventTarget: null,\n      pointerIndex,\n      pointerInfo,\n      interaction: this as unknown as Interaction<never>,\n    })\n\n    this.pointers.splice(pointerIndex, 1)\n    this.pointerIsDown = false\n  }\n\n  /** @internal */\n  _updateLatestPointer(pointer: PointerType, event: PointerEventType, eventTarget: Node) {\n    this._latestPointer.pointer = pointer\n    this._latestPointer.event = event\n    this._latestPointer.eventTarget = eventTarget\n  }\n\n  destroy() {\n    this._latestPointer.pointer = null\n    this._latestPointer.event = null\n    this._latestPointer.eventTarget = null\n  }\n\n  /** @internal */\n  _createPreparedEvent<P extends EventPhase>(\n    event: PointerEventType,\n    phase: P,\n    preEnd?: boolean,\n    type?: string,\n  ) {\n    return new InteractEvent<T, P>(this, event, this.prepared.name, phase, this.element, preEnd, type)\n  }\n\n  /** @internal */\n  _fireEvent<P extends EventPhase>(iEvent: InteractEvent<T, P>) {\n    this.interactable?.fire(iEvent)\n\n    if (!this.prevEvent || iEvent.timeStamp >= this.prevEvent.timeStamp) {\n      this.prevEvent = iEvent\n    }\n  }\n\n  /** @internal */\n  _doPhase<P extends EventPhase>(\n    signalArg: Omit<DoPhaseArg<T, P>, 'iEvent'> & { iEvent?: InteractEvent<T, P> },\n  ) {\n    const { event, phase, preEnd, type } = signalArg\n    const { rect } = this\n\n    if (rect && phase === 'move') {\n      // update the rect changes due to pointer move\n      rectUtils.addEdges(this.edges, rect, this.coords.delta[this.interactable.options.deltaSource])\n\n      rect.width = rect.right - rect.left\n      rect.height = rect.bottom - rect.top\n    }\n\n    const beforeResult = this._scopeFire(`interactions:before-action-${phase}` as any, signalArg)\n\n    if (beforeResult === false) {\n      return false\n    }\n\n    const iEvent = (signalArg.iEvent = this._createPreparedEvent(event, phase, preEnd, type))\n\n    this._scopeFire(`interactions:action-${phase}` as any, signalArg)\n\n    if (phase === 'start') {\n      this.prevEvent = iEvent\n    }\n\n    this._fireEvent(iEvent)\n\n    this._scopeFire(`interactions:after-action-${phase}` as any, signalArg)\n\n    return true\n  }\n\n  /** @internal */\n  _now() {\n    return Date.now()\n  }\n}\n\nexport default Interaction\nexport { PointerInfo }\n", "import type Interaction from '@interactjs/core/Interaction'\nimport { _ProxyMethods } from '@interactjs/core/Interaction'\nimport type { Plugin } from '@interactjs/core/scope'\nimport type { Point } from '@interactjs/core/types'\nimport * as rectUtils from '@interactjs/utils/rect'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    offsetBy?: typeof offsetBy\n    offset: {\n      total: Point\n      pending: Point\n    }\n  }\n\n  enum _ProxyMethods {\n    offsetBy = '',\n  }\n}\n\n;(_ProxyMethods as any).offsetBy = ''\n\nexport function addTotal(interaction: Interaction) {\n  if (!interaction.pointerIsDown) {\n    return\n  }\n\n  addToCoords(interaction.coords.cur, interaction.offset.total)\n\n  interaction.offset.pending.x = 0\n  interaction.offset.pending.y = 0\n}\n\nfunction beforeAction({ interaction }: { interaction: Interaction }) {\n  applyPending(interaction)\n}\n\nfunction beforeEnd({ interaction }: { interaction: Interaction }): boolean | void {\n  const hadPending = applyPending(interaction)\n\n  if (!hadPending) return\n\n  interaction.move({ offset: true })\n  interaction.end()\n\n  return false\n}\n\nfunction end({ interaction }: { interaction: Interaction }) {\n  interaction.offset.total.x = 0\n  interaction.offset.total.y = 0\n  interaction.offset.pending.x = 0\n  interaction.offset.pending.y = 0\n}\n\nexport function applyPending(interaction: Interaction) {\n  if (!hasPending(interaction)) {\n    return false\n  }\n\n  const { pending } = interaction.offset\n\n  addToCoords(interaction.coords.cur, pending)\n  addToCoords(interaction.coords.delta, pending)\n  rectUtils.addEdges(interaction.edges, interaction.rect, pending)\n\n  pending.x = 0\n  pending.y = 0\n\n  return true\n}\n\nfunction offsetBy(this: Interaction, { x, y }: Point) {\n  this.offset.pending.x += x\n  this.offset.pending.y += y\n\n  this.offset.total.x += x\n  this.offset.total.y += y\n}\n\nfunction addToCoords({ page, client }, { x, y }: Point) {\n  page.x += x\n  page.y += y\n  client.x += x\n  client.y += y\n}\n\nfunction hasPending(interaction: Interaction) {\n  return !!(interaction.offset.pending.x || interaction.offset.pending.y)\n}\n\nconst offset: Plugin = {\n  id: 'offset',\n  before: ['modifiers', 'pointer-events', 'actions', 'inertia'],\n  install(scope) {\n    scope.Interaction.prototype.offsetBy = offsetBy\n  },\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.offset = {\n        total: { x: 0, y: 0 },\n        pending: { x: 0, y: 0 },\n      }\n    },\n    'interactions:update-pointer': ({ interaction }) => addTotal(interaction),\n    'interactions:before-action-start': beforeAction,\n    'interactions:before-action-move': beforeAction,\n    'interactions:before-action-end': beforeEnd,\n    'interactions:stop': end,\n  },\n}\n\nexport default offset\n", "import type { Interaction, DoPhaseArg } from '@interactjs/core/Interaction'\nimport type { Scope, SignalArgs, Plugin } from '@interactjs/core/scope'\nimport type { ActionName, Point, PointerEventType } from '@interactjs/core/types'\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport '@interactjs/modifiers/base'\nimport '@interactjs/offset/plugin'\nimport * as modifiers from '@interactjs/modifiers/base'\nimport { Modification } from '@interactjs/modifiers/Modification'\nimport type { ModifierArg } from '@interactjs/modifiers/types'\nimport offset from '@interactjs/offset/plugin'\n/* eslint-enable import/no-duplicates */\nimport * as dom from '@interactjs/utils/domUtils'\nimport hypot from '@interactjs/utils/hypot'\nimport is from '@interactjs/utils/is'\nimport { copyCoords } from '@interactjs/utils/pointerUtils'\nimport raf from '@interactjs/utils/raf'\n\ndeclare module '@interactjs/core/InteractEvent' {\n  interface PhaseMap {\n    resume?: true\n    inertiastart?: true\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    inertia?: InertiaState\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface PerActionDefaults {\n    inertia?: {\n      enabled?: boolean\n      resistance?: number // the lambda in exponential decay\n      minSpeed?: number // target speed must be above this for inertia to start\n      endSpeed?: number // the speed at which inertia is slow enough to stop\n      allowResume?: true // allow resuming an action in inertia phase\n      smoothEndDuration?: number // animate to snap/restrict endOnly if there's no inertia\n    }\n  }\n}\n\ndeclare module '@interactjs/core/scope' {\n  interface SignalArgs {\n    'interactions:before-action-inertiastart': Omit<DoPhaseArg<ActionName, 'inertiastart'>, 'iEvent'>\n    'interactions:action-inertiastart': DoPhaseArg<ActionName, 'inertiastart'>\n    'interactions:after-action-inertiastart': DoPhaseArg<ActionName, 'inertiastart'>\n    'interactions:before-action-resume': Omit<DoPhaseArg<ActionName, 'resume'>, 'iEvent'>\n    'interactions:action-resume': DoPhaseArg<ActionName, 'resume'>\n    'interactions:after-action-resume': DoPhaseArg<ActionName, 'resume'>\n  }\n}\n\nfunction install(scope: Scope) {\n  const { defaults } = scope\n\n  scope.usePlugin(offset)\n  scope.usePlugin(modifiers.default)\n  scope.actions.phases.inertiastart = true\n  scope.actions.phases.resume = true\n\n  defaults.perAction.inertia = {\n    enabled: false,\n    resistance: 10, // the lambda in exponential decay\n    minSpeed: 100, // target speed must be above this for inertia to start\n    endSpeed: 10, // the speed at which inertia is slow enough to stop\n    allowResume: true, // allow resuming an action in inertia phase\n    smoothEndDuration: 300, // animate to snap/restrict endOnly if there's no inertia\n  }\n}\n\nexport class InertiaState {\n  active = false\n  isModified = false\n  smoothEnd = false\n  allowResume = false\n\n  modification!: Modification\n  modifierCount = 0\n  modifierArg!: ModifierArg\n\n  startCoords!: Point\n  t0 = 0\n  v0 = 0\n\n  te = 0\n  targetOffset!: Point\n  modifiedOffset!: Point\n  currentOffset!: Point\n\n  lambda_v0? = 0 // eslint-disable-line camelcase\n  one_ve_v0? = 0 // eslint-disable-line camelcase\n  timeout!: number\n  readonly interaction: Interaction\n\n  constructor(interaction: Interaction) {\n    this.interaction = interaction\n  }\n\n  start(event: PointerEventType) {\n    const { interaction } = this\n    const options = getOptions(interaction)\n\n    if (!options || !options.enabled) {\n      return false\n    }\n\n    const { client: velocityClient } = interaction.coords.velocity\n    const pointerSpeed = hypot(velocityClient.x, velocityClient.y)\n    const modification = this.modification || (this.modification = new Modification(interaction))\n\n    modification.copyFrom(interaction.modification)\n\n    this.t0 = interaction._now()\n    this.allowResume = options.allowResume\n    this.v0 = pointerSpeed\n    this.currentOffset = { x: 0, y: 0 }\n    this.startCoords = interaction.coords.cur.page\n\n    this.modifierArg = modification.fillArg({\n      pageCoords: this.startCoords,\n      preEnd: true,\n      phase: 'inertiastart',\n    })\n\n    const thrown =\n      this.t0 - interaction.coords.cur.timeStamp < 50 &&\n      pointerSpeed > options.minSpeed &&\n      pointerSpeed > options.endSpeed\n\n    if (thrown) {\n      this.startInertia()\n    } else {\n      modification.result = modification.setAll(this.modifierArg)\n\n      if (!modification.result.changed) {\n        return false\n      }\n\n      this.startSmoothEnd()\n    }\n\n    // force modification change\n    interaction.modification.result.rect = null\n\n    // bring inertiastart event to the target coords\n    interaction.offsetBy(this.targetOffset)\n    interaction._doPhase({\n      interaction,\n      event,\n      phase: 'inertiastart',\n    })\n    interaction.offsetBy({ x: -this.targetOffset.x, y: -this.targetOffset.y })\n    // force modification change\n    interaction.modification.result.rect = null\n\n    this.active = true\n    interaction.simulation = this\n\n    return true\n  }\n\n  startInertia() {\n    const startVelocity = this.interaction.coords.velocity.client\n    const options = getOptions(this.interaction)\n    const lambda = options.resistance\n    const inertiaDur = -Math.log(options.endSpeed / this.v0) / lambda\n\n    this.targetOffset = {\n      x: (startVelocity.x - inertiaDur) / lambda,\n      y: (startVelocity.y - inertiaDur) / lambda,\n    }\n\n    this.te = inertiaDur\n    this.lambda_v0 = lambda / this.v0\n    this.one_ve_v0 = 1 - options.endSpeed / this.v0\n\n    const { modification, modifierArg } = this\n\n    modifierArg.pageCoords = {\n      x: this.startCoords.x + this.targetOffset.x,\n      y: this.startCoords.y + this.targetOffset.y,\n    }\n\n    modification.result = modification.setAll(modifierArg)\n\n    if (modification.result.changed) {\n      this.isModified = true\n      this.modifiedOffset = {\n        x: this.targetOffset.x + modification.result.delta.x,\n        y: this.targetOffset.y + modification.result.delta.y,\n      }\n    }\n\n    this.onNextFrame(() => this.inertiaTick())\n  }\n\n  startSmoothEnd() {\n    this.smoothEnd = true\n    this.isModified = true\n    this.targetOffset = {\n      x: this.modification.result.delta.x,\n      y: this.modification.result.delta.y,\n    }\n\n    this.onNextFrame(() => this.smoothEndTick())\n  }\n\n  onNextFrame(tickFn: () => void) {\n    this.timeout = raf.request(() => {\n      if (this.active) {\n        tickFn()\n      }\n    })\n  }\n\n  inertiaTick() {\n    const { interaction } = this\n    const options = getOptions(interaction)\n    const lambda = options.resistance\n    const t = (interaction._now() - this.t0) / 1000\n\n    if (t < this.te) {\n      const progress = 1 - (Math.exp(-lambda * t) - this.lambda_v0) / this.one_ve_v0\n      let newOffset: Point\n\n      if (this.isModified) {\n        newOffset = getQuadraticCurvePoint(\n          0,\n          0,\n          this.targetOffset.x,\n          this.targetOffset.y,\n          this.modifiedOffset.x,\n          this.modifiedOffset.y,\n          progress,\n        )\n      } else {\n        newOffset = {\n          x: this.targetOffset.x * progress,\n          y: this.targetOffset.y * progress,\n        }\n      }\n\n      const delta = { x: newOffset.x - this.currentOffset.x, y: newOffset.y - this.currentOffset.y }\n\n      this.currentOffset.x += delta.x\n      this.currentOffset.y += delta.y\n\n      interaction.offsetBy(delta)\n      interaction.move()\n\n      this.onNextFrame(() => this.inertiaTick())\n    } else {\n      interaction.offsetBy({\n        x: this.modifiedOffset.x - this.currentOffset.x,\n        y: this.modifiedOffset.y - this.currentOffset.y,\n      })\n\n      this.end()\n    }\n  }\n\n  smoothEndTick() {\n    const { interaction } = this\n    const t = interaction._now() - this.t0\n    const { smoothEndDuration: duration } = getOptions(interaction)\n\n    if (t < duration) {\n      const newOffset = {\n        x: easeOutQuad(t, 0, this.targetOffset.x, duration),\n        y: easeOutQuad(t, 0, this.targetOffset.y, duration),\n      }\n      const delta = {\n        x: newOffset.x - this.currentOffset.x,\n        y: newOffset.y - this.currentOffset.y,\n      }\n\n      this.currentOffset.x += delta.x\n      this.currentOffset.y += delta.y\n\n      interaction.offsetBy(delta)\n      interaction.move({ skipModifiers: this.modifierCount })\n\n      this.onNextFrame(() => this.smoothEndTick())\n    } else {\n      interaction.offsetBy({\n        x: this.targetOffset.x - this.currentOffset.x,\n        y: this.targetOffset.y - this.currentOffset.y,\n      })\n\n      this.end()\n    }\n  }\n\n  resume({ pointer, event, eventTarget }: SignalArgs['interactions:down']) {\n    const { interaction } = this\n\n    // undo inertia changes to interaction coords\n    interaction.offsetBy({\n      x: -this.currentOffset.x,\n      y: -this.currentOffset.y,\n    })\n\n    // update pointer at pointer down position\n    interaction.updatePointer(pointer, event, eventTarget, true)\n\n    // fire resume signals and event\n    interaction._doPhase({\n      interaction,\n      event,\n      phase: 'resume',\n    })\n    copyCoords(interaction.coords.prev, interaction.coords.cur)\n\n    this.stop()\n  }\n\n  end() {\n    this.interaction.move()\n    this.interaction.end()\n    this.stop()\n  }\n\n  stop() {\n    this.active = this.smoothEnd = false\n    this.interaction.simulation = null\n    raf.cancel(this.timeout)\n  }\n}\n\nfunction start({ interaction, event }: DoPhaseArg<ActionName, 'end'>) {\n  if (!interaction._interacting || interaction.simulation) {\n    return null\n  }\n\n  const started = interaction.inertia.start(event)\n\n  // prevent action end if inertia or smoothEnd\n  return started ? false : null\n}\n\n// Check if the down event hits the current inertia target\n// control should be return to the user\nfunction resume(arg: SignalArgs['interactions:down']) {\n  const { interaction, eventTarget } = arg\n  const state = interaction.inertia\n\n  if (!state.active) return\n\n  let element = eventTarget as Node\n\n  // climb up the DOM tree from the event target\n  while (is.element(element)) {\n    // if interaction element is the current inertia target element\n    if (element === interaction.element) {\n      state.resume(arg)\n      break\n    }\n\n    element = dom.parentNode(element)\n  }\n}\n\nfunction stop({ interaction }: { interaction: Interaction }) {\n  const state = interaction.inertia\n\n  if (state.active) {\n    state.stop()\n  }\n}\n\nfunction getOptions({ interactable, prepared }: Interaction) {\n  return interactable && interactable.options && prepared.name && interactable.options[prepared.name].inertia\n}\n\nconst inertia: Plugin = {\n  id: 'inertia',\n  before: ['modifiers', 'actions'],\n  install,\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.inertia = new InertiaState(interaction)\n    },\n\n    'interactions:before-action-end': start,\n    'interactions:down': resume,\n    'interactions:stop': stop,\n\n    'interactions:before-action-resume': (arg) => {\n      const { modification } = arg.interaction\n\n      modification.stop(arg)\n      modification.start(arg, arg.interaction.coords.cur.page)\n      modification.applyToInteraction(arg)\n    },\n\n    'interactions:before-action-inertiastart': (arg) => arg.interaction.modification.setAndApply(arg),\n    'interactions:action-resume': modifiers.addEventModifiers,\n    'interactions:action-inertiastart': modifiers.addEventModifiers,\n    'interactions:after-action-inertiastart': (arg) =>\n      arg.interaction.modification.restoreInteractionCoords(arg),\n    'interactions:after-action-resume': (arg) => arg.interaction.modification.restoreInteractionCoords(arg),\n  },\n}\n\n// http://stackoverflow.com/a/5634528/2280888\nfunction _getQBezierValue(t: number, p1: number, p2: number, p3: number) {\n  const iT = 1 - t\n  return iT * iT * p1 + 2 * iT * t * p2 + t * t * p3\n}\n\nfunction getQuadraticCurvePoint(\n  startX: number,\n  startY: number,\n  cpX: number,\n  cpY: number,\n  endX: number,\n  endY: number,\n  position: number,\n) {\n  return {\n    x: _getQBezierValue(position, startX, cpX, endX),\n    y: _getQBezierValue(position, startY, cpY, endY),\n  }\n}\n\n// http://gizma.com/easing/\nfunction easeOutQuad(t: number, b: number, c: number, d: number) {\n  t /= d\n  return -c * t * (t - 2) + b\n}\n\nexport default inertia\n", "import * as arr from '@interactjs/utils/arr'\nimport extend from '@interactjs/utils/extend'\nimport type { NormalizedListeners } from '@interactjs/utils/normalizeListeners'\nimport normalize from '@interactjs/utils/normalizeListeners'\n\nimport type { Listener, ListenersArg, Rect } from '@interactjs/core/types'\n\nfunction fireUntilImmediateStopped(event: any, listeners: Listener[]) {\n  for (const listener of listeners) {\n    if (event.immediatePropagationStopped) {\n      break\n    }\n\n    listener(event)\n  }\n}\n\nexport class Eventable {\n  options: any\n  types: NormalizedListeners = {}\n  propagationStopped = false\n  immediatePropagationStopped = false\n  global: any\n\n  constructor(options?: { [index: string]: any }) {\n    this.options = extend({}, options || {})\n  }\n\n  fire<T extends { type: string; propagationStopped?: boolean }>(event: T) {\n    let listeners: Listener[]\n    const global = this.global\n\n    // Interactable#on() listeners\n    // tslint:disable no-conditional-assignment\n    if ((listeners = this.types[event.type])) {\n      fireUntilImmediateStopped(event, listeners)\n    }\n\n    // interact.on() listeners\n    if (!event.propagationStopped && global && (listeners = global[event.type])) {\n      fireUntilImmediateStopped(event, listeners)\n    }\n  }\n\n  on(type: string, listener: ListenersArg) {\n    const listeners = normalize(type, listener)\n\n    for (type in listeners) {\n      this.types[type] = arr.merge(this.types[type] || [], listeners[type])\n    }\n  }\n\n  off(type: string, listener: ListenersArg) {\n    const listeners = normalize(type, listener)\n\n    for (type in listeners) {\n      const eventList = this.types[type]\n\n      if (!eventList || !eventList.length) {\n        continue\n      }\n\n      for (const subListener of listeners[type]) {\n        const index = eventList.indexOf(subListener)\n\n        if (index !== -1) {\n          eventList.splice(index, 1)\n        }\n      }\n    }\n  }\n\n  getRect(_element: Element): Rect {\n    return null\n  }\n}\n", "import * as arr from '@interactjs/utils/arr'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport is from '@interactjs/utils/is'\nimport pExtend from '@interactjs/utils/pointerExtend'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\n\nimport type { Scope } from '@interactjs/core/scope'\nimport type { Element } from '@interactjs/core/types'\n\nimport type { NativeEventTarget } from './NativeTypes'\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    events: ReturnType<typeof install>\n  }\n}\n\ninterface EventOptions {\n  capture: boolean\n  passive: boolean\n}\n\ntype PartialEventTarget = Partial<NativeEventTarget>\n\ntype ListenerEntry = { func: (event: Event | FakeEvent) => any; options: EventOptions }\n\nfunction install(scope: Scope) {\n  const targets: Array<{\n    eventTarget: PartialEventTarget\n    events: { [type: string]: ListenerEntry[] }\n  }> = []\n\n  const delegatedEvents: {\n    [type: string]: Array<{\n      selector: string\n      context: Node\n      listeners: ListenerEntry[]\n    }>\n  } = {}\n  const documents: Document[] = []\n\n  const eventsMethods = {\n    add,\n    remove,\n\n    addDelegate,\n    removeDelegate,\n\n    delegateListener,\n    delegateUseCapture,\n    delegatedEvents,\n    documents,\n\n    targets,\n\n    supportsOptions: false,\n    supportsPassive: false,\n  }\n\n  // check if browser supports passive events and options arg\n  scope.document?.createElement('div').addEventListener('test', null, {\n    get capture() {\n      return (eventsMethods.supportsOptions = true)\n    },\n    get passive() {\n      return (eventsMethods.supportsPassive = true)\n    },\n  })\n\n  scope.events = eventsMethods\n\n  function add(\n    eventTarget: PartialEventTarget,\n    type: string,\n    listener: ListenerEntry['func'],\n    optionalArg?: boolean | EventOptions,\n  ) {\n    if (!eventTarget.addEventListener) return\n\n    const options = getOptions(optionalArg)\n    let target = arr.find(targets, (t) => t.eventTarget === eventTarget)\n\n    if (!target) {\n      target = {\n        eventTarget,\n        events: {},\n      }\n\n      targets.push(target)\n    }\n\n    if (!target.events[type]) {\n      target.events[type] = []\n    }\n\n    if (!arr.find(target.events[type], (l) => l.func === listener && optionsMatch(l.options, options))) {\n      eventTarget.addEventListener(\n        type,\n        listener as any,\n        eventsMethods.supportsOptions ? options : options.capture,\n      )\n      target.events[type].push({ func: listener, options })\n    }\n  }\n\n  function remove(\n    eventTarget: PartialEventTarget,\n    type: string,\n    listener?: 'all' | ListenerEntry['func'],\n    optionalArg?: boolean | EventOptions,\n  ) {\n    if (!eventTarget.addEventListener || !eventTarget.removeEventListener) return\n\n    const targetIndex = arr.findIndex(targets, (t) => t.eventTarget === eventTarget)\n    const target = targets[targetIndex]\n\n    if (!target || !target.events) {\n      return\n    }\n\n    if (type === 'all') {\n      for (type in target.events) {\n        if (target.events.hasOwnProperty(type)) {\n          remove(eventTarget, type, 'all')\n        }\n      }\n      return\n    }\n\n    let typeIsEmpty = false\n    const typeListeners = target.events[type]\n\n    if (typeListeners) {\n      if (listener === 'all') {\n        for (let i = typeListeners.length - 1; i >= 0; i--) {\n          const entry = typeListeners[i]\n          remove(eventTarget, type, entry.func, entry.options)\n        }\n        return\n      } else {\n        const options = getOptions(optionalArg)\n\n        for (let i = 0; i < typeListeners.length; i++) {\n          const entry = typeListeners[i]\n          if (entry.func === listener && optionsMatch(entry.options, options)) {\n            eventTarget.removeEventListener(\n              type,\n              listener as any,\n              eventsMethods.supportsOptions ? options : options.capture,\n            )\n            typeListeners.splice(i, 1)\n\n            if (typeListeners.length === 0) {\n              delete target.events[type]\n              typeIsEmpty = true\n            }\n\n            break\n          }\n        }\n      }\n    }\n\n    if (typeIsEmpty && !Object.keys(target.events).length) {\n      targets.splice(targetIndex, 1)\n    }\n  }\n\n  function addDelegate(\n    selector: string,\n    context: Node,\n    type: string,\n    listener: ListenerEntry['func'],\n    optionalArg?: any,\n  ) {\n    const options = getOptions(optionalArg)\n    if (!delegatedEvents[type]) {\n      delegatedEvents[type] = []\n\n      // add delegate listener functions\n      for (const doc of documents) {\n        add(doc, type, delegateListener)\n        add(doc, type, delegateUseCapture, true)\n      }\n    }\n\n    const delegates = delegatedEvents[type]\n    let delegate = arr.find(delegates, (d) => d.selector === selector && d.context === context)\n\n    if (!delegate) {\n      delegate = { selector, context, listeners: [] }\n      delegates.push(delegate)\n    }\n\n    delegate.listeners.push({ func: listener, options })\n  }\n\n  function removeDelegate(\n    selector: string,\n    context: Document | Element,\n    type: string,\n    listener?: ListenerEntry['func'],\n    optionalArg?: any,\n  ) {\n    const options = getOptions(optionalArg)\n    const delegates = delegatedEvents[type]\n    let matchFound = false\n    let index: number\n\n    if (!delegates) return\n\n    // count from last index of delegated to 0\n    for (index = delegates.length - 1; index >= 0; index--) {\n      const cur = delegates[index]\n      // look for matching selector and context Node\n      if (cur.selector === selector && cur.context === context) {\n        const { listeners } = cur\n\n        // each item of the listeners array is an array: [function, capture, passive]\n        for (let i = listeners.length - 1; i >= 0; i--) {\n          const entry = listeners[i]\n\n          // check if the listener functions and capture and passive flags match\n          if (entry.func === listener && optionsMatch(entry.options, options)) {\n            // remove the listener from the array of listeners\n            listeners.splice(i, 1)\n\n            // if all listeners for this target have been removed\n            // remove the target from the delegates array\n            if (!listeners.length) {\n              delegates.splice(index, 1)\n\n              // remove delegate function from context\n              remove(context, type, delegateListener)\n              remove(context, type, delegateUseCapture, true)\n            }\n\n            // only remove one listener\n            matchFound = true\n            break\n          }\n        }\n\n        if (matchFound) {\n          break\n        }\n      }\n    }\n  }\n\n  // bound to the interactable context when a DOM event\n  // listener is added to a selector interactable\n  function delegateListener(event: Event | FakeEvent, optionalArg?: any) {\n    const options = getOptions(optionalArg)\n    const fakeEvent = new FakeEvent(event as Event)\n    const delegates = delegatedEvents[event.type]\n    const [eventTarget] = pointerUtils.getEventTargets(event as Event)\n    let element: Node = eventTarget\n\n    // climb up document tree looking for selector matches\n    while (is.element(element)) {\n      for (let i = 0; i < delegates.length; i++) {\n        const cur = delegates[i]\n        const { selector, context } = cur\n\n        if (\n          domUtils.matchesSelector(element, selector) &&\n          domUtils.nodeContains(context, eventTarget) &&\n          domUtils.nodeContains(context, element)\n        ) {\n          const { listeners } = cur\n\n          fakeEvent.currentTarget = element\n\n          for (const entry of listeners) {\n            if (optionsMatch(entry.options, options)) {\n              entry.func(fakeEvent)\n            }\n          }\n        }\n      }\n\n      element = domUtils.parentNode(element)\n    }\n  }\n\n  function delegateUseCapture(this: Element, event: Event | FakeEvent) {\n    return delegateListener.call(this, event, true)\n  }\n\n  // for type inferrence\n  return eventsMethods\n}\n\nclass FakeEvent implements Partial<Event> {\n  currentTarget: Node\n  originalEvent: Event\n  type: string\n\n  constructor(originalEvent: Event) {\n    this.originalEvent = originalEvent\n    // duplicate the event so that currentTarget can be changed\n    pExtend(this, originalEvent)\n  }\n\n  preventOriginalDefault() {\n    this.originalEvent.preventDefault()\n  }\n\n  stopPropagation() {\n    this.originalEvent.stopPropagation()\n  }\n\n  stopImmediatePropagation() {\n    this.originalEvent.stopImmediatePropagation()\n  }\n}\n\nfunction getOptions(param: { [index: string]: any } | boolean): { capture: boolean; passive: boolean } {\n  if (!is.object(param)) {\n    return { capture: !!param, passive: false }\n  }\n\n  return {\n    capture: !!param.capture,\n    passive: !!param.passive,\n  }\n}\n\nfunction optionsMatch(a: Partial<EventOptions> | boolean, b: Partial<EventOptions>) {\n  if (a === b) return true\n\n  if (typeof a === 'boolean') return !!b.capture === a && !!b.passive === false\n\n  return !!a.capture === !!b.capture && !!a.passive === !!b.passive\n}\n\nexport default {\n  id: 'events',\n  install,\n}\n", "import * as dom from '@interactjs/utils/domUtils'\n\nimport type Interaction from '@interactjs/core/Interaction'\nimport type { Scope } from '@interactjs/core/scope'\nimport type { PointerType } from '@interactjs/core/types'\n\nexport interface SearchDetails {\n  pointer: PointerType\n  pointerId: number\n  pointerType: string\n  eventType: string\n  eventTarget: EventTarget\n  curEventTarget: EventTarget\n  scope: Scope\n}\n\nconst finder = {\n  methodOrder: ['simulationResume', 'mouseOrPen', 'hasPointer', 'idle'] as const,\n\n  search(details: SearchDetails) {\n    for (const method of finder.methodOrder) {\n      const interaction = finder[method](details)\n\n      if (interaction) {\n        return interaction\n      }\n    }\n\n    return null\n  },\n\n  // try to resume simulation with a new pointer\n  simulationResume({ pointerType, eventType, eventTarget, scope }: SearchDetails) {\n    if (!/down|start/i.test(eventType)) {\n      return null\n    }\n\n    for (const interaction of scope.interactions.list) {\n      let element = eventTarget as Node\n\n      if (\n        interaction.simulation &&\n        interaction.simulation.allowResume &&\n        interaction.pointerType === pointerType\n      ) {\n        while (element) {\n          // if the element is the interaction element\n          if (element === interaction.element) {\n            return interaction\n          }\n          element = dom.parentNode(element)\n        }\n      }\n    }\n\n    return null\n  },\n\n  // if it's a mouse or pen interaction\n  mouseOrPen({ pointerId, pointerType, eventType, scope }: SearchDetails) {\n    if (pointerType !== 'mouse' && pointerType !== 'pen') {\n      return null\n    }\n\n    let firstNonActive\n\n    for (const interaction of scope.interactions.list) {\n      if (interaction.pointerType === pointerType) {\n        // if it's a down event, skip interactions with running simulations\n        if (interaction.simulation && !hasPointerId(interaction, pointerId)) {\n          continue\n        }\n\n        // if the interaction is active, return it immediately\n        if (interaction.interacting()) {\n          return interaction\n        }\n        // otherwise save it and look for another active interaction\n        else if (!firstNonActive) {\n          firstNonActive = interaction\n        }\n      }\n    }\n\n    // if no active mouse interaction was found use the first inactive mouse\n    // interaction\n    if (firstNonActive) {\n      return firstNonActive\n    }\n\n    // find any mouse or pen interaction.\n    // ignore the interaction if the eventType is a *down, and a simulation\n    // is active\n    for (const interaction of scope.interactions.list) {\n      if (interaction.pointerType === pointerType && !(/down/i.test(eventType) && interaction.simulation)) {\n        return interaction\n      }\n    }\n\n    return null\n  },\n\n  // get interaction that has this pointer\n  hasPointer({ pointerId, scope }: SearchDetails) {\n    for (const interaction of scope.interactions.list) {\n      if (hasPointerId(interaction, pointerId)) {\n        return interaction\n      }\n    }\n\n    return null\n  },\n\n  // get first idle interaction with a matching pointerType\n  idle({ pointerType, scope }: SearchDetails) {\n    for (const interaction of scope.interactions.list) {\n      // if there's already a pointer held down\n      if (interaction.pointers.length === 1) {\n        const target = interaction.interactable\n        // don't add this pointer if there is a target interactable and it\n        // isn't gesturable\n        if (target && !(target.options.gesture && target.options.gesture.enabled)) {\n          continue\n        }\n      }\n      // maximum of 2 pointers per interaction\n      else if (interaction.pointers.length >= 2) {\n        continue\n      }\n\n      if (!interaction.interacting() && pointerType === interaction.pointerType) {\n        return interaction\n      }\n    }\n\n    return null\n  },\n}\n\nfunction hasPointerId(interaction: Interaction, pointerId: number) {\n  return interaction.pointers.some(({ id }) => id === pointerId)\n}\n\nexport default finder\n", "import browser from '@interactjs/utils/browser'\nimport domObjects from '@interactjs/utils/domObjects'\nimport { nodeContains } from '@interactjs/utils/domUtils'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\n\nimport type { Scope, SignalArgs, Plugin } from '@interactjs/core/scope'\nimport type { ActionName, Listener } from '@interactjs/core/types'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './interactablePreventDefault'\nimport interactablePreventDefault from './interactablePreventDefault'\nimport InteractionBase from './Interaction'\n/* eslint-enable import/no-duplicates */\nimport type { SearchDetails } from './interactionFinder'\nimport finder from './interactionFinder'\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    Interaction: typeof InteractionBase\n    interactions: {\n      new: <T extends ActionName>(options: any) => InteractionBase<T>\n      list: Array<InteractionBase<ActionName>>\n      listeners: { [type: string]: Listener }\n      docEvents: Array<{ type: string; listener: Listener }>\n      pointerMoveTolerance: number\n    }\n    prevTouchTime: number\n  }\n\n  interface SignalArgs {\n    'interactions:find': {\n      interaction: InteractionBase\n      searchDetails: SearchDetails\n    }\n  }\n}\n\nconst methodNames = [\n  'pointerDown',\n  'pointerMove',\n  'pointerUp',\n  'updatePointer',\n  'removePointer',\n  'windowBlur',\n]\n\nfunction install(scope: Scope) {\n  const listeners = {} as any\n\n  for (const method of methodNames) {\n    listeners[method] = doOnInteractions(method, scope)\n  }\n\n  const pEventTypes = browser.pEventTypes\n  let docEvents: typeof scope.interactions.docEvents\n\n  if (domObjects.PointerEvent) {\n    docEvents = [\n      { type: pEventTypes.down, listener: releasePointersOnRemovedEls },\n      { type: pEventTypes.down, listener: listeners.pointerDown },\n      { type: pEventTypes.move, listener: listeners.pointerMove },\n      { type: pEventTypes.up, listener: listeners.pointerUp },\n      { type: pEventTypes.cancel, listener: listeners.pointerUp },\n    ]\n  } else {\n    docEvents = [\n      { type: 'mousedown', listener: listeners.pointerDown },\n      { type: 'mousemove', listener: listeners.pointerMove },\n      { type: 'mouseup', listener: listeners.pointerUp },\n\n      { type: 'touchstart', listener: releasePointersOnRemovedEls },\n      { type: 'touchstart', listener: listeners.pointerDown },\n      { type: 'touchmove', listener: listeners.pointerMove },\n      { type: 'touchend', listener: listeners.pointerUp },\n      { type: 'touchcancel', listener: listeners.pointerUp },\n    ]\n  }\n\n  docEvents.push({\n    type: 'blur',\n    listener(event) {\n      for (const interaction of scope.interactions.list) {\n        interaction.documentBlur(event)\n      }\n    },\n  })\n\n  // for ignoring browser's simulated mouse events\n  scope.prevTouchTime = 0\n\n  scope.Interaction = class<T extends ActionName> extends InteractionBase<T> {\n    get pointerMoveTolerance() {\n      return scope.interactions.pointerMoveTolerance\n    }\n\n    set pointerMoveTolerance(value) {\n      scope.interactions.pointerMoveTolerance = value\n    }\n\n    _now() {\n      return scope.now()\n    }\n  }\n\n  scope.interactions = {\n    // all active and idle interactions\n    list: [],\n    new<T extends ActionName>(options: { pointerType?: string; scopeFire?: Scope['fire'] }) {\n      options.scopeFire = (name, arg) => scope.fire(name, arg)\n\n      const interaction = new scope.Interaction<T>(options as Required<typeof options>)\n\n      scope.interactions.list.push(interaction)\n      return interaction\n    },\n    listeners,\n    docEvents,\n    pointerMoveTolerance: 1,\n  }\n\n  function releasePointersOnRemovedEls() {\n    // for all inactive touch interactions with pointers down\n    for (const interaction of scope.interactions.list) {\n      if (!interaction.pointerIsDown || interaction.pointerType !== 'touch' || interaction._interacting) {\n        continue\n      }\n\n      // if a pointer is down on an element that is no longer in the DOM tree\n      for (const pointer of interaction.pointers) {\n        if (!scope.documents.some(({ doc }) => nodeContains(doc, pointer.downTarget))) {\n          // remove the pointer from the interaction\n          interaction.removePointer(pointer.pointer, pointer.event)\n        }\n      }\n    }\n  }\n\n  scope.usePlugin(interactablePreventDefault)\n}\n\nfunction doOnInteractions(method: string, scope: Scope) {\n  return function (event: Event) {\n    const interactions = scope.interactions.list\n\n    const pointerType = pointerUtils.getPointerType(event)\n    const [eventTarget, curEventTarget] = pointerUtils.getEventTargets(event)\n    const matches: any[] = [] // [ [pointer, interaction], ...]\n\n    if (/^touch/.test(event.type)) {\n      scope.prevTouchTime = scope.now()\n\n      // @ts-expect-error\n      for (const changedTouch of event.changedTouches) {\n        const pointer = changedTouch\n        const pointerId = pointerUtils.getPointerId(pointer)\n        const searchDetails: SearchDetails = {\n          pointer,\n          pointerId,\n          pointerType,\n          eventType: event.type,\n          eventTarget,\n          curEventTarget,\n          scope,\n        }\n        const interaction = getInteraction(searchDetails)\n\n        matches.push([\n          searchDetails.pointer,\n          searchDetails.eventTarget,\n          searchDetails.curEventTarget,\n          interaction,\n        ])\n      }\n    } else {\n      let invalidPointer = false\n\n      if (!browser.supportsPointerEvent && /mouse/.test(event.type)) {\n        // ignore mouse events while touch interactions are active\n        for (let i = 0; i < interactions.length && !invalidPointer; i++) {\n          invalidPointer = interactions[i].pointerType !== 'mouse' && interactions[i].pointerIsDown\n        }\n\n        // try to ignore mouse events that are simulated by the browser\n        // after a touch event\n        invalidPointer =\n          invalidPointer ||\n          scope.now() - scope.prevTouchTime < 500 ||\n          // on iOS and Firefox Mobile, MouseEvent.timeStamp is zero if simulated\n          event.timeStamp === 0\n      }\n\n      if (!invalidPointer) {\n        const searchDetails = {\n          pointer: event as PointerEvent,\n          pointerId: pointerUtils.getPointerId(event as PointerEvent),\n          pointerType,\n          eventType: event.type,\n          curEventTarget,\n          eventTarget,\n          scope,\n        }\n\n        const interaction = getInteraction(searchDetails)\n\n        matches.push([\n          searchDetails.pointer,\n          searchDetails.eventTarget,\n          searchDetails.curEventTarget,\n          interaction,\n        ])\n      }\n    }\n\n    // eslint-disable-next-line no-shadow\n    for (const [pointer, eventTarget, curEventTarget, interaction] of matches) {\n      interaction[method](pointer, event, eventTarget, curEventTarget)\n    }\n  }\n}\n\nfunction getInteraction(searchDetails: SearchDetails) {\n  const { pointerType, scope } = searchDetails\n\n  const foundInteraction = finder.search(searchDetails)\n  const signalArg = { interaction: foundInteraction, searchDetails }\n\n  scope.fire('interactions:find', signalArg)\n\n  return signalArg.interaction || scope.interactions.new({ pointerType })\n}\n\nfunction onDocSignal<T extends 'scope:add-document' | 'scope:remove-document'>(\n  { doc, scope, options }: SignalArgs[T],\n  eventMethodName: 'add' | 'remove',\n) {\n  const {\n    interactions: { docEvents },\n    events,\n  } = scope\n  const eventMethod = events[eventMethodName]\n\n  if (scope.browser.isIOS && !options.events) {\n    options.events = { passive: false }\n  }\n\n  // delegate event listener\n  for (const eventType in events.delegatedEvents) {\n    eventMethod(doc, eventType, events.delegateListener)\n    eventMethod(doc, eventType, events.delegateUseCapture, true)\n  }\n\n  const eventOptions = options && options.events\n\n  for (const { type, listener } of docEvents) {\n    eventMethod(doc, type, listener, eventOptions)\n  }\n}\n\nconst interactions: Plugin = {\n  id: 'core/interactions',\n  install,\n  listeners: {\n    'scope:add-document': (arg) => onDocSignal(arg, 'add'),\n    'scope:remove-document': (arg) => onDocSignal(arg, 'remove'),\n    'interactable:unset': ({ interactable }, scope) => {\n      // Stop and destroy related interactions when an Interactable is unset\n      for (let i = scope.interactions.list.length - 1; i >= 0; i--) {\n        const interaction = scope.interactions.list[i]\n\n        if (interaction.interactable !== interactable) {\n          continue\n        }\n\n        interaction.stop()\n        scope.fire('interactions:destroy', { interaction })\n        interaction.destroy()\n\n        if (scope.interactions.list.length > 2) {\n          scope.interactions.list.splice(i, 1)\n        }\n      }\n    },\n  },\n  onDocSignal,\n  doOnInteractions,\n  methodNames,\n}\n\nexport default interactions\n", "/* eslint-disable no-dupe-class-members */\nimport * as arr from '@interactjs/utils/arr'\nimport browser from '@interactjs/utils/browser'\nimport clone from '@interactjs/utils/clone'\nimport { getElementRect, matchesUpTo, nodeContains, trySelector } from '@interactjs/utils/domUtils'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport isNonNativeEvent from '@interactjs/utils/isNonNativeEvent'\nimport normalizeListeners from '@interactjs/utils/normalizeListeners'\nimport { getWindow } from '@interactjs/utils/window'\n\nimport type { Scope } from '@interactjs/core/scope'\nimport type {\n  ActionMap,\n  ActionMethod,\n  ActionName,\n  Actions,\n  Context,\n  Element,\n  EventTypes,\n  Listeners,\n  ListenersArg,\n  OrBoolean,\n  Target,\n} from '@interactjs/core/types'\n\nimport { Eventable } from './Eventable'\nimport type { ActionDefaults, Defaults, OptionsArg, PerActionDefaults, Options } from './options'\n\ntype IgnoreValue = string | Element | boolean\ntype DeltaSource = 'page' | 'client'\n\nconst enum OnOffMethod {\n  On,\n  Off,\n}\n\n/**\n * ```ts\n * const interactable = interact('.cards')\n *   .draggable({\n *     listeners: { move: event => console.log(event.type, event.pageX, event.pageY) }\n *   })\n *   .resizable({\n *     listeners: { move: event => console.log(event.rect) },\n *     modifiers: [interact.modifiers.restrictEdges({ outer: 'parent' })]\n *   })\n * ```\n */\nexport class Interactable implements Partial<Eventable> {\n  /** @internal */ get _defaults(): Defaults {\n    return {\n      base: {},\n      perAction: {},\n      actions: {} as ActionDefaults,\n    }\n  }\n\n  readonly target: Target\n  /** @internal */ readonly options!: Required<Options>\n  /** @internal */ readonly _actions: Actions\n  /** @internal */ readonly events = new Eventable()\n  /** @internal */ readonly _context: Context\n  /** @internal */ readonly _win: Window\n  /** @internal */ readonly _doc: Document\n  /** @internal */ readonly _scopeEvents: Scope['events']\n\n  constructor(\n    target: Target,\n    options: any,\n    defaultContext: Document | Element,\n    scopeEvents: Scope['events'],\n  ) {\n    this._actions = options.actions\n    this.target = target\n    this._context = options.context || defaultContext\n    this._win = getWindow(trySelector(target) ? this._context : target)\n    this._doc = this._win.document\n    this._scopeEvents = scopeEvents\n\n    this.set(options)\n  }\n\n  setOnEvents(actionName: ActionName, phases: NonNullable<any>) {\n    if (is.func(phases.onstart)) {\n      this.on(`${actionName}start`, phases.onstart)\n    }\n    if (is.func(phases.onmove)) {\n      this.on(`${actionName}move`, phases.onmove)\n    }\n    if (is.func(phases.onend)) {\n      this.on(`${actionName}end`, phases.onend)\n    }\n    if (is.func(phases.oninertiastart)) {\n      this.on(`${actionName}inertiastart`, phases.oninertiastart)\n    }\n\n    return this\n  }\n\n  updatePerActionListeners(actionName: ActionName, prev: Listeners | undefined, cur: Listeners | undefined) {\n    const actionFilter = (this._actions.map[actionName] as { filterEventType?: (type: string) => boolean })\n      ?.filterEventType\n    const filter = (type: string) =>\n      (actionFilter == null || actionFilter(type)) && isNonNativeEvent(type, this._actions)\n\n    if (is.array(prev) || is.object(prev)) {\n      this._onOff(OnOffMethod.Off, actionName, prev, undefined, filter)\n    }\n\n    if (is.array(cur) || is.object(cur)) {\n      this._onOff(OnOffMethod.On, actionName, cur, undefined, filter)\n    }\n  }\n\n  setPerAction(actionName: ActionName, options: OrBoolean<Options>) {\n    const defaults = this._defaults\n\n    // for all the default per-action options\n    for (const optionName_ in options) {\n      const optionName = optionName_ as keyof PerActionDefaults\n      const actionOptions = this.options[actionName]\n      const optionValue: any = options[optionName]\n\n      // remove old event listeners and add new ones\n      if (optionName === 'listeners') {\n        this.updatePerActionListeners(actionName, actionOptions.listeners, optionValue as Listeners)\n      }\n\n      // if the option value is an array\n      if (is.array(optionValue)) {\n        ;(actionOptions[optionName] as any) = arr.from(optionValue)\n      }\n      // if the option value is an object\n      else if (is.plainObject(optionValue)) {\n        // copy the object\n        ;(actionOptions[optionName] as any) = extend(\n          actionOptions[optionName] || ({} as any),\n          clone(optionValue),\n        )\n\n        // set anabled field to true if it exists in the defaults\n        if (\n          is.object(defaults.perAction[optionName]) &&\n          'enabled' in (defaults.perAction[optionName] as any)\n        ) {\n          ;(actionOptions[optionName] as any).enabled = optionValue.enabled !== false\n        }\n      }\n      // if the option value is a boolean and the default is an object\n      else if (is.bool(optionValue) && is.object(defaults.perAction[optionName])) {\n        ;(actionOptions[optionName] as any).enabled = optionValue\n      }\n      // if it's anything else, do a plain assignment\n      else {\n        ;(actionOptions[optionName] as any) = optionValue\n      }\n    }\n  }\n\n  /**\n   * The default function to get an Interactables bounding rect. Can be\n   * overridden using {@link Interactable.rectChecker}.\n   *\n   * @param {Element} [element] The element to measure.\n   * @return {Rect} The object's bounding rectangle.\n   */\n  getRect(element: Element) {\n    element = element || (is.element(this.target) ? this.target : null)\n\n    if (is.string(this.target)) {\n      element = element || this._context.querySelector(this.target)\n    }\n\n    return getElementRect(element)\n  }\n\n  /**\n   * Returns or sets the function used to calculate the interactable's\n   * element's rectangle\n   *\n   * @param {function} [checker] A function which returns this Interactable's\n   * bounding rectangle. See {@link Interactable.getRect}\n   * @return {function | object} The checker function or this Interactable\n   */\n  rectChecker(): (element: Element) => any | null\n  rectChecker(checker: (element: Element) => any): this\n  rectChecker(checker?: (element: Element) => any) {\n    if (is.func(checker)) {\n      this.getRect = (element) => {\n        const rect = extend({}, checker.apply(this, element))\n\n        if (!(('width' in rect) as unknown)) {\n          rect.width = rect.right - rect.left\n          rect.height = rect.bottom - rect.top\n        }\n\n        return rect\n      }\n\n      return this\n    }\n\n    if (checker === null) {\n      delete (this as Partial<typeof this>).getRect\n\n      return this\n    }\n\n    return this.getRect\n  }\n\n  /** @internal */\n  _backCompatOption(optionName: keyof Options, newValue: any) {\n    if (trySelector(newValue) || is.object(newValue)) {\n      ;(this.options[optionName] as any) = newValue\n\n      for (const action in this._actions.map) {\n        ;(this.options[action as keyof ActionMap] as any)[optionName] = newValue\n      }\n\n      return this\n    }\n\n    return this.options[optionName]\n  }\n\n  /**\n   * Gets or sets the origin of the Interactable's element.  The x and y\n   * of the origin will be subtracted from action event coordinates.\n   *\n   * @param {Element | object | string} [origin] An HTML or SVG Element whose\n   * rect will be used, an object eg. { x: 0, y: 0 } or string 'parent', 'self'\n   * or any CSS selector\n   *\n   * @return {object} The current origin or this Interactable\n   */\n  origin(newValue: any) {\n    return this._backCompatOption('origin', newValue)\n  }\n\n  /**\n   * Returns or sets the mouse coordinate types used to calculate the\n   * movement of the pointer.\n   *\n   * @param {string} [newValue] Use 'client' if you will be scrolling while\n   * interacting; Use 'page' if you want autoScroll to work\n   * @return {string | object} The current deltaSource or this Interactable\n   */\n  deltaSource(): DeltaSource\n  deltaSource(newValue: DeltaSource): this\n  deltaSource(newValue?: DeltaSource) {\n    if (newValue === 'page' || newValue === 'client') {\n      this.options.deltaSource = newValue\n\n      return this\n    }\n\n    return this.options.deltaSource\n  }\n\n  /** @internal */\n  getAllElements(): Element[] {\n    const { target } = this\n\n    if (is.string(target)) {\n      return Array.from(this._context.querySelectorAll(target))\n    }\n\n    if (is.func(target) && (target as any).getAllElements) {\n      return (target as any).getAllElements()\n    }\n\n    return is.element(target) ? [target] : []\n  }\n\n  /**\n   * Gets the selector context Node of the Interactable. The default is\n   * `window.document`.\n   *\n   * @return {Node} The context Node of this Interactable\n   */\n  context() {\n    return this._context\n  }\n\n  inContext(element: Document | Node) {\n    return this._context === element.ownerDocument || nodeContains(this._context, element)\n  }\n\n  /** @internal */\n  testIgnoreAllow(\n    this: Interactable,\n    options: { ignoreFrom?: IgnoreValue; allowFrom?: IgnoreValue },\n    targetNode: Node,\n    eventTarget: Node,\n  ) {\n    return (\n      !this.testIgnore(options.ignoreFrom, targetNode, eventTarget) &&\n      this.testAllow(options.allowFrom, targetNode, eventTarget)\n    )\n  }\n\n  /** @internal */\n  testAllow(this: Interactable, allowFrom: IgnoreValue | undefined, targetNode: Node, element: Node) {\n    if (!allowFrom) {\n      return true\n    }\n\n    if (!is.element(element)) {\n      return false\n    }\n\n    if (is.string(allowFrom)) {\n      return matchesUpTo(element, allowFrom, targetNode)\n    } else if (is.element(allowFrom)) {\n      return nodeContains(allowFrom, element)\n    }\n\n    return false\n  }\n\n  /** @internal */\n  testIgnore(this: Interactable, ignoreFrom: IgnoreValue | undefined, targetNode: Node, element: Node) {\n    if (!ignoreFrom || !is.element(element)) {\n      return false\n    }\n\n    if (is.string(ignoreFrom)) {\n      return matchesUpTo(element, ignoreFrom, targetNode)\n    } else if (is.element(ignoreFrom)) {\n      return nodeContains(ignoreFrom, element)\n    }\n\n    return false\n  }\n\n  /**\n   * Calls listeners for the given InteractEvent type bound globally\n   * and directly to this Interactable\n   *\n   * @param {InteractEvent} iEvent The InteractEvent object to be fired on this\n   * Interactable\n   * @return {Interactable} this Interactable\n   */\n  fire<E extends { type: string }>(iEvent: E) {\n    this.events.fire(iEvent)\n\n    return this\n  }\n\n  /** @internal */\n  _onOff(\n    method: OnOffMethod,\n    typeArg: EventTypes,\n    listenerArg?: ListenersArg | null,\n    options?: any,\n    filter?: (type: string) => boolean,\n  ) {\n    if (is.object(typeArg) && !is.array(typeArg)) {\n      options = listenerArg\n      listenerArg = null\n    }\n\n    const listeners = normalizeListeners(typeArg, listenerArg, filter)\n\n    for (let type in listeners) {\n      if (type === 'wheel') {\n        type = browser.wheelEvent\n      }\n\n      for (const listener of listeners[type]) {\n        // if it is an action event type\n        if (isNonNativeEvent(type, this._actions)) {\n          this.events[method === OnOffMethod.On ? 'on' : 'off'](type, listener)\n        }\n        // delegated event\n        else if (is.string(this.target)) {\n          this._scopeEvents[method === OnOffMethod.On ? 'addDelegate' : 'removeDelegate'](\n            this.target,\n            this._context,\n            type,\n            listener,\n            options,\n          )\n        }\n        // remove listener from this Interactable's element\n        else {\n          this._scopeEvents[method === OnOffMethod.On ? 'add' : 'remove'](\n            this.target,\n            type,\n            listener,\n            options,\n          )\n        }\n      }\n    }\n\n    return this\n  }\n\n  /**\n   * Binds a listener for an InteractEvent, pointerEvent or DOM event.\n   *\n   * @param {string | array | object} types The types of events to listen\n   * for\n   * @param {function | array | object} [listener] The event listener function(s)\n   * @param {object | boolean} [options] options object or useCapture flag for\n   * addEventListener\n   * @return {Interactable} This Interactable\n   */\n  on(types: EventTypes, listener?: ListenersArg, options?: any) {\n    return this._onOff(OnOffMethod.On, types, listener, options)\n  }\n\n  /**\n   * Removes an InteractEvent, pointerEvent or DOM event listener.\n   *\n   * @param {string | array | object} types The types of events that were\n   * listened for\n   * @param {function | array | object} [listener] The event listener function(s)\n   * @param {object | boolean} [options] options object or useCapture flag for\n   * removeEventListener\n   * @return {Interactable} This Interactable\n   */\n  off(types: string | string[] | EventTypes, listener?: ListenersArg, options?: any) {\n    return this._onOff(OnOffMethod.Off, types, listener, options)\n  }\n\n  /**\n   * Reset the options of this Interactable\n   *\n   * @param {object} options The new settings to apply\n   * @return {object} This Interactable\n   */\n  set(options: OptionsArg) {\n    const defaults = this._defaults\n\n    if (!is.object(options)) {\n      options = {}\n    }\n\n    ;(this.options as Required<Options>) = clone(defaults.base) as Required<Options>\n\n    for (const actionName_ in this._actions.methodDict) {\n      const actionName = actionName_ as ActionName\n      const methodName = this._actions.methodDict[actionName]\n\n      this.options[actionName] = {}\n      this.setPerAction(actionName, extend(extend({}, defaults.perAction), defaults.actions[actionName]))\n      ;(this[methodName] as ActionMethod<unknown>)(options[actionName])\n    }\n\n    for (const setting in options) {\n      if (setting === 'getRect') {\n        this.rectChecker(options.getRect)\n        continue\n      }\n\n      if (is.func((this as any)[setting])) {\n        ;(this as any)[setting](options[setting as keyof typeof options])\n      }\n    }\n\n    return this\n  }\n\n  /**\n   * Remove this interactable from the list of interactables and remove it's\n   * action capabilities and event listeners\n   */\n  unset() {\n    if (is.string(this.target)) {\n      // remove delegated events\n      for (const type in this._scopeEvents.delegatedEvents) {\n        const delegated = this._scopeEvents.delegatedEvents[type]\n\n        for (let i = delegated.length - 1; i >= 0; i--) {\n          const { selector, context, listeners } = delegated[i]\n\n          if (selector === this.target && context === this._context) {\n            delegated.splice(i, 1)\n          }\n\n          for (let l = listeners.length - 1; l >= 0; l--) {\n            this._scopeEvents.removeDelegate(\n              this.target,\n              this._context,\n              type,\n              listeners[l][0],\n              listeners[l][1],\n            )\n          }\n        }\n      }\n    } else {\n      this._scopeEvents.remove(this.target, 'all')\n    }\n  }\n}\n", "import * as arr from '@interactjs/utils/arr'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\n\nimport type { Interactable } from '@interactjs/core/Interactable'\nimport type { OptionsArg, Options } from '@interactjs/core/options'\nimport type { Scope } from '@interactjs/core/scope'\nimport type { Target } from '@interactjs/core/types'\n\ndeclare module '@interactjs/core/scope' {\n  interface SignalArgs {\n    'interactable:new': {\n      interactable: Interactable\n      target: Target\n      options: OptionsArg\n      win: Window\n    }\n  }\n}\n\nexport class InteractableSet {\n  // all set interactables\n  list: Interactable[] = []\n\n  selectorMap: {\n    [selector: string]: Interactable[]\n  } = {}\n\n  scope: Scope\n\n  constructor(scope: Scope) {\n    this.scope = scope\n    scope.addListeners({\n      'interactable:unset': ({ interactable }) => {\n        const { target } = interactable\n        const interactablesOnTarget: Interactable[] = is.string(target)\n          ? this.selectorMap[target]\n          : (target as any)[this.scope.id]\n\n        const targetIndex = arr.findIndex(interactablesOnTarget, (i) => i === interactable)\n        interactablesOnTarget.splice(targetIndex, 1)\n      },\n    })\n  }\n\n  new(target: Target, options?: any): Interactable {\n    options = extend(options || {}, {\n      actions: this.scope.actions,\n    })\n    const interactable = new this.scope.Interactable(target, options, this.scope.document, this.scope.events)\n\n    this.scope.addDocument(interactable._doc)\n    this.list.push(interactable)\n\n    if (is.string(target)) {\n      if (!this.selectorMap[target]) {\n        this.selectorMap[target] = []\n      }\n      this.selectorMap[target].push(interactable)\n    } else {\n      if (!(interactable.target as any)[this.scope.id]) {\n        Object.defineProperty(target, this.scope.id, {\n          value: [],\n          configurable: true,\n        })\n      }\n\n      ;(target as any)[this.scope.id].push(interactable)\n    }\n\n    this.scope.fire('interactable:new', {\n      target,\n      options,\n      interactable,\n      win: this.scope._win,\n    })\n\n    return interactable\n  }\n\n  getExisting(target: Target, options?: Options) {\n    const context = (options && options.context) || this.scope.document\n    const isSelector = is.string(target)\n    const interactablesOnTarget: Interactable[] = isSelector\n      ? this.selectorMap[target as string]\n      : (target as any)[this.scope.id]\n\n    if (!interactablesOnTarget) return undefined\n\n    return arr.find(\n      interactablesOnTarget,\n      (interactable) =>\n        interactable._context === context && (isSelector || interactable.inContext(target as any)),\n    )\n  }\n\n  forEachMatch<T>(node: Node, callback: (interactable: Interactable) => T): T | void {\n    for (const interactable of this.list) {\n      let ret: T\n\n      if (\n        (is.string(interactable.target)\n          ? // target is a selector and the element matches\n            is.element(node) && domUtils.matchesSelector(node, interactable.target)\n          : // target is the element\n            node === interactable.target) &&\n        // the element is in context\n        interactable.inContext(node)\n      ) {\n        ret = callback(interactable)\n      }\n\n      if (ret !== undefined) {\n        return ret\n      }\n    }\n  }\n}\n", "import browser from '@interactjs/utils/browser'\nimport clone from '@interactjs/utils/clone'\nimport domObjects from '@interactjs/utils/domObjects'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport raf from '@interactjs/utils/raf'\nimport * as win from '@interactjs/utils/window'\n\nimport type Interaction from '@interactjs/core/Interaction'\n\nimport { Eventable } from './Eventable'\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './events'\nimport './interactions'\nimport events from './events'\nimport { Interactable as InteractableBase } from './Interactable'\nimport { InteractableSet } from './InteractableSet'\nimport { InteractEvent } from './InteractEvent'\nimport interactions from './interactions'\n/* eslint-enable import/no-duplicates */\nimport { createInteractStatic } from './InteractStatic'\nimport type { OptionsArg } from './options'\nimport { defaults } from './options'\nimport type { Actions } from './types'\n\nexport interface SignalArgs {\n  'scope:add-document': DocSignalArg\n  'scope:remove-document': DocSignalArg\n  'interactable:unset': { interactable: InteractableBase }\n  'interactable:set': { interactable: InteractableBase; options: OptionsArg }\n  'interactions:destroy': { interaction: Interaction }\n}\n\nexport type ListenerName = keyof SignalArgs\n\nexport type ListenerMap = {\n  [P in ListenerName]?: (arg: SignalArgs[P], scope: Scope, signalName: P) => void | boolean\n}\n\ninterface DocSignalArg {\n  doc: Document\n  window: Window\n  scope: Scope\n  options: Record<string, any>\n}\n\nexport interface Plugin {\n  [key: string]: any\n  id?: string\n  listeners?: ListenerMap\n  before?: string[]\n  install?(scope: Scope, options?: any): void\n}\n\n/** @internal */\nexport class Scope {\n  id = `__interact_scope_${Math.floor(Math.random() * 100)}`\n  isInitialized = false\n  listenerMaps: Array<{\n    map: ListenerMap\n    id?: string\n  }> = []\n\n  browser = browser\n  defaults = clone(defaults) as typeof defaults\n  Eventable = Eventable\n  actions: Actions = {\n    map: {},\n    phases: {\n      start: true,\n      move: true,\n      end: true,\n    },\n    methodDict: {} as any,\n    phaselessTypes: {},\n  }\n\n  interactStatic = createInteractStatic(this)\n  InteractEvent = InteractEvent\n  Interactable: typeof InteractableBase\n  interactables = new InteractableSet(this)\n\n  // main window\n  _win!: Window\n\n  // main document\n  document!: Document\n\n  // main window\n  window!: Window\n\n  // all documents being listened to\n  documents: Array<{ doc: Document; options: any }> = []\n\n  _plugins: {\n    list: Plugin[]\n    map: { [id: string]: Plugin }\n  } = {\n    list: [],\n    map: {},\n  }\n\n  constructor() {\n    const scope = this\n\n    this.Interactable = class extends InteractableBase {\n      get _defaults() {\n        return scope.defaults\n      }\n\n      set<T extends InteractableBase>(this: T, options: OptionsArg) {\n        super.set(options)\n\n        scope.fire('interactable:set', {\n          options,\n          interactable: this,\n        })\n\n        return this\n      }\n\n      unset(this: InteractableBase) {\n        super.unset()\n\n        const index = scope.interactables.list.indexOf(this)\n        if (index < 0) return\n\n        scope.interactables.list.splice(index, 1)\n        scope.fire('interactable:unset', { interactable: this })\n      }\n    }\n  }\n\n  addListeners(map: ListenerMap, id?: string) {\n    this.listenerMaps.push({ id, map })\n  }\n\n  fire<T extends ListenerName>(name: T, arg: SignalArgs[T]): void | false {\n    for (const {\n      map: { [name]: listener },\n    } of this.listenerMaps) {\n      if (!!listener && listener(arg as any, this, name as never) === false) {\n        return false\n      }\n    }\n  }\n\n  onWindowUnload = (event: BeforeUnloadEvent) => this.removeDocument(event.target as Document)\n\n  init(window: Window | typeof globalThis) {\n    return this.isInitialized ? this : initScope(this, window)\n  }\n\n  pluginIsInstalled(plugin: Plugin) {\n    const { id } = plugin\n    return id ? !!this._plugins.map[id] : this._plugins.list.indexOf(plugin) !== -1\n  }\n\n  usePlugin(plugin: Plugin, options?: { [key: string]: any }) {\n    if (!this.isInitialized) {\n      return this\n    }\n\n    if (this.pluginIsInstalled(plugin)) {\n      return this\n    }\n\n    if (plugin.id) {\n      this._plugins.map[plugin.id] = plugin\n    }\n    this._plugins.list.push(plugin)\n\n    if (plugin.install) {\n      plugin.install(this, options)\n    }\n\n    if (plugin.listeners && plugin.before) {\n      let index = 0\n      const len = this.listenerMaps.length\n      const before = plugin.before.reduce((acc, id) => {\n        acc[id] = true\n        acc[pluginIdRoot(id)] = true\n        return acc\n      }, {})\n\n      for (; index < len; index++) {\n        const otherId = this.listenerMaps[index].id\n\n        if (otherId && (before[otherId] || before[pluginIdRoot(otherId)])) {\n          break\n        }\n      }\n\n      this.listenerMaps.splice(index, 0, { id: plugin.id, map: plugin.listeners })\n    } else if (plugin.listeners) {\n      this.listenerMaps.push({ id: plugin.id, map: plugin.listeners })\n    }\n\n    return this\n  }\n\n  addDocument(doc: Document, options?: any): void | false {\n    // do nothing if document is already known\n    if (this.getDocIndex(doc) !== -1) {\n      return false\n    }\n\n    const window = win.getWindow(doc)\n\n    options = options ? extend({}, options) : {}\n\n    this.documents.push({ doc, options })\n    this.events.documents.push(doc)\n\n    // don't add an unload event for the main document\n    // so that the page may be cached in browser history\n    if (doc !== this.document) {\n      this.events.add(window, 'unload', this.onWindowUnload)\n    }\n\n    this.fire('scope:add-document', { doc, window, scope: this, options })\n  }\n\n  removeDocument(doc: Document) {\n    const index = this.getDocIndex(doc)\n\n    const window = win.getWindow(doc)\n    const options = this.documents[index].options\n\n    this.events.remove(window, 'unload', this.onWindowUnload)\n\n    this.documents.splice(index, 1)\n    this.events.documents.splice(index, 1)\n\n    this.fire('scope:remove-document', { doc, window, scope: this, options })\n  }\n\n  getDocIndex(doc: Document) {\n    for (let i = 0; i < this.documents.length; i++) {\n      if (this.documents[i].doc === doc) {\n        return i\n      }\n    }\n\n    return -1\n  }\n\n  getDocOptions(doc: Document) {\n    const docIndex = this.getDocIndex(doc)\n\n    return docIndex === -1 ? null : this.documents[docIndex].options\n  }\n\n  now() {\n    return (((this.window as any).Date as typeof Date) || Date).now()\n  }\n}\n\n// Keep Scope class internal, but expose minimal interface to avoid broken types when Scope is stripped out\nexport interface Scope {\n  fire<T extends ListenerName>(name: T, arg: SignalArgs[T]): void | false\n}\n\n/** @internal */\nexport function initScope(scope: Scope, window: Window | typeof globalThis) {\n  scope.isInitialized = true\n\n  if (is.window(window)) {\n    win.init(window)\n  }\n\n  domObjects.init(window)\n  browser.init(window)\n  raf.init(window)\n\n  // @ts-expect-error\n  scope.window = window\n  scope.document = window.document\n\n  scope.usePlugin(interactions)\n  scope.usePlugin(events)\n\n  return scope\n}\n\nfunction pluginIdRoot(id: string) {\n  return id && id.replace(/\\/.*$/, '')\n}\n", "import browser from '@interactjs/utils/browser'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport is from '@interactjs/utils/is'\nimport isNonNativeEvent from '@interactjs/utils/isNonNativeEvent'\nimport { warnOnce } from '@interactjs/utils/misc'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\n\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { Context, EventTypes, Listener, ListenersArg, Target } from '@interactjs/core/types'\n\nimport type { Interactable } from './Interactable'\nimport type { Options } from './options'\n\n/**\n * ```js\n * interact('#draggable').draggable(true)\n *\n * var rectables = interact('rect')\n * rectables\n *   .gesturable(true)\n *   .on('gesturemove', function (event) {\n *       // ...\n *   })\n * ```\n *\n * The methods of this variable can be used to set elements as interactables\n * and also to change various default settings.\n *\n * Calling it as a function and passing an element or a valid CSS selector\n * string returns an Interactable object which has various methods to configure\n * it.\n *\n * @param {Element | string} target The HTML or SVG Element to interact with\n * or CSS selector\n * @return {Interactable}\n */\nexport interface InteractStatic {\n  (target: Target, options?: Options): Interactable\n  getPointerAverage: typeof pointerUtils.pointerAverage\n  getTouchBBox: typeof pointerUtils.touchBBox\n  getTouchDistance: typeof pointerUtils.touchDistance\n  getTouchAngle: typeof pointerUtils.touchAngle\n  getElementRect: typeof domUtils.getElementRect\n  getElementClientRect: typeof domUtils.getElementClientRect\n  matchesSelector: typeof domUtils.matchesSelector\n  closest: typeof domUtils.closest\n  /** @internal */ globalEvents: any\n  version: string\n  /** @internal */ scope: Scope\n  /**\n   * Use a plugin\n   */\n  use(\n    plugin: Plugin,\n    options?: {\n      [key: string]: any\n    },\n  ): any\n  /**\n   * Check if an element or selector has been set with the `interact(target)`\n   * function\n   *\n   * @return {boolean} Indicates if the element or CSS selector was previously\n   * passed to interact\n   */\n  isSet(\n    /* The Element or string being searched for */\n    target: Target,\n    options?: any,\n  ): boolean\n  on(type: string | EventTypes, listener: ListenersArg, options?: object): any\n  off(type: EventTypes, listener: any, options?: object): any\n  debug(): any\n  /**\n   * Whether or not the browser supports touch input\n   */\n  supportsTouch(): boolean\n  /**\n   * Whether or not the browser supports PointerEvents\n   */\n  supportsPointerEvent(): boolean\n  /**\n   * Cancels all interactions (end events are not fired)\n   */\n  stop(): InteractStatic\n  /**\n   * Returns or sets the distance the pointer must be moved before an action\n   * sequence occurs. This also affects tolerance for tap events.\n   */\n  pointerMoveTolerance(\n    /** The movement from the start position must be greater than this value */\n    newValue?: number,\n  ): InteractStatic | number\n  addDocument(doc: Document, options?: object): void\n  removeDocument(doc: Document): void\n}\n\nexport function createInteractStatic(scope: Scope): InteractStatic {\n  const interact = ((target: Target, options: Options) => {\n    let interactable = scope.interactables.getExisting(target, options)\n\n    if (!interactable) {\n      interactable = scope.interactables.new(target, options)\n      interactable.events.global = interact.globalEvents\n    }\n\n    return interactable\n  }) as InteractStatic\n\n  // expose the functions used to calculate multi-touch properties\n  interact.getPointerAverage = pointerUtils.pointerAverage\n  interact.getTouchBBox = pointerUtils.touchBBox\n  interact.getTouchDistance = pointerUtils.touchDistance\n  interact.getTouchAngle = pointerUtils.touchAngle\n\n  interact.getElementRect = domUtils.getElementRect\n  interact.getElementClientRect = domUtils.getElementClientRect\n  interact.matchesSelector = domUtils.matchesSelector\n  interact.closest = domUtils.closest\n\n  interact.globalEvents = {} as any\n\n  // eslint-disable-next-line no-undef\n  interact.version = process.env.npm_package_version\n  interact.scope = scope\n  interact.use = function (plugin, options) {\n    this.scope.usePlugin(plugin, options)\n\n    return this\n  }\n\n  interact.isSet = function (target: Target, options?: { context?: Context }): boolean {\n    return !!this.scope.interactables.get(target, options && options.context)\n  }\n\n  interact.on = warnOnce(function on(type: string | EventTypes, listener: ListenersArg, options?: object) {\n    if (is.string(type) && type.search(' ') !== -1) {\n      type = type.trim().split(/ +/)\n    }\n\n    if (is.array(type)) {\n      for (const eventType of type as any[]) {\n        this.on(eventType, listener, options)\n      }\n\n      return this\n    }\n\n    if (is.object(type)) {\n      for (const prop in type) {\n        this.on(prop, (type as any)[prop], listener)\n      }\n\n      return this\n    }\n\n    // if it is an InteractEvent type, add listener to globalEvents\n    if (isNonNativeEvent(type, this.scope.actions)) {\n      // if this type of event was never bound\n      if (!this.globalEvents[type]) {\n        this.globalEvents[type] = [listener]\n      } else {\n        this.globalEvents[type].push(listener)\n      }\n    }\n    // If non InteractEvent type, addEventListener to document\n    else {\n      this.scope.events.add(this.scope.document, type, listener as Listener, { options })\n    }\n\n    return this\n  }, 'The interact.on() method is being deprecated')\n\n  interact.off = warnOnce(function off(type: EventTypes, listener: any, options?: object) {\n    if (is.string(type) && type.search(' ') !== -1) {\n      type = type.trim().split(/ +/)\n    }\n\n    if (is.array(type)) {\n      for (const eventType of type) {\n        this.off(eventType, listener, options)\n      }\n\n      return this\n    }\n\n    if (is.object(type)) {\n      for (const prop in type) {\n        this.off(prop, type[prop], listener)\n      }\n\n      return this\n    }\n\n    if (isNonNativeEvent(type, this.scope.actions)) {\n      let index: number\n\n      if (type in this.globalEvents && (index = this.globalEvents[type].indexOf(listener)) !== -1) {\n        this.globalEvents[type].splice(index, 1)\n      }\n    } else {\n      this.scope.events.remove(this.scope.document, type, listener, options)\n    }\n\n    return this\n  }, 'The interact.off() method is being deprecated')\n\n  interact.debug = function () {\n    return this.scope\n  }\n\n  interact.supportsTouch = function () {\n    return browser.supportsTouch\n  }\n\n  interact.supportsPointerEvent = function () {\n    return browser.supportsPointerEvent\n  }\n\n  interact.stop = function () {\n    for (const interaction of this.scope.interactions.list) {\n      interaction.stop()\n    }\n\n    return this\n  }\n\n  interact.pointerMoveTolerance = function (newValue?: number) {\n    if (is.number(newValue)) {\n      this.scope.interactions.pointerMoveTolerance = newValue\n\n      return this\n    }\n\n    return this.scope.interactions.pointerMoveTolerance\n  }\n\n  interact.addDocument = function (doc: Document, options?: object) {\n    this.scope.addDocument(doc, options)\n  }\n\n  interact.removeDocument = function (doc: Document) {\n    this.scope.removeDocument(doc)\n  }\n\n  return interact\n}\n", "import { Scope } from '@interactjs/core/scope'\n\nconst scope = new Scope()\n\nconst interact = scope.interactStatic\n\nexport default interact\n\nconst _global = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : this\nscope.init(_global)\n", "export default () => {}\n", "export default () => {}\n", "import type { Rect, Point } from '@interactjs/core/types'\nimport type { SnapFunction, SnapTarget } from '@interactjs/modifiers/snap/pointer'\n\nexport interface GridOptionsBase {\n  range?: number\n  limits?: Rect\n  offset?: Point\n}\nexport interface GridOptionsXY extends GridOptionsBase {\n  x: number\n  y: number\n}\nexport interface GridOptionsTopLeft extends GridOptionsBase {\n  top?: number\n  left?: number\n}\nexport interface GridOptionsBottomRight extends GridOptionsBase {\n  bottom?: number\n  right?: number\n}\nexport interface GridOptionsWidthHeight extends GridOptionsBase {\n  width?: number\n  height?: number\n}\n\nexport type GridOptions = GridOptionsXY | GridOptionsTopLeft | GridOptionsBottomRight | GridOptionsWidthHeight\n\nexport default (grid: GridOptions) => {\n  const coordFields = (\n    [\n      ['x', 'y'],\n      ['left', 'top'],\n      ['right', 'bottom'],\n      ['width', 'height'],\n    ] as const\n  ).filter(([xField, yField]) => xField in grid || yField in grid)\n\n  const gridFunc: SnapFunction & {\n    grid: typeof grid\n    coordFields: typeof coordFields\n  } = (x, y) => {\n    const {\n      range,\n      limits = {\n        left: -Infinity,\n        right: Infinity,\n        top: -Infinity,\n        bottom: Infinity,\n      },\n      offset = { x: 0, y: 0 },\n    } = grid\n\n    const result: SnapTarget & {\n      grid: typeof grid\n    } = { range, grid, x: null as number, y: null as number }\n\n    for (const [xField, yField] of coordFields) {\n      const gridx = Math.round((x - offset.x) / (grid as any)[xField])\n      const gridy = Math.round((y - offset.y) / (grid as any)[yField])\n\n      result[xField] = Math.max(limits.left, Math.min(limits.right, gridx * (grid as any)[xField] + offset.x))\n      result[yField] = Math.max(limits.top, Math.min(limits.bottom, gridy * (grid as any)[yField] + offset.y))\n    }\n\n    return result\n  }\n\n  gridFunc.grid = grid\n  gridFunc.coordFields = coordFields\n\n  return gridFunc\n}\n", "import type { Plugin } from '@interactjs/core/scope'\nimport extend from '@interactjs/utils/extend'\n\nimport * as allSnappers from './all'\n\ndeclare module '@interactjs/core/InteractStatic' {\n  export interface InteractStatic {\n    snappers: typeof allSnappers\n    createSnapGrid: typeof allSnappers.grid\n  }\n}\n\nconst snappersPlugin: Plugin = {\n  id: 'snappers',\n  install(scope) {\n    const { interactStatic: interact } = scope\n\n    interact.snappers = extend(interact.snappers || {}, allSnappers)\n    interact.createSnapGrid = interact.snappers.grid\n  },\n}\n\nexport default snappersPlugin\n", "/**\n * @module modifiers/aspectRatio\n *\n * @description\n * This modifier forces elements to be resized with a specified dx/dy ratio.\n *\n * ```js\n * interact(target).resizable({\n *   modifiers: [\n *     interact.modifiers.snapSize({\n *       targets: [ interact.snappers.grid({ x: 20, y: 20 }) ],\n *     }),\n *     interact.aspectRatio({ ratio: 'preserve' }),\n *   ],\n * });\n * ```\n */\n\nimport type { Point, Rect, EdgeOptions } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\nimport { addEdges } from '@interactjs/utils/rect'\n\nimport { makeModifier } from './base'\nimport { Modification } from './Modification'\nimport type { Modifier, ModifierModule, ModifierState } from './types'\n\nexport interface AspectRatioOptions {\n  ratio?: number | 'preserve'\n  equalDelta?: boolean\n  modifiers?: Modifier[]\n  enabled?: boolean\n}\n\nexport type AspectRatioState = ModifierState<\n  AspectRatioOptions,\n  {\n    startCoords: Point\n    startRect: Rect\n    linkedEdges: EdgeOptions\n    ratio: number\n    equalDelta: boolean\n    xIsPrimaryAxis: boolean\n    edgeSign: {\n      x: number\n      y: number\n    }\n    subModification: Modification\n  }\n>\n\nconst aspectRatio: ModifierModule<AspectRatioOptions, AspectRatioState> = {\n  start(arg) {\n    const { state, rect, edges, pageCoords: coords } = arg\n    let { ratio, enabled } = state.options\n    const { equalDelta, modifiers } = state.options\n\n    if (ratio === 'preserve') {\n      ratio = rect.width / rect.height\n    }\n\n    state.startCoords = extend({}, coords)\n    state.startRect = extend({}, rect)\n    state.ratio = ratio\n    state.equalDelta = equalDelta\n\n    const linkedEdges = (state.linkedEdges = {\n      top: edges.top || (edges.left && !edges.bottom),\n      left: edges.left || (edges.top && !edges.right),\n      bottom: edges.bottom || (edges.right && !edges.top),\n      right: edges.right || (edges.bottom && !edges.left),\n    })\n\n    state.xIsPrimaryAxis = !!(edges.left || edges.right)\n\n    if (state.equalDelta) {\n      const sign = (linkedEdges.left ? 1 : -1) * (linkedEdges.top ? 1 : -1)\n      state.edgeSign = {\n        x: sign,\n        y: sign,\n      }\n    } else {\n      state.edgeSign = {\n        x: linkedEdges.left ? -1 : 1,\n        y: linkedEdges.top ? -1 : 1,\n      }\n    }\n\n    if (enabled !== false) {\n      extend(edges, linkedEdges)\n    }\n\n    if (!modifiers?.length) return\n\n    const subModification = new Modification(arg.interaction)\n\n    subModification.copyFrom(arg.interaction.modification)\n    subModification.prepareStates(modifiers)\n\n    state.subModification = subModification\n    subModification.startAll({ ...arg })\n  },\n\n  set(arg) {\n    const { state, rect, coords } = arg\n    const { linkedEdges } = state\n    const initialCoords = extend({}, coords)\n    const aspectMethod = state.equalDelta ? setEqualDelta : setRatio\n\n    extend(arg.edges, linkedEdges)\n    aspectMethod(state, state.xIsPrimaryAxis, coords, rect)\n\n    if (!state.subModification) {\n      return null\n    }\n\n    const correctedRect = extend({}, rect)\n\n    addEdges(linkedEdges, correctedRect, {\n      x: coords.x - initialCoords.x,\n      y: coords.y - initialCoords.y,\n    })\n\n    const result = state.subModification.setAll({\n      ...arg,\n      rect: correctedRect,\n      edges: linkedEdges,\n      pageCoords: coords,\n      prevCoords: coords,\n      prevRect: correctedRect,\n    })\n\n    const { delta } = result\n\n    if (result.changed) {\n      const xIsCriticalAxis = Math.abs(delta.x) > Math.abs(delta.y)\n\n      // do aspect modification again with critical edge axis as primary\n      aspectMethod(state, xIsCriticalAxis, result.coords, result.rect)\n      extend(coords, result.coords)\n    }\n\n    return result.eventProps\n  },\n\n  defaults: {\n    ratio: 'preserve',\n    equalDelta: false,\n    modifiers: [],\n    enabled: false,\n  },\n}\n\nfunction setEqualDelta({ startCoords, edgeSign }: AspectRatioState, xIsPrimaryAxis: boolean, coords: Point) {\n  if (xIsPrimaryAxis) {\n    coords.y = startCoords.y + (coords.x - startCoords.x) * edgeSign.y\n  } else {\n    coords.x = startCoords.x + (coords.y - startCoords.y) * edgeSign.x\n  }\n}\n\nfunction setRatio(\n  { startRect, startCoords, ratio, edgeSign }: AspectRatioState,\n  xIsPrimaryAxis: boolean,\n  coords: Point,\n  rect: Rect,\n) {\n  if (xIsPrimaryAxis) {\n    const newHeight = rect.width / ratio\n\n    coords.y = startCoords.y + (newHeight - startRect.height) * edgeSign.y\n  } else {\n    const newWidth = rect.height * ratio\n\n    coords.x = startCoords.x + (newWidth - startRect.width) * edgeSign.x\n  }\n}\n\nexport default makeModifier(aspectRatio, 'aspectRatio')\nexport { aspectRatio }\n", "import type { ModifierFunction } from './types'\n\nconst noop = (() => {}) as unknown as ModifierFunction<any, any, 'noop'>\n\nnoop._defaults = {}\n\nexport default noop\n", "import type Interaction from '@interactjs/core/Interaction'\nimport type { RectResolvable, Rect, Point } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport * as rectUtils from '@interactjs/utils/rect'\n\nimport { makeModifier } from '../base'\nimport type { ModifierArg, ModifierModule, ModifierState } from '../types'\n\nexport interface RestrictOptions {\n  // where to drag over\n  restriction: RectResolvable<[number, number, Interaction]>\n  // what part of self is allowed to drag over\n  elementRect: Rect\n  offset: Rect\n  // restrict just before the end drag\n  endOnly: boolean\n  enabled?: boolean\n}\n\nexport type RestrictState = ModifierState<\n  RestrictOptions,\n  {\n    offset: Rect\n  }\n>\n\nfunction start({ rect, startOffset, state, interaction, pageCoords }: ModifierArg<RestrictState>) {\n  const { options } = state\n  const { elementRect } = options\n  const offset: Rect = extend(\n    {\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0,\n    },\n    options.offset || {},\n  )\n\n  if (rect && elementRect) {\n    const restriction = getRestrictionRect(options.restriction, interaction, pageCoords)\n\n    if (restriction) {\n      const widthDiff = restriction.right - restriction.left - rect.width\n      const heightDiff = restriction.bottom - restriction.top - rect.height\n\n      if (widthDiff < 0) {\n        offset.left += widthDiff\n        offset.right += widthDiff\n      }\n      if (heightDiff < 0) {\n        offset.top += heightDiff\n        offset.bottom += heightDiff\n      }\n    }\n\n    offset.left += startOffset.left - rect.width * elementRect.left\n    offset.top += startOffset.top - rect.height * elementRect.top\n\n    offset.right += startOffset.right - rect.width * (1 - elementRect.right)\n    offset.bottom += startOffset.bottom - rect.height * (1 - elementRect.bottom)\n  }\n\n  state.offset = offset\n}\n\nfunction set({ coords, interaction, state }: ModifierArg<RestrictState>) {\n  const { options, offset } = state\n\n  const restriction = getRestrictionRect(options.restriction, interaction, coords)\n\n  if (!restriction) return\n\n  const rect = rectUtils.xywhToTlbr(restriction)\n\n  coords.x = Math.max(Math.min(rect.right - offset.right, coords.x), rect.left + offset.left)\n  coords.y = Math.max(Math.min(rect.bottom - offset.bottom, coords.y), rect.top + offset.top)\n}\n\nexport function getRestrictionRect(\n  value: RectResolvable<[number, number, Interaction]>,\n  interaction: Interaction,\n  coords?: Point,\n) {\n  if (is.func(value)) {\n    return rectUtils.resolveRectLike(value, interaction.interactable, interaction.element, [\n      coords.x,\n      coords.y,\n      interaction,\n    ])\n  } else {\n    return rectUtils.resolveRectLike(value, interaction.interactable, interaction.element)\n  }\n}\n\nconst defaults: RestrictOptions = {\n  restriction: null,\n  elementRect: null,\n  offset: null,\n  endOnly: false,\n  enabled: false,\n}\n\nconst restrict: ModifierModule<RestrictOptions, RestrictState> = {\n  start,\n  set,\n  defaults,\n}\n\nexport default makeModifier(restrict, 'restrict')\nexport { restrict }\n", "// This modifier adds the options.resize.restrictEdges setting which sets min and\n// max for the top, left, bottom and right edges of the target being resized.\n//\n// interact(target).resize({\n//   edges: { top: true, left: true },\n//   restrictEdges: {\n//     inner: { top: 200, left: 200, right: 400, bottom: 400 },\n//     outer: { top:   0, left:   0, right: 600, bottom: 600 },\n//   },\n// })\n\nimport type { Point, Rect } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\nimport * as rectUtils from '@interactjs/utils/rect'\n\nimport { makeModifier } from '../base'\nimport type { ModifierArg, ModifierState } from '../types'\n\nimport type { RestrictOptions } from './pointer'\nimport { getRestrictionRect } from './pointer'\n\nexport interface RestrictEdgesOptions {\n  inner: RestrictOptions['restriction']\n  outer: RestrictOptions['restriction']\n  offset?: RestrictOptions['offset']\n  endOnly: boolean\n  enabled?: boolean\n}\n\nexport type RestrictEdgesState = ModifierState<\n  RestrictEdgesOptions,\n  {\n    inner: Rect\n    outer: Rect\n    offset: RestrictEdgesOptions['offset']\n  }\n>\n\nconst noInner = { top: +Infinity, left: +Infinity, bottom: -Infinity, right: -Infinity }\nconst noOuter = { top: -Infinity, left: -Infinity, bottom: +Infinity, right: +Infinity }\n\nfunction start({ interaction, startOffset, state }: ModifierArg<RestrictEdgesState>) {\n  const { options } = state\n  let offset: Point\n\n  if (options) {\n    const offsetRect = getRestrictionRect(options.offset, interaction, interaction.coords.start.page)\n\n    offset = rectUtils.rectToXY(offsetRect)\n  }\n\n  offset = offset || { x: 0, y: 0 }\n\n  state.offset = {\n    top: offset.y + startOffset.top,\n    left: offset.x + startOffset.left,\n    bottom: offset.y - startOffset.bottom,\n    right: offset.x - startOffset.right,\n  }\n}\n\nfunction set({ coords, edges, interaction, state }: ModifierArg<RestrictEdgesState>) {\n  const { offset, options } = state\n\n  if (!edges) {\n    return\n  }\n\n  const page = extend({}, coords)\n  const inner = getRestrictionRect(options.inner, interaction, page) || ({} as Rect)\n  const outer = getRestrictionRect(options.outer, interaction, page) || ({} as Rect)\n\n  fixRect(inner, noInner)\n  fixRect(outer, noOuter)\n\n  if (edges.top) {\n    coords.y = Math.min(Math.max(outer.top + offset.top, page.y), inner.top + offset.top)\n  } else if (edges.bottom) {\n    coords.y = Math.max(Math.min(outer.bottom + offset.bottom, page.y), inner.bottom + offset.bottom)\n  }\n  if (edges.left) {\n    coords.x = Math.min(Math.max(outer.left + offset.left, page.x), inner.left + offset.left)\n  } else if (edges.right) {\n    coords.x = Math.max(Math.min(outer.right + offset.right, page.x), inner.right + offset.right)\n  }\n}\n\nfunction fixRect(rect: Rect, defaults: Rect) {\n  for (const edge of ['top', 'left', 'bottom', 'right']) {\n    if (!(edge in rect)) {\n      rect[edge] = defaults[edge]\n    }\n  }\n\n  return rect\n}\n\nconst defaults: RestrictEdgesOptions = {\n  inner: null,\n  outer: null,\n  offset: null,\n  endOnly: false,\n  enabled: false,\n}\n\nconst restrictEdges = {\n  noInner,\n  noOuter,\n  start,\n  set,\n  defaults,\n}\n\nexport default makeModifier(restrictEdges, 'restrictEdges')\nexport { restrictEdges }\n", "import extend from '@interactjs/utils/extend'\n\nimport { makeModifier } from '../base'\n\nimport { restrict } from './pointer'\n\nconst defaults = extend(\n  {\n    get elementRect() {\n      return { top: 0, left: 0, bottom: 1, right: 1 }\n    },\n    set elementRect(_) {},\n  },\n  restrict.defaults,\n)\n\nconst restrictRect = {\n  start: restrict.start,\n  set: restrict.set,\n  defaults,\n}\n\nexport default makeModifier(restrictRect, 'restrictRect')\nexport { restrictRect }\n", "import type { Point, Rect, Size } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\nimport * as rectUtils from '@interactjs/utils/rect'\n\nimport { makeModifier } from '../base'\nimport type { ModifierArg, ModifierState } from '../types'\n\nimport type { RestrictEdgesState } from './edges'\nimport { restrictEdges } from './edges'\nimport type { RestrictOptions } from './pointer'\nimport { getRestrictionRect } from './pointer'\n\nconst noMin = { width: -Infinity, height: -Infinity }\nconst noMax = { width: +Infinity, height: +Infinity }\n\nexport interface RestrictSizeOptions {\n  min?: Size | Point | RestrictOptions['restriction']\n  max?: Size | Point | RestrictOptions['restriction']\n  endOnly: boolean\n  enabled?: boolean\n}\n\nfunction start(arg: ModifierArg<RestrictEdgesState>) {\n  return restrictEdges.start(arg)\n}\n\nexport type RestrictSizeState = RestrictEdgesState &\n  ModifierState<\n    RestrictSizeOptions & { inner: Rect; outer: Rect },\n    {\n      min: Rect\n      max: Rect\n    }\n  >\n\nfunction set(arg: ModifierArg<RestrictSizeState>) {\n  const { interaction, state, rect, edges } = arg\n  const { options } = state\n\n  if (!edges) {\n    return\n  }\n\n  const minSize =\n    rectUtils.tlbrToXywh(getRestrictionRect(options.min as any, interaction, arg.coords)) || noMin\n  const maxSize =\n    rectUtils.tlbrToXywh(getRestrictionRect(options.max as any, interaction, arg.coords)) || noMax\n\n  state.options = {\n    endOnly: options.endOnly,\n    inner: extend({}, restrictEdges.noInner),\n    outer: extend({}, restrictEdges.noOuter),\n  }\n\n  if (edges.top) {\n    state.options.inner.top = rect.bottom - minSize.height\n    state.options.outer.top = rect.bottom - maxSize.height\n  } else if (edges.bottom) {\n    state.options.inner.bottom = rect.top + minSize.height\n    state.options.outer.bottom = rect.top + maxSize.height\n  }\n  if (edges.left) {\n    state.options.inner.left = rect.right - minSize.width\n    state.options.outer.left = rect.right - maxSize.width\n  } else if (edges.right) {\n    state.options.inner.right = rect.left + minSize.width\n    state.options.outer.right = rect.left + maxSize.width\n  }\n\n  restrictEdges.set(arg)\n\n  state.options = options\n}\n\nconst defaults: RestrictSizeOptions = {\n  min: null,\n  max: null,\n  endOnly: false,\n  enabled: false,\n}\n\nconst restrictSize = {\n  start,\n  set,\n  defaults,\n}\n\nexport default makeModifier(restrictSize, 'restrictSize')\nexport { restrictSize }\n", "import type { Interaction, InteractionProxy } from '@interactjs/core/Interaction'\nimport type { ActionName, Point, RectResolvable, Element } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\nimport getOriginXY from '@interactjs/utils/getOriginXY'\nimport hypot from '@interactjs/utils/hypot'\nimport is from '@interactjs/utils/is'\nimport { resolveRectLike, rectToXY } from '@interactjs/utils/rect'\n\nimport { makeModifier } from '../base'\nimport type { ModifierArg, ModifierState } from '../types'\n\nexport interface Offset {\n  x: number\n  y: number\n  index: number\n  relativePoint?: Point | null\n}\n\nexport interface SnapPosition {\n  x?: number\n  y?: number\n  range?: number\n  offset?: Offset\n  [index: string]: any\n}\n\nexport type SnapFunction = (\n  x: number,\n  y: number,\n  interaction: InteractionProxy<ActionName>,\n  offset: Offset,\n  index: number,\n) => SnapPosition\nexport type SnapTarget = SnapPosition | SnapFunction\nexport interface SnapOptions {\n  targets?: SnapTarget[]\n  // target range\n  range?: number\n  // self points for snapping. [0,0] = top left, [1,1] = bottom right\n  relativePoints?: Point[]\n  // startCoords = offset snapping from drag start page position\n  offset?: Point | RectResolvable<[Interaction]> | 'startCoords'\n  offsetWithOrigin?: boolean\n  origin?: RectResolvable<[Element]> | Point\n  endOnly?: boolean\n  enabled?: boolean\n}\n\nexport type SnapState = ModifierState<\n  SnapOptions,\n  {\n    offsets?: Offset[]\n    closest?: any\n    targetFields?: string[][]\n  }\n>\n\nfunction start(arg: ModifierArg<SnapState>) {\n  const { interaction, interactable, element, rect, state, startOffset } = arg\n  const { options } = state\n  const origin = options.offsetWithOrigin ? getOrigin(arg) : { x: 0, y: 0 }\n\n  let snapOffset: Point\n\n  if (options.offset === 'startCoords') {\n    snapOffset = {\n      x: interaction.coords.start.page.x,\n      y: interaction.coords.start.page.y,\n    }\n  } else {\n    const offsetRect = resolveRectLike(options.offset as any, interactable, element, [interaction])\n\n    snapOffset = rectToXY(offsetRect) || { x: 0, y: 0 }\n    snapOffset.x += origin.x\n    snapOffset.y += origin.y\n  }\n\n  const { relativePoints } = options\n\n  state.offsets =\n    rect && relativePoints && relativePoints.length\n      ? relativePoints.map((relativePoint, index) => ({\n          index,\n          relativePoint,\n          x: startOffset.left - rect.width * relativePoint.x + snapOffset.x,\n          y: startOffset.top - rect.height * relativePoint.y + snapOffset.y,\n        }))\n      : [\n          {\n            index: 0,\n            relativePoint: null,\n            x: snapOffset.x,\n            y: snapOffset.y,\n          },\n        ]\n}\n\nfunction set(arg: ModifierArg<SnapState>) {\n  const { interaction, coords, state } = arg\n  const { options, offsets } = state\n\n  const origin = getOriginXY(interaction.interactable!, interaction.element!, interaction.prepared.name)\n  const page = extend({}, coords)\n  const targets: SnapPosition[] = []\n\n  if (!options.offsetWithOrigin) {\n    page.x -= origin.x\n    page.y -= origin.y\n  }\n\n  for (const offset of offsets!) {\n    const relativeX = page.x - offset.x\n    const relativeY = page.y - offset.y\n\n    for (let index = 0, len = options.targets!.length; index < len; index++) {\n      const snapTarget = options.targets![index]\n      let target: SnapPosition\n\n      if (is.func(snapTarget)) {\n        target = snapTarget(relativeX, relativeY, interaction._proxy, offset, index)\n      } else {\n        target = snapTarget\n      }\n\n      if (!target) {\n        continue\n      }\n\n      targets.push({\n        x: (is.number(target.x) ? target.x : relativeX) + offset.x,\n        y: (is.number(target.y) ? target.y : relativeY) + offset.y,\n\n        range: is.number(target.range) ? target.range : options.range,\n        source: snapTarget,\n        index,\n        offset,\n      })\n    }\n  }\n\n  const closest = {\n    target: null,\n    inRange: false,\n    distance: 0,\n    range: 0,\n    delta: { x: 0, y: 0 },\n  }\n\n  for (const target of targets) {\n    const range = target.range\n    const dx = target.x - page.x\n    const dy = target.y - page.y\n    const distance = hypot(dx, dy)\n    let inRange = distance <= range\n\n    // Infinite targets count as being out of range\n    // compared to non infinite ones that are in range\n    if (range === Infinity && closest.inRange && closest.range !== Infinity) {\n      inRange = false\n    }\n\n    if (\n      !closest.target ||\n      (inRange\n        ? // is the closest target in range?\n          closest.inRange && range !== Infinity\n          ? // the pointer is relatively deeper in this target\n            distance / range < closest.distance / closest.range\n          : // this target has Infinite range and the closest doesn't\n            (range === Infinity && closest.range !== Infinity) ||\n            // OR this target is closer that the previous closest\n            distance < closest.distance\n        : // The other is not in range and the pointer is closer to this target\n          !closest.inRange && distance < closest.distance)\n    ) {\n      closest.target = target\n      closest.distance = distance\n      closest.range = range\n      closest.inRange = inRange\n      closest.delta.x = dx\n      closest.delta.y = dy\n    }\n  }\n\n  if (closest.inRange) {\n    coords.x = closest.target.x\n    coords.y = closest.target.y\n  }\n\n  state.closest = closest\n  return closest\n}\n\nfunction getOrigin(arg: Partial<ModifierArg<SnapState>>) {\n  const { element } = arg.interaction\n  const optionsOrigin = rectToXY(resolveRectLike(arg.state.options.origin as any, null, null, [element]))\n  const origin = optionsOrigin || getOriginXY(arg.interactable, element, arg.interaction.prepared.name)\n\n  return origin\n}\n\nconst defaults: SnapOptions = {\n  range: Infinity,\n  targets: null,\n  offset: null,\n  offsetWithOrigin: true,\n  origin: null,\n  relativePoints: null,\n  endOnly: false,\n  enabled: false,\n}\nconst snap = {\n  start,\n  set,\n  defaults,\n}\n\nexport default makeModifier(snap, 'snap')\nexport { snap }\n", "// This modifier allows snapping of the size of targets during resize\n// interactions.\n\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\n\nimport { makeModifier } from '../base'\nimport type { ModifierArg } from '../types'\n\nimport type { SnapOptions, SnapState } from './pointer'\nimport { snap } from './pointer'\n\nexport type SnapSizeOptions = Pick<SnapOptions, 'targets' | 'offset' | 'endOnly' | 'range' | 'enabled'>\n\nfunction start(arg: ModifierArg<SnapState>) {\n  const { state, edges } = arg\n  const { options } = state\n\n  if (!edges) {\n    return null\n  }\n\n  arg.state = {\n    options: {\n      targets: null,\n      relativePoints: [\n        {\n          x: edges.left ? 0 : 1,\n          y: edges.top ? 0 : 1,\n        },\n      ],\n      offset: options.offset || 'self',\n      origin: { x: 0, y: 0 },\n      range: options.range,\n    },\n  }\n\n  state.targetFields = state.targetFields || [\n    ['width', 'height'],\n    ['x', 'y'],\n  ]\n\n  snap.start(arg)\n  state.offsets = arg.state.offsets\n\n  arg.state = state\n}\n\nfunction set(arg) {\n  const { interaction, state, coords } = arg\n  const { options, offsets } = state\n  const relative = {\n    x: coords.x - offsets[0].x,\n    y: coords.y - offsets[0].y,\n  }\n\n  state.options = extend({}, options)\n  state.options.targets = []\n\n  for (const snapTarget of options.targets || []) {\n    let target\n\n    if (is.func(snapTarget)) {\n      target = snapTarget(relative.x, relative.y, interaction)\n    } else {\n      target = snapTarget\n    }\n\n    if (!target) {\n      continue\n    }\n\n    for (const [xField, yField] of state.targetFields) {\n      if (xField in target || yField in target) {\n        target.x = target[xField]\n        target.y = target[yField]\n\n        break\n      }\n    }\n\n    state.options.targets.push(target)\n  }\n\n  const returnValue = snap.set(arg)\n\n  state.options = options\n\n  return returnValue\n}\n\nconst defaults: SnapSizeOptions = {\n  range: Infinity,\n  targets: null,\n  offset: null,\n  endOnly: false,\n  enabled: false,\n}\n\nconst snapSize = {\n  start,\n  set,\n  defaults,\n}\n\nexport default makeModifier(snapSize, 'snapSize')\nexport { snapSize }\n", "/**\n * @module modifiers/snapEdges\n *\n * @description\n * This modifier allows snapping of the edges of targets during resize\n * interactions.\n *\n * ```js\n * interact(target).resizable({\n *   snapEdges: {\n *     targets: [interact.snappers.grid({ x: 100, y: 50 })],\n *   },\n * })\n *\n * interact(target).resizable({\n *   snapEdges: {\n *     targets: [\n *       interact.snappers.grid({\n *        top: 50,\n *        left: 50,\n *        bottom: 100,\n *        right: 100,\n *       }),\n *     ],\n *   },\n * })\n * ```\n */\n\nimport clone from '@interactjs/utils/clone'\nimport extend from '@interactjs/utils/extend'\n\nimport { makeModifier } from '../base'\nimport type { ModifierArg, ModifierModule } from '../types'\n\nimport type { SnapOptions, SnapState } from './pointer'\nimport { snapSize } from './size'\n\nexport type SnapEdgesOptions = Pick<SnapOptions, 'targets' | 'range' | 'offset' | 'endOnly' | 'enabled'>\n\nfunction start(arg: ModifierArg<SnapState>) {\n  const { edges } = arg\n\n  if (!edges) {\n    return null\n  }\n\n  arg.state.targetFields = arg.state.targetFields || [\n    [edges.left ? 'left' : 'right', edges.top ? 'top' : 'bottom'],\n  ]\n\n  return snapSize.start(arg)\n}\n\nconst snapEdges: ModifierModule<SnapEdgesOptions, SnapState, ReturnType<typeof snapSize.set>> = {\n  start,\n  set: snapSize.set,\n  defaults: extend(clone(snapSize.defaults), {\n    targets: undefined,\n    range: undefined,\n    offset: { x: 0, y: 0 },\n  } as const),\n}\n\nexport default makeModifier(snapEdges, 'snapEdges')\nexport { snapEdges }\n", "/* eslint-disable n/no-extraneous-import, import/no-unresolved */\nimport aspectRatio from './aspectRatio'\nimport avoid from './avoid/avoid'\nimport restrictEdges from './restrict/edges'\nimport restrict from './restrict/pointer'\nimport restrictRect from './restrict/rect'\nimport restrictSize from './restrict/size'\nimport rubberband from './rubberband/rubberband'\nimport snapEdges from './snap/edges'\nimport snap from './snap/pointer'\nimport snapSize from './snap/size'\nimport spring from './spring/spring'\nimport transform from './transform/transform'\n\nexport default {\n  aspectRatio,\n  restrictEdges,\n  restrict,\n  restrictRect,\n  restrictSize,\n  snapEdges,\n  snap,\n  snapSize,\n\n  spring,\n  avoid,\n  transform,\n  rubberband,\n}\n", "import type { Plugin } from '@interactjs/core/scope'\nimport snappers from '@interactjs/snappers/plugin'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './all'\nimport './base'\n\nimport all from './all'\nimport base from './base'\n/* eslint-enable import/no-duplicates */\n\ndeclare module '@interactjs/core/InteractStatic' {\n  export interface InteractStatic {\n    modifiers: typeof all\n  }\n}\n\nconst modifiers: Plugin = {\n  id: 'modifiers',\n  install(scope) {\n    const { interactStatic: interact } = scope\n\n    scope.usePlugin(base)\n    scope.usePlugin(snappers)\n\n    interact.modifiers = all\n\n    // for backwrads compatibility\n    for (const type in all) {\n      const { _defaults, _methods } = all[type as keyof typeof all]\n\n      ;(_defaults as any)._methods = _methods\n      ;(scope.defaults.perAction as any)[type] = _defaults\n    }\n  },\n}\n\nexport default modifiers\n", "import { BaseEvent } from '@interactjs/core/BaseEvent'\nimport type Interaction from '@interactjs/core/Interaction'\nimport type { PointerEventType, PointerType, Point } from '@interactjs/core/types'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\n\nexport class PointerEvent<T extends string = any> extends BaseEvent<never> {\n  declare type: T\n  declare originalEvent: PointerEventType\n  declare pointerId: number\n  declare pointerType: string\n  declare double: boolean\n  declare pageX: number\n  declare pageY: number\n  declare clientX: number\n  declare clientY: number\n  declare dt: number\n  declare eventable: any;\n  [key: string]: any\n\n  constructor(\n    type: T,\n    pointer: PointerType | PointerEvent<any>,\n    event: PointerEventType,\n    eventTarget: Node,\n    interaction: Interaction<never>,\n    timeStamp: number,\n  ) {\n    super(interaction)\n    pointerUtils.pointerExtend(this, event)\n\n    if (event !== pointer) {\n      pointerUtils.pointerExtend(this, pointer)\n    }\n\n    this.timeStamp = timeStamp\n    this.originalEvent = event\n    this.type = type\n    this.pointerId = pointerUtils.getPointerId(pointer)\n    this.pointerType = pointerUtils.getPointerType(pointer)\n    this.target = eventTarget\n    this.currentTarget = null\n\n    if (type === 'tap') {\n      const pointerIndex = interaction.getPointerIndex(pointer)\n      this.dt = this.timeStamp - interaction.pointers[pointerIndex].downTime\n\n      const interval = this.timeStamp - interaction.tapTime\n\n      this.double =\n        !!interaction.prevTap &&\n        interaction.prevTap.type !== 'doubletap' &&\n        interaction.prevTap.target === this.target &&\n        interval < 500\n    } else if (type === 'doubletap') {\n      this.dt = (pointer as PointerEvent<'tap'>).timeStamp - interaction.tapTime\n      this.double = true\n    }\n  }\n\n  _subtractOrigin({ x: originX, y: originY }: Point) {\n    this.pageX -= originX\n    this.pageY -= originY\n    this.clientX -= originX\n    this.clientY -= originY\n\n    return this\n  }\n\n  _addOrigin({ x: originX, y: originY }: Point) {\n    this.pageX += originX\n    this.pageY += originY\n    this.clientX += originX\n    this.clientY += originY\n\n    return this\n  }\n\n  /**\n   * Prevent the default behaviour of the original Event\n   */\n  preventDefault() {\n    this.originalEvent.preventDefault()\n  }\n}\n", "import type { Eventable } from '@interactjs/core/Eventable'\nimport type { Interaction } from '@interactjs/core/Interaction'\nimport type { PerActionDefaults } from '@interactjs/core/options'\nimport type { Scope, SignalArgs, Plugin } from '@interactjs/core/scope'\nimport type { Point, PointerType, PointerEventType, Element } from '@interactjs/core/types'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport extend from '@interactjs/utils/extend'\nimport getOriginXY from '@interactjs/utils/getOriginXY'\n\nimport { PointerEvent } from './PointerEvent'\n\nexport type EventTargetList = Array<{\n  node: Node\n  eventable: Eventable\n  props: { [key: string]: any }\n}>\n\nexport interface PointerEventOptions extends PerActionDefaults {\n  enabled?: undefined // not used\n  holdDuration?: number\n  ignoreFrom?: any\n  allowFrom?: any\n  origin?: Point | string | Element\n}\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    pointerEvents: typeof pointerEvents\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    prevTap?: PointerEvent<string>\n    tapTime?: number\n  }\n}\n\ndeclare module '@interactjs/core/PointerInfo' {\n  interface PointerInfo {\n    hold?: {\n      duration: number\n      timeout: any\n    }\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface ActionDefaults {\n    pointerEvents: Options\n  }\n}\n\ndeclare module '@interactjs/core/scope' {\n  interface SignalArgs {\n    'pointerEvents:new': { pointerEvent: PointerEvent<any> }\n    'pointerEvents:fired': {\n      interaction: Interaction<null>\n      pointer: PointerType | PointerEvent<any>\n      event: PointerEventType | PointerEvent<any>\n      eventTarget: Node\n      pointerEvent: PointerEvent<any>\n      targets?: EventTargetList\n      type: string\n    }\n    'pointerEvents:collect-targets': {\n      interaction: Interaction<any>\n      pointer: PointerType | PointerEvent<any>\n      event: PointerEventType | PointerEvent<any>\n      eventTarget: Node\n      targets?: EventTargetList\n      type: string\n      path: Node[]\n      node: null\n    }\n  }\n}\n\nconst defaults: PointerEventOptions = {\n  holdDuration: 600,\n  ignoreFrom: null,\n  allowFrom: null,\n  origin: { x: 0, y: 0 },\n}\n\nconst pointerEvents: Plugin = {\n  id: 'pointer-events/base',\n  before: ['inertia', 'modifiers', 'auto-start', 'actions'],\n  install,\n  listeners: {\n    'interactions:new': addInteractionProps,\n    'interactions:update-pointer': addHoldInfo,\n    'interactions:move': moveAndClearHold,\n    'interactions:down': (arg, scope) => {\n      downAndStartHold(arg, scope)\n      fire(arg, scope)\n    },\n    'interactions:up': (arg, scope) => {\n      clearHold(arg)\n      fire(arg, scope)\n      tapAfterUp(arg, scope)\n    },\n    'interactions:cancel': (arg, scope) => {\n      clearHold(arg)\n      fire(arg, scope)\n    },\n  },\n  PointerEvent,\n  fire,\n  collectEventTargets,\n  defaults,\n  types: {\n    down: true,\n    move: true,\n    up: true,\n    cancel: true,\n    tap: true,\n    doubletap: true,\n    hold: true,\n  } as { [type: string]: true },\n}\n\nfunction fire<T extends string>(\n  arg: {\n    pointer: PointerType | PointerEvent<any>\n    event: PointerEventType | PointerEvent<any>\n    eventTarget: Node\n    interaction: Interaction<never>\n    type: T\n    targets?: EventTargetList\n  },\n  scope: Scope,\n) {\n  const { interaction, pointer, event, eventTarget, type, targets = collectEventTargets(arg, scope) } = arg\n\n  const pointerEvent = new PointerEvent(type, pointer, event, eventTarget, interaction, scope.now())\n\n  scope.fire('pointerEvents:new', { pointerEvent })\n\n  const signalArg = {\n    interaction,\n    pointer,\n    event,\n    eventTarget,\n    targets,\n    type,\n    pointerEvent,\n  }\n\n  for (let i = 0; i < targets.length; i++) {\n    const target = targets[i]\n\n    for (const prop in target.props || {}) {\n      ;(pointerEvent as any)[prop] = target.props[prop]\n    }\n\n    const origin = getOriginXY(target.eventable, target.node)\n\n    pointerEvent._subtractOrigin(origin)\n    pointerEvent.eventable = target.eventable\n    pointerEvent.currentTarget = target.node\n\n    target.eventable.fire(pointerEvent)\n\n    pointerEvent._addOrigin(origin)\n\n    if (\n      pointerEvent.immediatePropagationStopped ||\n      (pointerEvent.propagationStopped &&\n        i + 1 < targets.length &&\n        targets[i + 1].node !== pointerEvent.currentTarget)\n    ) {\n      break\n    }\n  }\n\n  scope.fire('pointerEvents:fired', signalArg)\n\n  if (type === 'tap') {\n    // if pointerEvent should make a double tap, create and fire a doubletap\n    // PointerEvent and use that as the prevTap\n    const prevTap = pointerEvent.double\n      ? fire(\n          {\n            interaction,\n            pointer,\n            event,\n            eventTarget,\n            type: 'doubletap',\n          },\n          scope,\n        )\n      : pointerEvent\n\n    interaction.prevTap = prevTap\n    interaction.tapTime = prevTap.timeStamp\n  }\n\n  return pointerEvent\n}\n\nfunction collectEventTargets<T extends string>(\n  {\n    interaction,\n    pointer,\n    event,\n    eventTarget,\n    type,\n  }: {\n    interaction: Interaction<any>\n    pointer: PointerType | PointerEvent<any>\n    event: PointerEventType | PointerEvent<any>\n    eventTarget: Node\n    type: T\n  },\n  scope: Scope,\n) {\n  const pointerIndex = interaction.getPointerIndex(pointer)\n  const pointerInfo = interaction.pointers[pointerIndex]\n\n  // do not fire a tap event if the pointer was moved before being lifted\n  if (\n    type === 'tap' &&\n    (interaction.pointerWasMoved ||\n      // or if the pointerup target is different to the pointerdown target\n      !(pointerInfo && pointerInfo.downTarget === eventTarget))\n  ) {\n    return []\n  }\n\n  const path = domUtils.getPath(eventTarget as Element | Document)\n  const signalArg = {\n    interaction,\n    pointer,\n    event,\n    eventTarget,\n    type,\n    path,\n    targets: [] as EventTargetList,\n    node: null,\n  }\n\n  for (const node of path) {\n    signalArg.node = node\n\n    scope.fire('pointerEvents:collect-targets', signalArg)\n  }\n\n  if (type === 'hold') {\n    signalArg.targets = signalArg.targets.filter(\n      (target) =>\n        target.eventable.options.holdDuration === interaction.pointers[pointerIndex]?.hold?.duration,\n    )\n  }\n\n  return signalArg.targets\n}\n\nfunction addInteractionProps({ interaction }) {\n  interaction.prevTap = null // the most recent tap event on this interaction\n  interaction.tapTime = 0 // time of the most recent tap event\n}\n\nfunction addHoldInfo({ down, pointerInfo }: SignalArgs['interactions:update-pointer']) {\n  if (!down && pointerInfo.hold) {\n    return\n  }\n\n  pointerInfo.hold = { duration: Infinity, timeout: null }\n}\n\nfunction clearHold({ interaction, pointerIndex }) {\n  const hold = interaction.pointers[pointerIndex].hold\n\n  if (hold && hold.timeout) {\n    clearTimeout(hold.timeout)\n    hold.timeout = null\n  }\n}\n\nfunction moveAndClearHold(arg: SignalArgs['interactions:move'], scope: Scope) {\n  const { interaction, pointer, event, eventTarget, duplicate } = arg\n\n  if (!duplicate && (!interaction.pointerIsDown || interaction.pointerWasMoved)) {\n    if (interaction.pointerIsDown) {\n      clearHold(arg)\n    }\n\n    fire(\n      {\n        interaction,\n        pointer,\n        event,\n        eventTarget: eventTarget as Element,\n        type: 'move',\n      },\n      scope,\n    )\n  }\n}\n\nfunction downAndStartHold(\n  { interaction, pointer, event, eventTarget, pointerIndex }: SignalArgs['interactions:down'],\n  scope: Scope,\n) {\n  const timer = interaction.pointers[pointerIndex].hold!\n  const path = domUtils.getPath(eventTarget as Element | Document)\n  const signalArg = {\n    interaction,\n    pointer,\n    event,\n    eventTarget,\n    type: 'hold',\n    targets: [] as EventTargetList,\n    path,\n    node: null,\n  }\n\n  for (const node of path) {\n    signalArg.node = node\n\n    scope.fire('pointerEvents:collect-targets', signalArg)\n  }\n\n  if (!signalArg.targets.length) return\n\n  let minDuration = Infinity\n\n  for (const target of signalArg.targets) {\n    const holdDuration = target.eventable.options.holdDuration\n\n    if (holdDuration < minDuration) {\n      minDuration = holdDuration\n    }\n  }\n\n  timer.duration = minDuration\n  timer.timeout = setTimeout(() => {\n    fire(\n      {\n        interaction,\n        eventTarget,\n        pointer,\n        event,\n        type: 'hold',\n      },\n      scope,\n    )\n  }, minDuration)\n}\n\nfunction tapAfterUp(\n  { interaction, pointer, event, eventTarget }: SignalArgs['interactions:up'],\n  scope: Scope,\n) {\n  if (!interaction.pointerWasMoved) {\n    fire({ interaction, eventTarget, pointer, event, type: 'tap' }, scope)\n  }\n}\n\nfunction install(scope: Scope) {\n  scope.pointerEvents = pointerEvents\n  scope.defaults.actions.pointerEvents = pointerEvents.defaults\n  extend(scope.actions.phaselessTypes, pointerEvents.types)\n}\n\nexport default pointerEvents\n", "import type Interaction from '@interactjs/core/Interaction'\nimport type { ListenerMap, Scope, SignalArgs, Plugin } from '@interactjs/core/scope'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './base'\nimport basePlugin from './base'\n/* eslint-enable import/no-duplicates */\nimport { type PointerEvent } from './PointerEvent'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    holdIntervalHandle?: any\n  }\n}\n\ndeclare module '@interactjs/pointer-events/PointerEvent' {\n  interface PointerEvent<T extends string = any> {\n    count?: number\n  }\n}\n\ndeclare module '@interactjs/pointer-events/base' {\n  interface PointerEventOptions {\n    holdRepeatInterval?: number\n  }\n}\n\nfunction install(scope: Scope) {\n  scope.usePlugin(basePlugin)\n\n  const { pointerEvents } = scope\n\n  // don't repeat by default\n  pointerEvents.defaults.holdRepeatInterval = 0\n  pointerEvents.types.holdrepeat = scope.actions.phaselessTypes.holdrepeat = true\n}\n\nfunction onNew({ pointerEvent }: { pointerEvent: PointerEvent<any> }) {\n  if (pointerEvent.type !== 'hold') return\n\n  pointerEvent.count = (pointerEvent.count || 0) + 1\n}\n\nfunction onFired(\n  { interaction, pointerEvent, eventTarget, targets }: SignalArgs['pointerEvents:fired'],\n  scope: Scope,\n) {\n  if (pointerEvent.type !== 'hold' || !targets.length) return\n\n  // get the repeat interval from the first eventable\n  const interval = targets[0].eventable.options.holdRepeatInterval\n\n  // don't repeat if the interval is 0 or less\n  if (interval <= 0) return\n\n  // set a timeout to fire the holdrepeat event\n  interaction.holdIntervalHandle = setTimeout(() => {\n    scope.pointerEvents.fire(\n      {\n        interaction,\n        eventTarget,\n        type: 'hold',\n        pointer: pointerEvent,\n        event: pointerEvent,\n      },\n      scope,\n    )\n  }, interval)\n}\n\nfunction endHoldRepeat({ interaction }: { interaction: Interaction }) {\n  // set the interaction's holdStopTime property\n  // to stop further holdRepeat events\n  if (interaction.holdIntervalHandle) {\n    clearInterval(interaction.holdIntervalHandle)\n    interaction.holdIntervalHandle = null\n  }\n}\n\nconst holdRepeat: Plugin = {\n  id: 'pointer-events/holdRepeat',\n  install,\n  listeners: ['move', 'up', 'cancel', 'endall'].reduce(\n    (acc, enderTypes) => {\n      ;(acc as any)[`pointerEvents:${enderTypes}`] = endHoldRepeat\n      return acc\n    },\n    {\n      'pointerEvents:new': onNew,\n      'pointerEvents:fired': onFired,\n    } as ListenerMap,\n  ),\n}\n\nexport default holdRepeat\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { Element } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\n\nimport type { PointerEventOptions } from '@interactjs/pointer-events/base'\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    pointerEvents(options: Partial<PointerEventOptions>): this\n    /** @internal */\n    __backCompatOption: (optionName: string, newValue: any) => any\n  }\n}\n\nfunction install(scope: Scope) {\n  const { Interactable } = scope\n\n  Interactable.prototype.pointerEvents = function (\n    this: Interactable,\n    options: Partial<PointerEventOptions>,\n  ) {\n    extend(this.events.options, options)\n\n    return this\n  }\n\n  const __backCompatOption = Interactable.prototype._backCompatOption\n\n  Interactable.prototype._backCompatOption = function (optionName, newValue) {\n    const ret = __backCompatOption.call(this, optionName, newValue)\n\n    if (ret === this) {\n      this.events.options[optionName] = newValue\n    }\n\n    return ret\n  }\n}\n\nconst plugin: Plugin = {\n  id: 'pointer-events/interactableTargets',\n  install,\n  listeners: {\n    'pointerEvents:collect-targets': ({ targets, node, type, eventTarget }, scope) => {\n      scope.interactables.forEachMatch(node, (interactable: Interactable) => {\n        const eventable = interactable.events\n        const options = eventable.options\n\n        if (\n          eventable.types[type] &&\n          eventable.types[type].length &&\n          interactable.testIgnoreAllow(options, node, eventTarget)\n        ) {\n          targets.push({\n            node,\n            eventable,\n            props: { interactable },\n          })\n        }\n      })\n    },\n\n    'interactable:new': ({ interactable }) => {\n      interactable.events.getRect = function (element: Element) {\n        return interactable.getRect(element)\n      }\n    },\n\n    'interactable:set': ({ interactable, options }, scope) => {\n      extend(interactable.events.options, scope.pointerEvents.defaults)\n      extend(interactable.events.options, options.pointerEvents || {})\n    },\n  },\n}\n\nexport default plugin\n", "import type { Plugin } from '@interactjs/core/scope'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './base'\nimport './holdRepeat'\nimport './interactableTargets'\n\nimport * as pointerEvents from './base'\nimport holdRepeat from './holdRepeat'\nimport interactableTargets from './interactableTargets'\n/* eslint-enable import/no-duplicates */\n\nconst plugin: Plugin = {\n  id: 'pointer-events',\n  install(scope) {\n    scope.usePlugin(pointerEvents)\n    scope.usePlugin(holdRepeat)\n    scope.usePlugin(interactableTargets)\n  },\n}\n\nexport default plugin\n", "import type { Interactable } from '@interactjs/core/Interactable'\nimport type { DoAnyPhaseArg, Interaction } from '@interactjs/core/Interaction'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { ActionName, ActionProps, Element } from '@interactjs/core/types'\nimport * as arr from '@interactjs/utils/arr'\nimport { copyAction } from '@interactjs/utils/misc'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\nimport { tlbrToXywh } from '@interactjs/utils/rect'\n\ndeclare module '@interactjs/core/scope' {\n  interface SignalArgs {\n    'interactions:before-action-reflow': Omit<DoAnyPhaseArg, 'iEvent'>\n    'interactions:action-reflow': DoAnyPhaseArg\n    'interactions:after-action-reflow': DoAnyPhaseArg\n  }\n}\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    /**\n     * ```js\n     * const interactable = interact(target)\n     * const drag = { name: drag, axis: 'x' }\n     * const resize = { name: resize, edges: { left: true, bottom: true }\n     *\n     * interactable.reflow(drag)\n     * interactable.reflow(resize)\n     * ```\n     *\n     * Start an action sequence to re-apply modifiers, check drops, etc.\n     *\n     * @param { Object } action The action to begin\n     * @param { string } action.name The name of the action\n     * @returns { Promise } A promise that resolves to the `Interactable` when actions on all targets have ended\n     */\n    reflow<T extends ActionName>(action: ActionProps<T>): ReturnType<typeof doReflow>\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    _reflowPromise: Promise<void>\n    _reflowResolve: (...args: unknown[]) => void\n  }\n}\n\ndeclare module '@interactjs/core/InteractEvent' {\n  interface PhaseMap {\n    reflow?: true\n  }\n}\n\nfunction install(scope: Scope) {\n  const { Interactable } = scope\n\n  scope.actions.phases.reflow = true\n\n  Interactable.prototype.reflow = function (action: ActionProps) {\n    return doReflow(this, action, scope)\n  }\n}\n\nfunction doReflow<T extends ActionName>(\n  interactable: Interactable,\n  action: ActionProps<T>,\n  scope: Scope,\n): Promise<Interactable> {\n  const elements = interactable.getAllElements()\n\n  // tslint:disable-next-line variable-name\n  const Promise = (scope.window as any).Promise\n  const promises: Array<Promise<null>> | null = Promise ? [] : null\n\n  for (const element of elements) {\n    const rect = interactable.getRect(element as HTMLElement | SVGElement)\n\n    if (!rect) {\n      break\n    }\n\n    const runningInteraction = arr.find(scope.interactions.list, (interaction: Interaction) => {\n      return (\n        interaction.interacting() &&\n        interaction.interactable === interactable &&\n        interaction.element === element &&\n        interaction.prepared.name === action.name\n      )\n    })\n    let reflowPromise: Promise<null>\n\n    if (runningInteraction) {\n      runningInteraction.move()\n\n      if (promises) {\n        reflowPromise =\n          runningInteraction._reflowPromise ||\n          new Promise((resolve: any) => {\n            runningInteraction._reflowResolve = resolve\n          })\n      }\n    } else {\n      const xywh = tlbrToXywh(rect)\n      const coords = {\n        page: { x: xywh.x, y: xywh.y },\n        client: { x: xywh.x, y: xywh.y },\n        timeStamp: scope.now(),\n      }\n\n      const event = pointerUtils.coordsToEvent(coords)\n      reflowPromise = startReflow<T>(scope, interactable, element, action, event)\n    }\n\n    if (promises) {\n      promises.push(reflowPromise)\n    }\n  }\n\n  return promises && Promise.all(promises).then(() => interactable)\n}\n\nfunction startReflow<T extends ActionName>(\n  scope: Scope,\n  interactable: Interactable,\n  element: Element,\n  action: ActionProps<T>,\n  event: any,\n) {\n  const interaction = scope.interactions.new({ pointerType: 'reflow' })\n  const signalArg = {\n    interaction,\n    event,\n    pointer: event,\n    eventTarget: element,\n    phase: 'reflow',\n  } as const\n\n  interaction.interactable = interactable\n  interaction.element = element\n  interaction.prevEvent = event\n  interaction.updatePointer(event, event, element, true)\n  pointerUtils.setZeroCoords(interaction.coords.delta)\n\n  copyAction(interaction.prepared, action)\n  interaction._doPhase(signalArg)\n\n  const { Promise } = scope.window as unknown as { Promise: PromiseConstructor }\n  const reflowPromise = Promise\n    ? new Promise<undefined>((resolve) => {\n        interaction._reflowResolve = resolve\n      })\n    : undefined\n\n  interaction._reflowPromise = reflowPromise\n  interaction.start(action, interactable, element)\n\n  if (interaction._interacting) {\n    interaction.move(signalArg)\n    interaction.end(event)\n  } else {\n    interaction.stop()\n    interaction._reflowResolve()\n  }\n\n  interaction.removePointer(event, event)\n\n  return reflowPromise\n}\n\nconst reflow: Plugin = {\n  id: 'reflow',\n  install,\n  listeners: {\n    // remove completed reflow interactions\n    'interactions:stop': ({ interaction }, scope) => {\n      if (interaction.pointerType === 'reflow') {\n        if (interaction._reflowResolve) {\n          interaction._reflowResolve()\n        }\n\n        arr.remove(scope.interactions.list, interaction)\n      }\n    },\n  },\n}\n\nexport default reflow\n", "// eslint-disable-next-line import/no-extraneous-dependencies\nimport interact from '@interactjs/interactjs'\n\nexport default interact\n\nif (typeof module === 'object' && !!module) {\n  try {\n    module.exports = interact\n  } catch {}\n}\n\n;(interact as any).default = interact\n", "/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport '@interactjs/actions/plugin'\nimport '@interactjs/auto-scroll/plugin'\nimport '@interactjs/auto-start/plugin'\nimport '@interactjs/core/interactablePreventDefault'\nimport '@interactjs/dev-tools/plugin'\nimport '@interactjs/inertia/plugin'\nimport '@interactjs/interact'\nimport '@interactjs/modifiers/plugin'\nimport '@interactjs/offset/plugin'\nimport '@interactjs/pointer-events/plugin'\nimport '@interactjs/reflow/plugin'\n\nimport actions from '@interactjs/actions/plugin'\nimport autoScroll from '@interactjs/auto-scroll/plugin'\nimport autoStart from '@interactjs/auto-start/plugin'\nimport interactablePreventDefault from '@interactjs/core/interactablePreventDefault'\nimport devTools from '@interactjs/dev-tools/plugin'\nimport inertia from '@interactjs/inertia/plugin'\nimport interact from '@interactjs/interact'\nimport modifiers from '@interactjs/modifiers/plugin'\nimport offset from '@interactjs/offset/plugin'\nimport pointerEvents from '@interactjs/pointer-events/plugin'\nimport reflow from '@interactjs/reflow/plugin'\n/* eslint-enable import/no-duplicates */\n\ninteract.use(interactablePreventDefault)\n\ninteract.use(offset)\n\n// pointerEvents\ninteract.use(pointerEvents)\n\n// inertia\ninteract.use(inertia)\n\n// snap, resize, etc.\ninteract.use(modifiers)\n\n// autoStart, hold\ninteract.use(autoStart)\n\n// drag and drop, resize, gesture\ninteract.use(actions)\n\n// autoScroll\ninteract.use(autoScroll)\n\n// reflow\ninteract.use(reflow)\n\n// eslint-disable-next-line no-undef\nif (process.env.NODE_ENV !== 'production') {\n  interact.use(devTools)\n}\n\nexport default interact\n;(interact as any).default = interact\n", "/*!\n * Drag & Drop Card (Proprietary)\n * Copyright (c) 2025 <SMARTI AS>\n * Use is governed by EULA.md. Third-party notices: THIRD_PARTY_NOTICES.md\n */\n\n\n// \u2014 bundle-time imports so we don't rely on CDNs in HACS installs \u2014\nimport interact from 'interactjs';\nimport jsyaml from 'js-yaml';\n\n// expose for your existing code that checks window.interact/jsyaml\nif (!window.interact) window.interact = interact;\nif (!window.jsyaml) window.jsyaml = jsyaml;\n\n// pretty console banner + version\nconst VERSION = __VERSION__;\nconsole.info(\n  `%c drag-and-drop-card %c v${VERSION} `,\n  'color:#fff;background:#03a9f4;font-weight:700;padding:2px 6px;border-radius:3px 0 0 3px',\n  'color:#03303a;background:#bdeaff;padding:2px 6px;border-radius:0 3px 3px 0'\n);\n\n// drag-and-drop-card.js\n/* eslint-disable no-console */\nconst LOG = (m, ...a) => console.debug(`[drag-and-drop-card] ${m}`, ...a);\nconsole.info('%c drag-and-drop-card loaded', 'color:#03a9f4;font-weight:700;');\n\nconst raf = () => new Promise((r) => requestAnimationFrame(() => r()));\nconst idle = () => new Promise((r) => (window.requestIdleCallback ? requestIdleCallback(() => r()) : setTimeout(r, 0)));\n\nclass DragAndDropCard extends HTMLElement {\n  _updateTabsA11y_() {\n  const bar = this.tabsBar; if (!bar) return;\n  bar.setAttribute('role', 'tablist');\n  const btns = bar.querySelectorAll('.ddc-tab');\n  btns.forEach((btn, idx) => {\n    const selected = btn.classList.contains('active');\n    btn.setAttribute('role', 'tab');\n    btn.setAttribute('aria-selected', String(selected));\n    btn.setAttribute('tabindex', selected ? '0' : '-1');\n    btn.dataset.index = String(idx);\n  });\n  if (!this.__tabsKeyHandler) {\n    this.__tabsKeyHandler = (e) => {\n      const valid = ['ArrowLeft','ArrowRight','Home','End'];\n      if (!valid.includes(e.key)) return;\n      const list = Array.from(bar.querySelectorAll('.ddc-tab'));\n      if (!list.length) return;\n      e.preventDefault();\n      const focusedIndex = list.findIndex(b => b === document.activeElement);\n      const activeIndex = list.findIndex(b => b.classList.contains('active'));\n      let idx = focusedIndex >= 0 ? focusedIndex : (activeIndex >= 0 ? activeIndex : 0);\n      if (e.key === 'ArrowRight') idx = Math.min(list.length - 1, idx + 1);\n      if (e.key === 'ArrowLeft')  idx = Math.max(0, idx - 1);\n      if (e.key === 'Home')       idx = 0;\n      if (e.key === 'End')        idx = list.length - 1;\n      const target = list[idx];\n      if (target) { try { target.focus({preventScroll:false}); } catch {}; target.click(); }\n    };\n    bar.addEventListener('keydown', this.__tabsKeyHandler);\n  }\n  if (!this.__tabsScrollHandler) {\n    this.__tabsScrollHandler = () => this._updateTabOverflowShadows_?.();\n    bar.addEventListener('scroll', this.__tabsScrollHandler, { passive: true });\n  }\n  this._updateTabOverflowShadows_?.();\n}\n\n\n// ---------------- Dashboard URL helpers ----------------\n_getCurrentDashboardUrlPath_() {\n  // e.g. \"/\", \"/lovelace/0\", \"/myboard/0\", \"/lovelace-myboard/0\"\n  const path = (window.location.pathname || \"/\").replace(/^\\/+/, \"\");\n  const first = path.split(\"/\")[0] || \"lovelace\";\n\n  // Primary dashboard uses \"/lovelace\"\n  if (first === \"lovelace\") return null;\n\n  // Additional dashboards: first segment is the url_path (works for \"/myboard\" and \"/lovelace-myboard\")\n  return first;\n}\n\n// ---------------- Storage-mode persistence (Visual Editor path) ----------------\n\n// Ensure this card has a persistent id in its config (stored in Lovelace)\nasync _ensureCardIdSeededInStorage_() {\n  if (this.config?.id) return this.config.id;\n\n  const id = (crypto?.randomUUID ? crypto.randomUUID() : (\"ddc_\" + Math.random().toString(36).slice(2)));\n  this.config = { ...this.config, id }; // in-memory immediately\n\n  try {\n    const url_path = this._getCurrentDashboardUrlPath_();\n    const ll = await this.hass.callWS(url_path ? { type: \"lovelace/config\", url_path } : { type: \"lovelace/config\" });\n\n    const hit = this._findThisCardPathRecursive_(ll, (c) =>\n      c?.type === \"custom:drag-and-drop-card\" && (!c.id || c.id === id)\n    );\n    if (!hit) return id;\n\n    const { viewIndex, cardIndex, parentPath } = hit;\n    const view = ll.views[viewIndex];\n    const curr = this._getCardByPath_(view, parentPath, cardIndex);\n    const updated = { ...curr, id };\n    this._setCardByPath_(view, parentPath, cardIndex, updated);\n\n    // SAVE with url_path when present\n    await this.hass.callWS(\n      url_path\n        ? { type: \"lovelace/config/save\", url_path, config: ll }\n        : { type: \"lovelace/config/save\", config: ll }\n    );\n  } catch (_) {\n    // YAML dashboards or permission issues: ignore; we still keep the in-memory id\n  }\n  return id;\n}\n\n// Persist this._config back into the stored card (Storage dashboards)\nasync _persistThisCardConfigToStorage_() {\n  await this._ensureCardIdSeededInStorage_();\n\n  // Build what we want to merge (like Visual Editor does at top-level)\n  const partial = {\n    type: \"custom:drag-and-drop-card\",\n    id: this.config?.id,\n    ...this._config,\n  };\n\n  const url_path = this._getCurrentDashboardUrlPath_();\n\n  // LOAD\n  const ll = await this.hass.callWS(url_path ? { type: \"lovelace/config\", url_path } : { type: \"lovelace/config\" });\n\n  // FIND our card by type + id (supports nesting)\n  const hit = this._findThisCardPathRecursive_(ll, (c) =>\n    c?.type === \"custom:drag-and-drop-card\" && c?.id === this.config?.id\n  );\n  if (!hit) throw new Error(\"Card not found in Lovelace config\");\n\n  const { viewIndex, cardIndex, parentPath } = hit;\n  const view = ll.views[viewIndex];\n\n  // MERGE + WRITE\n  const currentCard = this._getCardByPath_(view, parentPath, cardIndex);\n  const merged = { ...currentCard, ...partial };\n  this._setCardByPath_(view, parentPath, cardIndex, merged);\n\n  // SAVE (respect url_path)\n  await this.hass.callWS(\n    url_path\n      ? { type: \"lovelace/config/save\", url_path, config: ll }\n      : { type: \"lovelace/config/save\", config: ll }\n  );\n\n  // Apply locally\n  this.config = merged;\n  this.requestUpdate?.();\n}\n\n// ---- Tree helpers (unchanged) ----\n_findThisCardPathRecursive_(llConfig, predicate) {\n  const views = llConfig?.views || [];\n  for (let vi = 0; vi < views.length; vi++) {\n    const hit = this._findInCardTree_(views[vi], predicate);\n    if (hit) return { viewIndex: vi, ...hit };\n  }\n  return null;\n}\n\n_findInCardTree_(node, predicate, parentPath = []) {\n  const cards = node?.cards || [];\n  for (let ci = 0; ci < cards.length; ci++) {\n    const c = cards[ci];\n    if (predicate(c)) return { cardIndex: ci, parentPath };\n    if (c?.cards?.length) {\n      const sub = this._findInCardTree_(c, predicate, parentPath.concat(ci));\n      if (sub) return sub;\n    }\n  }\n  return null;\n}\n\n_getCardByPath_(view, parentPath, cardIndex) {\n  let container = view;\n  for (const idx of (parentPath || [])) container = container.cards[idx];\n  return container.cards[cardIndex];\n}\n\n_setCardByPath_(view, parentPath, cardIndex, value) {\n  let container = view;\n  for (const idx of (parentPath || [])) container = container.cards[idx];\n  container.cards[cardIndex] = value;\n}\n\n\n_ensureToolbarStyles_() {\n  try {\n    const has = this.shadowRoot.querySelector('#ddc-toolbar-styles');\n    if (has) return;\n    const s = document.createElement('style');\n    s.id = 'ddc-toolbar-styles';\n    s.textContent = `/* ===== Edit toolbar ===== */\n  .ddc-toolbar{\n    position: sticky; top:0; z-index: 50;\n    display:grid; grid-template-columns: 1fr auto 1fr; align-items:center;\n    gap: 12px; padding: 10px 14px;\n    backdrop-filter: blur(8px);\n    background: color-mix(in oklab, var(--card-background-color, rgba(0,0,0,.45)) 80%, transparent);\n    border-bottom: 1px solid var(--divider-color, rgba(255,255,255,.08));\n    box-shadow: 0 2px 10px rgba(0,0,0,.25);\n  }\n  .ddc-t-group{ display:flex; align-items:center; gap:8px; flex-wrap: wrap; }\n  .ddc-toolbar > .ddc-t-group:first-child{ justify-self: start; }\n  .ddc-toolbar > .ddc-t-group:nth-child(3){ justify-self: center; }\n  .ddc-toolbar > .ddc-t-group:last-child{ justify-self: end; }\n\n  .ddc-t-btn{\n    display:inline-flex; align-items:center; gap:8px;\n    height:34px; padding:0 12px; border-radius:10px;\n    font: inherit; line-height: 1; cursor:pointer;\n    background: var(--ha-card-background, rgba(255,255,255,.06));\n    border: 1px solid color-mix(in oklab, currentColor 12%, transparent);\n    color: var(--primary-text-color, #e5e7eb);\n    transition: transform .08s ease, background .15s ease, border-color .15s ease;\n  }\n  .ddc-t-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.1); }\n  .ddc-t-btn:active{ transform: translateY(0); }\n  .ddc-t-btn ha-icon{ --mdc-icon-size:18px; }\n  .ddc-t-btn .label{ white-space:nowrap; }\n\n  .ddc-t-btn.primary{\n    background: var(--primary-color);\n    color: var(--text-primary-color, #fff);\n    border-color: color-mix(in oklab, var(--primary-color) 75%, #000);\n  }\n  .ddc-t-btn.danger{\n    background: var(--error-color, #ef4444);\n    color:#fff;\n    border-color: color-mix(in oklab, var(--error-color) 75%, #000);\n  }\n  .ddc-t-btn.ghost{\n    background: transparent;\n    border-color: transparent;\n    color: var(--secondary-text-color, #cbd5e1);\n  }\n\n  .ddc-t-sep{ width:1px; height:28px; background: var(--divider-color, rgba(255,255,255,.12)); }\n\n  .ddc-t-status{\n    display:inline-flex; align-items:center; gap:8px;\n    padding:6px 12px; border-radius:999px;\n    background: rgba(255,255,255,.06);\n    border: 1px solid color-mix(in oklab, currentColor 12%, transparent);\n    font-size:.875rem;\n  }\n  .ddc-t-dot{ width:10px; height:10px; border-radius:50%; background:#22c55e; }\n  .ddc-t-dot.dirty{ background:#f59e0b; animation: ddc-pulse 1.5s ease-in-out infinite; }\n  .ddc-t-dot.error{ background:#ef4444; }\n  @keyframes ddc-pulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.4)} }\n\n  /* Compact (icon-only) when narrow */\n  .ddc-toolbar.compact .ddc-t-btn .label{ display:none; }\n  /* Super-narrow: stack rows */\n  @media (max-width: 840px){\n    .ddc-toolbar{ grid-template-columns: 1fr; row-gap: 10px; }\n    .ddc-toolbar .ddc-t-sep{ display:none; }\n    .ddc-toolbar > .ddc-t-group{ justify-self: stretch; }\n  }`;\n    this.shadowRoot.appendChild(s);\n  } catch (e) {\n    console.warn('Toolbar style inject failed', e);\n  }\n}\n\n\n\n\n  /* -------------------- Settings Dashboard styling -------------------- */\n\n\n_ensureSettingsStyles_() {\n  if (this.shadowRoot.querySelector('#ddc-settings-styles')) return;\n  const style = document.createElement('style');\n  style.id = 'ddc-settings-styles';\n  style.textContent = `\n  .dialog.modern { max-width: 1920px; width: min(92vw, 1080px); border-radius: 14px; overflow: hidden; }\n  .dlg-head { display:flex; justify-content:space-between; align-items:center; padding:14px 18px; background:var(--primary-color); color:#fff; }\n  .dlg-head h3 { margin:0; font-size:1.1rem; font-weight:700; }\n  .icon-btn { border:0; background:transparent; color:inherit; cursor:pointer; display:grid; place-items:center; }\n  .settings-body { display:grid; gap:16px; padding:16px; max-height:70vh; overflow:auto; grid-template-columns: 1fr; }\n  @media (min-width: 720px){ .settings-body { grid-template-columns: 1fr 1fr; } }\n  .card { background:var(--ha-card-background, #fff); border-radius:12px; box-shadow:0 1px 6px rgba(0,0,0,.08); padding:12px 14px; display:flex; flex-direction:column; gap:10px; }\n  .card h4 { margin:0; font-size:1rem; font-weight:700; color:var(--primary-text-color); }\n  .row { display:flex; align-items:center; gap:12px; }\n  .row label { flex:1; font-size:.95rem; }\n  .row input[type=\"text\"], .row input[type=\"number\"], .row input[type=\"password\"], .row select { flex:1; padding:8px; border:1px solid var(--divider-color, rgba(0,0,0,.2)); border-radius:8px; background:var(--card-background-color, #fff); }\n  .range-wrap { display:flex; align-items:center; gap:12px; }\n  .range-wrap input[type=\"range\"] { flex:1; }\n  .range-wrap output { width:64px; text-align:right; color:var(--secondary-text-color); font-weight:600; }\n  .chips { display:flex; gap:8px; flex-wrap:wrap; }\n  .chip { border:1px solid var(--divider-color, rgba(0,0,0,.25)); padding:6px 10px; border-radius:999px; background:transparent; cursor:pointer; font-size:.9rem; }\n  .chip[aria-pressed=\"true\"] { background:var(--primary-color); color:#fff; border-color:transparent; }\n  .preview { border:1px dashed var(--divider-color, rgba(0,0,0,.25)); border-radius:10px; padding:10px; }\n  /* ---- Grid demo ---- */\n  .grid-demo{\n    --g: 100px;                               /* cell size injected via JS */\n    --line-minor: rgba(255,255,255,.10);\n    --line-major: rgba(255,255,255,.22);\n    --bg-fade   : linear-gradient(180deg, transparent 0%, rgba(0,0,0,.04) 100%);\n\n    position: relative;\n    height: 180px;\n    border-radius: 14px;\n    border: 1px solid var(--divider-color, rgba(0,0,0,.18));\n    overflow: hidden;\n    background:\n      /* subtle base */\n      var(--bg-fade),\n      /* major lines every 5 cells (thicker) - horizontal */\n      repeating-linear-gradient(\n        to bottom,\n        var(--line-major) 0 2px,\n        transparent 2px calc(var(--g) * 5)\n      ),\n      /* major lines every 5 cells (thicker) - vertical */\n      repeating-linear-gradient(\n        to right,\n        var(--line-major) 0 2px,\n        transparent 2px calc(var(--g) * 5)\n      ),\n      /* minor lines each cell - horizontal */\n      repeating-linear-gradient(\n        to bottom,\n        var(--line-minor) 0 1px,\n        transparent 1px var(--g)\n      ),\n      /* minor lines each cell - vertical */\n      repeating-linear-gradient(\n        to right,\n        var(--line-minor) 0 1px,\n        transparent 1px var(--g)\n      );\n    background-color: rgba(0,0,0,.02);\n  }\n\n  .grid-meta-badge{\n    position: absolute; top: 8px; right: 8px;\n    padding: 6px 10px;\n    background: color-mix(in oklab, var(--ha-card-background, #111) 80%, transparent);\n    border: 1px solid var(--divider-color, rgba(0,0,0,.24));\n    border-radius: 999px;\n    font-size: .86rem;\n    letter-spacing:.2px;\n    display:flex; align-items:center; gap:8px;\n    backdrop-filter: blur(4px);\n    pointer-events:none;\n  }\n\n    /* --- NEW nicer headers / captions / swatches / tooltips --- */\n\n    .caption { margin:0 0 8px 0; color:var(--secondary-text-color); font-size:.9rem; }\n\n    .swatches { display:flex; gap:8px; flex-wrap:wrap; }\n    /* Make swatches more obvious as clickable targets by thickening their border */\n    .swatch { width:28px; height:28px; border-radius:6px; border:2px solid rgba(0,0,0,.25); cursor:pointer; position:relative; }\n    .swatch[aria-pressed=\"true\"]::after { content:\"\"; position:absolute; inset:-3px; border:2px solid var(--primary-color); border-radius:8px; }\n\n    .inline-help { display:inline-flex; align-items:center; gap:6px; color:var(--secondary-text-color); font-size:.9rem; }\n    .inline-help ha-icon { opacity:.8; }\n\n    .input-file { display:flex; gap:10px; align-items:center; }\n    .input-file input[type=\"file\"] { display:none; }\n    .input-file .file-btn { border:1px solid var(--divider-color,rgba(0,0,0,.25)); border-radius:8px; padding:8px 12px; cursor:pointer; background:var(--ha-card-background,#fff); }\n    .thumb { width:64px; height:42px; border-radius:6px; background-size:cover; background-position:center; border:1px solid rgba(0,0,0,.12); }\n\n    .divider { height:1px; background:var(--divider-color, rgba(0,0,0,.12)); margin:8px 0; opacity:.7; }\n\n    .section-head { display:flex; align-items:center; gap:8px; margin:0 0 8px 0; padding-bottom:6px; border-bottom:1px solid var(--divider-color, rgba(0,0,0,.12)); }\n    .section-head ha-icon { opacity:.9; }\n    .setting { display:flex; flex-direction:column; gap:6px; margin:8px 0; }\n    .setting .row { display:flex; align-items:center; gap:12px; }\n    .setting .title { display:flex; align-items:center; gap:8px; min-width:220px; }\n    .setting .title ha-icon { opacity:.9; }\n    .setting .control { display:flex; align-items:center; gap:10px; flex:1; }\n    .setting .hint { margin-left:32px; color:var(--secondary-text-color); font-size:.88rem; line-height:1.35; }\n    .setting .suffix { opacity:.6; margin-left:4px; }\n    .range-wrap { display:flex; align-items:center; gap:12px; flex:1; }\n    .range-wrap output { width:64px; text-align:right; color:var(--secondary-text-color); font-weight:600; }\n\n    /* --- Tabs manager UI --- */\n    .tabs-card .tab-row { display:flex; align-items:center; gap:10px; padding:6px 0; border-bottom:1px solid var(--divider-color, rgba(0,0,0,.08)); }\n    .tabs-card .tab-row:last-child { border-bottom:0; }\n    .tabs-card .tab-name { flex:1; display:flex; align-items:center; gap:8px; }\n    .tabs-card .tab-name input { flex:1; padding:6px 8px; border:1px solid var(--divider-color, rgba(0,0,0,.25)); border-radius:8px; background:var(--ha-card-background, #fff); }\n    .tabs-card .tab-actions { display:flex; align-items:center; gap:8px; }\n    .icon-btn.danger { color: var(--error-color, #b00020); }\n\n    /* gradient swatches */\n    .gradients { display:flex; gap:8px; flex-wrap:wrap; }\n    .gradient { width:44px; height:28px; border-radius:8px; border:2px solid rgba(0,0,0,.25); cursor:pointer; position:relative; }\n    .gradient[aria-pressed=\"true\"]::after { content:\"\"; position:absolute; inset:-3px; border:2px solid var(--primary-color); border-radius:10px; }\n\n    /* Section hierarchy */\n    .section-head {\n      display:flex; align-items:center; gap:10px; margin:6px 0 6px;\n    }\n    .section-head ha-icon { opacity:.85; }\n    .section-head h4 {\n      margin:0;\n      font-size:1.1rem;          /* larger than setting labels */\n      font-weight:700;\n      letter-spacing:.2px;\n    }\n\n    /* Setting rows */\n    .setting { padding:10px 0; }\n    .setting .row {\n      display:flex; align-items:center; gap:14px;\n    }\n    .setting .title {\n      flex:0 0 240px;            /* left column width */\n      display:flex; align-items:center; gap:8px;\n      font-weight:600;\n    }\n    .setting .title label, .setting .title span { font-size:.98rem; }\n    .setting .control { flex:1; display:flex; align-items:center; gap:10px; }\n\n    /* Hints and captions */\n    .caption { margin:0 0 4px; color:var(--secondary-text-color); font-size:.92rem; }\n    .hint    { margin:6px 0 0;  color:var(--secondary-text-color); font-size:.88rem; }\n\n    /* Dividers */\n    .divider {\n      height:1px;\n      background:linear-gradient(\n        to right,\n        transparent,\n        var(--divider-color, rgba(0,0,0,.12)),\n        transparent\n      );\n      margin:12px 0;\n    }\n\n    /* Inputs */\n    /* Inputs and selects within the modern dialog now have a more prominent outline for better visibility. */\n    .modern select,\n    .modern input[type=\"text\"],\n    .modern input[type=\"number\"],\n    .modern input[type=\"password\"] {\n      padding:8px 10px;\n      border:2px solid var(--divider-color,rgba(0,0,0,.25));\n      border-radius:10px;\n      background:var(--ha-card-background,#fff);\n    }\n\n    /* Style for the \"Add tab\" text field to make it stand out */\n    #ddc-new-tab-name {\n      flex:1;\n      padding:8px 10px;\n      border:2px solid var(--primary-color);\n      border-radius:10px;\n      background:var(--ha-card-background,#fff);\n      font-weight:600;\n    }\n\n    /* Style the manual grid size input alongside the slider */\n    .range-wrap input[type=\"number\"] {\n      width:80px;\n      padding:6px 8px;\n      border:1px solid var(--divider-color, rgba(0,0,0,.25));\n      border-radius:8px;\n      background:var(--card-background-color, #fff);\n      text-align:center;\n    }\n\n    /* Harmonise the appearance of background configuration sections (image, particles, YouTube) */\n    .setting[data-bg-section] .stack {\n      display:flex;\n      flex-direction:column;\n      gap:10px;\n    }\n    .setting[data-bg-section] .stack input[type=\"text\"],\n    .setting[data-bg-section] .stack input[type=\"number\"],\n    .setting[data-bg-section] .stack select {\n      width:100%;\n      padding:8px 10px;\n      border:2px solid var(--divider-color, rgba(0,0,0,.25));\n      border-radius:10px;\n      background:var(--ha-card-background,#fff);\n    }\n\n    /* Slider + output */\n    .range-wrap { display:flex; align-items:center; gap:10px; width:100%; }\n    .range-wrap input[type=\"range\"] { flex:1; }\n    .range-wrap output {\n      min-width:64px; text-align:right; font-variant-numeric:tabular-nums;\n      color:var(--secondary-text-color);\n    }\n\n    /* Chips row spacing */\n    .chips { display:flex; gap:8px; flex-wrap:wrap; }\n\n    /* ----- Hard category separators ----- */\n    section.card {\n      border-bottom: 2px solid var(--divider-strong, rgba(255,255,255,.15));\n      margin-bottom: 20px;\n      padding-bottom: 24px;\n    }\n\n    section.card:last-of-type {\n      border-bottom: none;\n      margin-bottom: 0;\n      padding-bottom: 0;\n    }\n\n    section.card:hover > .section-head h4 {\n      color: var(--accent-color, var(--primary-color));\n      transition: color .25s ease;\n    }\n\n    .section-head {\n      background: linear-gradient(90deg, var(--accent-color, #2563eb) 0%, transparent 70%);\n      padding: 4px 10px;\n      border-radius: 6px;\n    }\n    .section-head h4 {\n      color: #fff;\n    }\n\n    /* Tighten the empty space after Background image and between sections */\n    section.card .setting:last-child { margin-bottom: 0; padding-bottom: 0; }\n    section.card { margin-bottom: 16px; padding-bottom: 20px; }\n    .section-head { margin-top: 4px; }\n\n    /* Place Tabs section right after Appearance without big gaps */\n    .tabs-card { margin-top: 8px; }\n\n    /* File inputs: clearer Upload/Delete buttons */\n    .input-file { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }\n    .file-btn, #ddc-clear-bg {\n      height: 36px; padding: 0 14px; border-radius: 10px; font-weight: 700;\n      border: 1px solid transparent; cursor: pointer;\n    }\n    .file-btn {\n      background: var(--primary-color); color: var(--text-primary-color, #fff);\n    }\n    #ddc-clear-bg {\n      background: var(--error-color, #ef4444); color:#fff;\n    }\n    #ddc-clear-bg:hover { filter: brightness(1.05); }\n    .file-btn:hover { filter: brightness(1.05); }\n\n    /* BG option controls */\n    .bg-opts { display:grid; grid-template-columns: 220px 1fr; gap:10px 12px; margin-top:8px; }\n    .bg-opts label { display:flex; align-items:center; gap:8px; font-weight:600; }\n    .bg-opts select, .bg-opts input[type=\"range\"] {\n      width: 100%; padding:8px 10px; border:1px solid var(--divider-color,rgba(0,0,0,.25));\n      border-radius:10px; background:var(--ha-card-background,#1e1e1e);\n    }\n    .bg-opts output { min-width:52px; text-align:right; color:var(--secondary-text-color); }\n\n    /* Background image preview thumb */\n    .thumb {\n      width: 72px; height: 42px; border-radius: 8px;\n      background-size: cover; background-position: center center;\n      border: 1px solid var(--divider-color, rgba(0,0,0,.25));\n    }\n\n    /* ---- Render the background image via a pseudo element so opacity doesn't fade content ---- */\n    .ddc-canvas { position: relative; z-index: 0; }\n    .ddc-canvas::before{\n      content:\"\"; position:absolute; inset:0; z-index:0; pointer-events:none;\n      background-image: var(--ddc-bg-image, none);\n      background-repeat: var(--ddc-bg-repeat, no-repeat);\n      background-size: var(--ddc-bg-size, cover);\n      background-position: var(--ddc-bg-position, center center);\n      background-attachment: var(--ddc-bg-attachment, scroll);\n      opacity: var(--ddc-bg-opacity, 1);\n    }\n    .ddc-canvas > * { position: relative; z-index: 1; }\n\n    /* Tabs manager polish */\n    .tab-row {\n      display:flex; align-items:center; gap:10px;\n      margin-bottom:10px; padding:8px;\n      border:1px solid var(--divider-color, rgba(255,255,255,.12));\n      border-radius:8px; background:var(--ha-card-background, rgba(255,255,255,.04));\n    }\n    .tab-row:hover { background: var(--ha-card-background, rgba(255,255,255,.08)); }\n\n    .tab-name { flex:1; display:flex; align-items:center; gap:8px; }\n    .tab-name input {\n      background: var(--ha-card-background, #1f1f1f);\n      border:1px solid var(--divider-color, rgba(255,255,255,.12));\n      color: var(--primary-text-color);\n      padding:6px 8px; border-radius:6px;\n    }\n\n    .tab-icon-wrap { position:relative; display:flex; align-items:center; gap:6px; }\n    .tab-icon-wrap ha-icon { opacity:.9; }\n\n    .mode-chips {\n      display:flex; gap:6px;\n    }\n    .mode-chips .chip {\n      border-radius:10px; padding:4px 8px; font-weight:600;\n      background: var(--ha-card-background, #222); border:1px solid var(--divider-color, rgba(255,255,255,.12));\n    }\n    .mode-chips .chip[aria-pressed=\"true\"] {\n      background: var(--primary-color); color: #fff; border-color: transparent;\n    }\n\n    .grid-meta-badge ha-icon{ opacity:.9; }\n\n    .color-pair {\n      display:flex;\n      gap:8px;\n      align-items:center;\n    }\n    .color-pair input[type=\"color\"] {\n      width:44px;\n      height:36px;\n      border:0;\n      background:transparent;\n      padding:0;\n    }\n    .color-pair input[type=\"text\"] {\n      flex:1;\n    }\n\n    .color-stack {\n      display:flex;\n      flex-direction:column;\n      gap:8px;\n    }\n\n    .color-group {\n      padding:8px 10px;\n      border-radius:10px;\n      border:1px solid var(--divider-color, rgba(0,0,0,.15));\n      background:var(--ha-card-background, rgba(0,0,0,0.12));\n    }\n\n    .color-group-title {\n      font-size:0.75rem;\n      text-transform:uppercase;\n      letter-spacing:.04em;\n      opacity:.8;\n      margin-bottom:4px;\n      display:flex;\n      justify-content:space-between;\n    }\n\n    .swatches,\n    .gradients {\n      display:flex;\n      flex-wrap:wrap;\n      gap:6px;\n      margin-top:4px;\n    }\n\n  .footer { display:flex; justify-content:flex-end; gap:10px; padding:12px 16px; border-top:1px solid var(--divider-color, rgba(0,0,0,.12)); }\n  .btn.primary { background:var(--primary-color); color:#fff; border:0; border-radius:8px; padding:8px 16px; font-weight:600; cursor:pointer; }\n  .btn.secondary { background:transparent; border:1px solid var(--divider-color, rgba(0,0,0,.25)); border-radius:8px; padding:8px 16px; cursor:pointer; }\n  `;\n  this.shadowRoot.appendChild(style);\n}\n\n/* -------------------- HA chrome (header/sidebar) visibility -------------------- */\n_setHeaderVisible_(show = true) {\n  try {\n    // 1) Hide the header containers across HA variants\n    const headers = this._deepQueryAll?.(\n      'app-header, ha-top-app-bar, ha-top-app-bar-fixed, mwc-top-app-bar-fixed, ha-header-bar, app-toolbar, ha-toolbar'\n    ) || [];\n    headers.forEach(el => {\n      if (!el) return;\n      if (el.dataset.ddcPrevDisplayHeader === undefined) {\n        el.dataset.ddcPrevDisplayHeader = el.style.display || '';\n        el.dataset.ddcPrevMinH = el.style.minHeight || '';\n        el.dataset.ddcPrevH = el.style.height || '';\n        el.dataset.ddcPrevVis = el.style.visibility || '';\n      }\n      if (show) {\n        el.style.display = el.dataset.ddcPrevDisplayHeader || '';\n        el.style.minHeight = el.dataset.ddcPrevMinH || '';\n        el.style.height = el.dataset.ddcPrevH || '';\n        el.style.visibility = el.dataset.ddcPrevVis || '';\n        el.removeAttribute('hidden');\n      } else {\n        el.style.display = 'none';\n        el.style.minHeight = '0';\n        el.style.height = '0';\n        el.style.visibility = 'hidden';\n        el.setAttribute('hidden', '');\n      }\n    });\n\n    // 2) Explicitly hide the action items (Search / Assist / Edit menu)\n    //    Belt & suspenders: catch both slot-based and direct buttons/menus.\n    const actionNodes = this._deepQueryAll?.(\n      '[slot=\"actionItems\"], ha-icon-button, ha-button-menu, assist-button, search-input, ha-quick-bar, ha-mwc-menu'\n    ) || [];\n    actionNodes.forEach(el => {\n      if (!el) return;\n      if (el.dataset.ddcPrevDisplayAction === undefined) {\n        el.dataset.ddcPrevDisplayAction = el.style.display || '';\n        el.dataset.ddcPrevVisAction = el.style.visibility || '';\n      }\n      if (show) {\n        el.style.display = el.dataset.ddcPrevDisplayAction || '';\n        el.style.visibility = el.dataset.ddcPrevVisAction || '';\n      } else {\n        el.style.display = 'none';\n        el.style.visibility = 'hidden';\n      }\n    });\n\n    // 3) Adjust CSS variables so layout doesn't reserve header space\n    //    Include an extra var some themes use, and collapse content padding.\n    const containers = [\n      ...(this._deepQueryAll?.('ha-app-layout') || []),\n      ...(this._deepQueryAll?.('home-assistant-main') || []),\n      document.documentElement,\n      document.body\n    ].filter(Boolean);\n\n    containers.forEach(host => {\n      if (!host) return;\n      if (host.dataset.ddcPrevHdrVars === undefined) {\n        host.dataset.ddcPrevHdrVars = JSON.stringify({\n          mdc: host.style.getPropertyValue('--mdc-top-app-bar-height') || '',\n          app: host.style.getPropertyValue('--app-header-height') || '',\n          hdr: host.style.getPropertyValue('--header-height') || '',\n          hah: host.style.getPropertyValue('--ha-header-height') || '',\n          pad: (host.style && (host.style.paddingTop || '')) || ''\n        });\n      }\n      if (show) {\n        try {\n          const prev = JSON.parse(host.dataset.ddcPrevHdrVars || '{}');\n          host.style.setProperty('--mdc-top-app-bar-height', prev.mdc || '');\n          host.style.setProperty('--app-header-height', prev.app || '');\n          host.style.setProperty('--header-height', prev.hdr || '');\n          host.style.setProperty('--ha-header-height', prev.hah || '');\n          if (prev.pad !== undefined) host.style.paddingTop = prev.pad || '';\n        } catch {}\n      } else {\n        host.style.setProperty('--mdc-top-app-bar-height', '0px');\n        host.style.setProperty('--app-header-height', '0px');\n        host.style.setProperty('--header-height', '0px');\n        host.style.setProperty('--ha-header-height', '0px');\n        try { host.style.paddingTop = '0px'; } catch {}\n      }\n    });\n\n    // 4) Some builds keep content under a #contentContainer; collapse its padding too\n    const contentContainers = this._deepQueryAll?.('#contentContainer') || [];\n    contentContainers.forEach(cc => {\n      if (!cc) return;\n      if (cc.dataset.ddcPrevContentPadTop === undefined) {\n        cc.dataset.ddcPrevContentPadTop = (cc.style && (cc.style.paddingTop || '')) || '';\n      }\n      cc.style.paddingTop = show ? (cc.dataset.ddcPrevContentPadTop || '') : '0px';\n    });\n\n    // 5) Hide the main title (e.g. \"Home\")\n    const mainTitles = this._deepQueryAll?.('.main-title') || [];\n    mainTitles.forEach(el => {\n      if (!el) return;\n      if (el.dataset.ddcPrevDisplayTitle === undefined) {\n        el.dataset.ddcPrevDisplayTitle = el.style.display || '';\n        el.dataset.ddcPrevVisTitle = el.style.visibility || '';\n      }\n      if (show) {\n        el.style.display = el.dataset.ddcPrevDisplayTitle || '';\n        el.style.visibility = el.dataset.ddcPrevVisTitle || '';\n      } else {\n        el.style.display = 'none';\n        el.style.visibility = 'hidden';\n      }\n    });\n\n  } catch {}\n}\n\n_setSidebarVisible_(show=true) {\n  try {\n    const sidebars = this._deepQueryAll?.('ha-sidebar') || [];\n    sidebars.forEach(el => {\n      if (!el) return;\n      if (el.dataset.ddcPrevDisplaySidebar === undefined) {\n        el.dataset.ddcPrevDisplaySidebar = el.style.display || '';\n      }\n      el.style.display = show ? el.dataset.ddcPrevDisplaySidebar || '' : 'none';\n    });\n    const drawers = this._deepQueryAll?.('ha-drawer') || [];\n    drawers.forEach(el => {\n      if (!el) return;\n      if (el.dataset.ddcPrevDrawerWidth === undefined) {\n        el.dataset.ddcPrevDrawerWidth = el.style.getPropertyValue('--mdc-drawer-width') || '';\n      }\n      if (show) {\n        el.style.setProperty('--mdc-drawer-width', el.dataset.ddcPrevDrawerWidth || '');\n      } else {\n        el.style.setProperty('--mdc-drawer-width', '0px');\n      }\n      try { if (!show && typeof el.close === 'function') el.close(); } catch {}\n    });\n  } catch {}\n}\n\n_applyHaChromeVisibility_() {\n  try {\n    const showAll = !!this.editMode || this._isInHaEditorPreview?.();\n    // header\n    if (showAll || !this.hideHaHeader) this._setHeaderVisible_(true);\n    else this._setHeaderVisible_(false);\n    // sidebar\n    if (showAll || !this.hideHaSidebar) this._setSidebarVisible_(true);\n    else this._setSidebarVisible_(false);\n\n  } catch {}\n}\n\n\n\n\n_applyBackgroundImageFromConfig() {\n// iOS safety: skip applying huge data URLs that can crash WKWebView\ntry {\n  const ua = navigator.userAgent || '';\n  const isIOS = /iPad|iPhone|iPod/.test(ua);\n  if (isIOS && bg && typeof bg.src === 'string' && bg.src.startsWith('data:') && bg.src.length > 300000) {\n    console.warn('[drag-and-drop-card] Skipping large inline background on iOS for stability.');\n    return;\n  }\n} catch (_) {}\n  const cfg = this._config || {};\n  const bg = cfg.background_image || cfg.bg_image || null;\n  const cont = this.cardContainer;\n  if (!cont) return;\n\n  if (bg && bg.src) {\n    const url = String(bg.src).trim();\n    const repeat = (bg.repeat === true || bg.repeat === 'repeat') ? 'repeat' : 'no-repeat';\n    const opacity = Math.max(0, Math.min(1, Number(bg.opacity ?? 1)));\n    const size = bg.size || 'cover';\n    const position = bg.position || 'center center';\n    const attachment = bg.attachment || 'scroll';\n    const filter = bg.filter || 'none';\n\n    cont.style.setProperty('--ddc-bg-image', url ? `url(\"${url.replace(/\"/g, '\\\"')}\")` : 'none');\n    cont.style.setProperty('--ddc-bg-repeat', repeat);\n    cont.style.setProperty('--ddc-bg-opacity', String(opacity));\n    cont.style.setProperty('--ddc-bg-size', size);\n    cont.style.setProperty('--ddc-bg-position', position);\n    cont.style.setProperty('--ddc-bg-attachment', attachment);\n    cont.style.setProperty('--ddc-bg-filter', filter);\n    cont.classList.add('has-bg-image');\n  } else {\n    cont.style.removeProperty('--ddc-bg-image');\n    cont.style.removeProperty('--ddc-bg-repeat');\n    cont.style.removeProperty('--ddc-bg-opacity');\n    cont.style.removeProperty('--ddc-bg-size');\n    cont.style.removeProperty('--ddc-bg-position');\n    cont.style.removeProperty('--ddc-bg-attachment');\n    cont.style.removeProperty('--ddc-bg-filter');\n    cont.classList.remove('has-bg-image');\n  }\n}\n\n/* ========================================================================== */\n/* Unified background driver (image | particles | youtube | none)             */\n/* ========================================================================== */\n\n_applyBackgroundFromConfig() {\n  try {\n    const mode = (this._config?.background_mode)\n      || (this._config?.background_image?.src ? 'image' : 'none');\n\n    // Always clear dynamic layers first\n    this._destroyParticles_?.();\n    this._destroyYouTube_?.();\n\n    // Clear CSS image if we\u2019re not in image mode\n    if (mode !== 'image') {\n      const cont = this.cardContainer;\n      if (cont) {\n        cont.style.removeProperty('--ddc-bg-image');\n        cont.style.removeProperty('--ddc-bg-repeat');\n        cont.style.removeProperty('--ddc-bg-opacity');\n        cont.style.removeProperty('--ddc-bg-size');\n        cont.style.removeProperty('--ddc-bg-position');\n        cont.style.removeProperty('--ddc-bg-attachment');\n        cont.style.removeProperty('--ddc-bg-filter');\n        cont.classList.remove('has-bg-image');\n      }\n    }\n\n    // Route to the correct backend\n    if (mode === 'image') {\n      this._applyBackgroundImageFromConfig?.();\n      return;\n    }\n\n    if (mode === 'particles') {\n      const cfg = this._config?.background_particles || {};\n      this._attachParticlesBackground_(cfg);\n      return;\n    }\n\n    if (mode === 'youtube') {\n      const cfg = this._config?.background_youtube || {};\n      this._attachYouTubeBackground_(cfg);\n      return;\n    }\n\n    // mode === 'none'\n    // nothing to do\n\n  } catch (e) {\n    console.warn('[drag-and-drop-card] _applyBackgroundFromConfig failed:', e);\n  }\n}\n\n_ensureBgHost_() {\n  const cont = this.cardContainer;\n  if (!cont) return null;\n  let host = cont.querySelector('#ddcBgHost');\n  if (!host) {\n    host = document.createElement('div');\n    host.className = 'ddc-bg-host';\n    host.id = 'ddcBgHost';\n    host.setAttribute('aria-hidden','true');\n    cont.prepend(host);\n  } else {\n    // clear any previous dynamic children\n    host.innerHTML = '';\n  }\n  return host;\n}\n\n/* ---------- tiny loader with cache ---------- */\nasync _loadScriptOnce_(src) {\n  if (!src) throw new Error('script src required');\n  if (!this.__scriptCache) this.__scriptCache = new Map();\n  if (this.__scriptCache.has(src)) return this.__scriptCache.get(src);\n\n  const p = new Promise((resolve, reject) => {\n    const s = document.createElement('script');\n    s.src = src;\n    s.async = true;\n    s.onload = () => resolve(true);\n    s.onerror = () => reject(new Error('failed to load ' + src));\n    document.head.appendChild(s);\n  });\n  this.__scriptCache.set(src, p);\n  return p;\n}\n\n/* ========================================================================== */\n/* Particles.js                                                               */\n/* ========================================================================== */\n\n// Pick the right root for queries (Lit's renderRoot > shadowRoot > self)\n_getRenderRoot_() {\n  return this.renderRoot || this.shadowRoot || this;\n}\n\n// Temporarily make document.getElementById look into our shadow root\n_withScopedDocument_(fn) {\n  const root = this._getRenderRoot_();\n  // If we\u2019re not in shadow, nothing to scope\n  if (!root || root === document || !root.querySelector) return fn();\n\n  const d = document;\n  const originalGetById = d.getElementById.bind(d);\n  const originalQuerySelector = d.querySelector ? d.querySelector.bind(d) : null;\n\n  d.getElementById = (id) => {\n    try {\n      const safe = (window.CSS && CSS.escape) ? CSS.escape(String(id)) : String(id);\n      return root.querySelector('#' + safe) || originalGetById(id);\n    } catch { return originalGetById(id); }\n  };\n  if (originalQuerySelector) {\n    d.querySelector = (sel) => {\n      try { return root.querySelector(sel) || originalQuerySelector(sel); }\n      catch { return originalQuerySelector(sel); }\n    };\n  }\n  try { return fn(); }\n  finally {\n    d.getElementById = originalGetById;\n    if (originalQuerySelector) d.querySelector = originalQuerySelector;\n  }\n}\n\n\n\nasync _ensureParticles_() {\n  if (window.particlesJS) return true;\n  if (!this.__particlesLoadPromise) {\n    const loadScript = (src) => new Promise((resolve, reject) => {\n      const s = document.createElement('script');\n      s.src = src; s.async = true;\n      s.onload = () => resolve(true);\n      s.onerror = () => reject(new Error('Failed to load ' + src));\n      document.head.appendChild(s);\n    });\n    this.__particlesLoadPromise = loadScript('/local/particles.min.js')\n      .catch(() => loadScript('https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js'))\n      .then(() => !!window.particlesJS)\n      .catch(() => false);\n  }\n  return this.__particlesLoadPromise;\n}\n\n_attachParticlesBackground_(cfg = {}) {\n  const host = this._ensureBgHost_?.();\n  if (!host) return;\n\n  // Destroy any existing instance and ensure an empty mount each time\n  try { this._destroyParticles_?.(); } catch {}\n  host.innerHTML = '';\n  const el = document.createElement('div');\n  el.id = 'ddcParticles';\n  el.className = 'particles-js';\n  el.style.position = 'absolute';\n  el.style.inset = '0';\n  host.appendChild(el);\n\n  const DEFAULTS = {\n    particles: {\n      number: { value: 70, density: { enable: true, value_area: 900 } },\n      color: { value: '#ffffff' },\n      shape: { type: 'circle' },\n      opacity: { value: 0.4 },\n      size: { value: 3, random: true },\n      line_linked: { enable: true, distance: 150, color: '#ffffff', opacity: 0.3, width: 1 },\n      move: { enable: true, speed: 2, out_mode: 'out' }\n    },\n    interactivity: {\n      detect_on: 'canvas',\n      events: { onhover: { enable: false }, onclick: { enable: false }, resize: true },\n      modes: { repulse: { distance: 100 }, push: { particles_nb: 4 } }\n    },\n    retina_detect: true\n  };\n\n  const allowPointer = !!cfg.pointer_events;\n  const conf = cfg.config || JSON.parse(JSON.stringify(DEFAULTS)); // clone defaults\n\n  if (allowPointer) {\n    conf.interactivity.events.onhover = { enable: true, mode: 'repulse' };\n    conf.interactivity.events.onclick = { enable: true, mode: 'push' };\n    host.style.pointerEvents = 'auto';\n  } else {\n    host.style.pointerEvents = 'none';\n  }\n\n  const apply = async () => {\n    const ok = await this._ensureParticles_?.();\n    if (!ok || !window.particlesJS) return;\n\n    // Wait a frame to ensure <div id=\"ddcParticles\"> is fully in the shadow DOM\n    await (typeof requestAnimationFrame === 'function'\n      ? new Promise(r => requestAnimationFrame(() => r()))\n      : Promise.resolve());\n\n    await (typeof requestAnimationFrame === 'function'\n      ? new Promise(r => requestAnimationFrame(() => r()))\n      : Promise.resolve());\n\n    // If a config URL is provided, fetch it ourselves and call the synchronous init.\n    // Using .load() breaks in Shadow DOM because it resolves later (outside our scoped document).\n    // If a config URL is provided, fetch it ourselves and init synchronously.\n    // Using .load() breaks in Shadow DOM because it resolves later (outside our scoped document).\n    let finalConf = conf;\n    if (cfg.config_url) {\n      try {\n        const res = await fetch(cfg.config_url, { cache: 'no-store' });\n        finalConf = await res.json();\n      } catch (err) {\n        console.warn('[drag-and-drop-card] Failed to fetch particles config; falling back to defaults', err);\n        finalConf = conf;\n      }\n    }\n\n\n    // Scope getElementById to the shadow root just for the *synchronous* init call.\n    this._withScopedDocument_(() => {\n      if (!Array.isArray(window.pJSDom)) { try { window.pJSDom = []; } catch {} }\n      window.particlesJS('ddcParticles', finalConf);\n    });\n\n    // Keep a handle for cleanup\n    if (Array.isArray(window.pJSDom) && window.pJSDom.length) {\n      this.__particlesInst = window.pJSDom[window.pJSDom.length - 1];\n    }\n  };\n\n  apply();\n  this.__particlesHost = host;\n}\n\n\n_destroyParticles_() {\n  try {\n    if (!Array.isArray(window.pJSDom)) {\n      window.pJSDom = [];\n    }\n    if (window.pJSDom.length) {\n      window.pJSDom.forEach(inst => {\n        try { inst.pJS?.fn?.vendors?.destroy?.(); } catch {}\n        try { inst.pJS?.fn?.vendors?.destroypJS?.(); } catch {}\n      });\n      window.pJSDom.length = 0;\n    }\n  } catch {}\n  if (this.__particlesHost) this.__particlesHost.innerHTML = '';\n  this.__particlesHost = null;\n  this.__particlesInst = null;\n}\n\n/* ========================================================================== */\n/* YouTube video background (muted, looping, \u201Ccover\u201D)                         */\n/* ========================================================================== */\n\n_parseYouTubeId_(input) {\n  if (!input) return null;\n  const s = String(input).trim();\n  const m =\n    s.match(/(?:youtube\\.com\\/.*[?&]v=|youtu\\.be\\/|youtube\\.com\\/embed\\/|youtube\\.com\\/shorts\\/)([A-Za-z0-9_-]{11})/) ||\n    s.match(/^([A-Za-z0-9_-]{11})$/);\n  return m ? m[1] : null;\n}\n\nasync _ensureYouTube_() {\n  if (window.YT?.Player) return true;\n  if (!this.__ytReadyPromise) {\n    this.__ytReadyPromise = new Promise((resolve) => {\n      const ready = () => resolve(true);\n      if (window.YT?.Player) return ready();\n      window.onYouTubeIframeAPIReady = ready;\n      const s = document.createElement('script');\n      s.src = 'https://www.youtube.com/iframe_api';\n      s.async = true; s.onerror = () => resolve(false);\n      document.head.appendChild(s);\n    });\n  }\n  return this.__ytReadyPromise;\n}\n\n_attachYouTubeIframeDirect_(wrap, videoId, { start, end, mute = true, loop = true } = {}) {\n  const params = new URLSearchParams({\n    autoplay: '1',\n    mute: mute ? '1' : '0',\n    controls: '0',\n    playsinline: '1',\n    rel: '0',\n    modestbranding: '1',\n    iv_load_policy: '3',\n    loop: loop ? '1' : '0'\n  });\n  if (loop) params.set('playlist', videoId);\n  if (Number.isFinite(start)) params.set('start', String(start));\n  if (Number.isFinite(end))   params.set('end',   String(end));\n\n  const src = `https://www.youtube.com/embed/${videoId}?${params.toString()}`;\n\n  const iframe = document.createElement('iframe');\n  iframe.src = src;\n  iframe.setAttribute('frameborder', '0');\n  iframe.setAttribute('allow', 'autoplay; encrypted-media; picture-in-picture; fullscreen');\n  iframe.setAttribute('allowfullscreen', 'true');\n  iframe.style.position = 'absolute';\n  iframe.style.inset = '0';\n  iframe.style.width = '100%';\n  iframe.style.height = '100%';\n\n  wrap.appendChild(iframe);\n  this.__ytWrap = wrap;\n  this._layoutYtBackground_?.();\n}\n\n_attachYouTubeBackground_(cfg = {}) {\n  this.__ytSize = (cfg.size || 'cover');\n  this.__ytPosition = (cfg.position || 'center');\n  this.__ytOpacity = (cfg.opacity != null ? Math.max(0, Math.min(1, Number(cfg.opacity))) : 1);\n  this.__ytAttachment = (cfg.attachment || 'scroll');\n  // map position keywords to anchors\n  const posStr = String(this.__ytPosition).toLowerCase();\n  let ax = 0.5, ay = 0.5;\n  if (posStr.includes('left')) ax = 0.0;\n  else if (posStr.includes('right')) ax = 1.0;\n  if (posStr.includes('top')) ay = 0.0;\n  else if (posStr.includes('bottom')) ay = 1.0;\n  if (posStr === 'center' || posStr === 'centre' || posStr === 'middle') { ax = 0.5; ay = 0.5; }\n  this.__ytAx = ax; this.__ytAy = ay;\n\n  const host = this._ensureBgHost_();\n  if (!host) return;\n\n  const videoId = this._parseYouTubeId_(cfg.video_id || cfg.url);\n  if (!videoId) { console.warn('[drag-and-drop-card] No YouTube video id'); return; }\n\n  // wrapper we can size/center for \u201Ccover\u201D\n  const wrap = document.createElement('div');\n  wrap.className = 'yt-bg';\n  // Honour the attachment setting: when \"fixed\" the video should stay put\n  // relative to the viewport rather than scrolling with the card.  For\n  // other values we fall back to absolute positioning within the card\n  // container.  Positioning and sizing of the actual iframe will still\n  // be handled in _layoutYtBackground_.\n  if (this.__ytAttachment === 'fixed') {\n    wrap.style.position = 'fixed';\n    wrap.style.left = '0';\n    wrap.style.top = '0';\n    wrap.style.width = '100%';\n    wrap.style.height = '100%';\n  } else {\n    wrap.style.position = 'absolute';\n    wrap.style.inset = '0';\n  }\n  wrap.style.opacity = String(this.__ytOpacity);\n  wrap.style.filter = 'none';\n  wrap.style.pointerEvents = 'none';  // don\u2019t swallow drags\n  host.appendChild(wrap);\n\n  const frame = document.createElement('div');\n  frame.id = 'ddcYtFrame';\n  frame.style.position = 'absolute';\n  frame.style.left = '0';\n  frame.style.top  = '0';\n  frame.style.width = '100%';\n  frame.style.height= '100%';\n  wrap.appendChild(frame);\n\n  const start = Number.isFinite(cfg.start) ? Number(cfg.start) : undefined;\n  const end   = Number.isFinite(cfg.end)   ? Number(cfg.end)   : undefined;\n  const mute  = cfg.mute !== false;  // default true\n  const loop  = cfg.loop !== false;  // default true\n\n  const init = async () => {\n    const ok = await this._ensureYouTube_();\n    if (!ok || !(window.YT && window.YT.Player)) {\n      this._attachYouTubeIframeDirect_(wrap, videoId, { start, end, mute, loop });\n      if (!this.__ytResizeObs) {\n        this.__ytResizeObs = new ResizeObserver(() => this._layoutYtBackground_?.());\n        try { this.__ytResizeObs.observe(this.cardContainer); } catch {}\n        window.addEventListener('resize', this.__ytOnWinResize = () => this._layoutYtBackground_?.());\n      }\n      return;\n    }\n\n\n    // API path (keep your existing code)\n      this.__ytPlayer = new window.YT.Player(frame, {\n        width: '100%',\n        height: '100%',\n        videoId,\n        playerVars: {\n          autoplay: 1,\n          controls: 0,\n          disablekb: 1,\n          fs: 0,\n          iv_load_policy: 3,\n          modestbranding: 1,\n          rel: 0,\n          playsinline: 1,\n          loop: loop ? 1 : 0,\n          playlist: loop ? videoId : undefined,\n          start: start,\n          end: end\n        },\n      events: {\n        onReady: (e) => {\n          try {\n            if (mute) e.target.mute();\n            e.target.playVideo();\n          } catch {}\n          this._layoutYtBackground_?.();\n        },\n        onStateChange: (e) => {\n          if (e.data === window.YT.PlayerState.ENDED && loop) {\n            try {\n              const s = Number.isFinite(start) ? start : 0;\n              const now = (window.performance && performance.now) ? performance.now() : Date.now();\n              if (!this.__ytLastLoopAt || (now - this.__ytLastLoopAt) > 1500) {\n                this.__ytLastLoopAt = now;\n                e.target.seekTo(s, true);\n                e.target.playVideo();\n              }\n            } catch {}\n          }\n        }\n      }\n    });\n\n    if (!this.__ytResizeObs) {\n      this.__ytResizeObs = new ResizeObserver(() => this._layoutYtBackground_?.());\n      try { this.__ytResizeObs.observe(this.cardContainer); } catch {}\n      window.addEventListener('resize', this.__ytOnWinResize = () => this._layoutYtBackground_?.());\n    }\n  };\n\n  init();\n\n  this.__ytWrap = wrap;\n}\n\n_layoutYtBackground_() {  // Fit a 16:9 iframe according to selected size\n  try {\n    if (!this.__ytWrap) return;\n    // In auto size mode the card container\u2019s natural width may be\n    // larger than the visible viewport.  When computing the video\n    // background dimensions we should use the visible container (the\n    // outer scale wrapper) rather than the full card canvas so the\n    // video covers the same portion of the screen as in dynamic mode.\n    // In other modes we continue to use the card container itself.\n    // Prefer the scale wrapper if it exists (both dynamic and auto modes)\n    let contEl = this.__scaleOuter || this.cardContainer;\n    // First determine the natural (design) size of the card canvas.  These\n    // values correspond to the unscaled width and height of the card.  If\n    // these are unavailable we fall back to the measured dimensions.\n    let natW = 0;\n    let natH = 0;\n    try {\n      natW = parseFloat(this.cardContainer?.style?.width)  || this.cardContainer?.scrollWidth  || this.cardContainer?.offsetWidth  || 0;\n      natH = parseFloat(this.cardContainer?.style?.height) || this.cardContainer?.scrollHeight || this.cardContainer?.offsetHeight || 0;\n    } catch {}\n\n    // Determine the visible canvas size.  In auto mode this is the size\n    // of the scale wrapper (contEl), whereas in dynamic mode we want to\n    // treat the canvas as if it had its natural size (so that the video\n    // covers the full design area before scaling).  After computing the\n    // natural size, the actual on\u2011screen size will be downscaled via the\n    // CSS transform on the card container.\n    let cw;\n    let ch;\n    try {\n      const modeName = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n      if (modeName === 'auto') {\n        const r = contEl.getBoundingClientRect();\n        cw = r.width;\n        // Compute scaled height based on the ratio of visible width to natural width.\n        if (natW > 0) {\n          const scale = Math.min(cw / natW, 1);\n          ch = natH * scale;\n        } else {\n          ch = r.height;\n        }\n      } else {\n        // dynamic mode: treat the canvas as having its natural size.  This\n        // will be downscaled by the CSS transform applied to the\n        // cardContainer.  Using the natural dimensions ensures the video\n        // covers the same area as in auto mode when the design is larger\n        // than the viewport.\n        cw = natW || contEl.getBoundingClientRect().width;\n        ch = natH || contEl.getBoundingClientRect().height;\n      }\n    } catch {\n      // Fallback: use the scale wrapper\u2019s measured dimensions\n      const r = contEl.getBoundingClientRect();\n      cw = r.width;\n      ch = r.height;\n    }\n    const fixedAttach = (this.__ytAttachment === 'fixed');\n    const vw = fixedAttach ? (window.innerWidth  || cw) : cw;\n    const vh = fixedAttach ? (window.innerHeight || ch) : ch;\n\n    if (!cw || !ch) return;\n\n    const size = this.__ytSize || 'cover';\n    const videoAR = 16/9;\n    const contAR  = (fixedAttach ? (vw / vh) : (cw / ch));\n\n    let w, h, left = 0, top = 0;\n\n    if (size === '100% 100%' || size === 'fill' || size === 'stretch'){\n      w = (fixedAttach ? vw : cw); h = (fixedAttach ? vh : ch); left = 0; top = 0;\n    } else if (size === 'contain'){\n      if (contAR > videoAR){\n        h = (fixedAttach ? vh : ch); w = (fixedAttach ? vh : ch) * videoAR;\n        top = 0; left = (cw - w)/2;\n      } else {\n        w = (fixedAttach ? vw : cw); h = (fixedAttach ? vw : cw) / videoAR;\n        left = 0; top = (ch - h)/2;\n      }\n    } else { // default 'cover' or 'auto'\n      if (contAR > videoAR){\n        w = (fixedAttach ? vw : cw); h = (fixedAttach ? vw : cw) / videoAR;\n        left = 0; top = (ch - h)/2;\n      } else {\n        h = (fixedAttach ? vh : ch); w = (fixedAttach ? vh : ch) * videoAR;\n        top = 0; left = (cw - w)/2;\n      }\n    }\n\n    this.__ytWrap.style.overflow = 'hidden';\n    const ax = (this.__ytAx != null) ? this.__ytAx : 0.5;\n    const ay = (this.__ytAy != null) ? this.__ytAy : 0.5;\n    left = ((fixedAttach ? vw : cw) - w) * ax;\n    top  = ((fixedAttach ? vh : ch) - h) * ay;\n    const el = this.__ytWrap.querySelector('iframe') || this.__ytWrap;\n    el.style.width  = `${w}px`;\n    el.style.height = `${h}px`;\n    el.style.left   = `${left}px`;\n    el.style.top    = `${top}px`;\n  } catch {}\n    }\n\n_destroyYouTube_() {\n  try { this.__ytPlayer?.destroy?.(); } catch {}\n  this.__ytPlayer = null;\n\n  if (this.__ytResizeObs) {\n    try { this.__ytResizeObs.disconnect(); } catch {}\n    this.__ytResizeObs = null;\n  }\n  if (this.__ytOnWinResize) {\n    window.removeEventListener('resize', this.__ytOnWinResize);\n    this.__ytOnWinResize = null;\n  }\n\n  if (this.__ytWrap?.parentNode) this.__ytWrap.parentNode.removeChild(this.__ytWrap);\n  this.__ytWrap = null;\n}\n\n\n\n\n/**\n * Evaluate an array of visibility conditions against the current hass state.\n * Returns true if the card should be shown. Conditions follow the same\n * structure as Home Assistant\u2019s per\u2011card visibility settings. Only a subset\n * of condition types are supported: state, numeric_state, screen and user.\n * Unknown condition types are treated as passing.\n *\n * @param {Array} visList Array of condition objects\n * @returns {boolean} true if all conditions evaluate to true, otherwise false\n */\n_evaluateVisibility_(visList) {\n  try {\n    const hass = this.hass || this._hass;\n    // If no conditions defined, always visible\n    if (!Array.isArray(visList) || visList.length === 0) return true;\n    /**\n     * Recursively evaluate a single condition or a group of conditions.  The\n     * visibility editor supports nested groups (and/or) as well as leaf\n     * conditions such as state, numeric_state, screen and user.  Unknown\n     * condition types default to passing.\n     *\n     * @param {Object} cond A visibility condition or group\n     * @returns {boolean} true if the condition/group passes\n     */\n    const evalCond = (cond) => {\n      if (!cond || typeof cond !== 'object') return true;\n      const type = cond.condition || cond.type || 'state';\n      // Group: AND / OR\n      if (type === 'and' || type === 'or') {\n        const children = Array.isArray(cond.conditions) ? cond.conditions : [];\n        // Empty group passes by default\n        if (children.length === 0) return true;\n        if (type === 'and') {\n          return children.every((child) => evalCond(child));\n        }\n        // type === 'or'\n        return children.some((child) => evalCond(child));\n      }\n      if (type === 'state') {\n        const entity = cond.entity;\n        if (!entity) return true;\n        const stateObj = hass?.states?.[entity];\n        if (!stateObj) return false;\n        const st = String(stateObj.state ?? '');\n        if (cond.state !== undefined) {\n          const target = Array.isArray(cond.state) ? cond.state : [cond.state];\n          return target.some((v) => String(v) === st);\n        }\n        if (cond.state_not !== undefined) {\n          const target = Array.isArray(cond.state_not) ? cond.state_not : [cond.state_not];\n          return !target.some((v) => String(v) === st);\n        }\n        // No state specified -> pass\n        return true;\n      }\n      if (type === 'numeric_state') {\n        const entity = cond.entity;\n        if (!entity) return true;\n        const stateObj = hass?.states?.[entity];\n        if (!stateObj) return false;\n        const val = parseFloat(stateObj.state);\n        if (isNaN(val)) return false;\n        if (cond.above !== undefined && !(val > Number(cond.above))) return false;\n        if (cond.below !== undefined && !(val < Number(cond.below))) return false;\n        return true;\n      }\n      if (type === 'screen') {\n        const mq = cond.media_query || cond.query;\n        if (!mq || typeof mq !== 'string') return true;\n        try { return window.matchMedia(mq).matches; } catch { return true; }\n      }\n      if (type === 'user') {\n        const users = Array.isArray(cond.users) ? cond.users : (cond.user ? [cond.user] : []);\n        if (!users.length) return true;\n        // In Home Assistant, hass.user?.id contains the current user ID\n        const uid = hass?.user?.id || hass?.user?.id || null;\n        if (!uid) return true;\n        return users.includes(uid);\n      }\n      // Unknown types pass\n      return true;\n    };\n    // Top-level list uses implicit AND semantics (all must pass)\n    return visList.every((c) => evalCond(c));\n  } catch (e) {\n    console.warn('[ddc:visibility] evaluate error', e);\n    return true;\n  }\n}\n\n/**\n * Apply visibility conditions to all card wrappers. When not in edit mode,\n * wrappers with conditions that evaluate to false are hidden by setting\n * display: none; otherwise they are shown. Cards are always visible in\n * edit mode. Call this after setting hass or updating card configs.\n */\n_applyVisibility_() {\n  try {\n    const wraps = this.cardContainer?.children || [];\n    // Determine the currently active tab; normalize to an integer\n    const currentTabId = this._normalizeTabId(this.activeTab);\n    for (const wrap of wraps) {\n      if (!wrap || !wrap.firstElementChild) continue;\n      // Only apply visibility rules to wrappers belonging to the active tab.\n      // Leave wrappers on other tabs untouched so that _applyActiveTab can\n      // control their display property.\n      const tabId = this._normalizeTabId(wrap.dataset.tabId);\n      if (tabId !== currentTabId) {\n        continue;\n      }\n      const cfg = this._extractCardConfig(wrap.firstElementChild) || {};\n      const visList = cfg.visibility;\n      const shouldShow = this.editMode ? true : this._evaluateVisibility_(visList);\n      wrap.style.display = shouldShow ? '' : 'none';\n    }\n  } catch (e) {\n    console.warn('[ddc:visibility] apply error', e);\n  }\n}\n\n\n  async _onKeyDown_(e) {\n  if (!this.editMode) return;\n  if (this._isTypingTarget_(e.target)) return;\n\n  const gs = Number(this.gridSize || 10);\n  const step = e.altKey ? 1 : (e.shiftKey ? gs * 5 : gs);\n\n  let dx = 0, dy = 0;\n  switch (e.key) {\n    case 'ArrowLeft':  dx = -step; break;\n    case 'ArrowRight': dx =  step; break;\n    case 'ArrowUp':    dy = -step; break;\n    case 'ArrowDown':  dy =  step; break;\n  }\n  if (dx || dy) {\n    e.preventDefault();\n    this._moveSelectionBy_(dx, dy, { liveSnap: !e.altKey });\n    return;\n  }\n\n  if (e.key === 'Delete' || e.key === 'Backspace') {\n    const sel = this._selection && this._selection.size ? Array.from(this._selection) : [];\n    if (!sel.length) return;\n    e.preventDefault();\n    sel.forEach(el => el.remove());\n    this._clearSelection?.();\n    this._resizeContainer?.();\n    this._queueSave?.('delete-key');\n    this._ensurePlaceholderIfEmpty?.();\n    return;\n  }\n\n  if ((e.ctrlKey || e.metaKey) && (e.key === 'd' || e.key === 'D')) {\n    e.preventDefault();\n    await this._duplicateSelection_();\n    return;\n  }\n\n  if ((e.ctrlKey || e.metaKey) && e.key === ']') {\n    e.preventDefault();\n    (this._selection && this._selection.forEach?.(w => this._adjustZ?.(w, +1)));\n    this._queueSave?.('z-up');\n    return;\n  }\n  if ((e.ctrlKey || e.metaKey) && e.key === '[') {\n    e.preventDefault();\n    (this._selection && this._selection.forEach?.(w => this._adjustZ?.(w, -1)));\n    this._queueSave?.('z-down');\n    return;\n  }\n}\n\n\n  async _duplicateSelection_() {\n  if (!this._selection || !this._selection.size) return;\n  const sel = Array.from(this._selection);\n  for (const t of sel) {\n    try {\n      const cfg = this._extractCardConfig?.(t.firstElementChild) || {};\n      const dup = await this._createCard?.(cfg);\n      const w2  = this._makeWrapper?.(dup);\n      if (!dup || !w2) continue;\n\n      w2.style.width  = t.style.width;\n      w2.style.height = t.style.height;\n\n      const step = Number(this.gridSize || 10);\n      const x = (parseFloat(t.getAttribute('data-x')) || 0) + step;\n      const y = (parseFloat(t.getAttribute('data-y')) || 0) + step;\n\n      this._setCardPosition?.(w2, x, y);\n      // Assign a new z-index that is at least 6 so that the duplicated card\n      // always appears above the grid overlay.  Use the higher of the\n      // current highest z-index plus one or the baseline of 6.\n      const nextZVal = (this._highestZ?.() || 0) + 1;\n      w2.style.zIndex = String(Math.max(nextZVal, 6));\n        // Preserve the tab assignment from the original wrapper. Without this,\n        // duplicates incorrectly end up in the currently active tab instead of\n        // inheriting the source tab. See: https://github.com/owner/repo/issues/XYZ\n        try {\n          const tid = t.dataset?.tabId;\n          if (tid) w2.dataset.tabId = tid;\n        } catch {}\n\n      this.cardContainer?.appendChild(w2);\n        // When duplicating we need to wire up a tab selector for the new\n        // wrapper so that the user can reassign it later. Passing the\n        // inherited tab ensures the selector defaults correctly.\n        try { this._addTabSelectorToChip?.(w2, w2.dataset.tabId); } catch {}\n      try { this._rebuildOnce?.(w2.firstElementChild); } catch {}\n      try { this._initCardInteract?.(w2); } catch {}\n    } catch {}\n  }\n  try { this._resizeContainer?.(); } catch {}\n  try { this._queueSave?.('duplicate'); } catch {}\n}\n\n\n  _moveSelectionBy_(dx, dy, { liveSnap = true } = {}) {\n  if (!this._selection || !this._selection.size) return;\n  const sel = Array.from(this._selection);\n\n  const gs = Number(this.gridSize || 10);\n  const fixed = this._isContainerFixed?.();\n  const box = this._getContainerSize?.() || { w: Infinity, h: Infinity };\n\n  const proposed = sel.map(el => {\n    const rawX = parseFloat(el.getAttribute('data-x-raw')) || parseFloat(el.getAttribute('data-x')) || 0;\n    const rawY = parseFloat(el.getAttribute('data-y-raw')) || parseFloat(el.getAttribute('data-y')) || 0;\n    const w = parseFloat(el.style.width)  || el.getBoundingClientRect().width;\n    const h = parseFloat(el.style.height) || el.getBoundingClientRect().height;\n\n    let nx = rawX + dx;\n    let ny = rawY + dy;\n\n    if (fixed) {\n      nx = Math.max(0, Math.min(nx, Math.max(0, box.w - w)));\n      ny = Math.max(0, Math.min(ny, Math.max(0, box.h - h)));\n    }\n\n    const sx = liveSnap ? Math.round(nx / gs) * gs : nx;\n    const sy = liveSnap ? Math.round(ny / gs) * gs : ny;\n\n    return { el, rawX: nx, rawY: ny, snapX: sx, snapY: sy, w, h };\n  });\n\n  if (this.disableOverlap && typeof this._pushCardsOutOfTheWay === 'function') {\n    try { this._pushCardsOutOfTheWay(proposed, dx, dy, liveSnap, gs); } catch {}\n  }\n\n  for (const p of proposed) {\n    p.el.setAttribute('data-x-raw', String(p.rawX));\n    p.el.setAttribute('data-y-raw', String(p.rawY));\n    try { this._setCardPosition?.(p.el, p.snapX, p.snapY); } catch {}\n  }\n  try { this._resizeContainer?.(); } catch {}\n  try { this._queueSave?.('nudge'); } catch {}\n}\n\n\n\n\n  /**\n   * Synchronise the width of the tabs bar with the visible width of the card\n   * container. When the auto-scaling logic shrinks the canvas, the tabs\n   * should shrink too rather than spanning the entire host width. This\n   * helper queries the scale wrapper (if present) or falls back to the\n   * container itself to derive the actual visual width and applies it\n   * directly to the tabs bar. For vertical (left) tabs we reset any\n   * widths to allow the rail to size naturally.\n   */\n\n\n\n_syncTabsWidth_() {\n  try {\n    const mode = String(\n      (this.containerSizeMode || this.container_size_mode || 'dynamic')\n    ).toLowerCase();\n    if (mode === 'auto') {\n      return;\n    }\n\n    const bar = this.tabsBar;\n    if (!bar) return;\n\n    // \uD83D\uDCF1 On narrow viewports, don't clamp the bar at all.\n    // Let CSS handle width and scrolling so you can reach all tabs.\n    try {\n      const vw =\n        window.innerWidth ||\n        document.documentElement?.clientWidth ||\n        0;\n      if (vw && vw <= 768) {\n        bar.style.width = '';\n        bar.style.maxWidth = '';\n        return;\n      }\n    } catch {}\n\n    // For left-side tabs the width should not be clamped; reset and bail.\n    if (this.tabsPosition === 'left') {\n      bar.style.width = '';\n      bar.style.maxWidth = '';\n      return;\n    }\n\n    const ref = this.cardContainer || this.__scaleOuter;\n    if (!ref) return;\n    let width = 0;\n    try {\n      const rect = ref.getBoundingClientRect();\n      width = rect && rect.width ? rect.width : 0;\n    } catch {}\n    if (width <= 0 && this.__scaleOuter && this.__scaleOuter !== ref) {\n      try {\n        const rect2 = this.__scaleOuter.getBoundingClientRect();\n        width = rect2 && rect2.width ? rect2.width : 0;\n      } catch {}\n    }\n    if (width > 0) {\n      bar.style.width = `${width}px`;\n      bar.style.maxWidth = `${width}px`;\n    }\n  } catch {}\n}\n\n\n\n\n\n  _isTypingTarget_(t) {\n  if (!t || t === window || t === document) return false;\n  const editable = t.closest?.('input, textarea, [contenteditable=\"true\"], ha-textfield, mwc-textfield');\n  if (!editable) return false;\n  const tag = editable.tagName?.toLowerCase?.() || '';\n  return tag === 'input' || tag === 'textarea' || editable.hasAttribute?.('contenteditable');\n}\n\n\n  // --- Live reflow + scale while dragging (dynamic mode) ---\n  _scheduleReflowAndScale() {\n    if (this.__reflowRAF) return;\n    this.__reflowRAF = requestAnimationFrame(() => {\n      this.__reflowRAF = null;\n      try {\n        const mode = (this.containerSizeMode || this.container_size_mode || 'dynamic').toLowerCase();\n        if (mode === 'dynamic') {\n          this._resizeContainer?.(); // recompute content extents so d.h grows live\n        }\n      } catch {}\n      try { const __m = String((this.containerSizeMode||this.container_size_mode||'dynamic')).toLowerCase(); (__m==='auto'?this._applyAutoFillNoScale?.():this._applyAutoScale?.()); } catch {}\n    });\n  }\n\n  __ddcBindPointerListeners() {\n    if (this.__ddcPtrBound) return;\n    this.__ddcPtrBound = true;\n    // Use bound methods to allow removeEventListener later if needed\n    this.__onDDCPointerDown = (ev) => {\n      try {\n        // Only react to primary button/touch\n        if (ev.button !== undefined && ev.button !== 0) return;\n        const path = ev.composedPath?.() || [];\n        let hit = null;\n        for (const n of path) {\n          if (n && n.classList && n.classList.contains('card-wrapper')) { hit = n; break; }\n        }\n        if (!hit) return;\n        this.__ddcDragging = true;\n        if (this.__scaleOuter) {\n          this.__prevOverflow = this.__scaleOuter.style.overflow;\n          this.__scaleOuter.style.overflow = 'visible'; // avoid \"ceiling\" clipping\n        }\n        this._scheduleReflowAndScale?.();\n      } catch {}\n    };\n    this.__onDDCPointerMove = (ev) => {\n      try {\n        if (!this.__ddcDragging) return;\n        this._scheduleReflowAndScale?.();\n      } catch {}\n    };\n    this.__onDDCPointerUp = (ev) => {\n      try {\n        if (!this.__ddcDragging) return;\n        this.__ddcDragging = false;\n        if (this.__scaleOuter) this.__scaleOuter.style.overflow = this.__prevOverflow || '';\n        // Final settle\n        try { const __m = String((this.containerSizeMode||this.container_size_mode||'dynamic')).toLowerCase(); (__m==='auto'?this._applyAutoFillNoScale?.():this._applyAutoScale?.()); } catch {}\n      } catch {}\n    };\n    // Attach listeners\n    try { this.addEventListener('pointerdown', this.__onDDCPointerDown, { passive: true }); } catch {}\n    try { this.addEventListener('pointermove', this.__onDDCPointerMove, { passive: true }); } catch {}\n    try { window.addEventListener('pointerup', this.__onDDCPointerUp, { passive: true }); } catch {}\n    try { window.addEventListener('pointercancel', this.__onDDCPointerUp, { passive: true }); } catch {}\n  }\n\n_renderEditToolbar_() {\n  // Remove any existing\n  this.shadowRoot.querySelectorAll('.ddc-toolbar').forEach(n => n.remove());\n\n  // \uD83D\uDD39 ensure styles exist\n  this._ensureToolbarStyles_();  // <\u2014 ADD THIS LINE\n\n  const bar = document.createElement('div');\n  bar.className = 'ddc-toolbar';\n\n  // --- Left: Build\n  const gBuild = document.createElement('div'); gBuild.className = 'ddc-t-group';\n  gBuild.append(\n    this._mkBtn_('add_card', 'mdi:plus-box', 'Add card (A)', 'primary'),\n    this._mkBtn_('snap_toggle', 'mdi:magnet', 'Toggle snap (G)'),\n    this._mkBtn_('align_grid', 'mdi:grid', 'Align to grid')\n  );\n\n  // --- Middle: Status\n  const gStatus = document.createElement('div'); gStatus.className = 'ddc-t-group';\n  const pill = document.createElement('div'); pill.className = 'ddc-t-status';\n  const dot  = document.createElement('div'); dot.className = 'ddc-t-dot' + (this.__dirty ? ' dirty' : '');\n  const txt  = document.createElement('span');\n  txt.textContent = this.__dirty ? 'Unsaved changes' : `Saved${this.__lastSavedAt ? ' \u00B7 ' + this.__lastSavedAt : ''}`;\n  pill.append(dot, txt);\n  gStatus.appendChild(pill);\n\n  // --- Right: System\n  const gSys = document.createElement('div'); gSys.className = 'ddc-t-group';\n  gSys.append(\n    this._mkBtn_('reload',    'mdi:refresh',             'Reload (R)', 'ghost'),          // \u2190 make subtle\n    this._mkBtn_('open_hads', 'mdi:alpha-h-box-outline', 'Open HACS/HADS', 'ghost'),      // \u2190 make subtle\n    this._mkBtn_('apply',     'mdi:content-save',        'Apply / Save (S)', 'primary'),\n    this._mkBtn_('exit_edit', 'mdi:logout-variant',      'Exit edit (Esc)', 'danger')\n  );\n\n  // Layout rows (wrap on narrow)\n  const rowL = document.createElement('div'); rowL.className = 'ddc-t-group ddc-t-row'; rowL.append(gBuild);\n  const rowM = document.createElement('div'); rowM.className = 'ddc-t-group ddc-t-row'; rowM.append(gStatus);\n  const rowR = document.createElement('div'); rowR.className = 'ddc-t-group ddc-t-row'; rowR.append(gSys);\n\n  bar.append(rowL, document.createElement('div')).lastChild.className = 'ddc-t-sep';\n  bar.append(rowM, document.createElement('div')).lastChild.className = 'ddc-t-sep';\n  bar.append(rowR);\n\n  // Click handling (single delegate)\n  bar.addEventListener('click', (e) => {\n    const b = e.target.closest('[data-action]'); if (!b) return;\n    this._onToolbarAction_(b.dataset.action, { button: b, bar, dot, txt });\n  });\n\n  // Attach to shadowRoot\n  this.shadowRoot.appendChild(bar);\n\n  // \uD83D\uDD39 Responsive: collapse labels when narrow\n  try {\n    if (this.__toolbarRO) this.__toolbarRO.disconnect();\n    this.__toolbarRO = new ResizeObserver(entries => {\n      for (const e of entries) {\n        bar.classList.toggle('compact', e.contentRect.width < 980);\n      }\n    });\n    this.__toolbarRO.observe(bar);\n  } catch {}\n\n  // Keys while editing (unchanged)\n  this.__toolbarKeyHandler = (ev) => {\n    if (!this.editMode && !this.isEditing) return;\n    if (ev.key === 'a' || ev.key === 'A') return this._onToolbarAction_('add_card');\n    if (ev.key === 's' || ev.key === 'S') return this._onToolbarAction_('apply');\n    if (ev.key === 'r' || ev.key === 'R') return this._onToolbarAction_('reload');\n    if (ev.key === 'g' || ev.key === 'G') return this._onToolbarAction_('snap_toggle');\n    if (ev.key === 'Escape')             return this._onToolbarAction_('exit_edit');\n  };\n  window.addEventListener('keydown', this.__toolbarKeyHandler);\n}\n\n\n// Make it async so we can await inside\nasync _onToolbarAction_(action, ctx = {}) {\n\n\n  \n  switch (action) {\n    \n    case 'add_card':\n      (this._openAddCardDialog_?.() || this._addNewCard_?.() || this._openEntityPicker_?.());\n      break;\n\n    case 'snap_toggle': {\n      this.dragLiveSnap = !this.dragLiveSnap;\n      this._initInteract?.();\n      this._toast_?.(`Live snap ${this.dragLiveSnap ? 'ON' : 'OFF'}`);\n      break;\n    }\n\n    case 'align_grid':\n      this._alignAllToGrid_?.(this.gridSize);\n      break;\n\n    case 'reload':\n      this._reloadLayout_?.();\n      break;\n\n    case 'open_hads':\n      (this._openHACS_?.() ||\n       window.open('/hacs', '_blank') ||\n       window.open('/hacsfiles', '_blank'));\n      break;\n\n    case 'apply': {\n      // No need for 'async' on done()\n      const done = () => {\n        this._setDirty_(false);\n        if (ctx?.txt) ctx.txt.textContent = `Saved \u00B7 ${this.__lastSavedAt}`;\n        if (ctx?.dot) ctx.dot.classList.remove('dirty','error');\n      };\n      const fail = () => { if (ctx?.dot) ctx.dot.classList.add('error'); };\n\n      try {\n        if (this._saveLayoutNow_) {\n          await this._saveLayoutNow_();\n        } else if (this._persistThisCardConfigToStorage_) {\n          await this._persistThisCardConfigToStorage_();\n        } else {\n          this._queueSave?.('toolbar-apply', true);\n        }\n        this.__lastSavedAt = new Date().toLocaleTimeString();\n        done();\n      } catch (e) {\n        console.warn(e);\n        fail();\n      }\n      break;\n    }\n\n    case 'exit_edit':\n      (this._toggleEditMode?.(false) || this._exitEditMode_?.() || (this.isEditing = false));\n      // Clean up hotkeys when leaving\n      if (this.__toolbarKeyHandler) {\n        window.removeEventListener('keydown', this.__toolbarKeyHandler);\n        this.__toolbarKeyHandler = null;\n      }\n      // \uD83D\uDD39 Clean up the resize observer\n      if (this.__toolbarRO) { try { this.__toolbarRO.disconnect(); } catch{} this.__toolbarRO = null; }\n\n      // Optionally remove toolbar\n      this.shadowRoot.querySelectorAll('.ddc-toolbar').forEach(n => n.remove());\n      break;\n  }\n}\n\n  _ensureScaleWrapper() {\n  const c = this.cardContainer;\n  if (!c) return;\n  if (this.__scaleOuter && this.__scaleOuter.contains(c)) return;\n\n  // Create a layout box that will reflect the *visual* size\n  const outer = document.createElement('div');\n  outer.className = 'ddc-scale-outer';\n  Object.assign(outer.style, {\n    position: 'relative',\n    width: '100%',\n    overflow: 'hidden'\n  });\n\n  // Insert wrapper around the current container\n  if (c.parentNode) {\n    c.parentNode.insertBefore(outer, c);\n    outer.appendChild(c);\n  }\n\n  // Make the inner container absolutely positioned and transformable\n  Object.assign(c.style, {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    transformOrigin: 'top left'\n  });\n\n  this.__scaleOuter = outer;\n}\n\n\n  __booting = false;  \n\n  constructor() {\n    super();\n    if (!this.shadowRoot) this.attachShadow({ mode: 'open' });\n    this.__rebuiltCards = new WeakSet();\n  }\n  // === GRID SELECT PATCH START (fields) ===\n  _gridCanvas = null;\n  _gridCtx = null;\n  _gridCols = 0;\n  _gridRows = 0;\n  _gridCellSize = 0;\n  _gridDown = false;\n  _gridStartCol = -1;\n  _gridStartRow = -1;\n  _gridHoverCol = -1;\n  _gridHoverRow = -1;\n  _gridCurrCol = -1;\n  _gridCurrRow = -1;\n  _gridDirty = false;\n  _gridRAF = 0;\n  _gridTile = null;\n  __gridPrevEditMode = undefined;\n  __gridRO = null;\n  __gridPollT = null;\n  // === GRID SELECT PATCH END (fields) ===\n\n\n  \n  // --- DDC patch: deep card_mod detection + one-time rebuild helper ---\n  _hasCardModDeep(cfg) {\n    try {\n      if (!cfg || typeof cfg !== 'object') return false;\n      if (cfg.card_mod || cfg.type === 'custom:mod-card') return true;\n      if (cfg.card) return this._hasCardModDeep(cfg.card);\n      if (Array.isArray(cfg.cards)) {\n        for (const c of cfg.cards) { if (this._hasCardModDeep(c)) return true; }\n      }\n      return false;\n    } catch { return false; }\n  }\n  _rebuildOnce(el) {\n    try {\n      if (!el) return;\n      if (!this.__rebuiltCards) this.__rebuiltCards = new WeakSet();\n      if (this.__rebuiltCards.has(el)) return;\n      this.__rebuiltCards.add(el);\n      // Fire rebuild from the child card so Lovelace/card-mod re-attaches without recreating DDC itself\n      el.dispatchEvent(new Event('ll-rebuild', { bubbles: true, composed: true }));\n    } catch {}\n  }\n\n\n  // Deep query across shadow roots\n  _deepQueryAll(selector, root = document) {\n    const results = [];\n    const visit = (node) => {\n      if (!node) return;\n      if (node.querySelectorAll) {\n        try {\n          node.querySelectorAll(selector).forEach(el => results.push(el));\n        } catch {}\n      }\n      // Recurse into shadow roots\n      const treeWalker = document.createTreeWalker(node, NodeFilter.SHOW_ELEMENT, null);\n      let el = node;\n      while (el) {\n        const sr = el.shadowRoot;\n        if (sr) visit(sr);\n        el = treeWalker.nextNode();\n      }\n    };\n    visit(root);\n    return results;\n  }\n\n\n  // Keep visible editors (HA sidebar or in-card modal) in sync with current storage_key\n  _syncEditorsStorageKey() {\n    try {\n      const val = this.storageKey || '';\n      // Update any open editor input fields for this card\n      // We look for our known editor markup within the DOM and set the storage key input.\n      const nodes = this._deepQueryAll('#storage_key');\n      nodes.forEach((inp) => {\n        try {\n          if (inp && inp.tagName === 'INPUT') {\n            if (inp.value !== val) {\n              inp.value = val;\n              // Fire input event so editor UIs update their internal state\n              inp.dispatchEvent(new Event('input', { bubbles: true }));\n              inp.dispatchEvent(new Event('change', { bubbles: true }));\n            }\n          }\n        } catch {}\n      });\n    } catch {}\n  }\n\n  // Inside class DragAndDropCard extends ...\n  static _genKey() {\n    const id =\n      globalThis.crypto?.randomUUID?.() ||\n      `${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 8)}`;\n    return `layout_${id}`;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Card picker metadata\n  //\n  // Home Assistant\u2019s Lovelace card picker inspects certain static getters\n  // on custom card classes to discover their type, title, description and\n  // associated icon.  Without these, the editor may not display the card in\n  // its \u201CAdd card\u201D dialog.  By providing these properties, we ensure the\n  // drag\u2011and\u2011drop card is discoverable and properly categorized.  Note that\n  // the returned `type` includes the `custom:` prefix, matching the type\n  // string used in YAML configuration.\n  static get type() {\n    // When registering with Home Assistant\u2019s card picker via window.customCards,\n    // the type should be the element tag itself (without the `custom:`\n    // prefix).  Returning the tag here makes it consistent with the\n    // registration below and prevents mismatches when the card is added\n    // through the visual editor.\n    return 'drag-and-drop-card';\n  }\n  static get title() {\n    return 'Drag & Drop Card';\n  }\n  static get description() {\n    return 'Flexible grid layout card with drag\u2011and\u2011drop editing.';\n  }\n  static get icon() {\n    return 'mdi:cursor-move';\n  }\n  // Place the card into the `custom` group in the picker\n  static get group() {\n    return 'custom';\n  }\n\n  static getStubConfig(/* hass, entities, entitiesFallback */) {\n    // Return default configuration for a new drag\u2011and\u2011drop card.  These values\n    // initialize the card in \u201Cauto\u201D mode with a 20px grid and no hero\n    // background image.  The storage_key is generated once so each new\n    // card has its own persistent layout key.\n    return {\n      type: 'custom:drag-and-drop-card',\n      storage_key: this._genKey(),\n      grid: 20,\n      drag_live_snap: true,\n      auto_save: true,\n      auto_save_debounce: 800,\n      container_size_mode: 'auto',\n      container_background: 'linear-gradient(135deg, #1e3a8a, #0ea5e9)',\n      card_background: 'linear-gradient(135deg, #111827, #1f2937)',\n      debug: false,\n      disable_overlap: false,\n      auto_resize_cards: true,\n      background_mode: 'none',\n      animate_cards: true,\n      container_preset_orientation: 'auto',\n      edit_mode_pin: '',\n      container_fixed_width: null,\n      container_fixed_height: null,\n      container_preset: 'fullhd',\n      card_shadow: true,\n      hide_HA_Header: false,\n      hide_HA_Sidebar: false,\n      screen_saver_enabled: true,\n      screen_saver_delay: 1500000,\n      tabs: [\n        { id: 'home', label: 'Home', icon: 'mdi:home', label_mode: 'both' }\n      ],\n      default_tab: 'home'\n    };\n  }\n\n\n\n\n\n\n  /* ------------------------- Mini config editor (HA) ------------------------- */\n// Replace your existing static getConfigElement() with the version below.\n// It uses HA-native inputs (ha-textfield, ha-select, ha-formfield + ha-checkbox)\n// for consistent styling, clearer alignment, helper text, and a subtle animation\n// for the Apply button when there are unapplied changes.\n\nstatic getConfigElement() {\n    // -------------------------------------------------------------------------\n    // Simplified visual editor: only expose the storage key.\n    // All other settings should be edited from the dashboard settings.  The\n    // editor renders a single HA textfield and propagates changes via the\n    // `config-changed` event.\n    const editor = document.createElement('div');\n    editor.style.display = 'grid';\n    editor.style.gridTemplateColumns = '1fr';\n    editor.style.rowGap = '12px';\n    // Create storage key input field\n    const text = document.createElement('ha-textfield');\n    text.id = 'storage_key';\n    text.label = 'Storage key';\n    text.placeholder = 'Auto-generated if left blank';\n    editor.appendChild(text);\n    // Provide helper text below the input\n    const helper = document.createElement('div');\n    helper.style.fontSize = '0.85rem';\n    helper.style.opacity = '0.7';\n    helper.textContent = 'Unique key for saving layout positions. Leave blank to auto\u2011generate.';\n    editor.appendChild(helper);\n    // setConfig: populate input from incoming config\n    editor.setConfig = (config = {}) => {\n      editor._config = { type: config.type || 'custom:drag-and-drop-card', ...config };\n      // Auto-generate a storage key if not provided\n      if (!editor._config.storage_key) {\n        editor._config.storage_key = `layout_${(crypto?.randomUUID?.() || Date.now().toString(36))}`;\n      }\n      text.value = editor._config.storage_key || '';\n    };\n    // getConfig: return updated configuration containing only the storage_key\n    editor.getConfig = () => {\n      const base = { ...(editor._config || {}) };\n      base.type = 'custom:drag-and-drop-card';\n      base.storage_key = text.value || '';\n      return base;\n    };\n    // Dispatch config-changed event when the value changes\n    text.addEventListener('input', () => {\n      editor.dispatchEvent(new CustomEvent('config-changed', { detail: { config: editor.getConfig() } }));\n    });\n    return editor;\n\n    // -------------------------------------------------------------------------\n    // The original editor code is below but will never be executed.\n    // -------------------------------------------------------------------------\n\n  // ---- Utility helpers ----\n  const updateButtons = () => {\n    const dirty = isDirty();\n    applyBtn.disabled = !dirty;\n  };\n\n  const fire = async () => {\n    const newConfig = el.getConfig();\n    el.dispatchEvent(new CustomEvent('config-changed', { detail: { config: newConfig } }));\n    // Re-check button states after applying\n    updateButtons();\n\n    try {\n      if (this.storageKey) {\n        const optsToSave = this._exportableOptions ? this._exportableOptions() : newConfig;\n        await this._saveOptionsToBackend(this.storageKey, optsToSave);\n      }\n    } catch {}\n\n\n    // Persist immediately (storage dashboards first; fallback to YAML patch)\n    try {\n      await this._persistThisCardConfigToStorage_();\n    } catch (e) {\n      try {\n        const opts = this._exportableOptions ? this._exportableOptions() : newConfig;\n        await this._persistOptionsToYaml?.(opts, { patchAllInCurrentViewIfNoKey: true });\n      } catch {}\n    }\n\n    try { this._applyBackgroundFromConfig?.(); } catch {}\n\n  };\n\n  const toggleSizeControls = () => {\n    const mode = el.querySelector('#sizeMode')?.value ?? el.querySelector('#ddc-setting-sizeMode')?.value ?? 'dynamic';\n    el.querySelector('#sizeCustom').style.display = mode === 'fixed_custom' ? 'inline-flex' : 'none';\n    el.querySelector('#sizePresetWrap').style.display = mode === 'preset' ? 'inline-flex' : 'none';\n  };\n\n  // Keep reference to controls\n  const applyBtn  = el.querySelector('#applyBtn');\n  const revertBtn = el.querySelector('#revertBtn');\n\n  // Make menus stable in HA dialog without blocking clicks\n  ['#sizeMode','#sizePreset','#sizeOrientation'].forEach((sel) => {\n    const s = el.querySelector(sel);\n    if (!s) return;\n    try { s.fixedMenuPosition = true; } catch {}\n    s.addEventListener('closed', (e) => e.stopPropagation());\n  });\n\n  // --- Public API: set incoming values (preserve unknown keys)\n  el.setConfig = (config = {}) => {\n    el._config = { type: config.type || 'custom:drag-and-drop-card', ...config };\n\n    // Auto-generate storage key once if not present\n    if (!el._config.storage_key) {\n      el._config.storage_key = `layout_${(crypto?.randomUUID?.() || Date.now().toString(36))}`;\n      el.__autokeyPending = true;\n    }\n\n    // Populate inputs\n    el.querySelector('#storage_key').value = el._config.storage_key || '';\n    el.querySelector('#grid').value = el._config.grid ?? 10;\n    el.querySelector('#liveSnap').checked = !!el._config.drag_live_snap;\n    el.querySelector('#autoSave').checked = el._config.auto_save !== false;\n    el.querySelector('#autoSaveDebounce').value = el._config.auto_save_debounce ?? 800;\n    el.querySelector('#containerBg').value = el._config.container_background ?? 'transparent';\n    el.querySelector('#cardBg').value = el._config.card_background ?? 'var(--ha-card-background, var(--card-background-color))';\n    el.querySelector('#debug').checked = !!el._config.debug;\n    el.querySelector('#noOverlap').checked = !!el._config.disable_overlap;\n    el.querySelector('#autoResize').checked = !!el._config.auto_resize_cards;\n\n    // Set the animate cards checkbox based on the incoming config. This\n    // defaults to false when not specified. When true, cards will animate\n    // into view on tab changes or refresh.\n    el.querySelector('#animateCards').checked = !!el._config.animate_cards;\n\n\n    const sizeModeEl = el.querySelector('#sizeMode') || el.querySelector('#ddc-setting-sizeMode');\n    if (sizeModeEl) sizeModeEl.value = el._config.container_size_mode || 'dynamic';\n    el.querySelector('#sizeW').value = el._config.container_fixed_width ?? '';\n    el.querySelector('#sizeH').value = el._config.container_fixed_height ?? '';\n    el.querySelector('#sizeOrientation').value = el._config.container_preset_orientation || 'auto';\n\n    // Build size preset list once (grouped)\n    const presetSelect = el.querySelector('#sizePreset');\n    if (!presetSelect.__filled) {\n      const groups = (this._sizePresets?.() || []).reduce((acc, p) => {\n        (acc[p.group || 'other'] ||= []).push(p); return acc;\n      }, {});\n      presetSelect.innerHTML = '';\n      for (const [group, items] of Object.entries(groups)) {\n        const optgroup = document.createElement('optgroup');\n        optgroup.label = group.replace(/(^.|-.?)/g, s => s.toUpperCase());\n        items.forEach(preset => {\n          const item = document.createElement('mwc-list-item');\n          item.value = preset.key;\n          item.textContent = `${preset.label} (${preset.w}\u00D7${preset.h})`;\n          optgroup.appendChild(item);\n        });\n        // Note: <optgroup> isn't supported inside mwc-menu; append flat items with prefix\n        // so we create visual grouping by inserting disabled headers\n        const header = document.createElement('mwc-list-item');\n        header.setAttribute('disabled', '');\n        header.textContent = `\u2014 ${optgroup.label} \u2014`;\n        presetSelect.appendChild(header);\n        Array.from(optgroup.children).forEach(child => presetSelect.appendChild(child));\n      }\n      presetSelect.__filled = true;\n    }\n    if (el._config.container_preset) presetSelect.value = el._config.container_preset;\n\n    toggleSizeControls();\n    updateButtons();\n\n    // If we just generated a key, immediately persist it so the dashboard saves it\n    if (el.__autokeyPending) {\n      el.__autokeyPending = false;\n      fire();\n    }\n  };\n\n  // --- Public API: collect values into config\n  el.getConfig = () => {\n    const base = { ...(el._config || {}) };\n    base.storage_key = el.querySelector('#storage_key').value || '';\n    base.grid = Number(el.querySelector('#grid').value || 10);\n    base.drag_live_snap = !!el.querySelector('#liveSnap').checked;\n    base.auto_save = !!el.querySelector('#autoSave').checked;\n    base.auto_save_debounce = Number(el.querySelector('#autoSaveDebounce').value || 800);\n    base.container_background = el.querySelector('#containerBg').value || 'transparent';\n    base.card_background = el.querySelector('#cardBg').value || 'var(--ha-card-background, var(--card-background-color))';\n    base.debug = !!el.querySelector('#debug').checked;\n    base.disable_overlap = !!el.querySelector('#noOverlap').checked;\n    base.auto_resize_cards = !!el.querySelector('#autoResize').checked;\n    // === Background persistence ===\n    try {\n      const selBgMode        = el.querySelector('#ddc-bg-mode');\n      const inpBgImg         = el.querySelector('#ddc-setting-bgImg');\n      const selBgRepeat      = el.querySelector('#ddc-bg-repeat');\n      const selBgSize        = el.querySelector('#ddc-bg-size');\n      const selBgPosition    = el.querySelector('#ddc-bg-position');\n      const selBgAttachment  = el.querySelector('#ddc-bg-attachment');\n      const rngBgOpacity     = el.querySelector('#ddc-bg-opacity');\n      const inpParticlesUrl  = el.querySelector('#ddc-particles-url');\n      const chkParticlesPtr  = el.querySelector('#ddc-particles-pointer');\n      const inpYtUrl         = el.querySelector('#ddc-youtube-url');\n      const inpYtStart       = el.querySelector('#ddc-youtube-start');\n      const inpYtEnd         = el.querySelector('#ddc-youtube-end');\n      const chkYtMute        = el.querySelector('#ddc-youtube-mute');\n      const chkYtLoop        = el.querySelector('#ddc-youtube-loop');\n      const selYtSize        = el.querySelector('#ddc-youtube-size');\n      const selYtPosition    = el.querySelector('#ddc-youtube-position');\n      const selYtAttachment  = el.querySelector('#ddc-youtube-attachment');\n      const rngYtOpacity     = el.querySelector('#ddc-youtube-opacity');\n\n      const mode = selBgMode?.value || 'none';\n      base.background_mode = mode;\n\n      const clamp01 = (v) => Math.max(0, Math.min(1, v));\n      const pctTo01 = (el) => {\n        const v = parseFloat(el?.value || '100');\n        if (!Number.isFinite(v)) return 1;\n        return clamp01(v / 100);\n      };\n\n      // Build objects, omitting undefined keys\n      const pick = (o) => Object.fromEntries(Object.entries(o).filter(([,v]) => v !== undefined && v !== null && v !== ''));\n\n      // Image\n      if (mode === 'image') {\n        const srcVal = (inpBgImg?.value || '').trim();\n        base.background_image = pick({\n          src: srcVal || undefined,\n          repeat: selBgRepeat?.value || 'no-repeat',\n          size: selBgSize?.value || 'cover',\n          position: selBgPosition?.value || 'center center',\n          attachment: selBgAttachment?.value || 'scroll',\n          opacity: pctTo01(rngBgOpacity),\n        });\n      }\n\n      // Particles\n      if (mode === 'particles') {\n        base.background_particles = pick({\n          config_url: (inpParticlesUrl?.value || '').trim() || undefined,\n          pointer_events: !!chkParticlesPtr?.checked,\n        });\n      }\n\n      // YouTube\n      if (mode === 'youtube') {\n        const n = (x) => {\n          const v = parseInt((x?.value || '').trim(), 10);\n          return Number.isFinite(v) ? v : undefined;\n        };\n        base.background_youtube = pick({\n          url: (inpYtUrl?.value || '').trim() || undefined,\n          start: n(inpYtStart),\n          end: n(inpYtEnd),\n          mute: !!chkYtMute?.checked,\n          loop: !!chkYtLoop?.checked,\n          size: selYtSize?.value || 'cover',\n          position: selYtPosition?.value || 'center center',\n          attachment: selYtAttachment?.value || 'scroll',\n          opacity: pctTo01(rngYtOpacity),\n        });\n      }\n\n      // When switching modes, avoid leaving stale large objects around\n      if (mode !== 'image') delete base.background_image;\n      if (mode !== 'particles') delete base.background_particles;\n      if (mode !== 'youtube') delete base.background_youtube;\n    } catch (e) { /* non-fatal */ }\n\n\n    // Reflect the animate cards setting back into the configuration. When\n    // true, cards will perform a fly\u2011in animation on tab switch. This key\n    // persists in YAML so toggling the option will survive reloads.\n    base.animate_cards = !!el.querySelector('#animateCards').checked;\n\n\n    base.container_size_mode = el.querySelector('#sizeMode')?.value ?? el.querySelector('#ddc-setting-sizeMode')?.value ?? 'dynamic';\n    base.container_fixed_width  = Number(el.querySelector('#sizeW').value || 0) || undefined;\n    base.container_fixed_height = Number(el.querySelector('#sizeH').value || 0) || undefined;\n    base.container_preset = el.querySelector('#sizePreset').value || undefined;\n    base.container_preset_orientation = el.querySelector('#sizeOrientation').value || 'auto';\n\n    return base;\n  };\n\n  // Change detection (don\u2019t fire immediately on each keystroke)\n  const isDirty = () => {\n    const current = el.getConfig();\n    const baseline = el._config || {};\n    try {\n      return JSON.stringify(current) !== JSON.stringify(baseline);\n    } catch { return true; }\n  };\n\n  const on = (sel, ev = 'input') => el.querySelector(sel)?.addEventListener(ev, () => {\n    if (sel === '#sizeMode') toggleSizeControls();\n    updateButtons();\n  });\n\n  // Listeners\n  on('#storage_key'); on('#grid');\n  on('#liveSnap', 'change'); on('#autoSave', 'change'); on('#autoSaveDebounce');\n  on('#containerBg'); on('#cardBg');\n  on('#debug', 'change'); on('#noOverlap', 'change');\n  on('#autoResize', 'change');\n  on('#animateCards', 'change');\n  on('#sizeMode', 'change'); on('#ddc-setting-sizeMode', 'change'); on('#sizeW'); on('#sizeH');\n  on('#sizePreset', 'selected'); on('#sizeOrientation', 'selected');\n\n  applyBtn?.addEventListener('click', () => {\n    fire();\n  });\n  revertBtn?.addEventListener('click', () => el.setConfig(el._config));\n\n  return el;\n}\n\n\n\n\n  \n    /* ---------------------------- Size helpers ---------------------------- */\n  // ---- size presets (CSS pixels) ----\nstatic _sizePresets() {\n  return [\n    // Phones\n    { key:'iphone-14-pro',      label:'iPhone 14 Pro',        w:393,  h:852,  group:'phone' },\n    { key:'iphone-14-pro-max',  label:'iPhone 14 Pro Max',    w:430,  h:932,  group:'phone' },\n    { key:'iphone-se-2',        label:'iPhone SE (2/3rd gen)',w:375,  h:667,  group:'phone' },\n    { key:'pixel-7',            label:'Pixel 7',              w:412,  h:915,  group:'phone' },\n    { key:'galaxy-s8',          label:'Galaxy S8',            w:360,  h:740,  group:'phone' },\n    { key:'galaxy-s20-ultra',   label:'Galaxy S20 Ultra',     w:412,  h:915,  group:'phone' },\n\n    // Tablets\n    { key:'ipad-9-7',           label:'iPad 9.7\"',            w:768,  h:1024, group:'tablet' },\n    { key:'ipad-11-pro',        label:'iPad Pro 11\"',         w:834,  h:1194, group:'tablet' },\n    { key:'ipad-12-9-pro',      label:'iPad Pro 12.9\"',       w:1024, h:1366, group:'tablet' },\n    { key:'surface-go-3',       label:'Surface Go 3',         w:800,  h:1280, group:'tablet' },\n\n    // Desktop / Displays\n    { key:'hd',                 label:'HD',                   w:1366, h:768,  group:'desktop' },\n    { key:'wxga-plus',          label:'WXGA+',                w:1440, h:900,  group:'desktop' },\n    { key:'fhd',                label:'Full HD',              w:1920, h:1080, group:'desktop' },\n    { key:'qhd',                label:'2K / QHD',             w:2560, h:1440, group:'desktop' },\n    { key:'uhd-4k',             label:'4K UHD',               w:3840, h:2160, group:'desktop' },\n  ];\n}\n\n_isContainerFixed() { return (this.containerSizeMode === 'fixed_custom' || this.containerSizeMode === 'preset' || this.containerSizeMode === 'fixed'); }\n\n_resolveFixedSize() {\n  if (this.containerSizeMode === 'fixed_custom') {\n    const w = Math.max(100, Number(this.containerFixedWidth || 0));\n    const h = Math.max(100, Number(this.containerFixedHeight || 0));\n    return { w, h };\n  }\n  if (this.containerSizeMode === 'preset') {\n    const p = DragAndDropCard._sizePresets().find(x => x.key === this.containerPreset) ||\n              DragAndDropCard._sizePresets().find(x => x.key === 'fhd');\n    if (!p) return { w: 1920, h: 1080 };\n    let w = p.w, h = p.h;\n    if (this.containerPresetOrient === 'portrait' && w > h) [w,h] = [h,w];\n    if (this.containerPresetOrient === 'landscape' && h > w) [w,h] = [h,w];\n    return { w, h };\n  }\n  return null;\n}\n\n_applyContainerSizingFromConfig(initial=false) {\n  // set container size according to mode\n  const c = this.cardContainer; if (!c) return;\n\n  if (this._isContainerFixed()) {\n    const { w, h } = this._resolveFixedSize();\n    c.style.width  = `${w}px`;\n    c.style.height = `${h}px`;\n    // ensure overflow hidden (hard lock)\n    c.style.overflow = 'hidden';\n    if (!initial) this._dbgPush?.('size', 'Applied fixed size', { w, h, mode: this.containerSizeMode, preset:this.containerPreset, orient:this.containerPresetOrient });\n    // pull any existing cards back inside\n    this._clampAllCardsInside();\n  } else {\n    // dynamic \u2014 let _resizeContainer compute; clear inline to allow growth/shrink\n    c.style.overflow = 'hidden';\n    // keep width/height managed by _resizeContainer\n    if (!initial) this._dbgPush?.('size', 'Applied dynamic size');\n    this._resizeContainer();\n  }\n}\n\n_getContainerSize() {\n  const c = this.cardContainer; if (!c) return { w:0, h:0 };\n  const w = parseFloat(getComputedStyle(c).width) || c.getBoundingClientRect().width;\n  const h = parseFloat(getComputedStyle(c).height) || c.getBoundingClientRect().height;\n  return { w, h };\n}\n\n_clampAllCardsInside() {\n  if (!this._isContainerFixed()) return;\n  const { w: cw, h: ch } = this._getContainerSize();\n  const wraps = this.cardContainer.querySelectorAll('.card-wrapper');\n  wraps.forEach(w => {\n    const x = parseFloat(w.getAttribute('data-x')) || 0;\n    const y = parseFloat(w.getAttribute('data-y')) || 0;\n    const ww = parseFloat(w.style.width)  || w.getBoundingClientRect().width;\n    const hh = parseFloat(w.style.height) || w.getBoundingClientRect().height;\n\n    const nx = Math.max(0, Math.min(x, Math.max(0, cw - ww)));\n    const ny = Math.max(0, Math.min(y, Math.max(0, ch - hh)));\n    let nw = Math.min(ww, cw);\n    let nh = Math.min(hh, ch);\n\n    // if width/height exceed box, shrink then re-clamp pos\n    if (nw !== ww || nh !== hh) {\n      w.style.width  = `${nw}px`;\n      w.style.height = `${nh}px`;\n    }\n    const nx2 = Math.max(0, Math.min(nx, Math.max(0, cw - nw)));\n    const ny2 = Math.max(0, Math.min(ny, Math.max(0, ch - nh)));\n    this._setCardPosition(w, nx2, ny2);\n  });\n}\n\n_computeHaSidebarGutters_() {\n  let left = 56; // default desktop gutter; HA collapsed is ~56\u201364px\n  try {\n    const ha = document.querySelector('home-assistant');\n    const shadow = ha?.shadowRoot;\n    const drawer = shadow?.querySelector('ha-drawer, app-drawer, ha-sidebar, .drawer, .menu');\n    const rect = drawer?.getBoundingClientRect?.();\n    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);\n    // On mobile the nav overlays; treat gutter as 0\n    if (vw <= 870) {\n      left = 0;\n    } else if (rect?.width) {\n      left = Math.max(0, Math.min(256, Math.round(rect.width)));\n    }\n  } catch {}\n  let right = 0; // adjust if you have a right dock; keep 0 otherwise\n  try {\n    // Example hook for themes with a right dock: measure & set right here.\n  } catch {}\n  try {\n    this.style.setProperty('--ddc-left-gutter', `${left}px`);\n    this.style.setProperty('--ddc-right-gutter', `${right}px`);\n  } catch {}\n}\n\n_applyGridVars() {\n  const sz = `${this.gridSize || 10}px`;\n  // host (inherits down)\n  this.style.setProperty('--ddc-grid-size', sz);\n  // container (extra robust)\n  this.cardContainer?.style.setProperty('--ddc-grid-size', sz);\n}\n\n  /* ---------------------------- debug helpers ---------------------------- */\n  _dbgInit() {\n    if (this.__dbgReady) return;\n    this.__dbgReady = true;\n    this._dbgBuffer = [];\n    this._dbgMax = 400;\n    try { window.DDC = this; } catch {}\n  }\n  _dbgPush(kind, msg, extra = null) {\n    const line = { t: new Date().toISOString(), kind, msg, extra };\n    this._dbgBuffer.push(line);\n    if (this._dbgBuffer.length > this._dbgMax) this._dbgBuffer.shift();\n    if (this.debug) console.debug(`%c[ddc:${kind}]%c ${msg}`, 'color:#03a9f4', 'color:unset', extra ?? '');\n  }\n  _dbgDump() { return [...this._dbgBuffer]; }\n  _safe(s) { return String(s).replace(/[&<>\"']/g, (c)=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'}[c])); }\n\n  /* --------------------------- Card lifecycle --------------------------- */\n  setConfig(config = {}) {\n    // Track old key so we only rebuild when storage_key actually changes\n    // Auto\u2011assign a storage key if none provided\n    // Keep previous to detect real key changes\n    const prevKey = this.storageKey;\n    // Use existing instance key if present\n\n    this.config = { ...config };\n    if (!this.config.storage_key || this.config.storage_key === \"\") {\n      this.config.storage_key = this.constructor._genKey();\n    }\n    this.storageKey = this.config.storage_key;\n\n    // STABLE storage_key: reuse instance key if none provided\n    if (!config.storage_key) {\n      if (this.storageKey) {\n        config = { ...config, storage_key: this.storageKey };\n      } else {\n        this.storageKey = `layout_${(crypto?.randomUUID?.() || Date.now().toString(36))}`;\n        config = { ...config, storage_key: this.storageKey };\n      }\n    }\n\n    // Store & reflect\n    this._config = config;\n    this.storageKey = config.storage_key;\n    this._syncEditorsStorageKey();\n\n\n    // Store incoming config and update properties\n    this.storageKey = config.storage_key || undefined;\n    this._syncEditorsStorageKey();\n    this.gridSize                 = Number(config.grid ?? 10);\n    this.dragLiveSnap             = !!config.drag_live_snap;\n    this.autoSave                 = config.auto_save !== false;\n    this.autoSaveDebounce         = Number(config.auto_save_debounce ?? 800);\n    this.editModePin =            (this.editModePin != null) ? this.editModePin: (config.edit_mode_pin ?? config.editModePin ?? '');\n    this.containerBackground      = config.container_background ?? 'transparent';\n    this.cardBackground           = config.card_background ?? 'var(--ha-card-background, var(--card-background-color))';\n\n    // Whether to apply a drop shadow to card wrappers (defaults to false)\n    this.cardShadowEnabled        = !!config.card_shadow;\n\n    this.hideHaHeader            = !!(config.hide_HA_Header ?? config.hide_ha_header ?? false);\n    this.hideHaSidebar           = !!(config.hide_HA_Sidebar ?? config.hide_ha_sidebar ?? false);\n        this.debug                    = !!config.debug;\n    this.editMode                 = false;\n    this._backendOK               = false;\n    this.disableOverlap           = !!config.disable_overlap;\n    this.containerSizeMode        = config.container_size_mode || 'dynamic';\n    \n\n    const sizeModeLower           = String(this.containerSizeMode || 'dynamic').toLowerCase();\n\n    if (sizeModeLower === 'dynamic') {\n      // In dynamic mode cards should always auto-scale.\n      this.autoResizeCards = true;\n    } else {\n      // Other modes can still opt-out via config.auto_resize_cards: false\n      this.autoResizeCards = config.auto_resize_cards !== false;\n    }\n\n    // Whether to play a fly\u2011in animation when switching tabs or refreshing\n    // Defaults to false when not specified.  When true, the card wrappers\n    // animate into view the moment a tab becomes active or on initial load.\n    this.animateCards             = !!config.animate_cards;\n\n    // Screen saver options\n    this.screenSaverEnabled = !!(config.screen_saver_enabled ?? false);\n    // Delay stored in ms; default to 5 minutes if not provided\n    const ssDelay = Number(config.screen_saver_delay);\n    this.screenSaverDelay = Number.isFinite(ssDelay) && ssDelay > 0 ? ssDelay : (5 * 60000);\n\n    if ((this.autoResizeCards || String((this.containerSizeMode||this.container_size_mode||'dynamic')).toLowerCase()==='auto')) this._startScaleWatch?.(); else this._stopScaleWatch?.();\n    this._applyAutoScale?.();\n    this.containerFixedWidth      = Number(config.container_fixed_width ?? 0) || null;\n    this.containerFixedHeight     = Number(config.container_fixed_height ?? 0) || null;\n    this.containerPreset          = config.container_preset || 'fullhd';\n    this.containerPresetOrient    = config.container_preset_orientation || 'auto';\n    this.heroImage = config?.hero_image || \"https://i.postimg.cc/CxsWQgwp/Chat-GPT-Image-Sep-5-2025-09-26-16-AM.png\";\n    // Tabs options\n    this.tabs               = Array.isArray(config.tabs) ? config.tabs : [];\n    this.tabsPosition       = (config.tabs_position === 'left') ? 'left' : 'top';\n    this.defaultTab         = config.default_tab || (this.tabs[0]?.id ?? 'default');\n    this.hideTabsWhenSingle = (config.hide_tabs_when_single !== false);\n    this.activeTab          = this.defaultTab;\n    try { const lastT = localStorage.getItem(`ddc_lasttab_${this.storageKey}`);\n      if (lastT && this.tabs.some(t=>t.id===lastT)) this.activeTab = lastT; } catch {}\n    if (this.rootEl) this.rootEl.classList.toggle('ddc-tabs-left-layout', this.tabsPosition === 'left');\n\n\n\n    if (this.cardContainer) this._applyContainerSizingFromConfig(false);\n\n    const keyChanged = prevKey !== this.storageKey;\n\n      // IMPORTANT: do NOT autosave a layout snapshot while the key is changing/booting\n    if (this.editMode && !this.__booting && !keyChanged) {\n      try { if (!this._isInHaEditorPreview()) this._queueSave('config-change'); } catch {}\n    }\n    // Grid-related\n    this._applyGridVars();\n\n    \n    try { this._applyBackgroundImageFromConfig?.(); } catch {}\n\n    try { this._applyHaChromeVisibility_?.(); } catch {}\n// Overlay fix for UI based cards\n    this._ensureOverlayZFix();\n\n    // Apply screensaver settings after config assignment\n    try {\n      this._updateScreensaverSettings?.();\n    } catch {}\n\n    // selection state\n    this._selection = new Set();\n    this.__groupDrag = null;\n\n    // caches for speed\n    this.__editorCache = new Map(); // type -> element\n    this.__stubCache = new Map();\n\n    this._dbgInit();\n    this._dbgPush('init', 'Card configured', {\n      storageKey_raw: config.storage_key,\n      storageKey_slug: this.storageKey,\n      autoSave: this.autoSave,\n      grid: this.gridSize\n    });\n\n    this.style.setProperty('--ddc-bg', this.containerBackground);\n    this.style.setProperty('--ddc-card-bg', this.cardBackground);\n\n    // Apply initial card drop shadow if enabled\n    if (this.cardShadowEnabled) {\n      // Set a more prominent drop shadow by default\n      this.style.setProperty('--ddc-card-shadow', '0 8px 24px rgba(0,0,0,.35)');\n    }\n\n    // preload libs\n    if (!window.jsyaml) {\n      const s = document.createElement('script');\n      s.src = 'https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js';\n      document.head.appendChild(s);\n    }\n    if (!window.interact) {\n      const s = document.createElement('script');\n      s.src = 'https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js';\n      s.onload = () => this._initInteract();\n      document.head.appendChild(s);\n    }\n    // preload helpers early to avoid lag on first pick\n    this._helpersPromise = (typeof window.loadCardHelpers === 'function')\n      ? window.loadCardHelpers().catch(()=>null)\n      : Promise.resolve(null);\n\n    if (!this._built) {\n      this._built = true;\n      this.shadowRoot.innerHTML = `\n        <style>\n\n\n.ddc-root{\n  position:relative;\n  /* JS will keep this in sync with your \u201CGrid (px)\u201D */\n  --ddc-grid-size: 10px;\n  /* Good contrast on light/dark themes */\n  --ddc-grid-color: color-mix(in srgb, var(--primary-text-color) 22%, transparent);\n\n  /* Container we query for width */\n  container-type: inline-size;\n  container-name: ddc-root;\n}\n\n/* ===== DDC Toolbar and tabs when auto sieze is off ===== */\n\n/* Center toolbar & tabs to viewport when auto-resize is OFF in dynamic mode */\n/* === Centered, nav-aware UI when auto-resize is OFF in dynamic mode === */\n:host([ddc-fixed-ui]) .ddc-toolbar,\n:host([ddc-fixed-ui]) .ddc-tabs {\n  position: fixed;\n  /* Keep clear of HA's left navigation bar; computed in JS, fallback 56px desktop / 0 mobile */\n  left: calc(var(--ddc-left-gutter, 56px) + 50%);\n  transform: translateX(-50%);\n  width: var(--ddc-ui-width, auto);\n  max-width: calc(100vw - var(--ddc-left-gutter, 56px) - var(--ddc-right-gutter, 0px));\n  box-sizing: border-box;\n  z-index: 3; /* above canvas, below dialogs */\n  pointer-events: auto;\n}\n\n/* Vertical placement */\n:host([ddc-fixed-ui]) .ddc-toolbar { top: 0; }\n:host([ddc-fixed-ui]) .ddc-tabs { top: var(--ddc-toolbar-height, 0px); }\n\n/* Make tabs horizontally scrollable when narrow */\n:host([ddc-fixed-ui]) .ddc-tabs {\n  overflow-x: auto;\n  overflow-y: hidden;\n  -webkit-overflow-scrolling: touch;\n  white-space: nowrap;\n  scrollbar-width: thin;\n}\n\n/* Keep inner list no-wrap; match your existing inner wrapper class if different */\n:host([ddc-fixed-ui]) .ddc-tabs .scroll-wrap,\n:host([ddc-fixed-ui]) .ddc-tabs .tabs-inner {\n  display: inline-flex;\n  white-space: nowrap;\n}\n\n/* Mobile: make toolbar & tabs full-width and not offset */\n/* Mobile: tabs should not be centered with left/translate. Just full-width & scrollable */\n@media (max-width: 768px) {\n  .ddc-tabs {\n    position: sticky;\n    top: var(--ddc-toolbar-height, 0px);\n    left: 0 !important;\n    transform: none !important;\n    width: 100% !important;\n    max-width: 100vw !important;\n    margin: 0;\n    padding-inline: 0;\n    justify-content: flex-start !important;\n    /* make the whole strip scrollable, nothing faded away at edges */\n    overflow-x: auto;\n    overflow-y: hidden;\n    -webkit-overflow-scrolling: touch;\n    -webkit-mask-image: none;\n    mask-image: none;\n  }\n}\n/* ===== DDC Toolbar and tabs when auto sieze is off END ===== */\n\n\n/* ===== DDC Toolbar \u2014 Minimal Redesign (pills with accent tint) ===== */\n\n\n/* scope to either version */\n.ddc-toolbar.streamlined.v2,\n.ddc-toolbar.streamlined.v3{\n  --ddc-bg: color-mix(in oklab, var(--card-background-color, #0d0f12) 88%, transparent);\n  --ddc-border: color-mix(in oklab, #fff 14%, transparent);\n  --ddc-soft: color-mix(in oklab, #fff 7%, transparent);\n  --ddc-shadow: 0 10px 30px rgba(0,0,0,.25), 0 2px 8px rgba(0,0,0,.22);\n\n  /* section accent colors */\n  --sec-primary: #3b82f6;\n  --sec-clip:    #a855f7;\n  --sec-share:   #4fb6ff;\n  --sec-utils:   #10b981;\n  --sec-status:  #ef4444;\n\n  --btn-h: 36px;\n  --btn-r: 12px;\n  --btn-gap: 8px;\n\n  /* animation vars */\n  --ddc-ease: cubic-bezier(.2,.7,.2,1);\n  --ddc-dur: 260ms;\n  --open-h: 0px; /* JS sets this to scrollHeight */\n\n  position: sticky; top: 0; z-index: 3;\n  background: var(--ddc-bg);\n  border-bottom: 1px solid var(--ddc-border);\n  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);\n  box-shadow: var(--ddc-shadow);\n  padding: 12px 14px 10px;\n\n  /* never exceed the root\u2019s width */\n  max-width: 100%;\n\n  /* GRID (kept ready) */\n  display: none;\n  grid-template-columns: repeat(4, minmax(0,1fr)) auto; /* Status at the end */\n  grid-template-areas:\n    \"primary clip share utils status\"\n    \"layouts layouts layouts layouts status\";\n  column-gap: 18px;\n  row-gap: 10px;\n  align-items: start;\n\n  /* Visibility is animated \u2014 NOT display */\n  opacity: 0;\n  transform: translateY(-6px);\n  max-height: 0;              /* collapse when closed */\n  overflow: hidden;             /* avoid scrollbars during anim */\n  pointer-events: none;       /* inert when closed */\n  visibility: hidden;         /* keep out of a11y focus when closed */\n\n  transition:\n    opacity var(--ddc-dur) var(--ddc-ease),\n    transform var(--ddc-dur) var(--ddc-ease),\n    max-height var(--ddc-dur) var(--ddc-ease),\n    visibility 0s linear var(--ddc-dur); /* becomes hidden after fade-out */\n\n  /* make this element respond to its own width, too */\n  container-type: inline-size;\n  container-name: ddc;\n}\n\n/* OPEN state (set by JS) */\n.ddc-toolbar.streamlined.v2.is-open,\n.ddc-toolbar.streamlined.v3.is-open{\n  opacity: 1;\n  transform: translateY(0);\n  max-height: var(--open-h);  /* expand to measured height */\n  pointer-events: auto;\n  visibility: visible;\n  transition:\n    opacity var(--ddc-dur) var(--ddc-ease),\n    transform var(--ddc-dur) var(--ddc-ease),\n    max-height var(--ddc-dur) var(--ddc-ease),\n    visibility 0s; /* visible immediately */\n}\n\n/* Always hide when closed, no matter what other rules say */\n.ddc-toolbar.streamlined.v2:not(.is-open):not([data-force-open=\"1\"]),\n.ddc-toolbar.streamlined.v3:not(.is-open):not([data-force-open=\"1\"]) {\n  display: none !important;\n}\n\n/* Respect reduced motion */\n@media (prefers-reduced-motion: reduce){\n  .ddc-toolbar.streamlined.v2,\n  .ddc-toolbar.streamlined.v3{\n    transition: none;\n  }\n}\n\n/* map areas (HTML unchanged) */\n.ddc-toolbar.streamlined.v2 .sec-primary{ grid-area: primary; }\n.ddc-toolbar.streamlined.v2 .sec-clip   { grid-area: clip; }\n.ddc-toolbar.streamlined.v2 .sec-share  { grid-area: share; }\n.ddc-toolbar.streamlined.v2 .sec-utils  { grid-area: utils; }\n.ddc-toolbar.streamlined.v2 .sec-status { grid-area: status; }\n.ddc-toolbar.streamlined.v2 .sec-layouts{ grid-area: layouts; }\n.ddc-toolbar.streamlined.v2 .ddc-spacer,\n.ddc-toolbar.streamlined.v2 .ddc-vsep{ display:none; }\n\n/* === ONE-PILL PER SECTION: header + buttons inside === */\n.ddc-toolbar.streamlined.v2 .ddc-sec,\n.ddc-toolbar.streamlined.v3 .ddc-sec{\n  --pill-accent: #6b7280;            /* default; overridden per-section below */\n\n  display: flex; flex-direction: column; gap: 10px; min-width: 0;\n  padding: 12px 14px;\n  border-radius: 16px;\n\n  /* accent-tinted background & border */\n  background:\n    linear-gradient(180deg,\n      color-mix(in oklab, var(--pill-accent) 12%, transparent),\n      transparent),\n    color-mix(in oklab, var(--primary-background-color, #0e1116) 22%, transparent);\n  border: 1px solid color-mix(in oklab, var(--pill-accent) 26%, transparent);\n  box-shadow: inset 0 1px 2px rgba(255,255,255,.04);\n}\n\n/* per-section tint */\n.ddc-toolbar.streamlined.v2 .sec-primary{ --pill-accent: var(--sec-primary); }\n.ddc-toolbar.streamlined.v2 .sec-clip   { --pill-accent: var(--sec-clip); }\n.ddc-toolbar.streamlined.v2 .sec-share  { --pill-accent: var(--sec-share); }\n.ddc-toolbar.streamlined.v2 .sec-utils  { --pill-accent: var(--sec-utils); }\n.ddc-toolbar.streamlined.v2 .sec-status { --pill-accent: var(--sec-status); }\n.ddc-toolbar.streamlined.v2 .sec-layouts{ --pill-accent: var(--sec-clip); } /* layouts gets a gentle purple tint */\n\n/* header inside the pill */\n.ddc-toolbar.streamlined.v2 .ddc-sec-head{\n  background: transparent; border: 0; padding: 0; border-radius: 0;\n  color: var(--accent, #9aa0a6);\n  display: inline-flex; align-items: center; gap: 10px;\n  font-weight: 700; font-size: .92rem; letter-spacing: .2px;\n}\n.ddc-toolbar.streamlined.v2 .sec-primary .ddc-sec-head{ --accent: var(--sec-primary); color: var(--sec-primary); }\n.ddc-toolbar.streamlined.v2 .sec-clip    .ddc-sec-head{ --accent: var(--sec-clip);    color: var(--sec-clip); }\n.ddc-toolbar.streamlined.v2 .sec-share   .ddc-sec-head{ --accent: var(--sec-share);   color: var(--sec-share); }\n.ddc-toolbar.streamlined.v2 .sec-utils   .ddc-sec-head{ --accent: var(--sec-utils);   color: var(--sec-utils); }\n.ddc-toolbar.streamlined.v2 .sec-status  .ddc-sec-head{ --accent: var(--sec-status);  color: var(--sec-status); }\n.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-sec-head{ --accent: var(--sec-clip);    color: var(--sec-clip); }\n\n.ddc-toolbar.streamlined.v2 .ddc-sec-dot{\n  width: 8px; height: 8px; border-radius: 50%; background: currentColor; opacity: .95;\n}\n\n/* row of actions inside the pill */\n.ddc-toolbar.streamlined.v2 .ddc-row{ display: flex; flex-wrap: wrap; align-items: center; gap: var(--btn-gap); margin: 0; }\n\n/* buttons (reset native look + style) */\n.ddc-toolbar.streamlined.v2 .btn{\n  appearance:none; -webkit-appearance:none;\n  display:inline-flex; align-items:center; gap:8px;\n  height:var(--btn-h); padding:8px 12px; border-radius:var(--btn-r);\n  background: color-mix(in oklab, var(--primary-background-color, #0e1116) 14%, transparent);\n  border:1px solid var(--ddc-border);\n  color: var(--primary-text-color, #e5e7eb);\n  cursor:pointer; font:inherit; white-space:nowrap;\n  transition: transform .08s, background .16s, border-color .16s, box-shadow .16s;\n  flex: 1 1 220px;           /* equal-ish width buttons and wrap nicely */\n  min-width: 160px;\n}\n.ddc-toolbar.streamlined.v2 .btn ha-icon{ --mdc-icon-size:18px; width:18px; height:18px; display:inline-block; }\n.ddc-toolbar.streamlined.v2 .btn:hover{ transform: translateY(-1px); background: color-mix(in oklab, var(--primary-background-color) 22%, transparent); }\n.ddc-toolbar.streamlined.v2 .btn:active{ transform: translateY(0); }\n.ddc-toolbar.streamlined.v2 .btn:focus-visible{ outline:none; box-shadow:0 0 0 2px color-mix(in oklab, #fff 15%, transparent); }\n.ddc-toolbar.streamlined.v2 .btn.secondary{ background:transparent; }\n.ddc-toolbar.streamlined.v2 .btn.info{\n  background: color-mix(in oklab, var(--sec-share) 92%, transparent); color:#0b2537;\n  border-color: color-mix(in oklab, var(--sec-share) 55%, transparent);\n}\n.ddc-toolbar.streamlined.v2 .btn.danger{\n  background: color-mix(in oklab, #ff5d5d 92%, transparent); color:#2b0b0b;\n  border-color: color-mix(in oklab, #ff5d5d 55%, transparent);\n}\n\n/* >>> Make \"Add Card\" extra prominent */\n.ddc-toolbar.streamlined.v2 .btn.cta-add{\n  --glow: color-mix(in oklab, var(--sec-primary) 65%, #fff 0%);\n  height: 40px; padding: 10px 14px; border-radius: 14px;\n  font-weight: 800; letter-spacing: .2px;\n  background: linear-gradient(135deg, var(--sec-primary), color-mix(in oklab, var(--sec-primary) 60%, #fff 0%));\n  color:#fff;\n  border-color: color-mix(in oklab, var(--sec-primary) 55%, #000);\n  box-shadow: 0 10px 24px rgba(59,130,246,.34), 0 0 0 2px color-mix(in oklab, var(--sec-primary) 22%, transparent) inset;\n  flex-basis: 100%;  /* spans full row when wrapping */\n}\n.ddc-toolbar.streamlined.v2 .btn.cta-add::after{\n  content:\"\"; position:absolute; inset:-4px; border-radius:16px;\n  border:2px solid color-mix(in oklab, var(--sec-primary) 45%, transparent);\n  opacity:.6; pointer-events:none;\n}\n\n/* status: dot above text, HIGH-CONTRAST text */\n.ddc-toolbar.streamlined.v2 .ddc-t-status{\n  display:flex; flex-direction: column; align-items:center; justify-content:center;\n  gap: 4px; text-align: center;\n  min-width: 120px; height: auto; padding: 10px 12px; border-radius: 999px;\n  background: color-mix(in oklab, var(--primary-background-color, #0b0d10) 28%, transparent);\n  border: 1px solid color-mix(in oklab, #ffffff 28%, transparent);\n  color: #f8fbff;  /* brighter default */\n  font-size: .9rem; line-height: 1.25; font-weight: 700;\n  text-shadow: 0 1px 1px rgba(0,0,0,.45);\n}\n.ddc-toolbar.streamlined.v2 .ddc-t-status .ddc-t-text{ color: #f8fbff; }\n.ddc-toolbar.streamlined.v2 .ddc-t-dot{ width: 12px; height: 12px; border-radius:50%; background:#22c55e; }\n.ddc-toolbar.streamlined.v2 .ddc-t-status.warn  .ddc-t-dot{ background:#f59e0b; }\n.ddc-toolbar.streamlined.v2 .ddc-t-status.error .ddc-t-dot{ background:#ef4444; }\n@keyframes ddc-pulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.35)} }\n\n/* store badge (optional) */\n.ddc-toolbar.streamlined.v2 .store-badge {\n  display: inline-flex;\n  align-items: center;\n  height: var(--btn-h);\n  border: 1px solid var(--ddc-border);\n  border-radius: 999px;\n  padding: 6px 10px;\n  font-size: .85rem;\n  background: color-mix(in oklab, #ffc107 22%, transparent);\n  color: #fff; /* \u2190 white text */\n  flex: 1 1 220px;\n  min-width: 160px;\n}\n\n\n/* Layouts: inline switcher styling */\n.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-row.center{ display:flex; justify-content:center; gap:12px; flex-wrap: wrap; }\n.ddc-toolbar.streamlined.v2 .sec-layouts .layout-host{ display:inline-flex; align-items:center; gap:10px; color:#cfd6de; }\n.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline{\n  display:inline-flex; align-items:center; gap:10px; flex-wrap: wrap;\n  padding:8px 10px; border-radius:12px;\n  background: color-mix(in oklab, var(--primary-background-color, #0e1116) 14%, transparent);\n  border: 1px solid color-mix(in oklab, #ffffff 14%, transparent);\n}\n.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline .label{\n  color:#cfd6de; font-size:.9rem; letter-spacing:.2px;\n}\n.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline button,\n.ddc-toolbar.streamlined.v2 .sec-layouts .ddc-switcher-inline .btn{\n  appearance:none; -webkit-appearance:none;\n  display:inline-flex; align-items:center; gap:8px;\n  height:32px; padding:6px 10px; border-radius:10px;\n  background: color-mix(in oklab, var(--primary-background-color, #0e1116) 10%, transparent);\n  border:1px solid color-mix(in oklab, #ffffff 12%, transparent);\n  color: var(--primary-text-color, #e5e7eb);\n  cursor:pointer; font:inherit; white-space:nowrap;\n  transition: transform .08s, background .16s, border-color .16s, box-shadow .16s;\n}\n\n/* JS shim to override default hidden state purely for measuring/animating */\n.ddc-toolbar.streamlined.v2[data-force-open=\"1\"],\n.ddc-toolbar.streamlined.v3[data-force-open=\"1\"]{\n  display: grid !important;\n}\n\n/* ===== STACK WHEN ROOT IS NARROW (uses .ddc-root width) ===== */\n@container ddc-root (max-width: 900px){\n  .ddc-toolbar.streamlined.v2,\n  .ddc-toolbar.streamlined.v3{\n    position: static !important;     /* turn off sticky */\n    top: auto !important;\n    inset: auto !important;\n    z-index: auto !important;\n\n    max-width: 100%;                  /* never exceed .ddc-root */\n    margin: 8px 0 12px 0;             /* breathing room above card */\n    box-shadow: 0 4px 12px rgba(0,0,0,.18); /* lighter shadow on mobile */\n  }\n}\n\n\n\n  .ddc-toolbar.streamlined.v2 > .ddc-sec,\n  .ddc-toolbar.streamlined.v3 > .ddc-sec{\n    display: block;\n    width: 100%;\n    margin: 0 0 12px 0;\n    grid-area: auto !important;  /* neutralize named areas */\n  }\n\n  .ddc-toolbar.streamlined.v2 .ddc-row,\n  .ddc-toolbar.streamlined.v3 .ddc-row{\n    display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; width: 100%;\n  }\n\n  .ddc-toolbar.streamlined.v2 .ddc-row > .btn,\n  .ddc-toolbar.streamlined.v3 .ddc-row > .btn,\n  .ddc-toolbar.streamlined.v2 .ddc-row > .store-badge,\n  .ddc-toolbar.streamlined.v3 .ddc-row > .store-badge{\n    flex: 1 1 calc(50% - 8px);\n    min-width: 160px;\n  }\n\n  .ddc-toolbar.streamlined.v2 .ddc-row > .btn.cta-add,\n  .ddc-toolbar.streamlined.v3 .ddc-row > .btn.cta-add{\n    flex-basis: 100%;\n  }\n\n  .ddc-toolbar.streamlined.v2 .btn,\n  .ddc-toolbar.streamlined.v3 .btn{ height: 44px; }\n}\n\n@container ddc-root (max-width: 560px){\n  .ddc-toolbar.streamlined.v2,\n  .ddc-toolbar.streamlined.v3{\n    position: static !important;\n    top: auto !important;\n    inset: auto !important;\n    z-index: auto !important;\n    max-width: 100%;\n  }\n}\n\n/* Fallback for environments without container queries */\n@supports not (container-type: inline-size){\n  @media (max-width: 900px){\n    .ddc-toolbar.streamlined.v2,\n    .ddc-toolbar.streamlined.v3{\n      display: block;\n      padding: 10px;\n    }\n    .ddc-toolbar.streamlined.v2 > .ddc-sec,\n    .ddc-toolbar.streamlined.v3 > .ddc-sec{\n      display: block; width: 100%; margin: 0 0 12px 0; grid-area: auto !important;\n    }\n    .ddc-toolbar.streamlined.v2 .ddc-row,\n    .ddc-toolbar.streamlined.v3 .ddc-row{\n      display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; width: 100%;\n    }\n    .ddc-toolbar.streamlined.v2 .ddc-row > .btn,\n    .ddc-toolbar.streamlined.v3 .ddc-row > .btn,\n    .ddc-toolbar.streamlined.v2 .ddc-row > .store-badge,\n    .ddc-toolbar.streamlined.v3 .ddc-row > .store-badge{\n      flex: 1 1 calc(50% - 8px); min-width: 160px;\n    }\n    @media (max-width: 560px){\n      .ddc-toolbar.streamlined.v2 .ddc-row > .btn,\n      .ddc-toolbar.streamlined.v3 .ddc-row > .btn,\n      .ddc-toolbar.streamlined.v2 .ddc-row > .store-badge,\n      .ddc-toolbar.streamlined.v3 .ddc-row > .store-badge{\n        flex: 1 1 100%;\n      }\n    }\n  }\n}\n\n/* Optional: make sure all children use border-box inside the toolbar */\n.ddc-toolbar.streamlined.v2 * ,\n.ddc-toolbar.streamlined.v3 * { box-sizing: border-box; }\n\n/* === SIMPLE RESPONSIVE STACKING FOR MOBILE (NO CONTAINER Q) === */\n/* ===== FORCE STACK ON NARROW \u2014 driven by .ddc-root width ============ */\n/* At <= 900px root width: stack pills; inside each pill use 2-up buttons */\n@container ddc-root (max-width: 900px){\n  .ddc-toolbar.streamlined.v2.is-open:has(.btn[style*=\"inline-block\"]),\n  .ddc-toolbar.streamlined.v3.is-open:has(.btn[style*=\"inline-block\"]),\n  .ddc-toolbar.streamlined.v2[data-force-open=\"1\"]:has(.btn[style*=\"inline-block\"]),\n  .ddc-toolbar.streamlined.v3[data-force-open=\"1\"]:has(.btn[style*=\"inline-block\"]),\n  .ddc-toolbar.streamlined.v2.is-open:has(.store-badge[style*=\"inline-block\"]),\n  .ddc-toolbar.streamlined.v3.is-open:has(.store-badge[style*=\"inline-block\"]),\n  .ddc-toolbar.streamlined.v2[data-force-open=\"1\"]:has(.store-badge[style*=\"inline-block\"]),\n  .ddc-toolbar.streamlined.v3[data-force-open=\"1\"]:has(.store-badge[style*=\"inline-block\"]) {\n    display: block !important; /* only when open/measuring */\n  }\n}\n\n\n  .ddc-toolbar.streamlined.v2:has(.btn[style*=\"inline-block\"]) > .ddc-sec,\n  .ddc-toolbar.streamlined.v3:has(.btn[style*=\"inline-block\"]) > .ddc-sec,\n  .ddc-toolbar.streamlined.v2:has(.store-badge[style*=\"inline-block\"]) > .ddc-sec,\n  .ddc-toolbar.streamlined.v3:has(.store-badge[style*=\"inline-block\"]) > .ddc-sec{\n    display:block !important;\n    width: 100% !important;\n    max-width: 100% !important;\n    margin: 0 0 12px 0;\n    grid-area: auto !important; /* neutralize named areas */\n  }\n\n  /* equal buttons: hard 2-up */\n  .ddc-toolbar.streamlined.v2 .ddc-row,\n  .ddc-toolbar.streamlined.v3  .ddc-row{\n    --btn-min: 0px;\n    grid-template-columns: repeat(2, 1fr);\n  }\n\n  /* bigger touch targets */\n  .ddc-toolbar.streamlined.v2 .btn,\n  .ddc-toolbar.streamlined.v3  .btn{ height: 44px; }\n}\n\n/* At <= 560px root width: buttons full-width (1 per row) */\n@container ddc-root (max-width: 560px){\n  .ddc-toolbar.streamlined.v2 .ddc-row,\n  .ddc-toolbar.streamlined.v3  .ddc-row{\n    grid-template-columns: 1fr;\n  }\n}\n\n/* ===== DDC Toolbar \u2014 END ===== */\n\n\n\n\n\n      /* ------- Rest of your styles remain unchanged ------- */\n\n      .card-container{\n        position: relative;\n        transform-origin: top left;\n        padding: 10px;\n        border: 1px solid var(--divider-color);\n        background: var(--ddc-bg, transparent);\n        width: auto; height: auto; border-radius: 12px; overflow: hidden;\n        isolation: isolate; z-index: 0; -webkit-touch-callout: none;\n        user-select: none;\n      }\n      .card-container::before{\n        content:'';\n        position:absolute; inset:0;\n        background-image:\n          linear-gradient(var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px),\n          linear-gradient(90deg, var(--ddc-grid-color, rgba(120,120,120,.25)) 1px, transparent 1px);\n        background-size: var(--ddc-grid-size) var(--ddc-grid-size);\n        background-origin: content-box;\n        background-clip: content-box;\n        pointer-events:none;\n        opacity:0;\n        transition: opacity .15s;\n        z-index:1;\n      }\n      .card-container.grid-on::before{ opacity:.28; }\n\n      .card-container::after{\n        content:'';\n        position:absolute; inset:0;\n        pointer-events:none;\n        z-index:0;\n        opacity: var(--ddc-bg-opacity, 1);\n        background-image: var(--ddc-bg-image, none);\n        background-repeat: var(--ddc-bg-repeat, no-repeat);\n        background-size: var(--ddc-bg-size, cover);\n        background-position: var(--ddc-bg-position, center center);\n        background-attachment: var(--ddc-bg-attachment, scroll);\n        filter: var(--ddc-bg-filter, none);\n      }\n\n      /* Dynamic background host (particles.js / YouTube) */\n      .card-container .ddc-bg-host{\n        position: absolute;\n        inset: 0;\n        z-index: 0;               /* under grid (::before, z=1) and cards (z=2) */\n        overflow: hidden;\n        pointer-events: none;     /* don\u2019t block card drag/drop */\n        opacity: var(--ddc-bg-opacity, 1);\n      }\n\n      .card-container .ddc-bg-host > *{\n        position: absolute;\n        inset: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n      }\n\n      /* When an image background is active, we don\u2019t need the dynamic host */\n      .card-container.has-bg-image .ddc-bg-host{ display: none; }\n\n      .card-wrapper{\n        position:absolute;\n        left: 0; top: 0;\n        box-sizing: border-box;\n        border:2px solid transparent;\n        background:var(--ddc-card-bg, var(--card-background-color));\n        cursor:grab;\n        overflow:auto;\n        border-radius:14px;\n        /* Allow a custom drop shadow via --ddc-card-shadow. Fallback to the HA default if unset */\n        box-shadow: var(--ddc-card-shadow, var(--ha-card-box-shadow,0 2px 12px rgba(0,0,0,.18)));\n        will-change:transform,width,height,box-shadow; touch-action:auto;\n        /*\n         * Ensure cards are always layered above the interactive grid overlay.  The\n         * selectable grid canvas uses a z-index of 5 (see .ddc-grid-canvas).  By\n         * default the card wrappers were assigned a z-index of 2, causing\n         * newly added cards to appear behind the overlay until enough cards\n         * were added to raise the maximum z-index above 5.  Raising this\n         * baseline to 6 ensures all cards start above the grid overlay and\n         * remain interactive without requiring the user to add multiple cards.\n         */\n        z-index:6;\n      }\n      .card-wrapper.dragging{ cursor:grabbing; touch-action: none; }\n      .card-wrapper.editing.selected{\n        border-color:var(--primary-color,#03a9f4);\n        box-shadow:0 0 0 2px var(--primary-color,#03a9f4)!important;\n      }\n\n      /* CARD WRAPPER FOR BSCKGORUND COLORS START */\n\n      /* Make the inner card and its header fully transparent\n        so the wrapper\u2019s gradient is the only background shown. */\n      .card-wrapper > * {\n        /* Critical: do NOT give the card a background via this variable.\n          Some headers read --ha-card-background when header-color is unset. */\n        --ha-card-background: transparent !important;\n\n        /* Many cards also set a background on the host element; neutralize it. */\n        background: transparent !important;\n      }\n\n      /* Ensure <ha-card> itself doesn't repaint a body background */\n      .card-wrapper ha-card {\n        background: transparent !important;\n      }\n\n      /* Make header strips transparent regardless of how they are implemented */\n      .card-wrapper ::part(header),\n      .card-wrapper ::part(card-header),\n      .card-wrapper .card-header {\n        background: transparent !important;\n        box-shadow: none !important;\n        border-bottom: none !important;\n      }\n\n      /* CARD WRAPPER FOR BSCKGORUND COLORS END */\n\n      /* ---- empty-state of the card ---- */\n      .btn.cta-empty{\n        position:relative;\n        padding:12px 16px;\n        font-weight:600;\n        border-radius:14px;\n        display:inline-flex !important;\n        align-items:center;\n        gap:8px;\n        box-shadow:0 6px 18px rgba(3,169,244,.25);\n      }\n      .btn.cta-empty::after{\n        content:\"\";\n        position:absolute; inset:-4px;\n        border-radius:16px;\n        border:2px solid rgba(3,169,244,.35);\n        animation: ddc-cta-pulse 1.8s ease-out infinite;\n        pointer-events:none;\n      }\n      @keyframes ddc-cta-pulse{\n        0%   { opacity:.85; transform:scale(.98); }\n        70%  { opacity:0;   transform:scale(1.12); }\n        100% { opacity:0;   transform:scale(1.18); }\n      }\n\n      /* pleasant buttons: info (light blue) & warning (orange) */\n      .btn.info:hover{ filter: brightness(1.06); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }\n      .btn.info:active{ transform: translateY(0) }\n      .btn.warning:hover{ filter: brightness(1.07); transform: translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.18) }\n      .btn.warning:active{ transform: translateY(0) }\n\n      /* ---- chip ---- */\n      .chip{\n        position:absolute;\n        bottom:48px; left:50%; transform:translateX(-50%);\n        display:flex; gap:6px; flex-wrap:wrap;\n        opacity:0; transition:opacity .15s;\n        z-index:30; pointer-events: none;\n      }\n      .card-wrapper.editing .chip{ opacity:1; pointer-events: auto; }\n      .chip .mini{\n        display:flex; align-items:center; justify-content:center;\n        width:32px; height:32px;\n        background:linear-gradient(135deg, rgba(24,25,27,.7) 0%, rgba(40,41,43,.9) 100%);\n        color:#fff; border:1px solid rgba(255,255,255,.18); border-radius:8px; cursor:pointer;\n        box-shadow:0 2px 4px rgba(0,0,0,.25);\n        transition:background .15s, transform .1s, box-shadow .15s;\n      }\n      .chip .mini span{ display:none; }\n      .chip .mini:hover{\n        transform:translateY(-1px);\n        background:linear-gradient(135deg, rgba(24,25,27,.85) 0%, rgba(40,41,43,1) 100%);\n        box-shadow:0 3px 8px rgba(0,0,0,.4);\n      }\n      .chip .mini ha-icon{ --mdc-icon-size:20px; width:20px; height:20px; }\n      .chip .mini.danger{\n        background:linear-gradient(135deg, rgba(236,72,72,.9) 0%, rgba(255,105,97,1) 100%);\n        border-color:rgba(255,255,255,.22);\n      }\n      .chip .mini.danger:hover{\n        background:linear-gradient(135deg, rgba(236,72,72,1) 0%, rgba(255,105,97,1) 100%);\n      }\n      .chip .mini.pill{ padding:0; }\n\n      /* Edit highlight */\n      .card-wrapper.editing{ border-color:var(--primary-color,#03a9f4); touch-action: none; overflow: hidden; }\n      .card-wrapper.editing::after{\n        content:\"\"; position:absolute; inset:0; border:1px dashed var(--primary-color,#03a9f4);\n        border-radius:12px; pointer-events:none; opacity:.35; z-index:5; box-sizing:border-box;\n      }\n\n      .shield{position:absolute; inset:0; z-index:10; background:transparent; pointer-events:none}\n      .card-wrapper.editing .shield, .card-wrapper.dragging .shield{pointer-events:auto; cursor:grab}\n\n      .resize-handle{\n        display:none; position:absolute; bottom: 6px; right: 6px; width:40px; height:40px;\n        background: #27BEF5 !important; color:#fff; border-top-left-radius:40px;\n        cursor:se-resize; z-index:9999; box-shadow:0 3px 8px rgba(0,0,0,.28);\n        display:flex; align-items:center; justify-content:center;\n        transition:background .15s, transform .1s, box-shadow .15s;\n        border-bottom-right-radius:5px;\n      }\n      .resize-handle:hover{ transform:scale(1.05); box-shadow:0 6px 16px rgba(0,0,0,.35); filter:brightness(1.05); }\n      .card-wrapper.editing .resize-handle{ display:flex }\n      .resize-handle ha-icon{ --mdc-icon-size:20px; width:20px; height:20px; pointer-events:none; color: #fff !important; }\n\n      /* Delete handle */\n      .delete-handle{\n        display:none; position:absolute; top:0; left:0; width:40px; height:40px;\n        background: linear-gradient(135deg, rgba(236,72,72,.98) 0%, rgba(255,85,85,1) 100%) !important;\n        color: #fff !important;\n        box-shadow:0 3px 8px rgba(0,0,0,.28); cursor:pointer; align-items:center; justify-content:center;\n        transition:background .15s, transform .1s, box-shadow .15s;\n        border-bottom-right-radius:10px; z-index: 9999 !important;\n\n      }\n      .delete-handle:hover{ transform:scale(1.05); box-shadow:0 6px 16px rgba(0,0,0,.35); filter:brightness(1.05); }\n      .card-wrapper.editing .delete-handle{ display:flex }\n      .delete-handle ha-icon{ --mdc-icon-size:20px; width:20px; height:20px; pointer-events:none; color: #fff !important;}\n\n      /* modal */\n      .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:flex; align-items:center; justify-content:center; z-index:9000 }\n      .dialog{\n        width:min(1220px,96%); max-height:min(90vh, 900px); display:flex; flex-direction:column;\n        background:var(--card-background-color); border-radius:20px; padding:0; border:1px solid var(--divider-color); overflow:visible;\n      }\n      .dlg-head{\n        display:flex; align-items:center; gap:12px; padding:12px 16px; border-bottom:1px solid var(--divider-color);\n        background:\n          radial-gradient(1200px 120px at 20% -40px, rgba(3,169,244,.21), transparent 60%),\n          radial-gradient(900px 110px at 80% -40px, rgba(0,150,136,.18), transparent 60%);\n      }\n      .dlg-head h3{ margin:0; font-size:1.1rem; letter-spacing:.2px }\n      .dlg-foot{ display:flex; gap:10px; justify-content:flex-end; padding:12px; border-top:1px solid var(--divider-color); background:var(--primary-background-color) }\n      .btn:disabled{ opacity:.6; cursor:not-allowed }\n\n      .visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}\n\n          /* picker layout */\n          .layout{display:grid;height:min(84vh,820px);grid-template-columns:260px 1fr}\n          #leftPane{\n            border-right:1px solid var(--divider-color);\n            overflow:auto;\n            background:var(--primary-background-color);\n            color: var(--primary-text-color, #fff); /* \uD83D\uDC48 ensure readable text */\n            /*\n             * Remove contain:content so that fixed-position menus from\n             * custom card editors can correctly position themselves\n             * relative to the viewport. CSS containment can interfere\n             * with anchoring of overlays.\n             */\n            contain:none;\n          }\n          /*\n           * Allow content like dropdown menus from custom card editors to\n           * overflow the right pane without being clipped. Using overflow\n           * visible instead of hidden prevents menus from being positioned\n           * far away or requiring excessive scrolling when they open.\n           */\n          #rightPane{\n            /* Allow the right-hand editor pane to scroll vertically when\n             * content from custom card editors exceeds the available space.\n             * We hide horizontal overflow to avoid layout shifts. */\n            overflow-y:auto;\n            overflow-x:hidden;\n            background:var(--primary-background-color);\n          }\n          .rightGrid{\n            display:grid;grid-template-columns:540px 1fr;grid-template-rows:auto auto 1fr;gap:12px;padding:12px;height:100%;box-sizing:border-box;position:relative;\n          }\n          .sec{\n            border:1px solid var(--divider-color);\n            border-radius:12px;\n            background:var(--card-background-color);\n            overflow:visible;\n            position:relative;\n            /* Remove content containment on sections to prevent the\n             * creation of an artificial containing block which can\n             * disrupt dropdown positioning. */\n            contain:none;\n          }\n          .sec .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600;position: relative;z-index: 10}\n          .sec .bd{padding:12px;overflow:visible}       \n          .tabs{display:flex;gap:6px;margin-left:auto}\n          .tab{\n            font-size:.85rem;padding:6px 10px;border-radius:10px;border:1px solid var(--divider-color);\n            background:var(--primary-background-color);color:var(--primary-text-color);cursor:pointer\n          }\n          .tab.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}\n          .cm-editor{height: 100%}\n          /* --- FIX: YAML/Visual editor: ensure the entire content is visible --- */\n          /*\n           * The YAML editor previously had a fixed height which caused the\n           * bottom of longer configurations to be clipped. Removing the fixed\n           * height allows the section to flex based on available space within\n           * the grid row. A min-height of zero lets it collapse when there\n           * isn't much content, while overflow:auto enables scrolling when\n           * content exceeds the visible area.\n           */\n          #yamlSec {\n            min-height: 0;\n            height: auto !important;\n            overflow: auto;\n          }\n          #yamlSec .bd {\n            /* allow the YAML editor to use the full available space instead of a fixed max height */\n            overflow: auto;\n            max-height: none;\n            /* Fill the available grid row height (1fr) so that scrolling\n             * happens inside this section rather than expanding the editor\n             * beyond the modal boundary. A min-height of zero ensures the\n             * section can shrink when little content is present. */\n            height: 100%;\n            min-height: 0;\n          }\n          /* --- make Visual editor area scrollable, like YAML --- */\n          #optionsSec {\n            min-height: 0;\n            overflow: auto;\n          }\n          #optionsSec .bd {\n            position: relative;\n            overflow: auto;\n            height: auto;\n            max-height: none;\n            min-height: 0;\n          }\n          #editorHost {\n            display: block;\n            min-height: 0;\n          }\n\n          #quickFillSec { \n            display: flex; \n            flex-direction: column; \n            min-height: 0; \n          }\n          #quickFillSec .bd { \n            overflow: auto;          /* scroll inside the card */\n            max-height: 320px;       /* keep it contained; tweak as you wish */\n          }\n\n          /* ha-code-editor / CodeMirror height: allow growth but set a sensible minimum\n           * so that very short snippets don't collapse. Using min-height\n           * instead of a fixed height allows the editor to expand when the\n           * parent container grows. The !important flag ensures that the\n           * component\u2019s inline styles from HA won\u2019t override this sizing.\n           */\n          ha-code-editor {\n            display: block;\n            min-height: 260px;\n            height: auto !important;\n          }\n          .CodeMirror {\n            min-height: 260px;\n            height: auto !important;\n          }\n\n          /* host that wraps the editor should also allow scroll if content grows */\n          #yamlHost { \n            overflow: visible; \n            height: auto;\n          }\n\n          /* CodeMirror */\n          .CodeMirror{\n            height:260px;border:1px solid var(--divider-color);border-radius:12px;\n            background:var(--primary-background-color);color:var(--primary-text-color);\n            z-index:6;\n          }\n\n          /* YAML editor safety / visibility */\n          #yamlSec{ z-index:5; }\n          #yamlHost, #yamlHost * { touch-action: auto; }\n          ha-code-editor, ha-code-editor * { touch-action: auto; }\n          ha-code-editor{ display:block; height:260px; z-index:6; }\n\n          /* loading spinners */\n          .spin-center{\n            position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events: none; /* let clicks pass through to tabs and controls */\n          }\n\n\n          /* marquee selection rectangle */\n          .marquee{\n            position:absolute; border:1px dashed var(--primary-color);\n            background: color-mix(in srgb, var(--primary-color) 10%, transparent);\n            pointer-events:none; z-index:50;\n          }\n\n          /* placeholder tile */\n          .ddc-placeholder-inner{\n            position: relative;\n            display:flex; align-items:center; justify-content:center;\n            width:100%; height:100%;\n            border-radius:16px;\n            overflow: hidden;\n            /* cool gradient derived from HA primary color */\n            background:\n              radial-gradient(120% 120% at 100% 0%,\n                color-mix(in srgb, var(--primary-color) 18%, #000 0%) 0%,\n                transparent 60%),\n              linear-gradient(135deg,\n                color-mix(in srgb, var(--primary-color) 70%, #000 0%) 0%,\n                color-mix(in srgb, var(--primary-color) 35%, #000 0%) 100%);\n          }\n\n          /* subtle shine */\n          .ddc-placeholder-inner::after{\n            content:\"\";\n            position:absolute; inset:0;\n            background: radial-gradient(120% 90% at 0% 100%, rgba(255,255,255,.15), transparent 60%);\n            pointer-events:none;\n          }\n\n          /* center stack */\n          .ddc-hero{\n            position:absolute; inset:0;\n            display:flex; flex-direction:column; align-items:center; justify-content:center;\n            gap:16px; text-align:center; padding:24px;\n            color:rgba(255,255,255,.98);\n            text-shadow:0 1px 2px rgba(0,0,0,.35);\n            user-select:none; pointer-events:none; /* click goes to shield below */\n          }\n\n          .ddc-hero img{\n            width:128px; height:128px; object-fit:contain; opacity:.95; filter: drop-shadow(0 4px 14px rgba(0,0,0,.25));\n          }\n\n          .ddc-hero .ddc-title{\n            font-weight:800; font-size:1.25rem; letter-spacing:.2px;\n          }\n\n          .ddc-hero .ddc-sub{\n            font-weight:600; opacity:.95;\n          }\n\n          /* --- hold-to-edit ring (cursor progress) --- */\n          .ddc-press-ring{\n            position:fixed; z-index:100000; width:44px; height:44px; pointer-events:none;\n            margin-left:-22px; margin-top:-22px;\n            filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));\n          }\n          .ddc-press-ring svg{width:44px;height:44px}\n          .ddc-press-ring .pr-bg{stroke: rgba(255,255,255,.45); stroke-width:4; fill:none}\n          .ddc-press-ring .pr-fg{stroke: var(--primary-color); stroke-width:4; fill:none; stroke-linecap:round}\n          .ddc-press-ring .pr-dot{fill: var(--primary-color); opacity:.95}\n\n          /* --- edit-mode ripple transition --- */\n          .ddc-ripple-veil{\n            position:absolute; inset:0; pointer-events:none; z-index:80; overflow:hidden;\n            mix-blend-mode: screen;\n          }\n          .ddc-ripple-veil::before{\n            content:\"\"; position:absolute; left: var(--rip-x, 50%); top: var(--rip-y, 50%);\n            width:0px; height:0px; transform: translate(-50%,-50%);\n            border-radius:50%;\n            background:\n              radial-gradient(closest-side, rgba(3,169,244,.55), rgba(3,169,244,.25) 45%, rgba(0,0,0,0) 65%),\n              radial-gradient(closest-side, rgba(0,150,136,.35), rgba(0,150,136,.15) 50%, rgba(0,0,0,0) 70%);\n            filter: blur(12px);\n            animation: ddc-ripple-grow 900ms ease-out forwards;\n          }\n          .ddc-ripple-veil::after{\n            content:\"\"; position:absolute; inset:-20%;\n            background:\n              repeating-linear-gradient(115deg, rgba(3,169,244,.09) 0 12px, rgba(0,0,0,0) 12px 24px);\n            opacity:0;\n            animation: ddc-ripple-scan 900ms ease-out forwards;\n          }\n          @keyframes ddc-ripple-grow{\n            0%   { width:0; height:0; opacity:.9 }\n            60%  { width:150vmax; height:150vmax; opacity:.9 }\n            100% { width:170vmax; height:170vmax; opacity:0 }\n          }\n          @keyframes ddc-ripple-scan{\n            0%   { transform:scale(.96) rotate(0deg); opacity:0 }\n            40%  { opacity:.7 }\n            100% { transform:scale(1.06) rotate(2deg); opacity:0 }\n          }\n\n\n/* ===== DDC TABS \u2014 Minimal Redesign (pills with accent tint) ===== */\n    \n/* ====================================================================\n   CHROME-LIKE TABS \u2022 spaced + concave bottoms (sticky, CSS-only)\n   ==================================================================== */\n\n/*\n * Tabs bar: stick below the toolbar when edit mode is active.\n * The top offset uses a CSS custom property --ddc-toolbar-height set via\n * JavaScript when toggling edit mode.  This ensures that in both\n * dynamic and auto modes the tabs bar always sits directly beneath\n * the toolbar whenever it is visible.  When the toolbar is hidden,\n * --ddc-toolbar-height defaults to 0 so the tabs bar sticks to the\n * very top of the viewport.  We also include env(safe-area-inset-top)\n * to respect devices with notches/safe areas.\n */\n.ddc-tabs {\n  --bg: var(--card-background-color, #16181c);\n  --fg: var(--primary-text-color, #e6e8ea);\n  --accent: var(--primary-color, #6aa4ff);\n  --hair: color-mix(in oklab, var(--fg) 16%, transparent);\n\n  --h: 42px;\n  --gap: 16px;\n  --r-top: 14px;\n  --padX: 18px;\n\n  position: sticky;\n  top: calc(max(env(safe-area-inset-top, 0px), 0px) + var(--ddc-toolbar-height, 0px));\n  z-index: 3;\n\n  display: flex;\n  align-items: flex-end;\n  column-gap: var(--gap);\n  padding: 0 12px;\n  width: 100%;\n  box-sizing: border-box;\n\n  background: var(--bg);\n  border-bottom: 2px solid color-mix(in oklab, var(--accent) 55%, transparent);\n\n  overflow-x: auto;\n  overflow-y: hidden;\n  -webkit-overflow-scrolling: touch;\n  scroll-snap-type: x proximity;\n  scrollbar-gutter: stable;\n\n  -webkit-mask-image: linear-gradient(\n    to right,\n    transparent 0,\n    #000 16px,\n    #000 calc(100% - 16px),\n    transparent 100%\n  );\n  mask-image: linear-gradient(\n    to right,\n    transparent 0,\n    #000 16px,\n    #000 calc(100% - 16px),\n    transparent 100%\n  );\n}\n\n\n\n.ddc-tabs::-webkit-scrollbar {\n  height: 8px;\n}\n.ddc-tabs::-webkit-scrollbar-thumb {\n  background: color-mix(in oklab, var(--fg) 30%, transparent);\n  border-radius: 999px;\n}\n.ddc-tabs::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n\n/* Mobile: simple full-width tabs, no centering, no edge fade */\n@media (max-width: 768px) {\n  :host([ddc-fixed-ui]) .ddc-tabs,\n  .ddc-tabs {\n    position: sticky;\n    top: calc(\n      max(env(safe-area-inset-top, 0px), 0px) +\n      var(--ddc-toolbar-height, 0px)\n    );\n    left: 0;\n    transform: none;\n    width: 100%;\n    max-width: 100vw;\n    margin: 0;\n\n    justify-content: flex-start;     /* \uD83D\uDC48 stop centering on mobile */\n    padding-left: 0;\n    padding-right: 0;\n    padding-inline-end: 0;\n\n    overflow-x: auto;\n    overflow-y: hidden;\n    -webkit-overflow-scrolling: touch;\n\n    /* \uD83D\uDD11 remove the mask so the first tabs are fully visible */\n    -webkit-mask-image: none;\n    mask-image: none;\n\n    /* optional: avoid weird snapping on tiny screens */\n    scroll-snap-type: none;\n  }\n}\n\n\n/* ---------- TAB (Chrome-like shape) ---------- */\n/* ====================================================================\n   CHROME-LIKE TABS \u2022 centered + concave bottoms (sticky, CSS-only)\n   ==================================================================== */\n/* ====================================================================\n   CHROME-LIKE TABS \u2022 centered \u2022 concave bottoms \u2022 light active\n   Markup stays: <div class=\"ddc-tabs\"> \u2026 .ddc-tab(.active) \u2026 </div>\n   ==================================================================== */\n\n/* ---------- BAR (sticky baseline) ---------- */\n.ddc-tabs{\n  /* Theme tokens (HA-aware) */\n  --bg: var(--card-background-color, #16181c);\n  --fg: var(--primary-text-color, #e6e8ea);\n  --accent: var(--primary-color, #6aa4ff);\n  --hair: color-mix(in oklab, var(--fg) 16%, transparent);\n\n  /* Geometry knobs */\n  --h: 42px;       /* tab height */\n  --gap: 18px;     /* space between tabs */\n  --r-top: 14px;   /* top radius */\n  --cut: 22px;     /* concave cut depth at bottom corners (18\u201326 good) */\n  --padX: 18px;    /* horizontal padding */\n\n  position: sticky;\n  top: calc(max(env(safe-area-inset-top,0px), 0px) + var(--ddc-toolbar-height, 0px));\n  z-index: 3;\n\n  display: flex;\n  align-items: flex-end;\n  justify-content: center;          /* center when there\u2019s room */\n  column-gap: var(--gap);\n  padding: 0 12px;\n  width: 100%;\n  box-sizing: border-box;\n\n  background: var(--bg);\n  border-bottom: 2px solid color-mix(in oklab, var(--accent) 55%, transparent);\n\n  overflow-x: auto;\n  overflow-y: hidden;\n  -webkit-overflow-scrolling: touch;\n  scroll-snap-type: x proximity;\n  scrollbar-gutter: stable;\n\n  /* discoverable overflow edges */\n  -webkit-mask-image: linear-gradient(to right, transparent 0, #000 16px, #000 calc(100% - 16px), transparent 100%);\n          mask-image: linear-gradient(to right, transparent 0, #000 16px, #000 calc(100% - 16px), transparent 100%);\n}\n.ddc-tabs::-webkit-scrollbar{ height: 8px; }\n.ddc-tabs::-webkit-scrollbar-thumb{ background: color-mix(in oklab, var(--fg) 30%, transparent); border-radius: 999px; }\n.ddc-tabs::-webkit-scrollbar-track{ background: transparent; }\n\n/* ---------- TAB (concave corners painted; no masks required) ---------- */\n.ddc-tab{\n  -webkit-tap-highlight-color: transparent;\n  position: relative;\n  flex: 0 0 auto;\n  align-self: flex-end;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n\n  height: var(--h);\n  min-width: clamp(120px, 18ch, 280px);\n  padding: 0 var(--padX);\n  scroll-snap-align: start;\n\n  font: 600 13.5px/1 system-ui, -apple-system, Segoe UI, Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\";\n  letter-spacing: .2px;\n  color: color-mix(in oklab, var(--fg) 92%, transparent);\n  cursor: pointer;\n  user-select: none;\n\n  /* Fill with \u201Ccarved\u201D concave bottom corners:\n     we paint the BAR color into the corner arcs, which visually cuts inward */\n  background:\n    radial-gradient(120% 140% at 0 100%,     var(--bg) 0 calc(var(--cut)), transparent calc(var(--cut) + 1px)) left  bottom / var(--cut) calc(var(--cut) + 6px) no-repeat,\n    radial-gradient(120% 140% at 100% 100%,  var(--bg) 0 calc(var(--cut)), transparent calc(var(--cut) + 1px)) right bottom / var(--cut) calc(var(--cut) + 6px) no-repeat,\n    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));\n\n  /* Border drawn as inset so it follows the carve perfectly */\n  box-shadow:\n    0 0 0 1px var(--hair) inset,\n    0 2px 8px rgba(0,0,0,.22);\n\n  border: none;\n  border-top-left-radius: var(--r-top);\n  border-top-right-radius: var(--r-top);\n\n  /* sit slightly above the baseline so the concave is visible */\n  transform: translateY(4px);\n  transition:\n    transform .16s cubic-bezier(.2,.6,.2,1),\n    box-shadow .18s ease,\n    color .16s ease,\n    background-color .18s ease,\n    filter .18s ease;\n}\n\n/* icon + label */\n.ddc-tab ha-icon{ --mdc-icon-size: 18px; opacity: .95; }\n.ddc-tab .ddc-tab-label{ max-width: 100%; overflow: hidden; text-overflow: ellipsis; }\n\n/* Hover: gentle raise and slightly clearer edge */\n.ddc-tab:hover{\n  transform: translateY(2px);\n  box-shadow:\n    0 0 0 1px color-mix(in oklab, var(--fg) 24%, transparent) inset,\n    0 6px 12px rgba(0,0,0,.18);\n}\n\n/* Pressed */\n.ddc-tab:active{ transform: translateY(4px) scale(.99); }\n\n/* Focus ring */\n.ddc-tab:focus-visible{\n  outline: none;\n  box-shadow:\n    0 0 0 2px color-mix(in oklab, var(--accent) 60%, transparent),\n    0 0 0 6px color-mix(in oklab, var(--fg) 18%, transparent),\n    0 2px 8px rgba(0,0,0,.22);\n}\n\n/* ---------- ACTIVE (lighter background, connected to bar) ---------- */\n.ddc-tab.active{\n  z-index: 2;\n  transform: translateY(0);\n  color: var(--fg);\n\n  /* lighter body like your reference */\n  background:\n    radial-gradient(120% 140% at 0 100%,     var(--bg) 0 calc(var(--cut)), transparent calc(var(--cut) + 1px)) left  bottom / var(--cut) calc(var(--cut) + 6px) no-repeat,\n    radial-gradient(120% 140% at 100% 100%,  var(--bg) 0 calc(var(--cut)), transparent calc(var(--cut) + 1px)) right bottom / var(--cut) calc(var(--cut) + 6px) no-repeat,\n    linear-gradient(180deg,\n      color-mix(in oklab, #fff 20%, var(--bg) 80%),\n      color-mix(in oklab, #fff 10%, var(--bg) 90%));\n  box-shadow:\n    0 0 0 1px color-mix(in oklab, var(--fg) 26%, transparent) inset,\n    0 10px 16px rgba(0,0,0,.16),\n    0 2px 0 0 var(--bg);   /* hide the blue baseline under the active tab */\n}\n\n/* Optional small accent tick under the active tab */\n.ddc-tab::after{\n  content:\"\";\n  position:absolute; left: 24px; right: 24px; bottom: -2px;\n  height: 2px; border-radius: 2px;\n  background: color-mix(in oklab, var(--accent) 72%, transparent);\n  opacity: 0; transition: opacity .18s ease;\n}\n.ddc-tab.active::after{ opacity: 1; }\n\n/* Disabled */\n.ddc-tab[disabled], .ddc-tab[aria-disabled=\"true\"]{\n  opacity:.55; cursor:not-allowed; filter: saturate(.75);\n}\n\n/* Dark-mode base (kept HA-aware) */\n@media (prefers-color-scheme: dark){\n  .ddc-tabs{\n    --bg: var(--card-background-color, #0f1216);\n    --fg: var(--primary-text-color, #e6e8ea);\n  }\n}\n\n/* Reduced motion */\n@media (prefers-reduced-motion: reduce){\n  .ddc-tab{ transition: none !important; }\n}\n\n/* Fallback for older engines */\n@supports not (scrollbar-gutter: stable){\n  .ddc-tabs{ padding-inline-end: 16px; }\n}\n\n\n\n\n\n/* ===== DDC Tabs \u2014END ==================== */\n\n\n        /* Fly\u2011in animation for card wrappers. When the animate_cards\n           configuration option is enabled, card wrappers will animate\n           into view using this keyframe sequence. Cards translate\n           upward while fading in to produce a quick, pleasant fly\u2011in. */\n        @keyframes ddc-card-fly-in{\n          0%   { opacity: 0; transform: translateY(12px); }\n          100% { opacity: 1; transform: translateY(0); }\n        }\n        /* Apply the fly\u2011in animation to visible cards. The animation\n           duration and easing mirror other UI animations for cohesion. */\n        .card-wrapper.ddc-fly-in{\n          animation: ddc-card-fly-in 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n              \n\n        \n/* === GRID SELECT PATCH START (styles) === */\n.ddc-grid-canvas {\n  position: absolute;\n  inset: 0;\n  pointer-events: auto;     /* receives events only on empty space since it's behind cards */\n  z-index: 5;               /* above visual grid, but behind draggable cards */\n}\n/* === GRID SELECT PATCH END (styles) === */\n</style>\n        <div class=\"ddc-root\">\n        \n<div class=\"toolbar ddc-toolbar streamlined v2\" role=\"toolbar\" aria-label=\"Layout editor\">\n\n  <!-- Add & Save -->\n  <section class=\"ddc-sec sec-primary\" aria-label=\"Add & Save\">\n    <header class=\"ddc-sec-head\">\n      <span class=\"ddc-sec-dot\" aria-hidden=\"true\"></span>\n      <span class=\"ddc-sec-title\">Add &amp; Save</span>\n    </header>\n    <div class=\"ddc-row\">\n      <button class=\"btn primary cta-add\" id=\"addCardBtn\" style=\"display:none\" data-tooltip=\"Add card\">\n        <ha-icon icon=\"mdi:plus\"></ha-icon><span class=\"label\">Add Card</span>\n      </button>\n      <button class=\"btn secondary\" id=\"applyLayoutBtn\" style=\"display:none\" data-tooltip=\"Save\">\n        <ha-icon icon=\"mdi:content-save\"></ha-icon><span class=\"label\">Save</span>\n      </button>\n    </div>\n  </section>\n\n  <!-- Clipboard -->\n  <section class=\"ddc-sec sec-clip\" aria-label=\"Clipboard\">\n    <header class=\"ddc-sec-head\">\n      <span class=\"ddc-sec-dot\" aria-hidden=\"true\"></span>\n      <span class=\"ddc-sec-title\">Clipboard</span>\n    </header>\n    <div class=\"ddc-row\">\n      <button class=\"btn secondary\" id=\"copyBtn\" style=\"display:none\" data-tooltip=\"Copy\">\n        <ha-icon icon=\"mdi:content-copy\"></ha-icon><span class=\"label\">Copy</span>\n      </button>\n      <button class=\"btn secondary\" id=\"pasteBtn\" style=\"display:none\" data-tooltip=\"Paste\">\n        <ha-icon icon=\"mdi:content-paste\"></ha-icon><span class=\"label\">Paste</span>\n      </button>\n    </div>\n  </section>\n\n  <!-- Import & Share -->\n  <section class=\"ddc-sec sec-share\" aria-label=\"Import & Share\">\n    <header class=\"ddc-sec-head\">\n      <span class=\"ddc-sec-dot\" aria-hidden=\"true\"></span>\n      <span class=\"ddc-sec-title\">Import &amp; Share</span>\n    </header>\n    <div class=\"ddc-row\">\n      <button class=\"btn secondary\" id=\"importBtn\" style=\"display:none\" data-tooltip=\"Import YAML\">\n        <ha-icon icon=\"mdi:upload\"></ha-icon><span class=\"label\">Import</span>\n      </button>\n      <button class=\"btn secondary\" id=\"exportBtn\" style=\"display:none\" data-tooltip=\"Export YAML\">\n        <ha-icon icon=\"mdi:download\"></ha-icon><span class=\"label\">Export</span>\n      </button>\n      <button class=\"btn info hads\" id=\"exploreBtn\" style=\"display:none\" data-tooltip=\"Open HADS\">\n        <ha-icon icon=\"mdi:storefront-outline\"></ha-icon><span class=\"label\">Open HADS</span>\n      </button>\n      <button class=\"btn danger\" id=\"exitEditBtn\" style=\"display:none\" data-tooltip=\"Exit edit mode\">\n        <ha-icon icon=\"mdi:exit-run\"></ha-icon><span class=\"label\">Exit Edit Mode</span>\n      </button>\n    </div>\n  </section>\n  \n\n  <!-- Utilities -->\n  <section class=\"ddc-sec sec-utils\" aria-label=\"Utilities\">\n    <header class=\"ddc-sec-head\">\n      <span class=\"ddc-sec-dot\" aria-hidden=\"true\"></span>\n      <span class=\"ddc-sec-title\">Utilities</span>\n    </header>\n    <div class=\"ddc-row\">\n      <button class=\"btn secondary\" id=\"reloadBtn\" style=\"display:none\" data-tooltip=\"Reload\">\n        <ha-icon icon=\"mdi:refresh\"></ha-icon><span class=\"label\">Reload</span>\n      </button>\n      <button class=\"btn secondary\" id=\"diagBtn\" style=\"display:none\" data-tooltip=\"Diagnostics\">\n        <ha-icon icon=\"mdi:play-circle-outline\"></ha-icon><span class=\"label\">Diagnostics</span>\n      </button>\n      <button class=\"btn secondary\" id=\"settingsBtn\" style=\"display:none\" data-tooltip=\"Card Settings\">\n        <ha-icon icon=\"mdi:cog\"></ha-icon><span class=\"label\">Card Settings</span>\n      </button>\n    </div>\n  </section>\n\n  <!-- Status -->\n  <section class=\"ddc-sec sec-status\" aria-label=\"Status\">\n    <header class=\"ddc-sec-head\">\n      <span class=\"ddc-sec-dot\" aria-hidden=\"true\"></span>\n      <span class=\"ddc-sec-title\">Status</span>\n    </header>\n    <div class=\"ddc-row\">\n      <span class=\"ddc-t-status ok\" id=\"ddcStatus\" style=\"display:none\" aria-live=\"polite\">\n        <span class=\"ddc-t-dot\" id=\"ddcDot\" aria-hidden=\"true\"></span>\n        <span class=\"ddc-t-text\" id=\"ddcStatusText\">storage: backend \u00B7 OK</span>\n      </span>\n      <span class=\"store-badge\" id=\"storeBadge\" title=\"Where layout is persisted\" style=\"display:none\">storage: backend \u00B7 OK</span>\n    </div>\n  </section>\n\n</div>\n\n\n          <!-- Tabs & card container -->\n          <div class=\"ddc-tabs\" id=\"tabsBar\" style=\"display:none\"></div>\n          <div class=\"card-container\" id=\"cardContainer\">\n            <!-- host for particles.js / YouTube backgrounds -->\n            <div class=\"ddc-bg-host\" id=\"ddcBgHost\" aria-hidden=\"true\"></div>\n          </div>\n\n\n\n      `;\n      this.cardContainer = this.shadowRoot.querySelector('#cardContainer');\n      try { this._applyBackgroundFromConfig?.(); } catch {}\n\n      // Reapply screensaver settings now that the card container exists. This ensures\n      // the idle timer starts immediately and the overlay is appended correctly.\n      try { this._updateScreensaverSettings?.(); } catch {}\n      this.addButton     = this.shadowRoot.querySelector('#addCardBtn');\n      this.reloadBtn     = this.shadowRoot.querySelector('#reloadBtn');\n      this.diagBtn       = this.shadowRoot.querySelector('#diagBtn');\n      this.exitEditBtn   = this.shadowRoot.querySelector('#exitEditBtn');\n      this.storeBadge    = this.shadowRoot.querySelector('#storeBadge');\n      this.exportBtn     = this.shadowRoot.querySelector('#exportBtn');\n      this.importBtn     = this.shadowRoot.querySelector('#importBtn');\n      this.exploreBtn    = this.shadowRoot.querySelector('#exploreBtn'); \n      this.applyLayoutBtn= this.shadowRoot.querySelector('#applyLayoutBtn');\n      // Copy and Paste buttons (for edit mode)\n      this.copyBtn      = this.shadowRoot.querySelector('#copyBtn');\n      this.pasteBtn     = this.shadowRoot.querySelector('#pasteBtn');\n      this.settingsBtn  = this.shadowRoot.querySelector('#settingsBtn');\n      this.tabsBar      = this.shadowRoot.querySelector('#tabsBar');\n      this.rootEl       = this.shadowRoot.querySelector('.ddc-root');\n      try { this._renderTabs(); this._applyActiveTab(); } catch {}\n     \n\n      this._applyGridVars();\n      \n      this.addButton.addEventListener('click', () => {\n        if (!this.editMode) this._toggleEditMode(true);\n        this._openCardManager();\n      });      \n      this.reloadBtn.addEventListener('click', () => this._initialLoad(true));\n      this.diagBtn.addEventListener('click', () => this._openDiagnostics());\n      this.exitEditBtn.addEventListener('click', () => this._toggleEditMode(false));\n      this.exportBtn.addEventListener('click', () => this._exportDesign());\n      this.importBtn.addEventListener('click', () => this._importDesign());\n      this.applyLayoutBtn.addEventListener('click', () => this._saveLayout(false));\n\n      // Wire up copy/paste handlers. Only enabled in edit mode; see _toggleEditMode.\n      if (this.copyBtn) this.copyBtn.addEventListener('click', () => this._copySelection());\n      if (this.pasteBtn) this.pasteBtn.addEventListener('click', () => this._pasteClipboard());\n\n      // Open the dashboard settings menu when settings button is clicked\n      if (this.settingsBtn) this.settingsBtn.addEventListener('click', () => this._openDashboardSettings());\n       // Ctrl/Cmd + S to Apply while in DDC edit mode\n       window.addEventListener('keydown', (e) => {\n         if (!this.editMode) return;\n         if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'S')) {\n           e.preventDefault();\n           this._saveLayout(false);\n         }\n    // Observe host size for auto scaling (legacy retention for compatibility)\n    if (!this.__ddcResizeObs && this.autoResizeCards) {\n      this.__ddcResizeObs = new ResizeObserver(() => this._applyAutoScale?.());\n      try { this.__ddcResizeObs.observe(this); } catch {}\n      try { this.__ddcResizeObs.observe(this.cardContainer); } catch {}\n      try { if (this.parentElement) this.__ddcResizeObs.observe(this.parentElement); } catch {}\n      try { if (this.offsetParent) this.__ddcResizeObs.observe(this.offsetParent); } catch {}\n      window.addEventListener('resize', this.__ddcOnWinResize = () => this._applyAutoScale?.());\n    }\n    // initial scale (legacy)\n    this._applyAutoScale?.();\n\n       });\n\n      this.exploreBtn.addEventListener('click', () =>\n        window.open('https://hads.smarti.dev/', '_blank', 'noopener,noreferrer')\n      );\n\n      // apply container sizing early\n      this._applyContainerSizingFromConfig(true);\n      this._applyAutoScale?.();\n      // Long-press on blank space (4s) to enter edit; Esc exits\n      this._installLongPressToEnterEdit();\n      this._startScaleWatch?.();\n\n      window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && this.editMode) this._toggleEditMode(false);\n    // Observe host size for auto scaling\n    // Observe host size only if auto-resize is enabled\n    if (!this.__ddcResizeObs && this.autoResizeCards) {\n      this.__ddcResizeObs = new ResizeObserver(() => this._applyAutoScale?.());\n      try { this.__ddcResizeObs.observe(this); } catch {}\n      try { this.__ddcResizeObs.observe(this.cardContainer); } catch {}\n      window.addEventListener('resize', this.__ddcOnWinResize = () => this._applyAutoScale?.());\n    }\n    // initial scale\n    this._applyAutoScale?.();\n });\n\n      // selection interactions in container\n      this._installSelectionMarquee();\n      this.cardContainer.addEventListener('mousedown', (e) => {\n        if (!this.editMode) return;\n        if (e.target.closest('.card-wrapper')) return; // handled per-card\n        if (!e.shiftKey && !e.ctrlKey && !e.metaKey) this._clearSelection();\n      });\n    }\n\n    // Persist new option knobs into storage so next load matches the config.\n    // Skip while in HA\u2019s editor preview to avoid churn. Only queue save in edit mode (handled in _queueSave)\n    try { if (!this._isInHaEditorPreview()) this._queueSave('config-change'); } catch {}\n\n    this._updateStoreBadge();\n    if (this.cardContainer) this._toggleEditMode(false);\n\n    // Only rebuild from storage on first boot or when storage_key changes.\n    // For normal config tweaks, just reflow with the new options.\n   // Boot/rebuild logic\n    this.__cfgReady = true;\n    if (keyChanged && this.__booted) {\n      this._initialLoad(true);\n    } else if (!this.__booted && this.__probed) {\n      this.__booted = true;\n      this._initialLoad();\n    } else {\n      this._applyContainerSizingFromConfig(true);\n      this._applyAutoScale?.();\n      this._resizeContainer();\n    }\n  }\n\n  \n// === Initial autosize kick (view-mode safe) ===\n_startInitialAutosize() {\n  try {\n    if (this.__autoInitStarted) return;\n    this.__autoInitStarted = true;\n\n    // Debounced apply to collapse bursty triggers\n    let scheduled = false;\n    const apply = () => {\n      if (scheduled) return;\n      scheduled = true;\n      requestAnimationFrame(() => {\n        scheduled = false;\n        try { this._applyAutoScale?.(); } catch {}\n      });\n    };\n\n    // Kick a couple of frames to settle fonts/slots\n    requestAnimationFrame(() => { apply(); requestAnimationFrame(apply); });\n    setTimeout(apply, 0);\n    try { document.fonts?.ready?.then(apply); } catch {}\n\n    // Scope the MutationObserver: when auto-resize is OFF, avoid attribute churn\n    const mode = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n    const inner = this.cardContainer || this.querySelector('#cardContainer');\n    if (!inner) return;\n\n    const optsWhenScaling = { childList: true, subtree: true, attributes: true, attributeFilter: ['style','class'] };\n    const optsWhenStatic  = { childList: true, subtree: true }; // no attribute observation\n\n    const observeAttrs = (this.autoResizeCards || mode === 'auto');\n    const mo = new MutationObserver(() => apply());\n    mo.observe(inner, observeAttrs ? optsWhenScaling : optsWhenStatic);\n    this.__autoInitMO = mo;\n\n    // Auto-stop after 2s to avoid long-running loops on heavy dashboards\n    setTimeout(() => { try { mo.disconnect(); } catch {}; this.__autoInitMO = null; }, 2000);\n  } catch {}\n}\n\n\nconnectedCallback() {\n    try { this._installGridObservers_(); this._updateGridButtonsVisibility(); } catch {}this._startInitialAutosize?.();\n    try { this._applyHaChromeVisibility_?.(); \n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n    // Setup screen saver styles and timers\n    try {\n      this._ensureScreenSaverStyles?.();\n      this._updateScreensaverSettings?.();\n    } catch {}\n} catch {\n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n}\n    if (!this.__keyHandlerBound) { this.__keyHandler = (e)=>this._onKeyDown_(e); window.addEventListener('keydown', this.__keyHandler); this.__keyHandlerBound = true; \n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n}\n    if (!this.__boundExitEdit) {\n      this.__boundExitEdit = () => this._toggleEditMode(false);\n    \n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n}\n    window.addEventListener('pagehide', this.__boundExitEdit);\n    window.addEventListener('beforeunload', this.__boundExitEdit);\n  \n    this.__onVis = () => { if (document.visibilityState === 'hidden') this._toggleEditMode(false); \n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n};\n    document.addEventListener('visibilitychange', this.__onVis);\n  \n    // NEW: ensure we never boot in edit mode\n    this._toggleEditMode(false);\n  \n\n// Ensure scale reapplies when the card becomes visible (e.g., after a tab switch)\nif (!this.__visObs) {\n  const io = new IntersectionObserver((entries) => {\n    if (entries.some(e => e.isIntersecting)) {\n      requestAnimationFrame(() => this._applyAutoScale && this._applyAutoScale()); \n\n\n      io.observe(this);\n      this.__visObs = io;\n    }\n    });\n\n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n}\n\n// Also respond to window resizes\n// Respond to window resizes ONLY when scaling is active\nthis.__ddcOnWinResize = this.__ddcOnWinResize || (() => {\n  if (this.hasAttribute('ddc-fixed-ui')) {\n    try { this._computeHaSidebarGutters_?.(); } catch {}\n  }\n  this._applyAutoScale?.();\n});\n\n// Only attach when scaling is active (auto-resize ON or mode === 'auto')\ntry {\n  const mode = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (this.autoResizeCards || mode === 'auto') {\n    window.addEventListener('resize', this.__ddcOnWinResize);\n  } else {\n    window.removeEventListener('resize', this.__ddcOnWinResize);\n  }\n} catch {}\n\n    try { this.__ddcBindPointerListeners?.(); \n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n} catch {\n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n}\n\n// After any card drop, re-apply auto fill (no-scale) when in Auto mode\nthis.addEventListener('ddc:dragend', () => {\n  const m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n  if (m === 'auto') requestAnimationFrame(() => this._applyAutoFillNoScale?.());\n});\n\n}\n  \n  disconnectedCallback() {\n    try { this._uninstallGridObservers_(); } catch {}try { this._setHeaderVisible_?.(true); this._setSidebarVisible_?.(true); } catch {}\n    try { this._applyHaChromeVisibility_?.(); } catch {}\n    if (this.__keyHandlerBound && this.__keyHandler) { window.removeEventListener('keydown', this.__keyHandler); this.__keyHandlerBound = false; this.__keyHandler = null; }\n    if (!this.__keyHandlerBound) { this.__keyHandler = (e)=>this._onKeyDown_(e); window.addEventListener('keydown', this.__keyHandler); this.__keyHandlerBound = true; }\n    try { this._destroyParticles_?.(); } catch {}\n    try { this._destroyYouTube_?.(); } catch {}\n    window.removeEventListener('pagehide', this.__boundExitEdit);\n    window.removeEventListener('beforeunload', this.__boundExitEdit);\n    document.removeEventListener('visibilitychange', this.__onVis);\n\n    // Clean up screensaver timers and listeners\n    try {\n      if (this._screensaverTimer) { clearTimeout(this._screensaverTimer); this._screensaverTimer = null; }\n      if (this._clockInterval) { clearInterval(this._clockInterval); this._clockInterval = null; }\n      if (this._screensaverActivityHandler) {\n        const _evs = this._screensaverEvents || [];\n        _evs.forEach(ev => {\n          document.removeEventListener(ev, this._screensaverActivityHandler, true);\n        });\n      }\n      // Remove overlay element if present\n      if (this.screenSaverOverlay && this.screenSaverOverlay.parentNode) {\n        this.screenSaverOverlay.parentNode.removeChild(this.screenSaverOverlay);\n      }\n    } catch {}\n\n    // cleanup observers\n    try { this.__ddcResizeObs?.disconnect(); } catch {}\n    this.__ddcResizeObs = null;\n\n    // stop scale watcher\n    this._stopScaleWatch?.();\n\n    // remove resize listener\n    if (this.__ddcOnWinResize) {\n      window.removeEventListener('resize', this.__ddcOnWinResize);\n      this.__ddcOnWinResize = null;\n    }\n\n    // NEW: remove long-press listeners if installed\n    if (this.__lpInstalled && this.__lpHandlers) {\n      const cont = this.cardContainer;\n      cont?.removeEventListener('mousedown', this.__lpHandlers.mouseDown);\n      window.removeEventListener('mousemove', this.__lpHandlers.mouseMove);\n      window.removeEventListener('mouseup', this.__lpHandlers.mouseUp);\n      window.removeEventListener('contextmenu', this.__lpHandlers.contextMenu);\n      cont?.removeEventListener('touchstart', this.__lpHandlers.touchStart);\n      window.removeEventListener('touchmove', this.__lpHandlers.touchMove);\n      window.removeEventListener('touchend', this.__lpHandlers.touchEnd);\n      window.removeEventListener('touchcancel', this.__lpHandlers.touchCancel);\n      this.__lpInstalled = false;\n      this.__lpHandlers = null;\n    }\n  \n\ntry { this.__visObs && this.__visObs.disconnect(); } catch(e) {}\nthis.__visObs = null;\nif (this.__ddcOnWinResize) {\n  window.removeEventListener('resize', this.__ddcOnWinResize);\n}\n\n    try {\n      if (this.__ddcPtrBound) {\n        this.removeEventListener('pointerdown', this.__onDDCPointerDown);\n        this.removeEventListener('pointermove', this.__onDDCPointerMove);\n        window.removeEventListener('pointerup', this.__onDDCPointerUp);\n        window.removeEventListener('pointercancel', this.__onDDCPointerUp);\n        this.__ddcPtrBound = false;\n      }\n    } catch {}\n}\n  \n\n  set hass(hass) {\n    this._hass = hass;\n    LOG('set hass');\n    if (!this.__probed && hass) {\n      this.__probed = true;\n      this._probeBackend().then(() => { \n        this.__probed = true; \n        if (!this.__booted && this.__cfgReady) { \n          this.__booted = true; \n          this._initialLoad(true); \n        } \n      });\n    }\n    \n    const wraps = this.cardContainer?.children || [];\n    for (const wrap of wraps) {\n      const c = wrap.firstElementChild;\n      if (c && c.hass !== hass) {\n        c.hass = hass;\n        // Don't reprocess card_mod here - it will be handled by _processCardModOnce\n      }\n    }\n\n    // After updating hass on all cards, re\u2011evaluate visibility so that state\n    // conditions are applied when not editing. Visibility is not applied during\n    // edit mode so that all cards remain visible while editing.\n    try { this._applyVisibility_(); } catch {}\n  }\n  \n  get hass() { return this._hass; }\n\n  /* ------------------------ Initial load / rebuild ------------------------ */\n  async _initialLoad(force = false) {\n    // prevent multiple parallel boots\n    if (this.__booting) return;\n    this.__booting = true;\n\n    try {\n      // mark loading in progress to prevent autosave during rebuild\n      this._loading = true;\n\n      if (force && this.cardContainer) {\n        this.cardContainer.innerHTML = '';\n      }\n\n      this._dbgPush('boot', 'Initial load start', { force });\n\n      const __rebuildAfter = [];\n      let saved = null;\n\n      // Try backend first if available\n      if (this._backendOK && this.storageKey) {\n        try {\n          saved = await this._loadLayoutFromBackend(this.storageKey);\n        } catch (e) {\n          this._dbgPush('boot', 'Backend load failed', { error: String(e) });\n        }\n      }\n\n      // Fallback: localStorage (and migrate to backend if possible)\n      if (!saved && this.storageKey) {\n        let local = null;\n        try {\n          local = JSON.parse(localStorage.getItem(`ddc_local_${this.storageKey}`) || 'null');\n        } catch {}\n        if (local) {\n          this._dbgPush('boot', 'Found local snapshot', { bytes: JSON.stringify(local).length });\n\n          if (this._backendOK) {\n            try {\n              await this._saveLayoutToBackend(this.storageKey, local);\n              this._dbgPush('boot', 'Migrated local -> backend');\n              saved = local;\n            } catch (e) {\n              this._dbgPush('boot', 'Migration failed, staying local', { error: String(e) });\n              saved = local;\n            }\n          } else {\n            saved = local;\n          }\n        }\n      }\n\n      // Fallback: embedded YAML config\n      if (!saved && this._config?.cards?.length) {\n        this._dbgPush('boot', 'Using embedded config');\n        saved = { cards: this._config.cards };\n      }\n\n      // Snapshot of YAML before we overlay anything\n      const yamlCfg = { ...(this._config || {}) };\n\n      // 1) Apply persisted options as baseline\n        if (saved?.options) {\n  const { storage_key, ...optsNoKey } = saved.options;\n  // Do not let stale snapshot backgrounds override YAML card config\n  delete optsNoKey.background_mode;\n  delete optsNoKey.background_image;\n  delete optsNoKey.background_particles;\n  delete optsNoKey.background_youtube;\n  this._applyImportedOptions(optsNoKey, true);\n} else if (typeof saved?.grid === 'number') {\n        this._applyImportedOptions({ grid: saved.grid }, true);\n      }\n\n      // 2) Overlay explicit YAML options (take precedence)\n      const overrideKeys = [\n        'storage_key','grid','drag_live_snap','auto_save','auto_save_debounce',\n        'container_background','card_background','card_shadow','debug','disable_overlap',\n        'container_size_mode','container_fixed_width','container_fixed_height',\n        'container_preset','container_preset_orientation','tabs','tabs_position','default_tab','hide_tabs_when_single', 'auto_resize_cards', 'background_mode', 'background_image', 'background_particles', 'background_youtube'];\n      const cfgOpts = {};\n      for (const k of overrideKeys) {\n        if (yamlCfg[k] !== undefined) cfgOpts[k] = yamlCfg[k];\n      }\n      if (Object.keys(cfgOpts).length) {\n        this._applyImportedOptions(cfgOpts, true);\n      }\n\n      // Build cards\n      let builtAny = false;\n\n      if (saved?.cards?.length) {\n        for (const conf of saved.cards) {\n          if (!conf?.card || (typeof conf.card === 'object' && Object.keys(conf.card).length === 0)) {\n            // empty/placeholder\n            const wrap = this._makePlaceholderAt(\n              conf.position?.x || 0,\n              conf.position?.y || 0,\n              conf.size?.width  || 200,\n              conf.size?.height || 200\n            );\n            this.cardContainer.appendChild(wrap);\n            try { this._rebuildOnce(wrap.firstElementChild); } catch {}\n            builtAny = true;\n            continue;\n          }\n\n          const cardEl = await this._createCard(conf.card);\n          const wrap = this._makeWrapper(cardEl);\n          if (this.editMode) wrap.classList.add('editing');\n          wrap.dataset.tabId = this._normalizeTabId(conf.tabId || conf.tab_id || this.defaultTab);\n\n          this._setCardPosition(wrap, conf.position?.x || 0, conf.position?.y || 0);\n          wrap.style.width  = `${conf.size?.width  ?? 14 * this.gridSize}px`;\n          wrap.style.height = `${conf.size?.height ?? 10 * this.gridSize}px`;\n          if (conf.z != null) wrap.style.zIndex = String(conf.z);\n\n          this.cardContainer.appendChild(wrap);\n\n          try { this._rebuildOnce(wrap.firstElementChild); } catch {}\n          this._initCardInteract(wrap);\n          builtAny = true;\n        }\n\n        this._resizeContainer();\n        this._applyAutoScale?.();\n        this._dbgPush('boot', 'Layout applied', { count: saved.cards.length });\n      }\n\n      if (!builtAny) {\n        this._showEmptyPlaceholder();\n        this._applyAutoScale?.();\n        this._dbgPush('boot', 'No saved layout found; showing placeholder');\n      }\n\n      this._updateStoreBadge();\n      this._syncEmptyStateUI();\n\n      // Ensure card-mod runs once after first paint\n      if (force) this._cardModProcessed = false;\n      setTimeout(() => {\n        this._processCardModOnce();\n      }, 100);\n\n      // Rebuild signals for nested cards\n      try {\n        __rebuildAfter.forEach((el) => {\n          try {\n            el.dispatchEvent(new Event('ll-rebuild', { bubbles: true, composed: true }));\n          } catch {}\n        });\n      } catch {}\n    } finally {\n      this._loading = false;\n      this.__booting = false;\n      this.__dirty = false;\n      this._updateApplyBtn?.();\n      try { this._renderTabs(); this._applyActiveTab(); } catch {}\n      // Reevaluate visibility after the layout has been built. Cards with\n      // visibility conditions will hide themselves when not in edit mode.\n      try { this._applyVisibility_(); } catch {}\n      try {\n        const host = this.cardContainer?.querySelector?.('#ddcBgHost');\n        if (!host || !host.firstChild) this._applyBackgroundFromConfig?.();\n      } catch {}\n    }\n  }\n\n\n  \n  /* ------------------------------ Tabs support ------------------------------ */\n  _normalizeTabId(tabId) {\n    const valid = Array.isArray(this.tabs) ? this.tabs.map(t => t.id) : [];\n    if (!valid.length) return this.defaultTab || 'default';\n    return (tabId && valid.includes(tabId)) ? tabId : (this.defaultTab || valid[0]);\n  }\n  _renderTabs() {\n    const bar = this.tabsBar; if (!bar) return;\n    const tabs = Array.isArray(this.tabs) ? this.tabs : [];\n    if (!tabs.length || (tabs.length === 1 && this.hideTabsWhenSingle)) {\n      bar.style.display = 'none';\n      return;\n    }\n    bar.style.display = '';\n    bar.className = 'ddc-tabs ' + (this.tabsPosition === 'left' ? 'ddc-tabs-left' : '');\n    bar.innerHTML = '';\n\n    // In auto size mode the tabs bar should always span the viewport width.\n    // Reset any previously calculated width/maxWidth values (from dynamic mode\n    // or earlier interactions) back to 100% so that when switching between\n    // tabs with different card widths, the bar is guaranteed to stretch\n    // across the entire viewport and allow full horizontal scrolling.  Without\n    // this reset the bar may retain the width from the prior tab and clip\n    // the newly selected tab\u2019s content until the page is refreshed.\n    try {\n      const mode = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n      if (mode === 'auto') {\n        bar.style.width = '100%';\n        bar.style.maxWidth = '100%';\n      }\n    } catch {}\n    for (const t of tabs) {\n      const btn = document.createElement('button');\n      btn.className = 'ddc-tab' + (t.id === this.activeTab ? ' active' : '');\n      btn.dataset.tabId = t.id;\n      btn.title = t.label || t.id;\n      btn.innerHTML = `${t.icon ? `<ha-icon icon=\"${t.icon}\"></ha-icon>` : ''}<span class=\"ddc-tab-label\">${t.label ?? t.id}</span>`;\n      btn.addEventListener('click', () => {\n        if (this.activeTab !== t.id) {\n          this.activeTab = t.id;\n          try { localStorage.setItem(`ddc_lasttab_${this.storageKey}`, t.id); } catch {}\n          this._applyActiveTab();\n          this._renderTabs();\n          // Reapply visibility for the newly active tab. Visibility must be\n          // evaluated after switching tabs so cards with conditions are\n          // properly hidden when the tab becomes active.\n          try { this._applyVisibility_(); } catch {}\n      try {\n        const host = this.cardContainer?.querySelector?.('#ddcBgHost');\n        if (!host || !host.firstChild) this._applyBackgroundFromConfig?.();\n      } catch {}\n        }\n      });\n      bar.appendChild(btn);\n    }\n    if (this.rootEl) this.rootEl.classList.toggle('ddc-tabs-left-layout', this.tabsPosition === 'left');\n  \n    try { this._updateTabsA11y_?.(); } catch {}\n\n    // After rendering tabs, ensure the bar width matches the visible\n    // card container width (scaled or unscaled). Without syncing the width,\n    // the tabs could stretch to the full page width instead of aligning\n    // with the drag-and-drop container.\n    try { this._syncTabsWidth_?.(); } catch {}\n\n    // On narrow viewports the tabs bar becomes horizontally scrollable.  When\n    // switching to a tab that lies outside the current viewport, the scroll\n    // position should update so that the newly active tab is brought into\n    // view.  Without this the bar may snap back to an arbitrary midpoint,\n    // particularly on mobile devices.  We only scroll when the content\n    // actually overflows to avoid unnecessary jitter on wide screens.\n    try {\n      const activeBtn = bar.querySelector?.('.ddc-tab.active');\n      if (activeBtn && bar.scrollWidth > bar.clientWidth) {\n        let vw = 0;\n        try {\n          vw = window.innerWidth || document.documentElement?.clientWidth || 0;\n        } catch {}\n\n        // On small screens let the user control the scroll position manually.\n        if (!vw || vw > 768) {\n          // Desktop / wide: still auto-scroll the active tab into view.\n          activeBtn.scrollIntoView({\n            behavior: 'auto',\n            block: 'nearest',\n            inline: 'nearest',\n          });\n        }\n      }\n    } catch {}\n  }\n  _applyActiveTab() {\n    const current = this._normalizeTabId(this.activeTab);\n    const wraps = this.cardContainer?.querySelectorAll?.('.card-wrapper') || [];\n    wraps.forEach(w => {\n      const tabId = w.dataset.tabId ? this._normalizeTabId(w.dataset.tabId) : this.defaultTab;\n      if (!this.tabs || !this.tabs.length) {\n        w.style.display = '';\n        w.inert = false;\n        w.classList.remove('ddc-hidden');\n        return;\n      }\n      if (tabId === current) {\n        w.style.display = '';\n        w.inert = false;\n        w.classList.remove('ddc-hidden');\n      } else {\n        w.style.display = 'none';\n        w.inert = true;\n        w.classList.add('ddc-hidden');\n        w.classList.remove('ddc-selected');\n      }\n    });\n\n    // After switching tabs, reapply sizing based on the current container mode.\n    try {\n      const __m = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n      if (__m === 'auto') {\n        this._applyAutoFillNoScale?.();\n      } else {\n        this._applyAutoScale?.();\n      }\n    } catch {}\n\n    try { this._clearSelection(); } catch {}\n    // When card animations are enabled, animate visible cards after switching tabs\n    try {\n      if (this.animateCards) {\n        this._animateCards?.();\n      }\n    } catch {}\n  }\n\n  /**\n   * Animate all visible card wrappers. When the animateCards flag is true\n   * this method is invoked after switching tabs or on initial load. It\n   * iterates over each wrapper that is currently displayed and applies\n   * a CSS class that triggers a short fly\u2011in animation. The class is\n   * removed once the animation completes so subsequent tab switches can\n   * retrigger the animation. Hidden wrappers (display: none) are skipped.\n   */\n_animateCards() {\n  try {\n    const wraps = this.cardContainer?.querySelectorAll?.('.card-wrapper') || [];\n    const reduceMotion = window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches;\n\n    // \uD83C\uDF9A\uFE0F Master controls\n    const totalAnimationTime = 800;   // Total sequence time (ms)\n    const animationIntensity = 0.8;    // 1 = default, 2 = more dramatic, 0.5 = subtle\n\n    // Derived timing values\n    const durationRatio = 0.3; // Portion of total time used for each card\u2019s animation\n    const duration = totalAnimationTime * durationRatio;\n    const maxDelay = totalAnimationTime - duration;\n\n    wraps.forEach((w) => {\n      // Skip hidden cards\n      const cs = window.getComputedStyle?.(w);\n      const isHidden =\n        (w.style.display === 'none') ||\n        (cs && cs.display === 'none') ||\n        w.classList.contains('ddc-hidden');\n      if (isHidden) return;\n\n      // Preserve any existing transform from layout\n      const base = (cs && cs.transform && cs.transform !== 'none') ? cs.transform : '';\n\n      // \uD83E\uDE84 Fly-in distance increases with intensity\n      const offsetY = 100 * animationIntensity; // % of element height\n      const fromT = `${base} translate3d(0, ${offsetY}%, 0)`;\n      const toT   = `${base} translate3d(0, 0, 0)`;\n\n      // \uD83C\uDFB2 Random delay spread scales with intensity\n      const delay = Math.random() * (maxDelay * Math.min(animationIntensity, 2)); // cap at 2\u00D7 spread\n\n      if (reduceMotion) {\n        try {\n          w.animate([{ opacity: 0 }, { opacity: 1 }], {\n            duration: totalAnimationTime * 0.15,\n            delay,\n            easing: 'linear',\n            fill: 'backwards'\n          });\n        } catch {\n          w.style.opacity = '0';\n          setTimeout(() => {\n            w.style.transition = `opacity ${totalAnimationTime * 0.15}ms linear`;\n            w.style.opacity = '1';\n          }, delay);\n        }\n        return;\n      }\n\n      try {\n        w.style.willChange = 'opacity, transform';\n\n        const motionEase = 'cubic-bezier(0.4, 0, 0.2, 1)';\n        const opacityEase = 'linear';\n\n        // Opacity fade\n        w.animate(\n          [{ opacity: 0 }, { opacity: 1 }],\n          { duration, delay, easing: opacityEase, fill: 'backwards' }\n        );\n\n        // Transform upward flight\n        w.animate(\n          [{ transform: fromT }, { transform: toT }],\n          { duration, delay, easing: motionEase, fill: 'backwards' }\n        ).addEventListener?.('finish', () => {\n          w.style.willChange = '';\n        });\n      } catch {\n        // Fallback without Web Animations API\n        w.style.opacity = '0';\n        w.style.transform = fromT;\n        w.style.willChange = 'opacity, transform';\n        setTimeout(() => {\n          w.style.transition = `opacity ${duration}ms linear, transform ${duration}ms cubic-bezier(0.4,0,0.2,1)`;\n          w.style.opacity = '1';\n          w.style.transform = toT;\n          setTimeout(() => {\n            w.style.transition = '';\n            w.style.willChange = '';\n          }, duration + 60);\n        }, delay);\n      }\n    });\n  } catch (e) {\n    console.warn('[ddc:animate] animation error', e);\n  }\n}\n\n\n\n\n\n\n\n  _addTabSelectorToChip(wrapper, entryTabId = null) {\n    if (!this.tabs || !this.tabs.length) return;\n    const chip = wrapper.querySelector('.chip'); if (!chip) return;\n    let sel = chip.querySelector('select.ddc-chip-tab');\n    if (!sel) {\n      sel = document.createElement('select');\n      sel.className = 'ddc-chip-tab';\n      sel.style.marginLeft = '6px';\n      sel.title = 'Assign to tab';\n      chip.appendChild(sel);\n    }\n    sel.innerHTML = '';\n    for (const t of this.tabs) {\n      const opt = document.createElement('option');\n      opt.value = t.id; opt.textContent = t.label || t.id;\n      sel.appendChild(opt);\n    }\n    const cur = this._normalizeTabId(entryTabId || wrapper.dataset.tabId || this.activeTab || this.defaultTab);\n    sel.value = cur;\n    wrapper.dataset.tabId = cur;\n    sel.onchange = () => {\n      wrapper.dataset.tabId = this._normalizeTabId(sel.value);\n      this._applyActiveTab();\n      // Reapply visibility so conditions evaluate in the new tab context.\n      try { this._applyVisibility_(); } catch {}\n      try {\n        const host = this.cardContainer?.querySelector?.('#ddcBgHost');\n        if (!host || !host.firstChild) this._applyBackgroundFromConfig?.();\n      } catch {}\n      try { this._queueSave('tab-change'); } catch {}\n    };\n  }\n  \n/* ------------------------------ Edit mode ------------------------------ */\n_toggleEditMode(force = null) {\n  try { this.__clearPressTimer?.(); } catch {}\n\n  const entering = (force === null) ? !this.editMode : !!force;\n  const wasOff   = !this.editMode && entering;\n  // EDIT MODE PIN gate\n  try {\n    const cfgPin = (this.config && this.config.edit_mode_pin != null) ? String(this.config.edit_mode_pin) : '';\n    const runtimePin = (this.editModePin != null) ? String(this.editModePin) : '';\n    const pin = (runtimePin || cfgPin).trim();\n    if (entering && !this.editMode && pin) {\n      const entered = window.prompt('Enter PIN / password to open Edit Mode:');\n      if (entered === null) return;\n      if (String(entered).trim() !== pin) { this._toast?.('Incorrect PIN/password.'); return; }\n    }\n\n  } catch (e) {}\n\n\n  // Find toolbar in a robust way (no early return)\n  const host = this.renderRoot || this.shadowRoot || this;\n  const toolbar = host?.querySelector?.('.ddc-toolbar.streamlined.v2, .ddc-toolbar.streamlined.v3');\n\n  // Helpers that are null-safe\n  const setDisplay = (el, val) => { try { if (el) el.style.display = val; } catch {} };\n  const on  = 'inline-block';\n  const off = 'none';\n\n  const showButtons = () => {\n    setDisplay(this.addButton, on);\n    setDisplay(this.reloadBtn, on);\n    setDisplay(this.diagBtn, on);\n    setDisplay(this.exitEditBtn, on);\n    setDisplay(this.exportBtn, on);\n    setDisplay(this.importBtn, on);\n    setDisplay(this.exploreBtn, on);\n    setDisplay(this.storeBadge, on);\n    setDisplay(this.applyLayoutBtn, on);\n    setDisplay(this.copyBtn, on);\n    setDisplay(this.pasteBtn, on);\n    setDisplay(this.settingsBtn, on);\n  };\n\n  const hideButtons = () => {\n    setDisplay(this.addButton, off);\n    setDisplay(this.reloadBtn, off);\n    setDisplay(this.diagBtn, off);\n    setDisplay(this.exitEditBtn, off);\n    setDisplay(this.exportBtn, off);\n    setDisplay(this.importBtn, off);\n    setDisplay(this.exploreBtn, off);\n    setDisplay(this.storeBadge, off);\n    setDisplay(this.applyLayoutBtn, off);\n    setDisplay(this.copyBtn, off);\n    setDisplay(this.pasteBtn, off);\n    setDisplay(this.settingsBtn, off);\n  };\n\n  // === Animate only if we actually found a toolbar ===\n  if (toolbar) {\n    const DUR = 260; // keep in sync with CSS --ddc-dur\n\n    if (entering) {\n      // Make sure it can be measured even if CSS says display:none !important\n      toolbar.setAttribute('data-force-open', '1');\n      // also hard-force as an ultimate fallback\n      toolbar.style.display = 'grid';\n\n      // Reveal buttons first so height is real\n      showButtons();\n\n      // Let layout settle, then measure & open\n      requestAnimationFrame(() => {\n        const h = toolbar.scrollHeight || 0;\n        toolbar.style.setProperty('--open-h', h + 'px');\n        toolbar.classList.add('is-open');\n        // keep data-force-open; :has() + buttons will keep it visible\n      });\n\n    } else {\n      // Ensure it\u2019s visible while we animate out\n      toolbar.setAttribute('data-force-open', '1');\n      toolbar.style.display = 'grid';\n\n      // Lock current height as start, then collapse next frame\n      const h = toolbar.scrollHeight || 0;\n      toolbar.style.setProperty('--open-h', h + 'px');\n\n      requestAnimationFrame(() => {\n        toolbar.classList.remove('is-open');\n      });\n\n      // After the CSS transition ends, actually hide buttons and release shim\n      setTimeout(() => {\n        hideButtons();\n        toolbar.removeAttribute('data-force-open');\n        // Let your existing CSS take over (display:none when not in edit)\n      }, DUR);\n    }\n  } else {\n    // No toolbar found; still flip mode & show/hide buttons so app logic continues\n    entering ? showButtons() : hideButtons();\n  }\n\n  // === Your existing non-visual logic unchanged ===\n  this.editMode = entering;\n  this._syncEmptyStateUI?.();\n  this.cardContainer?.classList.toggle('grid-on', this.editMode);\n\n  // When entering or exiting edit mode, reset the screensaver timer to prevent\n  // the screensaver from activating during edits and to hide it if currently active.\n  try {\n    if (typeof this._resetScreensaverTimer === 'function') {\n      this._resetScreensaverTimer();\n    }\n  } catch {}\n\n  const wraps = this.cardContainer?.querySelectorAll?.('.card-wrapper') || [];\n  wraps.forEach((w) => {\n    w.classList.toggle('editing', this.editMode);\n    const handle = w.querySelector('.resize-handle');\n    if (handle) handle.style.display = this.editMode ? 'flex' : 'none';\n    if (!w.dataset.placeholder && window.interact) {\n      window.interact(w).draggable(this.editMode).resizable(this.editMode);\n    }\n    w.style.touchAction = this.editMode ? 'none' : 'auto';\n  });\n  if (!this.editMode) this._clearSelection?.();\n\n  if (!this.editMode) {\n    this.cardContainer?.querySelectorAll('.card-wrapper.dragging')\n      .forEach(w => w.classList.remove('dragging'));\n  }\n\n  if (wasOff) {\n    const ox = this.__lastHoldX ?? null;\n    const oy = this.__lastHoldY ?? null;\n    this._playEditRipple?.(ox, oy);\n  }\n\n  try { this._applyHaChromeVisibility_?.(); } catch {}\n\n  // === Update CSS variable for toolbar height on the root so the tabs bar\n  // can offset itself when the toolbar is visible.  When entering edit\n  // mode, measure the toolbar height and assign it to --ddc-toolbar-height\n  // on the root element.  When leaving edit mode, reset the value to 0.\n  try {\n    const root = this.shadowRoot?.querySelector?.('.ddc-root') || this.renderRoot?.querySelector?.('.ddc-root') || null;\n    if (root) {\n      let h = 0;\n      // If we are entering edit mode and have a toolbar element, read its\n      // scrollHeight to include all buttons and margins.  If leaving edit\n      // mode, h remains 0.\n      if (entering && toolbar) {\n        try { h = toolbar.scrollHeight || toolbar.offsetHeight || 0; } catch {}\n      }\n      root.style.setProperty('--ddc-toolbar-height', h + 'px');\n      // When auto\u2011resize cards is disabled, push down the card container\n      // by the height of the toolbar so the draggable area does not sit\n      // underneath the toolbar.  Clear the margin when exiting edit mode.\n      if (!this.autoResizeCards && this.cardContainer) {\n        if (entering && toolbar) {\n          this.cardContainer.style.marginTop = h + 'px';\n        } else {\n          this.cardContainer.style.marginTop = '';\n        }\n      }\n    }\n  } catch {}\n\n  // === Ensure the drag area renders fully on edit-mode toggle ===\n  // In dynamic mode with auto\u2011resize off, the container does not\n  // recompute its dimensions until a card is moved.  This can result\n  // in the drag-and-drop area appearing clipped when first entering\n  // edit mode.  Explicitly trigger a resize after toggling edit mode\n  // so that the container grows to fit its contents and the grid\n  // overlay updates immediately.  Always guard against missing\n  // functions.\n  try {\n    // Resize the container based on current card positions.  This\n    // updates its width/height and refreshes the grid overlay.\n    if (typeof this._resizeContainer === 'function') {\n      this._resizeContainer();\n    }\n    // Reapply scaling to ensure the card container stays aligned\n    // relative to the viewport and to recompute pointer scaling.\n    if (typeof this._applyAutoScale === 'function') {\n      this._applyAutoScale();\n    }\n  } catch {}\n}\n\n  _isInHaEditorPreview() {\n    // Walk up through parents and shadow hosts to detect HA's edit/preview dialog\n    let n = this;\n    while (n) {\n      const tag = (n.nodeType === 1 && n.localName) ? n.localName.toLowerCase() : '';\n      if (tag === 'hui-card-editor' || tag === 'hui-dialog-edit-card' || tag === 'hui-card-preview') return true;\n      if (tag === 'ha-dialog' || tag === 'mwc-dialog') return true; // general HA dialogs (edit card, more-info, etc.)\n      const root = n.getRootNode && n.getRootNode();\n      n = n.parentElement || (root && root.host) || null;\n    }\n    return false;\n  }\n\n  // Replace your _installLongPressToEnterEdit with this version:\n  /* 2) Install long-press ONCE, keep handles so we can remove them later */\n  // Replace your existing _installLongPressToEnterEdit() with this:\n// Robust, pointer-events-based long-press to enter edit mode\n_installLongPressToEnterEdit() {\n  if (this.__lpInstalled) return;\n  this.__lpInstalled = true;\n\n  const cont = this.cardContainer;\n  if (!cont) return;\n\n  // Tunables\n  const HOLD_MS  = 800;  // how long to hold\n  const DRIFT_PX = 18;   // cancel if the pointer drifts more than this\n\n  // ---- helpers ------------------------------------------------------------\n  const isElem = (n) => !!n && typeof n === 'object' && n.nodeType === 1; // Element node\n  const containsSafe = (root, node) => {\n    try { return !!(root && node && typeof root.contains === 'function' && isElem(node) && root.contains(node)); }\n    catch { return false; }\n  };\n  const within = (el) => containsSafe(this.cardContainer, el);\n\n  const isOverCard = (ev) => {\n    // 1) Fast path via target.closest\n    const hit = ev.target?.closest?.('.card-wrapper');\n    if (isElem(hit) && within(hit) && !hit.classList.contains('ddc-placeholder')) return true;\n\n    // 2) Robust path via composedPath() (skip non-Elements like window/document)\n    const path = typeof ev.composedPath === 'function' ? ev.composedPath() : [];\n    for (const n of path) {\n      if (!isElem(n)) continue;\n      if (!within(n)) continue;\n      if (n.classList?.contains('card-wrapper') && !n.classList.contains('ddc-placeholder')) return true;\n    }\n    return false;\n  };  \n\n  const makeRing = (x, y) => {\n    const el = document.createElement('div');\n    el.className = 'ddc-press-ring';\n    document.body.appendChild(el); // ensure always visible\n    Object.assign(el.style, {\n      position: 'fixed', left: `${x}px`, top: `${y}px`,\n      zIndex: '100000', width: '44px', height: '44px',\n      pointerEvents: 'none', marginLeft: '-22px', marginTop: '-22px',\n      filter: 'drop-shadow(0 2px 6px rgba(0,0,0,.35))'\n    });\n    el.innerHTML = `\n      <svg viewBox=\"0 0 44 44\" aria-hidden=\"true\" style=\"width:44px;height:44px\">\n        <circle cx=\"22\" cy=\"22\" r=\"18\" style=\"stroke:rgba(255,255,255,.45);stroke-width:4;fill:none\"></circle>\n        <circle class=\"pr-fg\" cx=\"22\" cy=\"22\" r=\"18\" style=\"stroke:var(--primary-color);stroke-width:4;fill:none;stroke-linecap:round\"></circle>\n        <circle cx=\"22\" cy=\"22\" r=\"2\" style=\"fill:var(--primary-color);opacity:.95\"></circle>\n      </svg>`;\n    const fg = el.querySelector('.pr-fg');\n    const r = 18, circ = 2 * Math.PI * r;\n    fg.style.strokeDasharray = `${circ}`;\n    fg.style.strokeDashoffset = `${circ}`;\n    requestAnimationFrame(() => {\n      fg.style.transition = `stroke-dashoffset ${HOLD_MS}ms linear`;\n      fg.style.strokeDashoffset = '0';\n    });\n    return {\n      el,\n      move(nx, ny) { el.style.left = `${nx}px`; el.style.top = `${ny}px`; },\n      remove() { try { el.remove(); } catch {} }\n    };\n  };  \n\n\n  \n  // ---- state --------------------------------------------------------------\n  let timer = null;\n  let ring  = null;\n  let startX = 0, startY = 0;\n  let activePointerId = null;\n\n  const clearTimer = () => { if (timer) clearTimeout(timer); timer = null; ring?.remove(); ring = null; };\n  this.__clearPressTimer = clearTimer; // allow external cancel on mode changes\n\n\n  \n  // ---- handlers -----------------------------------------------------------\n  const onPointerDown = (e) => {\n    // Left mouse / primary touch only\n    if (e.pointerType === 'mouse' && e.button !== 0) return;\n    if (this._isInHaEditorPreview()) return;\n\n    // Only trigger on empty space *within this container*\n    if (!within(e.target) || isOverCard(e)) return;\n\n    activePointerId = e.pointerId;\n    startX = e.clientX; startY = e.clientY;\n    this.__lastHoldX = startX; this.__lastHoldY = startY;\n\n    // visual progress ring\n    ring = makeRing(startX, startY);\n\n    timer = setTimeout(() => {\n      clearTimer();\n      const toState = !this.editMode;\n      this._toggleEditMode(toState);\n      this._toast?.(`Edit mode ${toState ? 'enabled' : 'disabled'}`);\n    }, HOLD_MS);\n  };\n\n  const onPointerMove = (e) => {\n    if (timer == null || e.pointerId !== activePointerId) return;\n    ring?.move(e.clientX, e.clientY);\n    if (Math.abs(e.clientX - startX) > DRIFT_PX || Math.abs(e.clientY - startY) > DRIFT_PX) {\n      clearTimer();\n    }\n  };\n\n  const onPointerUpOrCancel = (e) => {\n    if (e.pointerId !== activePointerId) return;\n    clearTimer();\n    activePointerId = null;\n  };\n\n  const onContextMenu = (e) => {\n    // prevent the OS context menu *only while* long-press is pending\n    if (timer) { e.preventDefault(); e.stopPropagation(); return false; }\n  };\n\n  const onDblClick = (e) => {\n    if (this._isInHaEditorPreview()) return;\n    if (!within(e.target) || isOverCard(e)) return;\n    const toState = !this.editMode;\n    this._toggleEditMode(toState);\n    this._toast?.(`Edit mode ${toState ? 'enabled' : 'disabled'}`);\n  };\n\n  // ---- wire up ------------------------------------------------------------\n  cont.addEventListener('pointerdown', onPointerDown);\n  window.addEventListener('pointermove', onPointerMove, { passive: true });\n  window.addEventListener('pointerup', onPointerUpOrCancel, { passive: true });\n  window.addEventListener('pointercancel', onPointerUpOrCancel, { passive: true });\n  window.addEventListener('contextmenu', onContextMenu);\n\n  cont.addEventListener('dblclick', onDblClick);\n\n  // keep references for clean-up in disconnectedCallback\n  this.__lpHandlers = { onPointerDown, onPointerMove, onPointerUpOrCancel, onContextMenu, onDblClick };\n}\n\n\n_isLayoutEmpty() {\n  const c = this.cardContainer;\n  if (!c) return true;\n  return c.querySelectorAll('.card-wrapper:not(.ddc-placeholder)').length === 0;\n}\n\n_syncEmptyStateUI() {\n  // Show Add button even outside edit mode when empty; style it as a CTA.\n  const empty = this._isLayoutEmpty();\n  if (this.addButton) {\n    const show = this.editMode || empty;\n    this.addButton.style.display = show ? 'inline-block' : 'none';\n    this.addButton.classList.toggle('cta-empty', !this.editMode && empty);\n  }\n\n  // Keep other toolbar buttons hidden unless we\u2019re in edit mode\n  const toggle = (el) => el && (el.style.display = this.editMode ? 'inline-block' : 'none');\n  toggle(this.reloadBtn);\n  toggle(this.diagBtn);\n  toggle(this.exitEditBtn);\n  toggle(this.exportBtn);\n  toggle(this.importBtn);\n  toggle(this.exploreBtn);\n  toggle(this.storeBadge);\n  toggle(this.applyLayoutBtn);\n  }\n\n    _updateApplyBtn() {\n    if (this.applyLayoutBtn) this.applyLayoutBtn.disabled = !this.__dirty;\n  }\n  _markDirty(reason='') {\n    this.__dirty = true;\n    this._updateApplyBtn();\n    this._dbgPush?.('dirty', 'Marked dirty', { reason });\n  }\n\n  _playEditRipple(clientX=null, clientY=null) {\n    const cont = this.cardContainer;\n    if (!cont) return;\n    const r = cont.getBoundingClientRect();\n    const x = clientX == null ? (r.left + r.width/2) : clientX;\n    const y = clientY == null ? (r.top  + r.height/2) : clientY;\n    const localX = x - r.left;\n    const localY = y - r.top;\n\n    const veil = document.createElement('div');\n    veil.className = 'ddc-ripple-veil';\n    veil.style.setProperty('--rip-x', `${localX}px`);\n    veil.style.setProperty('--rip-y', `${localY}px`);\n    cont.appendChild(veil);\n    setTimeout(()=> veil.remove(), 450);\n  }\n\n  /* ------------------------- Drag/Resize via Interact ------------------------- */\n  _initInteract() {\n    const wraps = this.cardContainer.querySelectorAll('.card-wrapper');\n    wraps.forEach((w) => this._initCardInteract(w));\n  }\n  _initCardInteract(wrap) {\n    if (!window.interact || wrap.dataset.placeholder) return;\n    const gs = this.gridSize, live = !!this.dragLiveSnap;\n\n    // DRAG (supports multi\u2011select move with optional live snap)\n    const restrictMod = window.interact.modifiers.restrictRect({\n      restriction: 'parent',\n      endOnly: true\n    });\n    const mods = [restrictMod];\n\n    // When dragLiveSnap is true, use Interact\u2019s built\u2011in snap modifier so the pointer\n    // (and therefore the element) is snapped to the grid before your handler runs.\n    const autoscaled =\n      (this.__pointerScaleX && Math.abs(this.__pointerScaleX - 1) > 1e-6) ||\n      (this.__pointerScaleY && Math.abs(this.__pointerScaleY - 1) > 1e-6);\n\n    if (this.dragLiveSnap && !autoscaled) {\n      const gridSnap = window.interact.snappers.grid({ x: this.gridSize, y: this.gridSize });\n      mods.push(window.interact.modifiers.snap({\n        targets: [gridSnap],\n        range: Infinity,\n        offset: 'startCoords'\n      }));\n    }\n\n    window.interact(wrap).draggable({\n      enabled: this.editMode,\n      inertia: false,\n      modifiers: mods,\n      listeners: {\n        start: (ev) => {\n          // ensure the clicked card is in the selection\n          if (!this._selection.has(wrap)) {\n            if (!ev?.shiftKey && !ev?.ctrlKey && !ev?.metaKey) this._clearSelection();\n            this._toggleSelection(wrap, true);\n          }\n          const group = Array.from(this._selection);\n          this.__groupDrag = {\n            leader: wrap,\n            members: group,\n            startRaw: new Map(group.map(w => [w, {\n              x: parseFloat(w.getAttribute('data-x-raw')) || parseFloat(w.getAttribute('data-x')) || 0,\n              y: parseFloat(w.getAttribute('data-y-raw')) || parseFloat(w.getAttribute('data-y')) || 0,\n              w: parseFloat(w.style.width)  || w.getBoundingClientRect().width,\n              h: parseFloat(w.style.height) || w.getBoundingClientRect().height,\n            }]))\n          };\n\n          // Capture original raw positions of all cards (non\u2011placeholders) so we can restore them\n          this.__collisionOriginals = new Map();\n          const allCardsStart = this.cardContainer.querySelectorAll('.card-wrapper:not(.ddc-placeholder)');\n          allCardsStart.forEach(c => {\n            const rawX = parseFloat(c.getAttribute('data-x-raw')) || parseFloat(c.getAttribute('data-x')) || 0;\n            const rawY = parseFloat(c.getAttribute('data-y-raw')) || parseFloat(c.getAttribute('data-y')) || 0;\n            this.__collisionOriginals.set(c, { x: rawX, y: rawY });\n          });\n\n          group.forEach(w => {\n            w.classList.add('dragging');\n            if (w.getAttribute('data-x-raw') === null) {\n              w.setAttribute('data-x-raw', w.getAttribute('data-x') || '0');\n            }\n            if (w.getAttribute('data-y-raw') === null) {\n              w.setAttribute('data-y-raw', w.getAttribute('data-y') || '0');\n            }\n          });\n        },\n\n        move: (ev) => {\n          if (!this.__groupDrag) return;\n          const gs   = this.gridSize;\n          const live = !!this.dragLiveSnap;\n          const lead = this.__groupDrag.leader;\n          const srL  = this.__groupDrag.startRaw.get(lead);\n\n          // Compute new raw leader coordinates using pointer delta\n          // Convert screen-pixel deltas to design-space deltas\n          // Convert screen-pixel deltas \u2192 design space using current scale\n          const sx = this.__pointerScaleX || 1;\n          const sy = this.__pointerScaleY || 1;\n\n          const curLeadX = (parseFloat(lead.getAttribute('data-x-raw')) || srL.x) + (ev.dx / sx);\n          const curLeadY = (parseFloat(lead.getAttribute('data-y-raw')) || srL.y) + (ev.dy / sy);\n          const dxLead   = curLeadX - srL.x;\n          const dyLead   = curLeadY - srL.y;\n\n          // Build proposed positions for all selected cards\n          const proposed = this.__groupDrag.members.map(m => {\n            const sr = this.__groupDrag.startRaw.get(m);\n            const rawX  = sr.x + dxLead;\n            const rawY  = sr.y + dyLead;\n            const snapX = live ? Math.round(rawX / gs) * gs : rawX;\n            const snapY = live ? Math.round(rawY / gs) * gs : rawY;\n            return { el: m, rawX, rawY, snapX, snapY, w: sr.w, h: sr.h };\n          });\n\n          // If overlap protection is on, restore other cards and push them out of the way\n          if (this.disableOverlap) {\n            this._pushCardsOutOfTheWay(proposed, dxLead, dyLead, live, gs);\n          }\n\n          // Commit the move: update raw coordinates and apply snapped transform\n          lead.setAttribute('data-x-raw', String(curLeadX));\n          lead.setAttribute('data-y-raw', String(curLeadY));\n          for (const pr of proposed) {\n            pr.el.setAttribute('data-x-raw', String(pr.rawX));\n            pr.el.setAttribute('data-y-raw', String(pr.rawY));\n            this._setCardPosition(pr.el, pr.snapX, pr.snapY);\n          }\n          this._resizeContainer();\n        },\n\n        end: (ev) => {\n          if (!this.__groupDrag) return;\n          const gs = this.gridSize;\n\n          // Gather final positions (unsnapped and snapped) for the dragged group\n          const endRects = this.__groupDrag.members.map(m => {\n            const rawX = parseFloat(m.getAttribute('data-x-raw')) || parseFloat(m.getAttribute('data-x')) || 0;\n            const rawY = parseFloat(m.getAttribute('data-y-raw')) || parseFloat(m.getAttribute('data-y')) || 0;\n            const snapX = Math.round(rawX / gs) * gs;\n            const snapY = Math.round(rawY / gs) * gs;\n            const w  = parseFloat(m.style.width)  || m.getBoundingClientRect().width;\n            const h  = parseFloat(m.style.height) || m.getBoundingClientRect().height;\n            return { el: m, rawX, rawY, snapX, snapY, w, h };\n          });\n\n          // On end, do a final restore/push to prevent leftover overlaps\n          if (this.disableOverlap) {\n            this._pushCardsOutOfTheWay(endRects, 0, 0, false, gs);\n          }\n\n          // Snap cards to the grid and update raw coordinates\n          for (const pr of endRects) {\n            this._setCardPosition(pr.el, pr.snapX, pr.snapY);\n            pr.el.setAttribute('data-x-raw', String(pr.snapX));\n            pr.el.setAttribute('data-y-raw', String(pr.snapY));\n          }\n\n          // Cleanup\n          for (const m of this.__groupDrag.members) m.classList.remove('dragging');\n          this._resizeContainer();\n          if (this._isContainerFixed()) this._clampAllCardsInside();\n          this._queueSave(this.__groupDrag.members.length > 1 ? 'group-drag-end' : 'drag-end');\n          this.__groupDrag = null;\n          this.__collisionOriginals = null;\n        }\n      }\n    });\n\n\n\n    // RESIZE \u2014 bottom-right handle only (single card)\n    window.interact(wrap).resizable({\n      enabled: this.editMode,\n      edges: { right: '.resize-handle', bottom: '.resize-handle' },\n      inertia:false,\n      listeners:{\n        move:(ev)=>{\n          const gs   = this.gridSize;\n          const live = !!this.dragLiveSnap;\n          const curW = parseFloat(wrap.style.width)  || wrap.getBoundingClientRect().width;\n          const curH = parseFloat(wrap.style.height) || wrap.getBoundingClientRect().height;\n    \n          const sx = this.__pointerScaleX || 1;\n          const sy = this.__pointerScaleY || 1;\n          let width  = ev.rect.width  / sx;\n          let height = ev.rect.height / sy;\n          const wTry = live ? Math.max(gs, Math.round(width / gs) * gs)  : width;\n          const hTry = live ? Math.max(gs, Math.round(height / gs) * gs) : height;\n                  \n          const x = parseFloat(wrap.getAttribute('data-x')) || 0;\n          const y = parseFloat(wrap.getAttribute('data-y')) || 0;\n        \n          // \u2B07\uFE0F clamp size if container is fixed\n          let nextW = wTry;\n          let nextH = hTry;\n          if (this._isContainerFixed()) {\n            const { w: cw, h: ch } = this._getContainerSize();\n            nextW = Math.min(wTry, Math.max(this.gridSize, cw - x));\n            nextH = Math.min(hTry, Math.max(this.gridSize, ch - y));\n          }\n        \n          const proposed = [ this._rectFor(wrap, x, y, nextW, nextH) ];\n        \n          if (this.disableOverlap && this._anyCollisionFor(proposed, new Set([wrap]))) {\n            return;\n          }\n          wrap.style.width  = `${nextW}px`;\n          wrap.style.height = `${nextH}px`;\n          this._resizeContainer();\n        },\n        end:()=>{\n          const gs = this.gridSize;\n          const prevW = parseFloat(wrap.style.width)  || wrap.getBoundingClientRect().width;\n          const prevH = parseFloat(wrap.style.height) || wrap.getBoundingClientRect().height;\n        \n          let wSnap = Math.max(gs, Math.round(prevW/gs)*gs);\n          let hSnap = Math.max(gs, Math.round(prevH/gs)*gs);\n        \n          const x = parseFloat(wrap.getAttribute('data-x')) || 0;\n          const y = parseFloat(wrap.getAttribute('data-y')) || 0;\n        \n          // \u2B07\uFE0F clamp snapped size if container is fixed\n          if (this._isContainerFixed()) {\n            const { w: cw, h: ch } = this._getContainerSize();\n            wSnap = Math.min(wSnap, Math.max(gs, cw - x));\n            hSnap = Math.min(hSnap, Math.max(gs, ch - y));\n          }\n        \n          const proposed = [ this._rectFor(wrap, x, y, wSnap, hSnap) ];\n        \n          if (this.disableOverlap && this._anyCollisionFor(proposed, new Set([wrap]))) {\n            // keep pre-snap size (already applied)\n          } else {\n            wrap.style.width  = `${wSnap}px`;\n            wrap.style.height = `${hSnap}px`;\n          }\n        \n          this._resizeContainer();\n          if (this._isContainerFixed()) this._clampAllCardsInside();   // optional safety\n          this._queueSave('resize-end');\n        }\n      }\n    });\n\n    // selection with clicks\n    wrap.addEventListener('mousedown', (e) => {\n      if (!this.editMode) return;\n      // Ignore clicks on controls: resize handle, delete handle, or chip actions\n      if (e.target.closest('.resize-handle') || e.target.closest('.delete-handle') || e.target.closest('.chip')) return;\n      if (e.shiftKey || e.ctrlKey || e.metaKey) {\n        e.stopPropagation();\n        this._toggleSelection(wrap); // toggle in multi\n      } else {\n        if (!this._selection.has(wrap)) {\n          this._clearSelection();\n          this._toggleSelection(wrap, true);\n        }\n      }\n    });\n  }\n\n  /* ------------------------ Card creation & wrapper ------------------------ */\n  async _createCard(cfg) {\n    const helpers = (await this._helpersPromise) || await window.loadCardHelpers();\n    const el = helpers.createCardElement(cfg);\n    el.hass = this.hass;\n    \n    // Special handling for mod-card\n    if (cfg.type === 'custom:mod-card') {\n      // mod-card needs to be fully initialized before we can work with it\n      await new Promise(resolve => setTimeout(resolve, 0));\n      \n      // Force mod-card to apply its styles\n      if (el.setConfig && typeof el.setConfig === 'function') {\n        try {\n          // Re-apply config to ensure mod-card processes it\n          el.setConfig(cfg);\n        } catch {}\n      }\n    }\n    \n    return el;\n  }\n\n  _makeWrapper(cardEl) {\n    const wrap = document.createElement('div');\n    wrap.classList.add('card-wrapper');\n    wrap.dataset.tabId = this._normalizeTabId(this.activeTab || this.defaultTab);\n    if (this.editMode) wrap.classList.add('editing');\n    if (!wrap.style.zIndex) {\n      // Compute the next z-index and ensure it is at least 6.  Without\n      // clamping, the first few cards could be assigned low z-indices\n      // that place them behind the grid overlay.  See _highestZ() for\n      // baseline initialization.\n      const nextVal = this._highestZ() + 1;\n      wrap.style.zIndex = String(Math.max(nextVal, 6));\n    }\n\n    const chip = document.createElement('div');\n    chip.className = 'chip';\n    chip.innerHTML = `\n      <button class=\"mini\" data-act=\"edit\" title=\"Edit\" aria-label=\"Edit\">\n        <ha-icon icon=\"mdi:pencil\"></ha-icon><span>Edit</span>\n      </button>\n      <button class=\"mini\" data-act=\"duplicate\" title=\"Duplicate\" aria-label=\"Duplicate\">\n        <ha-icon icon=\"mdi:content-copy\"></ha-icon><span>Duplicate</span>\n      </button>\n      <button class=\"mini pill\" data-act=\"front\" title=\"Bring forward\" aria-label=\"Bring forward\">\n        <ha-icon icon=\"mdi:arrange-bring-forward\"></ha-icon>\n      </button>\n      <button class=\"mini pill\" data-act=\"back\" title=\"Send backward\" aria-label=\"Send backward\">\n        <ha-icon icon=\"mdi:arrange-send-backward\"></ha-icon>\n      </button>\n      <button class=\"mini pill\" data-act=\"front-most\" title=\"Bring to front\" aria-label=\"Bring to front\">\n        <ha-icon icon=\"mdi:arrange-bring-to-front\"></ha-icon>\n      </button>\n      <button class=\"mini pill\" data-act=\"back-most\" title=\"Send to back\" aria-label=\"Send to back\">\n        <ha-icon icon=\"mdi:arrange-send-to-back\"></ha-icon>\n      </button>\n    `;\n\n    // Create a dedicated delete handle that sits in the top\u2011left corner. This\n    // replaces the delete button in the chip and mimics the resize handle in\n    // style. Clicking it will remove the card (or multiple cards if a group\n    // selection exists).\n    const delHandle = document.createElement('div');\n    delHandle.className = 'delete-handle';\n    delHandle.innerHTML = `<ha-icon icon=\"mdi:close-thick\"></ha-icon>`;\n    delHandle.addEventListener('click', (e) => {\n      e.stopPropagation();\n      // When multiple cards are selected and the current wrapper is among them,\n      // delete all selected cards. Otherwise delete just this wrapper.\n      if (this._selection.size > 1 && this._selection.has(wrap)) {\n        const toDel = Array.from(this._selection);\n        toDel.forEach(w => w.remove());\n        this._clearSelection();\n        this._resizeContainer();\n        this._queueSave('delete-multi');\n        this._ensurePlaceholderIfEmpty?.();\n      } else {\n        wrap.remove();\n        this._resizeContainer();\n        this._queueSave('delete');\n        this._ensurePlaceholderIfEmpty?.();\n      }\n    });\n\n    // Tab selector UI\n    try { this._addTabSelectorToChip(wrap, wrap.dataset.tabId); } catch {}\n\n    chip.addEventListener('click', async (e) => {\n      e.stopPropagation();\n      const act = e.target?.closest('button')?.dataset?.act; if (!act) return;\n\n      if (act === 'delete') {\n        if (this._selection.size > 1 && this._selection.has(wrap)) {\n          const toDel = Array.from(this._selection);\n          toDel.forEach(w => w.remove());\n          this._clearSelection();\n          this._resizeContainer(); this._queueSave('delete-multi'); this._ensurePlaceholderIfEmpty();\n        } else {\n          wrap.remove(); this._resizeContainer(); this._queueSave('delete'); this._ensurePlaceholderIfEmpty();\n        }\n      } else if (act === 'duplicate' || act === 'copy') {\n        const targets = (this._selection.size > 1 && this._selection.has(wrap)) ? Array.from(this._selection) : [wrap];\n        for (const t of targets) {\n          const cfg = this._extractCardConfig(t.firstElementChild) || {};\n          const dup = await this._createCard(cfg);\n          const w2 = this._makeWrapper(dup);\n          w2.style.width  = t.style.width;\n          w2.style.height = t.style.height;\n          const x = (parseFloat(t.getAttribute('data-x')) || 0) + this.gridSize;\n          const y = (parseFloat(t.getAttribute('data-y')) || 0) + this.gridSize;\n          this._setCardPosition(w2, x, y);\n          // Ensure a baseline z-index of 6 so duplicates are always above the grid\n          // overlay.  Compute next z-index and clamp to at least 6.\n          {\n            const nextVal = this._highestZ() + 1;\n            w2.style.zIndex = String(Math.max(nextVal, 6));\n          }\n          // Preserve the tab assignment from the original wrapper so that\n          // duplicates appear in the correct tab rather than defaulting to\n          // the currently active tab. See bug #3.\n          try {\n            const tid = t.dataset?.tabId;\n            if (tid) w2.dataset.tabId = tid;\n          } catch {}\n          this.cardContainer.appendChild(w2);\n          // Attach a tab selector to the duplicated wrapper so the user can\n          // reassign it later; pass the current tab so the selector defaults\n          // correctly.\n          try { this._addTabSelectorToChip?.(w2, w2.dataset.tabId); } catch {}\n          try { this._rebuildOnce(w2.firstElementChild); } catch {}\n          this._initCardInteract(w2);\n        }\n        this._resizeContainer();\n        this._queueSave('duplicate');\n      } else if (act === 'front') {\n        // Bring forward by one layer\n        this._adjustZ(wrap, +1);\n      } else if (act === 'back')  {\n        // Send backward by one layer\n        this._adjustZ(wrap, -1);\n      } else if (act === 'front-most') {\n        // Bring selected card(s) to the very front (highest z-index)\n        const targets = (this._selection.size > 1 && this._selection.has(wrap)) ? Array.from(this._selection) : [wrap];\n        // Sort targets by current z-index ascending so their relative order is maintained when moving to top\n        targets.sort((a, b) => {\n          const za = parseInt(a.style.zIndex || '1', 10);\n          const zb = parseInt(b.style.zIndex || '1', 10);\n          return za - zb;\n        });\n        let base = this._highestZ();\n        for (const w of targets) {\n          base += 1;\n          w.style.zIndex = String(base);\n        }\n        this._queueSave('z-change');\n      } else if (act === 'back-most') {\n        // Send selected card(s) to the very back (lowest z-index)\n        const targets = (this._selection.size > 1 && this._selection.has(wrap)) ? Array.from(this._selection) : [wrap];\n        // Sort targets by current z-index descending so their relative order is maintained when moving to bottom\n        targets.sort((a, b) => {\n          const za = parseInt(a.style.zIndex || '1', 10);\n          const zb = parseInt(b.style.zIndex || '1', 10);\n          return zb - za;\n        });\n        // Determine the current minimum z-index among all cards\n        let minZ = Infinity;\n        this.cardContainer.querySelectorAll('.card-wrapper').forEach(w => {\n          const z = parseInt(w.style.zIndex || '1', 10);\n          if (z < minZ) minZ = z;\n        });\n        if (!isFinite(minZ)) minZ = 1;\n        let baseMin = minZ;\n        for (const w of targets) {\n          baseMin -= 1;\n          // Ensure cards never drop below 6 so they remain above the grid overlay.\n          w.style.zIndex = String(Math.max(6, baseMin));\n        }\n        this._queueSave('z-change');\n      } else if (act === 'edit') {\n        const cfg = this._extractCardConfig(wrap.firstElementChild) || {};\n        await this._openSmartPicker('edit', cfg, async (newCfg) => {\n          const oldEl = wrap.firstElementChild;\n          const newEl = await this._createCard(newCfg);\n\n          // persist cfg on wrapper (and card-mod flag if you use it)\n          try {\n            wrap.dataset.cfg = JSON.stringify(newCfg);\n            if (this._hasCardModDeep?.(newCfg)) wrap.dataset.needsCardMod = 'true';\n            else delete wrap.dataset.needsCardMod;\n          } catch {}\n\n          // swap the element\n          wrap.replaceChild(newEl, oldEl);\n\n          // ensure connected before driving updates (important for Lit cards)\n          await raf();\n          try {\n            newEl.hass = this.hass;\n            newEl.requestUpdate?.();\n            if (newEl.updateComplete) { try { await newEl.updateComplete; } catch {} }\n          } catch {}\n\n          try { this._rebuildOnce(newEl); } catch {}\n          try { newEl.dispatchEvent(new Event('ll-rebuild', { bubbles: true, composed: true })); } catch {}\n\n          this._resizeContainer?.();\n\n          // SAVE -> THEN HARD RELOAD (avoid debounce race)\n          try {\n            clearTimeout(this._saveTimer);           // cancel debounced save\n            await this._saveLayout(true);            // flush save now\n          } catch (e) { console.warn('Save before reload failed', e); }\n\n          window.location.reload();                  // force refresh so edited card appears\n        });\n      }\n    });\n\n    // ADD THE MISSING SHIELD ELEMENT\n    const shield = document.createElement('div');\n    shield.className = 'shield';\n\n    // ADD THE MISSING HANDLE ELEMENT\n    const handle = document.createElement('div');\n    handle.classList.add('resize-handle');\n    if (!this.editMode) handle.style.display = 'none';  // hide handle if not editing\n    handle.title = 'Resize';\n    handle.innerHTML = `<ha-icon icon=\"mdi:resize-bottom-right\"></ha-icon>`;\n\n    // cache the card config on the wrapper\n    try {\n      const cfg = cardEl._config || cardEl.config;\n      if (cfg && typeof cfg === 'object' && Object.keys(cfg).length) {\n        wrap.dataset.cfg = JSON.stringify(cfg);\n        \n        // Mark if this needs card_mod processing\n        if (this._hasCardModDeep(cfg)) { wrap.dataset.needsCardMod = 'true'; }\n      }\n    } catch {}\n\n    // include the delete handle before the resize handle so it appears beneath it in the DOM\n    wrap.append(cardEl, shield, chip, delHandle, handle);\n    // DDC patch: trigger one-time rebuild so nested card_mod attaches\n    try { this._rebuildOnce(cardEl); } catch {}\n    return wrap;\n  }\n\n  _makePlaceholderAt(x=0,y=0,w=400,h=400) {\n    const wrap = document.createElement('div');\n    wrap.classList.add('card-wrapper','ddc-placeholder');\n    wrap.dataset.placeholder = '1';\n    if (this.editMode) wrap.classList.add('editing');\n    this._setCardPosition(wrap, x, y);\n    wrap.style.width = `${w}px`;\n    wrap.style.height = `${h}px`;\n    wrap.style.zIndex = String(this._highestZ() + 1);\n  \n    const inner = document.createElement('div');\n    inner.className = 'ddc-placeholder-inner';\n    // purely decorative; nothing clickable\n    inner.setAttribute('aria-hidden','true');\n\n    // --- Hero UI (image + text) ---\n    const hero = document.createElement('div');\n    hero.className = 'ddc-hero';\n\n    // Optional image: from config.hero_image (e.g. /local/dragdrop-hero.png)\n    // If not provided, this block simply won\u2019t render an <img>.\n    const heroImgUrl = this.heroImage; // already set to default or config override\n    if (heroImgUrl) {\n      const img = document.createElement('img');\n      img.src = heroImgUrl;\n      img.alt = \"\";\n      hero.appendChild(img);\n    }\n\n    // Title + subtitle\n    const title = document.createElement('div');\n    title.className = 'ddc-title';\n    title.textContent = 'Drag & Drop Card';\n    const sub = document.createElement('div');\n    sub.className   = 'ddc-sub';\n    sub.textContent = 'Hold me / double click me to enter Edit mode';\n\n    hero.append(title, sub);\n    inner.appendChild(hero);\n\n    // Let users double-click anywhere on the placeholder to enter edit\n    wrap.addEventListener('dblclick', (e) => {\n      e.stopPropagation();\n      this._toggleEditMode(true);\n    });\n  \n    const shield = document.createElement('div');\n    shield.className = 'shield';\n  \n    wrap.append(inner, shield);\n    return wrap;\n  }\n\n    _processCardModOnce() {\n    // Only run once per load\n    if (this._cardModProcessed) return;\n    this._cardModProcessed = true;\n    \n    const wraps = this.cardContainer?.querySelectorAll('[data-needs-card-mod=\"true\"]') || [];\n    \n    wraps.forEach(wrap => {\n      const card = wrap.firstElementChild;\n      if (!card) return;\n      \n      const config = card._config || card.config;\n      if (!config) return;\n      \n      // For mod-card specifically, we need to wait for it to be fully initialized\n      if (config.type === 'custom:mod-card') {\n        // mod-card needs its inner card to be ready\n        setTimeout(() => {\n          if (card.updateComplete) {\n            card.updateComplete.then(() => {\n              card.requestUpdate();\n            });\n          } else if (card.setConfig) {\n            try {\n              card.setConfig({...config});\n            } catch {}\n          }\n        }, 100);\n      } else if (config.card_mod && card.setConfig) {\n        // Regular card_mod\n        try {\n          card.setConfig({...config});\n        } catch {}\n      }\n    });\n  }\n\n  _showEmptyPlaceholder() {\n    // Avoid creating multiple placeholders\n    if (this.cardContainer.querySelector('.ddc-placeholder')) return;\n    // Define placeholder dimensions.  These values mirror the original\n    // implementation and can be adjusted if the default size changes.\n    const phW = 200;\n    const phH = 200;\n    // Initially create the placeholder at (0,0) so that the resize logic can\n    // compute an appropriate container size.  We will center it after the\n    // container dimensions have been updated.\n    const p = this._makePlaceholderAt(0, 0, phW, phH);\n    this.cardContainer.appendChild(p);\n    // Resize the container so its dimensions reflect the presence of the\n    // placeholder.  Without this call the container width/height may be\n    // reported as zero, preventing proper centering.\n    this._resizeContainer();\n    // Compute the center position for the placeholder relative to the\n    // component\u2019s bounding box rather than the card container.  The card\n    // container grows and shrinks based on its contents, so its width may\n    // match the placeholder width exactly, making (cw - phW)/2 equal to 0.\n    // Instead, use the host element\u2019s bounding rectangle to find the\n    // available width/height and offset by the difference between the\n    // container and host origins.  This centers the placeholder within\n    // the entire drag\u2011and\u2011drop card, not just within the container.\n    try {\n      const rootRect = this.getBoundingClientRect?.();\n      const contRect = this.cardContainer?.getBoundingClientRect?.();\n      if (rootRect && contRect) {\n        // Compute center coordinates in the host\u2019s coordinate space\n        const hostCenterX = (rootRect.width  - phW) / 2;\n        const hostCenterY = (rootRect.height - phH) / 2;\n        // Translate host coordinates into container coordinates\n        let centerX = hostCenterX - (contRect.left - rootRect.left);\n        let centerY = hostCenterY - (contRect.top  - rootRect.top);\n        // Clamp to zero to avoid negative translations on very small hosts\n        if (!Number.isFinite(centerX) || centerX < 0) centerX = 0;\n        if (!Number.isFinite(centerY) || centerY < 0) centerY = 0;\n        this._setCardPosition(p, centerX, centerY);\n      }\n    } catch {\n      // Fallback: leave placeholder at (0,0) if any errors occur\n    }\n    // Update UI state (add button visibility, etc.)\n    this._syncEmptyStateUI();\n  }\n  _hideEmptyPlaceholder() { this.cardContainer.querySelectorAll('.ddc-placeholder').forEach(n => n.remove()); }\n  _ensurePlaceholderIfEmpty() {\n    const realCards = this.cardContainer.querySelectorAll('.card-wrapper:not(.ddc-placeholder)');\n    if (realCards.length === 0) this._showEmptyPlaceholder();\n        this._applyAutoScale?.();\n    this._syncEmptyStateUI();\n  }\n\n  _adjustZ(wrap, delta) {\n    const cur = parseInt(wrap.style.zIndex || '1', 10);\n    let next = cur + delta;\n    next = Math.max(1, Math.min(9999, next));\n    wrap.style.zIndex = String(next);\n    this._queueSave('z-change');\n  }\n\n  _highestZ() {\n    // Default to a baseline of 5 so that newly created cards (which use\n    // _highestZ() + 1) start at a z-index of at least 6.  Without this\n    // baseline the first few cards would receive very low z-indices (1\u20134)\n    // and appear behind the interactive grid overlay (z-index 5).  By\n    // initializing max to 5 the first call returns 5, causing the first\n    // wrapper to be assigned 6.  Subsequent wrappers will increment from\n    // there, preserving relative ordering.\n    let max = 5;\n    this.cardContainer.querySelectorAll('.card-wrapper').forEach(w => {\n      const z = parseInt(w.style.zIndex || '0', 10);\n      if (z > max) max = z;\n    });\n    return max;\n  }\n\n  _setCardPosition(el, x, y) {\n    const nx = Math.round(x);\n    const ny = Math.round(y);\n    el.style.transform = `translate3d(${nx}px, ${ny}px, 0)`;\n    el.setAttribute('data-x', String(nx));\n    el.setAttribute('data-y', String(ny));\n    // Do NOT touch data-*-raw here; drag/resize \n  }\n  \n\n  // --- Auto-scale helpers (only active when auto_resize_cards === true) ---\n  _computeDesignSize() {\n    const c = this.cardContainer; if (!c) return { w: 1, h: 1 };\n    // If fixed sizing is enabled, use those dimensions as design space\n    if (this._isContainerFixed()) {\n      const { w, h } = this._resolveFixedSize();\n      return { w: Math.max(1, w), h: Math.max(1, h) };\n    }\n    // Otherwise compute from content extents similar to _resizeContainer\n    let maxX = 0, maxY = 0;\n    const cards = Array.from(c.querySelectorAll('.card-wrapper'));\n    if (!cards.length) {\n      const rect = c.getBoundingClientRect();\n      return { w: Math.max(1, rect.width || 1), h: Math.max(1, rect.height || 1) };\n    }\n    for (const wEl of cards) {\n      const x = parseFloat(wEl.getAttribute('data-x-raw') || wEl.getAttribute('data-x') || '0') || 0;\n      const y = parseFloat(wEl.getAttribute('data-y-raw') || wEl.getAttribute('data-y') || '0') || 0;\n      const w = parseFloat(wEl.style.width)  || wEl.getBoundingClientRect().width  || 0;\n      const h = parseFloat(wEl.style.height) || wEl.getBoundingClientRect().height || 0;\n      const right  = x + w;\n      const bottom = y + h;\n      if (right  > maxX) maxX = right;\n      if (bottom > maxY) maxY = bottom;\n    }\n    // Round up to grid to avoid half pixels\n    const gw = Math.max(1, this.gridSize || 10);\n    maxX = Math.ceil(maxX / gw) * gw;\n    maxY = Math.ceil(maxY / gw) * gw;\n    return { w: Math.max(1, maxX), h: Math.max(1, maxY) };\n  }\n\n\n  /* -------------------- Live scale watcher (rAF fallback) -------------------- */\n/* -------------------- Live scale watcher (rAF fallback) -------------------- */\n_startScaleWatch() {\n  if (!this.autoResizeCards) return;\n  if (this.__scaleRAF) return;\n\n  const tick = () => {\n    if (!this.autoResizeCards) {\n      this.__scaleRAF = null;\n      return;\n    }\n\n    // Safely measure host width\n    let w = 1;\n    try {\n      const rect = this.getBoundingClientRect?.();\n      w = Math.max(1, (rect && rect.width) || this.offsetWidth || 1);\n    } catch {\n      w = Math.max(1, this.offsetWidth || 1);\n    }\n\n    const last  = this.__lastScaleW || 0;\n    const delta = Math.abs(w - last);\n\n    // Hysteresis: ignore tiny width changes (scrollbar, rounding, etc.)\n    const MIN_DELTA = 20; // px \u2013 adjust if you want it more/less sensitive\n\n    if (!last || delta >= MIN_DELTA) {\n      this.__lastScaleW = w;\n\n      const mode = String(\n        this.containerSizeMode || this.container_size_mode || 'dynamic'\n      ).toLowerCase();\n\n      if (mode === 'auto') {\n        this._applyAutoFillNoScale?.();\n      } else {\n        this._applyAutoScale?.();\n      }\n    }\n\n    this.__scaleRAF = requestAnimationFrame(tick);\n  };\n\n  this.__scaleRAF = requestAnimationFrame(tick);\n}\n\n  _stopScaleWatch() {\n    if (this.__scaleRAF) {\n      try { cancelAnimationFrame(this.__scaleRAF); } catch {}\n      this.__scaleRAF = null;\n    }\n  }\n_applyAutoScale() {\n  // 1) Early path: \"auto\" mode (no proportional scaling)\n  let mode = 'dynamic';\n  try {\n    mode = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n    if (mode === 'auto') {\n      this._applyAutoFillNoScale?.();\n      this.removeAttribute('ddc-fixed-ui');\n      this.style?.removeProperty?.('--ddc-ui-width');\n      return;\n    }\n  } catch {}\n\n  const c = this.cardContainer;\n  if (!c) return;\n\n  // 2) Only ensure scale wrapper when actually scaling\n  try {\n    if (this.autoResizeCards || mode === 'auto') {\n      if (typeof this._ensureScaleWrapper === 'function') this._ensureScaleWrapper();\n    }\n  } catch {}\n\n  // 3) Auto-resize OFF: lock to scale(1) but do not force a fixed UI.  In\n  // dynamic mode, the toolbar and tabs should remain in the normal flow\n  // (similar to auto mode) rather than being centered with a fixed width.\n  if (!this.autoResizeCards) {\n    const d = (typeof this._computeDesignSize === 'function')\n      ? this._computeDesignSize()\n      : { w: c.offsetWidth || 1, h: c.offsetHeight || 1 };\n\n    if (mode === 'dynamic') {\n      try { this._computeHaSidebarGutters_?.(); } catch {}\n      // Remove any fixed UI attributes and widths so the toolbar and tabs\n      // behave like they do in auto mode.  Without this the UI is centered\n      // via CSS (:host[ddc-fixed-ui]) which causes inconsistent styling.\n      this.removeAttribute('ddc-fixed-ui');\n      this.style?.removeProperty?.('--ddc-ui-width');\n    } else {\n      this.removeAttribute('ddc-fixed-ui');\n      this.style?.removeProperty?.('--ddc-ui-width');\n    }\n\n    // Avoid write\u2192observer loops\n    const wantW = `${d.w}px`;\n    const wantH = `${d.h}px`;\n    const sameW = c.style.width === wantW;\n    const sameH = c.style.height === wantH;\n    const sameT = c.style.transform === 'scale(1)';\n\n    if (!(sameW && sameH && sameT)) {\n      c.style.width = wantW;\n      c.style.height = wantH;\n      c.style.transform = 'scale(1)';\n      c.style.transformOrigin = 'top left';\n      c.style.position = 'absolute';\n      c.style.top = '0';\n      c.style.left = '0';\n\n      this.__pointerScaleX = 1;\n      this.__pointerScaleY = 1;\n\n      if (this.__scaleOuter) {\n        const pw =\n          (this.parentElement && this.parentElement.getBoundingClientRect?.().width) ||\n          (this.offsetParent && this.offsetParent.getBoundingClientRect?.().width) ||\n          (this.getBoundingClientRect && this.getBoundingClientRect().width) ||\n          this.offsetWidth || d.w;\n\n        const wantOuterW = `${Math.max(1, pw)}px`;\n        const wantOuterH = `${Math.max(1, d.h)}px`;\n        if (this.__scaleOuter.style.width  !== wantOuterW) this.__scaleOuter.style.width  = wantOuterW;\n        if (this.__scaleOuter.style.height !== wantOuterH) this.__scaleOuter.style.height = wantOuterH;\n      }\n    }\n\n    try { this._syncTabsWidth_?.(); } catch {}\n    return;\n  }\n\n  // 4) Auto-resize ON (dynamic scaling path)\n  this.removeAttribute('ddc-fixed-ui');\n  this.style?.removeProperty?.('--ddc-ui-width');\n\n  const d = (typeof this._computeDesignSize === 'function')\n    ? this._computeDesignSize()\n    : { w: c.offsetWidth || 1, h: c.offsetHeight || 1 };\n\n  const pw =\n    (this.parentElement && this.parentElement.getBoundingClientRect?.().width) ||\n    (this.offsetParent && this.offsetParent.getBoundingClientRect?.().width) ||\n    (this.getBoundingClientRect && this.getBoundingClientRect().width) ||\n    this.offsetWidth || d.w;\n\n  const availableW = Math.max(1, pw);\n  // Compute the scale factor relative to the design width.  Previously the\n  // factor was clamped to \u22641, meaning the layout would only shrink but\n  // never grow.  This resulted in the \u201Cauto\u2011resize cards\u201D option having\n  // no visible effect in dynamic mode when the design was narrower than\n  // the viewport.  Remove the clamp so that smaller layouts can grow to\n  // fill the available space.  If desired a maximum cap could be\n  // introduced here; for now allow the layout to scale up as needed.\n  const scale = availableW / Math.max(1, d.w);\n\n  if (this.__scaleOuter) {\n    this.__scaleOuter.style.width  = `${availableW}px`;\n    this.__scaleOuter.style.height = `${Math.max(1, d.h * scale)}px`;\n  }\n\n  c.style.width = `${d.w}px`;\n  c.style.height = `${d.h}px`;\n  c.style.transform = `scale(${scale})`;\n  c.style.transformOrigin = 'top left';\n  c.style.position = 'absolute';\n  c.style.top = '0';\n  c.style.left = '0';\n\n  // pointer \u2192 design scale\n  this.__pointerScaleX = scale || 1;\n  this.__pointerScaleY = scale || 1;\n\n  try { this._syncTabsWidth_?.(); } catch {}\n  try { this._layoutYtBackground_?.(); } catch {}\n  // After applying a new scale, refresh the grid overlay dimensions so that\n  // the selectable squares cover the scaled content area.  Without this\n  // update the overlay may not extend across the resized canvas.\n  try { this._requestGridButtonsUpdateSoon?.(); } catch {}\n}\n\n\n// AUTO (strict): behave like dynamic, but only \"fill\" when viewport > natural content; never scale.\n_applyAutoFillNoScale() {\n  if (this.__applyingAutoFill) return;\n  this.__applyingAutoFill = true;\n  try {\n    // Ensure the card container is wrapped in a scale wrapper so that\n    // horizontal scrolling is isolated to the wrapper. In dynamic mode\n    // this wrapper is created by _ensureScaleWrapper(); replicate that\n    // behavior here so toolbar and tabs remain outside of the scrolling\n    // region but can still track horizontal movement.  If the wrapper\n    // already exists, this call is a no-op.\n    try { this._ensureScaleWrapper?.(); } catch {}\n    const outer = this.__scaleOuter || this.shadowRoot?.querySelector?.('.ddc-scale-outer') || this;\n    const inner = this.cardContainer || this.shadowRoot?.querySelector?.('#cardContainer');\n    if (!outer || !inner) return;\n\n    // Enable scrolling within the scale wrapper when the card\n    // content exceeds the viewport.  We set overflow to \"auto\" to\n    // produce a single scrollbar for both axes; however, we compute\n    // the wrapper\u2019s height such that vertical scrolling happens within\n    // the wrapper rather than the page.  This ensures the toolbar and\n    // tabs remain fixed while the user scrolls the canvas.\n    // In auto mode we want horizontal scrolling within the outer wrapper\n    // but vertical scrolling should happen at the page level (not within\n    // the wrapper).  Mimic dynamic mode by hiding vertical overflow and\n    // enabling horizontal overflow.  Setting overflow to hidden first\n    // establishes the default, then overflowX is overridden below.\n    outer.style.overflow = 'hidden';\n    outer.style.overflowX = 'auto';\n    outer.style.overflowY = 'hidden';\n    outer.style.width = '100%';\n\n    // If HA gives us a tiny height, expand to remaining viewport height (not to trigger loops).\n    let vb = outer.getBoundingClientRect();\n    let availW = Math.max(1, Math.round(vb.width  || 0));\n    let availH = Math.max(1, Math.round(vb.height || 0));\n    if (availH < 150) {\n      const top = Math.max(0, Math.round(vb.top || 0));\n      const viewportH = Math.max(1, window.innerHeight || document.documentElement.clientHeight || 0);\n      const remaining = Math.max(1, viewportH - top - 8);\n      if (Math.abs(remaining - availH) > 4) {\n        outer.style.height = remaining + 'px';\n        // re-measure\n        vb = outer.getBoundingClientRect();\n        availW = Math.max(1, Math.round(vb.width  || 0));\n        availH = Math.max(1, Math.round(vb.height || 0));\n      }\n    }\n\n    // Compute natural content extents just like dynamic\n    let maxX = 0, maxY = 0;\n    const cards = Array.from(inner.querySelectorAll('.card-wrapper'));\n    if (cards.length) {\n      const cr = inner.getBoundingClientRect();\n      for (const w of cards) {\n        const r = w.getBoundingClientRect();\n        const right  = r.left - cr.left + r.width;\n        const bottom = r.top  - cr.top  + r.height;\n        if (right  > maxX) maxX = right;\n        if (bottom > maxY) maxY = bottom;\n      }\n    } else {\n      maxX = inner.scrollWidth  || inner.offsetWidth  || availW;\n      maxY = inner.scrollHeight || inner.offsetHeight || availH;\n    }\n\n    const gs = Number(this.gridSize || 1) || 1;\n    const natW = Math.max(1, Math.round(Math.ceil(maxX/gs) * gs));\n    const natH = Math.max(1, Math.round(Math.ceil(maxY/gs) * gs));\n\n    // Strict rule:\n    // - If viewport > natural size, expand inner to viewport (fills space).\n    // - Else, inner stays at natural size (so user can scroll to reach overflow).\n    const targetW = (availW > natW) ? availW : natW;\n    const targetH = (availH > natH) ? availH : natH;\n\n    // Apply: NO SCALE. Keep 1:1 pixels so positions are exact.\n    inner.style.transform = 'none';\n    inner.style.transformOrigin = 'left top';\n    this.__pointerScaleX = 1;\n    this.__pointerScaleY = 1;\n    inner.style.width  = `${targetW}px`;\n    inner.style.height = `${targetH}px`;\n    // In strict auto mode, update the outer container height so that\n    // vertical scrolling is isolated to the wrapper rather than the page.\n    // We calculate the height available beneath the wrapper's top edge and\n    // clamp the wrapper height to that value.  This prevents the wrapper\n    // from growing taller than the viewport and avoids a secondary page\n    // scrollbar.  When the natural content height exceeds this height,\n    // overflow:auto on the wrapper will provide scrollbars.\n    if (outer) {\n      let topOffset = 0;\n      try {\n        const vb2 = outer.getBoundingClientRect();\n        topOffset = Math.max(0, Math.round(vb2.top || 0));\n      } catch {}\n      const vpH = Math.max(1, window.innerHeight || document.documentElement.clientHeight || 0);\n      // Reserve space for the bottom margin and ensure at least 1px height\n      const availViewH = Math.max(1, vpH - topOffset - 8);\n      // Set the wrapper height to the natural target height.  This allows\n      // the page to scroll vertically while the wrapper itself only\n      // scrolls horizontally.  Using the natural content height prevents\n      // clipping of cards and avoids nested vertical scrollbars.\n      outer.style.height = `${targetH}px`;\n    }\n    inner.style.position = inner.style.position || 'absolute';\n    inner.style.top = inner.style.top || '0';\n    inner.style.left = inner.style.left || '0';\n\n    // In auto mode, the tabs bar should span the viewport width (not the full card width).\n    const tb = this.tabsBar;\n    if (tb && this.tabsPosition !== 'left') {\n      tb.style.width = '100%';\n      tb.style.maxWidth = '100%';\n    }\n  } finally {\n    // Recompute the background (e.g. YouTube video) sizing based on the\n    // newly updated card dimensions.  Without this call the video\n    // background may retain the size from a previous layout state and\n    // appear cropped or misaligned in auto mode.\n    try { this._layoutYtBackground_?.(); } catch {}\n\n    // Ensure the grid overlay updates to reflect any changes in natural\n    // size or viewport fills.  Without this call the overlay may not\n    // redraw until the next interaction, leading to partially rendered\n    // selection squares after adding a card in auto mode.\n    try { this._requestGridButtonsUpdateSoon?.(); } catch {}\n    requestAnimationFrame(() => { this.__applyingAutoFill = false; });\n  }\n}\n\n\n\n\n\n\n  _resizeContainer() {\n    const c = this.cardContainer; if (!c) return;\n  \n    // In fixed modes, do NOT auto-grow/shrink \u2014 the box is hard-locked.\n    if (this._isContainerFixed()) return;\n  \n    // Dynamic mode: compute based on content\n    const cards = Array.from(c.querySelectorAll('.card-wrapper'));\n    let maxX = 0, maxY = 0;\n    cards.forEach((card) => {\n      const r  = card.getBoundingClientRect();\n      const cr = c.getBoundingClientRect();\n      const right  = r.left - cr.left + r.width;\n      const bottom = r.top  - cr.top  + r.height;\n      maxX = Math.max(maxX, right);\n      maxY = Math.max(maxY, bottom);\n    });\n    c.style.width  = `${Math.ceil(maxX/this.gridSize)*this.gridSize || 100}px`;\n    c.style.height = `${Math.ceil(maxY/this.gridSize)*this.gridSize || 100}px`;\n\n    // Whenever the container size changes in dynamic mode, update the tabs bar\n    // width so it remains aligned with the container. If the scale wrapper\n    // recalculates later the call in _applyAutoScale will also update this.\n    try { this._syncTabsWidth_?.(); } catch {}\n\n    // When the container size changes (e.g. after adding a card or resizing),\n    // the grid overlay may become stale.  Schedule an update so that the\n    // selectable overlay stretches to the new dimensions.  Without this call\n    // the overlay can remain clipped until the next edit toggle or page\n    // refresh.\n    try { this._requestGridButtonsUpdateSoon?.(); } catch {}\n  }\n  \n  /**\n  /**\n   * Restore original positions for non-selected cards, then push out of the way.\n   * This uses this.__collisionOriginals (captured on drag start) and avoids overlaps.\n   * @param {Array} proposedRects \u2013 array of { el, rawX, rawY, snapX, snapY, w, h }\n   * @param {number} dxLead \u2013 leader's delta X (to decide horizontal push direction)\n   * @param {number} dyLead \u2013 leader's delta Y (to decide vertical push direction)\n   * @param {boolean} liveSnap \u2013 true if we should snap positions visually\n   * @param {number} gridSize \u2013 current grid size\n   */\n  _pushCardsOutOfTheWay(proposedRects, dxLead, dyLead, liveSnap, gridSize) {\n    if (!this.__collisionOriginals) return;\n\n    const selectedSet = new Set(proposedRects.map(pr => pr.el));\n    const allCards = Array.from(this.cardContainer.querySelectorAll('.card-wrapper'))\n      .filter(w => !w.dataset.placeholder);\n\n    // Determine container bounds (for fixed modes)\n    const isFixed = this._isContainerFixed();\n    const { w: cw, h: ch } = this._getContainerSize();\n\n    // Restore every non-selected card to its original raw position\n    for (const w of allCards) {\n      if (selectedSet.has(w)) continue;\n      const orig = this.__collisionOriginals.get(w);\n      if (orig) {\n        w.setAttribute('data-x-raw', String(orig.x));\n        w.setAttribute('data-y-raw', String(orig.y));\n        const snX = liveSnap ? Math.round(orig.x / gridSize) * gridSize : orig.x;\n        const snY = liveSnap ? Math.round(orig.y / gridSize) * gridSize : orig.y;\n        this._setCardPosition(w, snX, snY);\n      }\n    }\n\n    // Prepare lists for collision checks\n    const selectedRects = proposedRects.map(pr => ({\n      x: pr.snapX,\n      y: pr.snapY,\n      w: pr.w,\n      h: pr.h,\n    }));\n\n    // Map to store the final pushed positions of non-selected cards\n    const finalPos = new Map();\n\n    // Store original widths and heights\n    const cardSizes = new Map();\n    for (const w of allCards) {\n      const width  = parseFloat(w.style.width)  || w.getBoundingClientRect().width;\n      const height = parseFloat(w.style.height) || w.getBoundingClientRect().height;\n      cardSizes.set(w, { w: width, h: height });\n    }\n\n    // Decide primary push direction based on leader movement\n    const signX = (dxLead > 0) ? 1 : (dxLead < 0 ? -1 : 0);\n    const signY = (dyLead > 0) ? 1 : (dyLead < 0 ? -1 : 0);\n    const horizontal = Math.abs(dxLead) >= Math.abs(dyLead);\n\n    // For each non-selected card, compute its new position\n    for (const other of allCards) {\n      if (selectedSet.has(other)) continue;\n      const orig = this.__collisionOriginals.get(other);\n      if (!orig) continue;\n\n      let { x: candidateX, y: candidateY } = orig;\n      const { w: ow, h: oh } = cardSizes.get(other);\n\n      // Determine if it overlaps with any selected rectangle\n      let overlaps = false;\n      for (const sr of selectedRects) {\n        if (this._rectsOverlap({ x: sr.x, y: sr.y, w: sr.w, h: sr.h },\n                              { x: candidateX, y: candidateY, w: ow, h: oh })) {\n          overlaps = true;\n          // Choose initial push direction\n          if (horizontal && signX !== 0) {\n            candidateX = signX > 0 ? sr.x + sr.w : sr.x - ow;\n          } else if (!horizontal && signY !== 0) {\n            candidateY = signY > 0 ? sr.y + sr.h : sr.y - oh;\n          } else {\n            // default horizontal push when no obvious direction\n            candidateX = sr.x + sr.w;\n          }\n          break;\n        }\n      }\n\n      // If overlapping, keep shifting until no collision\n      if (overlaps) {\n        let guard = 0;\n        const dx = horizontal ? (signX !== 0 ? signX * gridSize : gridSize) : 0;\n        const dy = !horizontal ? (signY !== 0 ? signY * gridSize : gridSize) : 0;\n        while (guard < 100) {\n          const candidateRect = { x: candidateX, y: candidateY, w: ow, h: oh };\n          let collision = false;\n\n          // Check against selected\n          for (const sr of selectedRects) {\n            if (this._rectsOverlap(candidateRect, sr)) {\n              collision = true;\n              break;\n            }\n          }\n          // Check against cards already assigned new positions\n          if (!collision) {\n            for (const [, fp] of finalPos) {\n              if (this._rectsOverlap(candidateRect, fp)) {\n                collision = true;\n                break;\n              }\n            }\n          }\n          // Check against container bounds (for fixed container)\n          if (!collision && isFixed) {\n            if (candidateX < 0 || candidateY < 0 ||\n                candidateX + ow > cw || candidateY + oh > ch) {\n              collision = true;\n            }\n          }\n\n          if (!collision) break;\n          // Move further along the chosen axis\n          candidateX += dx;\n          candidateY += dy;\n          guard++;\n        }\n\n        // Finally, clamp to container boundaries for fixed containers\n        if (isFixed) {\n          candidateX = Math.max(0, Math.min(candidateX, Math.max(0, cw - ow)));\n          candidateY = Math.max(0, Math.min(candidateY, Math.max(0, ch - oh)));\n        }\n      }\n\n      finalPos.set(other, { x: candidateX, y: candidateY, w: ow, h: oh });\n      selectedRects.push({ x: candidateX, y: candidateY, w: ow, h: oh });\n    }\n\n    // Apply final positions to non-selected cards\n    for (const [card, pos] of finalPos) {\n      card.setAttribute('data-x-raw', String(pos.x));\n      card.setAttribute('data-y-raw', String(pos.y));\n      const snX = liveSnap ? Math.round(pos.x / gridSize) * gridSize : pos.x;\n      const snY = liveSnap ? Math.round(pos.y / gridSize) * gridSize : pos.y;\n      this._setCardPosition(card, snX, snY);\n    }\n  }\n\n  _rectFor(el, x = null, y = null, wpx = null, hpx = null) {\n    const x0 = x ?? (parseFloat(el.getAttribute('data-x')) || 0);\n    const y0 = y ?? (parseFloat(el.getAttribute('data-y')) || 0);\n    const w  = wpx ?? (parseFloat(el.style.width)  || el.getBoundingClientRect().width  || 0);\n    const h  = hpx ?? (parseFloat(el.style.height) || el.getBoundingClientRect().height || 0);\n    return { x: x0, y: y0, w, h, el };\n  }\n  _rectsOverlap(a, b, eps = 0.5) {\n    return !(a.x + a.w <= b.x + eps || b.x + b.w <= a.x + eps ||\n             a.y + a.h <= b.y + eps || b.y + b.h <= a.y + eps);\n  }\n  _anyCollisionFor(proposedRects, ignoreSet) {\n    const others = Array.from(this.cardContainer.querySelectorAll('.card-wrapper'))\n      .filter(w => !ignoreSet.has(w) && !w.dataset.placeholder);\n    if (!others.length) return false;\n    const otherRects = others.map(w => this._rectFor(w));\n    for (const pr of proposedRects) for (const or of otherRects) {\n      if (this._rectsOverlap(pr, or)) return true;\n    }\n    return false;\n  }\n  _extractCardConfig(cardEl){\n    if (!cardEl) return {};\n    // attempt to read the card's own config\n    const cfg = cardEl._config || cardEl.config;\n    if (cfg && typeof cfg === 'object' && Object.keys(cfg).length) {\n      return cfg;\n    }\n    // fallback: if the wrapper cached a config, use it\n    try {\n      // walk up to the wrapper; .closest may not exist on text nodes\n      const wrap = cardEl.closest ? cardEl.closest('.card-wrapper') : null;\n      const raw  = wrap?.dataset?.cfg;\n      if (raw) {\n        const parsed = JSON.parse(raw);\n        if (parsed && typeof parsed === 'object') return parsed;\n      }\n    } catch {}\n    return {};\n  }\n\n  /* ------------------------------- Picker UI ------------------------------- */\n  async _openCardManager() { await this._openSmartPicker('add'); }\n\n  _catalog() {\n    return [\n      { id:'favorites', name:'Favorites', items:[] },\n      { id:'recent',    name:'Recent',    items:[] },\n      { id:'basics',    name:'Basics', items:[\n        {type:'entities',          name:'Entities',          icon:'mdi:format-list-bulleted'},\n        {type:'entity',            name:'Entity',            icon:'mdi:checkbox-blank-circle-outline'},\n        {type:'tile',              name:'Tile',              icon:'mdi:view-grid-outline'},\n        {type:'button',            name:'Button',            icon:'mdi:gesture-tap-button'},\n        {type:'glance',            name:'Glance',            icon:'mdi:eye-outline'},\n        {type:'markdown',          name:'Markdown',          icon:'mdi:language-markdown'},\n        // NEW: allow adding an empty custom card that the user can edit manually\n        {type:'custom_card',       name:'Custom Card',       icon:'mdi:puzzle-outline'},\n      ]},\n\n      { id:'sensors',   name:'Sensors', items:[\n        {type:'sensor',            name:'Sensor',            icon:'mdi:antenna'},\n        {type:'gauge',             name:'Gauge',             icon:'mdi:gauge'},\n        {type:'history-graph',     name:'History graph',     icon:'mdi:chart-line'},\n        {type:'statistics-graph',  name:'Statistics graph',  icon:'mdi:chart-bar'},\n      ]},\n      { id:'visual', name:'Visual', items:[\n        {type:'picture-entity',    name:'Picture entity',    icon:'mdi:image-outline'},\n        {type:'picture-glance',    name:'Picture glance',    icon:'mdi:image-multiple-outline'},\n        {type:'weather-forecast',  name:'Weather',           icon:'mdi:weather-partly-cloudy'},\n        {type:'map',               name:'Map',               icon:'mdi:map'},\n        {type:'iframe',            name:'iFrame',            icon:'mdi:application'},\n      ]},\n      { id:'controls', name:'Controls', items:[\n        {type:'light',             name:'Light',             icon:'mdi:lightbulb-outline'},\n        {type:'thermostat',        name:'Thermostat',        icon:'mdi:thermostat'},\n        {type:'media-control',     name:'Media control',     icon:'mdi:play-circle-outline'},\n        {type:'alarm-panel',       name:'Alarm panel',       icon:'mdi:shield-home-outline'},\n        {type:'area',              name:'Area',              icon:'mdi:map-marker'},\n      ]},\n    ];\n  }\n\n  /* ---- Find/create a config editor element for a given card type ---- */\n  async _getEditorElementForType(type, cfg) {\n    // Log the start of an editor lookup; this uses console.debug so it is visible\n    try { console.info('[ddc:editor] Requesting editor element', { type, cfg }); } catch {}\n    const helpers = (await this._helpersPromise) || await window.loadCardHelpers();\n  \n    // Warm the module before asking for the class only for built\u2011in HA cards.\n    // Skip preloading for custom cards (including the \"custom_card\" placeholder) since they have no core modules.\n    try {\n      if (typeof type === 'string' && type && !type.startsWith('custom:') && type !== 'custom_card') {\n        await this._ensureCardModuleLoaded(type, cfg);\n      }\n    } catch {}\n  \n    // Provide a bespoke visual editor for the built\u2011in Entity card.  The default\n    // `hui-entity-card-editor` often fails to load or throws errors in certain\n    // environments.  To avoid those problems, always supply our own simple\n    // entity editor when the type is exactly 'entity'.  This editor exposes the\n    // most common options (entity, name, icon, attribute, unit, state_color)\n    // through Home Assistant form elements.  See `_getEntityCardEditor` below.\n    if (typeof type === 'string' && type === 'entity') {\n      try {\n        return await this._getEntityCardEditor(cfg || {});\n      } catch (err) {\n        // fall through and attempt other editors if our custom one fails\n        console.warn('[ddc:editor] Custom entity editor failed', err);\n      }\n    }\n    // We will compute the card class on demand when needed. Avoid keeping a reference\n    // to a potentially undefined variable across different scopes.\n    const getCardClass = async () => {\n      try {\n        if (helpers.getCardElementClass) {\n          // Use the helper if available\n          return await helpers.getCardElementClass(type);\n        }\n        // Fallback: instantiate the card (using a stub) and return its constructor.\n        let baseCfg;\n        if (cfg && typeof cfg === 'object') {\n          // Use the provided config if available to obtain the constructor\n          baseCfg = { type, ...cfg };\n        } else {\n          let stubCfg;\n          try { stubCfg = await this._getStubConfigForType(type); } catch {}\n          baseCfg = stubCfg && typeof stubCfg === 'object' ? { ...stubCfg } : { type };\n        }\n        const inst = helpers.createCardElement(baseCfg);\n        return inst?.constructor || null;\n      } catch {\n        return null;\n      }\n    };\n\n  \n    // 1) Static class-provided editor (preferred)\n    try {\n      const CardClass = await getCardClass();\n      if (CardClass) {\n        // First, attempt to use the classic getConfigElement\n        if (typeof CardClass.getConfigElement === 'function') {\n          const el = await CardClass.getConfigElement();\n          if (el) {\n            try { console.info('[ddc:editor] Found static class editor', { type }); } catch {}\n            return el;\n          }\n        }\n        // Next, attempt to use getConfigForm (introduced in 2022.3) to build a ha-form based editor\n        if (typeof CardClass.getConfigForm === 'function') {\n          try {\n            const formInfo = await CardClass.getConfigForm();\n            if (formInfo && formInfo.schema) {\n              // Ensure ha-form is defined before creating it\n              try { await customElements.whenDefined('ha-form'); } catch {}\n              const formEl = document.createElement('ha-form');\n              formEl.hass = this.hass;\n              // Clone schema to avoid accidental mutations\n              formEl.schema = Array.isArray(formInfo.schema) ? formInfo.schema.map((s) => ({ ...s })) : formInfo.schema;\n              // Use provided computeLabel/computeHelper if available\n              if (typeof formInfo.computeLabel === 'function') {\n                formEl.computeLabel = formInfo.computeLabel.bind(CardClass);\n              }\n              if (typeof formInfo.computeHelper === 'function') {\n                formEl.computeHelper = formInfo.computeHelper.bind(CardClass);\n              }\n              // Provide initial data (cfg) to the form. Spread to avoid mutation\n              formEl.data = { ...cfg };\n              // When the form value changes, fire a value-changed event compatible with our onChange handler\n              formEl.addEventListener('value-changed', (ev) => {\n                // event.detail.value contains the new config object\n              });\n              try { console.info('[ddc:editor] Generated form editor via getConfigForm', { type }); } catch {}\n              return formEl;\n            }\n          } catch {}\n        }\n      }\n    } catch {}\n\n    // 2) Instance-provided editor. Only try this for custom cards. Most built\u2011in\n    // cards either expose a static editor or register a `hui-<type>-card-editor`\n    // tag; instantiating them with invalid or empty configs causes errors (e.g.\n    // \"Entities must be specified\"). For custom cards, we derive a stub config\n    // to satisfy basic validation and then ask the instance for its editor.\n    // For custom cards and the custom placeholder, attempt instance-level editors. The 'entity' card is no longer\n    // treated as a custom card here since HA may provide a built-in form via getConfigForm.\n    if (typeof type === 'string' && (type.startsWith('custom:') || type === 'custom_card')) {\n      try {\n        let stubCfg = undefined;\n        try { stubCfg = await this._getStubConfigForType(type); } catch {}\n        const baseCfg = stubCfg && typeof stubCfg === 'object' ? { ...stubCfg } : { type };\n        const inst = helpers.createCardElement(baseCfg);\n        inst.hass = this.hass;\n        if (typeof inst.getConfigElement === 'function') {\n          const el = await inst.getConfigElement();\n          if (el) {\n            try { console.info('[ddc:editor] Found instance-level editor', { type }); } catch {}\n            return el;\n          }\n        }\n      } catch {}\n    }\n\n\n  \n    // 3) Known/custom-tag editors (registry hint + common conventions) with retries\n    const base = String(type).replace(/^custom:/, '');\n    const reg = Array.isArray(window.customCards) ? window.customCards : [];\n    const entry = reg.find(c =>\n      c?.type === base || c?.type === type || c?.type === `custom:${base}`\n    );\n\n    \n  \n\n    const candidates = [];\n    if (entry?.editor) candidates.push(entry.editor);            // from registry, if present\n    candidates.push(`${base}-editor`, `${base}-config-editor`);  // common conventions\n\n    // New: add the \u201Chui-<type>-card-editor\u201D convention used by core HA cards\n    if (base && typeof base === 'string') {\n      candidates.push(`hui-${base}-card-editor`);\n    }\n\n  \n    for (const tag of candidates) {\n      if (!tag || typeof tag !== 'string') continue;\n      // Try multiple times: immediate and with increasing delays up to ~3s\n      for (const delay of [0, 100, 300, 700, 1500, 3000]) {\n        try {\n          if (!customElements.get(tag)) {\n            await Promise.race([\n              customElements.whenDefined(tag),\n              new Promise(r => setTimeout(r, delay))\n            ]);\n          }\n          if (customElements.get(tag)) {\n            try { console.info('[ddc:editor] Found editor by tag', { type, tag }); } catch {}\n            return document.createElement(tag);\n          }\n        } catch {}\n      }\n    }\n  \n    // No UI editor available\n    return null;\n  }\n\n  // This helps custom cards that register their editor tag after the element loads.\n  async _ensureCardModuleLoaded(type, cfg) {\n    try {\n      const helpers = (await this._helpersPromise) || await window.loadCardHelpers();\n      // Use stub configuration to warm the module by instantiating the card. This\n      // triggers the dynamic import of the card and its editor without causing\n      // validation errors (we'll ignore errors silently). After warmup, the\n      // module should have registered its static methods and editor tags.\n      // Use the provided cfg if present (for existing cards) to ensure valid keys,\n      // otherwise fall back to a stub. Spreading cfg over type ensures the card\n      // receives all its current properties, avoiding validation errors.\n      let baseCfg;\n      if (cfg && typeof cfg === 'object') {\n        baseCfg = { type, ...cfg };\n      } else {\n        let stubCfg = undefined;\n        try { stubCfg = await this._getStubConfigForType(type); } catch {}\n        baseCfg = stubCfg && typeof stubCfg === 'object' ? { ...stubCfg } : { type };\n      }\n      const el = helpers.createCardElement(baseCfg);\n      el.hass = this.hass;\n      const tmp = document.createElement('div');\n      tmp.style.cssText = 'position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;';\n      tmp.appendChild(el);\n      document.body.appendChild(tmp);\n      await new Promise(r => requestAnimationFrame(r));\n      tmp.remove();\n      try { console.info('[ddc:editor] Warmed card module', { type }); } catch {}\n    } catch {\n      // swallow errors \u2013 the module may still register\n    }\n  }\n  \n  _ensureOverlayZFix() {\n    if (document.querySelector('style[data-ddc-overlay-fix]')) return;\n    const s = document.createElement('style');\n    s.setAttribute('data-ddc-overlay-fix', '');\n    s.textContent = `\n      /* Make common HA overlays float above our modal */\n      vaadin-combo-box-overlay,\n      vaadin-overlay-backdrop,\n      mwc-menu-surface,\n      .mdc-menu-surface--open {\n        z-index: 1000000 !important;\n      }\n    `;\n    document.head.appendChild(s);\n  }\n  \n\n  _customCardsFromRegistry() {\n    const reg = Array.isArray(window.customCards) ? window.customCards : [];\n    return reg\n      .map((cc) => ({\n        type: cc?.type?.startsWith('custom:') ? cc.type : `custom:${cc?.type}`,\n        name: cc?.name || cc?.type || 'Custom card',\n        icon: 'mdi:puzzle-outline',\n        description: cc?.description || '',\n        editorTag: cc?.editor || null,  // <- keep if provided\n      }))\n      .filter((it) => typeof it.type === 'string' && it.type.startsWith('custom:'));\n  }\n\n  _schemaForType(type) {\n    const S = (o) => o; const any = [];\n    return ({\n      'entities': S({ fields:[ {key:'entities', type:'entities', multi:true, domains:any, label:'Entities'} ]}),\n      'entity':   S({ fields:[ {key:'entity', type:'entity', multi:false, domains:any, label:'Entity'} ]}),\n      'sensor':   S({ fields:[ {key:'entity', type:'entity', multi:false, domains:['sensor'], label:'Sensor'}, {key:'name', type:'text', label:'Name (optional)'} ]}),\n      'gauge':    S({ fields:[ {key:'entity', type:'entity', multi:false, domains:['sensor','number','input_number'], label:'Numeric entity'}, {key:'min', type:'number', label:'Min', step:'any'}, {key:'max', type:'number', label:'Max', step:'any'} ]}),\n      'history-graph': S({ fields:[ {key:'entities', type:'entities', multi:true, domains:any, label:'Entities (multiselect)'}, {key:'hours_to_show', type:'number', label:'Hours to show', default:24} ]}),\n      'statistics-graph': S({ fields:[ {key:'entities', type:'entities', multi:true, domains:['sensor','number','input_number'], label:'Entities (multiselect)'}, {key:'chart_type', type:'select', options:['line','bar'], label:'Chart type', default:'line'}, {key:'statistic', type:'select', options:['mean','min','max','sum'], label:'Statistic', default:'mean'} ]}),\n      'glance':   S({ fields:[ {key:'entities', type:'entities', multi:true, domains:any, label:'Entities (multiselect)'} ]}),\n      'picture-glance': S({ fields:[ {key:'entities', type:'entities', multi:true, domains:any, label:'Entities (multiselect)'}, {key:'image', type:'text', label:'Image URL (optional)'} ]}),\n      'picture-entity': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:any, label:'Entity'}, {key:'image', type:'text', label:'Image URL (optional)'} ]}),\n      'weather-forecast': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:['weather'], label:'Weather entity'} ]}),\n      'map': S({ fields:[ {key:'entities', type:'entities', multi:true, domains:['device_tracker','person'], label:'Trackers / people (multiselect)'}, {key:'default_zoom', type:'number', label:'Default zoom', default:14} ]}),\n      'media-control': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:['media_player'], label:'Media player'} ]}),\n      'light': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:['light'], label:'Light'} ]}),\n      'thermostat': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:['climate'], label:'Climate'} ]}),\n      'alarm-panel': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:['alarm_control_panel'], label:'Alarm'} ]}),\n      'markdown': S({ fields:[ {key:'content', type:'textarea', label:'Markdown'} ]}),\n      'tile': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:any, label:'Entity'} ]}),\n      'button': S({ fields:[ {key:'entity', type:'entity', multi:false, domains:any, label:'Entity (optional)'} ]}),\n      'iframe': S({ fields:[ {key:'url', type:'text', label:'URL'} ]}),\n      'area': S({ fields:[ {key:'area', type:'text', label:'Area ID'} ]}),\n    })[type] || { fields: [] };\n  }\n\n  /**\n   * Build a simple visual editor for the built\u2011in Entity card.  The stock\n   * `hui-entity-card-editor` is prone to errors when loaded outside of the\n   * Lovelace editor, so we provide a lightweight form here instead.  The\n   * returned element implements the `setConfig` API and emits a\n   * `config-changed` event whenever the configuration is updated.  Only\n   * common options are exposed; additional options can still be added in the\n   * YAML editor.\n   *\n   * @param {Object} cfg The current card configuration.\n   * @returns {Promise<HTMLElement>}\n   */\n  async _getEntityCardEditor(cfg = {}) {\n    // Create a wrapper element for the editor UI.\n    const wrapper = document.createElement('div');\n    // Style the wrapper to mimic the look of other editors.\n    wrapper.style.display = 'flex';\n    wrapper.style.flexDirection = 'column';\n    wrapper.style.gap = '12px';\n    wrapper.style.padding = '8px 0';\n    // Allow dropdown menus (e.g. ha-select) to overflow this container\n    // without being clipped.  Without this, the attribute dropdown may be\n    // hidden behind the card content.\n    wrapper.style.overflow = 'visible';\n\n    // Local copy of the config that we will mutate.\n    wrapper._cfg = { type: 'entity', ...(cfg || {}) };\n\n    // Helper to dispatch a config-changed event whenever a value changes.\n    const fireChange = () => {\n      // Always build a plain object for the configuration.  Avoid accidental\n      // retention of prototype strings or arrays by using object literal syntax.\n      const clean = { type: 'entity' };\n      // Copy defined keys only.  Include the optional theme in the clean config\n      // so that the YAML shows the selected theme.\n      ['entity', 'name', 'icon', 'attribute', 'unit', 'state_color', 'theme'].forEach((k) => {\n        const v = wrapper._cfg[k];\n        if (v !== undefined && v !== '' && v !== null) {\n          clean[k] = v;\n        }\n      });\n      wrapper.dispatchEvent(new CustomEvent('config-changed', { detail: { config: clean } }));\n    };\n\n    // Build the entity picker row\n    const entRow = document.createElement('div');\n    entRow.style.display = 'flex';\n    entRow.style.flexDirection = 'column';\n    entRow.style.gap = '4px';\n    const entLabel = document.createElement('span');\n    entLabel.textContent = 'Entity';\n    entLabel.style.fontSize = '.8rem';\n    entLabel.style.opacity = '0.8';\n    // Always use the ha-entity-picker so users get a searchable dropdown once the element is defined\n    let entInput = document.createElement('ha-entity-picker');\n    // Provide a label consistent with HA editors\n    entInput.setAttribute('label', 'Select entity');\n    // Listen for changes from the picker.  When the user selects an entity,\n    // update our internal config and fire the change event.\n    entInput.addEventListener('value-changed', (ev) => {\n      // Prevent the event from bubbling up into parent editors which may\n      // incorrectly interpret it as a configuration object\n      ev.stopPropagation();\n      // Extract the selected entity.  Some implementations emit detail.value,\n      // while others set ev.detail directly or expose the value on the target.\n      const newVal = (ev.detail && (ev.detail.value ?? ev.detail)) ?? ev.target?.value;\n      wrapper._cfg.entity = newVal || '';\n      // Rebuild the attribute list for the new entity\n      try { updateAttributeOptions(); } catch {}\n      fireChange();\n    });\n    entRow.appendChild(entLabel);\n    entRow.appendChild(entInput);\n    wrapper.appendChild(entRow);\n\n    // Placeholder for an attribute updater.  This function will be assigned\n    // once the attribute field is created below.  Defining it here ensures\n    // that it is in scope for the entity change handler above.\n    let updateAttributeOptions = () => {};\n\n    // Prepare a grid container for the remaining fields.\n    const grid = document.createElement('div');\n    grid.style.display = 'grid';\n    grid.style.gridTemplateColumns = '1fr 1fr';\n    grid.style.columnGap = '12px';\n    grid.style.rowGap = '12px';\n\n    // Helper to create a field wrapper and append to grid\n    const makeField = (labelText, inputEl) => {\n      const r = document.createElement('div');\n      r.style.display = 'flex';\n      r.style.flexDirection = 'column';\n      r.style.gap = '4px';\n      const lab = document.createElement('span');\n      lab.textContent = labelText;\n      lab.style.fontSize = '.8rem';\n      lab.style.opacity = '0.8';\n      r.appendChild(lab);\n      r.appendChild(inputEl);\n      grid.appendChild(r);\n    };\n\n    // Name field\n    let nameInput;\n    if (customElements.get('ha-textfield')) {\n      nameInput = document.createElement('ha-textfield');\n      nameInput.setAttribute('label', 'Name');\n      nameInput.addEventListener('input', () => {\n        wrapper._cfg.name = nameInput.value || undefined;\n        fireChange();\n      });\n    } else {\n      nameInput = document.createElement('input');\n      nameInput.type = 'text';\n      nameInput.placeholder = 'Name';\n      nameInput.addEventListener('input', () => {\n        wrapper._cfg.name = nameInput.value || undefined;\n        fireChange();\n      });\n      Object.assign(nameInput.style, {\n        padding: '8px 10px',\n        borderRadius: '8px',\n        background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n        border: '1px solid var(--divider-color)',\n        color: 'var(--primary-text-color, inherit)',\n        width: '100%',\n        boxSizing: 'border-box'\n      });\n    }\n    makeField('Name', nameInput);\n\n    // Icon field \u2013 provide a searchable icon picker if available.  Fallback to\n    // ha-textfield or native input when the picker is unavailable.\n    let iconInput;\n    if (customElements.get('ha-icon-picker')) {\n      iconInput = document.createElement('ha-icon-picker');\n      iconInput.setAttribute('label', 'Icon');\n      // When the user selects an icon from the picker, update config\n      iconInput.addEventListener('value-changed', (ev) => {\n        ev.stopPropagation();\n        wrapper._cfg.icon = ev.detail?.value || undefined;\n        fireChange();\n      });\n      // Ensure the icon picker overlay appears above surrounding content\n      Object.assign(iconInput.style, { position: 'relative', zIndex: '1000' });\n    } else if (customElements.get('ha-textfield')) {\n      iconInput = document.createElement('ha-textfield');\n      iconInput.setAttribute('label', 'Icon');\n      iconInput.addEventListener('input', () => {\n        wrapper._cfg.icon = iconInput.value || undefined;\n        fireChange();\n      });\n    } else {\n      iconInput = document.createElement('input');\n      iconInput.type = 'text';\n      iconInput.placeholder = 'mdi:icon';\n      iconInput.addEventListener('input', () => {\n        wrapper._cfg.icon = iconInput.value || undefined;\n        fireChange();\n      });\n      Object.assign(iconInput.style, {\n        padding: '8px 10px',\n        borderRadius: '8px',\n        background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n        border: '1px solid var(--divider-color)',\n        color: 'var(--primary-text-color, inherit)',\n        width: '100%',\n        boxSizing: 'border-box'\n      });\n    }\n    makeField('Icon', iconInput);\n\n    // Attribute field \u2013 display a dropdown of attributes for the selected entity.\n    let attrInput;\n    // Helper to populate attributes based on the current entity selection\n    updateAttributeOptions = () => {\n      // Determine available attribute names for the selected entity\n      let attrs = [];\n      const eid = wrapper._cfg?.entity;\n      const h = wrapper._hass;\n      if (eid && h && h.states && h.states[eid] && h.states[eid].attributes) {\n        try {\n          attrs = Object.keys(h.states[eid].attributes || {}).filter((k) => k && typeof k === 'string');\n          attrs.sort();\n        } catch {}\n      }\n      const prev = attrInput && typeof attrInput.value !== 'undefined' ? attrInput.value : undefined;\n      const tag = (attrInput?.tagName || '').toLowerCase();\n      // Lookup table for friendlier attribute names.  If an attribute key\n      // exists in this map, its value will be used for the option label; otherwise\n      // the key will be transformed by replacing underscores with spaces and\n      // capitalizing words.\n      const FRIENDLY_ATTR_NAMES = {\n        min_color_temp_kelvin: 'Minimum color temperature (Kelvin)',\n        max_color_temp_kelvin: 'Maximum color temperature (Kelvin)',\n        min_color_temp_mireds: 'Minimum color temperature (mireds)',\n        max_color_temp_mireds: 'Maximum color temperature (mireds)',\n        min_mireds: 'Minimum color temperature (mireds)',\n        max_mireds: 'Maximum color temperature (mireds)',\n        effect_list: 'Available effects',\n        color_mode: 'Color mode',\n        brightness: 'Brightness',\n        hs_color: 'Hs color',\n        rgb_color: 'Rgb color',\n        xy_color: 'Xy color',\n        entity_id: 'Entity ID',\n        friendly_name: 'Friendly name',\n        icon: 'Icon'\n      };\n      // Helper to compute a label from an attribute key\n      const makeLabel = (key) => {\n        if (FRIENDLY_ATTR_NAMES[key]) return FRIENDLY_ATTR_NAMES[key];\n        return key\n          .split('_')\n          .map((part) => {\n            if (!part) return part;\n            // Preserve units like kelvin/mireds in parentheses\n            if (part.toLowerCase() === 'kelvin') return 'Kelvin';\n            if (part.toLowerCase() === 'mireds') return 'mireds';\n            return part.charAt(0).toUpperCase() + part.slice(1);\n          })\n          .join(' ');\n      };\n      if (tag === 'ha-combo-box') {\n        // Build array of objects for the combo box\n        const items = attrs.map((name) => ({ value: name, label: makeLabel(name) }));\n        // Always include an empty item as first entry to allow clearing the selection\n        items.unshift({ value: '', label: '' });\n        attrInput.items = items;\n        // Restore previous selection if still valid\n        if (prev && attrs.includes(prev)) {\n          attrInput.value = prev;\n        } else {\n          attrInput.value = '';\n        }\n      } else if (tag === 'ha-select') {\n        // Clear current items\n        attrInput.innerHTML = '';\n        // Add an empty option\n        const emptyItem = document.createElement('mwc-list-item');\n        emptyItem.setAttribute('value', '');\n        emptyItem.textContent = '';\n        attrInput.appendChild(emptyItem);\n        for (const name of attrs) {\n          const item = document.createElement('mwc-list-item');\n          item.setAttribute('value', name);\n          item.textContent = makeLabel(name);\n          attrInput.appendChild(item);\n        }\n        // Restore previous selection if still valid\n        if (prev && attrs.includes(prev)) {\n          attrInput.value = prev;\n        } else {\n          attrInput.value = '';\n        }\n        attrInput.requestUpdate?.();\n      } else if (tag === 'select') {\n        attrInput.innerHTML = '';\n        const emptyOpt = document.createElement('option');\n        emptyOpt.value = '';\n        emptyOpt.textContent = '';\n        attrInput.appendChild(emptyOpt);\n        for (const name of attrs) {\n          const opt = document.createElement('option');\n          opt.value = name;\n          opt.textContent = makeLabel(name);\n          attrInput.appendChild(opt);\n        }\n        if (prev && attrs.includes(prev)) {\n          attrInput.value = prev;\n        }\n      }\n    };\n\n    // Create the attribute input. Prefer ha-combo-box (for searchable dropdown and correct overlay),\n    // fall back to ha-select, then native select if neither is available.  We\n    // mirror the semantics of the entity picker so the dropdown is rendered in a\n    // global overlay and not clipped by the card.\n    if (customElements.get('ha-combo-box')) {\n      attrInput = document.createElement('ha-combo-box');\n      attrInput.setAttribute('label', 'Attribute');\n      // Provide item-label and item-value paths for our objects\n      attrInput.setAttribute('item-label-path', 'label');\n      attrInput.setAttribute('item-value-path', 'value');\n      attrInput.setAttribute('allow-custom-value', 'false');\n      attrInput.addEventListener('value-changed', (ev) => {\n        // The value may be in ev.detail.value or directly in attrInput.value depending on the component implementation.\n        ev.stopPropagation();\n        const val = ev.detail?.value ?? attrInput.value;\n        wrapper._cfg.attribute = val || undefined;\n        fireChange();\n      });\n    } else if (customElements.get('ha-select')) {\n      attrInput = document.createElement('ha-select');\n      attrInput.setAttribute('label', 'Attribute');\n      attrInput.addEventListener('selected', (ev) => {\n        ev.stopPropagation();\n        // Update config with selected attribute or undefined if empty\n        wrapper._cfg.attribute = attrInput.value || undefined;\n        fireChange();\n      });\n      // Ensure the dropdown menu appears above surrounding card content\n      Object.assign(attrInput.style, { position: 'relative', zIndex: '1000' });\n    } else {\n      attrInput = document.createElement('select');\n      // Always include an empty option; options will be populated by updateAttributeOptions\n      const emptyOpt = document.createElement('option');\n      emptyOpt.value = '';\n      emptyOpt.textContent = '';\n      attrInput.appendChild(emptyOpt);\n      attrInput.addEventListener('change', (ev) => {\n        ev.stopPropagation();\n        wrapper._cfg.attribute = attrInput.value || undefined;\n        fireChange();\n      });\n      // Apply HA-like styling to the native select fallback\n      Object.assign(attrInput.style, {\n        padding: '8px 10px',\n        borderRadius: '8px',\n        background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n        border: '1px solid var(--divider-color)',\n        color: 'var(--primary-text-color, inherit)',\n        width: '100%',\n        boxSizing: 'border-box'\n      });\n      // Ensure the dropdown menu appears above surrounding card content\n      Object.assign(attrInput.style, { position: 'relative', zIndex: '1000' });\n    }\n    // Populate attributes once element is ready (initially empty).  We'll call\n    // updateAttributeOptions whenever the entity or hass changes.\n    updateAttributeOptions();\n    makeField('Attribute', attrInput);\n\n    // Unit field\n    let unitInput;\n    if (customElements.get('ha-textfield')) {\n      unitInput = document.createElement('ha-textfield');\n      unitInput.setAttribute('label', 'Unit');\n      unitInput.addEventListener('input', () => {\n        wrapper._cfg.unit = unitInput.value || undefined;\n        fireChange();\n      });\n    } else {\n      unitInput = document.createElement('input');\n      unitInput.type = 'text';\n      unitInput.placeholder = 'Unit';\n      unitInput.addEventListener('input', () => {\n        wrapper._cfg.unit = unitInput.value || undefined;\n        fireChange();\n      });\n      Object.assign(unitInput.style, {\n        padding: '8px 10px',\n        borderRadius: '8px',\n        background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n        border: '1px solid var(--divider-color)',\n        color: 'var(--primary-text-color, inherit)',\n        width: '100%',\n        boxSizing: 'border-box'\n      });\n    }\n    makeField('Unit', unitInput);\n\n    // Theme (optional) field - allow specifying a theme name from a dropdown\n    let themeInput;\n    // Use ha-select if available; otherwise fall back to a native select element.  The\n    // ha-select component uses mwc-list-item children to represent options.  We\n    // populate the options later when hass is set.\n    if (customElements.get('ha-select')) {\n      themeInput = document.createElement('ha-select');\n      themeInput.setAttribute('label', 'Theme (optional)');\n      // When the user picks an item, update config\n      themeInput.addEventListener('selected', (ev) => {\n        // Prevent propagation to avoid other handlers treating the value as config\n        ev.stopPropagation();\n        wrapper._cfg.theme = themeInput.value || undefined;\n        fireChange();\n      });\n    } else {\n      themeInput = document.createElement('select');\n      // Always include an empty option so users can clear their selection.  We\n      // recreate the option list when hass is set so we don't duplicate items.\n      const emptyOpt = document.createElement('option');\n      emptyOpt.value = '';\n      emptyOpt.textContent = '';\n      themeInput.appendChild(emptyOpt);\n      themeInput.addEventListener('change', (ev) => {\n        ev.stopPropagation();\n        wrapper._cfg.theme = themeInput.value || undefined;\n        fireChange();\n      });\n      // Apply HA-like styling to the native select fallback\n      Object.assign(themeInput.style, {\n        padding: '8px 10px',\n        borderRadius: '8px',\n        background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n        border: '1px solid var(--divider-color)',\n        color: 'var(--primary-text-color, inherit)',\n        width: '100%',\n        boxSizing: 'border-box'\n      });\n    }\n    makeField('Theme (optional)', themeInput);\n\n    // State color toggle field\n    let colorInput;\n    if (customElements.get('ha-switch')) {\n      colorInput = document.createElement('ha-switch');\n      colorInput.addEventListener('change', () => {\n        wrapper._cfg.state_color = !!colorInput.checked;\n        fireChange();\n      });\n    } else {\n      colorInput = document.createElement('input');\n      colorInput.type = 'checkbox';\n      colorInput.addEventListener('change', () => {\n        wrapper._cfg.state_color = !!colorInput.checked;\n        fireChange();\n      });\n    }\n    // Build a field wrapper for state color and append to grid\n    const colWrap = document.createElement('div');\n    colWrap.style.display = 'flex';\n    colWrap.style.alignItems = 'center';\n    colWrap.style.gap = '8px';\n    const colorLabel = document.createElement('span');\n    colorLabel.textContent = 'Show state color';\n    colorLabel.style.fontSize = '.8rem';\n    colorLabel.style.opacity = '0.8';\n    colWrap.appendChild(colorLabel);\n    colWrap.appendChild(colorInput);\n    grid.appendChild(colWrap);\n\n    // Append grid to wrapper\n    wrapper.appendChild(grid);\n\n    // Provide a setConfig method to populate fields from an existing config\n    wrapper.setConfig = (cfg2 = {}) => {\n      wrapper._cfg = { type: 'entity', ...(cfg2 || {}) };\n      const c = wrapper._cfg;\n      // Update each field if available\n      if (entInput) {\n        if ('value' in entInput) entInput.value = c.entity || '';\n        if (entInput.setAttribute) entInput.setAttribute('value', c.entity || '');\n      }\n      if (nameInput) {\n        nameInput.value = c.name || '';\n      }\n      if (iconInput) {\n        iconInput.value = c.icon || '';\n      }\n      if (attrInput) {\n        try { updateAttributeOptions(); } catch {}\n        // After repopulating options, restore the selected attribute if it exists\n        attrInput.value = c.attribute || '';\n      }\n      if (unitInput) {\n        unitInput.value = c.unit || '';\n      }\n      if (themeInput) {\n        themeInput.value = c.theme || '';\n      }\n      if (colorInput) {\n        if ('checked' in colorInput) colorInput.checked = !!c.state_color;\n      }\n    };\n\n    // Define reactive hass property so that nested pickers receive hass\n    Object.defineProperty(wrapper, 'hass', {\n      get() {\n        return this._hass;\n      },\n      set(v) {\n        this._hass = v;\n        // Pass hass to the entity picker so it can populate entities internally.  Assign\n        // the property even if the custom element isn't yet defined; once the\n        // element upgrades, it will use this value.  Additionally, if the\n        // element hasn't been registered yet, schedule a second assignment when\n        // it upgrades to ensure the suggestions list appears.\n        if (entInput) {\n          try { entInput.hass = v; } catch {}\n          // If ha-entity-picker is not yet defined, wait for it to be ready and then\n          // reassign the hass property.  This mirrors the logic used in the\n          // visibility editor to ensure the picker upgrades correctly.\n          if (!customElements.get('ha-entity-picker')) {\n            customElements.whenDefined('ha-entity-picker').then(() => {\n              try { entInput.hass = this._hass; entInput.requestUpdate?.(); } catch {}\n            }).catch(() => {});\n          }\n        }\n        // Pass hass to the icon picker so it can populate icons.  Assign even\n        // if the custom element isn't defined yet; we'll reassign after upgrade.\n        if (iconInput) {\n          try { iconInput.hass = v; } catch {}\n          if (!customElements.get('ha-icon-picker')) {\n            customElements.whenDefined('ha-icon-picker').then(() => {\n              try { iconInput.hass = this._hass; iconInput.requestUpdate?.(); } catch {}\n            }).catch(() => {});\n          }\n        }\n        // Populate the theme dropdown with available themes.  We support both\n        // ha-select (using mwc-list-item children) and a native select element.  For\n        // ha-select, use mwc-list-item; for native selects, use option elements.\n        if (themeInput) {\n          // Determine available theme names\n          let themeNames = [];\n          if (v && v.themes) {\n            if (v.themes.themes) {\n              themeNames = Object.keys(v.themes.themes);\n            } else if (typeof v.themes === 'object') {\n              themeNames = Object.keys(v.themes).filter((k) => k !== 'default_theme');\n            }\n          }\n          // Save previous value to restore after repopulating\n          const prevVal = themeInput.value;\n          const tag = (themeInput.tagName || '').toLowerCase();\n          if (tag === 'ha-select') {\n            // Clear existing items\n            themeInput.innerHTML = '';\n            // Insert an empty item to allow clearing the selection\n            const emptyItem = document.createElement('mwc-list-item');\n            emptyItem.setAttribute('value', '');\n            emptyItem.textContent = '';\n            themeInput.appendChild(emptyItem);\n            for (const name of themeNames) {\n              const item = document.createElement('mwc-list-item');\n              item.setAttribute('value', name);\n              item.textContent = name;\n              themeInput.appendChild(item);\n            }\n            // Restore previous selection if it still exists\n            if (prevVal && themeNames.includes(prevVal)) {\n              themeInput.value = prevVal;\n            } else if (!prevVal) {\n              themeInput.value = '';\n            }\n            // Request update in case the component uses LitElement\n            themeInput.requestUpdate?.();\n          } else if (tag === 'select') {\n            // Clear existing options\n            themeInput.innerHTML = '';\n            const emptyOpt = document.createElement('option');\n            emptyOpt.value = '';\n            emptyOpt.textContent = '';\n            themeInput.appendChild(emptyOpt);\n            for (const name of themeNames) {\n              const o = document.createElement('option');\n              o.value = name;\n              o.textContent = name;\n              themeInput.appendChild(o);\n            }\n            if (prevVal && Array.from(themeInput.options).some(o => o.value === prevVal)) {\n              themeInput.value = prevVal;\n            }\n          }\n        }\n\n        // Update attribute options when hass changes since the list of\n        // attributes depends on the selected entity and the hass states.  This\n        // ensures that if hass updates after the editor is created, the\n        // attribute dropdown stays in sync with the current entity.\n        try { updateAttributeOptions(); } catch {}\n      }\n    });\n\n    // Populate initial configuration\n    wrapper.setConfig(cfg || {});\n    // Return the wrapped editor\n    return wrapper;\n  }\n\n  _shapeBySchema(type, cfg = {}) {\n    const sc = this._schemaForType(type) || { fields: [] };\n    const out = { ...cfg, type };\n\n    for (const f of sc.fields) {\n      let v = out[f.key];\n\n      if (f.type === 'entities') {\n        const arr = Array.isArray(v) ? v : (v != null && v !== '' ? [v] : []);\n        const clean = arr.filter(Boolean);\n        if (clean.length) out[f.key] = clean;\n        else delete out[f.key];\n      }\n      else if (f.type === 'entity') {\n        if (Array.isArray(v)) v = v[0];\n        if (v == null || v === '') delete out[f.key];\n        else out[f.key] = String(v);\n      }\n      else if (f.type === 'number') {\n        if (v == null || v === '') { delete out[f.key]; }\n        else {\n          const n = Number(v);\n          if (Number.isFinite(n)) out[f.key] = n;\n          else delete out[f.key];\n        }\n      }\n      else if (f.type === 'select' || f.type === 'text' || f.type === 'textarea') {\n        if (v == null || v === '') delete out[f.key];\n        else out[f.key] = v;\n      }\n    }\n    return out;\n  }\n\n  _statesList(domains) {\n    const all = Object.keys(this.hass?.states || {});\n    if (!domains || !domains.length) return all;\n\n    if (!this.__domainIndex || this.__domainIndex._gen !== all.length) {\n      const map = {};\n      for (const id of all) {\n        const d = id.split('.')[0];\n        (map[d] ||= []).push(id);\n      }\n      this.__domainIndex = { _gen: all.length, map };\n    }\n    const out = [];\n    for (const d of domains) if (this.__domainIndex.map[d]) out.push(...this.__domainIndex.map[d]);\n    return out;\n  }\n  _isNumericEntity(eid) {\n    const st = this.hass?.states?.[eid]; if (!st) return false;\n    const v = Number(st.state); return Number.isFinite(v);\n  }\n\n  _getFaves(){ try { return new Set(JSON.parse(localStorage.getItem('ddc_faves')||'[]')); } catch { return new Set(); } }\n  _setFaves(set){ try { localStorage.setItem('ddc_faves', JSON.stringify(Array.from(set))); } catch {} }\n  _getRecent(){ try { return JSON.parse(localStorage.getItem('ddc_recent_types')||'[]'); } catch { return []; } }\n  _pushRecent(type){ try { const r = this._getRecent().filter(t=>t!==type); r.unshift(type); if (r.length>10) r.length=10; localStorage.setItem('ddc_recent_types', JSON.stringify(r)); } catch{} }\n\n  /* ----------------------------- YAML editor helpers ----------------------------- */\n  async _ensureCodeMirror() {\n    if (this.__cmReady) return;\n    if (!document.querySelector('link[data-cm-core]')) {\n      const l = document.createElement('link');\n      l.rel = 'stylesheet';\n      l.href = 'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css';\n      l.setAttribute('data-cm-core','');\n      document.head.appendChild(l);\n    }\n    await new Promise((resolve) => {\n      if (window.CodeMirror) return resolve();\n      const s = document.createElement('script');\n      s.src = 'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js';\n      s.onload = resolve;\n      document.head.appendChild(s);\n    });\n    await new Promise((resolve) => {\n      if (window.CodeMirror?.mimeModes?.yaml) return resolve();\n      const s = document.createElement('script');\n      s.src = 'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js';\n      s.onload = resolve;\n      document.head.appendChild(s);\n    });\n    this.__cmReady = true;\n  }\n\n  async _mountYamlEditor(hostEl, initialCfg, onValidChange, onInvalidChange) {\n    const dump = (o) => (window.jsyaml ? window.jsyaml.dump(o) : JSON.stringify(o, null, 2));\n    const parse = (t) => (window.jsyaml ? window.jsyaml.load(t) : JSON.parse(t));\n    hostEl.innerHTML = '';\n    const initialText = dump(initialCfg);\n\n    if (customElements.get('ha-code-editor')) {\n      const ed = document.createElement('ha-code-editor');\n      ed.mode = 'yaml';\n      ed.hass = this.hass;\n      ed.value = initialText;\n      ed.style.display = 'block';\n      ed.style.height = '260px';\n      hostEl.appendChild(ed);\n\n      let programmatic = false;\n      ed.addEventListener('value-changed', (e) => {\n        if (programmatic) return;\n        const txt = e.detail?.value ?? ed.value ?? '';\n        try { onValidChange(parse(txt)); }\n        catch (err) { onInvalidChange?.(err); }\n      });\n      return {\n        setValue: (cfg) => {\n          const txt = dump(cfg);\n          if ((ed.value ?? '') !== txt) { programmatic = true; ed.value = txt; programmatic = false; }\n        }\n      };\n    }\n\n    try {\n      await this._ensureCodeMirror();\n      const cm = window.CodeMirror(hostEl, {\n        value: initialText,\n        mode: 'yaml',\n        lineNumbers: true,\n        lineWrapping: true,\n        indentUnit: 2,\n        tabSize: 2\n      });\n      let programmatic = false;\n      cm.on('change', () => {\n        if (programmatic) return;\n        const text = cm.getValue();\n        try { onValidChange(parse(text)); }\n        catch (e) { onInvalidChange?.(e); }\n      });\n      return {\n        setValue: (cfg) => {\n          const txt = dump(cfg);\n          if (cm.getValue() !== txt) { programmatic = true; cm.setValue(txt); programmatic = false; }\n        }\n      };\n    } catch {\n      const ta = document.createElement('textarea');\n      ta.style.width = '100%';\n      ta.style.height = '260px';\n      ta.value = initialText;\n      ta.addEventListener('input', () => {\n        try { onValidChange(parse(ta.value)); }\n        catch (e) { onInvalidChange?.(e); }\n      });\n      hostEl.appendChild(ta);\n      return { setValue: (cfg) => { const txt = dump(cfg); if (ta.value !== txt) ta.value = txt; } };\n    }\n  }\n\n  /* ----------------------- Picker (fast, cached) ----------------------- */\n  \n    _createVirtualList({ container, items, rowHeight = 36, renderRow }) {\n    container.style.position = 'relative';\n    container.style.overflow = 'auto';\n    const spacer = document.createElement('div');\n    spacer.style.height = `${items.length * rowHeight}px`;\n    container.innerHTML = '';\n    container.appendChild(spacer);\n\n    const mount = new Map(); // index -> element\n    const render = () => {\n      const scrollTop = container.scrollTop;\n      const h = container.clientHeight;\n      const first = Math.max(0, Math.floor(scrollTop / rowHeight) - 6);\n      const last  = Math.min(items.length - 1, Math.ceil((scrollTop + h) / rowHeight) + 6);\n\n      // remove out-of-window rows\n      for (const [i, el] of mount) {\n        if (i < first || i > last) { el.remove(); mount.delete(i); }\n      }\n      // add visible rows\n      for (let i = first; i <= last; i++) {\n        if (mount.has(i)) continue;\n        const el = renderRow(items[i], i);\n        el.style.position = 'absolute';\n        el.style.left = '0';\n        el.style.right = '0';\n        el.style.top = `${i * rowHeight}px`;\n        mount.set(i, el);\n        container.appendChild(el);\n      }\n    };\n\n    container.addEventListener('scroll', render, { passive: true });\n    new ResizeObserver(render).observe(container);\n    render();\n\n    return {\n      refresh(newItems) {\n        if (newItems) {\n          items = newItems;\n          spacer.style.height = `${items.length * rowHeight}px`;\n          for (const [, el] of mount) el.remove();\n          mount.clear();\n        }\n        render();\n      }\n    };\n  }\n  \n  async _openSmartPicker(mode='add', initialCfg=null, onCommit=null) {\n\n    \n    const close = () => modal.remove();\n    const modal = document.createElement('div'); modal.className='modal';\n    modal.innerHTML = `\n      <div class=\"dialog\" role=\"dialog\" aria-modal=\"true\">\n        <div class=\"dlg-head\">\n          <h3>${mode==='edit'?'Edit card':'Add a card'}</h3>\n          <div style=\"display:flex;gap:10px;flex:1\">\n            <input id=\"search\" placeholder=\"Search cards (name or type)\u2026\" aria-label=\"search\" style=\"flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--divider-color);background:var(--primary-background-color);color:var(--primary-text-color)\">\n          </div>\n          <button class=\"btn secondary\" id=\"cancelBtn\"><ha-icon icon=\"mdi:close\"></ha-icon><span style=\"margin-left:6px\">Cancel</span></button>\n          <button class=\"btn\" id=\"addBtn\" disabled>${mode==='edit'\n            ? '<ha-icon icon=\"mdi:content-save\"></ha-icon><span style=\"margin-left:6px\">Update</span>'\n            : '<ha-icon icon=\"mdi:plus\"></ha-icon><span style=\"margin-left:6px\">Add</span>'}\n          </button>\n        </div>\n        <div id=\"layoutGrid\" class=\"layout\">\n          <div class=\"pane\" id=\"leftPane\"></div>\n          <div class=\"pane\" id=\"rightPane\">\n            <div class=\"rightGrid\">\n              <div class=\"sec\" id=\"quickFillSec\" style=\"grid-column:1;grid-row:1\">\n                <div class=\"hd\">Quick fill <span style=\"opacity:.7;font-size:.85rem\">card-aware</span></div>\n                <div class=\"bd\" id=\"quickFill\"></div>\n              </div>\n\n              <div class=\"sec\" style=\"grid-column:2;grid-row:1 / span 3;min-height:0;position:relative\">\n                <div class=\"hd\">Preview</div>\n                <div class=\"spin-center\" id=\"previewSpin\" hidden>\n                  <ha-circular-progress indeterminate></ha-circular-progress>\n                </div>\n                <div class=\"bd\" style=\"min-height:0\"><div id=\"cardHost\"></div></div>\n              </div>\n\n              <div class=\"sec\" id=\"optionsSec\" style=\"grid-column:1;grid-row:2;min-height:0;position:relative\">\n                <div class=\"hd\">\n                  <span>Card options (official editor)</span>\n                  <div id=\"optTabs\" class=\"tabs\">\n                    <button id=\"tabVisual\" class=\"tab active\" aria-selected=\"true\">Visual</button>\n                    <button id=\"tabYaml\" class=\"tab\">YAML</button>\n                    <!-- DDC: Visibility tab allows configuring when the card should be shown -->\n                    <button id=\"tabVis\" class=\"tab\">Visibility</button>\n                  </div>\n                </div>\n                <div class=\"spin-center\" id=\"editorSpin\" hidden>\n                  <ha-circular-progress indeterminate></ha-circular-progress>\n                </div>\n                <div class=\"bd\" style=\"min-height:0\">\n                  <div id=\"editorHost\"></div>\n                  <div id=\"err\" class=\"err\" hidden style=\"color:var(--error-color);font-size:.9rem\"></div>\n                </div>\n              </div>\n\n              <div class=\"sec\" id=\"yamlSec\" style=\"grid-column:1;grid-row:3;min-height:0\">\n                <div class=\"hd\">YAML editor</div>\n                <div class=\"bd\" style=\"min-height:0\">\n                  <div id=\"yamlHost\"></div>\n                  <div id=\"yamlErr\" class=\"err\" hidden style=\"color:var(--error-color);font-size:.9rem;margin-top:8px\"></div>\n                </div>\n              </div>\n\n              <!-- DDC: Visibility section shares the same grid row as YAML. It is hidden by default and shown when the Visibility tab is selected. -->\n              <div class=\"sec\" id=\"visSec\" style=\"grid-column:1;grid-row:3;min-height:0;display:none\">\n                <div class=\"hd\">Visibility</div>\n                <div class=\"bd\" style=\"min-height:0\">\n                  <div id=\"visHost\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"dlg-foot\">\n          <span style=\"flex:1;opacity:.75;font-size:.85rem\">Tip: use <ha-icon icon=\"mdi:star-outline\"></ha-icon> to favorite cards you use often</span>\n          <button class=\"btn secondary\" id=\"footCancel\"><ha-icon icon=\"mdi:close\"></ha-icon><span style=\"margin-left:6px\">Cancel</span></button>\n          <button class=\"btn\" id=\"footAdd\" disabled>${mode==='edit'\n            ? '<ha-icon icon=\"mdi:content-save\"></ha-icon><span style=\"margin-left:6px\">Update</span>'\n            : '<ha-icon icon=\"mdi:plus\"></ha-icon><span style=\"margin-left:6px\">Add</span>'}\n          </button>\n        </div>\n      </div>`;\n    this.shadowRoot.appendChild(modal);\n\n    const left = modal.querySelector('#leftPane');\n    const addTop = modal.querySelector('#addBtn');\n    const addBottom = modal.querySelector('#footAdd');\n    const cancelTop = modal.querySelector('#cancelBtn');\n    const cancelBot = modal.querySelector('#footCancel');\n    const search = modal.querySelector('#search');\n    const cardHost = modal.querySelector('#cardHost');\n    const editorHost = modal.querySelector('#editorHost');\n    const editorSpin = modal.querySelector('#editorSpin');\n    const quickFill = modal.querySelector('#quickFill');\n    const yamlHost = modal.querySelector('#yamlHost');\n    const yamlErr = modal.querySelector('#yamlErr');\n    const yamlSec = modal.querySelector('#yamlSec');\n    const tabVisual = modal.querySelector('#tabVisual');\n    const tabYaml = modal.querySelector('#tabYaml');\n    // Visibility tab and section references\n    const tabVis = modal.querySelector('#tabVis');\n    const visSec = modal.querySelector('#visSec');\n    const visHost = modal.querySelector('#visHost');\n    const err = modal.querySelector('#err');\n    const previewSpin = modal.querySelector('#previewSpin');\n    const enableCommit = (on) => { addTop.disabled = addBottom.disabled = !on; };\n    const setError = (msg) => { if (!msg){ err.hidden=true; err.textContent=''; } else { err.hidden=false; err.textContent=msg; } };\n\n    const faves = this._getFaves();\n    const recent = this._getRecent();\n    const catalog = this._catalog();\n    const favSection = catalog.find(c=>c.id==='favorites');\n    const recSection = catalog.find(c=>c.id==='recent');\n    const allItems = catalog.flatMap(c => c.items || []);\n    favSection.items = allItems.filter(i => faves.has(i.type));\n    recSection.items = recent.map(t => allItems.find(i => i.type===t)).filter(Boolean);\n\n    const customItems = this._customCardsFromRegistry();\n    if (customItems.length) {\n      catalog.push({\n        id: 'custom',\n        name: 'Custom (installed)',\n        items: customItems,\n      });\n    }\n\n    // ---------------------------------------------------------------------------\n    // UI tweaks: hide quick fill area, add selected-card headline and fave toggle\n    // Hide the quick fill section entirely so the editor can use the full height.\n    const quickFillSecDiv = modal.querySelector('#quickFillSec');\n    if (quickFillSecDiv) quickFillSecDiv.style.display = 'none';\n    // Do not reposition the options and YAML sections. The original\n    // grid-template-rows assigns a flexible row (1fr) to the YAML section,\n    // allowing it to scroll instead of forcing the entire editor to grow.\n\n    // Set up a header in the editor for showing the selected card and a star to\n    // favorite the current card.  We create the elements once and update them\n    // whenever a different card is selected.  Favorites are persisted using\n    // existing _getFaves/_setFaves helpers.\n    const optionsHd = modal.querySelector('#optionsSec .hd');\n    // Local references for the header label and star button\n    let selInfo;\n    let favBtn;\n    // Function to update the star icon state based on whether the current card\n    // type is favorited.  Called whenever the favorites set or currentType changes.\n    const updateFavStar = () => {\n      if (!favBtn) return;\n      const on = currentType && faves.has(currentType);\n      const icon = favBtn.querySelector('ha-icon');\n      if (icon) icon.setAttribute('icon', on ? 'mdi:star' : 'mdi:star-outline');\n    };\n    // Function to update the headline text and star icon.  Called from selectType.\n    const updateHeader = (type) => {\n      if (selInfo) {\n        const item = allItems.find(i => i.type === type);\n        const nm = item ? item.name : (type || '');\n        selInfo.textContent = nm;\n      }\n      updateFavStar();\n    };\n    // Only initialize the header once.\n    if (optionsHd && !optionsHd.querySelector('.sel-info')) {\n      // Hide the existing static label if present\n      const titleSpan = optionsHd.querySelector('span');\n      if (titleSpan) {\n        titleSpan.style.display = 'none';\n      }\n      // Create the dynamic selected-card label\n      selInfo = document.createElement('span');\n      selInfo.className = 'sel-info';\n      // Flex so it grows to fill space before the star button\n      selInfo.style.flex = '1';\n      selInfo.style.fontWeight = 'bold';\n      selInfo.style.paddingRight = '8px';\n      optionsHd.insertBefore(selInfo, optionsHd.firstChild);\n      // Create the favorite star button\n      favBtn = document.createElement('button');\n      favBtn.className = 'icon-btn';\n      favBtn.setAttribute('title','Favorite');\n      Object.assign(favBtn.style, {\n        display: 'inline-flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        width: '28px',\n        height: '28px',\n        borderRadius: '6px',\n        border: '1px solid var(--divider-color)',\n        background: 'var(--primary-background-color)',\n        padding: '0',\n        marginLeft: '4px',\n        cursor: 'pointer'\n      });\n      favBtn.innerHTML = '<ha-icon icon=\"mdi:star-outline\"></ha-icon>';\n      optionsHd.appendChild(favBtn);\n      // Clicking the star toggles favorite status for the current card.\n      favBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        if (!currentType) return;\n        if (faves.has(currentType)) {\n          faves.delete(currentType);\n        } else {\n          faves.add(currentType);\n        }\n        this._setFaves(faves);\n        updateFavStar();\n        // Re-render the list so the favorites section reflects the new state\n        renderLeft();\n      });\n    }\n    // End of UI tweaks\n\n    let __activeTab = 'visual';\n\n    const showTab = (name) => {\n      // Determine which of the three tabs is active\n      const wantYaml = name === 'yaml';\n      const wantVis  = name === 'vis';\n      const wantVisual = !wantYaml && !wantVis;\n\n      // Update tab button styling and ARIA attributes\n      tabVisual.classList.toggle('active', wantVisual);\n      tabVisual.setAttribute('aria-selected', String(wantVisual));\n      tabYaml.classList.toggle('active', wantYaml);\n      tabYaml.setAttribute('aria-selected', String(wantYaml));\n      if (tabVis) {\n        tabVis.classList.toggle('active', wantVis);\n        tabVis.setAttribute('aria-selected', String(wantVis));\n      }\n\n      // Show/hide the appropriate editor sections. Visual uses editorHost;\n      // YAML uses yamlSec; Visibility uses visSec. Only one is visible at a time.\n      editorHost.parentElement.style.display = wantVisual ? '' : 'none';\n      yamlSec.style.display   = wantYaml  ? '' : 'none';\n      if (visSec) visSec.style.display = wantVis ? '' : 'none';\n\n      if (wantYaml) {\n        yamlSec.scrollIntoView({ behavior:'smooth', block:'start' });\n      } else if (wantVis && visSec) {\n        visSec.scrollIntoView({ behavior:'smooth', block:'start' });\n      }\n\n      __activeTab = wantYaml ? 'yaml' : (wantVis ? 'vis' : 'visual');\n    };\n    \n    tabVisual.addEventListener('click', async () => {\n      showTab('visual');\n      // Mount a new editor the first time; reuse it afterward by updating config.\n      // Because visualEditor is reset in selectType(), this will always mount a fresh editor for a new card type.\n      if (!visualEditor) {\n        await mountVisualEditor(currentConfig);\n      } else {\n        try { visualEditor.setConfig?.(currentConfig); } catch {}\n      }\n    });\n\n    tabYaml.addEventListener('click', () => showTab('yaml'));\n\n    // When the Visibility tab is clicked, switch to the visibility editor.\n    if (tabVis) {\n      tabVis.addEventListener('click', () => {\n        showTab('vis');\n        // Build or refresh the visibility UI whenever the tab is opened.\n        try { buildVisUI(currentConfig); } catch {}\n      });\n    }\n    \n    // default: Visual\n    showTab('visual');\n\n    const filteredCatalog = () => {\n      const q = search.value.trim().toLowerCase();\n      return catalog\n        .map(section => ({\n          ...section,\n          items: (section.items || []).filter(\n            it => !q || it.name.toLowerCase().includes(q) || it.type.toLowerCase().includes(q)\n          )\n        }))\n        .filter(sec => (sec.items && sec.items.length) || sec.id === 'favorites' || sec.id === 'recent');\n    };\n\n    const renderLeft = () => {\n      const view = filteredCatalog();\n      left.innerHTML = '';\n      view.forEach(cat => {\n        const div = document.createElement('div');\n        div.style.padding = '12px';\n        div.style.borderBottom = '1px solid var(--divider-color)';\n        const h = document.createElement('h4'); h.textContent = cat.name; h.style.margin='0 0 10px 0'; h.style.fontSize='.92rem'; h.style.opacity='.85';\n        div.appendChild(h);\n\n        if (!cat.items.length && (cat.id==='favorites' || cat.id==='recent')) {\n          const p = document.createElement('div'); p.style.opacity='.6'; p.style.fontSize='.85rem'; p.textContent = cat.id==='favorites' ? 'No favorites yet.' : 'No recent items yet.'; div.appendChild(p);\n        } else {\n          cat.items.forEach(item => {\n            const b = document.createElement('button');\n            b.innerHTML = `<span style=\"display:inline-flex;align-items:center;gap:8px\">\n              <ha-icon icon=\"${item.icon}\"></ha-icon><span>${item.name}</span>\n            </span>`;\n            Object.assign(b.style,{display:'block',width:'100%',textAlign:'left',border:'none',background:'transparent',padding:'8px',borderRadius:'10px',cursor:'pointer'});\n            b.addEventListener('click', async () => { highlight(b); await selectType(item.type); });\n            div.appendChild(b);\n          });\n        }\n        left.appendChild(div);\n      });\n    };\n\n    const highlight = (btn) => {\n      // Reset all buttons to default appearance\n      left.querySelectorAll('button').forEach(b => {\n        b.classList.remove('active');\n        b.style.background = 'transparent';\n        b.style.color = '';\n      });\n      // Highlight the selected button so it is obvious which one is active.\n      if (btn) {\n        btn.classList.add('active');\n        // Soft highlight background and primary color text for contrast\n        btn.style.background = 'rgba(3,169,244,.12)';\n        btn.style.color = 'var(--primary-color)';\n      }\n    };\n\n    let currentConfig = null;\n    let currentType = null;\n    let yamlEditorApi = null;\n    let visualEditor = null;\n    let editor = null;\n    let pickSeq = 0; // stale-select guard\n    let __previewTimer = null;\n    let __lastPreviewCfgJSON = '';\n\n    const buildQuickFill = (type, cfg) => {\n      const sc = this._schemaForType(type);\n      quickFill.innerHTML = '';\n      if (!sc.fields.length) {\n        quickFill.innerHTML = `<div style=\"opacity:.7;font-size:.9rem\">No quick fill for this card \u2014 use the editors below.</div>`;\n        return;\n      }\n      const all = Object.keys(this.hass?.states || {});\n      const fieldWrap = document.createElement('div');\n\n      const addEntityItem = (eid, arr, container, keyForMulti) => {\n        const div = document.createElement('div');\n        Object.assign(div.style,{padding:'8px 10px',border:'1px solid var(--divider-color)',borderRadius:'10px',cursor:'pointer',userSelect:'none',display:'flex',alignItems:'center',gap:'8px'});\n        div.innerHTML = `<ha-icon icon=\"mdi:checkbox-blank-outline\"></ha-icon><span>${eid}</span>`;\n        if (arr.includes(eid)) {\n          div.style.background='rgba(3,169,244,.12)'; div.style.borderColor='var(--primary-color)';\n          div.querySelector('ha-icon').setAttribute('icon','mdi:checkbox-marked');\n        }\n        div.addEventListener('click', async () => {\n          const idx = arr.indexOf(eid);\n          if (idx>=0) arr.splice(idx,1); else arr.push(eid);\n          const on = arr.includes(eid);\n          div.style.background = on ? 'rgba(3,169,244,.12)' : '';\n          div.style.borderColor = on ? 'var(--primary-color)' : 'var(--divider-color)';\n          div.querySelector('ha-icon').setAttribute('icon', on ? 'mdi:checkbox-marked' : 'mdi:checkbox-blank-outline');\n          currentConfig = this._shapeBySchema(type, {...currentConfig, [keyForMulti]: [...arr]});\n          mountPreview(currentConfig);\n          yamlEditorApi?.setValue(currentConfig);\n        });\n        container.appendChild(div);\n      };\n\n      sc.fields.forEach(f => {\n        const row = document.createElement('div'); Object.assign(row.style,{display:'flex',gap:'8px',alignItems:'center',marginBottom:'8px'});\n        const label = document.createElement('label'); label.textContent = f.label || f.key; label.style.minWidth='130px';\n\n        if (f.type === 'entities') {\n          const wrap = document.createElement('div'); wrap.style.flex='1';\n          const filter = document.createElement('input');\n          Object.assign(filter, { placeholder:'Filter entities\u2026' });\n          Object.assign(filter.style, {\n            width:'100%', padding:'8px 10px', borderRadius:'10px',\n            border:'1px solid var(--divider-color)',\n            background:'var(--card-background-color)', color:'var(--primary-text-color)'\n          });\n          const list = document.createElement('div');\n          Object.assign(list.style, {\n            maxHeight:'220px', overflow:'auto', marginTop:'8px',\n            border:'1px solid var(--divider-color)', borderRadius:'10px', padding:'6px'\n          });\n          const pool = (f.domains && f.domains.length) ? this._statesList(f.domains) : all;\n          const selected = Array.isArray(cfg[f.key]) ? [...cfg[f.key]] : (cfg[f.key] ? [cfg[f.key]] : []);\n\n          // virtualized row renderer\n          const renderRow = (eid) => {\n            const div = document.createElement('div');\n            Object.assign(div.style, {\n              padding:'6px 10px', margin:'4px 0',\n              border:'1px solid var(--divider-color)', borderRadius:'10px',\n              cursor:'pointer', display:'flex', alignItems:'center', gap:'8px', background:''\n            });\n            const icon = document.createElement('ha-icon');\n            icon.setAttribute('icon','mdi:checkbox-blank-outline');\n            icon.style.setProperty('--mdc-icon-size','18px');\n            const text = document.createElement('span');\n            text.textContent = eid;\n            text.style.whiteSpace = 'nowrap';\n            text.style.overflow = 'hidden';\n            text.style.textOverflow = 'ellipsis';\n            div.append(icon, text);\n\n            const paint = () => {\n              const on = selected.includes(eid);\n              div.style.background = on ? 'rgba(3,169,244,.12)' : '';\n              div.style.borderColor = on ? 'var(--primary-color)' : 'var(--divider-color)';\n              icon.setAttribute('icon', on ? 'mdi:checkbox-marked' : 'mdi:checkbox-blank-outline');\n            };\n            paint();\n\n            div.addEventListener('click', () => {\n              const idx = selected.indexOf(eid);\n              if (idx >= 0) selected.splice(idx, 1); else selected.push(eid);\n              currentConfig = this._shapeBySchema(type, {...currentConfig, [f.key]: [...selected]});\n              mountPreview(currentConfig);\n              yamlEditorApi?.setValue(currentConfig);\n              paint();\n            });\n\n            return div;\n          };\n\n          let filtered = pool;\n          this._createVirtualList({ container: list, items: filtered, rowHeight: 36, renderRow });\n\n          filter.addEventListener('input', () => {\n            const q = filter.value.trim().toLowerCase();\n            filtered = pool.filter(eid => !q || eid.toLowerCase().includes(q));\n            this._createVirtualList({ container: list, items: filtered, rowHeight: 36, renderRow });\n          });\n\n          wrap.append(filter, list);\n          row.append(label, wrap);\n          currentConfig = this._shapeBySchema(type, {...cfg, [f.key]: selected});\n        }\n\n        if (f.type === 'entity') {\n          const dsWrap = document.createElement('div'); dsWrap.style.flex='1'; dsWrap.style.position='relative';\n          const ds = document.createElement('input'); ds.setAttribute('list', 'ddc_entlist_'+f.key);\n          Object.assign(ds.style,{width:'100%',padding:'8px 10px 8px 36px',borderRadius:'10px',border:'1px solid var(--divider-color)'});\n          ds.placeholder = `Select ${f.label?.toLowerCase() || 'entity'}\u2026`;\n          const iconLead = document.createElement('ha-icon'); iconLead.setAttribute('icon','mdi:magnify');\n          Object.assign(iconLead.style,{position:'absolute',left:'10px',top:'8px',width:'18px',height:'18px','--mdc-icon-size':'18px',opacity:'.7'});\n          const dl = document.createElement('datalist'); dl.id = 'ddc_entlist_'+f.key;\n          const pool = (f.domains && f.domains.length) ? this._statesList(f.domains) : Object.keys(this.hass?.states || {});\n          dl.innerHTML = pool.map(e => `<option value=\"${e}\">`).join('');\n          ds.value = Array.isArray(cfg[f.key]) ? (cfg[f.key][0] || '') : (cfg[f.key] || '');\n          ds.addEventListener('change', async () => {\n            currentConfig = this._shapeBySchema(type, {...currentConfig, [f.key]: ds.value || undefined});\n            mountPreview(currentConfig);\n            yamlEditorApi?.setValue(currentConfig);\n          });\n          dsWrap.append(iconLead, ds, dl);\n          row.append(label, dsWrap);\n        }\n\n        if (f.type === 'number') {\n          const inpWrap = document.createElement('div'); inpWrap.style.flex='1'; inpWrap.style.position='relative';\n          const inp = document.createElement('input'); inp.type='number'; if (f.step) inp.step=f.step;\n          Object.assign(inp.style,{width:'100%',padding:'8px 10px 8px 36px',borderRadius:'10px',border:'1px solid var(--divider-color)'});\n          const numIcon = document.createElement('ha-icon'); numIcon.setAttribute('icon','mdi:counter'); Object.assign(numIcon.style,{position:'absolute',left:'10px',top:'8px','--mdc-icon-size':'18px',width:'18px',height:'18px',opacity:'.7'});\n          inp.value = cfg[f.key] ?? f.default ?? '';\n          inp.addEventListener('input', async () => {\n            const v = inp.value==='' ? undefined : Number(inp.value);\n            currentConfig = this._shapeBySchema(type, {...currentConfig, [f.key]: isNaN(v)? undefined : v});\n            mountPreview(currentConfig);\n            yamlEditorApi?.setValue(currentConfig);\n          });\n          inpWrap.append(numIcon, inp);\n          row.append(label, inpWrap);\n        }\n\n        if (f.type === 'select') {\n          const selWrap = document.createElement('div'); selWrap.style.flex='1'; selWrap.style.position='relative';\n          const sel = document.createElement('select'); Object.assign(sel.style,{width:'100%',padding:'8px 10px 8px 36px',borderRadius:'10px',border:'1px solid var(--divider-color)'});\n          const selIcon = document.createElement('ha-icon'); selIcon.setAttribute('icon','mdi:format-list-bulleted'); Object.assign(selIcon.style,{position:'absolute',left:'10px',top:'8px','--mdc-icon-size':'18px',width:'18px',height:'18px',opacity:'.7'});\n          (f.options||[]).forEach(o => { const opt = document.createElement('option'); opt.value = o; sel.appendChild(opt); });\n          sel.value = cfg[f.key] ?? f.default ?? (f.options?.[0] || '');\n          sel.addEventListener('change', async () => {\n            currentConfig = this._shapeBySchema(type, {...currentConfig, [f.key]: sel.value});\n            mountPreview(currentConfig);\n            yamlEditorApi?.setValue(currentConfig);\n          });\n          selWrap.append(selIcon, sel);\n          row.append(label, selWrap);\n        }\n\n        if (f.type === 'text') {\n          const inpWrap = document.createElement('div'); inpWrap.style.flex='1'; inpWrap.style.position='relative';\n          const inp = document.createElement('input'); inp.type='text';\n          Object.assign(inp.style,{width:'100%',padding:'8px 10px 8px 36px',borderRadius:'10px',border:'1px solid var(--divider-color)'});\n          const tIcon = document.createElement('ha-icon'); tIcon.setAttribute('icon','mdi:text'); Object.assign(tIcon.style,{position:'absolute',left:'10px',top:'8px','--mdc-icon-size':'18px',width:'18px',height:'18px',opacity:'.7'});\n          inp.value = cfg[f.key] ?? '';\n          inp.addEventListener('input', async () => {\n            currentConfig = this._shapeBySchema(type, {...currentConfig, [f.key]: inp.value || undefined});\n            mountPreview(currentConfig);\n            yamlEditorApi?.setValue(currentConfig);\n          });\n          inpWrap.append(tIcon, inp);\n          row.append(label, inpWrap);\n        }\n\n        if (f.type === 'textarea') {\n          const ta = document.createElement('textarea');\n          Object.assign(ta.style,{flex:'1',minHeight:'120px',padding:'8px 10px',borderRadius:'10px',border:'1px solid var(--divider-color)'});\n          ta.value = cfg[f.key] ?? '';\n          ta.addEventListener('input', async () => {\n            currentConfig = this._shapeBySchema(type, {...currentConfig, [f.key]: ta.value || ''});\n            mountPreview(currentConfig);\n            yamlEditorApi?.setValue(currentConfig);\n          });\n          row.append(label, ta);\n        }\n\n        fieldWrap.appendChild(row);\n      });\n\n      quickFill.innerHTML = '';\n      quickFill.appendChild(fieldWrap);\n    };\n\n    /**\n     * Render the visibility editor UI. This editor allows the user to define\n     * simple conditions that control when a card should be shown. Conditions\n     * mirror the core Home Assistant visibility feature: each object in the\n     * visibility array is evaluated and all conditions must pass for the card\n     * to be visible. Only top\u2011level AND conditions are supported by this UI.\n     *\n     * Supported condition types:\n     *  - state: entity and state string\n     *  - numeric_state: entity with optional above/below thresholds\n     *  - screen: media query string\n     *  - user: comma separated user ids\n     */\n    // Maintain collapse/expand state for each visibility condition. A WeakMap\n    // allows us to associate transient UI state with each condition object\n    // without persisting it back into the config. The state survives\n    // re-rendering because the same condition objects are reused in the visList.\n    const visExpansionStates = new WeakMap();\n\n    const buildVisUIOld = (cfg) => {\n      if (!visHost) return;\n      // Ensure visibility exists on the config. Clone to avoid mutating directly.\n      let visList = Array.isArray(cfg?.visibility) ? cfg.visibility.map(c => ({ ...c })) : [];\n      const reRender = () => buildVisUI(currentConfig);\n      const updateConfig = () => {\n        // Remove empty conditions\n        visList = visList.filter((c) => c && typeof c === 'object' && c.condition);\n        currentConfig = { ...currentConfig, visibility: visList };\n        try { yamlEditorApi?.setValue(currentConfig); } catch {}\n        try { visualEditor?.setConfig?.(currentConfig); } catch {}\n        mountPreview(currentConfig);\n      };\n      const render = () => {\n        visHost.innerHTML = '';\n        // If no conditions are defined, show a friendly hint\n        if (!visList || !visList.length) {\n          const p = document.createElement('div');\n          p.style.opacity = '.7';\n          p.style.fontSize = '.9rem';\n          p.style.marginBottom = '8px';\n          p.textContent = 'No conditions defined \u2013 this card is always visible.';\n          visHost.appendChild(p);\n        }\n        visList.forEach((cond, idx) => {\n          // Container for each condition\n          const row = document.createElement('div');\n          Object.assign(row.style, { display:'flex', flexDirection:'column', gap:'6px', marginBottom:'12px', border:'1px solid var(--divider-color)', borderRadius:'8px', padding:'8px' });\n          // Header with icon and type label\n          const headerDiv = document.createElement('div');\n          Object.assign(headerDiv.style, { display:'flex', alignItems:'center', justifyContent:'space-between', marginBottom:'4px' });\n          const leftWrap = document.createElement('div');\n          leftWrap.style.display = 'flex';\n          leftWrap.style.alignItems = 'center';\n          leftWrap.style.gap = '6px';\n          const icon = document.createElement('ha-icon');\n          let iconName = 'mdi:filter';\n          const type = cond.condition || 'state';\n          if (type === 'numeric_state') iconName = 'mdi:numeric';\n          else if (type === 'screen') iconName = 'mdi:monitor';\n          else if (type === 'user') iconName = 'mdi:account';\n          else if (type === 'state') iconName = 'mdi:state-machine';\n          icon.setAttribute('icon', iconName);\n          const labelSpan = document.createElement('span');\n          labelSpan.style.fontWeight = 'bold';\n          labelSpan.style.textTransform = 'capitalize';\n          labelSpan.textContent = (type === 'numeric_state') ? 'Entity numeric state' : (type === 'state' ? 'Entity state' : (type === 'screen' ? 'Screen' : 'User'));\n          leftWrap.appendChild(icon);\n          leftWrap.appendChild(labelSpan);\n          headerDiv.appendChild(leftWrap);\n          // Menu: remove button\n          const del = document.createElement('button');\n          del.setAttribute('title','Remove condition');\n          del.innerHTML = '<ha-icon icon=\"mdi:trash-can-outline\"></ha-icon>';\n          Object.assign(del.style, { border:'none', background:'transparent', cursor:'pointer', padding:'4px', display:'inline-flex', alignItems:'center' });\n          // Ensure the delete button is positioned above other elements\n          del.style.position = 'relative';\n          del.style.zIndex = '1000';\n          del.addEventListener('click', (ev) => {\n            // Prevent the click from bubbling to parent elements (which may lock the editor)\n            ev.preventDefault();\n            ev.stopPropagation();\n            // Remove the correct condition using indexOf on the current list. This\n            // avoids relying on the stale idx value.\n            const index = visList.indexOf(cond);\n            if (index > -1) {\n              visList.splice(index, 1);\n            }\n            currentConfig.visibility = visList;\n            render();\n            updateConfig();\n          });\n          headerDiv.appendChild(del);\n          row.appendChild(headerDiv);\n          // Type selector (for choosing the condition type)\n          const typeRow = document.createElement('div');\n          typeRow.style.display = 'flex';\n          typeRow.style.gap = '8px';\n          const typeLabel = document.createElement('label');\n          typeLabel.textContent = 'Type';\n          typeLabel.style.fontSize = '.85rem';\n          typeLabel.style.marginRight = '4px';\n          const typeSel = document.createElement('select');\n          ['state','numeric_state','screen','user'].forEach((opt) => {\n            const o = document.createElement('option');\n            o.value = opt;\n            o.textContent = opt.replace('_',' ');\n            typeSel.appendChild(o);\n          });\n          typeSel.value = type;\n          typeSel.addEventListener('change', () => {\n            cond.condition = typeSel.value;\n            delete cond.entity; delete cond.state; delete cond.state_not;\n            delete cond.above; delete cond.below;\n            delete cond.media_query; delete cond.users;\n            render();\n            updateConfig();\n          });\n          typeRow.appendChild(typeLabel);\n          typeRow.appendChild(typeSel);\n          row.appendChild(typeRow);\n          // Fields container\n          const fields = document.createElement('div');\n          Object.assign(fields.style, { display:'flex', flexWrap:'wrap', gap:'8px', alignItems:'center' });\n          const addField = (labelText, inputEl) => {\n            const fieldWrap = document.createElement('div');\n            fieldWrap.style.display = 'flex';\n            fieldWrap.style.flexDirection = 'column';\n            fieldWrap.style.gap = '4px';\n            fieldWrap.style.minWidth = '150px';\n            const lbl = document.createElement('span');\n            lbl.textContent = labelText;\n            lbl.style.fontSize = '.75rem';\n            fieldWrap.appendChild(lbl);\n            fieldWrap.appendChild(inputEl);\n            fields.appendChild(fieldWrap);\n          };\n          // Render condition-specific fields\n          const renderFields = () => {\n            fields.innerHTML = '';\n            if (cond.condition === 'state') {\n              // Entity picker\n              let entPicker;\n              if (customElements.get('ha-entity-picker')) {\n                entPicker = document.createElement('ha-entity-picker');\n                entPicker.hass = this.hass;\n                entPicker.setAttribute('label','Select entity');\n                // Ensure the clear icon is visible to allow clearing the selected entity\n                entPicker.removeAttribute('hide-clear-icon');\n                entPicker.value = cond.entity || '';\n                entPicker.addEventListener('value-changed', (ev) => {\n                  // Update the selected entity.  Stop propagation so parent\n                  // controls (like delete) do not mis-handle the event.\n                  ev.stopPropagation();\n                  cond.entity = ev.detail.value || '';\n                  updateConfig();\n                });\n              } else {\n                entPicker = document.createElement('input');\n                entPicker.value = cond.entity || '';\n                entPicker.addEventListener('input', () => {\n                  cond.entity = entPicker.value.trim();\n                  updateConfig();\n                });\n                // Apply Home Assistant-like styling to the entity input fallback\n                Object.assign(entPicker.style, {\n                  padding: '8px 10px',\n                  borderRadius: '8px',\n                  background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                  border: '1px solid var(--divider-color)',\n                  color: 'var(--primary-text-color, inherit)',\n                  width: '100%',\n                  boxSizing: 'border-box'\n                });\n              }\n              addField('Entity', entPicker);\n              // Equals / Not equals selector \u2013 use ha-select when available for native styling\n              let opSel;\n              if (customElements.get('ha-select')) {\n                opSel = document.createElement('ha-select');\n                // Build options using mwc-list-item\n                const optEq = document.createElement('mwc-list-item');\n                optEq.setAttribute('value', 'state');\n                optEq.textContent = 'State is equal to';\n                const optNeq = document.createElement('mwc-list-item');\n                optNeq.setAttribute('value', 'state_not');\n                optNeq.textContent = 'State is not equal to';\n                opSel.appendChild(optEq);\n                opSel.appendChild(optNeq);\n                opSel.value = cond.state_not != null ? 'state_not' : 'state';\n                // Listen for selected event to update config\n                opSel.addEventListener('selected', (ev) => {\n                  // Prevent bubbling to avoid the editor being marked dirty incorrectly\n                  ev.stopPropagation();\n                  const v = cond.state_not != null ? cond.state_not : cond.state;\n                  if (opSel.value === 'state_not') {\n                    cond.state_not = v;\n                    delete cond.state;\n                  } else {\n                    cond.state = v;\n                    delete cond.state_not;\n                  }\n                  updateConfig();\n                });\n              } else {\n                // Fallback to native select\n                opSel = document.createElement('select');\n                opSel.innerHTML = '<option value=\"state\">State is equal to</option><option value=\"state_not\">State is not equal to</option>';\n                opSel.value = cond.state_not != null ? 'state_not' : 'state';\n                // Apply HA-like styling\n                Object.assign(opSel.style, {\n                  padding: '8px 10px',\n                  borderRadius: '8px',\n                  background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                  border: '1px solid var(--divider-color)',\n                  color: 'var(--primary-text-color, inherit)',\n                  width: '100%',\n                  boxSizing: 'border-box'\n                });\n                opSel.addEventListener('change', (ev) => {\n                  ev.stopPropagation();\n                  const v = cond.state_not != null ? cond.state_not : cond.state;\n                  if (opSel.value === 'state_not') {\n                    cond.state_not = v;\n                    delete cond.state;\n                  } else {\n                    cond.state = v;\n                    delete cond.state_not;\n                  }\n                  updateConfig();\n                });\n              }\n              addField('Match type', opSel);\n              // State value input \u2013 use ha-textfield when available for proper styling\n              let stInput;\n              if (customElements.get('ha-textfield')) {\n                stInput = document.createElement('ha-textfield');\n                stInput.value = (cond.state_not != null ? cond.state_not : cond.state) || '';\n                stInput.setAttribute('label', '');\n                stInput.addEventListener('input', (ev) => {\n                  // Update the state value immediately. Stop propagation so the\n                  // card editor does not misinterpret the input as a click\n                  // outside the field.  Ensure only one of state/state_not\n                  // exists at a time.\n                  ev.stopPropagation();\n                  const key = opSel.value;\n                  cond[key] = stInput.value;\n                  const other = key === 'state' ? 'state_not' : 'state';\n                  delete cond[other];\n                  updateConfig();\n                });\n              } else {\n                stInput = document.createElement('input');\n                stInput.value = (cond.state_not != null ? cond.state_not : cond.state) || '';\n                // Apply HA-like styling\n                Object.assign(stInput.style, {\n                  padding: '8px 10px',\n                  borderRadius: '8px',\n                  background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                  border: '1px solid var(--divider-color)',\n                  color: 'var(--primary-text-color, inherit)',\n                  width: '100%',\n                  boxSizing: 'border-box'\n                });\n                stInput.addEventListener('input', (ev) => {\n                  // Mirror numeric state behaviour: update immediately on each\n                  // keystroke and stop propagation so parent controls remain\n                  // responsive.  Ensure only one of state/state_not exists.\n                  ev.stopPropagation();\n                  const key = opSel.value;\n                  cond[key] = stInput.value;\n                  const other = key === 'state' ? 'state_not' : 'state';\n                  delete cond[other];\n                  updateConfig();\n                });\n              }\n              addField('State', stInput);\n            } else if (cond.condition === 'numeric_state') {\n              let entPicker;\n              if (customElements.get('ha-entity-picker')) {\n                entPicker = document.createElement('ha-entity-picker');\n                entPicker.hass = this.hass;\n              entPicker.setAttribute('label','Select entity');\n              entPicker.removeAttribute('hide-clear-icon');\n                entPicker.value = cond.entity || '';\n              entPicker.addEventListener('value-changed', (ev) => {\n                  ev.stopPropagation();\n                  cond.entity = ev.detail.value || '';\n                  updateConfig();\n                });\n              } else {\n                entPicker = document.createElement('input');\n                entPicker.value = cond.entity || '';\n                entPicker.addEventListener('input', () => {\n                  cond.entity = entPicker.value.trim();\n                  updateConfig();\n                });\n                // Apply Home Assistant-like styling to the entity input fallback\n                Object.assign(entPicker.style, {\n                  padding: '8px 10px',\n                  borderRadius: '8px',\n                  background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                  border: '1px solid var(--divider-color)',\n                  color: 'var(--primary-text-color, inherit)',\n                  width: '100%',\n                  boxSizing: 'border-box'\n                });\n              }\n              addField('Entity', entPicker);\n              // Above threshold \u2013 use ha-textfield (type number) when available\n              let aboveField;\n              if (customElements.get('ha-textfield')) {\n                aboveField = document.createElement('ha-textfield');\n                aboveField.setAttribute('type', 'number');\n                aboveField.value = cond.above != null ? cond.above : '';\n                aboveField.addEventListener('input', (ev) => {\n                  ev.stopPropagation();\n                  const v = aboveField.value;\n                  if (v === '' || isNaN(Number(v))) delete cond.above;\n                  else cond.above = Number(v);\n                  updateConfig();\n                });\n              } else {\n                aboveField = document.createElement('input');\n                aboveField.type = 'number';\n                aboveField.value = cond.above != null ? cond.above : '';\n                Object.assign(aboveField.style, {\n                  padding: '8px 10px',\n                  borderRadius: '8px',\n                  background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                  border: '1px solid var(--divider-color)',\n                  color: 'var(--primary-text-color, inherit)',\n                  width: '100%',\n                  boxSizing: 'border-box'\n                });\n                aboveField.addEventListener('input', () => {\n                  const v = aboveField.value;\n                  if (v === '' || isNaN(Number(v))) delete cond.above;\n                  else cond.above = Number(v);\n                  updateConfig();\n                });\n              }\n              addField('Above', aboveField);\n              // Below threshold \u2013 use ha-textfield when available\n              let belowField;\n              if (customElements.get('ha-textfield')) {\n                belowField = document.createElement('ha-textfield');\n                belowField.setAttribute('type', 'number');\n                belowField.value = cond.below != null ? cond.below : '';\n                belowField.addEventListener('input', (ev) => {\n                  ev.stopPropagation();\n                  const v = belowField.value;\n                  if (v === '' || isNaN(Number(v))) delete cond.below;\n                  else cond.below = Number(v);\n                  updateConfig();\n                });\n              } else {\n                belowField = document.createElement('input');\n                belowField.type = 'number';\n                belowField.value = cond.below != null ? cond.below : '';\n                Object.assign(belowField.style, {\n                  padding: '8px 10px',\n                  borderRadius: '8px',\n                  background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                  border: '1px solid var(--divider-color)',\n                  color: 'var(--primary-text-color, inherit)',\n                  width: '100%',\n                  boxSizing: 'border-box'\n                });\n                belowField.addEventListener('input', () => {\n                  const v = belowField.value;\n                  if (v === '' || isNaN(Number(v))) delete cond.below;\n                  else cond.below = Number(v);\n                  updateConfig();\n                });\n              }\n              addField('Below', belowField);\n            } else if (cond.condition === 'screen') {\n              // Predefined options for screen sizes\n              const screenSel = document.createElement('select');\n              const presets = [\n                { label:'Custom', value:'' },\n                { label:'Mobile (max-width: 599px)', value:'(max-width: 599px)' },\n                { label:'Tablet (600px - 991px)', value:'(min-width: 600px) and (max-width: 991px)' },\n                { label:'Desktop (min-width: 992px)', value:'(min-width: 992px)' }\n              ];\n              presets.forEach(p => {\n                const o = document.createElement('option');\n                o.value = p.value;\n                o.textContent = p.label;\n                screenSel.appendChild(o);\n              });\n              screenSel.value = presets.find(p => p.value === (cond.media_query || ''))?.value ?? '';\n              screenSel.addEventListener('change', () => {\n                cond.media_query = screenSel.value;\n                updateConfig();\n              });\n              addField('Screen size', screenSel);\n              // If custom selected, show text input for custom media query\n              if (screenSel.value === '') {\n                const customInp = document.createElement('input');\n                customInp.placeholder = 'e.g. (min-width: 1280px)';\n                customInp.value = cond.media_query || '';\n                customInp.addEventListener('input', () => {\n                  cond.media_query = customInp.value;\n                  updateConfig();\n                });\n                addField('Custom query', customInp);\n              }\n            } else if (cond.condition === 'user') {\n              let userPicker;\n              if (customElements.get('ha-user-picker')) {\n                userPicker = document.createElement('ha-user-picker');\n                userPicker.hass = this.hass;\n                userPicker.value = Array.isArray(cond.users) ? cond.users : [];\n                userPicker.addEventListener('value-changed', (ev) => {\n                  cond.users = Array.isArray(ev.detail.value) ? ev.detail.value : [ev.detail.value];\n                  updateConfig();\n                });\n              } else {\n                userPicker = document.createElement('input');\n                userPicker.value = Array.isArray(cond.users) ? cond.users.join(',') : '';\n                userPicker.addEventListener('input', () => {\n                  cond.users = userPicker.value.split(',').map(s => s.trim()).filter(Boolean);\n                  updateConfig();\n                });\n              }\n              addField('Users', userPicker);\n            }\n          };\n          renderFields();\n          row.appendChild(fields);\n          visHost.appendChild(row);\n        });\n        // Add condition button\n        const addBtn = document.createElement('button');\n        addBtn.className = 'btn';\n        addBtn.innerHTML = '<ha-icon icon=\"mdi:plus\"></ha-icon><span style=\"margin-left:6px\">Add condition</span>';\n        Object.assign(addBtn.style, { marginTop:'8px' });\n        addBtn.addEventListener('click', () => {\n          visList.push({ condition:'state', entity:'', state:'' });\n          currentConfig.visibility = visList;\n          render();\n          updateConfig();\n        });\n        visHost.appendChild(addBtn);\n      };\n      // Initialize\n      render();\n    };\n\n    /**\n     * Enhanced visibility editor UI supporting nested AND/OR groups and a\n     * selection menu when adding new conditions. This implementation renders\n     * conditions recursively and stores expansion state in the shared\n     * visExpansionStates WeakMap. It does not modify the existing\n     * buildVisUIOld implementation but overrides usage by defining a new\n     * buildVisUI constant. Calls throughout the card manager will use this\n     * enhanced editor.\n     */\n    const buildVisUI = (cfg) => {\n      if (!visHost) return;\n      // Use the actual visibility array (do not clone) so updates persist.\n      let visList = Array.isArray(cfg?.visibility) ? cfg.visibility : [];\n      // Cache for asynchronous user list fetches.  We only fetch once per\n      // buildVisUI invocation to avoid redundant requests.\n      let __cachedUserList = null;\n      const fetchUsers = async () => {\n        // Return cached list if already fetched\n        if (__cachedUserList) return __cachedUserList;\n        try {\n          // Attempt to use WebSocket API to list users (requires admin privileges)\n          if (this.hass && typeof this.hass.callWS === 'function') {\n            try {\n              const resp = await this.hass.callWS({ type: 'config/auth/list' });\n              if (Array.isArray(resp)) {\n                __cachedUserList = resp;\n                return resp;\n              }\n            } catch {}\n          }\n          // Fallback to REST API (may require auth)\n          if (this.hass && typeof this.hass.callApi === 'function') {\n            try {\n              const resp = await this.hass.callApi('get', 'users');\n              if (Array.isArray(resp)) {\n                __cachedUserList = resp;\n                return resp;\n              }\n            } catch {}\n          }\n          // Attempt to extract users from hass object when API is unavailable.\n          const fallbackLists = [];\n          // Some HA versions expose authorized users or user registry on hass\n          // Try various common properties to discover user info\n          if (this.hass && this.hass.users && Array.isArray(this.hass.users)) {\n            fallbackLists.push(...this.hass.users);\n          }\n          if (this.hass && this.hass.userData && Array.isArray(this.hass.userData.users)) {\n            fallbackLists.push(...this.hass.userData.users);\n          }\n          if (this.hass && this.hass.authorizedUsers && Array.isArray(this.hass.authorizedUsers)) {\n            fallbackLists.push(...this.hass.authorizedUsers);\n          }\n          // Remove duplicates based on id\n          if (fallbackLists.length) {\n            const map = new Map();\n            fallbackLists.forEach((u) => {\n              const uid = u.id || u.user_id || u.uid || u.name || '';\n              if (!map.has(uid)) map.set(uid, u);\n            });\n            const arr = Array.from(map.values());\n            __cachedUserList = arr;\n            return arr;\n          }\n        } catch {}\n        // If nothing is found, return empty array\n        __cachedUserList = [];\n        return [];\n      };\n\n      const updateConfig = () => {\n        // Clean up any null/undefined conditions\n        visList = visList.filter((c) => c && typeof c === 'object' && c.condition);\n        currentConfig.visibility = visList;\n        try { yamlEditorApi?.setValue(currentConfig); } catch {}\n        try { visualEditor?.setConfig?.(currentConfig); } catch {}\n        mountPreview(currentConfig);\n      };\n      const render = () => {\n        visHost.innerHTML = '';\n        // Instruction message\n        const instr = document.createElement('div');\n        instr.style.opacity = '.75';\n        instr.style.fontSize = '.85rem';\n        instr.style.marginBottom = '12px';\n        instr.textContent = 'The card will be shown when ALL conditions below are fulfilled. If no conditions are set, the card will always be shown.';\n        visHost.appendChild(instr);\n        // Recursive render for lists\n        const renderList = (list, container) => {\n          list.forEach((cond, idx) => {\n            renderCondition(cond, list, idx, container);\n          });\n          // Add button for this list\n          const addWrap = document.createElement('div');\n          addWrap.style.marginTop = '8px';\n          const btn = document.createElement('button');\n          btn.className = 'btn';\n          btn.innerHTML = '<ha-icon icon=\"mdi:plus\"></ha-icon><span style=\"margin-left:6px\">Add condition</span>';\n          // Apply pill-like styling similar to the official editor\n          Object.assign(btn.style, {\n            display: 'flex',\n            alignItems: 'center',\n            gap: '6px',\n            padding: '6px 12px',\n            border: 'none',\n            borderRadius: '20px',\n            background: 'var(--primary-color)',\n            color: 'var(--text-primary-color, #fff)',\n            cursor: 'pointer',\n            fontWeight: '500',\n          });\n          btn.addEventListener('click', (ev) => {\n            ev.stopPropagation();\n            // Toggle menu\n            const existing = addWrap.querySelector('.add-menu');\n            if (existing) {\n              existing.remove();\n              return;\n            }\n            const menu = document.createElement('div');\n            menu.className = 'add-menu';\n            Object.assign(menu.style, {\n              position: 'relative',\n              marginTop: '4px',\n              border: '1px solid var(--divider-color)',\n              borderRadius: '8px',\n              background: 'var(--card-background-color, var(--secondary-background-color))',\n              boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n            });\n            const options = [\n              { type: 'numeric_state', label: 'Entity numeric state', icon: 'mdi:numeric' },\n              { type: 'state', label: 'Entity state', icon: 'mdi:state-machine' },\n              { type: 'screen', label: 'Screen', icon: 'mdi:monitor' },\n              { type: 'user', label: 'User', icon: 'mdi:account' },\n              { type: 'and', label: 'And', icon: 'mdi:logic-and' },\n              { type: 'or', label: 'Or', icon: 'mdi:logic-or' }\n            ];\n            options.forEach((opt) => {\n              const item = document.createElement('div');\n              item.style.display = 'flex';\n              item.style.alignItems = 'center';\n              item.style.gap = '8px';\n              item.style.padding = '6px 12px';\n              item.style.cursor = 'pointer';\n              item.addEventListener('mouseenter', () => item.style.background = 'var(--hover-color, #444)');\n              item.addEventListener('mouseleave', () => item.style.background = '');\n              item.addEventListener('click', () => {\n                menu.remove();\n                let newCond;\n                if (opt.type === 'and' || opt.type === 'or') {\n                  newCond = { condition: opt.type, conditions: [] };\n                } else if (opt.type === 'state') {\n                  newCond = { condition: 'state', entity: '', state: '' };\n                } else if (opt.type === 'numeric_state') {\n                  newCond = { condition: 'numeric_state', entity: '' };\n                } else if (opt.type === 'screen') {\n                  newCond = { condition: 'screen', media_query: '' };\n                } else if (opt.type === 'user') {\n                  newCond = { condition: 'user', users: [] };\n                }\n                list.push(newCond);\n                visExpansionStates.set(newCond, true);\n                updateConfig();\n                render();\n              });\n              const ic = document.createElement('ha-icon');\n              ic.setAttribute('icon', opt.icon);\n              item.appendChild(ic);\n              const la = document.createElement('span');\n              la.textContent = opt.label;\n              item.appendChild(la);\n              menu.appendChild(item);\n            });\n            addWrap.appendChild(menu);\n          });\n          addWrap.appendChild(btn);\n          container.appendChild(addWrap);\n        };\n        const renderCondition = (cond, parentList, idx, container) => {\n          const type = cond.condition || 'state';\n          let expanded = visExpansionStates.get(cond);\n          if (expanded === undefined) expanded = visList.length === 1;\n          const row = document.createElement('div');\n          // Style the condition container to more closely resemble Home Assistant\u2019s editor cards.\n          Object.assign(row.style, {\n            display: 'flex',\n            flexDirection: 'column',\n            border: '1px solid var(--divider-color)',\n            borderLeft: '3px solid var(--primary-color)',\n            borderRadius: '12px',\n            padding: '16px',\n            marginBottom: '20px',\n            background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n            boxShadow: 'var(--ha-card-box-shadow, 0 2px 6px rgba(0, 0, 0, 0.15))'\n          });\n          // Header\n          const header = document.createElement('div');\n          header.style.display = 'flex';\n          header.style.alignItems = 'center';\n          header.style.justifyContent = 'space-between';\n          header.style.marginBottom = '8px';\n          // Subtle bottom border to separate header from fields\n          header.style.borderBottom = '1px solid var(--divider-color)';\n          header.style.paddingBottom = '4px';\n          // Ensure the header sits above any overlay elements (e.g. selects)\n          header.style.position = 'relative';\n          const left = document.createElement('div');\n          left.style.display = 'flex';\n          left.style.alignItems = 'center';\n          left.style.gap = '6px';\n          const toggle = document.createElement('button');\n          toggle.innerHTML = `<ha-icon icon=\"${expanded ? 'mdi:chevron-down' : 'mdi:chevron-right'}\"></ha-icon>`;\n          Object.assign(toggle.style, {\n            border: 'none',\n            background: 'transparent',\n            cursor: 'pointer',\n            padding: '4px',\n            display: 'inline-flex',\n            alignItems: 'center'\n          });\n          toggle.addEventListener('click', (ev) => {\n            ev.stopPropagation();\n            visExpansionStates.set(cond, !expanded);\n            render();\n          });\n          left.appendChild(toggle);\n          // Icon\n          const ic = document.createElement('ha-icon');\n          let iconName = 'mdi:filter';\n          if (type === 'numeric_state') iconName = 'mdi:numeric';\n          else if (type === 'screen') iconName = 'mdi:monitor';\n          else if (type === 'user') iconName = 'mdi:account';\n          else if (type === 'state') iconName = 'mdi:state-machine';\n          else if (type === 'and') iconName = 'mdi:logic-and';\n          else if (type === 'or') iconName = 'mdi:logic-or';\n          ic.setAttribute('icon', iconName);\n          left.appendChild(ic);\n          const lab = document.createElement('span');\n          lab.style.fontWeight = '600';\n          lab.style.fontSize = '0.95rem';\n          lab.style.textTransform = 'capitalize';\n          lab.textContent = (type === 'numeric_state')\n            ? 'Entity numeric state'\n            : (type === 'state'\n                ? 'Entity state'\n                : (type === 'screen'\n                    ? 'Screen'\n                    : (type === 'user'\n                        ? 'User'\n                        : (type === 'and' ? 'And' : 'Or'))));\n          left.appendChild(lab);\n          header.appendChild(left);\n          // Remove button\n          const rm = document.createElement('button');\n          rm.setAttribute('title', 'Remove condition');\n          rm.innerHTML = '<ha-icon icon=\"mdi:trash-can-outline\"></ha-icon>';\n          Object.assign(rm.style, {\n            border: 'none',\n            background: 'transparent',\n            cursor: 'pointer',\n            padding: '4px',\n            display: 'inline-flex',\n            alignItems: 'center'\n          });\n          // Ensure the remove button stays clickable above other elements\n          rm.style.position = 'relative';\n          rm.style.zIndex = '1000';\n          rm.addEventListener('click', (ev) => {\n            // Prevent default and stop propagation so the click does not get swallowed\n            ev.preventDefault();\n            ev.stopPropagation();\n            // Locate this condition in its parent list and remove it. Using\n            // indexOf ensures we remove the correct object even if indices\n            // shift due to other operations.\n            const index = parentList.indexOf(cond);\n            if (index > -1) {\n              parentList.splice(index, 1);\n            }\n            updateConfig();\n            render();\n          });\n          header.appendChild(rm);\n          row.appendChild(header);\n          // Leaf\n          if (type !== 'and' && type !== 'or') {\n            if (expanded) {\n              // Omit the type selector row for leaf conditions. Users choose the\n              // condition type when adding a condition. To change types, remove\n              // the condition and add a new one.  This streamlines the UI to\n              // more closely match the native Home Assistant appearance.\n              // Fields container\n              const fields = document.createElement('div');\n              // Arrange input fields in a single column to more closely match the\n              // native Home Assistant editor.  Each field will stack below the\n              // previous one.  Use a consistent vertical gap for breathing room.\n              Object.assign(fields.style, {\n                display: 'flex',\n                flexDirection: 'column',\n                gap: '14px',\n                alignItems: 'stretch'\n              });\n              const addField = (lbl, inputEl) => {\n                const wrap = document.createElement('div');\n                wrap.style.display = 'flex';\n                wrap.style.flexDirection = 'column';\n                wrap.style.gap = '4px';\n                const l = document.createElement('span');\n                l.textContent = lbl;\n                l.style.fontSize = '.75rem';\n                wrap.appendChild(l);\n                wrap.appendChild(inputEl);\n                fields.appendChild(wrap);\n                // Apply dark styling to plain input/select elements for a cohesive look\n                const tn = (inputEl.tagName || '').toLowerCase();\n                if (tn === 'input' || tn === 'select') {\n                  Object.assign(inputEl.style, {\n                    padding: '8px 10px',\n                    borderRadius: '8px',\n                    background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                    border: '1px solid var(--divider-color)',\n                    color: 'var(--primary-text-color, inherit)',\n                    width: '100%',\n                    boxSizing: 'border-box'\n                  });\n                }\n              };\n              if (cond.condition === 'state') {\n                // Always attempt to use ha-entity-picker for a consistent user experience.\n                let ent = document.createElement('ha-entity-picker');\n                // Provide initial value and hass as soon as possible.\n                ent.value = cond.entity || '';\n                // In some cases the custom element may not yet be defined. When it\n                // upgrades, assign hass and register event listeners. Until then,\n                // these assignments are harmless no-ops.\n                ent.hass = this.hass;\n                ent.setAttribute('label', 'Select entity');\n                // Listen for changes when the element is ready.  The event\n                // listener will still fire once upgraded.\n                ent.addEventListener('value-changed', (ev) => {\n                  // Update the selected entity.  Do not stop propagation here\n                  // so that other click handlers (like remove) continue to work\n                  // properly.  This mirrors the behaviour of numeric state.\n                  cond.entity = ev.detail.value || '';\n                  updateConfig();\n                });\n                // If the element is not yet defined, re-render once it is.\n                if (!customElements.get('ha-entity-picker')) {\n                  customElements.whenDefined('ha-entity-picker').then(() => {\n                    // Re-render this condition to upgrade from a plain element to\n                    // the actual picker UI. Preserve expansion state.\n                    render();\n                  }).catch(() => {});\n                }\n                addField('Entity', ent);\n                // Equals / Not equals selector \u2013 use ha-select if available for native styling\n                let op;\n                if (customElements.get('ha-select')) {\n                  op = document.createElement('ha-select');\n                  const optEq = document.createElement('mwc-list-item');\n                  optEq.setAttribute('value', 'state');\n                  optEq.textContent = 'State is equal to';\n                  const optNeq = document.createElement('mwc-list-item');\n                  optNeq.setAttribute('value', 'state_not');\n                  optNeq.textContent = 'State is not equal to';\n                  op.appendChild(optEq);\n                  op.appendChild(optNeq);\n                  op.value = cond.state_not != null ? 'state_not' : 'state';\n                  op.addEventListener('selected', (ev) => {\n                    ev.stopPropagation();\n                    const v = cond.state_not != null ? cond.state_not : cond.state;\n                    if (op.value === 'state_not') {\n                      cond.state_not = v;\n                      delete cond.state;\n                    } else {\n                      cond.state = v;\n                      delete cond.state_not;\n                    }\n                    updateConfig();\n                  });\n                } else {\n                  op = document.createElement('select');\n                  op.innerHTML = '<option value=\"state\">State is equal to</option><option value=\"state_not\">State is not equal to</option>';\n                  op.value = cond.state_not != null ? 'state_not' : 'state';\n                  op.addEventListener('change', (ev) => {\n                    ev.stopPropagation();\n                    const v = cond.state_not != null ? cond.state_not : cond.state;\n                    if (op.value === 'state_not') {\n                      cond.state_not = v;\n                      delete cond.state;\n                    } else {\n                      cond.state = v;\n                      delete cond.state_not;\n                    }\n                    updateConfig();\n                  });\n                  // Apply HA-like styling to the fallback select\n                  Object.assign(op.style, {\n                    padding: '8px 10px',\n                    borderRadius: '8px',\n                    background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                    border: '1px solid var(--divider-color)',\n                    color: 'var(--primary-text-color, inherit)',\n                    width: '100%',\n                    boxSizing: 'border-box'\n                  });\n                }\n                addField('Match type', op);\n                // State value input \u2013 use ha-textfield when available\n                let st;\n                if (customElements.get('ha-textfield')) {\n                st = document.createElement('ha-textfield');\n                  st.value = (cond.state_not != null ? cond.state_not : cond.state) || '';\n                  st.setAttribute('label', '');\n                st.addEventListener('input', (ev) => {\n                    // Mirror numeric state behaviour: update on each keystroke\n                    // and stop propagation so parent controls remain responsive.\n                    // Ensure only one of state/state_not exists.\n                    ev.stopPropagation();\n                    const key = op.value;\n                    cond[key] = st.value;\n                    const other = key === 'state' ? 'state_not' : 'state';\n                    delete cond[other];\n                    updateConfig();\n                  });\n                } else {\n                st = document.createElement('input');\n                  st.value = (cond.state_not != null ? cond.state_not : cond.state) || '';\n                  // Apply HA-like styling to the fallback input\n                  Object.assign(st.style, {\n                    padding: '8px 10px',\n                    borderRadius: '8px',\n                    background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                    border: '1px solid var(--divider-color)',\n                    color: 'var(--primary-text-color, inherit)',\n                    width: '100%',\n                    boxSizing: 'border-box'\n                  });\n                  st.addEventListener('input', (ev) => {\n                    // Mirror numeric state behaviour: update immediately on\n                    // input and stop propagation so the event does not bubble.\n                    // Ensure only one of state/state_not exists at a time.\n                    ev.stopPropagation();\n                    const key = op.value;\n                    cond[key] = st.value;\n                    const other = key === 'state' ? 'state_not' : 'state';\n                    delete cond[other];\n                    updateConfig();\n                  });\n                }\n                addField('State', st);\n              } else if (cond.condition === 'numeric_state') {\n                // Always attempt to use ha-entity-picker for numeric state conditions.\n                let ent = document.createElement('ha-entity-picker');\n                // Provide initial value and hass property.\n                ent.value = cond.entity || '';\n                ent.hass = this.hass;\n                ent.setAttribute('label', 'Select entity');\n                // Show clear icon so the user can remove the selected entity\n                ent.removeAttribute('hide-clear-icon');\n                ent.addEventListener('value-changed', (ev) => {\n                  cond.entity = ev.detail.value || '';\n                  updateConfig();\n                });\n                // If the custom element is not yet defined, re-render when it upgrades.\n                if (!customElements.get('ha-entity-picker')) {\n                  customElements.whenDefined('ha-entity-picker').then(() => {\n                    render();\n                  }).catch(() => {});\n                }\n                addField('Entity', ent);\n                // Above threshold \u2013 use ha-textfield when available\n                let above;\n                if (customElements.get('ha-textfield')) {\n                  above = document.createElement('ha-textfield');\n                  above.setAttribute('type', 'number');\n                  above.value = cond.above != null ? cond.above : '';\n                above.addEventListener('input', (ev) => {\n                    ev.stopPropagation();\n                    const v = above.value;\n                    if (v === '' || isNaN(Number(v))) delete cond.above;\n                    else cond.above = Number(v);\n                    updateConfig();\n                  });\n                } else {\n                  above = document.createElement('input');\n                  above.type = 'number';\n                  above.value = cond.above != null ? cond.above : '';\n                  // Apply HA-like styling to the fallback numeric input\n                  Object.assign(above.style, {\n                    padding: '8px 10px',\n                    borderRadius: '8px',\n                    background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                    border: '1px solid var(--divider-color)',\n                    color: 'var(--primary-text-color, inherit)',\n                    width: '100%',\n                    boxSizing: 'border-box'\n                  });\n                  above.addEventListener('input', () => {\n                    const v = above.value;\n                    if (v === '' || isNaN(Number(v))) delete cond.above;\n                    else cond.above = Number(v);\n                    updateConfig();\n                  });\n                }\n                addField('Above', above);\n                // Below threshold \u2013 use ha-textfield when available\n                let below;\n                if (customElements.get('ha-textfield')) {\n                  below = document.createElement('ha-textfield');\n                  below.setAttribute('type', 'number');\n                  below.value = cond.below != null ? cond.below : '';\n                below.addEventListener('input', (ev) => {\n                    ev.stopPropagation();\n                    const v = below.value;\n                    if (v === '' || isNaN(Number(v))) delete cond.below;\n                    else cond.below = Number(v);\n                    updateConfig();\n                  });\n                } else {\n                  below = document.createElement('input');\n                  below.type = 'number';\n                  below.value = cond.below != null ? cond.below : '';\n                  // Apply HA-like styling to the fallback numeric input\n                  Object.assign(below.style, {\n                    padding: '8px 10px',\n                    borderRadius: '8px',\n                    background: 'var(--ha-card-background, var(--card-background-color, var(--secondary-background-color)))',\n                    border: '1px solid var(--divider-color)',\n                    color: 'var(--primary-text-color, inherit)',\n                    width: '100%',\n                    boxSizing: 'border-box'\n                  });\n                  below.addEventListener('input', () => {\n                    const v = below.value;\n                    if (v === '' || isNaN(Number(v))) delete cond.below;\n                    else cond.below = Number(v);\n                    updateConfig();\n                  });\n                }\n                addField('Below', below);\n              } else if (cond.condition === 'screen') {\n                const opts = [\n                  { label: 'Mobile', query: '(max-width: 599px)' },\n                  { label: 'Tablet (min: 768px)', query: '(min-width: 768px)' },\n                  { label: 'Desktop (min: 1024px)', query: '(min-width: 1024px)' },\n                  { label: 'Wide (min: 1280px)', query: '(min-width: 1280px)' }\n                ];\n                if (!Array.isArray(cond.media_query_list)) cond.media_query_list = [];\n                const box = document.createElement('div');\n                box.style.display = 'flex';\n                box.style.flexDirection = 'column';\n                box.style.gap = '4px';\n                opts.forEach((opt) => {\n                  const rowcb = document.createElement('label');\n                  rowcb.style.display = 'flex';\n                  rowcb.style.alignItems = 'center';\n                  rowcb.style.gap = '6px';\n                  const cb = document.createElement('input');\n                  cb.type = 'checkbox';\n                  cb.checked = cond.media_query_list.includes(opt.query);\n                  cb.addEventListener('change', () => {\n                    if (cb.checked) {\n                      cond.media_query_list.push(opt.query);\n                    } else {\n                      cond.media_query_list = cond.media_query_list.filter((q) => q !== opt.query);\n                    }\n                    cond.media_query = cond.media_query_list.join(',');\n                    updateConfig();\n                  });\n                  const sp = document.createElement('span');\n                  sp.textContent = opt.label;\n                  rowcb.appendChild(cb);\n                  rowcb.appendChild(sp);\n                  box.appendChild(rowcb);\n                });\n                addField('Screen sizes', box);\n              } else if (cond.condition === 'user') {\n                let up;\n                if (customElements.get('ha-user-picker')) {\n                  // Use the built\u2011in user picker when available\n                  up = document.createElement('ha-user-picker');\n                  up.hass = this.hass;\n                  up.setAttribute('label', 'Select user');\n                  up.value = Array.isArray(cond.users) ? cond.users : [];\n                  up.addEventListener('value-changed', (ev) => {\n                    const val = ev.detail.value;\n                    cond.users = Array.isArray(val) ? val : [val];\n                    updateConfig();\n                  });\n                } else {\n                  // Fallback: create a container that will be filled asynchronously\n                  up = document.createElement('div');\n                  up.style.display = 'flex';\n                  up.style.flexDirection = 'column';\n                  up.style.gap = '4px';\n                    // Show a loading indicator while fetching\n                  const loading = document.createElement('span');\n                  loading.style.opacity = '0.7';\n                  loading.style.fontSize = '.85rem';\n                  loading.textContent = 'Loading users\u2026';\n                  up.appendChild(loading);\n                  // Preserve current selection\n                  const selUsers = Array.isArray(cond.users) ? cond.users : [];\n                  fetchUsers().then((uList) => {\n                    up.innerHTML = '';\n                    if (Array.isArray(uList) && uList.length) {\n                      // Build checkbox list for each user\n                      uList.forEach((u) => {\n                        const uid = u.id || u.user_id || u.uid || u.name || '';\n                        const uname = u.name || uid;\n                        const lbl = document.createElement('label');\n                        lbl.style.display = 'flex';\n                        lbl.style.alignItems = 'center';\n                        lbl.style.gap = '6px';\n                        lbl.style.padding = '4px 0';\n                        const cb = document.createElement('input');\n                        cb.type = 'checkbox';\n                        cb.checked = selUsers.includes(uid) || selUsers.includes(uname);\n                        cb.addEventListener('change', () => {\n                          let arr = Array.isArray(cond.users) ? cond.users.slice() : [];\n                          if (cb.checked) {\n                            if (!arr.includes(uid)) arr.push(uid);\n                          } else {\n                            arr = arr.filter((x) => x !== uid && x !== uname);\n                          }\n                          cond.users = arr;\n                          updateConfig();\n                        });\n                        const sp = document.createElement('span');\n                        sp.textContent = uname;\n                        lbl.appendChild(cb);\n                        lbl.appendChild(sp);\n                        up.appendChild(lbl);\n                      });\n                    } else {\n                      // Still fallback to simple input if no users found via API\n                      const inp = document.createElement('input');\n                      inp.value = Array.isArray(cond.users) ? cond.users.join(',') : '';\n                      // Style the manual users input for consistency\n                      Object.assign(inp.style, {\n                        padding: '6px 10px',\n                        borderRadius: '6px',\n                        border: '1px solid var(--divider-color)',\n                        background: 'var(--card-background-color, var(--secondary-background-color))',\n                        color: 'var(--primary-text-color, inherit)'\n                      });\n                      const commit = () => {\n                        cond.users = inp.value.split(',').map((s) => s.trim()).filter(Boolean);\n                        updateConfig();\n                      };\n                      inp.addEventListener('change', commit);\n                      inp.addEventListener('blur', commit);\n                      up.appendChild(inp);\n                    }\n                  });\n                }\n                addField('Users', up);\n              }\n              row.appendChild(fields);\n            }\n          } else {\n            // Group\n            if (expanded) {\n              if (!Array.isArray(cond.conditions)) cond.conditions = [];\n              const childContainer = document.createElement('div');\n              childContainer.style.marginLeft = '16px';\n              renderList(cond.conditions, childContainer);\n              row.appendChild(childContainer);\n            }\n          }\n          container.appendChild(row);\n        };\n        // Render top level\n        renderList(visList, visHost);\n      };\n      render();\n    };\n\n    const mountPreview = (cfg) => {\n      if ((cfg?.type || '') === 'custom_card') {\n        __lastPreviewCfgJSON = JSON.stringify(cfg || {});\n        cardHost.innerHTML = '<div style=\"opacity:.6;font-size:.9rem;padding:8px\">Preview not available for the custom card placeholder. Use the YAML editor.</div>';\n        previewSpin.hidden = true;\n        return;\n      }\n      const cfgJSON = JSON.stringify(cfg || {});\n      if (cfgJSON === __lastPreviewCfgJSON) return; // same config, skip\n      __lastPreviewCfgJSON = cfgJSON;\n      if (__previewTimer) clearTimeout(__previewTimer);\n      __previewTimer = setTimeout(async () => {\n        const seq = ++pickSeq;\n        previewSpin.hidden = false;\n        cardHost.innerHTML = '';\n        await raf();\n        try {\n          const helpers = (await this._helpersPromise) || await window.loadCardHelpers();\n          if (seq !== pickSeq) return;\n          const temp = helpers.createCardElement(cfg); temp.hass = this.hass;\n          if (seq !== pickSeq) return;\n          cardHost.appendChild(temp);\n        } catch {}\n        finally { if (seq === pickSeq) previewSpin.hidden = true; }\n      }, 150); // 150\u2013250ms is a sweet spot\n    };\n\n      const mountVisualEditor = async (cfg) => {\n        const seq = ++pickSeq;\n        editorSpin.hidden = false;\n        editorHost.innerHTML = '';\n        await idle();\n\n        const wantType = cfg.type || currentType;\n\n        editor = await this._getEditorElementForType(wantType, cfg);\n\n\n        // \uD83D\uDEAB Visual editor not supported for the placeholder entry\n        if (wantType === 'custom_card') {\n          // Show a friendly note and switch to YAML\n          const p = document.createElement('div');\n          p.style.opacity = '.7';\n          p.style.fontSize = '.9rem';\n          p.textContent = 'Custom card placeholder: use the YAML editor to paste the card type and options.';\n          editorHost.appendChild(p);\n\n          visualEditor = null;\n          if (__activeTab !== 'yaml') showTab('yaml');\n          enableCommit(true);\n          editorSpin.hidden = true;\n          return false;\n        }\n\n      if (!editor) {\n        // No UI editor \u2192 show YAML (unless user explicitly selected Visual)\n        const p = document.createElement('div');\n        p.style.opacity = '.7'; p.style.fontSize = '.9rem';\n        p.textContent = 'This card does not support a visual editor. Please use the YAML tab to configure it.';\n        if (seq === pickSeq) {\n          editorHost.appendChild(p);\n          editorSpin.hidden = true;\n        }\n        visualEditor = null;\n        enableCommit(true);\n        if (__activeTab !== 'visual') showTab('yaml');\n        return false;\n}\n    \n      try {\n        editor.hass = this.hass;\n        if (!editor.isConnected) editorHost.appendChild(editor);\n\n        // small yield before setConfig to help late-attaching internals\n        await Promise.resolve();\n        try { editor.setConfig(cfg); } catch (e) { /* YAML still works */ }\n\n        // Try official getStubConfig once (may load modules) to improve defaults\n        try {\n          const helpers = (await this._helpersPromise) || await window.loadCardHelpers();\n          const CardClass = helpers.getCardElementClass ? await helpers.getCardElementClass(cfg.type || currentType) : null;\n          if (CardClass?.getStubConfig) {\n            const all = Object.keys(this.hass?.states || {});\n            const byDomain = (d)=>all.filter((e)=>e.startsWith(d+'.'));\n            const better = await CardClass.getStubConfig(this.hass, all, byDomain);\n            if (better) cfg = this._shapeBySchema(cfg.type || currentType, { ...better });\n          }\n        } catch {}\n\n        // small yield before setConfig to help late-attaching internals\n        await Promise.resolve();\n        try { editor.setConfig(cfg); } catch (e) { /* YAML still works */ }\n    \n        // Remove old listeners if any\n        if (visualEditor && this.__onEditorChange) {\n          visualEditor.removeEventListener('config-changed', this.__onEditorChange);\n          visualEditor.removeEventListener('value-changed', this.__onEditorChange);\n        }\n    \n        const onChange = async (e) => {\n          const next = e.detail?.config ?? e.detail?.value; // some editors fire value-changed\n          if (!next) return;\n          const nextType = next.type || currentType;\n          currentType = nextType;\n          currentConfig = this._shapeBySchema(nextType, next);\n    \n          setError('');\n          enableCommit(true);\n          buildQuickFill(currentType, currentConfig);\n          mountPreview(currentConfig);\n          yamlEditorApi?.setValue(currentConfig);\n        };\n    \n        this.__onEditorChange = onChange;\n        editor.addEventListener('config-changed', onChange);\n        editor.addEventListener('value-changed', onChange);\n    \n        visualEditor = editor;\n    \n        // If a UI exists and the user hasn\u2019t explicitly chosen YAML \u2192 show Visual\n        if (__activeTab !== 'yaml') showTab('visual');\n    \n        enableCommit(true);\n        return true;\n      } finally {\n        if (seq === pickSeq) editorSpin.hidden = true;\n      }\n    };\n    \n\n    const mountYaml = async (cfg) => {\n      yamlEditorApi = await this._mountYamlEditor(\n        yamlHost,\n        cfg,\n        async (parsed) => {\n          try {\n            const nextType = parsed?.type || currentType;\n            const shaped = this._shapeBySchema(nextType, parsed || {});\n            const typeChanged = nextType !== currentType;\n    \n            currentType = nextType;\n            currentConfig = shaped;\n    \n            yamlErr.hidden = true; yamlErr.textContent = '';\n            enableCommit(true);\n    \n            if (typeChanged) {\n              buildQuickFill(currentType, currentConfig);\n              // Only update Visual if it\u2019s already mounted\n              if (visualEditor) {\n                try { visualEditor.setConfig?.(currentConfig); } catch {}\n                if (__activeTab !== 'yaml') showTab('visual');\n              }\n              // When the card type changes via YAML, rebuild the visibility UI\n              try { buildVisUI(currentConfig); } catch {}\n            } else {\n              try { visualEditor?.setConfig?.(currentConfig); } catch {}\n              mountPreview(currentConfig);\n              // Update the visibility UI when YAML modifies non-type properties\n              try { buildVisUI(currentConfig); } catch {}\n            }\n\n          } catch (e) {\n            yamlErr.hidden = false;\n            yamlErr.textContent = `Invalid config: ${String(e?.message || e)}`;\n            enableCommit(false);\n          }\n        },\n        (e) => {\n          yamlErr.hidden = false;\n          yamlErr.textContent = `Invalid YAML: ${String(e?.message || e)}`;\n          enableCommit(false);\n        }\n      );\n    };\n    \n\n    const getStub = async (type) => {\n      if (this.__stubCache.has(type)) return { ...this.__stubCache.get(type) };\n      // Fast local stub first (no heavy module loads)\n      let cfg = await this._getStubConfigForType(type);\n      this.__stubCache.set(type, { ...cfg });\n      return { ...cfg };\n    };\n\n    const selectType = async (type) => {\n      yamlErr.hidden = true; yamlErr.textContent = '';\n      setError('');\n      currentType = type;\n      // Update the selected-card headline and favorite star when a new card is chosen\n      try {\n        if (typeof updateHeader === 'function') updateHeader(type);\n      } catch {\n        // ignore if updateHeader is undefined or throws\n      }\n    \n      const cfg = (mode==='edit' && initialCfg && initialCfg.type===type)\n        ? { ...initialCfg }\n        : await getStub(type);\n    \n      currentConfig = this._shapeBySchema(type, cfg);\n\n      // Reset any previously mounted visual editor so the correct one loads for this card\n      visualEditor = null;\n\n      buildQuickFill(type, currentConfig);\n      await mountYaml(currentConfig);\n      await raf();\n      mountPreview(currentConfig); // debounced version\n\n      // Rebuild the visibility UI for the selected type/config. This ensures the\n      // visibility editor reflects any conditions stored in the config when a\n      // different card type is selected.\n      try { buildVisUI(currentConfig); } catch {}\n\n      // Do not reuse an old editor; mount the visual editor by default when adding a new card.\n      // Attempt to mount the visual editor for the selected type. If the card does\n      // not support a visual editor, mountVisualEditor will handle showing a\n      // message and fallback to YAML internally.\n      try {\n        // Try mounting visual editor for the current configuration. If the\n        // returned value is false, the card lacks a visual editor.\n        const visReady = await mountVisualEditor(currentConfig);\n        showTab(visReady ? 'visual' : 'yaml');\n      } catch {\n        // On error, fall back to YAML\n        showTab('yaml');\n      }\n      enableCommit(true);\n\n    };\n    const commit = async () => {\n      if (!currentConfig) return;\n      const finalCfg = this._shapeBySchema(currentType, currentConfig);\n      if (mode === 'edit' && typeof onCommit === 'function') {\n        await onCommit(finalCfg);\n      } else {\n        await this._addPickedCardToLayout(finalCfg);\n        this._pushRecent((finalCfg||{}).type);\n      }\n      close();\n    };\n\n    cancelTop.addEventListener('click', close);\n    cancelBot.addEventListener('click', close);\n    addTop.addEventListener('click', commit);\n    addBottom.addEventListener('click', commit);\n    modal.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); if (e.key === 'Enter' && !addTop.disabled) commit(); });\n\n    let __searchTimer = null;\n    search.addEventListener('input', () => {\n      if (__searchTimer) clearTimeout(__searchTimer);\n      __searchTimer = setTimeout(renderLeft, 120);\n    });\n\n\n    renderLeft();\n    // --- Ensure something is selected so YAML/preview mount immediately ---\n    const pickDefaultType = () => {\n      // Prefer recent if present; otherwise fall back to 'entities'\n      const r = this._getRecent?.() || [];\n      const firstRecent = r.find(Boolean);\n      return firstRecent || 'entities';\n    };\n\n    await selectType(pickDefaultType());\n    enableCommit(true);\n\n    // default selection\n    if (mode === 'edit' && initialCfg) {\n      await selectType(initialCfg.type || 'entities');\n      enableCommit(true);\n    }\n  }\n\n  /* ------------------------- Stubs / helpers (cards) ------------------------- */\nasync _getStubConfigForType(type) {\n    const helpers = (await this._helpersPromise) || await window.loadCardHelpers();\n    let CardClass = null;\n\n    // Provide a blank stub when the user selects the \"Custom Card\" entry.\n    // A blank type lets the YAML editor drive the configuration entirely.\n    if (type === 'custom_card') return null;\n\n    try { if (helpers.getCardElementClass) CardClass = await helpers.getCardElementClass(type); } catch {}\n    const all = Object.keys(this.hass?.states || {});\n    const byDomain = (d)=>all.filter((e)=>e.startsWith(d+'.'));\n    let base = { type };\n    if (CardClass?.getStubConfig) {\n      try {\n        const stub = await CardClass.getStubConfig(this.hass, all, byDomain);\n        if (type !== 'entity') {\n          // keep old behavior for all non-entity cards\n          return stub;\n        }\n        // For 'entity': merge the stub but DO NOT return yet \u2014 let defaults fill .entity if missing\n        if (stub && typeof stub === 'object') base = { ...base, ...stub };\n      } catch {}\n    }\n    const first = all[0];\n    const firstSensor = byDomain('sensor')[0] || first;\n\n    if (['entity','sensor','button','gauge','tile','light','thermostat','media-control','alarm-panel','picture-entity','weather-forecast','map'].includes(type)) {\n      // Provide sensible defaults for cards that require an `entity` field.\n      const defaultEntity = ({\n        'sensor': firstSensor,\n        'gauge':  (byDomain('sensor').find(this._isNumericEntity.bind(this)) || firstSensor),\n        'media-control': byDomain('media_player')[0] || first,\n        'light': byDomain('light')[0] || first,\n        'thermostat': byDomain('climate')[0] || first,\n        'alarm-panel': byDomain('alarm_control_panel')[0] || first,\n        'weather-forecast': byDomain('weather')[0] || first,\n        'map': byDomain('device_tracker')[0] || byDomain('person')[0] || first,\n      })[type] || firstSensor || first;\n      if (['entity','sensor','button','gauge','tile','light','thermostat','media-control','alarm-panel','picture-entity'].includes(type)) {\n        base.entity = defaultEntity;\n      } else if (type === 'weather-forecast') {\n        base.entity = defaultEntity;\n        base.show_current = true;\n        base.show_forecast = true;\n        base.forecast_type = 'daily';\n      } else if (type === 'map') {\n        base.entities = [defaultEntity].filter(Boolean);\n        base.theme_mode = 'auto';\n      }\n    }\n    if (['entities','glance','picture-glance','history-graph','statistics-graph'].includes(type)) {\n      const pick = (domains) => (domains?.length ? all.filter(e => domains.includes(e.split('.')[0])) : all).slice(0,3);\n      if (type === 'statistics-graph') base.entities = pick(['sensor','number','input_number']);\n      else base.entities = pick();\n    }\n    if (type === 'markdown') {\n      // Provide a minimal content so the card does not error\n      base.content = 'Markdown card';\n    }\n    if (type === 'sensor') {\n      base.graph = 'line';\n    }\n    if (type === 'button') {\n      base.show_name = true;\n      base.show_icon = true;\n    }\n    if (type === 'tile') {\n      base.features_position = 'bottom';\n      base.vertical = false;\n    }\n    if (type === 'picture-glance') {\n      base.title = base.title || 'Glance';\n      // Provide placeholder image if none available\n      base.image = base.image || 'https://demo.home-assistant.io/stub_config/kitchen.png';\n    }\n    if (type === 'picture-entity') {\n      base.image = base.image || 'https://demo.home-assistant.io/stub_config/bedroom.png';\n    }\n    if (type === 'iframe') {\n      base.url = base.url || 'https://www.home-assistant.io';\n      base.aspect_ratio = base.aspect_ratio || '50%';\n    }\n    if (type === 'history-graph') {\n      // Entities already set; nothing extra\n    }\n    if (type === 'statistics-graph') {\n      // Entities already set; nothing extra\n    }\n    if (type === 'alarm-panel') {\n      base.states = base.states || ['arm_home','arm_away'];\n    }\n    if (type === 'area') {\n      // pick first area from hass.areas if available; else use the first area name from states (area). This is a guess.\n      try {\n        const areas = (this.hass && this.hass.areas) ? Object.values(this.hass.areas) : [];\n        if (areas.length) {\n          base.area = areas[0].area_id || areas[0].name || areas[0].id;\n        } else {\n          // fallback: pick the domain of the first entity as area name\n          base.area = first ? first.split('.')[0] : 'default_area';\n        }\n        // Add optional defaults similar to built-in card example\n        base.display_type = 'picture';\n        base.alert_classes = base.alert_classes || ['moisture','motion'];\n        base.sensor_classes = base.sensor_classes || ['temperature','humidity'];\n        base.features_position = 'bottom';\n      } catch {}\n    }\n    // Note: area card and other complex cards are not given defaults here\n    return base;\n  }\n\n  _getNextAvailablePosition() {\n    const wraps = Array.from(this.cardContainer.querySelectorAll('.card-wrapper:not(.ddc-placeholder)'));\n    const occupied = new Set();\n    const gs = this.gridSize;\n    wraps.forEach((w) => {\n      const x = (parseFloat(w.getAttribute('data-x')) || 0);\n      const y = (parseFloat(w.getAttribute('data-y')) || 0);\n      const width  = parseFloat(getComputedStyle(w).width)  || 100;\n      const height = parseFloat(getComputedStyle(w).height) || 100;\n      const xStart = Math.floor(x/gs), yStart = Math.floor(y/gs);\n      const xEnd   = Math.floor((x+width)/gs), yEnd = Math.floor((y+height)/gs);\n      for (let xi=xStart; xi<xEnd; xi++) for (let yi=yStart; yi<yEnd; yi++) occupied.add(`${xi}-${yi}`);\n    });\n    let xi=0, yi=0;\n    while (occupied.has(`${xi}-${yi}`)) { xi+=6; if (xi>60) { xi=0; yi+=6; } }\n    return { x: xi*gs, y: yi*gs };\n  }\n\n  async _addPickedCardToLayout(cardConfig) {\n    this._hideEmptyPlaceholder();\n    const cardEl = await this._createCard(cardConfig);\n    const wrap = this._makeWrapper(cardEl);\n    const next = this._getNextAvailablePosition();\n    this._setCardPosition(wrap, next.x, next.y);\n    wrap.style.width  = `${14*this.gridSize}px`;\n    wrap.style.height = `${10*this.gridSize}px`;\n    // Assign a z-index for the new card that is at least 6.  Without\n    // clamping the first few cards could be placed behind the grid overlay.\n    {\n      const nextVal = this._highestZ() + 1;\n      wrap.style.zIndex = String(Math.max(nextVal, 6));\n    }\n    this.cardContainer.appendChild(wrap);\n    \n  try { this._rebuildOnce(wrap.firstElementChild); } catch {}\n    this._initCardInteract(wrap);\n    this._resizeContainer();\n    this._queueSave('add');\n    this._toast('Card added to layout.');\n    this._syncEmptyStateUI();\n\n    // After inserting a new card, reevaluate visibility so any conditions\n    // attached to the new card are applied immediately (if not in edit mode).\n    try { this._applyVisibility_(); } catch {}\n  }\n\n  /* ------------------------------ Selection utils ------------------------------ */\n  _toggleSelection(wrap, force=null) {\n    const on = force==null ? !this._selection.has(wrap) : !!force;\n    if (on) this._selection.add(wrap); else this._selection.delete(wrap);\n    wrap.classList.toggle('selected', on);\n  }\n  _clearSelection() {\n    for (const w of this._selection) w.classList.remove('selected');\n    this._selection.clear();\n  }\n\n  /**\n   * Copy the currently selected cards into a global clipboard. When invoked,\n   * this will capture the configuration and layout of each selected card and\n   * store it on the window object so that it may be pasted into the same\n   * dashboard or a completely different drag-and-drop card instance. The\n   * relative arrangement of cards is preserved based on the top\u2011leftmost\n   * card in the selection.\n   */\n  _copySelection() {\n    try {\n      // Determine selected wrappers. If nothing is selected, bail early.\n      const wrappers = this._selection ? Array.from(this._selection) : [];\n      if (!wrappers.length) {\n        this._toast?.('Nothing selected to copy.');\n        return;\n      }\n      // Compute the minimum x/y across the selection to preserve relative offsets\n      let minX = Infinity, minY = Infinity;\n      const items = [];\n      for (const w of wrappers) {\n        // skip placeholders\n        if (w.dataset.placeholder) continue;\n        const x = parseFloat(w.getAttribute('data-x')) || 0;\n        const y = parseFloat(w.getAttribute('data-y')) || 0;\n        if (x < minX) minX = x;\n        if (y < minY) minY = y;\n      }\n      for (const w of wrappers) {\n        if (w.dataset.placeholder) continue;\n        const cfg = this._extractCardConfig(w.firstElementChild) || {};\n        const x = parseFloat(w.getAttribute('data-x')) || 0;\n        const y = parseFloat(w.getAttribute('data-y')) || 0;\n        const width  = w.style.width  || `${w.getBoundingClientRect().width}px`;\n        const height = w.style.height || `${w.getBoundingClientRect().height}px`;\n        items.push({ cfg, dx: x - minX, dy: y - minY, width, height });\n      }\n      // Save to global clipboard. Use a namespaced key to avoid collisions.\n      window.__DDC_CLIPBOARD__ = { items };\n      this._toast?.(`Copied ${items.length} card${items.length === 1 ? '' : 's'}.`);\n    } catch (err) {\n      console.warn('[drag-and-drop-card] Copy failed', err);\n      this._toast?.('Copy failed.');\n    }\n  }\n\n  /**\n   * Paste cards from the global clipboard into this drag\u2011and\u2011drop card. The\n   * pasted cards will retain their relative arrangement and sizing, and will\n   * be placed into the currently active tab. If no valid clipboard data is\n   * present, the user will be notified. Cards are offset from the top\u2011left\n   * corner by one grid unit and shifted repeatedly until no collision with\n   * existing cards is detected.\n   */\n  async _pasteClipboard() {\n    try {\n      const clip = window.__DDC_CLIPBOARD__;\n      if (!clip || !Array.isArray(clip.items) || !clip.items.length) {\n        this._toast?.('Clipboard is empty.');\n        return;\n      }\n      const items = clip.items;\n      // Determine a collision\u2011free base position. We attempt to place the\n      // group starting at one grid unit from the origin and slide further\n      // down/right until no overlap occurs.\n      let shift = 1;\n      let proposedRects;\n      do {\n        const baseX = this.gridSize * shift;\n        const baseY = this.gridSize * shift;\n        proposedRects = items.map((it) => {\n          const w = parseFloat(it.width) || 0;\n          const h = parseFloat(it.height) || 0;\n          return { x: baseX + (it.dx || 0), y: baseY + (it.dy || 0), w, h };\n        });\n        shift += 1;\n        // Break if no collision; ignore nothing (empty set) so all existing cards count\n      } while (this._anyCollisionFor(proposedRects, new Set()));\n      // Use the final baseX/baseY from the previous iteration\n      const baseX = this.gridSize * (shift - 1);\n      const baseY = this.gridSize * (shift - 1);\n      // Create each card, apply sizing and position, and attach to the DOM\n      for (const it of items) {\n        const cfg = it.cfg || {};\n        const cardEl = await this._createCard(cfg);\n        const wrap = this._makeWrapper(cardEl);\n        // Sizing\n        wrap.style.width  = it.width;\n        wrap.style.height = it.height;\n        // Positioning: maintain relative dx/dy within group\n        const x = baseX + (it.dx || 0);\n        const y = baseY + (it.dy || 0);\n        this._setCardPosition(wrap, x, y);\n        // Bring to front.  Ensure the new card's z-index is at least 6 so\n        // pasted cards never end up behind the grid overlay.  Compute\n        // highest z-index among existing cards and clamp to our baseline.\n        {\n          const nextVal = this._highestZ() + 1;\n          wrap.style.zIndex = String(Math.max(nextVal, 6));\n        }\n        // Assign to current tab\n        try {\n          const tid = this._normalizeTabId(this.activeTab || this.defaultTab);\n          if (tid) wrap.dataset.tabId = tid;\n        } catch {}\n        // Append and initialize\n        this.cardContainer.appendChild(wrap);\n        // Do not attach a tab selector when pasting. Pasted cards are assigned\n        // to the current tab automatically and the user does not need to\n        // reassign them immediately.\n        try { this._rebuildOnce(wrap.firstElementChild); } catch {}\n        this._initCardInteract(wrap);\n      }\n      // Ensure the container grows and the active tab filter is applied\n      this._resizeContainer();\n      this._applyActiveTab();\n      // Persist the change\n      this._queueSave?.('paste');\n      this._toast?.(`Pasted ${items.length} card${items.length === 1 ? '' : 's'}.`);\n    } catch (err) {\n      console.warn('[drag-and-drop-card] Paste failed', err);\n      this._toast?.('Paste failed.');\n    }\n  }\n\n  _installSelectionMarquee() {\n    const cont = this.cardContainer;\n    let startX=0, startY=0, marquee=null, active=false;\n\n    const toLocal = (ev) => {\n      const r = cont.getBoundingClientRect();\n      const x = ('touches' in ev && ev.touches[0]) ? ev.touches[0].clientX : ev.clientX;\n      const y = ('touches' in ev && ev.touches[0]) ? ev.touches[0].clientY : ev.clientY;\n      const sx = this.__pointerScaleX || 1;\n      const sy = this.__pointerScaleY || 1;\n      return { x: (x - r.left) / sx, y: (y - r.top) / sy };\n    };\n\n    const updateSel = (x,y) => {\n      const minX = Math.min(x, startX), maxX = Math.max(x, startX);\n      const minY = Math.min(y, startY), maxY = Math.max(y, startY);\n      marquee.style.left = `${minX}px`;\n      marquee.style.top = `${minY}px`;\n      marquee.style.width = `${maxX-minX}px`;\n      marquee.style.height= `${maxY-minY}px`;\n\n      const rRect = marquee.getBoundingClientRect();\n      const wraps = cont.querySelectorAll('.card-wrapper:not(.ddc-placeholder)');\n      this._clearSelection();\n      wraps.forEach(w => {\n        const wr = w.getBoundingClientRect();\n        const overlap = !(wr.right < rRect.left || wr.left > rRect.right || wr.bottom < rRect.top || wr.top > rRect.bottom);\n        if (overlap) this._toggleSelection(w, true);\n      });\n    };\n\n    const down = (e) => {\n      if (!this.editMode) return;\n      if (e.target.closest('.card-wrapper')) return;\n      active = true;\n      const p = toLocal(e);\n      startX = p.x; startY = p.y;\n      marquee = document.createElement('div');\n      marquee.className = 'marquee';\n      marquee.style.left = `${startX}px`;\n      marquee.style.top  = `${startY}px`;\n      cont.appendChild(marquee);\n      e.preventDefault();\n    };\n    const move = (e) => { if (!active || !marquee) return; updateSel(toLocal(e).x, toLocal(e).y); };\n    const up = () => { if (!active) return; active = false; if (marquee) marquee.remove(); marquee = null; };\n\n    cont.addEventListener('mousedown', down);\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n    cont.addEventListener('touchstart', (e)=>{ if (!this.editMode) return; if (e.target.closest('.card-wrapper')) return; down(e); }, {passive:false});\n    window.addEventListener('touchmove', (e)=>{ move(e); }, {passive:true});\n    window.addEventListener('touchend', up);\n    window.addEventListener('touchcancel', up);\n  }\n\n  /* ------------------------------ Diagnostics ------------------------------ */\n  async _openDiagnostics() {\n    const modal = document.createElement('div');\n    modal.className = 'modal';\n    const sk = this.storageKey || '(none)';\n    const usingHost = this._backendOK && !!this.storageKey;\n\n    const logsToHtml = (rows) => rows.slice(-200).map(r =>\n      `<div style=\"font-family:monospace;font-size:.85rem;line-height:1.3\">\n        <span style=\"opacity:.6\">${r.t}</span>\n        <b style=\"margin-left:6px;color:#03a9f4\">[${r.kind}]</b>\n        <span style=\"margin-left:6px\">${this._safe(r.msg)}</span>\n        ${r.extra ? `<pre style=\"margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto\">${this._safe(JSON.stringify(r.extra, null, 2))}</pre>` : ''}\n      </div>`\n    ).join('');\n\n    modal.innerHTML = `\n      <div class=\"dialog\" style=\"max-width:1100px;width:min(1100px,95%);height:min(90vh,860px)\">\n        <div class=\"dlg-head\">\n          <h3>Drag & Drop \u2014 Diagnostics</h3>\n          <button class=\"btn secondary\" id=\"closeDiag\"><ha-icon icon=\"mdi:close\"></ha-icon><span style=\"margin-left:6px\">Close</span></button>\n        </div>\n        <div style=\"display:block;overflow:auto;padding:12px\">\n          <div class=\"section\" style=\"border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color);margin-bottom:10px\">\n            <div class=\"hd\" style=\"display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600\">Status</div>\n            <div class=\"bd\" style=\"padding:12px\">\n              <div style=\"display:grid;grid-template-columns:220px 1fr;gap:6px;align-items:center\">\n                <div>Storage key (raw \u2192 slug)</div><div><code>${this._safe(this._config?.storage_key || '')}</code> \u2192 <code>${this._safe(sk)}</code></div>\n                <div>Backend reachable</div><div><b>${this._backendOK ? 'YES' : 'NO'}</b></div>\n                <div>Persist target</div><div><b>${usingHost ? 'Host (backend)' : 'Browser (localStorage)'}</b></div>\n                <div>Auto-save</div><div>${this.autoSave ? `ON (${this.autoSaveDebounce} ms)` : 'OFF'}</div>\n                <div>Cards mounted</div><div>${this.cardContainer?.querySelectorAll('.card-wrapper:not(.ddc-placeholder)').length || 0}</div>\n              </div>\n              <div style=\"margin-top:10px;display:flex;gap:8px;flex-wrap:wrap\">\n                <button class=\"btn\" id=\"testRoundtrip\"><ha-icon icon=\"mdi:sync\"></ha-icon><span style=\"margin-left:6px\">Test backend round-trip</span></button>\n                <button class=\"btn secondary\" id=\"exportJson\"><ha-icon icon=\"mdi:download\"></ha-icon><span style=\"margin-left:6px\">Export JSON</span></button>\n                <button class=\"btn secondary\" id=\"importJson\"><ha-icon icon=\"mdi:upload\"></ha-icon><span style=\"margin-left:6px\">Import JSON</span></button>\n                <button class=\"btn\" id=\"forceSave\"><ha-icon icon=\"mdi:content-save\"></ha-icon><span style=\"margin-left:6px\">Force save now</span></button>\n                <button class=\"btn secondary\" id=\"refreshKeys\"><ha-icon icon=\"mdi:refresh\"></ha-icon><span style=\"margin-left:6px\">Refresh backend keys</span></button>\n              </div>\n            </div>\n          </div>\n          <div class=\"section\" style=\"border:1px solid var(--divider-color);border-radius:12px;background:var(--card-background-color)\">\n            <div class=\"hd\" style=\"display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--divider-color);font-weight:600\">Logs (latest)</div>\n            <div class=\"bd\" id=\"logArea\" style=\"padding:12px;max-height:420px;overflow:auto\">${logsToHtml(this._dbgDump())}</div>\n          </div>\n        </div>\n      </div>`;\n\n    const close = () => modal.remove();\n    modal.querySelector('#closeDiag').addEventListener('click', close);\n    this.shadowRoot.appendChild(modal);\n\n    const refreshLogs = () => {\n      const logArea = modal.querySelector('#logArea');\n      const logsToHtmlLocal = (rows) => rows.slice(-200).map(r =>\n        `<div style=\"font-family:monospace;font-size:.85rem;line-height:1.3\">\n          <span style=\"opacity:.6\">${r.t}</span>\n          <b style=\"margin-left:6px;color:#03a9f4\">[${r.kind}]</b>\n          <span style=\"margin-left:6px\">${this._safe(r.msg)}</span>\n          ${r.extra ? `<pre style=\"margin:4px 0 0 0;white-space:pre-wrap;background:var(--card-background-color);border:1px solid var(--divider-color);border-radius:8px;padding:6px;max-height:160px;overflow:auto\">${this._safe(JSON.stringify(r.extra, null, 2))}</pre>` : ''}\n        </div>`\n      ).join('');\n      logArea.innerHTML = logsToHtmlLocal(this._dbgDump());\n      logArea.scrollTop = logArea.scrollHeight;\n    };\n\n    modal.querySelector('#refreshKeys').addEventListener('click', async () => {\n      try { this._dbgPush('probe', 'Manual refresh'); await this._probeBackend(); }\n      finally { refreshLogs(); }\n    });\n\n    modal.querySelector('#forceSave').addEventListener('click', async () => {\n      await this._saveLayout(false);\n      refreshLogs();\n    });\n\n    modal.querySelector('#exportJson').addEventListener('click', () => {\n      const wraps = Array.from(this.cardContainer.querySelectorAll('.card-wrapper:not(.ddc-placeholder)'));\n      const saved = wraps.map((w)=>{\n        const x = parseFloat(w.getAttribute('data-x')) || 0;\n        const y = parseFloat(w.getAttribute('data-y')) || 0;\n        const width  = parseFloat(w.style.width)  || w.getBoundingClientRect().width;\n        const height = parseFloat(w.style.height) || w.getBoundingClientRect().height;\n        const z = parseInt(w.style.zIndex || '1', 10);\n        const cardCfg = this._extractCardConfig(w.firstElementChild);\n        const tabId = w.dataset.tabId || this.defaultTab;\n        return { card: cardCfg, position:{x,y}, size:{width,height}, z, tabId };\n      });\n        const payload = {\n            version: 2,\n            options: this._exportableOptions(),\n            cards: saved\n        };\n      const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});\n      const a = document.createElement('a');\n      a.href = URL.createObjectURL(blob);\n      a.download = `ddc_${this.storageKey || 'layout'}.json`;\n      a.click();\n      URL.revokeObjectURL(a.href);\n    });\n\n    modal.querySelector('#importJson').addEventListener('click', async () => {\n      const inp = document.createElement('input');\n      inp.type = 'file'; inp.accept = 'application/json';\n      inp.onchange = async () => {\n        const file = inp.files?.[0]; if (!file) return;\n        const txt = await file.text();\n        try {\n          const json = JSON.parse(txt);\n          this._dbgPush('import', 'Loaded file', { bytes: txt.length });\n          this.cardContainer.innerHTML = '';\n          if (json.cards?.length) {\n            for (const conf of json.cards) {\n              if (!conf?.card || (typeof conf.card === 'object' && Object.keys(conf.card).length === 0)) {\n                const p = this._makePlaceholderAt(conf.position?.x||0, conf.position?.y||0, conf.size?.width||200, conf.size?.height||200);\n                this.cardContainer.appendChild(p);\n              } else {\n                const el = await this._createCard(conf.card);\n                const wrap = this._makeWrapper(el);\n                this._setCardPosition(wrap, conf.position?.x||0, conf.position?.y||0);\n            wrap.dataset.tabId = this._normalizeTabId(conf.tabId || conf.tab_id || this.defaultTab);\n            this._setCardPosition(wrap, conf.position?.x||0, conf.position?.y||0);\n                wrap.style.width = `${conf.size?.width||140}px`;\n                wrap.style.height= `${conf.size?.height||100}px`;\n                this.cardContainer.appendChild(wrap);\n                \n          try { this._rebuildOnce(wrap.firstElementChild); } catch {}\n          this._initCardInteract(wrap);\n              }\n            }\n          } else {\n            this._showEmptyPlaceholder();\n        this._applyAutoScale?.();\n          }\n          this._resizeContainer();\n          await this._saveLayout(false);\n        } catch (e) {\n          this._dbgPush('import', 'Parse failed', { error: String(e) });\n        }\n        const ev = new Event('ddc-logrefresh'); window.dispatchEvent(ev);\n      };\n      inp.click();\n    });\n\n    modal.querySelector('#testRoundtrip').addEventListener('click', async () => {\n      if (!this._backendOK) {\n        this._dbgPush('test', 'Backend not reachable, aborting');\n        return refreshLogs();\n      }\n      const key = (this.storageKey || 'ddc_test') + '_selftest';\n      const payload = { t: Date.now(), msg: 'roundtrip' };\n      try {\n        await this._saveLayoutToBackend(key, payload);\n        const back = await this._loadLayoutFromBackend(key);\n        this._dbgPush('test', 'Round-trip result', { wrote: payload, read: back });\n      } catch (e) {\n        this._dbgPush('test', 'Round-trip failed', { error: String(e) });\n      }\n      refreshLogs();\n    });\n\n    refreshLogs();\n  }\n\n\n  /* ------------------------ Dashboard Settings ------------------------ */\n  /**\n   * Opens a settings dialog allowing the user to configure dashboard\u2011wide\n   * options such as grid size, auto resize, animations and HA chrome\n   * visibility. The menu is designed to be simple and intuitive. Changes\n   * are applied when the user clicks Save.\n   */\n  _openDashboardSettings() {\n    // Build modal container\n    const modal = document.createElement('div');\n    modal.className = 'modal';\n    // Use the existing .dialog styles for consistent centering and sizing. Limit\n    // the maximum width so the settings sheet doesn't overwhelm the screen.\n    this._ensureSettingsStyles_();\n\n\n    \n    \nmodal.innerHTML = `\n<div class=\"dialog modern\" role=\"dialog\" aria-modal=\"true\">\n  <div class=\"dlg-head\">\n    <h3>Dashboard Settings</h3>\n    <button class=\"icon-btn\" id=\"ddc-settings-close\" title=\"Close\" aria-label=\"Close dialog\">\n      <ha-icon icon=\"mdi:close\"></ha-icon>\n    </button>\n  </div>\n\n  <div class=\"settings-body\">\n\n    <!-- Layout -->\n    <section class=\"card\" aria-labelledby=\"layout-head\">\n      <div class=\"section-head\">\n        <ha-icon icon=\"mdi:view-grid-plus-outline\" aria-hidden=\"true\"></ha-icon>\n        <h4 id=\"layout-head\">Layout</h4>\n      </div>\n      <p class=\"caption\">Control grid density, canvas sizing, and card behavior.</p>\n\n      <!-- GRID SIZE -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-grid-size\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:grid\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-grid-size\" for=\"ddc-setting-gridSize\">Grid size</label>\n          </div>\n          <div class=\"control\">\n            <div class=\"range-wrap\">\n              <input type=\"range\" id=\"ddc-setting-gridSize\" min=\"1\" max=\"400\" step=\"1\" />\n              <output id=\"ddc-grid-out\" for=\"ddc-setting-gridSize\">100 px</output>\n              <!-- Added number input for manual entry of grid size -->\n              <input type=\"number\" id=\"ddc-setting-gridSizeInput\" min=\"1\" max=\"400\" step=\"1\" class=\"grid-input\" />\n            </div>\n          </div>\n        </div>\n        <div class=\"hint\">Cards snap every <b>N</b> pixels. Lower values give a denser grid for finer placement.</div>\n      </div>\n\n      <!-- GRID PREVIEW -->\n      <div class=\"preview\">\n        <div class=\"grid-demo\" id=\"ddc-grid-demo\">\n          <div class=\"grid-meta-badge\" id=\"ddc-grid-meta\"></div>\n        </div>\n      </div>\n\n      <!-- QUICK CANVAS SIZES -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-quick-sizes\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:move-resize\" aria-hidden=\"true\"></ha-icon>\n            <span id=\"lbl-quick-sizes\">Quick canvas sizes</span>\n          </div>\n          <div class=\"control chips\" role=\"group\" aria-label=\"Quick sizes\">\n            <button class=\"chip\" data-w=\"1280\" data-h=\"720\">Tablet (1280\u00D7720)</button>\n            <button class=\"chip\" data-w=\"1920\" data-h=\"1080\" aria-pressed=\"true\">Desktop (1920\u00D71080)</button>\n            <button class=\"chip\" data-w=\"2560\" data-h=\"1440\">WQHD (2560\u00D71440)</button>\n          </div>\n        </div>\n        <div class=\"hint\">Applies a fixed custom canvas size instantly. Switch back to Dynamic or Preset below if needed.</div>\n      </div>\n\n      <!-- LIVE SNAP -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-live-snap\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:drag-variant\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-live-snap\" for=\"ddc-setting-dragSnap\">Live snap while dragging</label>\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-dragSnap\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">While dragging, cards snap to the nearest grid lines in real time.</div>\n      </div>\n\n      <!-- OVERLAP -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-prevent-overlap\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:animation\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-prevent-overlap\" for=\"ddc-setting-disableOverlap\">Prevent overlap</label>\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-disableOverlap\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Blocks placements that would overlap another card.</div>\n      </div>\n\n      <div class=\"divider\" role=\"separator\" aria-hidden=\"true\"></div>\n\n      <!-- SIZE MODE -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-size-mode\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:move-resize\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-size-mode\" for=\"ddc-setting-sizeMode\">Container size mode</label>\n          </div>\n          <div class=\"control\">\n            <select id=\"ddc-setting-sizeMode\">\n              <option value=\"dynamic\">Dynamic</option>\n              <option value=\"preset\">Preset</option>\n              <option value=\"auto\">Auto</option>\n              <option value=\"fixed_custom\">Fixed (custom)</option>\n            </select>\n          </div>\n        </div>\n        <div class=\"hint\">Dynamic fits the available space (reflows grid). Auto scales the whole grid to fit, preserving positions. Preset uses common screen sizes. Fixed lets you specify width &amp; height.</div>\n      </div>\n\n      <!-- SIZE EXTRAS (injected) -->\n      <div id=\"ddc-setting-sizeExtras\" class=\"setting\" aria-live=\"polite\"></div>\n\n      <!-- ORIENTATION -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-orientation\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:phone-rotate-landscape\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-orientation\" for=\"ddc-setting-orient\">Orientation</label>\n          </div>\n          <div class=\"control\">\n            <select id=\"ddc-setting-orient\">\n              <option value=\"auto\">Auto</option>\n              <option value=\"landscape\">Landscape</option>\n              <option value=\"portrait\">Portrait</option>\n            </select>\n          </div>\n        </div>\n        <div class=\"hint\">For presets and fixed sizes, choose a preferred orientation. Auto adapts to the screen.</div>\n      </div>\n\n      <div class=\"divider\" role=\"separator\" aria-hidden=\"true\"></div>\n\n      <!-- AUTOSAVE -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-autosave\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:content-save\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-autosave\" for=\"ddc-setting-autoSave\">Auto save</label>\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-autoSave\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Automatically persist layout changes after you drag or edit.</div>\n      </div>\n\n      <!-- AUTOSAVE DELAY -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-autosave-delay\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:timer-outline\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-autosave-delay\" for=\"ddc-setting-autoSaveDebounce\">Auto save delay (ms)</label>\n          </div>\n          <div class=\"control\">\n            <input type=\"number\" id=\"ddc-setting-autoSaveDebounce\" min=\"100\" max=\"10000\" step=\"50\" />\n          </div>\n        </div>\n        <div class=\"hint\">Wait time after the last change before saving. Lower = more frequent saves.</div>\n      </div>\n\n      <!-- EDIT MODE PIN/PASSWORD -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-edit-pin\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:lock-outline\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-edit-pin\" for=\"ddc-setting-editPin\">Edit mode PIN / password</label>\n          </div>\n          <div class=\"control\">\n            <input type=\"password\" id=\"ddc-setting-editPin\" placeholder=\"Leave blank to disable\" />\n          </div>\n        </div>\n        <div class=\"hint\">If set, this code is required to enter Edit Mode.</div>\n      </div>\n    </section>\n\n    <!-- Appearance -->\n    <section class=\"card\" aria-labelledby=\"appearance-head\">\n      <div class=\"section-head\">\n        <ha-icon icon=\"mdi:palette-swatch\" aria-hidden=\"true\"></ha-icon>\n        <h4 id=\"appearance-head\">Appearance</h4>\n      </div>\n      <p class=\"caption\">Choose backgrounds and colors. Use theme vars like <code>var(--ha-card-background)</code>.</p>\n\n      <!-- CONTAINER BG -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-container-bg\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:palette-swatch\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-container-bg\" for=\"ddc-setting-containerBg\">Container background</label>\n          </div>\n            <div class=\"control\">\n              <div class=\"stack color-stack\">\n                <div class=\"color-group\">\n                  <div class=\"color-group-title\">\n                    <span>Custom</span>\n                    <span>hex \u00B7 rgba \u00B7 var()</span>\n                  </div>\n                  <div class=\"color-pair\">\n                    <input type=\"color\" id=\"ddc-color-containerBg\" />\n                    <input\n                      type=\"text\"\n                      id=\"ddc-setting-containerBg\"\n                      placeholder=\"transparent \u00B7 #123456 \u00B7 var(--ha-card-background)\"\n                    />\n                  </div>\n                </div>\n\n                <div class=\"color-group\">\n                  <div class=\"color-group-title\">\n                    <span>Presets</span>\n                  </div>\n                  <div class=\"swatches\" id=\"ddc-swatches-containerBg\"></div>\n                  <div class=\"gradients\" id=\"ddc-gradients-containerBg\"></div>\n                </div>\n              </div>\n            </div>\n\n        </div>\n        <div class=\"hint\">Accepts plain colors or theme variables.</div>\n      </div>\n\n      <!-- CARD BG -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-card-bg\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:palette-swatch\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-card-bg\" for=\"ddc-setting-cardBg\">Card background</label>\n          </div>\n          <div class=\"control\">\n            <div class=\"stack color-stack\">\n              <div class=\"color-group\">\n                <div class=\"color-group-title\">\n                  <span>Custom</span>\n                </div>\n                <div class=\"color-pair\">\n                  <input type=\"color\" id=\"ddc-color-cardBg\" />\n                  <input\n                    type=\"text\"\n                    id=\"ddc-setting-cardBg\"\n                    placeholder=\"#121212 \u00B7 var(--ha-card-background)\"\n                  />\n                </div>\n              </div>\n\n              <div class=\"color-group\">\n                <div class=\"color-group-title\">\n                  <span>Presets</span>\n                </div>\n                <div class=\"swatches\" id=\"ddc-swatches-cardBg\"></div>\n                <div class=\"gradients\" id=\"ddc-gradients-cardBg\"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"hint\">Affects the background of each draggable card container.</div>\n      </div>\n\n      <!-- CARD SHADOW -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-card-shadow\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:shadow\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-card-shadow\" for=\"ddc-setting-cardShadow\">Card drop shadow</label>\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-cardShadow\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Toggle a drop shadow on card containers.</div>\n      </div>\n\n      <div class=\"divider\" role=\"separator\" aria-hidden=\"true\"></div>\n\n      <!-- BACKGROUND MODE -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-bg-mode\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:layers-triple\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-bg-mode\" for=\"ddc-bg-mode\">Background type</label>\n          </div>\n          <div class=\"control\">\n            <select id=\"ddc-bg-mode\">\n              <option value=\"none\">None</option>\n              <option value=\"image\">Image</option>\n              <option value=\"particles\">Animated (particles.js)</option>\n              <option value=\"youtube\">YouTube video</option>\n            </select>\n          </div>\n        </div>\n        <div class=\"hint\">Choose what renders behind your cards.</div>\n      </div>\n\n      <!-- BACKGROUND: IMAGE -->\n      <div class=\"setting\" data-bg-section=\"image\" role=\"group\" aria-labelledby=\"lbl-bg-image\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:image-outline\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-bg-image\" for=\"ddc-setting-bgImg\">Background image</label>\n          </div>\n          <div class=\"control\">\n            <div class=\"stack\">\n              <div class=\"input-file\">\n                <label class=\"file-btn\" for=\"ddc-file-bg\">Upload image</label>\n                <input id=\"ddc-file-bg\" type=\"file\" accept=\"image/*\" />\n                <div class=\"thumb\" id=\"ddc-bg-thumb\"></div>\n                <button type=\"button\" class=\"btn secondary\" id=\"ddc-clear-bg\">Delete</button>\n              </div>\n\n              <div class=\"row\">\n                <label for=\"ddc-setting-bgImg\">or URL</label>\n                <input type=\"text\" id=\"ddc-setting-bgImg\" placeholder=\"https://\u2026 or /local/\u2026\" />\n              </div>\n\n              <div class=\"bg-opts\">\n                <label for=\"ddc-bg-repeat\"><ha-icon icon=\"mdi:repeat\"></ha-icon> Repeat</label>\n                <select id=\"ddc-bg-repeat\">\n                  <option value=\"no-repeat\">No repeat</option>\n                  <option value=\"repeat\">Repeat</option>\n                  <option value=\"repeat-x\">Repeat X</option>\n                  <option value=\"repeat-y\">Repeat Y</option>\n                </select>\n\n                <label for=\"ddc-bg-size\"><ha-icon icon=\"mdi:arrow-expand-all\"></ha-icon> Size</label>\n                <select id=\"ddc-bg-size\">\n                  <option value=\"cover\">Cover</option>\n                  <option value=\"contain\">Contain</option>\n                  <option value=\"auto\">Auto</option>\n                  <option value=\"100% 100%\">Fill (stretch)</option>\n                </select>\n\n                <label for=\"ddc-bg-position\"><ha-icon icon=\"mdi:crosshairs-gps\"></ha-icon> Position</label>\n                <select id=\"ddc-bg-position\">\n                  <option value=\"center center\">Center</option>\n                  <option value=\"top center\">Top</option>\n                  <option value=\"bottom center\">Bottom</option>\n                  <option value=\"left center\">Left</option>\n                  <option value=\"right center\">Right</option>\n                  <option value=\"top left\">Top left</option>\n                  <option value=\"top right\">Top right</option>\n                  <option value=\"bottom left\">Bottom left</option>\n                  <option value=\"bottom right\">Bottom right</option>\n                </select>\n\n                <label for=\"ddc-bg-attachment\"><ha-icon icon=\"mdi:pin\"></ha-icon> Attachment</label>\n                <select id=\"ddc-bg-attachment\">\n                  <option value=\"scroll\">Scroll</option>\n                  <option value=\"fixed\">Fixed</option>\n                </select>\n\n                <label for=\"ddc-bg-opacity\"><ha-icon icon=\"mdi:opacity\"></ha-icon> Opacity</label>\n                <div class=\"range-wrap\">\n                  <input type=\"range\" id=\"ddc-bg-opacity\" min=\"0\" max=\"100\" step=\"1\" />\n                  <output id=\"ddc-bg-opacity-out\">100%</output>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"hint\">Uploads are saved inline as data-URLs. For large files, host under <code>/local/</code> and paste the URL.</div>\n      </div>\n\n      <!-- BACKGROUND: PARTICLES -->\n      <div class=\"setting\" data-bg-section=\"particles\" role=\"group\" aria-labelledby=\"lbl-bg-particles\" hidden>\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:blur\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-bg-particles\" for=\"ddc-particles-url\">Particles.js</label>\n          </div>\n          <div class=\"control\">\n            <div class=\"stack\">\n              <label for=\"ddc-particles-url\">Config JSON URL (optional)</label>\n              <input type=\"text\" id=\"ddc-particles-url\" placeholder=\"/local/particles.json or https://\u2026\" />\n              <div class=\"hint\">If empty, a sensible default is used. For HACS, prefer hosting the library + JSON under <code>/config/www</code> (served as <code>/local/\u2026</code>).</div>\n\n              <label class=\"row\" for=\"ddc-particles-pointer\" style=\"gap:8px\">\n                <ha-switch id=\"ddc-particles-pointer\"></ha-switch>\n                <span>Enable pointer interactivity (hover/click)</span>\n              </label>\n              <div class=\"hint\">Leave off if you want guaranteed unobstructed dragging.</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- BACKGROUND: YOUTUBE -->\n      <div class=\"setting\" data-bg-section=\"youtube\" role=\"group\" aria-labelledby=\"lbl-bg-youtube\" hidden>\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:youtube\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-bg-youtube\" for=\"ddc-youtube-url\">YouTube background</label>\n          </div>\n          <div class=\"control\">\n                      <div class=\"control\">\n            <div class=\"stack\">\n              <label for=\"ddc-youtube-url\">YouTube URL or video ID</label>\n              <input\n                type=\"text\"\n                id=\"ddc-youtube-url\"\n                placeholder=\"https://youtu.be/\u2026 or dQw4w9WgXcQ\"\n              />\n\n              <div class=\"bg-opts bg-opts--youtube\">\n                <!-- Start -->\n                <label for=\"ddc-youtube-start\">\n                  <ha-icon icon=\"mdi:clock-start\" aria-hidden=\"true\"></ha-icon>\n                  Start (s)\n                </label>\n                <input\n                  type=\"number\"\n                  id=\"ddc-youtube-start\"\n                  min=\"0\"\n                  step=\"1\"\n                />\n\n                <!-- End -->\n                <label for=\"ddc-youtube-end\">\n                  <ha-icon icon=\"mdi:clock-end\" aria-hidden=\"true\"></ha-icon>\n                  End (s)\n                </label>\n                <input\n                  type=\"number\"\n                  id=\"ddc-youtube-end\"\n                  min=\"0\"\n                  step=\"1\"\n                />\n\n                <!-- Mute -->\n                <label for=\"ddc-youtube-mute\">\n                  <ha-icon icon=\"mdi:volume-off\" aria-hidden=\"true\"></ha-icon>\n                  Mute\n                </label>\n                <ha-switch\n                  id=\"ddc-youtube-mute\"\n                  checked\n                ></ha-switch>\n\n                <!-- Loop -->\n                <label for=\"ddc-youtube-loop\">\n                  <ha-icon icon=\"mdi:repeat\" aria-hidden=\"true\"></ha-icon>\n                  Loop\n                </label>\n                <ha-switch\n                  id=\"ddc-youtube-loop\"\n                  checked\n                ></ha-switch>\n\n                <!-- Size -->\n                <label for=\"ddc-youtube-size\">\n                  <ha-icon icon=\"mdi:arrow-expand-all\" aria-hidden=\"true\"></ha-icon>\n                  Size\n                </label>\n                <select id=\"ddc-youtube-size\">\n                  <option value=\"cover\">Cover</option>\n                  <option value=\"contain\">Contain</option>\n                  <option value=\"auto\">Auto</option>\n                  <option value=\"100% 100%\">Fill (stretch)</option>\n                </select>\n\n                <!-- Position -->\n                <label for=\"ddc-youtube-position\">\n                  <ha-icon icon=\"mdi:crosshairs-gps\" aria-hidden=\"true\"></ha-icon>\n                  Position\n                </label>\n                <select id=\"ddc-youtube-position\">\n                  <option value=\"top left\">Top left</option>\n                  <option value=\"top\">Top</option>\n                  <option value=\"top right\">Top right</option>\n                  <option value=\"left\">Left</option>\n                  <option value=\"center\">Center</option>\n                  <option value=\"right\">Right</option>\n                  <option value=\"bottom left\">Bottom left</option>\n                  <option value=\"bottom\">Bottom</option>\n                  <option value=\"bottom right\">Bottom right</option>\n                </select>\n\n                <!-- Attachment -->\n                <label for=\"ddc-youtube-attachment\">\n                  <ha-icon icon=\"mdi:link-variant\" aria-hidden=\"true\"></ha-icon>\n                  Attachment\n                </label>\n                <select id=\"ddc-youtube-attachment\">\n                  <option value=\"scroll\">Scroll</option>\n                  <option value=\"fixed\">Fixed</option>\n                </select>\n\n                <!-- Opacity -->\n                <label for=\"ddc-youtube-opacity\">\n                  <ha-icon icon=\"mdi:opacity\" aria-hidden=\"true\"></ha-icon>\n                  Opacity\n                </label>\n                <div class=\"range-wrap\">\n                  <input\n                    type=\"range\"\n                    id=\"ddc-youtube-opacity\"\n                    min=\"0\"\n                    max=\"100\"\n                    step=\"1\"\n                    value=\"100\"\n                  />\n                  <output id=\"ddc-youtube-opacity-out\">100%</output>\n                </div>\n              </div>\n\n              <div class=\"hint\">\n                Video plays muted, sits behind your cards, and ignores pointer events so dragging remains smooth.\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <!-- Behaviour -->\n    <section class=\"card\" aria-labelledby=\"behaviour-head\">\n      <div class=\"section-head\">\n        <ha-icon icon=\"mdi:tune\" aria-hidden=\"true\"></ha-icon>\n        <h4 id=\"behaviour-head\">Behaviour</h4>\n      </div>\n      <p class=\"caption\">Animation, logging, and Home Assistant chrome visibility.</p>\n\n      <!-- ANIMATE -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-animate\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:play-box\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-animate\" for=\"ddc-setting-animate\">Animate cards</label>\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-animate\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Smooth transitions when moving and resizing cards.</div>\n      </div>\n\n      <!-- DEBUG -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-debug\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:bug-play-outline\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-debug\" for=\"ddc-setting-debug\">Enable debug logging</label>\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-debug\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Extra console logs for troubleshooting layout issues.</div>\n      </div>\n\n      <!-- HIDE HEADER -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-hide-hdr\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:page-layout-header\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-hide-hdr\" for=\"ddc-setting-hideHdr\">Hide HA Header</label>\n            <!-- Removed thumbs up/down icon -->\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-hideHdr\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Removes the top app bar (Search / Assist / Edit). It auto-shows in Edit mode.</div>\n      </div>\n\n      <!-- HIDE SIDEBAR -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-hide-sbar\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:page-layout-sidebar-left\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-hide-sbar\" for=\"ddc-setting-hideSbar\">Hide HA Sidebar</label>\n            <!-- Removed thumbs up/down icon -->\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-hideSbar\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Hides the left navigation drawer to maximize canvas space.</div>\n      </div>\n    </section>\n\n    <!-- Screen Saver -->\n    <section class=\"card\" aria-labelledby=\"screensaver-head\">\n      <div class=\"section-head\">\n        <ha-icon icon=\"mdi:clock-outline\" aria-hidden=\"true\"></ha-icon>\n        <h4 id=\"screensaver-head\">Screen saver</h4>\n      </div>\n      <p class=\"caption\">Show a digital clock after inactivity.</p>\n\n      <!-- Enable -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-ss-enable\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:power\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-ss-enable\" for=\"ddc-setting-screenSaverEnabled\">Enable screen saver</label>\n          </div>\n          <div class=\"control\">\n            <ha-switch id=\"ddc-setting-screenSaverEnabled\"></ha-switch>\n          </div>\n        </div>\n        <div class=\"hint\">Activate a screen saver overlay with time and date.</div>\n      </div>\n\n      <!-- Delay -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-ss-delay\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:timer-outline\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-ss-delay\" for=\"ddc-setting-screenSaverDelay\">Activation delay</label>\n          </div>\n          <div class=\"control\">\n            <div class=\"range-wrap\">\n              <input type=\"number\" id=\"ddc-setting-screenSaverDelay\" min=\"1\" max=\"60\" step=\"1\" />\n              <span class=\"unit\">min</span>\n            </div>\n          </div>\n        </div>\n        <div class=\"hint\">Delay (in minutes) before the screen saver activates.</div>\n      </div>\n    </section>\n\n    <!-- Tabs -->\n    <section class=\"card tabs-card\" aria-labelledby=\"tabs-head\">\n      <div class=\"section-head\">\n        <ha-icon icon=\"mdi:tab\" aria-hidden=\"true\"></ha-icon>\n        <h4 id=\"tabs-head\">Tabs</h4>\n      </div>\n      <p class=\"caption\">Create, rename, delete, and choose the default tab. Cards use <code>tabId</code> to decide where they appear.</p>\n\n      <!-- Current tabs list -->\n      <div id=\"ddc-tabs-list\" class=\"setting\" aria-live=\"polite\"></div>\n\n      <!-- Add new tab -->\n      <div class=\"setting\" role=\"group\" aria-labelledby=\"lbl-add-tab\">\n        <div class=\"row\">\n          <div class=\"title\">\n            <ha-icon icon=\"mdi:tab-plus\" aria-hidden=\"true\"></ha-icon>\n            <label id=\"lbl-add-tab\" for=\"ddc-new-tab-name\">Add tab</label>\n          </div>\n          <div class=\"control\">\n            <div class=\"row\">\n              <input type=\"text\" id=\"ddc-new-tab-name\" placeholder=\"e.g. Lights\" class=\"grow\" />\n              <button class=\"btn primary\" id=\"ddc-add-tab-btn\">Add</button>\n            </div>\n          </div>\n        </div>\n        <div class=\"hint\">Tab IDs must be unique. The label defaults to the ID if left empty.</div>\n      </div>\n    </section>\n\n  </div>\n\n  <div class=\"footer\">\n    <button class=\"btn secondary\" id=\"ddc-settings-cancel\">Cancel</button>\n    <button class=\"btn primary\" id=\"ddc-settings-save\">Save</button>\n  </div>\n</div>\n\n`;\n\n    // Only allow one modal at a time across the card. If any modal exists in\n    // the shadow root (including other DDC modals), remove it before\n    // opening the settings. This prevents overlapping dialog layers.\n    const existingModal = this.shadowRoot.querySelector('.modal');\n    if (existingModal) {\n      try { existingModal.remove(); } catch {}\n      // clear any stored references\n      if (this.__settingsModal === existingModal) this.__settingsModal = null;\n    }\n\n    // If a previous settings modal specifically exists, remove it as well\n    if (this.__settingsModal) {\n      try { this.__settingsModal.remove(); } catch {}\n      this.__settingsModal = null;\n    }\n    // Append to our own shadow root so built-in .modal styles apply and centering works\n    this.__settingsModal = modal;\n    this.shadowRoot.appendChild(modal);\n\n    // Prepopulate current settings\n    const chkAuto    = modal.querySelector('#ddc-setting-autoResize');\n    const inpGrid    = modal.querySelector('#ddc-setting-gridSize');\n\n    const chkAnim    = modal.querySelector('#ddc-setting-animate');\n    const chkHdr     = modal.querySelector('#ddc-setting-hideHdr');\n    const chkBar     = modal.querySelector('#ddc-setting-hideSbar');\n    const chkSnap    = modal.querySelector('#ddc-setting-dragSnap');\n    const chkASave   = modal.querySelector('#ddc-setting-autoSave');\n    const inpDeb     = modal.querySelector('#ddc-setting-autoSaveDebounce');\n    const selSize    = modal.querySelector('#ddc-setting-sizeMode');\n    const selOrient  = modal.querySelector('#ddc-setting-orient');\n    const chkOverlap = modal.querySelector('#ddc-setting-disableOverlap');\n    const inpEditPin = modal.querySelector('#ddc-setting-editPin');\n    const inpCBg     = modal.querySelector('#ddc-setting-containerBg');\n    const inpCardBg  = modal.querySelector('#ddc-setting-cardBg');\n    const chkShadow  = modal.querySelector('#ddc-setting-cardShadow');\n    const inpBgImg   = modal.querySelector('#ddc-setting-bgImg');\n    const selBgRepeat     = modal.querySelector('#ddc-bg-repeat');\n    const selBgSize       = modal.querySelector('#ddc-bg-size');\n    const selBgPosition   = modal.querySelector('#ddc-bg-position');\n    const selBgAttachment = modal.querySelector('#ddc-bg-attachment');\n    const rngBgOpacity    = modal.querySelector('#ddc-bg-opacity');\n    const outBgOpacity    = modal.querySelector('#ddc-bg-opacity-out');\n    const chkDebug   = modal.querySelector('#ddc-setting-debug');\n\n    // Screen saver controls\n    const chkScreenSaver   = modal.querySelector('#ddc-setting-screenSaverEnabled');\n    const rngScreenDelay   = modal.querySelector('#ddc-setting-screenSaverDelay');\n    const outScreenDelay   = modal.querySelector('#ddc-screenSaverDelayOut');\n\n    const selBgMode           = modal.querySelector('#ddc-bg-mode');\n    const secImg              = modal.querySelector('[data-bg-section=\"image\"]');\n    const secParticles        = modal.querySelector('[data-bg-section=\"particles\"]');\n    const secYoutube          = modal.querySelector('[data-bg-section=\"youtube\"]');\n    const inpParticlesUrl     = modal.querySelector('#ddc-particles-url');\n    const chkParticlesPointer = modal.querySelector('#ddc-particles-pointer');\n    const inpYtUrl            = modal.querySelector('#ddc-youtube-url');\n    const inpYtStart          = modal.querySelector('#ddc-youtube-start');\n    const inpYtEnd            = modal.querySelector('#ddc-youtube-end');\n    const chkYtMute           = modal.querySelector('#ddc-youtube-mute');\n    const chkYtLoop           = modal.querySelector('#ddc-youtube-loop');\n    const selYtSize           = modal.querySelector('#ddc-youtube-size');\n    const selYtPosition       = modal.querySelector('#ddc-youtube-position');\n    const selYtAttachment     = modal.querySelector('#ddc-youtube-attachment');\n    const rngYtOpacity       = modal.querySelector('#ddc-youtube-opacity');\n    const outYtOpacity       = modal.querySelector('#ddc-youtube-opacity-out');\n\n    // hero image and tabs position are intentionally omitted from the settings UI\n\n    const bgCfg = (this._config?.background_image) || {};\n\n    const bgMode = (this._config?.background_mode)\n      || (this._config?.background_image?.src ? 'image' : 'none');\n    if (selBgMode) selBgMode.value = String(bgMode);\n\n    const pCfg = this._config?.background_particles || {};\n    if (inpParticlesUrl)     inpParticlesUrl.value = pCfg.config_url || '';\n    if (chkParticlesPointer) chkParticlesPointer.checked = !!pCfg.pointer_events;\n\n    const yCfg = this._config?.background_youtube || {};\n    const ytStr = yCfg.url || yCfg.video_id || '';\n    if (inpYtUrl)   inpYtUrl.value = ytStr;\n    if (inpYtStart) inpYtStart.value = (yCfg.start ?? '');\n    if (inpYtEnd)   inpYtEnd.value   = (yCfg.end   ?? '');\n    if (chkYtMute)  chkYtMute.checked = (yCfg.mute !== false);\n    if (chkYtLoop)  chkYtLoop.checked = (yCfg.loop !== false);\n    if (selYtSize) selYtSize.value = String(yCfg.size || 'cover');\n    if (selYtPosition) selYtPosition.value = String(yCfg.position || 'center');\n    if (selYtAttachment) selYtAttachment.value = String(yCfg.attachment || 'scroll');\n    if (rngYtOpacity) {\n      const ypct = Math.round((yCfg.opacity != null ? yCfg.opacity : 1) * 100);\n      rngYtOpacity.value = String(ypct);\n      if (outYtOpacity) outYtOpacity.textContent = ypct + '%';\n      rngYtOpacity.addEventListener('input', () => {\n        const v = Math.max(0, Math.min(100, parseInt(rngYtOpacity.value || '100', 10)));\n        if (outYtOpacity) outYtOpacity.textContent = v + '%';\n      });\n    }\n\n\n    // show/hide sections based on mode\n    const showBgSections = () => {\n      const m = selBgMode?.value || 'none';\n      if (secImg)       secImg.style.display       = (m === 'image')     ? '' : 'none';\n      if (secParticles) secParticles.style.display = (m === 'particles') ? '' : 'none';\n      if (secYoutube)   secYoutube.style.display   = (m === 'youtube')   ? '' : 'none';\n    };\n    selBgMode?.addEventListener('change', showBgSections);\n    showBgSections();\n    // Hide auto-resize setting when the container size mode is not dynamic\n    const secAutoResize = modal.querySelector('[aria-labelledby=\"lbl-auto-resize\"]');\n    const updateAutoResizeVisibility = () => {\n      const mode = selSize?.value || 'dynamic';\n      if (secAutoResize) secAutoResize.style.display = (mode === 'dynamic') ? '' : 'none';\n    };\n    updateAutoResizeVisibility();\n    selSize?.addEventListener('change', updateAutoResizeVisibility);\n\n    if (chkAuto)    chkAuto.checked    = !!this.autoResizeCards;\n    if (inpGrid)    inpGrid.value      = String(this.gridSize || 100);\n    if (chkAnim)    chkAnim.checked    = !!this.animateCards;\n    if (chkHdr)     chkHdr.checked     = !!this.hideHaHeader;\n    if (chkBar)     chkBar.checked     = !!this.hideHaSidebar;\n    if (chkSnap)    chkSnap.checked    = !!this.dragLiveSnap;\n    if (chkASave)   chkASave.checked   = !!this.autoSave;\n    if (inpDeb)     inpDeb.value       = String(this.autoSaveDebounce ?? 800);\n    if (selSize)    selSize.value      = String(this.containerSizeMode || 'dynamic');\n    if (selOrient)  selOrient.value    = String(this.containerPresetOrient || 'auto');\n    if (chkOverlap) chkOverlap.checked = !!this.disableOverlap;\n    if (inpCBg)     inpCBg.value       = String(this.containerBackground || '');\n    if (inpCardBg)  inpCardBg.value    = String(this.cardBackground || '');\n    if (inpBgImg)   {\n      const bgObj = (this._config?.background_image ?? this._config?.bg_image) || {};\n      inpBgImg.value = bgObj.src ? String(bgObj.src) : '';\n    }\n    if (chkDebug)   chkDebug.checked   = !!this.debug;\n    // Initialize the drop shadow toggle\n    if (chkShadow)  chkShadow.checked  = !!this.cardShadowEnabled;\n    if (selBgRepeat)     selBgRepeat.value     = String(bgCfg.repeat     || 'no-repeat');\n    if (selBgSize)       selBgSize.value       = String(bgCfg.size       || 'cover');\n    if (selBgPosition)   selBgPosition.value   = String(bgCfg.position   || 'center center');\n    if (selBgAttachment) selBgAttachment.value = String(bgCfg.attachment || 'scroll');\n    if (rngBgOpacity) {\n      const pct = Math.round((bgCfg.opacity != null ? bgCfg.opacity : 1) * 100);\n      rngBgOpacity.value = String(pct);\n      if (outBgOpacity) outBgOpacity.textContent = `${pct}%`;\n      rngBgOpacity.addEventListener('input', () => {\n        const v = Math.max(0, Math.min(100, parseInt(rngBgOpacity.value || '100', 10)));\n        outBgOpacity.textContent = `${v}%`;\n        // Live preview without waiting for Save\n        this.style.setProperty('--ddc-bg-opacity', String(v/100));\n      });\n    }\n\n    // Live update drop shadow when the toggle is changed\n    if (chkShadow) {\n      chkShadow.addEventListener('change', () => {\n        try {\n          if (chkShadow.checked) {\n            // Use a more prominent drop shadow on toggle\n            this.style.setProperty('--ddc-card-shadow', '0 8px 24px rgba(0,0,0,.35)');\n          } else {\n            this.style.removeProperty('--ddc-card-shadow');\n          }\n        } catch {}\n      });\n    }\n\n    // ===== Screen saver UI =====\n    // Prepopulate current value and bind live changes\n    if (chkScreenSaver) {\n      chkScreenSaver.checked = !!this.screenSaverEnabled;\n      chkScreenSaver.addEventListener('change', () => {\n        this.screenSaverEnabled = chkScreenSaver.checked;\n        if (typeof this._updateScreensaverSettings === 'function') this._updateScreensaverSettings();\n      });\n    }\n    if (rngScreenDelay) {\n      // determine minutes from current delay (ms)\n      const ms = this.screenSaverDelay != null ? Number(this.screenSaverDelay) : (5 * 60000);\n      let mins = Math.round(ms / 60000);\n      if (!Number.isFinite(mins) || mins < 1) mins = 5;\n      if (mins > 60) mins = 60;\n      rngScreenDelay.value = String(mins);\n      if (outScreenDelay) outScreenDelay.textContent = `${mins} min`;\n      rngScreenDelay.addEventListener('input', () => {\n        const v = parseInt(rngScreenDelay.value || '1', 10);\n        const m = Math.max(1, Math.min(60, isNaN(v) ? 1 : v));\n        if (outScreenDelay) outScreenDelay.textContent = `${m} min`;\n        this.screenSaverDelay = m * 60000;\n        if (typeof this._updateScreensaverSettings === 'function') this._updateScreensaverSettings();\n      });\n    }\n\n\n    // ===== UI polish hooks =====\n  \n    // Prepopulate Edit PIN \u2014 UI value always wins over YAML\n    // Prepopulate Edit PIN \u2014 UI value wins for display too\n    try {\n      if (inpEditPin) {\n        const yamlPin = (this.config && this.config.edit_mode_pin != null) ? String(this.config.edit_mode_pin) : '';\n        const uiPin   = (this.editModePin != null) ? String(this.editModePin) : '';\n        inpEditPin.value = uiPin || yamlPin || '';\n        inpEditPin.disabled = false;   // ensure editable\n        inpEditPin.readOnly = false;   // ensure editable\n      }\n    } catch {}\n\n    const gridSlider = modal.querySelector('#ddc-setting-gridSize');\n    const gridOut    = modal.querySelector('#ddc-grid-out');\n    const gridDemo   = modal.querySelector('#ddc-grid-demo');\n    const gridMeta   = modal.querySelector('#ddc-grid-meta');\n    // Reference to the manual grid size input (number field)\n    const gridInput  = modal.querySelector('#ddc-setting-gridSizeInput');\n\n    const renderMeta = () => {\n      if (!gridDemo || !gridMeta) return;\n      const rect = gridDemo.getBoundingClientRect();\n      const cell = Math.max(1, parseInt(gridSlider.value || '100', 10));\n      const cols = Math.max(1, Math.floor(rect.width  / cell));\n      const rows = Math.max(1, Math.floor(rect.height / cell));\n      gridMeta.innerHTML = `\n        <ha-icon icon=\"mdi:grid\"></ha-icon>\n        <span>${cell}px \u00B7 ${cols}\u00D7${rows}</span>\n      `;\n    };\n\n    const syncGrid = () => {\n      const v = Math.max(1, parseInt(gridSlider.value || '100', 10));\n      if (gridOut)  gridOut.textContent = `${v} px`;\n      if (gridDemo) gridDemo.style.setProperty('--g', `${v}px`);\n      renderMeta();\n    };\n\n    // Init + live update on input\n    if (gridSlider) {\n      if (!gridSlider.value) gridSlider.value = String(this.gridSize || 100);\n      gridSlider.addEventListener('input', () => {\n        // Keep the numeric input in sync with the slider\n        if (gridInput) gridInput.value = gridSlider.value;\n        syncGrid();\n      });\n      // Prepopulate the corresponding number input\n      if (gridInput) gridInput.value = gridSlider.value;\n      syncGrid();\n    }\n\n    // Listen to manual grid number changes\n    if (gridInput) {\n      gridInput.addEventListener('input', () => {\n        const v = Math.max(1, Math.min(400, parseInt(gridInput.value || '100', 10)));\n        gridSlider.value = String(v);\n        syncGrid();\n      });\n    }\n\n    // Recompute rows\u00D7cols when the demo box changes size (responsive dialog)\n    if (gridDemo) {\n      const ro = new ResizeObserver(() => renderMeta());\n      ro.observe(gridDemo);\n      // remember to clean up when the modal closes\n      this.__ddcGridRO?.disconnect?.();\n      this.__ddcGridRO = ro;\n    }\n\n    // Quick size chips\n    modal.querySelectorAll('.chip').forEach(ch => {\n      ch.addEventListener('click', () => {\n        modal.querySelectorAll('.chip').forEach(c => c.setAttribute('aria-pressed','false'));\n        ch.setAttribute('aria-pressed','true');\n        const w = parseInt(ch.dataset.w, 10);\n        const h = parseInt(ch.dataset.h, 10);\n        const sizeSel = modal.querySelector('#ddc-setting-sizeMode');\n        sizeSel.value = 'fixed_custom';\n      (typeof selSize !== 'undefined' && selSize)?.dispatchEvent?.(new Event('change'));\n        setTimeout(() => {\n          modal.querySelector('#ddc-setting-custW')?.setAttribute('value', String(w));\n          modal.querySelector('#ddc-setting-custW')?.dispatchEvent?.(new Event('change'));\n          const inpW = modal.querySelector('#ddc-setting-custW'); if (inpW) inpW.value = String(w);\n          const inpH = modal.querySelector('#ddc-setting-custH'); if (inpH) inpH.value = String(h);\n        }, 0);\n      });\n    });\n\n    // Swatches (theme-friendly set; tweak as you like)\n    const SWATCHES = [\n      '#ffffff','#f5f7fa','#ebeff5','#121212','#1f2937','#334155',\n      '#ff6b6b','#fcbf49','#ffe66d','#4ecdc4','#1a535c','#6b5b95',\n      '#f6f5f5','#00aaff','#ff00ff','#00ff00',\n      'var(--card-background-color)','var(--ha-card-background)','transparent',\n      /* Semi\u2011transparent glass\u2011like presets */\n      'rgba(255,255,255,0.4)', 'rgba(0,0,0,0.3)', 'rgba(0,128,255,0.3)',\n      'rgba(255,0,128,0.3)', 'rgba(255,255,0,0.3)', 'rgba(0,255,128,0.3)'\n    ];\n    const buildSwatches = (containerSel, targetInputSel, targetPickerSel) => {\n      const wrap = modal.querySelector(containerSel);\n      const target = modal.querySelector(targetInputSel);\n      const picker = modal.querySelector(targetPickerSel);\n      if (!wrap || !target) return;\n      wrap.innerHTML = '';\n      SWATCHES.forEach((val, i) => {\n        const s = document.createElement('button');\n        s.type = 'button';\n        s.className = 'swatch';\n        s.title = val;\n        s.style.background = val.startsWith('var(') ? getComputedStyle(this).getPropertyValue(val.slice(4,-1)).trim() || '#fff' : val;\n        s.setAttribute('aria-pressed','false');\n        s.addEventListener('click', () => {\n          wrap.querySelectorAll('.swatch').forEach(x => x.setAttribute('aria-pressed','false'));\n          s.setAttribute('aria-pressed','true');\n          target.value = val;\n          if (/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(val) && picker) picker.value = val;\n          // Trigger input event so live preview updates for container/card background\n          try { target.dispatchEvent(new Event('input', { bubbles: true, composed: true })); } catch {}\n        });\n        wrap.appendChild(s);\n        // preselect current value if matches\n        if (String(target.value).trim() === val) s.setAttribute('aria-pressed','true');\n      });\n    };\n    buildSwatches('#ddc-swatches-containerBg', '#ddc-setting-containerBg', '#ddc-color-containerBg');\n    buildSwatches('#ddc-swatches-cardBg', '#ddc-setting-cardBg', '#ddc-color-cardBg');\n\n    // Color pickers keep in sync with text inputs\n    [['#ddc-color-containerBg','#ddc-setting-containerBg'], ['#ddc-color-cardBg','#ddc-setting-cardBg']]\n      .forEach(([pickSel, textSel]) => {\n        const pick = modal.querySelector(pickSel), text = modal.querySelector(textSel);\n        if (!pick || !text) return;\n        const hex = (String(text.value||'').match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)||[])[0];\n        if (hex) pick.value = hex;\n        pick.addEventListener('input', () => { text.value = pick.value; });\n        text.addEventListener('change', () => {\n          const h = (String(text.value||'').match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)||[])[0];\n          if (h) pick.value = h;\n        });\n      });\n\n    const fileInput = modal.querySelector('#ddc-file-bg');\n    const urlInput  = modal.querySelector('#ddc-setting-bgImg');\n    const thumb     = modal.querySelector('#ddc-bg-thumb');\n    const updateThumb = (src) => { if (thumb) thumb.style.backgroundImage = src ? `url(${src})` : 'none'; };\n\n    if (urlInput?.value) updateThumb(urlInput.value);\n\n    fileInput?.addEventListener('change', async () => {\n      const file = fileInput.files?.[0]; if (!file) return;\nconst isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\nconst objectUrl = URL.createObjectURL(file);\n// Live preview using an object URL (avoids huge base64 in memory/config)\nupdateThumb(objectUrl);\nthis.style.setProperty('--ddc-bg-image', `url(\"${objectUrl}\")`);\n// Do not persist base64 by default; keep input empty unless small and non-iOS\nif (urlInput) urlInput.value = '';\n(async () => {\n  if (!isIOS) {\n    try {\n      const img = new Image();\n      img.src = objectUrl;\n      await img.decode();\n      const scale = Math.min(1920 / img.naturalWidth, 1080 / img.naturalHeight, 1);\n      const w = Math.round(img.naturalWidth * scale);\n      const h = Math.round(img.naturalHeight * scale);\n      const canvas = document.createElement('canvas');\n      canvas.width = w; canvas.height = h;\n      const ctx = canvas.getContext('2d', { alpha: false });\n      ctx.drawImage(img, 0, 0, w, h);\n      const dataUrl = canvas.toDataURL('image/jpeg', 0.7);\n      if (dataUrl && dataUrl.length < 300000) {\n        // only store if reasonably small\n        if (urlInput) urlInput.value = dataUrl;\n      }\n    } catch (e) {\n      // ignore compression errors; preview still works\n    }\n  }\n})();\n});\n\n    modal.querySelector('#ddc-clear-bg')?.addEventListener('click', () => {\n      if (urlInput) urlInput.value = '';\n      updateThumb('');\n      // clear config & live preview\n      const { background_image, ...rest } = this._config || {};\n      this._config = rest;\n      this.style.setProperty('--ddc-bg-image', 'none');\n      this._applyBackgroundFromConfig?.();\n      this._persistThisCardConfigToStorage_?.();\n    });\n\n    // Close quality improvements\n    modal.addEventListener('click', (evt) => { if (evt.target === modal) { evt.stopPropagation(); closeModal(); } });\n    const onKey = (e) => { if (e.key === 'Escape') { e.stopPropagation(); closeModal(); } };\n    document.addEventListener('keydown', onKey, { once: true });\n    setTimeout(() => modal.querySelector('#ddc-setting-gridSize')?.focus(), 0);\n\n\n    // Build extra inputs for container size mode (custom dimensions or preset list)\n    try {\n      const extrasDiv = modal.querySelector('#ddc-setting-sizeExtras');\n      const updateSizeExtras = () => {\n        if (!extrasDiv) return;\n        extrasDiv.innerHTML = '';\n        const modeVal = selSize?.value || 'dynamic';\n        if (modeVal === 'fixed_custom') {\n          // Custom width and height inputs\n          const wrapW = document.createElement('label');\n          wrapW.style.display = 'flex';\n          wrapW.style.flexDirection = 'column';\n          wrapW.style.fontSize = '.95rem';\n          wrapW.style.marginBottom = '10px';\n          const spanW = document.createElement('span');\n          spanW.textContent = 'Custom width (px)';\n          spanW.style.marginBottom = '4px';\n          const inpW = document.createElement('input');\n          inpW.type = 'number';\n          inpW.id = 'ddc-setting-custW';\n          inpW.min = '100';\n          inpW.max = '10000';\n          inpW.step = '10';\n          inpW.style.padding = '6px';\n          inpW.style.border = '1px solid var(--divider-color,rgba(0,0,0,.3))';\n          inpW.style.borderRadius = '6px';\n          inpW.value = String(this.containerFixedWidth ?? 800);\n          wrapW.appendChild(spanW);\n          wrapW.appendChild(inpW);\n          const wrapH = document.createElement('label');\n          wrapH.style.display = 'flex';\n          wrapH.style.flexDirection = 'column';\n          wrapH.style.fontSize = '.95rem';\n          wrapH.style.marginBottom = '10px';\n          const spanH = document.createElement('span');\n          spanH.textContent = 'Custom height (px)';\n          spanH.style.marginBottom = '4px';\n          const inpH = document.createElement('input');\n          inpH.type = 'number';\n          inpH.id = 'ddc-setting-custH';\n          inpH.min = '100';\n          inpH.max = '10000';\n          inpH.step = '10';\n          inpH.style.padding = '6px';\n          inpH.style.border = '1px solid var(--divider-color,rgba(0,0,0,.3))';\n          inpH.style.borderRadius = '6px';\n          inpH.value = String(this.containerFixedHeight ?? 600);\n          wrapH.appendChild(spanH);\n          wrapH.appendChild(inpH);\n          extrasDiv.appendChild(wrapW);\n          extrasDiv.appendChild(wrapH);\n        } else if (modeVal === 'preset') {\n          // Preset list select\n          const wrap = document.createElement('label');\n          wrap.style.display = 'flex';\n          wrap.style.flexDirection = 'column';\n          wrap.style.fontSize = '.95rem';\n          wrap.style.marginBottom = '10px';\n          const span = document.createElement('span');\n          span.textContent = 'Preset size';\n          span.style.marginBottom = '4px';\n          const select = document.createElement('select');\n          select.id = 'ddc-setting-preset';\n          select.style.padding = '6px';\n          select.style.border = '1px solid var(--divider-color,rgba(0,0,0,.3))';\n          select.style.borderRadius = '6px';\n          // Populate options from size presets\n          const presets = (typeof DragAndDropCard !== 'undefined' && DragAndDropCard._sizePresets) ? DragAndDropCard._sizePresets() : [];\n          presets.forEach(p => {\n            const opt = document.createElement('option');\n            opt.value = p.key;\n            opt.textContent = `${p.label || p.key} (${p.w}\u00D7${p.h})`;\n            select.appendChild(opt);\n          });\n          // Preselect current preset if available\n          select.value = String(this.containerPreset || 'fhd');\n          wrap.appendChild(span);\n          wrap.appendChild(select);\n          extrasDiv.appendChild(wrap);\n        }\n      };\n      // initial call\n      updateSizeExtras();\n      // update when size mode changes\n      selSize?.addEventListener('change', updateSizeExtras);\n    } catch (err) {\n      console.warn('[drag-and-drop-card] Failed to build container size extras', err);\n    }\n\n    // ===== TABS MANAGER (with icon + label mode) =====\n\n    // read current tabs; preserve existing shape and unknown fields\n    const readTabs = () => {\n      const raw = this._config?.options?.tabs ?? this._config?.tabs ?? [];\n      return raw.map((t) => {\n        if (typeof t === 'string') return { id: t, label: t, icon: '', label_mode: 'both', __raw: { id: t, label: t } };\n        return {\n          id: t.id ?? t.key ?? t.label ?? 'tab',\n          label: t.label ?? t.id ?? 'Tab',\n          icon: t.icon ?? '',\n          label_mode: t.label_mode ?? 'both', // 'icon' | 'text' | 'both' (optional)\n          __raw: t                               // keep full object to avoid dropping fields\n        };\n      });\n    };\n\n    // write back without dropping unknown fields (merge)\n    const writeTabs = async (tabs, defaultId) => {\n      const out = tabs.map((t) => ({\n        ...t.__raw,\n        id: t.id,\n        label: t.label,\n        icon: t.icon || '',\n        label_mode: t.label_mode || 'both'\n      }));\n\n      if (this._config?.options) {\n        this._config.options = { ...(this._config.options || {}), tabs: out, default_tab: defaultId ?? (this._config.options?.default_tab) };\n      } else {\n        this._config.tabs = out;\n        if (defaultId) this._config.default_tab = defaultId;\n      }\n      try { await this._persistThisCardConfigToStorage_(); } catch (e) { console.warn('[drag-and-drop-card] Could not persist tabs', e); }\n      this.requestUpdate?.();\n    };\n\n    const defaultTabId = () =>\n      (this._config?.options?.default_tab) || this._config?.default_tab || (readTabs()[0]?.id);\n\n    const tabsListEl = modal.querySelector('#ddc-tabs-list');\n\n    const renderTabs = () => {\n      const tabs = readTabs();\n      const def = defaultTabId();\n      tabsListEl.innerHTML = '';\n\n      if (!tabs.length) {\n        const empty = document.createElement('div');\n        empty.className = 'hint';\n        empty.textContent = 'No tabs yet. Add one below.';\n        tabsListEl.appendChild(empty);\n        return;\n      }\n\n      tabs.forEach((t, idx) => {\n        const row = document.createElement('div');\n        row.className = 'tab-row';\n\n        // default selector\n        const radio = document.createElement('input');\n        radio.type = 'radio';\n        radio.name = 'ddc-default-tab';\n        radio.value = t.id;\n        radio.checked = (t.id === def);\n        radio.title = 'Set as default tab';\n        radio.addEventListener('change', async () => { await writeTabs(tabs, t.id); });\n\n        // icon + label editors\n        const nameWrap = document.createElement('div');\n        nameWrap.className = 'tab-name';\n\n        // live icon preview\n        const preview = document.createElement('ha-icon');\n        preview.setAttribute('icon', t.icon || 'mdi:tab');\n\n        // icon input\n        const iconInput = document.createElement('input');\n        iconInput.value = t.icon || '';\n        iconInput.placeholder = 'mdi:home';\n        iconInput.title = 'Tab icon (mdi:...)';\n        iconInput.style.width = '160px';\n        iconInput.addEventListener('change', async () => {\n          t.icon = iconInput.value.trim();\n          preview.setAttribute('icon', t.icon || 'mdi:tab');\n          tabs[idx] = t;\n          await writeTabs(tabs, def);\n        });\n\n        // label input\n        const nameInput = document.createElement('input');\n        nameInput.value = t.label;\n        nameInput.placeholder = 'Tab name';\n        nameInput.style.flex = '1';\n        nameInput.addEventListener('change', async () => {\n          t.label = nameInput.value.trim() || t.id;\n          tabs[idx] = t;\n          await writeTabs(tabs, def);\n        });\n\n        const iconWrap = document.createElement('div');\n        iconWrap.className = 'tab-icon-wrap';\n        iconWrap.appendChild(preview);\n        iconWrap.appendChild(iconInput);\n\n        nameWrap.appendChild(iconWrap);\n        nameWrap.appendChild(nameInput);\n\n        // label mode chips (icon / text / both)\n        const modes = document.createElement('div');\n        modes.className = 'mode-chips';\n        const mkMode = (val, text) => {\n          const b = document.createElement('button');\n          b.type = 'button';\n          b.className = 'chip';\n          b.textContent = text;\n          b.setAttribute('aria-pressed', String((t.label_mode || 'both') === val));\n          b.addEventListener('click', async () => {\n            modes.querySelectorAll('.chip').forEach(x => x.setAttribute('aria-pressed','false'));\n            b.setAttribute('aria-pressed','true');\n            t.label_mode = val;              // store preference\n            tabs[idx] = t;\n            await writeTabs(tabs, def);\n          });\n          return b;\n        };\n        modes.appendChild(mkMode('icon', 'Icon'));\n        modes.appendChild(mkMode('text', 'Text'));\n        modes.appendChild(mkMode('both', 'Both'));\n\n        // actions (delete)\n        const actions = document.createElement('div');\n        actions.className = 'tab-actions';\n        const delBtn = document.createElement('button');\n        delBtn.className = 'icon-btn danger';\n        delBtn.innerHTML = '<ha-icon icon=\"mdi:trash-can-outline\"></ha-icon>';\n        delBtn.title = 'Delete tab';\n        delBtn.addEventListener('click', async () => {\n          const nextTabs = readTabs().filter(x => x.id !== t.id);\n          let nextDefault = def;\n          if (t.id === def) nextDefault = nextTabs[0]?.id;\n          await writeTabs(nextTabs, nextDefault);\n          try { this._reassignCardsToTab_?.(t.id, nextDefault); } catch {}\n          renderTabs();\n        });\n\n        actions.appendChild(modes);\n        actions.appendChild(delBtn);\n\n        row.appendChild(radio);\n        row.appendChild(nameWrap);\n        row.appendChild(actions);\n        tabsListEl.appendChild(row);\n      });\n    };\n    renderTabs();\n\n    // Add tab\n    modal.querySelector('#ddc-add-tab-btn')?.addEventListener('click', async () => {\n      const inp = modal.querySelector('#ddc-new-tab-name');\n      const raw = (inp?.value || '').trim();\n      if (!raw) return;\n      const tabs = readTabs();\n      // unique id\n      let id = raw.replace(/\\s+/g, '-').toLowerCase();\n      let i = 2;\n      while (tabs.some(t => t.id === id)) id = `${id}-${i++}`;\n      tabs.push({ id, label: raw, icon: '', label_mode: 'both', __raw: { id, label: raw } });\n      await writeTabs(tabs, defaultTabId());\n      inp.value = '';\n      renderTabs();\n    });\n\n\n    // ===== BACKGROUND IMAGE: DELETE BUTTON =====\n    const clearBtn = modal.querySelector('#ddc-clear-bg');\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => {\n        const urlInput  = modal.querySelector('#ddc-setting-bgImg');\n        const thumb     = modal.querySelector('#ddc-bg-thumb');\n        if (urlInput) urlInput.value = '';\n        if (thumb) thumb.style.backgroundImage = 'none';\n        // clear from config immediately\n        try {\n          if (this._config?.background_image) {\n            const { background_image, ...rest } = this._config;\n            this._config = rest;\n          }\n          this._applyBackgroundImageFromConfig?.();\n          this._persistThisCardConfigToStorage_?.();\n        } catch (e) {\n          console.warn('[drag-and-drop-card] Failed to clear background image', e);\n        }\n      });\n    }\n\n    // ===== GRADIENT PRESETS for Container Background =====\n    const GRADIENTS = [\n      'linear-gradient(135deg, #1e3a8a, #0ea5e9)',\n      'linear-gradient(135deg, #111827, #1f2937)',\n      'linear-gradient(135deg, #0f766e, #22c55e)',\n      'linear-gradient(135deg, #7c3aed, #06b6d4)',\n      'linear-gradient(135deg, #f97316, #f43f5e)',\n      'linear-gradient(135deg, #eab308, #22d3ee)',\n      'radial-gradient(circle at 30% 20%, #2dd4bf, #1e293b)',\n      'radial-gradient(circle at 70% 80%, #f59e0b, #7c3aed)',\n    ];\n    const buildGradients = (containerSel, targetInputSel) => {\n      const wrap = modal.querySelector(containerSel);\n      const target = modal.querySelector(targetInputSel);\n      if (!wrap || !target) return;\n      wrap.innerHTML = '';\n      GRADIENTS.forEach(g => {\n        const b = document.createElement('button');\n        b.type = 'button';\n        b.className = 'gradient';\n        b.style.background = g;\n        b.setAttribute('aria-pressed','false');\n        b.title = g;\n        b.addEventListener('click', () => {\n          wrap.querySelectorAll('.gradient').forEach(x => x.setAttribute('aria-pressed','false'));\n          b.setAttribute('aria-pressed','true');\n          target.value = g;                          // write into the same input your save handler already reads\n          // Live apply for preview:\n          try {\n            const isCard = String(targetInputSel || '').toLowerCase().includes('cardbg');\n            if (isCard) {\n              this.cardBackground = g;\n              this.style.setProperty('--ddc-card-bg', g);\n            } else {\n              this.containerBackground = g;\n              this.style.setProperty('--ddc-bg', g);\n            }\n          } catch {}\n        });\n        wrap.appendChild(b);\n        if (String(target.value).trim() === g) b.setAttribute('aria-pressed','true');\n      });\n    };\n    buildGradients('#ddc-gradients-containerBg', '#ddc-setting-containerBg');\n    buildGradients('#ddc-gradients-cardBg',      '#ddc-setting-cardBg');\n\n    // Live preview when manually editing background text inputs\n    if (inpCBg) {\n      inpCBg.addEventListener('input', () => {\n        const val = (inpCBg.value || '').trim();\n        try {\n          this.containerBackground = val;\n          this.style.setProperty('--ddc-bg', val);\n        } catch {}\n      });\n    }\n    if (inpCardBg) {\n      inpCardBg.addEventListener('input', () => {\n        const val = (inpCardBg.value || '').trim();\n        try {\n          this.cardBackground = val;\n          this.style.setProperty('--ddc-card-bg', val);\n        } catch {}\n      });\n    }\n\n\n    // Remove modal helper\n    const closeModal = () => {\n      try { this.__ddcGridRO?.disconnect?.(); this.__ddcGridRO = null; } catch{}\n      try { modal.remove(); } catch {}\n      if (this.__settingsModal === modal) this.__settingsModal = null;\n    };\n    // Close handlers\n    modal.querySelector('#ddc-settings-close')?.addEventListener('click', (e) => { e.stopPropagation(); closeModal(); });\n    modal.querySelector('#ddc-settings-cancel')?.addEventListener('click', (e) => { e.stopPropagation(); closeModal(); });\n    // Save handler\n    modal.querySelector('#ddc-settings-save')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n      // Read values\n      const newSize      = selSize?.value || 'dynamic';\n      // Auto-resize is only honored when the container size mode is dynamic\n      const newAuto      = (newSize === 'dynamic') && !!chkAuto?.checked;\n      const newGrid      = parseInt(inpGrid?.value || '0', 10);\n      const newAnim      = !!chkAnim?.checked;\n      const newHideHdr   = !!chkHdr?.checked;\n      const newHideBar   = !!chkBar?.checked;\n      const newSnap      = !!chkSnap?.checked;\n      const newASave     = !!chkASave?.checked;\n      const newDeb       = parseInt(inpDeb?.value || '0', 10);\n      const newOrient    = selOrient?.value || 'auto';\n      const newOverlap   = !!chkOverlap?.checked;\n      const newCBg       = (inpCBg?.value || '').trim();\n      const newCardBg    = (inpCardBg?.value || '').trim();\n      const newBgImg     = (inpBgImg?.value || '').trim();\n      const newDebug     = !!chkDebug?.checked;\n      const newEditPin  = (inpEditPin?.value || '').trim();\n      const newBgMode = selBgMode?.value || 'none';\n      const newParticlesUrl = (inpParticlesUrl?.value || '').trim();\n      const newParticlesPtr = !!chkParticlesPointer?.checked;\n      const newYtUrl   = (inpYtUrl?.value || '').trim();\n      const newYtStart = parseInt(inpYtStart?.value || '', 10);\n      const newYtEnd   = parseInt(inpYtEnd?.value   || '', 10);\n      const newYtMute  = !!chkYtMute?.checked;\n      const newYtLoop  = !!chkYtLoop?.checked;\n      const newYtSize  = (selYtSize?.value || 'cover');\n      const newYtPosition = (selYtPosition?.value || 'center');\n      const newYtOpacity  = rngYtOpacity ? Math.max(0, Math.min(100, parseInt(rngYtOpacity.value || '100', 10))) / 100 : 1;\n      const newYtAttachment = (selYtAttachment?.value || 'scroll');\n\n      // Card shadow toggle\n      const newShadow = !!chkShadow?.checked;\n\n      // Screen saver values\n      const newScreenSaverEnabled   = !!chkScreenSaver?.checked;\n      const newScreenSaverDelayMin  = parseInt(rngScreenDelay?.value || '1', 10);\n      const newScreenSaverDelayMs   = (Number.isFinite(newScreenSaverDelayMin) ? newScreenSaverDelayMin : 1) * 60000;\n\n      // hero and tabs position not exposed to user\n      try {\n        // Auto resize cards\n        this.autoResizeCards = newAuto;\n\n        // If turning OFF: disconnect observers & listeners\n        if (!this.autoResizeCards && this.__ddcResizeObs) {\n          try { this.__ddcResizeObs.disconnect(); } catch {}\n          this.__ddcResizeObs = null;\n          if (this.__ddcOnWinResize) {\n            window.removeEventListener('resize', this.__ddcOnWinResize);\n            this.__ddcOnWinResize = null;\n          }\n        }\n\n        // If turning ON: attach observers & listeners (idempotent)\n        if (this.autoResizeCards && !this.__ddcResizeObs) {\n          this.__ddcResizeObs = new ResizeObserver(() => this._applyAutoScale?.());\n          try { this.__ddcResizeObs.observe(this); } catch {}\n          try { this.__ddcResizeObs.observe(this.cardContainer); } catch {}\n          window.addEventListener('resize', this.__ddcOnWinResize = () => this._applyAutoScale?.());\n        }\n\n        // Start/stop any rAF scale watcher depending on mode\n        if (\n          this.autoResizeCards ||\n          String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase() === 'auto'\n        ) {\n          this._startScaleWatch?.();\n        } else {\n          this._stopScaleWatch?.();\n        }\n\n        // Recompute once to settle layout immediately\n        this._applyAutoScale?.();\n\n        // Grid size\n        if (!isNaN(newGrid) && newGrid > 0 && newGrid !== this.gridSize) {\n          this.gridSize = newGrid;\n          this._applyGridVars?.();\n          this._resizeContainer?.();\n        }\n        // Apply card drop shadow\n        this.cardShadowEnabled = newShadow;\n        if (this.cardShadowEnabled) {\n          // Use a more prominent drop shadow when enabled\n          this.style.setProperty('--ddc-card-shadow', '0 8px 24px rgba(0,0,0,.35)');\n        } else {\n          this.style.removeProperty('--ddc-card-shadow');\n        }\n        // Edit mode PIN\n        this.editModePin = newEditPin;\n        // make sure the persisted config also carries it\n        this._config = { ...(this._config || {}), edit_mode_pin: newEditPin };\n        // Drag live snap\n        const snapChanged = newSnap !== this.dragLiveSnap;\n        this.dragLiveSnap = newSnap;\n        if (snapChanged) {\n          // Re-init interact on all cards so the snap modifiers take effect\n          this._initInteract?.();\n        }\n        // Auto save\n        this.autoSave = newASave;\n        // Auto save debounce\n        if (!isNaN(newDeb) && newDeb > 0) this.autoSaveDebounce = newDeb;\n        // Container size mode\n        const sizeChanged = newSize !== this.containerSizeMode;\n        this.containerSizeMode = newSize;\n        // Container orientation\n        const orientChanged = newOrient !== this.containerPresetOrient;\n        this.containerPresetOrient = newOrient;\n        if (sizeChanged || orientChanged) {\n          // When size or orientation changes, recalc container\n          this._resizeContainer?.();\n        }\n\n        // Apply fixed custom or preset dimensions\n        if (newSize === 'fixed_custom') {\n          // Read custom width & height from inputs and apply immediately\n          const wVal = parseInt(modal.querySelector('#ddc-setting-custW')?.value || '0', 10);\n          const hVal = parseInt(modal.querySelector('#ddc-setting-custH')?.value || '0', 10);\n          if (!isNaN(wVal) && wVal > 0) this.containerFixedWidth  = wVal;\n          if (!isNaN(hVal) && hVal > 0) this.containerFixedHeight = hVal;\n          // Recompute container size after updating custom dims\n          this._resizeContainer?.();\n        } else if (newSize === 'preset') {\n          const presetVal = modal.querySelector('#ddc-setting-preset')?.value;\n          if (presetVal) this.containerPreset = presetVal;\n          // Recompute container size after updating preset\n          this._resizeContainer?.();\n        }\n        // Disable overlap\n        this.disableOverlap = newOverlap;\n        // Container background\n        if (newCBg) {\n          this.containerBackground = newCBg;\n          this.style.setProperty('--ddc-bg', this.containerBackground);\n        }\n        // Card background\n        if (newCardBg) {\n          this.cardBackground = newCardBg;\n          this.style.setProperty('--ddc-card-bg', this.cardBackground);\n        }\n        // Background image (only src)\n        // Background image (only src) \u2014 immutable update (avoids \"read-only\" error)\n        if (newBgImg) {\n          const prevBg = (this._config && this._config.background_image) || {};\n          this._config = { ...this._config, background_image: { ...prevBg, src: newBgImg } };\n        } else {\n          const { background_image, ...rest } = this._config || {};\n          this._config = rest;\n        }\n        // Debug\n        this.debug = newDebug;\n        // Animate cards\n        this.animateCards = newAnim;\n        // Hide HA chrome\n        this.hideHaHeader  = newHideHdr;\n        this.hideHaSidebar = newHideBar;\n        this._applyHaChromeVisibility_?.();\n\n        // Apply background image (if changed)\n        // ---- Background image (immutable update) ----\n        const prevBg = (this._config && this._config.background_image) || {};\n        const rep    = selBgRepeat?.value     || 'no-repeat';\n        const sz     = selBgSize?.value       || 'cover';\n        const pos    = selBgPosition?.value   || 'center center';\n        const att    = selBgAttachment?.value || 'scroll';\n        const op     = rngBgOpacity ? Math.max(0, Math.min(100, parseInt(rngBgOpacity.value || '100', 10))) / 100 : 1;\n\n        // ---- Background mode + dynamic configs ----\n        this._config = this._config || {};\n        this._config.background_mode = newBgMode;\n\n        // keep image settings only if mode is 'image' or you\u2019ve set a src\n        if (newBgMode !== 'image' && !newBgImg) {\n          const { background_image, ...rest } = this._config || {};\n          this._config = rest;\n        }\n\n        // particles\n        if (newBgMode === 'particles') {\n          this._config.background_particles = {\n            config_url: newParticlesUrl || undefined,\n            pointer_events: newParticlesPtr || undefined,\n          };\n        } else {\n          const { background_particles, ...rest } = this._config || {};\n          this._config = rest;\n        }\n\n        // youtube\n        if (newBgMode === 'youtube') {\n          this._config.background_youtube = {\n            url: newYtUrl || undefined,\n            start: Number.isFinite(newYtStart) ? newYtStart : undefined,\n            end:   Number.isFinite(newYtEnd)   ? newYtEnd   : undefined,\n            mute:  newYtMute !== true ? newYtMute : undefined,  // defaults true\n            loop:  newYtLoop !== true ? newYtLoop : undefined   // defaults true\n          ,\n            size:  newYtSize && newYtSize != 'cover' ? newYtSize : undefined,\n            position: newYtPosition || undefined,\n            attachment: (newYtAttachment && newYtAttachment !== 'scroll') ? newYtAttachment : undefined,\n            opacity: (newYtOpacity != null && newYtOpacity !== 1) ? newYtOpacity : undefined\n          };\n        } else {\n          const { background_youtube, ...rest } = this._config || {};\n          this._config = rest;\n        }\n\n        // Screen saver settings\n        this.screenSaverEnabled = newScreenSaverEnabled;\n        this.screenSaverDelay   = newScreenSaverDelayMs;\n        this._updateScreensaverSettings?.();\n\n\n        if (newBgImg) {\n          this._config = {\n            ...this._config,\n            background_image: { ...prevBg, src: newBgImg, repeat: rep, size: sz, position: pos, attachment: att, opacity: op }\n          };\n        } else if (prevBg.src) {\n          this._config = {\n            ...this._config,\n            background_image: { ...prevBg, repeat: rep, size: sz, position: pos, attachment: att, opacity: op }\n          };\n        } else {\n          const { background_image, ...rest } = this._config || {};\n          this._config = rest;\n        }\n\n        // Apply immediately (preview)\n        this._applyBackgroundFromConfig?.();\n\n        // Update underlying config so changes persist in YAML/storage\n        try {\n          if (!this._config) this._config = {};\n          this._config.grid                    = this.gridSize;\n          this._config.auto_resize_cards       = !!this.autoResizeCards;\n          this._config.drag_live_snap          = !!this.dragLiveSnap;\n          this._config.auto_save               = !!this.autoSave;\n          this._config.auto_save_debounce      = this.autoSaveDebounce;\n          this._config.container_size_mode     = this.containerSizeMode;\n          this._config.container_preset_orientation = this.containerPresetOrient;\n          this._config.container_fixed_width   = this.containerFixedWidth;\n          this._config.container_fixed_height  = this.containerFixedHeight;\n          this._config.container_preset        = this.containerPreset;\n          this._config.disable_overlap         = !!this.disableOverlap;\n          this._config.container_background    = this.containerBackground;\n          this._config.card_background         = this.cardBackground;\n          // Persist card shadow setting\n          this._config.card_shadow            = !!this.cardShadowEnabled;\n          this._config.debug                   = !!this.debug;\n          this._config.animate_cards           = !!this.animateCards;\n          this._config.hide_HA_Header          = !!this.hideHaHeader;\n          this._config.hide_HA_Sidebar         = !!this.hideHaSidebar;\n          // Screen saver config\n          this._config.screen_saver_enabled    = !!this.screenSaverEnabled;\n          this._config.screen_saver_delay      = this.screenSaverDelay;\n          // Background image src is already updated in this._config.background_image above\n        } catch (cfgErr) {\n          console.warn('[drag-and-drop-card] Failed to update config', cfgErr);\n        }\n        // Persist changes\n        // Persist changes exactly like the Visual Editor (Storage dashboards)\n        this._persistThisCardConfigToStorage_()\n          .catch((e) => {\n            console.warn('[drag-and-drop-card] Storage save failed (is this a YAML dashboard?)', e);\n            // Optional: toast for the user:\n            // this._showToast_?.('Could not save to dashboard storage. Is this a YAML dashboard?');\n          });\n      } catch (err) {\n        console.warn('[drag-and-drop-card] Failed to apply settings', err);\n      }\n      closeModal();\n    });\n  }\n\n  \n  /* ----------------------------- Export / Import Design ----------------------------- */\n\n\n  // Put these inside the class\n\n  /** Only the exportable knobs the user set in the UI */\n  /** Only the exportable knobs the user set in the UI */\n  _exportableOptions() {\n    const cfg = this._config || {};\n\n    // Normalize background objects to only defined keys (keeps the export tidy)\n    const pick = (obj, keys) =>\n      Object.fromEntries(keys.map(k => [k, obj?.[k]]).filter(([,v]) => v !== undefined));\n\n    // Resolve/guess active background mode for completeness\n    const bgMode =\n      cfg.background_mode\n      || (cfg.background_image?.src ? 'image'\n          : cfg.background_youtube ? 'youtube'\n          : cfg.background_particles ? 'particles'\n          : 'none');\n\n    const opt = {\n      // Core\n      storage_key: this.storageKey || undefined,\n      grid: this.gridSize,\n      drag_live_snap: !!this.dragLiveSnap,\n      auto_save: !!this.autoSave,\n      auto_save_debounce: this.autoSaveDebounce,\n      disable_overlap: !!this.disableOverlap,\n      debug: !!this.debug,\n      edit_mode_pin: (this.editModePin || undefined),\n\n      // Size & layout\n      container_size_mode: this.containerSizeMode,\n      container_preset_orientation: this.containerPresetOrient,\n      container_fixed_width: this.containerFixedWidth ?? undefined,\n      container_fixed_height: this.containerFixedHeight ?? undefined,\n      container_preset: this.containerPreset,\n      auto_resize_cards: !!this.autoResizeCards,\n\n      // Appearance\n      container_background: this.containerBackground,\n      card_background: this.cardBackground,\n      card_shadow: !!this.cardShadowEnabled,\n      animate_cards: !!this.animateCards,\n\n      // HA chrome visibility\n      hide_HA_Header: !!this.hideHaHeader,\n      hide_HA_Sidebar: !!this.hideHaSidebar,\n\n      // Tabs (from the modal section)\n      tabs: this.tabs,\n      tabs_position: this.tabsPosition,\n      default_tab: this.defaultTab,\n      hide_tabs_when_single: !!this.hideTabsWhenSingle,\n\n      // Background (image | particles | youtube | none)\n      background_mode: bgMode,\n      background_image: cfg.background_image\n        ? pick(cfg.background_image, ['src','repeat','size','position','attachment','opacity'])\n        : undefined,\n      background_particles: cfg.background_particles\n        ? pick(cfg.background_particles, ['config_url','pointer_events'])\n        : undefined,\n      background_youtube: cfg.background_youtube\n        ? pick(cfg.background_youtube, [\n            'url','start','end','mute','loop','size','position','attachment','opacity'\n          ])\n        : undefined,\n\n      // Screen saver\n      screen_saver_enabled: !!this.screenSaverEnabled,\n      screen_saver_delay: this.screenSaverDelay,\n    };\n\n    // strip undefined to keep files tidy\n    Object.keys(opt).forEach(k => opt[k] === undefined && delete opt[k]);\n    return opt;\n  }\n\n\n  /** Apply options WITHOUT triggering a full rebuild */\n  _applyImportedOptions(opts = {}, recalc = true) {\n    if (opts && Object.prototype.hasOwnProperty.call(opts, 'storage_key')) {\n    // If storage_key changed, push it into HA editor immediately\n     if (this._isInHaEditorPreview()) {\n       try {\n         const updatedCfg = { type: 'custom:drag-and-drop-card', ...(this._config || {}) };\n         this.dispatchEvent(new CustomEvent('config-changed', {\n           detail: { config: updatedCfg },\n           bubbles: true,\n           composed: true,\n         }));\n       } catch {}\n     }\n    }\n\n    // keep the original config around, but merge options into live props\n    this._config = { ...(this._config || {}), ...opts };\n\n    if ('storage_key' in opts)        this.storageKey = opts.storage_key || undefined;\n    this._syncEditorsStorageKey();\n    if ('grid' in opts)               this.gridSize = Number(opts.grid) || 10;\n    if ('drag_live_snap' in opts)     this.dragLiveSnap = !!opts.drag_live_snap;\n    if ('auto_save' in opts)          this.autoSave = !!opts.auto_save;\n    if ('auto_save_debounce' in opts) this.autoSaveDebounce = Number(opts.auto_save_debounce) || 800;\n    if ('container_background' in opts) this.containerBackground = opts.container_background ?? 'transparent';\n    if ('card_background' in opts)      this.cardBackground = opts.card_background ?? 'var(--ha-card-background, var(--card-background-color))';\n    if ('card_shadow' in opts)          this.cardShadowEnabled = !!opts.card_shadow;\n    if ('debug' in opts)              this.debug = !!opts.debug;\n    if ('disable_overlap' in opts)    this.disableOverlap = !!opts.disable_overlap;\n\n        if ('container_size_mode' in opts) {\n      this.containerSizeMode = opts.container_size_mode || 'dynamic';\n\n      const modeLower = String(this.containerSizeMode || 'dynamic').toLowerCase();\n\n      // In dynamic mode we always force auto-resize ON.\n      if (modeLower === 'dynamic') {\n        this.autoResizeCards = true;\n      }\n\n      // Keep the scale watcher in sync when the size mode changes.\n      if (this.autoResizeCards || modeLower === 'auto') {\n        this._startScaleWatch?.();\n      } else {\n        this._stopScaleWatch?.();\n      }\n\n      this._applyAutoScale?.();\n    }\n\n    if ('container_fixed_width' in opts)      this.containerFixedWidth  = Number(opts.container_fixed_width)  || null;\n    if ('container_fixed_height' in opts)     this.containerFixedHeight = Number(opts.container_fixed_height) || null;\n    if ('container_preset' in opts)           this.containerPreset = opts.container_preset || 'fhd';\n    if ('container_preset_orientation' in opts) this.containerPresetOrient = opts.container_preset_orientation || 'auto';\n    \n    if ('auto_resize_cards' in opts) {\n      const modeLower = String(\n        (this.containerSizeMode || this.container_size_mode || 'dynamic')\n      ).toLowerCase();\n\n      if (modeLower === 'dynamic') {\n        // Ignore manual toggles in dynamic mode \u2013 always ON.\n        this.autoResizeCards = true;\n      } else {\n        this.autoResizeCards = !!opts.auto_resize_cards;\n      }\n\n      if (this.autoResizeCards || modeLower === 'auto') {\n        this._startScaleWatch?.();\n      } else {\n        this._stopScaleWatch?.();\n      }\n\n      this._applyAutoScale?.();\n    }\n\n\n    // Screen saver: apply imported values\n    if ('screen_saver_enabled' in opts) {\n      this.screenSaverEnabled = !!opts.screen_saver_enabled;\n    }\n    if ('screen_saver_delay' in opts) {\n      const ms = Number(opts.screen_saver_delay);\n      this.screenSaverDelay = Number.isFinite(ms) && ms > 0 ? ms : this.screenSaverDelay;\n    }\n    if ('screen_saver_enabled' in opts || 'screen_saver_delay' in opts) {\n      if (typeof this._updateScreensaverSettings === 'function') this._updateScreensaverSettings();\n    }\n\n\n\n    // reflect to CSS\n    this.style.setProperty('--ddc-bg', this.containerBackground);\n    this.style.setProperty('--ddc-card-bg', this.cardBackground);\n\n    // Apply card shadow based on imported options\n    if (this.cardShadowEnabled) {\n      // Apply a stronger drop shadow when the option is enabled\n      this.style.setProperty('--ddc-card-shadow', '0 8px 24px rgba(0,0,0,.35)');\n    } else {\n      this.style.removeProperty('--ddc-card-shadow');\n    }\n    this._applyGridVars();\n\n    if (recalc) {\n      this._applyContainerSizingFromConfig(true);\n      this._applyAutoScale?.();\n      this._resizeContainer();\n      this._updateStoreBadge?.();\n      this._applyAutoScale?.();\n\n    }\n  }\n\n  _exportDesign() {\n    const wraps = Array.from(\n      this.cardContainer.querySelectorAll('.card-wrapper:not(.ddc-placeholder)')\n    );\n    const saved = wraps.map((w) => { // DDC tabs\n        \n      const x = parseFloat(w.getAttribute('data-x')) || 0;\n      const y = parseFloat(w.getAttribute('data-y')) || 0;\n      const width  = parseFloat(w.style.width)  || w.getBoundingClientRect().width;\n      const height = parseFloat(w.style.height) || w.getBoundingClientRect().height;\n      const z = parseInt(w.style.zIndex || '1', 10);\n      const cardCfg = this._extractCardConfig(w.firstElementChild);\n      const tabId = w.dataset.tabId || this.defaultTab;\n        return { card: cardCfg, position:{x,y}, size:{width,height}, z, tabId };\n    });\n\n    const payload = {\n      version: 2,\n      options: this._exportableOptions(),\n      cards: saved\n    };\n\n    // NEW: preserve card_mod (if present) as part of options so it exports with the design\n    if (this._config && this._config.card_mod) {\n      payload.options = payload.options || {};\n      payload.options.card_mod = this._config.card_mod;\n    }\n\n    const name = `DragAndDrop_Design_${this.storageKey || 'layout'}.json`;\n    const blob = new Blob([JSON.stringify(payload, null, 2)], { type:'application/json' });\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = name;\n    a.click();\n    URL.revokeObjectURL(a.href);\n    this._toast('Design exported.');\n  }  \n  \n_importDesign() {\n  const inp = document.createElement('input');\n  inp.type = 'file';\n  inp.accept = 'application/json';\n\n  // ---- tweak these if you like ----\n  const HARD_REPLACE = true;                 // fully overwrite existing options\n  const ADOPT_IMPORTED_STORAGE_KEY = false;  // keep current storage_key by default\n  const KNOWN_OPT_KEYS = [\n    // Core + behavior\n    'grid','drag_live_snap','auto_save','auto_save_debounce',\n    'debug','disable_overlap','card_mod','storage_key',\n    'animate_cards','auto_resize_cards',\n\n    // Visuals\n    'container_background','card_background',\n\n    // Size / layout\n    'container_size_mode','container_fixed_width','container_fixed_height',\n    'container_preset','container_preset_orientation',\n\n    // Tabs\n    'tabs','tabs_position','default_tab','hide_tabs_when_single',\n\n    // HA chrome\n    'hide_HA_Header','hide_HA_Sidebar',\n\n    // Background modes\n    'background_mode','background_image','background_particles','background_youtube',\n\n    // Screen saver\n    'screen_saver_enabled','screen_saver_delay',\n  ];\n  // ----------------------------------\n\n  inp.onchange = async () => {\n    const file = inp.files?.[0]; if (!file) return;\n    const txt = await file.text();\n\n    try {\n      const json = JSON.parse(txt);\n      const prevStorageKey = this.storageKey || this._config?.storage_key || null;\n\n      // -------- BACK-COMPAT: synthesize tabs if missing in older exports --------\n      const hasOptionsTabs = !!(json.options && Array.isArray(json.options.tabs));\n      const hasCardTabIds  = Array.isArray(json.cards) && json.cards.some(c => c?.tabId || c?.tab_id);\n\n      // Build a compatible tabs list:\n      // 1) If options.tabs exist, use them.\n      // 2) Else if cards have tabIds, synthesize from distinct ids.\n      // 3) Else create a single default tab.\n      let compatTabs = [];\n      if (hasOptionsTabs) {\n        compatTabs = json.options.tabs;\n      } else if (hasCardTabIds) {\n        const uniq = Array.from(new Set(json.cards.map(c => c?.tabId || c?.tab_id).filter(Boolean)));\n        compatTabs = uniq.map(id => ({ id, label: id }));\n      } else {\n        compatTabs = [{ id: 'default', label: 'Layout' }];\n      }\n\n      const compatTabsPosition = (json.options?.tabs_position === 'left')\n        ? 'left'\n        : (this.tabsPosition || 'top');\n\n      const compatDefaultTab =\n        json.options?.default_tab\n        || (compatTabs[0]?.id || 'default');\n\n      const compatHideSingle =\n        (json.options?.hide_tabs_when_single !== undefined)\n          ? !!json.options.hide_tabs_when_single\n          : true;\n      // -------------------------------------------------------------------------\n\n      // ---- APPLY OPTIONS (with hard-replace or merge) ----\n      if (json.options) {\n        const imported = { ...json.options };\n        if (!ADOPT_IMPORTED_STORAGE_KEY) delete imported.storage_key;\n\n        if (HARD_REPLACE) {\n          const cfg = this._config || { type: 'custom:drag-and-drop-card' };\n\n          // 1) remove stale option keys that aren't in the import\n          for (const k of KNOWN_OPT_KEYS) {\n            if (k === 'storage_key' && !ADOPT_IMPORTED_STORAGE_KEY) continue;\n            if (!(k in imported) && k in cfg) delete cfg[k];\n          }\n\n          // 2) clear any previously-applied DOM styles that could linger\n          try {\n            if (this.cardContainer) {\n              this.cardContainer.style.background = '';\n              this.cardContainer.style.width = '';\n              this.cardContainer.style.height = '';\n            }\n            this.style?.removeProperty?.('--ddc-container-bg');\n            this.style?.removeProperty?.('--ddc-card-bg');\n          } catch {}\n\n          // 3) apply imported options\n          this._config = { ...cfg, ...imported };\n          if (!('card_mod' in imported)) delete this._config.card_mod;\n\n          // Reflect a few toggles to instance fields used elsewhere\n          if ('animate_cards' in imported) this.animateCards = !!imported.animate_cards;\n          if ('auto_resize_cards' in imported) this.autoResizeCards = !!imported.auto_resize_cards;\n\n          // Apply HA header/sidebar visibility immediately\n          if ('hide_HA_Header' in imported || 'hide_HA_Sidebar' in imported) {\n            try { this._applyHaChromeVisibility_?.(); } catch {}\n          }\n\n          // Apply background mode/payload immediately\n          if (\n            'background_mode' in imported ||\n            'background_image' in imported ||\n            'background_particles' in imported ||\n            'background_youtube' in imported\n          ) {\n            try { this._applyBackgroundFromConfig?.(); } catch {}\n          }\n\n\n          if (ADOPT_IMPORTED_STORAGE_KEY && imported.storage_key) {\n            this.storageKey = imported.storage_key;\n          }\n\n          if (this._opts) {\n            this._opts = { ...this._opts, ...imported };\n            for (const k of KNOWN_OPT_KEYS) {\n              if (!(k in imported)) delete this._opts[k];\n            }\n          }\n\n          this._applyOptionsToDom?.(this._config);\n          this.requestUpdate?.();\n        } else {\n          this._applyImportedOptions(imported, true);\n          if (imported.card_mod !== undefined) {\n            this._config = this._config || {};\n            this._config.card_mod = imported.card_mod;\n            this.requestUpdate?.();\n          }\n        }\n      } else if (typeof json.grid === 'number') {\n        // v1 fallback\n        const imported = { grid: json.grid };\n        HARD_REPLACE\n          ? (this._config = { ...(this._config||{}), ...imported })\n          : this._applyImportedOptions(imported, true);\n        this.requestUpdate?.();\n      }\n\n      // Ensure instance tab options exist even for old files (after options applied)\n      if (!Array.isArray(this.tabs) || !this.tabs.length) this.tabs = compatTabs;\n      if (!this.tabsPosition) this.tabsPosition = compatTabsPosition;\n      if (!this.defaultTab) this.defaultTab = compatDefaultTab;\n      if (this.hideTabsWhenSingle === undefined) this.hideTabsWhenSingle = compatHideSingle;\n      this.rootEl?.classList?.toggle?.('ddc-tabs-left-layout', this.tabsPosition === 'left');\n\n      // ---- PERSIST IMPORTED OPTIONS TO YAML (replace semantics) ----\n      try {\n        const targetKey = this._config?.storage_key || this.storageKey || null;\n\n        // Start from what the file had (v2) or v1 fallback\n        const importedOptions = json.options\n          ?? (typeof json.grid === 'number' ? { grid: json.grid } : {});\n\n        // Ensure tabs keys are present (either from file or from current instance state)\n        const persistOptions = {\n          ...importedOptions,\n          tabs: importedOptions.tabs ?? this.tabs ?? [],\n          tabs_position: importedOptions.tabs_position ?? this.tabsPosition ?? 'top',\n          default_tab: importedOptions.default_tab\n            ?? this.defaultTab\n            ?? ((importedOptions.tabs?.[0]?.id) || (this.tabs?.[0]?.id) || 'default'),\n          hide_tabs_when_single:\n            importedOptions.hide_tabs_when_single ?? (this.hideTabsWhenSingle ?? true),\n        };\n\n        // Unless you want to adopt the incoming storage_key, drop it\n        if (!ADOPT_IMPORTED_STORAGE_KEY) delete persistOptions.storage_key;\n\n        if (!targetKey) {\n          console.warn('[ddc:import] No storage_key on this card; aborting YAML persist.');\n        } else {\n          const result = await this._persistOptionsToYaml?.(persistOptions, {\n            forceTargetKey: String(targetKey),\n            noDownload: true,\n            replace: true,\n            wipeUnknownKeys: true,\n          });\n          const yamlOk = !!(result && result.yamlSaved);\n          console.debug?.('[ddc:import] YAML persist result:', yamlOk);\n        }\n\n        // SAFETY NET: push tabs into the live card config (so the UI editor/YAML reflects it immediately)\n        try {\n          const cfg = { type: 'custom:drag-and-drop-card', ...(this._config || {}) };\n          cfg.tabs = persistOptions.tabs;\n          cfg.tabs_position = persistOptions.tabs_position;\n          cfg.default_tab = persistOptions.default_tab;\n          cfg.hide_tabs_when_single = !!persistOptions.hide_tabs_when_single;\n\n          this.dispatchEvent(new CustomEvent('config-changed', {\n            detail: { config: cfg },\n            bubbles: true,\n            composed: true,\n          }));\n        } catch {}\n      } catch (e) {\n        console.warn('[ddc:import] YAML persist failed:', e);\n      }\n\n      // ---- BUILD CARDS ----\n      this.cardContainer.innerHTML = '';\n      if (Array.isArray(json.cards) && json.cards.length) {\n        for (const conf of json.cards) {\n          const x = conf.position?.x || 0;\n          const y = conf.position?.y || 0;\n          const w = conf.size?.width  || 140;\n          const h = conf.size?.height || 100;\n          const z = conf.z;\n          const tabId = this._normalizeTabId(conf.tabId || conf.tab_id || this.defaultTab);\n\n          if (!conf?.card || (typeof conf.card === 'object' && !Object.keys(conf.card).length)) {\n            // placeholder still respects tab\n            const p = this._makePlaceholderAt(x, y, w, h);\n            p.dataset.tabId = tabId;\n            this.cardContainer.appendChild(p);\n            continue;\n          }\n\n          const el = await this._createCard(conf.card);\n          const wrap = this._makeWrapper(el);\n          wrap.dataset.tabId = tabId;\n          this._setCardPosition(wrap, x, y);\n          wrap.style.width  = `${w}px`;\n          wrap.style.height = `${h}px`;\n          if (z != null) wrap.style.zIndex = String(z);\n          this.cardContainer.appendChild(wrap);\n\n          try { this._rebuildOnce(wrap.firstElementChild); } catch {}\n          this._initCardInteract(wrap);\n        }\n      } else {\n        this._showEmptyPlaceholder();\n        this._applyAutoScale?.();\n      }\n\n      // apply container sizing/appearance and refresh tabs UI now that cards exist\n      this._applyOptionsToDom?.(this._config);\n      this._resizeContainer();\n      try {\n        this.rootEl?.classList?.toggle?.('ddc-tabs-left-layout', this.tabsPosition === 'left');\n        this._renderTabs?.();\n        this._applyActiveTab?.();\n      } catch {}\n\n      // ---- SAVE LAYOUT ----\n      try {\n        if (this._saveTimer) clearTimeout(this._saveTimer);\n        await this._saveLayout(true);  // NOTE: ensure _saveLayout returns {\u2026, tabId} per card\n        this._toast?.('Design imported & saved. Reloading...');\n        window.location.reload();\n      } catch (e) {\n        console.warn('[ddc:import] saveLayout failed', e);\n        this._markDirty?.('import');\n        this._toast?.('Design imported \u2014 click Apply to save.');\n      }\n    } catch (e) {\n      console.error('Import failed', e);\n      this._toast?.('Import failed \u2014 invalid file.');\n    }\n  };\n\n  inp.click();\n}\n\n\n  \n  // ===== DDC: Lovelace persistence helpers (import options -> stored YAML) =====\n  _getLovelace() {\n    // Walk up from this element through shadow roots\n    let hop = 0, host = this;\n    while (host && hop++ < 20) {\n      const root = host.getRootNode?.();\n      const rHost = root?.host;\n      if (rHost?.tagName === 'HUI-ROOT') return rHost.lovelace;\n      host = rHost || host.parentElement;\n    }\n    // Breadth-first fallback\n    const seen = new Set(), q = [document];\n    while (q.length) {\n      const n = q.shift();\n      if (!n || seen.has(n)) continue;\n      seen.add(n);\n      if (n.host?.tagName === 'HUI-ROOT') return n.host.lovelace;\n      if (n.tagName === 'HUI-ROOT') return n.lovelace;\n      if (n.shadowRoot) q.push(n.shadowRoot);\n      if (n.children) for (const c of n.children) q.push(c);\n    }\n    return undefined;\n  }\n\n  _scanDdcCards(cfg) {\n    const hits = []; // { view:number, path:string[], card:object }\n    const push = (view, path, obj) => {\n      if (obj?.type === 'custom:drag-and-drop-card') hits.push({ view, path: [...path], card: obj });\n    };\n    const visit = (node, viewIdx, path) => {\n      if (!node) return;\n      if (Array.isArray(node)) { node.forEach((n, i) => visit(n, viewIdx, path.concat(i))); return; }\n      if (typeof node !== 'object') return;\n\n      if ('type' in node) push(viewIdx, path, node);\n\n      for (const [k, v] of Object.entries(node)) {\n        if (k === 'views' && Array.isArray(v)) v.forEach((vv, i) => visit(vv, i, ['views', i]));\n        else if (Array.isArray(v)) visit(v, viewIdx, path.concat(k));\n        else if (v && typeof v === 'object') visit(v, viewIdx, path.concat(k));\n      }\n    };\n    visit(cfg, -1, []);\n    return hits;\n  }\n\n  async _persistOptionsToYaml(opts, { prevKey = null, patchAllInCurrentViewIfNoKey = false } = {}) {\n    try {\n      const ll = this._getLovelace();\n      if (!ll) { console.debug('[ddc:import] persist: no lovelace root'); return false; }\n      if (typeof ll.saveConfig !== 'function') { console.debug('[ddc:import] persist: dashboard not in Storage mode'); return false; }\n\n      // Deep clone to avoid mutating live config\n      const cfg = JSON.parse(JSON.stringify(ll.config));\n      const hits = this._scanDdcCards(cfg);\n      const curView = ll.current_view ?? 0;\n\n      console.debug('[ddc:import] persist: found DDC cards', hits.map(h => ({ view: h.view, path: h.path.join('.'), storage_key: h.card.storage_key || null })));\n\n      const newKey = opts?.storage_key ?? null;\n      const keys = [];\n      if (prevKey) keys.push(prevKey);\n      if (newKey) keys.push(newKey);\n      if (this.storageKey) keys.push(this.storageKey);\n      if (this._config?.storage_key) keys.push(this._config.storage_key);\n\n      // Prefer exact key matches (either previous or new)\n      let targets = hits.filter(h => h.card.storage_key && keys.includes(h.card.storage_key));\n\n      // If no exact match: if only one DDC in current view, target it\n       if (!targets.length) {\n        const inCur = hits.filter(h => h.view === curView);\n         if (inCur.length === 1) targets = inCur;   // safe only if exactly one\n         // else: no target \u2192 abort instead of touching multiple cards\n       }\n\n      // As a last resort, if there is only one DDC overall, patch it\n      if (!targets.length && hits.length === 1) targets = hits;\n\n      if (!targets.length) {\n        console.debug('[ddc:import] persist: no target. Provide a unique storage_key on this card and import again.', { prevKey, newKey, storageKey: this.storageKey });\n        return false;\n      }\n\n       // Build a patch for options ONLY \u2014 never stamp a global storage_key into multiple cards\n       const basePatch = { type: 'custom:drag-and-drop-card', ...opts };\n       // Remove any incoming storage_key so it doesn't overwrite per-card keys accidentally\n       if ('storage_key' in basePatch) delete basePatch.storage_key;\n       if ('storageKey' in basePatch)  delete basePatch.storageKey;\n \n       for (const t of targets) {\n         // Resolve the YAML object to patch\n         let ref = cfg;\n         for (const seg of t.path) ref = ref[seg];\n \n         // Remember the card\u2019s existing key (support legacy camelCase & nested)\n         const existingKey =\n           ref?.storage_key ?? ref?.storageKey ?? ref?.options?.storage_key ?? ref?.options?.storageKey ?? null;\n \n         // Decide if this specific card is being renamed (only when prevKey\u2192newKey and it matches)\n         const shouldRename = !!(prevKey && newKey && existingKey === prevKey && newKey !== prevKey);\n \n         // Apply options WITHOUT a key\n         Object.assign(ref, basePatch);\n \n         // Restore / set the right key per-card\n         if (shouldRename) {\n           ref.storage_key = String(newKey);\n         } else if (existingKey) {\n           ref.storage_key = String(existingKey);\n         }\n         // Clean up legacy field\n         if ('storageKey' in ref) delete ref.storageKey;\n       }\n\n      console.debug('[ddc:import] persist \u2192 saving', { patched: targets.length, keysTried: keys, patch });\n      await ll.saveConfig(cfg);\n      return true;\n    } catch (e) {\n      console.warn('[ddc:import] persist error', e);\n      return false;\n    }\n  }\n/* ----------------------------- Save / load ----------------------------- */\n  _queueSave(reason='auto') {\n    // Always mark dirty so Apply becomes enabled\n    this._markDirty(reason);\n    // only queue save when autosave is enabled, not loading, and in edit mode\n    if (!this.autoSave) return;\n    // skip saving while the layout is still loading\n    if (this._loading) return;\n    // respect the user expectation that saving should only happen in edit mode\n    if (!this.editMode) return;\n    this._dbgPush('autosave', 'Queued', { reason, debounce: this.autoSaveDebounce });\n    clearTimeout(this._saveTimer);\n    this._saveTimer = setTimeout(() => this._saveLayout(true), this.autoSaveDebounce);\n  }\n\n  async _saveLayout(silent = true) {\n    const wraps = Array.from(this.cardContainer.querySelectorAll('.card-wrapper:not(.ddc-placeholder)'));\n    const saved = wraps.map((w)=>{\n      const x = parseFloat(w.getAttribute('data-x')) || 0;\n      const y = parseFloat(w.getAttribute('data-y')) || 0;\n      const width  = parseFloat(w.style.width)  || w.getBoundingClientRect().width;\n      const height = parseFloat(w.style.height) || w.getBoundingClientRect().height;\n      const z = parseInt(w.style.zIndex || '1', 10);\n      const cardCfg = this._extractCardConfig(w.firstElementChild);\n      const tabId = w.dataset.tabId || this.defaultTab;\n        return { card: cardCfg, position:{x,y}, size:{width,height}, z, tabId };\n    });\n    const payload = {\n       version: 2,\n       options: this._exportableOptions(),\n       cards: saved\n     };\n\n    try { localStorage.setItem(`ddc_local_${this.storageKey || 'default'}`, JSON.stringify(payload)); } catch {}\n\n    if (!this.storageKey) { if (!silent) this._toast('Saved locally (no storage_key set).');\n      this.__dirty = false; this._updateApplyBtn();\n      return; }\n\n    try {\n      await this._saveLayoutToBackend(this.storageKey, payload);\n      if (!silent) this._toast('Layout saved.');\n      this.__dirty = false; this._updateApplyBtn();\n    } catch (e) {\n      console.error('Backend save failed', e);\n      this._dbgPush('save', 'Backend save failed', { error: String(e) });\n      if (!silent) this._toast('Backend save failed \u2014 kept local copy.');\n    }\n  }\n\n  async _probeBackend() {\n    this._backendOK = false;\n    const t0 = performance.now();\n    try {\n      this._dbgPush('probe', 'GET /api/dragdrop_storage (list keys)');\n      const r = await this.hass.callApi('get', 'dragdrop_storage');\n      const ms = Math.round(performance.now() - t0);\n      this._dbgPush('probe', `OK (${ms} ms)`, r);\n      this._backendOK = !!r;\n    } catch (e) {\n      const ms = Math.round(performance.now() - t0);\n      this._dbgPush('probe', `FAILED (${ms} ms)`, { error: String(e) });\n      this._backendOK = false;\n    }\n    this._updateStoreBadge();\n  }\n\n  async _loadLayoutFromBackend(key) {\n    const url = `dragdrop_storage/${encodeURIComponent(key)}`;\n    const t0 = performance.now();\n    try {\n      this._dbgPush('load', `GET /api/${url}`);\n      const data = await this.hass.callApi('get', url);\n      const ms = Math.round(performance.now() - t0);\n      this._dbgPush('load', `OK (${ms} ms)`, { bytes: JSON.stringify(data||'').length });\n      return data;\n    } catch (e) {\n      const ms = Math.round(performance.now() - t0);\n      this._dbgPush('load', `FAILED (${ms} ms)`, { error: String(e) });\n      return null;\n    }\n  }\n\n  async _saveLayoutToBackend(key, data) {\n    const url = `dragdrop_storage/${encodeURIComponent(key)}`;\n    const size = JSON.stringify(data).length;\n    const t0 = performance.now();\n    try {\n      this._dbgPush('save', `POST /api/${url}`, { bytes: size });\n      const res = await this.hass.callApi('post', url, data);\n      const ms = Math.round(performance.now() - t0);\n      this._dbgPush('save', `OK (${ms} ms)`, res);\n      return res;\n    } catch (e) {\n      const ms = Math.round(performance.now() - t0);\n      this._dbgPush('save', `FAILED (${ms} ms)`, { error: String(e), bytes: size });\n      throw e;\n    }\n  }\n  async _saveOptionsToBackend(key, newOptions) {\n    try {\n      const cur = await this._loadLayoutFromBackend(key);\n      const merged = {\n        version: 2,\n        ...(cur || {}),\n        options: newOptions || this._exportableOptions?.() || {}\n      };\n      // Preserve cards array if present\n      if (cur && Array.isArray(cur.cards)) merged.cards = cur.cards;\n      await this._saveLayoutToBackend(key, merged);\n      return true;\n    } catch (e) {\n      console.warn('[ddc] saveOptionsToBackend failed', e);\n      return false;\n    }\n  }\n\n\n  _updateStoreBadge() {\n    const el = this.storeBadge; if (!el) return;\n    const usingHost = this._backendOK && !!this.storageKey;\n    el.textContent = usingHost ? 'storage: backend - OK' : 'storage: local. Your Changes are NOT being SAVED. You need to download the Drag and Drop Card backend integration';\n    el.style.background = usingHost ? 'rgba(76,175,80,.15)' : 'rgba(255,193,7,.15)';\n    el.style.borderColor = usingHost ? 'rgba(76,175,80,.45)' : 'rgba(255,193,7,.45)';\n  }\n\n  /* ----------------------------- Utilities ----------------------------- */\n\n  /* =========================== Screen saver =========================== */\n\n  /**\n   * Ensure styles for the screen saver overlay are injected once into\n   * the component's shadow root. This creates a dark overlay with a\n   * centered digital clock and date. The overlay is hidden until\n   * activated.\n   */\n  _ensureScreenSaverStyles() {\n    if (this.shadowRoot?.querySelector('#ddc-screensaver-styles')) return;\n    try {\n      const style = document.createElement('style');\n      style.id = 'ddc-screensaver-styles';\n      style.textContent = `\n        .screensaver-overlay {\n          /* Cover the entire viewport, not just the card container */\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(0, 0, 0, 0.92);\n          color: #fff;\n          opacity: 0;\n          pointer-events: none;\n          transition: opacity 0.8s ease-in;\n          z-index: 100000; /* extremely high to overlay everything */\n        }\n        .screensaver-overlay.active {\n          opacity: 1;\n          pointer-events: auto;\n          transition: opacity 0.3s ease-out;\n        }\n        /* Wrapper to center content nicely in the viewport */\n        .screensaver-overlay .screensaver-content {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n        }\n        .screensaver-overlay .screensaver-clock {\n          font-size: 5rem;\n          font-family: monospace;\n          letter-spacing: 0.1em;\n          font-weight: 700;\n          line-height: 1.2;\n          margin: 0;\n          text-align: center;\n          text-shadow: 0 0 10px rgba(255,255,255,0.8);\n        }\n        .screensaver-overlay .screensaver-date {\n          font-size: 2rem;\n          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n          font-weight: 400;\n          margin-top: 0.8rem;\n          text-align: center;\n          opacity: 0.9;\n        }\n\n        /* Calendar styles */\n        .screensaver-overlay .screensaver-calendar {\n          margin-top: 1.5rem;\n          width: 100%;\n          max-width: 600px;\n          color: #fff;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-header {\n          font-size: 2.2rem;\n          font-weight: 600;\n          text-align: center;\n          margin-bottom: 0.7rem;\n          padding-bottom: 0.3rem;\n          border-bottom: 2px solid rgba(255,255,255,0.2);\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid {\n          display: grid;\n          grid-template-columns: repeat(7, 1fr);\n          gap: 0.3rem;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div {\n          text-align: center;\n          padding: 0.35rem 0;\n          font-size: 1.0rem;\n          border-radius: 4px;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.header {\n          font-weight: 600;\n          opacity: 0.8;\n          text-transform: uppercase;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.today {\n          background: rgba(255, 255, 255, 0.3);\n          font-weight: 700;\n          color: #000;\n          border-radius: 6px;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.other-month {\n          opacity: 0.4;\n        }\n\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.weekend {\n          /* Slightly accent weekends */\n          color: #ffb074;\n        }\n      `;\n      this.shadowRoot.appendChild(style);\n    } catch (e) {\n      console.warn('[drag-and-drop-card] Failed to inject screensaver styles', e);\n    }\n  }\n\n  /**\n   * Ensure global styles for the screen saver overlay are injected into the\n   * document <head>. These styles are necessary when the screensaver\n   * overlay is attached to document.body to ensure proper layout and\n   * positioning outside of any transformed containers. Styles are only\n   * injected once per page.\n   */\n  _ensureScreenSaverGlobalStyles() {\n    if (document.head.querySelector('#ddc-screensaver-global-styles')) return;\n    try {\n      const style = document.createElement('style');\n      style.id = 'ddc-screensaver-global-styles';\n      style.textContent = `\n        .screensaver-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(0, 0, 0, 0.92);\n          color: #fff;\n          opacity: 0;\n          pointer-events: none;\n          transition: opacity 0.8s ease-in;\n          z-index: 100000;\n        }\n        .screensaver-overlay.active {\n          opacity: 1;\n          pointer-events: auto;\n          transition: opacity 0.3s ease-out;\n        }\n        .screensaver-overlay .screensaver-content {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n        }\n        .screensaver-overlay .screensaver-clock {\n          font-size: 5rem;\n          font-family: monospace;\n          letter-spacing: 0.1em;\n          font-weight: 700;\n          line-height: 1.2;\n          margin: 0;\n          text-align: center;\n          text-shadow: 0 0 10px rgba(255,255,255,0.8);\n        }\n        .screensaver-overlay .screensaver-date {\n          font-size: 2rem;\n          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n          font-weight: 400;\n          margin-top: 0.8rem;\n          text-align: center;\n          opacity: 0.9;\n        }\n        .screensaver-overlay .screensaver-calendar {\n          margin-top: 1.5rem;\n          width: 100%;\n          max-width: 600px;\n          color: #fff;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-header {\n          font-size: 2.2rem;\n          font-weight: 600;\n          text-align: center;\n          margin-bottom: 0.7rem;\n          padding-bottom: 0.3rem;\n          border-bottom: 2px solid rgba(255,255,255,0.2);\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid {\n          display: grid;\n          grid-template-columns: repeat(7, 1fr);\n          gap: 0.3rem;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div {\n          text-align: center;\n          padding: 0.35rem 0;\n          font-size: 1.0rem;\n          border-radius: 4px;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.header {\n          font-weight: 600;\n          opacity: 0.8;\n          text-transform: uppercase;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.today {\n          background: rgba(255, 255, 255, 0.3);\n          font-weight: 700;\n          color: #000;\n          border-radius: 6px;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.other-month {\n          opacity: 0.4;\n        }\n        .screensaver-overlay .screensaver-calendar .calendar-grid div.weekend {\n          color: #ffb074;\n        }\n      `;\n      document.head.appendChild(style);\n    } catch (e) {\n      console.warn('[drag-and-drop-card] Failed to inject global screensaver styles', e);\n    }\n  }\n\n  /**\n   * Create the screensaver overlay element if it does not already\n   * exist. The overlay is appended to the card container and kept\n   * hidden until activated.\n   */\n  _ensureScreenSaverOverlay() {\n    // Always ensure global screensaver styles are present when overlay is attached to document.body\n    this._ensureScreenSaverGlobalStyles();\n\n    // Determine a unique id for this overlay to avoid collisions if multiple cards exist.\n    if (!this._screenSaverOverlayId) {\n      const baseId = this.config?.id || `ddc_${Math.random().toString(36).slice(2)}`;\n      this._screenSaverOverlayId = `ddc-screensaver-overlay-${baseId}`;\n    }\n    const desiredId = this._screenSaverOverlayId;\n\n    // If overlay already exists and is attached to document.body, nothing to do\n    if (this.screenSaverOverlay && this.screenSaverOverlay.parentNode === document.body) {\n      return;\n    }\n\n    // If an overlay exists but was removed from the DOM (e.g. during rebuild), reattach it to document.body\n    if (this.screenSaverOverlay && !this.screenSaverOverlay.parentNode) {\n      document.body.appendChild(this.screenSaverOverlay);\n      return;\n    }\n\n    // Otherwise create a fresh overlay\n    const overlay = document.createElement('div');\n    overlay.className = 'screensaver-overlay';\n    overlay.id = desiredId;\n    overlay.innerHTML = `\n      <div class=\"screensaver-content\" id=\"${desiredId}-content\">\n        <div class=\"screensaver-clock\" id=\"${desiredId}-clock\"></div>\n        <div class=\"screensaver-date\" id=\"${desiredId}-date\"></div>\n        <div class=\"screensaver-calendar\" id=\"${desiredId}-calendar\"></div>\n      </div>\n    `;\n    // exit screensaver on click/touch/key\n    overlay.addEventListener('click', () => this._deactivateScreenSaver());\n    overlay.addEventListener('keydown', () => this._deactivateScreenSaver());\n    this.screenSaverOverlay = overlay;\n    document.body.appendChild(overlay);\n  }\n\n  /**\n   * Attach listeners for user activity that should reset the idle\n   * timer. Listeners are added only once and removed in\n   * disconnectedCallback().\n   */\n  _attachScreensaverListeners() {\n    if (this._screensaverActivityHandler) return;\n    const handler = () => this._resetScreensaverTimer();\n    this._screensaverActivityHandler = handler;\n    // Include a broader set of events to detect any user activity (mouse, pointer, scroll, touch)\n    this._screensaverEvents = [\n      'mousemove',\n      'mousedown',\n      'click',\n      'keydown',\n      'wheel',\n      'scroll',\n      'touchstart',\n      'touchmove',\n      'touchend',\n      'touchcancel',\n      'pointerdown',\n      'pointermove',\n      'pointerup',\n      'pointercancel'\n    ];\n    // Attach listeners to the document so any user activity inside or outside the card\n    // resets the timer. Use capture phase to ensure early invocation.\n    this._screensaverEvents.forEach(ev => {\n      document.addEventListener(ev, handler, true);\n    });\n  }\n\n  /**\n   * Reset the screensaver idle timer. If the screensaver is\n   * currently active it will be deactivated. A new timeout is\n   * scheduled using the current delay. If the screensaver is\n   * disabled, no timer will be scheduled.\n   */\n  _resetScreensaverTimer() {\n    // Always clear any existing timer\n    if (this._screensaverTimer) {\n      clearTimeout(this._screensaverTimer);\n      this._screensaverTimer = null;\n    }\n    // Evaluate whether the screensaver should be used in the current context\n    if (!this._shouldUseScreensaver()) {\n      // If a screensaver is currently active but conditions no longer allow it, hide it\n      if (this.screensaverActive) {\n        this._deactivateScreenSaver();\n      }\n      return;\n    }\n    // Hide screensaver if active before scheduling a new one\n    if (this.screensaverActive) {\n      this._deactivateScreenSaver();\n    }\n    const delay = Number(this.screenSaverDelay) || (5 * 60000);\n    this._screensaverTimer = setTimeout(() => {\n      this._activateScreenSaver();\n    }, delay);\n  }\n\n  /**\n   * Activate the screensaver overlay. Creates the overlay if\n   * necessary, updates the time immediately, and starts a clock\n   * update interval. Sets the overlay to active so CSS transitions\n   * apply.\n   */\n  _activateScreenSaver() {\n    // Only activate when conditions allow the screensaver (enabled, not editing, not in HA editor, and attached)\n    if (!this._shouldUseScreensaver()) return;\n    this._ensureScreenSaverOverlay();\n    if (!this.screenSaverOverlay) return;\n    this.screensaverActive = true;\n    this.screenSaverOverlay.classList.add('active');\n    // Hide the tabs bar while screensaver is active\n    try {\n      if (this.tabsBar) {\n        // Save current display property to restore later\n        this.__savedTabsDisplay = this.tabsBar.style.display;\n        this.tabsBar.style.display = 'none';\n      }\n    } catch {}\n    // update immediately\n    this._updateScreenSaverClock();\n    // update every second\n    if (this._clockInterval) clearInterval(this._clockInterval);\n    this._clockInterval = setInterval(() => this._updateScreenSaverClock(), 1000);\n  }\n\n  /**\n   * Deactivate the screensaver overlay, clear clock interval and\n   * schedule a new idle timer if appropriate.\n   */\n  _deactivateScreenSaver() {\n    if (!this.screensaverActive) return;\n    this.screensaverActive = false;\n    if (this.screenSaverOverlay) this.screenSaverOverlay.classList.remove('active');\n    if (this._clockInterval) {\n      clearInterval(this._clockInterval);\n      this._clockInterval = null;\n    }\n    // Restore tabs bar when screensaver deactivates\n    try {\n      if (this.tabsBar) {\n        if (this.__savedTabsDisplay != null) {\n          this.tabsBar.style.display = this.__savedTabsDisplay;\n        } else {\n          this.tabsBar.style.display = '';\n        }\n      }\n    } catch {}\n    // When user interacts, restart the timer to count idle time again\n    this._resetScreensaverTimer();\n  }\n\n  /**\n   * Update the clock and date displayed on the screensaver overlay.\n   * Uses the user's locale for formatting time and date.\n   */\n  _updateScreenSaverClock() {\n    const overlay = this.screenSaverOverlay;\n    const clockEl = overlay?.querySelector('.screensaver-clock');\n    const dateEl  = overlay?.querySelector('.screensaver-date');\n    const now = new Date();\n    if (clockEl) {\n      clockEl.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });\n    }\n    if (dateEl) {\n      dateEl.textContent = now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });\n    }\n\n    // Update calendar as well\n    try {\n      this._updateScreenSaverCalendar();\n    } catch {}\n  }\n\n  /**\n   * Update the monthly calendar displayed on the screensaver overlay. Builds\n   * a grid for the current month with weekday headers, filling leading and\n   * trailing cells from the previous and next months. Highlights today.\n   */\n  _updateScreenSaverCalendar() {\n    const calEl = this.screenSaverOverlay?.querySelector('.screensaver-calendar');\n    if (!calEl) return;\n    const now = new Date();\n    const locale = undefined; // use default locale\n    const year = now.getFullYear();\n    const month = now.getMonth();\n    // Month name\n    const monthName = now.toLocaleDateString(locale, { month: 'long' });\n    // Day names (Sunday first per Date API)\n    const dayNames = [];\n    // Use a known week starting on Sunday (1970-01-04 is a Sunday) to generate localised day names\n    for (let i = 0; i < 7; i++) {\n      const d = new Date(1970, 0, 4 + i);\n      dayNames.push(d.toLocaleDateString(locale, { weekday: 'short' }));\n    }\n    // Determine first day of current month (0=Sunday)\n    const firstDay = new Date(year, month, 1).getDay();\n    // Number of days in current month\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\n    // Number of days in previous month\n    const prevMonthDays = new Date(year, month, 0).getDate();\n    // Build weeks array of 42 cells (6 weeks * 7 days)\n    const cells = [];\n    // Leading days from previous month\n    for (let i = 0; i < firstDay; i++) {\n      cells.push({ day: prevMonthDays - (firstDay - 1) + i, other: true });\n    }\n    // Days of current month\n    for (let d = 1; d <= daysInMonth; d++) {\n      const isToday = d === now.getDate();\n      cells.push({ day: d, today: isToday, other: false });\n    }\n    // Trailing days from next month\n    while (cells.length < 42) {\n      const nextDay = cells.length - firstDay - daysInMonth + 1;\n      cells.push({ day: nextDay, other: true });\n    }\n    // Build HTML\n    let html = '';\n    // Header\n    html += `<div class=\"calendar-header\">${monthName} ${year}</div>`;\n    // Grid container\n    html += '<div class=\"calendar-grid\">';\n    // Day names header\n    for (let i = 0; i < 7; i++) {\n      html += `<div class=\"header\">${dayNames[i]}</div>`;\n    }\n    // Day cells\n    cells.forEach((cell, idx) => {\n      const classes = [];\n      if (cell.other) classes.push('other-month');\n      if (cell.today) classes.push('today');\n      // Highlight weekends\n      const weekDayIndex = idx % 7;\n      if (weekDayIndex === 0 || weekDayIndex === 6) classes.push('weekend');\n      html += `<div class=\"${classes.join(' ')}\">${cell.day}</div>`;\n    });\n    html += '</div>';\n    calEl.innerHTML = html;\n  }\n\n  /**\n   * Apply current screensaver settings. When enabled, attach\n   * listeners and schedule or reset the idle timer. When disabled,\n   * clear timers and hide the overlay.\n   */\n  _updateScreensaverSettings() {\n    // ensure overlay exists if enabling\n    if (this.screenSaverEnabled) {\n      this._ensureScreenSaverOverlay();\n      this._attachScreensaverListeners();\n      // immediately reset timer\n      this._resetScreensaverTimer();\n    } else {\n      // disable: remove timer and hide overlay\n      if (this._screensaverTimer) {\n        clearTimeout(this._screensaverTimer);\n        this._screensaverTimer = null;\n      }\n      if (this.screensaverActive) {\n        this._deactivateScreenSaver();\n      }\n    }\n  }\n\n  /**\n   * Determine if the screensaver should be used based on current state.\n   * It must be enabled, the card must not be in edit mode, not inside\n   * the Home Assistant editor preview, and still be attached to the DOM.\n   * @returns {boolean}\n   */\n  _shouldUseScreensaver() {\n    try {\n      // screenSaverEnabled controls the overall feature\n      if (!this.screenSaverEnabled) return false;\n      // Do not show while editing in drag-and-drop card\n      if (this.editMode) return false;\n      // Do not show while in HA editor preview\n      if (typeof this._isInHaEditorPreview === 'function' && this._isInHaEditorPreview()) return false;\n      // Only show when the card is currently in the DOM (on its dashboard page)\n      if (!this.isConnected) return false;\n    } catch {\n      return false;\n    }\n    return true;\n  }\n  _toast(message) {\n    const ev = new Event('hass-notification');\n    ev.detail = { message };\n    window.dispatchEvent(ev);\n  }\n  _huiRoot() {\n    try {\n      const ha   = document.querySelector('home-assistant');\n      const main = ha?.shadowRoot?.querySelector('home-assistant-main');\n      const drawer = main?.shadowRoot?.querySelector('ha-drawer') || main;\n      const ppr = drawer?.shadowRoot?.querySelector('partial-panel-resolver') || drawer;\n      const panel = ppr?.shadowRoot?.querySelector('ha-panel-lovelace') || drawer?.shadowRoot?.querySelector('ha-panel-lovelace');\n      return panel?.shadowRoot?.querySelector('hui-root') || null;\n    } catch { return null; }\n  }\n  getCardSize(){ return 3; }\n}\n\nif (!customElements.get('drag-and-drop-card')) {\n\n  Object.assign(DragAndDropCard.prototype, {\n    /* === GRID SELECT PATCH START (hooks & builder) === */\n    _updateGridButtonsVisibility() {\n      const inEdit = !!this.editMode;\n      const grid = Number(this._config?.grid ?? this._options?.grid ?? 10);\n      // Show the selectable overlay when the grid size is reasonably large.  The\n      // original threshold of 20px resulted in the overlay never activating\n      // for most default configurations (typically 10px).  Lower the threshold\n      // so that any grid size above 10px will enable the drag\u2011select overlay.\n      const bigEnough = grid >= 10;\n      const cont = this.cardContainer;\n      // When not in edit mode or the grid is too small, destroy the overlay\n      // and fall back to the traditional dotted grid lines (grid-on class).\n      if (!inEdit || !bigEnough) {\n        this._destroyGridCanvas();\n        // restore underlying grid lines only when editing\n        if (cont) cont.classList.toggle('grid-on', inEdit);\n        return;\n      }\n      // In edit mode with a sufficiently large grid, build or update the\n      // selection overlay.  Hide the underlying CSS grid lines to avoid\n      // misaligned double grids.\n      this._buildOrUpdateGridCanvas();\n      if (cont) cont.classList.remove('grid-on');\n    },\n\n    _requestGridButtonsUpdateSoon() {\n      clearTimeout(this._gridLayoutT);\n      this._gridLayoutT = setTimeout(() => this._updateGridButtonsVisibility(), 50);\n    },\n\n    _buildOrUpdateGridCanvas() {\n      const container = this.cardContainer;\n      if (!container || !container.isConnected) return;\n\n      const gridSize = Number(this._config?.grid ?? this._options?.grid ?? 10);\n      this._gridCellSize = gridSize;\n\n      if (!this._gridCanvas) {\n        const c = document.createElement('canvas');\n        c.className = 'ddc-grid-canvas';\n        // behind cards: insert as first child\n        container.insertBefore(c, container.firstChild || null);\n        this._gridCanvas = c;\n        this._gridCtx = c.getContext('2d');\n\n        c.addEventListener('pointerdown', (ev)=>this._onGridPointerDown(ev), { passive: true });\n        c.addEventListener('pointermove', (ev)=>this._onGridPointerMove(ev), { passive: true });\n        c.addEventListener('pointerup',   (ev)=>this._onGridPointerUp(ev),   { passive: true });\n        c.addEventListener('pointercancel', (ev)=>this._onGridPointerCancel(ev), { passive: true });\n        c.addEventListener('lostpointercapture', (ev)=>this._onGridPointerCancel(ev), { passive: true });\n      }\n\n      // size canvas to container (retina-aware).  When the card\n      // container is scaled (auto-resize in dynamic mode), its\n      // boundingClientRect returns the *visual* size (already\n      // multiplied by the scale factor).  If we use that width\n      // directly as the canvas size, the canvas will be scaled a\n      // second time by the container\u2019s transform.  This results in the\n      // selectable overlay being too large and misaligned.  Instead,\n      // compute the unscaled width/height by dividing by the current\n      // container scale.  The canvas is then sized to the unscaled\n      // dimensions; after the parent\u2019s transform applies, the canvas\n      // expands to the correct visual size.\n      const rect = container.getBoundingClientRect();\n      const { sx, sy } = this._getContainerScale_();\n      // guard against invalid scale values (e.g., 0 or NaN)\n      const invSX = sx && isFinite(sx) ? (1 / sx) : 1;\n      const invSY = sy && isFinite(sy) ? (1 / sy) : 1;\n      const unscaledW = rect.width  * invSX;\n      const unscaledH = rect.height * invSY;\n      const dpr = Math.max(1, window.devicePixelRatio || 1);\n      // Assign the canvas buffer dimensions using the unscaled size\n      this._gridCanvas.width  = Math.max(1, Math.round(unscaledW * dpr));\n      this._gridCanvas.height = Math.max(1, Math.round(unscaledH * dpr));\n      // Set the CSS size to the unscaled dimensions so that after\n      // scaling the canvas fills the visual space exactly\n      this._gridCanvas.style.width  = unscaledW + 'px';\n      this._gridCanvas.style.height = unscaledH + 'px';\n\n      // Compute the number of columns/rows based on the unscaled width.\n      // Dividing by the grid size in design units ensures that the\n      // overlay grid matches the underlying design grid regardless of\n      // scaling.  Use Math.ceil here so that partial cells at the\n      // right/bottom edges are included, preventing gaps when the\n      // canvas size is not an exact multiple of the grid size.\n      this._gridCols = Math.max(1, Math.ceil(unscaledW  / gridSize));\n      this._gridRows = Math.max(1, Math.ceil(unscaledH / gridSize));\n\n      // glass tile for full cell\n      this._buildGridTile_(gridSize, dpr);\n      this._markGridDirty();\n    },\n\n    _destroyGridCanvas() {\n      cancelAnimationFrame(this._gridRAF);\n      this._gridRAF = 0;\n      if (this._gridCanvas?.parentElement) this._gridCanvas.parentElement.removeChild(this._gridCanvas);\n      this._gridCanvas = null;\n      this._gridCtx = null;\n      this._gridTile = null;\n      this._gridDown = false;\n      this._gridHoverCol = this._gridHoverRow = -1;\n    },\n    /* === GRID SELECT PATCH END (hooks & builder) === */\n\n    /* === GRID SELECT PATCH START (rendering) === */\n    // Draw the full grid cell (no inner padding/gap) so visuals match actual grid cells\n    _buildGridTile_(gridSize, dpr) {\n\n      gridSize = gridSize / 2;\n      \n      const r = Math.min(10, gridSize * 0.25);\n      const tw = Math.max(1, Math.round(gridSize * dpr));\n      const th = tw;\n\n      const off = document.createElement('canvas');\n      off.width = tw;\n      off.height = th;\n      const ctx = off.getContext('2d');\n      ctx.scale(dpr, dpr);\n\n      const x = 0, y = 0, w = gridSize, h = gridSize;\n      ctx.clearRect(0, 0, tw, th);\n      ctx.beginPath();\n      const rr = Math.min(r, w/2, h/2);\n      ctx.moveTo(x+rr, y);\n      ctx.arcTo(x+w, y, x+w, y+h, rr);\n      ctx.arcTo(x+w, y+h, x, y+h, rr);\n      ctx.arcTo(x, y+h, x, y, rr);\n      ctx.arcTo(x, y, x+w, y, rr);\n      ctx.closePath();\n\n      ctx.fillStyle = 'rgba(255,255,255,0.08)';\n      ctx.fill();\n      ctx.strokeStyle = 'rgba(255,255,255,0.12)';\n      ctx.lineWidth = 1;\n      ctx.stroke();\n\n      this._gridTile = off;\n    },\n\n    _markGridDirty() {\n      if (this._gridDirty) return;\n      this._gridDirty = true;\n      this._gridRAF = requestAnimationFrame(() => {\n        this._gridDirty = false;\n        this._renderGridCanvas_();\n      });\n    },\n\n    _renderGridCanvas_() {\n      const c = this._gridCanvas; if (!c) return;\n      const ctx = this._gridCtx;\n      const dpr = Math.max(1, window.devicePixelRatio || 1);\n      const grid = this._gridCellSize || 10;\n      const scale = this._canvasScale || 1;  \n\n      ctx.clearRect(0, 0, c.width, c.height);\n\n      if (this._gridTile) {\n        const pat = ctx.createPattern(this._gridTile, 'repeat');\n        // Offset the pattern by the container's padding so the rendered\n        // squares align perfectly with the underlying CSS grid lines.\n        // Draw the grid pattern starting at the canvas origin (0,0).\n        // The selectable cells use the same grid origin (0,0) relative to\n        // the canvas, so aligning the pattern origin with the canvas\n        // origin ensures that the visual grid exactly matches the\n        // interactive grid.  No translation is needed; simply fill the\n        // entire canvas with the repeating pattern.\n        ctx.save();\n        ctx.scale(dpr, dpr);\n        ctx.fillStyle = pat;\n        ctx.fillRect(0, 0, c.width / dpr, c.height / dpr);\n        ctx.restore();\n      }\n\n      // Hover cell \u2013 full cell bounds.  Use a more visible accent color\n      // so that hovered cells stand out clearly on the grid.  Increase\n      // both fill and stroke opacity for better contrast.\n      if (this._gridHoverCol >= 0 && this._gridHoverRow >= 0) {\n        ctx.save();\n        ctx.scale(dpr, dpr);\n        // Hover cell \u2013 full cell bounds.  Increase the fill and stroke\n        // opacity so the hovered cell stands out clearly against the\n        // grid pattern.  A more saturated accent color makes the\n        // interactive area obvious.\n        ctx.fillStyle = 'rgba(0, 160, 255, 0.30)';\n        ctx.strokeStyle = 'rgba(0, 160, 255, 0.60)';\n        ctx.lineWidth = 1;\n\n        const x = this._gridHoverCol * grid;\n        const y = this._gridHoverRow * grid;\n        const w = grid;\n        const h = grid;\n\n        this._roundRect_(ctx, x, y, w, h, Math.min(10, grid * 0.25));\n        ctx.fill();\n        ctx.stroke();\n        ctx.restore();\n      }\n\n      // Selection rectangle \u2013 full grid cells, no insets\n      if (this._gridDown && this._gridStartCol >= 0 && this._gridStartRow >= 0 &&\n          this._gridCurrCol  >= 0 && this._gridCurrRow  >= 0) {\n\n        const minCol = Math.min(this._gridStartCol, this._gridCurrCol);\n        const maxCol = Math.max(this._gridStartCol, this._gridCurrCol);\n        const minRow = Math.min(this._gridStartRow, this._gridCurrRow);\n        const maxRow = Math.max(this._gridStartRow, this._gridCurrRow);\n\n        const x = minCol * grid * scale;\n        const y = minRow * grid * scale;\n        const w = (maxCol - minCol + 1) * grid * scale;\n        const h = (maxRow - minRow + 1) * grid * scale;\n\n        ctx.save();\n        ctx.scale(dpr, dpr);\n        ctx.fillStyle = 'rgba(0, 160, 255, 0.22)';\n        ctx.strokeStyle = 'rgba(0, 160, 255, 0.45)';\n        ctx.lineWidth = 2;\n        this._roundRect_(ctx, x, y, w, h, Math.min(12, grid * 0.3));\n        ctx.fill();\n        ctx.stroke();\n        ctx.restore();\n      }\n    },\n\n    _roundRect_(ctx, x, y, w, h, r) {\n      const rr = Math.min(r, w/2, h/2);\n      ctx.beginPath();\n      ctx.moveTo(x+rr, y);\n      ctx.arcTo(x+w, y, x+w, y+h, rr);\n      ctx.arcTo(x+w, y+h, x, y+h, rr);\n      ctx.arcTo(x, y+h, x, y, rr);\n      ctx.arcTo(x, y, x+w, y, rr);\n      ctx.closePath();\n    },\n    /* === GRID SELECT PATCH END (rendering) === */\n\n    /* === GRID SELECT PATCH START (interaction) === */\n    _emptySpaceAt_(clientX, clientY) {\n      const el = document.elementFromPoint(clientX, clientY);\n      return !el || !el.closest || !el.closest('.card-wrapper, .resize-handle, .ddc-chip, .shield');\n    },\n\n    _locToCell_(clientX, clientY) {\n      const c = this._gridCanvas;\n      if (!c) return { col: -1, row: -1 };\n      const rect = c.getBoundingClientRect();\n      const { sx, sy } = this._getContainerScale_();\n      const x = (clientX - rect.left) / (sx || 1);\n      const y = (clientY - rect.top)  / (sy || 1);\n      const grid = this._gridCellSize || 10;\n      const col = Math.min(this._gridCols - 1, Math.max(0, Math.floor(x / grid)));\n      const row = Math.min(this._gridRows - 1, Math.max(0, Math.floor(y / grid)));\n      return { col, row };\n    },\n\n    _onGridPointerDown(ev) {\n      if (!this._emptySpaceAt_(ev.clientX, ev.clientY)) return;\n      const { col, row } = this._locToCell_(ev.clientX, ev.clientY);\n      this._gridDown = true;\n      this._gridStartCol = col;\n      this._gridStartRow = row;\n      this._gridCurrCol = col;\n      this._gridCurrRow = row;\n      this._markGridDirty();\n      ev.currentTarget.setPointerCapture?.(ev.pointerId);\n    },\n\n    _onGridPointerMove(ev) {\n      const { col: hcol, row: hrow } = this._locToCell_(ev.clientX, ev.clientY);\n      if (hcol !== this._gridHoverCol || hrow !== this._gridHoverRow) {\n        this._gridHoverCol = hcol;\n        this._gridHoverRow = hrow;\n        this._markGridDirty();\n      }\n      if (!this._gridDown) return;\n      const { col, row } = this._locToCell_(ev.clientX, ev.clientY);\n      if (col !== this._gridCurrCol || row !== this._gridCurrRow) {\n        this._gridCurrCol = col;\n        this._gridCurrRow = row;\n        this._markGridDirty();\n      }\n    },\n\n    async _onGridPointerUp(_ev) {\n      if (!this._gridDown) return;\n      this._gridDown = false;\n\n      const minCol = Math.min(this._gridStartCol, this._gridCurrCol);\n      const maxCol = Math.max(this._gridStartCol, this._gridCurrCol);\n      const minRow = Math.min(this._gridStartRow, this._gridCurrRow);\n      const maxRow = Math.max(this._gridStartRow, this._gridCurrRow);\n      const cellsCount = (maxCol - minCol + 1) * (maxRow - minRow + 1);\n\n      if (cellsCount < 2) { this._markGridDirty(); return; }\n\n      const grid = this._gridCellSize || 10;\n      const x = minCol * grid;\n      const y = minRow * grid;\n      const w = (maxCol - minCol + 1) * grid;\n      const h = (maxRow - minRow + 1) * grid;\n\n      this._markGridDirty();\n      this._promptNewCardForRect_({ x, y, w, h });\n    },\n\n    _onGridPointerCancel() {\n      this._gridDown = false;\n      this._markGridDirty();\n    },\n    /* === GRID SELECT PATCH END (interaction) === */\n\n    /* === GRID SELECT PATCH START (lifecycle wiring) === */\n    _installGridObservers_() {\n      try {\n        if (this.__gridRO) this.__gridRO.disconnect();\n        this.__gridRO = new ResizeObserver(() => this._requestGridButtonsUpdateSoon());\n        if (this.cardContainer) this.__gridRO.observe(this.cardContainer);\n      } catch {}\n      clearInterval(this.__gridPollT);\n      this.__gridPrevEditMode = undefined;\n      this.__gridPollT = setInterval(() => {\n        const now = !!this.editMode;\n        if (now !== this.__gridPrevEditMode) {\n          this.__gridPrevEditMode = now;\n          this._updateGridButtonsVisibility();\n        }\n      }, 300);\n    },\n\n    _uninstallGridObservers_() {\n      try { this.__gridRO?.disconnect?.(); } catch {}\n      this.__gridRO = null;\n      clearInterval(this.__gridPollT);\n      this.__gridPollT = null;\n    },\n    /* === GRID SELECT PATCH END (lifecycle wiring) === */\n\n    /* === GRID SELECT PATCH START (helpers) === */\n    // Map a canvas-space rect (x,y,w,h) into the container/card coordinate space\n    _gridRectToCardRect_({ x, y, w, h }) {\n      const container = this.cardContainer;\n      const canvas = this._gridCanvas;\n      if (!container || !canvas) return { x, y, w, h };\n\n      // In dynamic modes the selection coordinates (x,y,w,h) are\n      // expressed in unscaled design units (grid cell multiples).  When\n      // the container is scaled via a CSS transform, we must *not*\n      // divide by the scale factor here: the design units already\n      // correspond to the unscaled layout.  Instead simply add the\n      // container\u2019s padding, border and scroll offsets.  This differs\n      // from the original implementation which divided by the scale to\n      // compensate for a canvas sized to the scaled dimensions.\n      const cs = getComputedStyle(container);\n      const padL = parseFloat(cs.paddingLeft)  || 0;\n      const padT = parseFloat(cs.paddingTop)   || 0;\n      const bordL = parseFloat(cs.borderLeftWidth) || 0;\n      const bordT = parseFloat(cs.borderTopWidth)  || 0;\n\n      const scrollX = container.scrollLeft || 0;\n      const scrollY = container.scrollTop  || 0;\n\n      const cx = x + padL + bordL + scrollX;\n      const cy = y + padT + bordT + scrollY;\n      const cw = w;\n      const ch = h;\n\n      return { x: cx, y: cy, w: cw, h: ch };\n    },\n\n    // Get container's transform scale (matrix or matrix3d). Defaults to 1 if none.\n    _getContainerScale_() {\n      const el = this.cardContainer;\n      if (!el) return { sx: 1, sy: 1 };\n      const t = getComputedStyle(el).transform;\n      if (!t || t === 'none') return { sx: 1, sy: 1 };\n\n      const m2d = t.match(/matrix\\(([^)]+)\\)/);\n      if (m2d) {\n        const [a,, , d] = m2d[1].split(',').map(v => parseFloat(v.trim()));\n        return { sx: (isFinite(a) && a) ? a : 1, sy: (isFinite(d) && d) ? d : 1 };\n      }\n      const m3d = t.match(/matrix3d\\(([^)]+)\\)/);\n      if (m3d) {\n        const p = m3d[1].split(',').map(v => parseFloat(v.trim()));\n        return { sx: (isFinite(p[0]) && p[0]) ? p[0] : 1, sy: (isFinite(p[5]) && p[5]) ? p[5] : 1 };\n      }\n      return { sx: 1, sy: 1 };\n    },\n\n    // Convert a canvas-space rect (x,y,w,h) to container's absolute-position CSS pixels\n    _canvasRectToContainerRect_({ x, y, w, h }) {\n      const container = this.cardContainer;\n      const canvas = this._gridCanvas;\n      if (!container || !canvas) return { x, y, w, h };\n\n      const contCS = getComputedStyle(container);\n      const padL = parseFloat(contCS.paddingLeft)  || 0;\n      const padT = parseFloat(contCS.paddingTop)   || 0;\n      const bL   = parseFloat(contCS.borderLeftWidth) || 0;\n      const bT   = parseFloat(contCS.borderTopWidth)  || 0;\n      const { sx, sy } = this._getContainerScale_();\n\n      const canvRect = canvas.getBoundingClientRect();\n      const contRect = container.getBoundingClientRect();\n\n      const viewportX = canvRect.left + x;\n      const viewportY = canvRect.top  + y;\n\n      let dx = viewportX - contRect.left;\n      let dy = viewportY - contRect.top;\n\n      // border-box \u2192 padding-box (also subtract borders)\n      dx -= (padL + bL);\n      dy -= (padT + bT);\n\n\n\n      const invSX = sx ? 1 / sx : 1;\n      const invSY = sy ? 1 / sy : 1;\n\n      const outX = dx * invSX;\n      const outY = dy * invSY;\n      const outW = (w * invSX);\n      const outH = (h * invSY);\n\n      return { x: outX, y: outY, w: outW, h: outH };\n    },\n    /* === GRID SELECT PATCH END (helpers) === */\n\n    /* === GRID SELECT PATCH START (add card bridge) === */\n    // Store the selection rect and let the normal picker flow run.\n    // The shim below will place the card at this rect instead of the default spot.\n    /* === GRID SELECT PATCH START (add card bridge) === */\n    // Store the selection rect and let the normal picker flow run.\n    // The shim below will place the card at this rect instead of the default spot.\n    async _promptNewCardForRect_({ x, y, w, h }) {\n      try {\n        const g = this._gridCellSize || Number(this._config?.grid ?? this._options?.grid ?? 10);\n        const snap = v => Math.round(v / g) * g;\n        const sx = snap(x), sy = snap(y), sw = Math.max(g, snap(w)), sh = Math.max(g, snap(h));\n\n        // Map the snapped canvas-space rect into the card container coordinate space.\n        // When the layout is scaled (auto-resize in dynamic mode), the\n        // container may be transformed and scrolled, so we use the\n        // grid-to-card mapping which compensates for padding, borders, scroll\n        // and scale.  In strict auto size mode the container is resized\n        // instead of transformed, so we fall back to the canvas\u2192container\n        // mapping that accounts for differences between the canvas and\n        // container bounding boxes.  If neither helper exists we use the\n        // snapped values directly.\n        let mapped;\n        try {\n          const mode = String((this.containerSizeMode || this.container_size_mode || 'dynamic')).toLowerCase();\n          if (mode === 'auto' && typeof this._canvasRectToContainerRect_ === 'function') {\n            mapped = this._canvasRectToContainerRect_({ x: sx, y: sy, w: sw, h: sh });\n          } else if (typeof this._gridRectToCardRect_ === 'function') {\n            mapped = this._gridRectToCardRect_({ x: sx, y: sy, w: sw, h: sh });\n          } else {\n            mapped = { x: sx, y: sy, w: sw, h: sh };\n          }\n        } catch {\n          mapped = { x: sx, y: sy, w: sw, h: sh };\n        }\n\n        const finalRect = {\n          x: Math.round(mapped.x),\n          y: Math.round(mapped.y),\n          w: Math.round(mapped.w),\n          h: Math.round(mapped.h),\n        };\n\n        // --- NEW: if 2+ cards already in this area, do NOT open the picker ---\n        try {\n          const cont = this.cardContainer;\n          if (cont) {\n            const wraps = Array.from(\n              cont.querySelectorAll('.card-wrapper:not(.ddc-placeholder)')\n            );\n\n            const currentTab = this._normalizeTabId(this.activeTab || this.defaultTab);\n            const intersects = (r1, r2) => !(\n              r2.x >= r1.x + r1.w ||\n              r2.x + r2.w <= r1.x ||\n              r2.y >= r1.y + r1.h ||\n              r2.y + r2.h <= r1.y\n            );\n\n            let hitCount = 0;\n\n            for (const wEl of wraps) {\n              // Only consider cards on the active tab\n              const tabId = wEl.dataset.tabId\n                ? this._normalizeTabId(wEl.dataset.tabId)\n                : currentTab;\n              if (tabId !== currentTab) continue;\n\n              // Skip hidden cards\n              const cs = getComputedStyle(wEl);\n              if (cs.display === 'none' || cs.visibility === 'hidden') continue;\n\n              const wx = parseFloat(wEl.getAttribute('data-x')) || 0;\n              const wy = parseFloat(wEl.getAttribute('data-y')) || 0;\n              const ww = parseFloat(wEl.style.width)  || wEl.getBoundingClientRect().width;\n              const wh = parseFloat(wEl.style.height) || wEl.getBoundingClientRect().height;\n\n              const cardRect = { x: wx, y: wy, w: ww, h: wh };\n\n              if (intersects(finalRect, cardRect)) {\n                hitCount++;\n                if (hitCount >= 2) break;\n              }\n            }\n\n            if (hitCount >= 2) {\n              // Too many cards already in this selection area: abort add\n              this.__pendingAddRect = null;\n              try { this._toast?.('Area already contains multiple cards.'); } catch {}\n              return;\n            }\n          }\n        } catch (err) {\n          console.warn('[ddc] selection-area card count check failed', err);\n        }\n        // --- END NEW LOGIC ---\n\n        // Normal flow: store rect and open HA card picker\n        this.__pendingAddRect = finalRect;\n        await this._openSmartPicker('add', null, null);\n      } catch (e) {\n        console.warn('[ddc] _promptNewCardForRect_ failed', e);\n      }\n    }\n/* === GRID SELECT PATCH END (add card bridge) === */\n    /* === GRID SELECT PATCH END (add card bridge) === */\n  });\n\n  // --- BEGIN: selection-rect placement shim ---\nif (!DragAndDropCard.prototype.__addPickedPatched) {\n  const __origAddPicked = DragAndDropCard.prototype._addPickedCardToLayout;\n\n  DragAndDropCard.prototype._addPickedCardToLayout = async function (cardConfig) {\n    // If a selection rect is pending, place the new card exactly there.\n    if (this && this.__pendingAddRect) {\n      const { x, y, w, h } = this.__pendingAddRect;\n      this.__pendingAddRect = null; // consume it\n\n      try { this._hideEmptyPlaceholder?.(); } catch {}\n\n      const cardEl = await this._createCard(cardConfig);\n      const wrap   = this._makeWrapper(cardEl);\n\n      // Determine mode: auto vs everything else\n      const mode = String(\n        this.containerSizeMode ||\n        this.container_size_mode ||\n        this._config?.container_size_mode ||\n        'dynamic'\n      ).toLowerCase();\n\n      // In auto mode we use 0 offset; otherwise 11 px up/left\n      const isAuto = mode === 'auto';\n      const offX   = isAuto ? -11 : 11;\n      const offY   = isAuto ? -11 : 11;\n\n      const posX = Math.round(x) - offX;\n      const posY = Math.round(y) - offY;\n\n      this._setCardPosition(wrap, posX, posY);\n      wrap.style.width  = `${Math.round(w)}px`;\n      wrap.style.height = `${Math.round(h)}px`;\n\n      // Ensure new cards are above the grid overlay\n      {\n        const nextVal = this._highestZ() + 1;\n        wrap.style.zIndex = String(Math.max(nextVal, 6));\n      }\n\n      wrap.dataset.tabId = this._normalizeTabId(this.activeTab || this.defaultTab);\n      this.cardContainer.appendChild(wrap);\n\n      try { this._rebuildOnce?.(wrap.firstElementChild); } catch {}\n      try { this._initCardInteract?.(wrap); } catch {}\n      try { this._resizeContainer?.(); } catch {}\n      try { this._queueSave?.('add'); } catch {}\n      try { this._toast?.('Card added to selection.'); } catch {}\n      try { this._syncEmptyStateUI?.(); } catch {}\n      try { this._applyVisibility_?.(); } catch {}\n\n      // Keep your existing auto-resize / grid refresh behaviour\n      requestAnimationFrame(() => {\n        try {\n          const modeNow = String(\n            this.containerSizeMode ||\n            this.container_size_mode ||\n            this._config?.container_size_mode ||\n            'dynamic'\n          ).toLowerCase();\n\n          if (modeNow === 'auto') {\n            this._applyAutoFillNoScale?.();\n          } else if (this.autoResizeCards) {\n            this._applyAutoScale?.();\n          }\n          this._requestGridButtonsUpdateSoon?.();\n        } catch {}\n      });\n\n      return; // handled by shim\n    }\n\n    // Fallback to the original behavior (no selection rect)\n    return await __origAddPicked.call(this, cardConfig);\n  };\n\n  DragAndDropCard.prototype.__addPickedPatched = true;\n}\n  // --- END: selection-rect placement shim ---\n\n  customElements.define('drag-and-drop-card', DragAndDropCard);\n\n  /*\n   * Register this card with Home Assistant\u2019s card picker.  The HA dashboard\n   * editor discovers custom cards by reading a global `window.customCards`\n   * array.  Each entry in that array is an object describing a custom\n   * card.  Without registering here, the drag\u2011and\u2011drop card will not\n   * appear in the \u201CCustom\u201D section of the card picker and users must\n   * manually add it via YAML.  To fix that, we push a descriptor into\n   * `window.customCards` if one isn\u2019t already present.  See the Home\n   * Assistant developer docs for the expected fields.\n   */\n  try {\n    // Ensure the registry exists\n    if (!Array.isArray(window.customCards)) {\n      window.customCards = [];\n    }\n    // Avoid duplicate registrations (multiple script loads)\n    const exists = window.customCards.some((c) => c && typeof c.type === 'string' && c.type.toLowerCase() === 'custom:drag-and-drop-card');\n    if (!exists) {\n      window.customCards.push({\n        // Use the tag name here (no `custom:` prefix) as required by the HA\n        // card picker.  See the example in the developer docs\u301020940309320886\u2020L345-L347\u3011.\n        type: 'drag-and-drop-card',\n        name: 'Drag & Drop Card',\n        description: 'Flexible grid layout card with drag\u2011and\u2011drop editing.',\n        // Do not enable the preview; the card\u2019s dynamic nature means\n        // generating a static preview isn\u2019t meaningful.  Setting this to\n        // false matches the behaviour of the original implementation.\n        preview: false,\n        // Icon shown in the card picker (optional)\n        icon: 'mdi:cursor-move'\n      });\n    }\n  } catch (e) {\n    console.warn('[drag-and-drop-card] Failed to register card in customCards', e);\n  }\n}\n\n\n\n/* ==========================================================================\n   Integrated card-mod compatibility enhancements\n   - Ensures card-mod styles apply to nested cards inside drag-and-drop-card\n   - No extra resource needed; executed as part of this script\n   - Uses a guarded (WeakSet) ll-rebuild dispatch on newly added card elements\n   ========================================================================== */\n(() => {\n  const SEEN = new WeakSet();\n\n  const isLikelyCard = (el) => {\n    try {\n      if (!(el instanceof Element)) return false;\n      const n = el.localName || \"\";\n      if (!n) return false;\n      if (n === \"ha-card\") return true;\n      if (n.endsWith(\"-card\")) return true; // hui-*, custom:*, mushroom-*, etc.\n      return false;\n    } catch { return false; }\n  };\n\n  const rebuildOnce = (el) => {\n    try {\n      if (!el || SEEN.has(el)) return;\n      SEEN.add(el);\n      el.dispatchEvent(new Event('ll-rebuild', { bubbles: true, composed: true }));\n    } catch {}\n  };\n\n  const deepScan = (root) => {\n    try {\n      if (!root) return;\n      if (root instanceof Element && isLikelyCard(root)) rebuildOnce(root);\n      const all = (root instanceof ShadowRoot ? root : root).querySelectorAll?.(\"*\");\n      if (!all) return;\n      for (const el of all) {\n        if (isLikelyCard(el)) rebuildOnce(el);\n        const sr = el.shadowRoot;\n        if (sr) { try { deepScan(sr); } catch {} }\n      }\n    } catch {}\n  };\n\n  const installOnInstance = (host) => {\n    try {\n      if (!host || host.__ddcCardModIntegrated) return;\n      host.__ddcCardModIntegrated = true;\n      const root = host.shadowRoot || host;\n\n      // Initial scan (covers already rendered children)\n      deepScan(root);\n\n      // Observe newly added content within the card\n      const mo = new MutationObserver((muts) => {\n        for (const m of muts) {\n          if (!m.addedNodes || !m.addedNodes.length) continue;\n          for (const n of m.addedNodes) {\n            if (n instanceof Element || n instanceof ShadowRoot) {\n              deepScan(n);\n            }\n          }\n        }\n      });\n      mo.observe(root, { childList: true, subtree: true });\n      host.__ddcCardModIntegratedObserver = mo;\n\n      // Follow-up scans for lazy renders\n      setTimeout(() => { try { deepScan(root); } catch {} }, 250);\n      setTimeout(() => { try { deepScan(root); } catch {} }, 1000);\n    } catch {}\n  };\n\n  const hookExisting = () => {\n    try {\n      document.querySelectorAll(\"drag-and-drop-card\").forEach(installOnInstance);\n    } catch {}\n  };\n\n  if (window.customElements && window.customElements.whenDefined) {\n    window.customElements.whenDefined(\"drag-and-drop-card\").then(() => {\n      // Install on existing instances\n      hookExisting();\n      // Patch prototype to auto-install on future instances\n      const ctor = window.customElements.get(\"drag-and-drop-card\");\n      if (ctor && ctor.prototype) {\n        const origConnected = ctor.prototype.connectedCallback;\n        ctor.prototype.connectedCallback = function() {\n          try { origConnected && origConnected.call(this); } finally {\n            installOnInstance(this);\n          }\n        };\n      }\n      // As a fallback, watch the DOM for new instances\n      const docObserver = new MutationObserver(() => hookExisting());\n      docObserver.observe(document.documentElement, { childList: true, subtree: true });\n    });\n  } else {\n    // Very old environment: periodic best-effort scan\n    const iv = setInterval(hookExisting, 1000);\n    setTimeout(() => clearInterval(iv), 10000);\n  }\n})();\n\n/* ==== DDC AUGMENTATION v6: backup on persist + inline toolbar switcher + load-by-key + edit-mode visibility ==== */\n(function(){\n  const tag = 'drag-and-drop-card';\n  const Cls = customElements.get(tag);\n  if (!Cls) { console.warn('[ddc:augment] Could not find custom element', tag); return; }\n\n  function _getLovelace() {\n    try {\n      let hop = 0, host = this;\n      while (host && hop++ < 20) {\n        const root = host.getRootNode?.();\n        const rHost = root?.host;\n        if (rHost?.tagName === 'HUI-ROOT') return rHost.lovelace;\n        host = rHost || host.parentElement;\n      }\n      const seen = new Set(), q = [document];\n      while (q.length) {\n        const n = q.shift();\n        if (!n || seen.has(n)) continue;\n        seen.add(n);\n        if (n.host?.tagName === 'HUI-ROOT') return n.host.lovelace;\n        if (n.tagName === 'HUI-ROOT') return n.lovelace;\n        if (n.shadowRoot) q.push(n.shadowRoot);\n        if (n.children) for (const c of n.children) q.push(c);\n      }\n    } catch(e) {}\n    return undefined;\n  }\n  function _scanDdcCards(cfg) {\n    const hits = [];\n    const push = (view, path, obj) => { if (obj?.type === 'custom:drag-and-drop-card') hits.push({ view, path: [...path], card: obj }); };\n    const visit = (node, viewIdx, path) => {\n      if (!node) return;\n      if (Array.isArray(node)) { node.forEach((n, i) => visit(n, viewIdx, path.concat(i))); return; }\n      if (typeof node !== 'object') return;\n      if ('type' in node) push(viewIdx, path, node);\n      for (const [k, v] of Object.entries(node)) {\n        if (k === 'views' && Array.isArray(v)) v.forEach((vv, i) => visit(vv, i, ['views', i]));\n        else if (Array.isArray(v)) visit(v, viewIdx, path.concat(k));\n        else if (v && typeof v === 'object') visit(v, viewIdx, path.concat(k));\n      }\n    };\n    visit(cfg, -1, []);\n    return hits;\n  }\n  function _makeYamlBackup(llConfig, targets, patch) {\n    const when = new Date().toISOString().replace(/[:.]/g,'-');\n    const items = targets.map(t => {\n      let ref = llConfig;\n      for (const seg of t.path) ref = ref[seg];\n      return { view: t.view, path: t.path, storage_key: (ref && ref.storage_key) || null, before: ref, patch };\n    });\n    const backup = { kind: 'ddc-import-backup', created_at: when, count: items.length, items };\n    try {\n      const key = `ddc.backup.${when}`;\n      localStorage.setItem(key, JSON.stringify(backup));\n      const all = Object.keys(localStorage).filter(k => k.startsWith('ddc.backup.')).sort().reverse();\n      for (const k of all.slice(10)) localStorage.removeItem(k);\n    } catch(e){}\n    return { name: `ddc_backup_${when}.json`, data: backup };\n  }\n  function _offerBackupDownload(name, obj) {\n    try {\n      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });\n      const url  = URL.createObjectURL(blob);\n      const a    = document.createElement('a');\n      a.href = url; a.download = name;\n      document.body.appendChild(a); a.click(); a.remove();\n      setTimeout(() => URL.revokeObjectURL(url), 1500);\n    } catch(e){ console.warn('[ddc:backup] download failed', e); }\n  }\n  function _recordRecentKey(key) {\n    if (!key) return;\n    try {\n      const K = 'ddc.recent.keys';\n      const arr = JSON.parse(localStorage.getItem(K) || '[]');\n      if (!arr.includes(key)) arr.unshift(key);\n      localStorage.setItem(K, JSON.stringify(arr.slice(0, 20)));\n    } catch {}\n  }\n  function _getRecentKeys() {\n    try { return JSON.parse(localStorage.getItem('ddc.recent.keys') || '[]'); } catch { return []; }\n  }\n  function _collectBackupKeys() {\n    const keys = new Set();\n    try {\n      const names = Object.keys(localStorage).filter(k => k.startsWith('ddc.backup.')).sort().reverse();\n      for (const name of names) {\n        try {\n          const obj = JSON.parse(localStorage.getItem(name) || 'null');\n          if (obj && obj.items) {\n            for (const it of obj.items) {\n              const sk = it?.before?.storage_key || it?.patch?.storage_key;\n              if (sk) keys.add(sk);\n            }\n          }\n        } catch {}\n      }\n    } catch {}\n    return Array.from(keys);\n  }\nasync function _persistOptionsToYaml(opts, {\n  forceTargetKey = null,   // when set, import ONLY into card with this key\n  onlyThisCard   = false,  // reserved; current impl always enforces single-card import\n  prevKey,\n  noDownload\n} = {}) {\n  const ll = this._getLovelace?.() || _getLovelace.call(this);\n  if (!ll) { console.debug('[ddc:import] persist: no lovelace root'); return false; }\n  if (typeof ll.saveConfig !== 'function') { console.debug('[ddc:import] persist: dashboard not in Storage mode'); return false; }\n\n  // Determine the EXACT key we will import into (the clicked card)\n  const norm = (s) => (typeof s === 'string' ? s.trim() : null);\n  const myKey =\n    norm(forceTargetKey) ||\n    norm(this?._config?.storage_key) ||\n    norm(this?.storageKey) ||\n    norm(prevKey);\n\n  if (!myKey) {\n    console.warn('[ddc:import] persist: missing target storage_key on this card; aborting');\n    return false;\n  }\n\n  // Clone config and scan\n  const cfg  = JSON.parse(JSON.stringify(ll.config));\n  const hits = (this._scanDdcCards || _scanDdcCards)(cfg);\n\n  console.debug('[ddc:import] persist: found DDC cards',\n    hits.map(h => ({\n      view: h.view,\n      path: h.path.join('.'),\n      storage_key: (h.card && (h.card.storage_key || h.card.storageKey)) || null\n    }))\n  );\n\n  // Select exactly one target by key (no \u201Cpatch-all-in-view\u201D fallback)\n  let targets = hits.filter(h => {\n    const sk =\n      norm(h.card?.storage_key) ??\n      norm(h.card?.storageKey) ??\n      norm(h.card?.options?.storage_key) ??\n      norm(h.card?.options?.storageKey);\n    return sk === myKey;\n  });\n\n  if (targets.length !== 1) {\n    console.warn('[ddc:import] persist: expected exactly one target with key, got', targets.length, { myKey });\n    return false;\n  }\n\n  // Build patch WITHOUT storage_key so we don't overwrite per-card keys\n  const patch = { type: 'custom:drag-and-drop-card', ...(opts || {}) };\n  if ('storage_key' in patch)  delete patch.storage_key;\n  if ('storageKey'  in patch)  delete patch.storageKey;\n  if (patch?.options) {\n    if ('storage_key' in patch.options) delete patch.options.storage_key;\n    if ('storageKey'  in patch.options) delete patch.options.storageKey;\n  }\n     // IMPORTANT: do NOT put the actual layout into Lovelace YAML\n   const cardsForStorage = Array.isArray(patch.cards) ? patch.cards : null;\n   delete patch.cards;\n\n  // Optional: backup (keeps your previous behavior if helpers exist)\n  try {\n    const backup = _makeYamlBackup?.(ll.config, targets, patch);\n    if (backup) {\n      console.debug('[ddc:import] backup created', { file: backup.name, items: backup.data?.count });\n      if (!noDownload && typeof _offerBackupDownload === 'function') _offerBackupDownload(backup.name, backup.data);\n    }\n  } catch (e) {\n    console.debug('[ddc:import] backup skipped/error:', e?.message || e);\n  }\n\n  // Apply to the single matched ref\n  const t = targets[0];\n  let ref = cfg;\n  for (const seg of t.path) ref = ref[seg];\n\n  const existingKey =\n    norm(ref?.storage_key) ??\n    norm(ref?.storageKey) ?? null;\n\n  Object.assign(ref, patch);\n\n  // Preserve the original key on this card\n  if (existingKey) {\n    ref.storage_key = existingKey;\n  } else {\n    ref.storage_key = myKey;\n  }\n  if ('storageKey' in ref) delete ref.storageKey;\n\n  console.debug('[ddc:import] persist \u2192 saving', {\n    patched: 1,\n    into_key: ref.storage_key,\n    ignored_file_key: norm(opts?.storage_key) || norm(opts?.storageKey) || null\n  });\n\n  await ll.saveConfig(cfg);\n  // Let the caller know if there were cards to save elsewhere\n  return { yamlSaved: true, cardsForStorage };\n}\n\n  async function _fetchBackendKeys() {\n    const parseKeys = (data) => {\n      if (!data) return [];\n      if (Array.isArray(data)) return data;\n      if (Array.isArray(data?.keys)) return data.keys;\n      if (Array.isArray(data?.dashboards)) return data.dashboards;\n      if (Array.isArray(data?.entries)) return data.entries.map(e => e.key || e.id || e.name).filter(Boolean);\n      if (Array.isArray(data?.items)) return data.items.map(e => e.key || e.id || e.name).filter(Boolean);\n      if (typeof data === 'object') {\n        for (const v of Object.values(data)) {\n          if (Array.isArray(v) && v.every(x => typeof x === 'string')) return v;\n        }\n      }\n      return [];\n    };\n    try {\n      if (this?.hass?.callApi) {\n        const r = await this.hass.callApi('get', 'dragdrop_storage');\n        const k = parseKeys(r);\n        if (k.length) return k;\n      }\n    } catch(e) { console.debug('[ddc:switcher] hass.callApi dragdrop_storage failed', e); }\n    const urls = ['/api/dragdrop_storage', '/api/dragdrop_storage/keys', '/api/dragdrop_storage/list', '/api/dragdrop_storage?all=1'];\n    for (const url of urls) {\n      try {\n        const resp = await fetch(url, { cache: 'no-store' });\n        const json = await resp.json();\n        const k = parseKeys(json);\n        if (k.length) return k;\n      } catch(e) {}\n    }\n    return [];\n  }\n  async function _fetchLayoutByKey(key) {\n    const parseDesign = (data) => {\n      if (!data) return null;\n      if (data.options || data.cards) return data;\n      if (typeof data.design === 'object') return data.design;\n      if (typeof data.payload === 'object') return data.payload;\n      try { if (typeof data === 'string') return JSON.parse(data); } catch {}\n      return null;\n    };\n    const tryCall = async (method, path, params) => {\n      try {\n        if (this?.hass?.callApi) {\n          const r = await this.hass.callApi(method, path, params);\n          const d = parseDesign(r);\n          if (d) return d;\n        }\n      } catch(e) {}\n      return null;\n    };\n    const tryFetch = async (url) => {\n      try {\n        const resp = await fetch(url, { cache: 'no-store' });\n        const ct = resp.headers.get('content-type') || '';\n        if (ct.includes('application/json') || ct.includes('text/plain')) {\n          const j = await resp.json().catch(()=>null) || await resp.text().catch(()=>null);\n          const d = parseDesign(j);\n          if (d) return d;\n        }\n      } catch(e) {}\n      return null;\n    };\n    const enc = encodeURIComponent(key);\n    return await (tryCall('get', `dragdrop_storage/${enc}`)\n      || tryFetch(`/api/dragdrop_storage/${enc}`)\n      || tryFetch(`/api/dragdrop_storage?key=${enc}`)\n      || tryCall('post', 'dragdrop_storage/get', { key })\n      || null);\n  }\n  async function _applyDesignObject(json, { source='switcher', newKey=null } = {}) {\n    if (!json || typeof json !== 'object') throw new Error('Invalid design payload');\n    const prevKey = this.storageKey || this._config?.storage_key || null;\n    try { this._dbgInit?.(); this._dbgPush?.('import', 'Begin import (programmatic)', { source, newKey }); } catch {}\n    if (json.options) {\n      const { storage_key, ...optsNoKey } = json.options;\n      this._applyImportedOptions?.(optsNoKey, true);\n    } else if (typeof json.grid === 'number') {\n      this._applyImportedOptions?.({ grid: json.grid }, true);\n    }\n    const key = newKey || json?.options?.storage_key || prevKey;\n    if (key) {\n      this.storageKey = key;\n      this._config = { ...(this._config || {}), storage_key: key };\n      try { this._syncEditorsStorageKey?.(); } catch {}\n    }\n    try {\n      const toPersist = json.options ?? (typeof json.grid === 'number' ? { grid: json.grid } : {});\n      await (this._persistOptionsToYaml?.call(this, { ...toPersist, storage_key: key }, { prevKey, noDownload: (source==='switcher') }));\n    } catch(e) { console.warn('[ddc:apply] persist failed', e); }\n    try {\n      this.cardContainer.innerHTML = '';\n      if (Array.isArray(json.cards) && json.cards.length) {\n        for (const conf of json.cards) {\n          if (!conf?.card || (typeof conf.card === 'object' && Object.keys(conf.card).length === 0)) {\n            const p = this._makePlaceholderAt?.(conf.position?.x||0, conf.position?.y||0, conf.size?.width||200, conf.size?.height||200);\n            if (p) this.cardContainer.appendChild(p);\n          } else {\n            const el = await this._createCard(conf.card);\n            const wrap = this._makeWrapper(el);\n            this._setCardPosition?.(wrap, conf.position?.x||0, conf.position?.y||0);\n            wrap.style.width  = `${conf.size?.width||140}px`;\n            wrap.style.height = `${conf.size?.height||100}px`;\n            if (conf.z != null) wrap.style.zIndex = String(conf.z);\n            this.cardContainer.appendChild(wrap);\n            try { this._rebuildOnce?.(wrap.firstElementChild); } catch {}\n            this._initCardInteract?.(wrap);\n          }\n        }\n      } else {\n        this._showEmptyPlaceholder?.();\n      }\n      this._resizeContainer?.();\n      this._markDirty?.('import');\n      this._toast?.(source==='switcher' ? `Loaded layout \"${key}\"` : 'Design imported');\n    } catch(e) {\n      console.error('[ddc:apply] rebuild failed', e);\n      this._toast?.('Import failed during rebuild.');\n    }\n  }\n  function _updateSwitcherVisibility() {\n    try {\n      const host = this.shadowRoot || this.renderRoot || this;\n      const el = host.querySelector('.ddc-switcher-inline');\n      if (!el) return;\n      const ll = this._getLovelace?.() || _getLovelace.call(this);\n      let edit = false;\n      try {\n        const hui = (host.getRootNode && host.getRootNode())?.host;\n        edit = !!(ll && (ll.editMode === true || (hui && hui.editMode === true)));\n      } catch {}\n      el.style.display = edit ? 'inline-flex' : 'none';\n    } catch {}\n  }\n  function _ensureInlineSwitcher() {\n    try {\n      if (this._ddcSwitcherInstalled) return;\n      const host = this.shadowRoot || this.renderRoot || this;\n      const toolbar = host.querySelector('.toolbar');\n      if (!toolbar) return;\n      const wrap = document.createElement('div');\n      wrap.className = 'ddc-switcher-inline';\n      Object.assign(wrap.style, { display: 'inline-flex', gap: '6px', alignItems: 'center', marginLeft: 'auto' });\n      const label = document.createElement('span');\n      label.textContent = 'Layout:';\n      label.style.fontSize = '12px';\n      label.style.opacity = '0.8';\n      const select = document.createElement('select');\n      Object.assign(select.style, {\n        fontSize: '12px', padding: '4px 6px', borderRadius: '8px',\n        border: '1px solid var(--divider-color, #999)',\n        background: 'var(--card-background-color, #fff)'\n      });\n      select.title = 'Select stored layout (storage_key)';\n      select.id = 'ddcKeySelect';\n      const btn = document.createElement('button');\n      btn.className = 'btn secondary';\n      btn.type = 'button';\n      btn.style.padding = '6px 10px';\n      btn.innerHTML = '<ha-icon icon=\"mdi:refresh\"></ha-icon><span style=\"margin-left:6px\">Refresh</span>';\n      wrap.appendChild(label);\n      wrap.appendChild(select);\n      wrap.appendChild(btn);\n      toolbar.appendChild(wrap);\n      this._ddcSwitcherInstalled = true;\n      const fill = async () => {\n        const current = this.storageKey || (this._config && this._config.storage_key) || '';\n        const serverKeys = await _fetchBackendKeys.call(this);\n        const backupKeys = _collectBackupKeys();\n        const recentKeys = _getRecentKeys();\n        const toUnique = (arr) => Array.from(new Set(arr.filter(Boolean)));\n        const server = toUnique(serverKeys);\n        const backups = toUnique(backupKeys);\n        const recent = toUnique(recentKeys);\n        select.innerHTML = '';\n        if (current && !server.includes(current) && !backups.includes(current) && !recent.includes(current)) {\n          const opt = document.createElement('option');\n          opt.value = current;\n          opt.textContent = `${current} (current)`;\n          opt.selected = true; // ensure the dropdown shows the actual current value\n          select.appendChild(opt);\n        }\n        const makeGroup = (label, list) => {\n          if (!list.length) return;\n          const og = document.createElement('optgroup'); og.label = label;\n          list.forEach(k => {\n            const o = document.createElement('option'); o.value = k; o.textContent = k; if (k===current) o.selected = true;\n            og.appendChild(o);\n          });\n          select.appendChild(og);\n        };\n        makeGroup('Server', server);\n        makeGroup('Backups', backups);\n        makeGroup('Recent', recent);\n        if (!select.children.length) {\n          const none = document.createElement('option'); none.value=''; none.textContent='\u2014 none \u2014'; none.selected = true;\n          select.appendChild(none);\n        }\n        _updateSwitcherVisibility.call(this);\n      };\n      fill();\n      btn.addEventListener('click', fill);\n      \n      select.addEventListener('change', async (e) => {\n        const newKey = String(e.target.value || '');\n        if (!newKey) return;\n        if (this._ddcLoadingFromKey) return;\n        this._ddcLoadingFromKey = true;\n\n        try {\n          const design = await _fetchLayoutByKey.call(this, newKey);\n          if (!design) {\n            this._toast?.(`No layout found for \"${newKey}\"`);\n            return;\n          }\n\n          // Apply the newly selected design to the canvas\n          await _applyDesignObject.call(this, design, { source: 'switcher', newKey });\n          this._resizeContainer?.();\n          this._toast?.(`Loaded layout \"${newKey}\"`);\n\n          // ---- PERSIST THE SELECTED KEY *TO THE CARD OPTIONS* ----\n          // IMPORTANT: persist against the *old* key so the YAML updater finds this card\n          const oldKey = String(this._config?.storage_key || this.storageKey || '');\n\n          let persistOk = false;\n          try {\n            const persistOpts = oldKey\n              ? { forceTargetKey: oldKey, noDownload: true }\n              : { noDownload: true };\n\n            // NOTE: in YAML mode this can resolve to false (no exception)\n            persistOk = await this._persistOptionsToYaml({ storage_key: newKey }, persistOpts);\n          } catch (err) {\n            console.warn('[ddc:switcher] failed to persist storage_key to YAML', err);\n            this._toast?.('Failed to persist selected layout. Keeping current.');\n            return; // bail so we don't reload into the wrong key\n          }\n\n          // Always update in-memory state so the UI reflects the selection now\n          this.storageKey = newKey;\n          if (this._config) this._config.storage_key = newKey;\n\n          // If persistence didn\u2019t actually happen (e.g., YAML mode), stop here\u2014don\u2019t reload\n          if (!persistOk) {\n            console.warn('[ddc:switcher] persist returned false (likely YAML mode). Skipping reload.');\n            // Optional: remember across reloads if you want\n            // localStorage.setItem('ddc:lastKey', newKey);\n            return;\n          }\n\n          // ---- FLUSH SAVE UNDER THE *NEW* KEY, THEN HARD-RELOAD ----\n          try {\n            if (this._saveTimer) clearTimeout(this._saveTimer);\n            await this._saveLayout(true); // writes under this.storageKey (now newKey)\n          } catch (e2) {\n            console.warn('[ddc:switcher] saveLayout failed', e2);\n            this._markDirty?.('switcher');\n            this._toast?.('Layout loaded \u2014 click Apply to save.');\n            return;\n          }\n\n          // Only reload if persist succeeded (storage/dashboard mode)\n          window.location.reload();\n\n          // Finally, reload so the selected layout is what loads on startup\n          window.location.reload();\n\n        } catch (err) {\n          console.warn('[ddc:switcher] load/apply failed', err);\n          this._toast?.('Failed to load layout.');\n        } finally {\n          this._ddcLoadingFromKey = false;\n        }\n      });\n      this._ddcVisTimer && clearInterval(this._ddcVisTimer);\n      this._ddcVisTimer = setInterval(() => _updateSwitcherVisibility.call(this), 800);\n      _updateSwitcherVisibility.call(this);\n    } catch(e) {\n      console.warn('[ddc:switcher] inline install failed', e);\n    }\n  }\n  if (!Cls.prototype._getLovelace) Cls.prototype._getLovelace = _getLovelace;\n  if (!Cls.prototype._scanDdcCards) Cls.prototype._scanDdcCards = _scanDdcCards;\n  Cls.prototype._persistOptionsToYaml = _persistOptionsToYaml;\n  if (!Cls.prototype._applyDesignObject) Cls.prototype._applyDesignObject = _applyDesignObject;\n  try {\n    const desc = Object.getOwnPropertyDescriptor(Cls.prototype, 'hass');\n    if (desc && (desc.set || desc.get)) {\n      const origSet = desc.set;\n      Object.defineProperty(Cls.prototype, 'hass', {\n        configurable: true, enumerable: true,\n        set(v) { if (origSet) origSet.call(this, v); try { _ensureInlineSwitcher.call(this); } catch(e){} },\n        get: desc.get || function(){ return this._hass; }\n      });\n    } else if (typeof Cls.prototype.setHass === 'function') {\n      const orig = Cls.prototype.setHass;\n      Cls.prototype.setHass = function(v){ if (orig) orig.call(this, v); try { _ensureInlineSwitcher.call(this); } catch(e){} }\n    } else {\n      const origUpdate = Cls.prototype.updated || Cls.prototype.firstUpdated;\n      Cls.prototype.updated = function(...args){ if (origUpdate) origUpdate.apply(this, args); try { _ensureInlineSwitcher.call(this); } catch(e){} }\n    }\n  } catch(e){ console.warn('[ddc:switcher] wrap hass setter failed', e); }\n})();\n/* ==== /DDC AUGMENTATION v6 ==== */", "\n/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */\nfunction isNothing(subject) {\n  return (typeof subject === 'undefined') || (subject === null);\n}\n\n\nfunction isObject(subject) {\n  return (typeof subject === 'object') && (subject !== null);\n}\n\n\nfunction toArray(sequence) {\n  if (Array.isArray(sequence)) return sequence;\n  else if (isNothing(sequence)) return [];\n\n  return [ sequence ];\n}\n\n\nfunction extend(target, source) {\n  var index, length, key, sourceKeys;\n\n  if (source) {\n    sourceKeys = Object.keys(source);\n\n    for (index = 0, length = sourceKeys.length; index < length; index += 1) {\n      key = sourceKeys[index];\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\n\nfunction repeat(string, count) {\n  var result = '', cycle;\n\n  for (cycle = 0; cycle < count; cycle += 1) {\n    result += string;\n  }\n\n  return result;\n}\n\n\nfunction isNegativeZero(number) {\n  return (number === 0) && (Number.NEGATIVE_INFINITY === 1 / number);\n}\n\n\nvar isNothing_1      = isNothing;\nvar isObject_1       = isObject;\nvar toArray_1        = toArray;\nvar repeat_1         = repeat;\nvar isNegativeZero_1 = isNegativeZero;\nvar extend_1         = extend;\n\nvar common = {\n\tisNothing: isNothing_1,\n\tisObject: isObject_1,\n\ttoArray: toArray_1,\n\trepeat: repeat_1,\n\tisNegativeZero: isNegativeZero_1,\n\textend: extend_1\n};\n\n// YAML error class. http://stackoverflow.com/questions/8458984\n\n\nfunction formatError(exception, compact) {\n  var where = '', message = exception.reason || '(unknown reason)';\n\n  if (!exception.mark) return message;\n\n  if (exception.mark.name) {\n    where += 'in \"' + exception.mark.name + '\" ';\n  }\n\n  where += '(' + (exception.mark.line + 1) + ':' + (exception.mark.column + 1) + ')';\n\n  if (!compact && exception.mark.snippet) {\n    where += '\\n\\n' + exception.mark.snippet;\n  }\n\n  return message + ' ' + where;\n}\n\n\nfunction YAMLException$1(reason, mark) {\n  // Super constructor\n  Error.call(this);\n\n  this.name = 'YAMLException';\n  this.reason = reason;\n  this.mark = mark;\n  this.message = formatError(this, false);\n\n  // Include stack trace in error object\n  if (Error.captureStackTrace) {\n    // Chrome and NodeJS\n    Error.captureStackTrace(this, this.constructor);\n  } else {\n    // FF, IE 10+ and Safari 6+. Fallback for others\n    this.stack = (new Error()).stack || '';\n  }\n}\n\n\n// Inherit from Error\nYAMLException$1.prototype = Object.create(Error.prototype);\nYAMLException$1.prototype.constructor = YAMLException$1;\n\n\nYAMLException$1.prototype.toString = function toString(compact) {\n  return this.name + ': ' + formatError(this, compact);\n};\n\n\nvar exception = YAMLException$1;\n\n// get snippet for a single line, respecting maxLength\nfunction getLine(buffer, lineStart, lineEnd, position, maxLineLength) {\n  var head = '';\n  var tail = '';\n  var maxHalfLength = Math.floor(maxLineLength / 2) - 1;\n\n  if (position - lineStart > maxHalfLength) {\n    head = ' ... ';\n    lineStart = position - maxHalfLength + head.length;\n  }\n\n  if (lineEnd - position > maxHalfLength) {\n    tail = ' ...';\n    lineEnd = position + maxHalfLength - tail.length;\n  }\n\n  return {\n    str: head + buffer.slice(lineStart, lineEnd).replace(/\\t/g, '\u2192') + tail,\n    pos: position - lineStart + head.length // relative position\n  };\n}\n\n\nfunction padStart(string, max) {\n  return common.repeat(' ', max - string.length) + string;\n}\n\n\nfunction makeSnippet(mark, options) {\n  options = Object.create(options || null);\n\n  if (!mark.buffer) return null;\n\n  if (!options.maxLength) options.maxLength = 79;\n  if (typeof options.indent      !== 'number') options.indent      = 1;\n  if (typeof options.linesBefore !== 'number') options.linesBefore = 3;\n  if (typeof options.linesAfter  !== 'number') options.linesAfter  = 2;\n\n  var re = /\\r?\\n|\\r|\\0/g;\n  var lineStarts = [ 0 ];\n  var lineEnds = [];\n  var match;\n  var foundLineNo = -1;\n\n  while ((match = re.exec(mark.buffer))) {\n    lineEnds.push(match.index);\n    lineStarts.push(match.index + match[0].length);\n\n    if (mark.position <= match.index && foundLineNo < 0) {\n      foundLineNo = lineStarts.length - 2;\n    }\n  }\n\n  if (foundLineNo < 0) foundLineNo = lineStarts.length - 1;\n\n  var result = '', i, line;\n  var lineNoLength = Math.min(mark.line + options.linesAfter, lineEnds.length).toString().length;\n  var maxLineLength = options.maxLength - (options.indent + lineNoLength + 3);\n\n  for (i = 1; i <= options.linesBefore; i++) {\n    if (foundLineNo - i < 0) break;\n    line = getLine(\n      mark.buffer,\n      lineStarts[foundLineNo - i],\n      lineEnds[foundLineNo - i],\n      mark.position - (lineStarts[foundLineNo] - lineStarts[foundLineNo - i]),\n      maxLineLength\n    );\n    result = common.repeat(' ', options.indent) + padStart((mark.line - i + 1).toString(), lineNoLength) +\n      ' | ' + line.str + '\\n' + result;\n  }\n\n  line = getLine(mark.buffer, lineStarts[foundLineNo], lineEnds[foundLineNo], mark.position, maxLineLength);\n  result += common.repeat(' ', options.indent) + padStart((mark.line + 1).toString(), lineNoLength) +\n    ' | ' + line.str + '\\n';\n  result += common.repeat('-', options.indent + lineNoLength + 3 + line.pos) + '^' + '\\n';\n\n  for (i = 1; i <= options.linesAfter; i++) {\n    if (foundLineNo + i >= lineEnds.length) break;\n    line = getLine(\n      mark.buffer,\n      lineStarts[foundLineNo + i],\n      lineEnds[foundLineNo + i],\n      mark.position - (lineStarts[foundLineNo] - lineStarts[foundLineNo + i]),\n      maxLineLength\n    );\n    result += common.repeat(' ', options.indent) + padStart((mark.line + i + 1).toString(), lineNoLength) +\n      ' | ' + line.str + '\\n';\n  }\n\n  return result.replace(/\\n$/, '');\n}\n\n\nvar snippet = makeSnippet;\n\nvar TYPE_CONSTRUCTOR_OPTIONS = [\n  'kind',\n  'multi',\n  'resolve',\n  'construct',\n  'instanceOf',\n  'predicate',\n  'represent',\n  'representName',\n  'defaultStyle',\n  'styleAliases'\n];\n\nvar YAML_NODE_KINDS = [\n  'scalar',\n  'sequence',\n  'mapping'\n];\n\nfunction compileStyleAliases(map) {\n  var result = {};\n\n  if (map !== null) {\n    Object.keys(map).forEach(function (style) {\n      map[style].forEach(function (alias) {\n        result[String(alias)] = style;\n      });\n    });\n  }\n\n  return result;\n}\n\nfunction Type$1(tag, options) {\n  options = options || {};\n\n  Object.keys(options).forEach(function (name) {\n    if (TYPE_CONSTRUCTOR_OPTIONS.indexOf(name) === -1) {\n      throw new exception('Unknown option \"' + name + '\" is met in definition of \"' + tag + '\" YAML type.');\n    }\n  });\n\n  // TODO: Add tag format check.\n  this.options       = options; // keep original options in case user wants to extend this type later\n  this.tag           = tag;\n  this.kind          = options['kind']          || null;\n  this.resolve       = options['resolve']       || function () { return true; };\n  this.construct     = options['construct']     || function (data) { return data; };\n  this.instanceOf    = options['instanceOf']    || null;\n  this.predicate     = options['predicate']     || null;\n  this.represent     = options['represent']     || null;\n  this.representName = options['representName'] || null;\n  this.defaultStyle  = options['defaultStyle']  || null;\n  this.multi         = options['multi']         || false;\n  this.styleAliases  = compileStyleAliases(options['styleAliases'] || null);\n\n  if (YAML_NODE_KINDS.indexOf(this.kind) === -1) {\n    throw new exception('Unknown kind \"' + this.kind + '\" is specified for \"' + tag + '\" YAML type.');\n  }\n}\n\nvar type = Type$1;\n\n/*eslint-disable max-len*/\n\n\n\n\n\nfunction compileList(schema, name) {\n  var result = [];\n\n  schema[name].forEach(function (currentType) {\n    var newIndex = result.length;\n\n    result.forEach(function (previousType, previousIndex) {\n      if (previousType.tag === currentType.tag &&\n          previousType.kind === currentType.kind &&\n          previousType.multi === currentType.multi) {\n\n        newIndex = previousIndex;\n      }\n    });\n\n    result[newIndex] = currentType;\n  });\n\n  return result;\n}\n\n\nfunction compileMap(/* lists... */) {\n  var result = {\n        scalar: {},\n        sequence: {},\n        mapping: {},\n        fallback: {},\n        multi: {\n          scalar: [],\n          sequence: [],\n          mapping: [],\n          fallback: []\n        }\n      }, index, length;\n\n  function collectType(type) {\n    if (type.multi) {\n      result.multi[type.kind].push(type);\n      result.multi['fallback'].push(type);\n    } else {\n      result[type.kind][type.tag] = result['fallback'][type.tag] = type;\n    }\n  }\n\n  for (index = 0, length = arguments.length; index < length; index += 1) {\n    arguments[index].forEach(collectType);\n  }\n  return result;\n}\n\n\nfunction Schema$1(definition) {\n  return this.extend(definition);\n}\n\n\nSchema$1.prototype.extend = function extend(definition) {\n  var implicit = [];\n  var explicit = [];\n\n  if (definition instanceof type) {\n    // Schema.extend(type)\n    explicit.push(definition);\n\n  } else if (Array.isArray(definition)) {\n    // Schema.extend([ type1, type2, ... ])\n    explicit = explicit.concat(definition);\n\n  } else if (definition && (Array.isArray(definition.implicit) || Array.isArray(definition.explicit))) {\n    // Schema.extend({ explicit: [ type1, type2, ... ], implicit: [ type1, type2, ... ] })\n    if (definition.implicit) implicit = implicit.concat(definition.implicit);\n    if (definition.explicit) explicit = explicit.concat(definition.explicit);\n\n  } else {\n    throw new exception('Schema.extend argument should be a Type, [ Type ], ' +\n      'or a schema definition ({ implicit: [...], explicit: [...] })');\n  }\n\n  implicit.forEach(function (type$1) {\n    if (!(type$1 instanceof type)) {\n      throw new exception('Specified list of YAML types (or a single Type object) contains a non-Type object.');\n    }\n\n    if (type$1.loadKind && type$1.loadKind !== 'scalar') {\n      throw new exception('There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.');\n    }\n\n    if (type$1.multi) {\n      throw new exception('There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.');\n    }\n  });\n\n  explicit.forEach(function (type$1) {\n    if (!(type$1 instanceof type)) {\n      throw new exception('Specified list of YAML types (or a single Type object) contains a non-Type object.');\n    }\n  });\n\n  var result = Object.create(Schema$1.prototype);\n\n  result.implicit = (this.implicit || []).concat(implicit);\n  result.explicit = (this.explicit || []).concat(explicit);\n\n  result.compiledImplicit = compileList(result, 'implicit');\n  result.compiledExplicit = compileList(result, 'explicit');\n  result.compiledTypeMap  = compileMap(result.compiledImplicit, result.compiledExplicit);\n\n  return result;\n};\n\n\nvar schema = Schema$1;\n\nvar str = new type('tag:yaml.org,2002:str', {\n  kind: 'scalar',\n  construct: function (data) { return data !== null ? data : ''; }\n});\n\nvar seq = new type('tag:yaml.org,2002:seq', {\n  kind: 'sequence',\n  construct: function (data) { return data !== null ? data : []; }\n});\n\nvar map = new type('tag:yaml.org,2002:map', {\n  kind: 'mapping',\n  construct: function (data) { return data !== null ? data : {}; }\n});\n\nvar failsafe = new schema({\n  explicit: [\n    str,\n    seq,\n    map\n  ]\n});\n\nfunction resolveYamlNull(data) {\n  if (data === null) return true;\n\n  var max = data.length;\n\n  return (max === 1 && data === '~') ||\n         (max === 4 && (data === 'null' || data === 'Null' || data === 'NULL'));\n}\n\nfunction constructYamlNull() {\n  return null;\n}\n\nfunction isNull(object) {\n  return object === null;\n}\n\nvar _null = new type('tag:yaml.org,2002:null', {\n  kind: 'scalar',\n  resolve: resolveYamlNull,\n  construct: constructYamlNull,\n  predicate: isNull,\n  represent: {\n    canonical: function () { return '~';    },\n    lowercase: function () { return 'null'; },\n    uppercase: function () { return 'NULL'; },\n    camelcase: function () { return 'Null'; },\n    empty:     function () { return '';     }\n  },\n  defaultStyle: 'lowercase'\n});\n\nfunction resolveYamlBoolean(data) {\n  if (data === null) return false;\n\n  var max = data.length;\n\n  return (max === 4 && (data === 'true' || data === 'True' || data === 'TRUE')) ||\n         (max === 5 && (data === 'false' || data === 'False' || data === 'FALSE'));\n}\n\nfunction constructYamlBoolean(data) {\n  return data === 'true' ||\n         data === 'True' ||\n         data === 'TRUE';\n}\n\nfunction isBoolean(object) {\n  return Object.prototype.toString.call(object) === '[object Boolean]';\n}\n\nvar bool = new type('tag:yaml.org,2002:bool', {\n  kind: 'scalar',\n  resolve: resolveYamlBoolean,\n  construct: constructYamlBoolean,\n  predicate: isBoolean,\n  represent: {\n    lowercase: function (object) { return object ? 'true' : 'false'; },\n    uppercase: function (object) { return object ? 'TRUE' : 'FALSE'; },\n    camelcase: function (object) { return object ? 'True' : 'False'; }\n  },\n  defaultStyle: 'lowercase'\n});\n\nfunction isHexCode(c) {\n  return ((0x30/* 0 */ <= c) && (c <= 0x39/* 9 */)) ||\n         ((0x41/* A */ <= c) && (c <= 0x46/* F */)) ||\n         ((0x61/* a */ <= c) && (c <= 0x66/* f */));\n}\n\nfunction isOctCode(c) {\n  return ((0x30/* 0 */ <= c) && (c <= 0x37/* 7 */));\n}\n\nfunction isDecCode(c) {\n  return ((0x30/* 0 */ <= c) && (c <= 0x39/* 9 */));\n}\n\nfunction resolveYamlInteger(data) {\n  if (data === null) return false;\n\n  var max = data.length,\n      index = 0,\n      hasDigits = false,\n      ch;\n\n  if (!max) return false;\n\n  ch = data[index];\n\n  // sign\n  if (ch === '-' || ch === '+') {\n    ch = data[++index];\n  }\n\n  if (ch === '0') {\n    // 0\n    if (index + 1 === max) return true;\n    ch = data[++index];\n\n    // base 2, base 8, base 16\n\n    if (ch === 'b') {\n      // base 2\n      index++;\n\n      for (; index < max; index++) {\n        ch = data[index];\n        if (ch === '_') continue;\n        if (ch !== '0' && ch !== '1') return false;\n        hasDigits = true;\n      }\n      return hasDigits && ch !== '_';\n    }\n\n\n    if (ch === 'x') {\n      // base 16\n      index++;\n\n      for (; index < max; index++) {\n        ch = data[index];\n        if (ch === '_') continue;\n        if (!isHexCode(data.charCodeAt(index))) return false;\n        hasDigits = true;\n      }\n      return hasDigits && ch !== '_';\n    }\n\n\n    if (ch === 'o') {\n      // base 8\n      index++;\n\n      for (; index < max; index++) {\n        ch = data[index];\n        if (ch === '_') continue;\n        if (!isOctCode(data.charCodeAt(index))) return false;\n        hasDigits = true;\n      }\n      return hasDigits && ch !== '_';\n    }\n  }\n\n  // base 10 (except 0)\n\n  // value should not start with `_`;\n  if (ch === '_') return false;\n\n  for (; index < max; index++) {\n    ch = data[index];\n    if (ch === '_') continue;\n    if (!isDecCode(data.charCodeAt(index))) {\n      return false;\n    }\n    hasDigits = true;\n  }\n\n  // Should have digits and should not end with `_`\n  if (!hasDigits || ch === '_') return false;\n\n  return true;\n}\n\nfunction constructYamlInteger(data) {\n  var value = data, sign = 1, ch;\n\n  if (value.indexOf('_') !== -1) {\n    value = value.replace(/_/g, '');\n  }\n\n  ch = value[0];\n\n  if (ch === '-' || ch === '+') {\n    if (ch === '-') sign = -1;\n    value = value.slice(1);\n    ch = value[0];\n  }\n\n  if (value === '0') return 0;\n\n  if (ch === '0') {\n    if (value[1] === 'b') return sign * parseInt(value.slice(2), 2);\n    if (value[1] === 'x') return sign * parseInt(value.slice(2), 16);\n    if (value[1] === 'o') return sign * parseInt(value.slice(2), 8);\n  }\n\n  return sign * parseInt(value, 10);\n}\n\nfunction isInteger(object) {\n  return (Object.prototype.toString.call(object)) === '[object Number]' &&\n         (object % 1 === 0 && !common.isNegativeZero(object));\n}\n\nvar int = new type('tag:yaml.org,2002:int', {\n  kind: 'scalar',\n  resolve: resolveYamlInteger,\n  construct: constructYamlInteger,\n  predicate: isInteger,\n  represent: {\n    binary:      function (obj) { return obj >= 0 ? '0b' + obj.toString(2) : '-0b' + obj.toString(2).slice(1); },\n    octal:       function (obj) { return obj >= 0 ? '0o'  + obj.toString(8) : '-0o'  + obj.toString(8).slice(1); },\n    decimal:     function (obj) { return obj.toString(10); },\n    /* eslint-disable max-len */\n    hexadecimal: function (obj) { return obj >= 0 ? '0x' + obj.toString(16).toUpperCase() :  '-0x' + obj.toString(16).toUpperCase().slice(1); }\n  },\n  defaultStyle: 'decimal',\n  styleAliases: {\n    binary:      [ 2,  'bin' ],\n    octal:       [ 8,  'oct' ],\n    decimal:     [ 10, 'dec' ],\n    hexadecimal: [ 16, 'hex' ]\n  }\n});\n\nvar YAML_FLOAT_PATTERN = new RegExp(\n  // 2.5e4, 2.5 and integers\n  '^(?:[-+]?(?:[0-9][0-9_]*)(?:\\\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?' +\n  // .2e4, .2\n  // special case, seems not from spec\n  '|\\\\.[0-9_]+(?:[eE][-+]?[0-9]+)?' +\n  // .inf\n  '|[-+]?\\\\.(?:inf|Inf|INF)' +\n  // .nan\n  '|\\\\.(?:nan|NaN|NAN))$');\n\nfunction resolveYamlFloat(data) {\n  if (data === null) return false;\n\n  if (!YAML_FLOAT_PATTERN.test(data) ||\n      // Quick hack to not allow integers end with `_`\n      // Probably should update regexp & check speed\n      data[data.length - 1] === '_') {\n    return false;\n  }\n\n  return true;\n}\n\nfunction constructYamlFloat(data) {\n  var value, sign;\n\n  value  = data.replace(/_/g, '').toLowerCase();\n  sign   = value[0] === '-' ? -1 : 1;\n\n  if ('+-'.indexOf(value[0]) >= 0) {\n    value = value.slice(1);\n  }\n\n  if (value === '.inf') {\n    return (sign === 1) ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\n\n  } else if (value === '.nan') {\n    return NaN;\n  }\n  return sign * parseFloat(value, 10);\n}\n\n\nvar SCIENTIFIC_WITHOUT_DOT = /^[-+]?[0-9]+e/;\n\nfunction representYamlFloat(object, style) {\n  var res;\n\n  if (isNaN(object)) {\n    switch (style) {\n      case 'lowercase': return '.nan';\n      case 'uppercase': return '.NAN';\n      case 'camelcase': return '.NaN';\n    }\n  } else if (Number.POSITIVE_INFINITY === object) {\n    switch (style) {\n      case 'lowercase': return '.inf';\n      case 'uppercase': return '.INF';\n      case 'camelcase': return '.Inf';\n    }\n  } else if (Number.NEGATIVE_INFINITY === object) {\n    switch (style) {\n      case 'lowercase': return '-.inf';\n      case 'uppercase': return '-.INF';\n      case 'camelcase': return '-.Inf';\n    }\n  } else if (common.isNegativeZero(object)) {\n    return '-0.0';\n  }\n\n  res = object.toString(10);\n\n  // JS stringifier can build scientific format without dots: 5e-100,\n  // while YAML requres dot: 5.e-100. Fix it with simple hack\n\n  return SCIENTIFIC_WITHOUT_DOT.test(res) ? res.replace('e', '.e') : res;\n}\n\nfunction isFloat(object) {\n  return (Object.prototype.toString.call(object) === '[object Number]') &&\n         (object % 1 !== 0 || common.isNegativeZero(object));\n}\n\nvar float = new type('tag:yaml.org,2002:float', {\n  kind: 'scalar',\n  resolve: resolveYamlFloat,\n  construct: constructYamlFloat,\n  predicate: isFloat,\n  represent: representYamlFloat,\n  defaultStyle: 'lowercase'\n});\n\nvar json = failsafe.extend({\n  implicit: [\n    _null,\n    bool,\n    int,\n    float\n  ]\n});\n\nvar core = json;\n\nvar YAML_DATE_REGEXP = new RegExp(\n  '^([0-9][0-9][0-9][0-9])'          + // [1] year\n  '-([0-9][0-9])'                    + // [2] month\n  '-([0-9][0-9])$');                   // [3] day\n\nvar YAML_TIMESTAMP_REGEXP = new RegExp(\n  '^([0-9][0-9][0-9][0-9])'          + // [1] year\n  '-([0-9][0-9]?)'                   + // [2] month\n  '-([0-9][0-9]?)'                   + // [3] day\n  '(?:[Tt]|[ \\\\t]+)'                 + // ...\n  '([0-9][0-9]?)'                    + // [4] hour\n  ':([0-9][0-9])'                    + // [5] minute\n  ':([0-9][0-9])'                    + // [6] second\n  '(?:\\\\.([0-9]*))?'                 + // [7] fraction\n  '(?:[ \\\\t]*(Z|([-+])([0-9][0-9]?)' + // [8] tz [9] tz_sign [10] tz_hour\n  '(?::([0-9][0-9]))?))?$');           // [11] tz_minute\n\nfunction resolveYamlTimestamp(data) {\n  if (data === null) return false;\n  if (YAML_DATE_REGEXP.exec(data) !== null) return true;\n  if (YAML_TIMESTAMP_REGEXP.exec(data) !== null) return true;\n  return false;\n}\n\nfunction constructYamlTimestamp(data) {\n  var match, year, month, day, hour, minute, second, fraction = 0,\n      delta = null, tz_hour, tz_minute, date;\n\n  match = YAML_DATE_REGEXP.exec(data);\n  if (match === null) match = YAML_TIMESTAMP_REGEXP.exec(data);\n\n  if (match === null) throw new Error('Date resolve error');\n\n  // match: [1] year [2] month [3] day\n\n  year = +(match[1]);\n  month = +(match[2]) - 1; // JS month starts with 0\n  day = +(match[3]);\n\n  if (!match[4]) { // no hour\n    return new Date(Date.UTC(year, month, day));\n  }\n\n  // match: [4] hour [5] minute [6] second [7] fraction\n\n  hour = +(match[4]);\n  minute = +(match[5]);\n  second = +(match[6]);\n\n  if (match[7]) {\n    fraction = match[7].slice(0, 3);\n    while (fraction.length < 3) { // milli-seconds\n      fraction += '0';\n    }\n    fraction = +fraction;\n  }\n\n  // match: [8] tz [9] tz_sign [10] tz_hour [11] tz_minute\n\n  if (match[9]) {\n    tz_hour = +(match[10]);\n    tz_minute = +(match[11] || 0);\n    delta = (tz_hour * 60 + tz_minute) * 60000; // delta in mili-seconds\n    if (match[9] === '-') delta = -delta;\n  }\n\n  date = new Date(Date.UTC(year, month, day, hour, minute, second, fraction));\n\n  if (delta) date.setTime(date.getTime() - delta);\n\n  return date;\n}\n\nfunction representYamlTimestamp(object /*, style*/) {\n  return object.toISOString();\n}\n\nvar timestamp = new type('tag:yaml.org,2002:timestamp', {\n  kind: 'scalar',\n  resolve: resolveYamlTimestamp,\n  construct: constructYamlTimestamp,\n  instanceOf: Date,\n  represent: representYamlTimestamp\n});\n\nfunction resolveYamlMerge(data) {\n  return data === '<<' || data === null;\n}\n\nvar merge = new type('tag:yaml.org,2002:merge', {\n  kind: 'scalar',\n  resolve: resolveYamlMerge\n});\n\n/*eslint-disable no-bitwise*/\n\n\n\n\n\n// [ 64, 65, 66 ] -> [ padding, CR, LF ]\nvar BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\\n\\r';\n\n\nfunction resolveYamlBinary(data) {\n  if (data === null) return false;\n\n  var code, idx, bitlen = 0, max = data.length, map = BASE64_MAP;\n\n  // Convert one by one.\n  for (idx = 0; idx < max; idx++) {\n    code = map.indexOf(data.charAt(idx));\n\n    // Skip CR/LF\n    if (code > 64) continue;\n\n    // Fail on illegal characters\n    if (code < 0) return false;\n\n    bitlen += 6;\n  }\n\n  // If there are any bits left, source was corrupted\n  return (bitlen % 8) === 0;\n}\n\nfunction constructYamlBinary(data) {\n  var idx, tailbits,\n      input = data.replace(/[\\r\\n=]/g, ''), // remove CR/LF & padding to simplify scan\n      max = input.length,\n      map = BASE64_MAP,\n      bits = 0,\n      result = [];\n\n  // Collect by 6*4 bits (3 bytes)\n\n  for (idx = 0; idx < max; idx++) {\n    if ((idx % 4 === 0) && idx) {\n      result.push((bits >> 16) & 0xFF);\n      result.push((bits >> 8) & 0xFF);\n      result.push(bits & 0xFF);\n    }\n\n    bits = (bits << 6) | map.indexOf(input.charAt(idx));\n  }\n\n  // Dump tail\n\n  tailbits = (max % 4) * 6;\n\n  if (tailbits === 0) {\n    result.push((bits >> 16) & 0xFF);\n    result.push((bits >> 8) & 0xFF);\n    result.push(bits & 0xFF);\n  } else if (tailbits === 18) {\n    result.push((bits >> 10) & 0xFF);\n    result.push((bits >> 2) & 0xFF);\n  } else if (tailbits === 12) {\n    result.push((bits >> 4) & 0xFF);\n  }\n\n  return new Uint8Array(result);\n}\n\nfunction representYamlBinary(object /*, style*/) {\n  var result = '', bits = 0, idx, tail,\n      max = object.length,\n      map = BASE64_MAP;\n\n  // Convert every three bytes to 4 ASCII characters.\n\n  for (idx = 0; idx < max; idx++) {\n    if ((idx % 3 === 0) && idx) {\n      result += map[(bits >> 18) & 0x3F];\n      result += map[(bits >> 12) & 0x3F];\n      result += map[(bits >> 6) & 0x3F];\n      result += map[bits & 0x3F];\n    }\n\n    bits = (bits << 8) + object[idx];\n  }\n\n  // Dump tail\n\n  tail = max % 3;\n\n  if (tail === 0) {\n    result += map[(bits >> 18) & 0x3F];\n    result += map[(bits >> 12) & 0x3F];\n    result += map[(bits >> 6) & 0x3F];\n    result += map[bits & 0x3F];\n  } else if (tail === 2) {\n    result += map[(bits >> 10) & 0x3F];\n    result += map[(bits >> 4) & 0x3F];\n    result += map[(bits << 2) & 0x3F];\n    result += map[64];\n  } else if (tail === 1) {\n    result += map[(bits >> 2) & 0x3F];\n    result += map[(bits << 4) & 0x3F];\n    result += map[64];\n    result += map[64];\n  }\n\n  return result;\n}\n\nfunction isBinary(obj) {\n  return Object.prototype.toString.call(obj) ===  '[object Uint8Array]';\n}\n\nvar binary = new type('tag:yaml.org,2002:binary', {\n  kind: 'scalar',\n  resolve: resolveYamlBinary,\n  construct: constructYamlBinary,\n  predicate: isBinary,\n  represent: representYamlBinary\n});\n\nvar _hasOwnProperty$3 = Object.prototype.hasOwnProperty;\nvar _toString$2       = Object.prototype.toString;\n\nfunction resolveYamlOmap(data) {\n  if (data === null) return true;\n\n  var objectKeys = [], index, length, pair, pairKey, pairHasKey,\n      object = data;\n\n  for (index = 0, length = object.length; index < length; index += 1) {\n    pair = object[index];\n    pairHasKey = false;\n\n    if (_toString$2.call(pair) !== '[object Object]') return false;\n\n    for (pairKey in pair) {\n      if (_hasOwnProperty$3.call(pair, pairKey)) {\n        if (!pairHasKey) pairHasKey = true;\n        else return false;\n      }\n    }\n\n    if (!pairHasKey) return false;\n\n    if (objectKeys.indexOf(pairKey) === -1) objectKeys.push(pairKey);\n    else return false;\n  }\n\n  return true;\n}\n\nfunction constructYamlOmap(data) {\n  return data !== null ? data : [];\n}\n\nvar omap = new type('tag:yaml.org,2002:omap', {\n  kind: 'sequence',\n  resolve: resolveYamlOmap,\n  construct: constructYamlOmap\n});\n\nvar _toString$1 = Object.prototype.toString;\n\nfunction resolveYamlPairs(data) {\n  if (data === null) return true;\n\n  var index, length, pair, keys, result,\n      object = data;\n\n  result = new Array(object.length);\n\n  for (index = 0, length = object.length; index < length; index += 1) {\n    pair = object[index];\n\n    if (_toString$1.call(pair) !== '[object Object]') return false;\n\n    keys = Object.keys(pair);\n\n    if (keys.length !== 1) return false;\n\n    result[index] = [ keys[0], pair[keys[0]] ];\n  }\n\n  return true;\n}\n\nfunction constructYamlPairs(data) {\n  if (data === null) return [];\n\n  var index, length, pair, keys, result,\n      object = data;\n\n  result = new Array(object.length);\n\n  for (index = 0, length = object.length; index < length; index += 1) {\n    pair = object[index];\n\n    keys = Object.keys(pair);\n\n    result[index] = [ keys[0], pair[keys[0]] ];\n  }\n\n  return result;\n}\n\nvar pairs = new type('tag:yaml.org,2002:pairs', {\n  kind: 'sequence',\n  resolve: resolveYamlPairs,\n  construct: constructYamlPairs\n});\n\nvar _hasOwnProperty$2 = Object.prototype.hasOwnProperty;\n\nfunction resolveYamlSet(data) {\n  if (data === null) return true;\n\n  var key, object = data;\n\n  for (key in object) {\n    if (_hasOwnProperty$2.call(object, key)) {\n      if (object[key] !== null) return false;\n    }\n  }\n\n  return true;\n}\n\nfunction constructYamlSet(data) {\n  return data !== null ? data : {};\n}\n\nvar set = new type('tag:yaml.org,2002:set', {\n  kind: 'mapping',\n  resolve: resolveYamlSet,\n  construct: constructYamlSet\n});\n\nvar _default = core.extend({\n  implicit: [\n    timestamp,\n    merge\n  ],\n  explicit: [\n    binary,\n    omap,\n    pairs,\n    set\n  ]\n});\n\n/*eslint-disable max-len,no-use-before-define*/\n\n\n\n\n\n\n\nvar _hasOwnProperty$1 = Object.prototype.hasOwnProperty;\n\n\nvar CONTEXT_FLOW_IN   = 1;\nvar CONTEXT_FLOW_OUT  = 2;\nvar CONTEXT_BLOCK_IN  = 3;\nvar CONTEXT_BLOCK_OUT = 4;\n\n\nvar CHOMPING_CLIP  = 1;\nvar CHOMPING_STRIP = 2;\nvar CHOMPING_KEEP  = 3;\n\n\nvar PATTERN_NON_PRINTABLE         = /[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F-\\x84\\x86-\\x9F\\uFFFE\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF]/;\nvar PATTERN_NON_ASCII_LINE_BREAKS = /[\\x85\\u2028\\u2029]/;\nvar PATTERN_FLOW_INDICATORS       = /[,\\[\\]\\{\\}]/;\nvar PATTERN_TAG_HANDLE            = /^(?:!|!!|![a-z\\-]+!)$/i;\nvar PATTERN_TAG_URI               = /^(?:!|[^,\\[\\]\\{\\}])(?:%[0-9a-f]{2}|[0-9a-z\\-#;\\/\\?:@&=\\+\\$,_\\.!~\\*'\\(\\)\\[\\]])*$/i;\n\n\nfunction _class(obj) { return Object.prototype.toString.call(obj); }\n\nfunction is_EOL(c) {\n  return (c === 0x0A/* LF */) || (c === 0x0D/* CR */);\n}\n\nfunction is_WHITE_SPACE(c) {\n  return (c === 0x09/* Tab */) || (c === 0x20/* Space */);\n}\n\nfunction is_WS_OR_EOL(c) {\n  return (c === 0x09/* Tab */) ||\n         (c === 0x20/* Space */) ||\n         (c === 0x0A/* LF */) ||\n         (c === 0x0D/* CR */);\n}\n\nfunction is_FLOW_INDICATOR(c) {\n  return c === 0x2C/* , */ ||\n         c === 0x5B/* [ */ ||\n         c === 0x5D/* ] */ ||\n         c === 0x7B/* { */ ||\n         c === 0x7D/* } */;\n}\n\nfunction fromHexCode(c) {\n  var lc;\n\n  if ((0x30/* 0 */ <= c) && (c <= 0x39/* 9 */)) {\n    return c - 0x30;\n  }\n\n  /*eslint-disable no-bitwise*/\n  lc = c | 0x20;\n\n  if ((0x61/* a */ <= lc) && (lc <= 0x66/* f */)) {\n    return lc - 0x61 + 10;\n  }\n\n  return -1;\n}\n\nfunction escapedHexLen(c) {\n  if (c === 0x78/* x */) { return 2; }\n  if (c === 0x75/* u */) { return 4; }\n  if (c === 0x55/* U */) { return 8; }\n  return 0;\n}\n\nfunction fromDecimalCode(c) {\n  if ((0x30/* 0 */ <= c) && (c <= 0x39/* 9 */)) {\n    return c - 0x30;\n  }\n\n  return -1;\n}\n\nfunction simpleEscapeSequence(c) {\n  /* eslint-disable indent */\n  return (c === 0x30/* 0 */) ? '\\x00' :\n        (c === 0x61/* a */) ? '\\x07' :\n        (c === 0x62/* b */) ? '\\x08' :\n        (c === 0x74/* t */) ? '\\x09' :\n        (c === 0x09/* Tab */) ? '\\x09' :\n        (c === 0x6E/* n */) ? '\\x0A' :\n        (c === 0x76/* v */) ? '\\x0B' :\n        (c === 0x66/* f */) ? '\\x0C' :\n        (c === 0x72/* r */) ? '\\x0D' :\n        (c === 0x65/* e */) ? '\\x1B' :\n        (c === 0x20/* Space */) ? ' ' :\n        (c === 0x22/* \" */) ? '\\x22' :\n        (c === 0x2F/* / */) ? '/' :\n        (c === 0x5C/* \\ */) ? '\\x5C' :\n        (c === 0x4E/* N */) ? '\\x85' :\n        (c === 0x5F/* _ */) ? '\\xA0' :\n        (c === 0x4C/* L */) ? '\\u2028' :\n        (c === 0x50/* P */) ? '\\u2029' : '';\n}\n\nfunction charFromCodepoint(c) {\n  if (c <= 0xFFFF) {\n    return String.fromCharCode(c);\n  }\n  // Encode UTF-16 surrogate pair\n  // https://en.wikipedia.org/wiki/UTF-16#Code_points_U.2B010000_to_U.2B10FFFF\n  return String.fromCharCode(\n    ((c - 0x010000) >> 10) + 0xD800,\n    ((c - 0x010000) & 0x03FF) + 0xDC00\n  );\n}\n\nvar simpleEscapeCheck = new Array(256); // integer, for fast access\nvar simpleEscapeMap = new Array(256);\nfor (var i = 0; i < 256; i++) {\n  simpleEscapeCheck[i] = simpleEscapeSequence(i) ? 1 : 0;\n  simpleEscapeMap[i] = simpleEscapeSequence(i);\n}\n\n\nfunction State$1(input, options) {\n  this.input = input;\n\n  this.filename  = options['filename']  || null;\n  this.schema    = options['schema']    || _default;\n  this.onWarning = options['onWarning'] || null;\n  // (Hidden) Remove? makes the loader to expect YAML 1.1 documents\n  // if such documents have no explicit %YAML directive\n  this.legacy    = options['legacy']    || false;\n\n  this.json      = options['json']      || false;\n  this.listener  = options['listener']  || null;\n\n  this.implicitTypes = this.schema.compiledImplicit;\n  this.typeMap       = this.schema.compiledTypeMap;\n\n  this.length     = input.length;\n  this.position   = 0;\n  this.line       = 0;\n  this.lineStart  = 0;\n  this.lineIndent = 0;\n\n  // position of first leading tab in the current line,\n  // used to make sure there are no tabs in the indentation\n  this.firstTabInLine = -1;\n\n  this.documents = [];\n\n  /*\n  this.version;\n  this.checkLineBreaks;\n  this.tagMap;\n  this.anchorMap;\n  this.tag;\n  this.anchor;\n  this.kind;\n  this.result;*/\n\n}\n\n\nfunction generateError(state, message) {\n  var mark = {\n    name:     state.filename,\n    buffer:   state.input.slice(0, -1), // omit trailing \\0\n    position: state.position,\n    line:     state.line,\n    column:   state.position - state.lineStart\n  };\n\n  mark.snippet = snippet(mark);\n\n  return new exception(message, mark);\n}\n\nfunction throwError(state, message) {\n  throw generateError(state, message);\n}\n\nfunction throwWarning(state, message) {\n  if (state.onWarning) {\n    state.onWarning.call(null, generateError(state, message));\n  }\n}\n\n\nvar directiveHandlers = {\n\n  YAML: function handleYamlDirective(state, name, args) {\n\n    var match, major, minor;\n\n    if (state.version !== null) {\n      throwError(state, 'duplication of %YAML directive');\n    }\n\n    if (args.length !== 1) {\n      throwError(state, 'YAML directive accepts exactly one argument');\n    }\n\n    match = /^([0-9]+)\\.([0-9]+)$/.exec(args[0]);\n\n    if (match === null) {\n      throwError(state, 'ill-formed argument of the YAML directive');\n    }\n\n    major = parseInt(match[1], 10);\n    minor = parseInt(match[2], 10);\n\n    if (major !== 1) {\n      throwError(state, 'unacceptable YAML version of the document');\n    }\n\n    state.version = args[0];\n    state.checkLineBreaks = (minor < 2);\n\n    if (minor !== 1 && minor !== 2) {\n      throwWarning(state, 'unsupported YAML version of the document');\n    }\n  },\n\n  TAG: function handleTagDirective(state, name, args) {\n\n    var handle, prefix;\n\n    if (args.length !== 2) {\n      throwError(state, 'TAG directive accepts exactly two arguments');\n    }\n\n    handle = args[0];\n    prefix = args[1];\n\n    if (!PATTERN_TAG_HANDLE.test(handle)) {\n      throwError(state, 'ill-formed tag handle (first argument) of the TAG directive');\n    }\n\n    if (_hasOwnProperty$1.call(state.tagMap, handle)) {\n      throwError(state, 'there is a previously declared suffix for \"' + handle + '\" tag handle');\n    }\n\n    if (!PATTERN_TAG_URI.test(prefix)) {\n      throwError(state, 'ill-formed tag prefix (second argument) of the TAG directive');\n    }\n\n    try {\n      prefix = decodeURIComponent(prefix);\n    } catch (err) {\n      throwError(state, 'tag prefix is malformed: ' + prefix);\n    }\n\n    state.tagMap[handle] = prefix;\n  }\n};\n\n\nfunction captureSegment(state, start, end, checkJson) {\n  var _position, _length, _character, _result;\n\n  if (start < end) {\n    _result = state.input.slice(start, end);\n\n    if (checkJson) {\n      for (_position = 0, _length = _result.length; _position < _length; _position += 1) {\n        _character = _result.charCodeAt(_position);\n        if (!(_character === 0x09 ||\n              (0x20 <= _character && _character <= 0x10FFFF))) {\n          throwError(state, 'expected valid JSON character');\n        }\n      }\n    } else if (PATTERN_NON_PRINTABLE.test(_result)) {\n      throwError(state, 'the stream contains non-printable characters');\n    }\n\n    state.result += _result;\n  }\n}\n\nfunction mergeMappings(state, destination, source, overridableKeys) {\n  var sourceKeys, key, index, quantity;\n\n  if (!common.isObject(source)) {\n    throwError(state, 'cannot merge mappings; the provided source object is unacceptable');\n  }\n\n  sourceKeys = Object.keys(source);\n\n  for (index = 0, quantity = sourceKeys.length; index < quantity; index += 1) {\n    key = sourceKeys[index];\n\n    if (!_hasOwnProperty$1.call(destination, key)) {\n      destination[key] = source[key];\n      overridableKeys[key] = true;\n    }\n  }\n}\n\nfunction storeMappingPair(state, _result, overridableKeys, keyTag, keyNode, valueNode,\n  startLine, startLineStart, startPos) {\n\n  var index, quantity;\n\n  // The output is a plain object here, so keys can only be strings.\n  // We need to convert keyNode to a string, but doing so can hang the process\n  // (deeply nested arrays that explode exponentially using aliases).\n  if (Array.isArray(keyNode)) {\n    keyNode = Array.prototype.slice.call(keyNode);\n\n    for (index = 0, quantity = keyNode.length; index < quantity; index += 1) {\n      if (Array.isArray(keyNode[index])) {\n        throwError(state, 'nested arrays are not supported inside keys');\n      }\n\n      if (typeof keyNode === 'object' && _class(keyNode[index]) === '[object Object]') {\n        keyNode[index] = '[object Object]';\n      }\n    }\n  }\n\n  // Avoid code execution in load() via toString property\n  // (still use its own toString for arrays, timestamps,\n  // and whatever user schema extensions happen to have @@toStringTag)\n  if (typeof keyNode === 'object' && _class(keyNode) === '[object Object]') {\n    keyNode = '[object Object]';\n  }\n\n\n  keyNode = String(keyNode);\n\n  if (_result === null) {\n    _result = {};\n  }\n\n  if (keyTag === 'tag:yaml.org,2002:merge') {\n    if (Array.isArray(valueNode)) {\n      for (index = 0, quantity = valueNode.length; index < quantity; index += 1) {\n        mergeMappings(state, _result, valueNode[index], overridableKeys);\n      }\n    } else {\n      mergeMappings(state, _result, valueNode, overridableKeys);\n    }\n  } else {\n    if (!state.json &&\n        !_hasOwnProperty$1.call(overridableKeys, keyNode) &&\n        _hasOwnProperty$1.call(_result, keyNode)) {\n      state.line = startLine || state.line;\n      state.lineStart = startLineStart || state.lineStart;\n      state.position = startPos || state.position;\n      throwError(state, 'duplicated mapping key');\n    }\n\n    // used for this specific key only because Object.defineProperty is slow\n    if (keyNode === '__proto__') {\n      Object.defineProperty(_result, keyNode, {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value: valueNode\n      });\n    } else {\n      _result[keyNode] = valueNode;\n    }\n    delete overridableKeys[keyNode];\n  }\n\n  return _result;\n}\n\nfunction readLineBreak(state) {\n  var ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch === 0x0A/* LF */) {\n    state.position++;\n  } else if (ch === 0x0D/* CR */) {\n    state.position++;\n    if (state.input.charCodeAt(state.position) === 0x0A/* LF */) {\n      state.position++;\n    }\n  } else {\n    throwError(state, 'a line break is expected');\n  }\n\n  state.line += 1;\n  state.lineStart = state.position;\n  state.firstTabInLine = -1;\n}\n\nfunction skipSeparationSpace(state, allowComments, checkIndent) {\n  var lineBreaks = 0,\n      ch = state.input.charCodeAt(state.position);\n\n  while (ch !== 0) {\n    while (is_WHITE_SPACE(ch)) {\n      if (ch === 0x09/* Tab */ && state.firstTabInLine === -1) {\n        state.firstTabInLine = state.position;\n      }\n      ch = state.input.charCodeAt(++state.position);\n    }\n\n    if (allowComments && ch === 0x23/* # */) {\n      do {\n        ch = state.input.charCodeAt(++state.position);\n      } while (ch !== 0x0A/* LF */ && ch !== 0x0D/* CR */ && ch !== 0);\n    }\n\n    if (is_EOL(ch)) {\n      readLineBreak(state);\n\n      ch = state.input.charCodeAt(state.position);\n      lineBreaks++;\n      state.lineIndent = 0;\n\n      while (ch === 0x20/* Space */) {\n        state.lineIndent++;\n        ch = state.input.charCodeAt(++state.position);\n      }\n    } else {\n      break;\n    }\n  }\n\n  if (checkIndent !== -1 && lineBreaks !== 0 && state.lineIndent < checkIndent) {\n    throwWarning(state, 'deficient indentation');\n  }\n\n  return lineBreaks;\n}\n\nfunction testDocumentSeparator(state) {\n  var _position = state.position,\n      ch;\n\n  ch = state.input.charCodeAt(_position);\n\n  // Condition state.position === state.lineStart is tested\n  // in parent on each call, for efficiency. No needs to test here again.\n  if ((ch === 0x2D/* - */ || ch === 0x2E/* . */) &&\n      ch === state.input.charCodeAt(_position + 1) &&\n      ch === state.input.charCodeAt(_position + 2)) {\n\n    _position += 3;\n\n    ch = state.input.charCodeAt(_position);\n\n    if (ch === 0 || is_WS_OR_EOL(ch)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction writeFoldedLines(state, count) {\n  if (count === 1) {\n    state.result += ' ';\n  } else if (count > 1) {\n    state.result += common.repeat('\\n', count - 1);\n  }\n}\n\n\nfunction readPlainScalar(state, nodeIndent, withinFlowCollection) {\n  var preceding,\n      following,\n      captureStart,\n      captureEnd,\n      hasPendingContent,\n      _line,\n      _lineStart,\n      _lineIndent,\n      _kind = state.kind,\n      _result = state.result,\n      ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (is_WS_OR_EOL(ch)      ||\n      is_FLOW_INDICATOR(ch) ||\n      ch === 0x23/* # */    ||\n      ch === 0x26/* & */    ||\n      ch === 0x2A/* * */    ||\n      ch === 0x21/* ! */    ||\n      ch === 0x7C/* | */    ||\n      ch === 0x3E/* > */    ||\n      ch === 0x27/* ' */    ||\n      ch === 0x22/* \" */    ||\n      ch === 0x25/* % */    ||\n      ch === 0x40/* @ */    ||\n      ch === 0x60/* ` */) {\n    return false;\n  }\n\n  if (ch === 0x3F/* ? */ || ch === 0x2D/* - */) {\n    following = state.input.charCodeAt(state.position + 1);\n\n    if (is_WS_OR_EOL(following) ||\n        withinFlowCollection && is_FLOW_INDICATOR(following)) {\n      return false;\n    }\n  }\n\n  state.kind = 'scalar';\n  state.result = '';\n  captureStart = captureEnd = state.position;\n  hasPendingContent = false;\n\n  while (ch !== 0) {\n    if (ch === 0x3A/* : */) {\n      following = state.input.charCodeAt(state.position + 1);\n\n      if (is_WS_OR_EOL(following) ||\n          withinFlowCollection && is_FLOW_INDICATOR(following)) {\n        break;\n      }\n\n    } else if (ch === 0x23/* # */) {\n      preceding = state.input.charCodeAt(state.position - 1);\n\n      if (is_WS_OR_EOL(preceding)) {\n        break;\n      }\n\n    } else if ((state.position === state.lineStart && testDocumentSeparator(state)) ||\n               withinFlowCollection && is_FLOW_INDICATOR(ch)) {\n      break;\n\n    } else if (is_EOL(ch)) {\n      _line = state.line;\n      _lineStart = state.lineStart;\n      _lineIndent = state.lineIndent;\n      skipSeparationSpace(state, false, -1);\n\n      if (state.lineIndent >= nodeIndent) {\n        hasPendingContent = true;\n        ch = state.input.charCodeAt(state.position);\n        continue;\n      } else {\n        state.position = captureEnd;\n        state.line = _line;\n        state.lineStart = _lineStart;\n        state.lineIndent = _lineIndent;\n        break;\n      }\n    }\n\n    if (hasPendingContent) {\n      captureSegment(state, captureStart, captureEnd, false);\n      writeFoldedLines(state, state.line - _line);\n      captureStart = captureEnd = state.position;\n      hasPendingContent = false;\n    }\n\n    if (!is_WHITE_SPACE(ch)) {\n      captureEnd = state.position + 1;\n    }\n\n    ch = state.input.charCodeAt(++state.position);\n  }\n\n  captureSegment(state, captureStart, captureEnd, false);\n\n  if (state.result) {\n    return true;\n  }\n\n  state.kind = _kind;\n  state.result = _result;\n  return false;\n}\n\nfunction readSingleQuotedScalar(state, nodeIndent) {\n  var ch,\n      captureStart, captureEnd;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch !== 0x27/* ' */) {\n    return false;\n  }\n\n  state.kind = 'scalar';\n  state.result = '';\n  state.position++;\n  captureStart = captureEnd = state.position;\n\n  while ((ch = state.input.charCodeAt(state.position)) !== 0) {\n    if (ch === 0x27/* ' */) {\n      captureSegment(state, captureStart, state.position, true);\n      ch = state.input.charCodeAt(++state.position);\n\n      if (ch === 0x27/* ' */) {\n        captureStart = state.position;\n        state.position++;\n        captureEnd = state.position;\n      } else {\n        return true;\n      }\n\n    } else if (is_EOL(ch)) {\n      captureSegment(state, captureStart, captureEnd, true);\n      writeFoldedLines(state, skipSeparationSpace(state, false, nodeIndent));\n      captureStart = captureEnd = state.position;\n\n    } else if (state.position === state.lineStart && testDocumentSeparator(state)) {\n      throwError(state, 'unexpected end of the document within a single quoted scalar');\n\n    } else {\n      state.position++;\n      captureEnd = state.position;\n    }\n  }\n\n  throwError(state, 'unexpected end of the stream within a single quoted scalar');\n}\n\nfunction readDoubleQuotedScalar(state, nodeIndent) {\n  var captureStart,\n      captureEnd,\n      hexLength,\n      hexResult,\n      tmp,\n      ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch !== 0x22/* \" */) {\n    return false;\n  }\n\n  state.kind = 'scalar';\n  state.result = '';\n  state.position++;\n  captureStart = captureEnd = state.position;\n\n  while ((ch = state.input.charCodeAt(state.position)) !== 0) {\n    if (ch === 0x22/* \" */) {\n      captureSegment(state, captureStart, state.position, true);\n      state.position++;\n      return true;\n\n    } else if (ch === 0x5C/* \\ */) {\n      captureSegment(state, captureStart, state.position, true);\n      ch = state.input.charCodeAt(++state.position);\n\n      if (is_EOL(ch)) {\n        skipSeparationSpace(state, false, nodeIndent);\n\n        // TODO: rework to inline fn with no type cast?\n      } else if (ch < 256 && simpleEscapeCheck[ch]) {\n        state.result += simpleEscapeMap[ch];\n        state.position++;\n\n      } else if ((tmp = escapedHexLen(ch)) > 0) {\n        hexLength = tmp;\n        hexResult = 0;\n\n        for (; hexLength > 0; hexLength--) {\n          ch = state.input.charCodeAt(++state.position);\n\n          if ((tmp = fromHexCode(ch)) >= 0) {\n            hexResult = (hexResult << 4) + tmp;\n\n          } else {\n            throwError(state, 'expected hexadecimal character');\n          }\n        }\n\n        state.result += charFromCodepoint(hexResult);\n\n        state.position++;\n\n      } else {\n        throwError(state, 'unknown escape sequence');\n      }\n\n      captureStart = captureEnd = state.position;\n\n    } else if (is_EOL(ch)) {\n      captureSegment(state, captureStart, captureEnd, true);\n      writeFoldedLines(state, skipSeparationSpace(state, false, nodeIndent));\n      captureStart = captureEnd = state.position;\n\n    } else if (state.position === state.lineStart && testDocumentSeparator(state)) {\n      throwError(state, 'unexpected end of the document within a double quoted scalar');\n\n    } else {\n      state.position++;\n      captureEnd = state.position;\n    }\n  }\n\n  throwError(state, 'unexpected end of the stream within a double quoted scalar');\n}\n\nfunction readFlowCollection(state, nodeIndent) {\n  var readNext = true,\n      _line,\n      _lineStart,\n      _pos,\n      _tag     = state.tag,\n      _result,\n      _anchor  = state.anchor,\n      following,\n      terminator,\n      isPair,\n      isExplicitPair,\n      isMapping,\n      overridableKeys = Object.create(null),\n      keyNode,\n      keyTag,\n      valueNode,\n      ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch === 0x5B/* [ */) {\n    terminator = 0x5D;/* ] */\n    isMapping = false;\n    _result = [];\n  } else if (ch === 0x7B/* { */) {\n    terminator = 0x7D;/* } */\n    isMapping = true;\n    _result = {};\n  } else {\n    return false;\n  }\n\n  if (state.anchor !== null) {\n    state.anchorMap[state.anchor] = _result;\n  }\n\n  ch = state.input.charCodeAt(++state.position);\n\n  while (ch !== 0) {\n    skipSeparationSpace(state, true, nodeIndent);\n\n    ch = state.input.charCodeAt(state.position);\n\n    if (ch === terminator) {\n      state.position++;\n      state.tag = _tag;\n      state.anchor = _anchor;\n      state.kind = isMapping ? 'mapping' : 'sequence';\n      state.result = _result;\n      return true;\n    } else if (!readNext) {\n      throwError(state, 'missed comma between flow collection entries');\n    } else if (ch === 0x2C/* , */) {\n      // \"flow collection entries can never be completely empty\", as per YAML 1.2, section 7.4\n      throwError(state, \"expected the node content, but found ','\");\n    }\n\n    keyTag = keyNode = valueNode = null;\n    isPair = isExplicitPair = false;\n\n    if (ch === 0x3F/* ? */) {\n      following = state.input.charCodeAt(state.position + 1);\n\n      if (is_WS_OR_EOL(following)) {\n        isPair = isExplicitPair = true;\n        state.position++;\n        skipSeparationSpace(state, true, nodeIndent);\n      }\n    }\n\n    _line = state.line; // Save the current line.\n    _lineStart = state.lineStart;\n    _pos = state.position;\n    composeNode(state, nodeIndent, CONTEXT_FLOW_IN, false, true);\n    keyTag = state.tag;\n    keyNode = state.result;\n    skipSeparationSpace(state, true, nodeIndent);\n\n    ch = state.input.charCodeAt(state.position);\n\n    if ((isExplicitPair || state.line === _line) && ch === 0x3A/* : */) {\n      isPair = true;\n      ch = state.input.charCodeAt(++state.position);\n      skipSeparationSpace(state, true, nodeIndent);\n      composeNode(state, nodeIndent, CONTEXT_FLOW_IN, false, true);\n      valueNode = state.result;\n    }\n\n    if (isMapping) {\n      storeMappingPair(state, _result, overridableKeys, keyTag, keyNode, valueNode, _line, _lineStart, _pos);\n    } else if (isPair) {\n      _result.push(storeMappingPair(state, null, overridableKeys, keyTag, keyNode, valueNode, _line, _lineStart, _pos));\n    } else {\n      _result.push(keyNode);\n    }\n\n    skipSeparationSpace(state, true, nodeIndent);\n\n    ch = state.input.charCodeAt(state.position);\n\n    if (ch === 0x2C/* , */) {\n      readNext = true;\n      ch = state.input.charCodeAt(++state.position);\n    } else {\n      readNext = false;\n    }\n  }\n\n  throwError(state, 'unexpected end of the stream within a flow collection');\n}\n\nfunction readBlockScalar(state, nodeIndent) {\n  var captureStart,\n      folding,\n      chomping       = CHOMPING_CLIP,\n      didReadContent = false,\n      detectedIndent = false,\n      textIndent     = nodeIndent,\n      emptyLines     = 0,\n      atMoreIndented = false,\n      tmp,\n      ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch === 0x7C/* | */) {\n    folding = false;\n  } else if (ch === 0x3E/* > */) {\n    folding = true;\n  } else {\n    return false;\n  }\n\n  state.kind = 'scalar';\n  state.result = '';\n\n  while (ch !== 0) {\n    ch = state.input.charCodeAt(++state.position);\n\n    if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n      if (CHOMPING_CLIP === chomping) {\n        chomping = (ch === 0x2B/* + */) ? CHOMPING_KEEP : CHOMPING_STRIP;\n      } else {\n        throwError(state, 'repeat of a chomping mode identifier');\n      }\n\n    } else if ((tmp = fromDecimalCode(ch)) >= 0) {\n      if (tmp === 0) {\n        throwError(state, 'bad explicit indentation width of a block scalar; it cannot be less than one');\n      } else if (!detectedIndent) {\n        textIndent = nodeIndent + tmp - 1;\n        detectedIndent = true;\n      } else {\n        throwError(state, 'repeat of an indentation width identifier');\n      }\n\n    } else {\n      break;\n    }\n  }\n\n  if (is_WHITE_SPACE(ch)) {\n    do { ch = state.input.charCodeAt(++state.position); }\n    while (is_WHITE_SPACE(ch));\n\n    if (ch === 0x23/* # */) {\n      do { ch = state.input.charCodeAt(++state.position); }\n      while (!is_EOL(ch) && (ch !== 0));\n    }\n  }\n\n  while (ch !== 0) {\n    readLineBreak(state);\n    state.lineIndent = 0;\n\n    ch = state.input.charCodeAt(state.position);\n\n    while ((!detectedIndent || state.lineIndent < textIndent) &&\n           (ch === 0x20/* Space */)) {\n      state.lineIndent++;\n      ch = state.input.charCodeAt(++state.position);\n    }\n\n    if (!detectedIndent && state.lineIndent > textIndent) {\n      textIndent = state.lineIndent;\n    }\n\n    if (is_EOL(ch)) {\n      emptyLines++;\n      continue;\n    }\n\n    // End of the scalar.\n    if (state.lineIndent < textIndent) {\n\n      // Perform the chomping.\n      if (chomping === CHOMPING_KEEP) {\n        state.result += common.repeat('\\n', didReadContent ? 1 + emptyLines : emptyLines);\n      } else if (chomping === CHOMPING_CLIP) {\n        if (didReadContent) { // i.e. only if the scalar is not empty.\n          state.result += '\\n';\n        }\n      }\n\n      // Break this `while` cycle and go to the funciton's epilogue.\n      break;\n    }\n\n    // Folded style: use fancy rules to handle line breaks.\n    if (folding) {\n\n      // Lines starting with white space characters (more-indented lines) are not folded.\n      if (is_WHITE_SPACE(ch)) {\n        atMoreIndented = true;\n        // except for the first content line (cf. Example 8.1)\n        state.result += common.repeat('\\n', didReadContent ? 1 + emptyLines : emptyLines);\n\n      // End of more-indented block.\n      } else if (atMoreIndented) {\n        atMoreIndented = false;\n        state.result += common.repeat('\\n', emptyLines + 1);\n\n      // Just one line break - perceive as the same line.\n      } else if (emptyLines === 0) {\n        if (didReadContent) { // i.e. only if we have already read some scalar content.\n          state.result += ' ';\n        }\n\n      // Several line breaks - perceive as different lines.\n      } else {\n        state.result += common.repeat('\\n', emptyLines);\n      }\n\n    // Literal style: just add exact number of line breaks between content lines.\n    } else {\n      // Keep all line breaks except the header line break.\n      state.result += common.repeat('\\n', didReadContent ? 1 + emptyLines : emptyLines);\n    }\n\n    didReadContent = true;\n    detectedIndent = true;\n    emptyLines = 0;\n    captureStart = state.position;\n\n    while (!is_EOL(ch) && (ch !== 0)) {\n      ch = state.input.charCodeAt(++state.position);\n    }\n\n    captureSegment(state, captureStart, state.position, false);\n  }\n\n  return true;\n}\n\nfunction readBlockSequence(state, nodeIndent) {\n  var _line,\n      _tag      = state.tag,\n      _anchor   = state.anchor,\n      _result   = [],\n      following,\n      detected  = false,\n      ch;\n\n  // there is a leading tab before this token, so it can't be a block sequence/mapping;\n  // it can still be flow sequence/mapping or a scalar\n  if (state.firstTabInLine !== -1) return false;\n\n  if (state.anchor !== null) {\n    state.anchorMap[state.anchor] = _result;\n  }\n\n  ch = state.input.charCodeAt(state.position);\n\n  while (ch !== 0) {\n    if (state.firstTabInLine !== -1) {\n      state.position = state.firstTabInLine;\n      throwError(state, 'tab characters must not be used in indentation');\n    }\n\n    if (ch !== 0x2D/* - */) {\n      break;\n    }\n\n    following = state.input.charCodeAt(state.position + 1);\n\n    if (!is_WS_OR_EOL(following)) {\n      break;\n    }\n\n    detected = true;\n    state.position++;\n\n    if (skipSeparationSpace(state, true, -1)) {\n      if (state.lineIndent <= nodeIndent) {\n        _result.push(null);\n        ch = state.input.charCodeAt(state.position);\n        continue;\n      }\n    }\n\n    _line = state.line;\n    composeNode(state, nodeIndent, CONTEXT_BLOCK_IN, false, true);\n    _result.push(state.result);\n    skipSeparationSpace(state, true, -1);\n\n    ch = state.input.charCodeAt(state.position);\n\n    if ((state.line === _line || state.lineIndent > nodeIndent) && (ch !== 0)) {\n      throwError(state, 'bad indentation of a sequence entry');\n    } else if (state.lineIndent < nodeIndent) {\n      break;\n    }\n  }\n\n  if (detected) {\n    state.tag = _tag;\n    state.anchor = _anchor;\n    state.kind = 'sequence';\n    state.result = _result;\n    return true;\n  }\n  return false;\n}\n\nfunction readBlockMapping(state, nodeIndent, flowIndent) {\n  var following,\n      allowCompact,\n      _line,\n      _keyLine,\n      _keyLineStart,\n      _keyPos,\n      _tag          = state.tag,\n      _anchor       = state.anchor,\n      _result       = {},\n      overridableKeys = Object.create(null),\n      keyTag        = null,\n      keyNode       = null,\n      valueNode     = null,\n      atExplicitKey = false,\n      detected      = false,\n      ch;\n\n  // there is a leading tab before this token, so it can't be a block sequence/mapping;\n  // it can still be flow sequence/mapping or a scalar\n  if (state.firstTabInLine !== -1) return false;\n\n  if (state.anchor !== null) {\n    state.anchorMap[state.anchor] = _result;\n  }\n\n  ch = state.input.charCodeAt(state.position);\n\n  while (ch !== 0) {\n    if (!atExplicitKey && state.firstTabInLine !== -1) {\n      state.position = state.firstTabInLine;\n      throwError(state, 'tab characters must not be used in indentation');\n    }\n\n    following = state.input.charCodeAt(state.position + 1);\n    _line = state.line; // Save the current line.\n\n    //\n    // Explicit notation case. There are two separate blocks:\n    // first for the key (denoted by \"?\") and second for the value (denoted by \":\")\n    //\n    if ((ch === 0x3F/* ? */ || ch === 0x3A/* : */) && is_WS_OR_EOL(following)) {\n\n      if (ch === 0x3F/* ? */) {\n        if (atExplicitKey) {\n          storeMappingPair(state, _result, overridableKeys, keyTag, keyNode, null, _keyLine, _keyLineStart, _keyPos);\n          keyTag = keyNode = valueNode = null;\n        }\n\n        detected = true;\n        atExplicitKey = true;\n        allowCompact = true;\n\n      } else if (atExplicitKey) {\n        // i.e. 0x3A/* : */ === character after the explicit key.\n        atExplicitKey = false;\n        allowCompact = true;\n\n      } else {\n        throwError(state, 'incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line');\n      }\n\n      state.position += 1;\n      ch = following;\n\n    //\n    // Implicit notation case. Flow-style node as the key first, then \":\", and the value.\n    //\n    } else {\n      _keyLine = state.line;\n      _keyLineStart = state.lineStart;\n      _keyPos = state.position;\n\n      if (!composeNode(state, flowIndent, CONTEXT_FLOW_OUT, false, true)) {\n        // Neither implicit nor explicit notation.\n        // Reading is done. Go to the epilogue.\n        break;\n      }\n\n      if (state.line === _line) {\n        ch = state.input.charCodeAt(state.position);\n\n        while (is_WHITE_SPACE(ch)) {\n          ch = state.input.charCodeAt(++state.position);\n        }\n\n        if (ch === 0x3A/* : */) {\n          ch = state.input.charCodeAt(++state.position);\n\n          if (!is_WS_OR_EOL(ch)) {\n            throwError(state, 'a whitespace character is expected after the key-value separator within a block mapping');\n          }\n\n          if (atExplicitKey) {\n            storeMappingPair(state, _result, overridableKeys, keyTag, keyNode, null, _keyLine, _keyLineStart, _keyPos);\n            keyTag = keyNode = valueNode = null;\n          }\n\n          detected = true;\n          atExplicitKey = false;\n          allowCompact = false;\n          keyTag = state.tag;\n          keyNode = state.result;\n\n        } else if (detected) {\n          throwError(state, 'can not read an implicit mapping pair; a colon is missed');\n\n        } else {\n          state.tag = _tag;\n          state.anchor = _anchor;\n          return true; // Keep the result of `composeNode`.\n        }\n\n      } else if (detected) {\n        throwError(state, 'can not read a block mapping entry; a multiline key may not be an implicit key');\n\n      } else {\n        state.tag = _tag;\n        state.anchor = _anchor;\n        return true; // Keep the result of `composeNode`.\n      }\n    }\n\n    //\n    // Common reading code for both explicit and implicit notations.\n    //\n    if (state.line === _line || state.lineIndent > nodeIndent) {\n      if (atExplicitKey) {\n        _keyLine = state.line;\n        _keyLineStart = state.lineStart;\n        _keyPos = state.position;\n      }\n\n      if (composeNode(state, nodeIndent, CONTEXT_BLOCK_OUT, true, allowCompact)) {\n        if (atExplicitKey) {\n          keyNode = state.result;\n        } else {\n          valueNode = state.result;\n        }\n      }\n\n      if (!atExplicitKey) {\n        storeMappingPair(state, _result, overridableKeys, keyTag, keyNode, valueNode, _keyLine, _keyLineStart, _keyPos);\n        keyTag = keyNode = valueNode = null;\n      }\n\n      skipSeparationSpace(state, true, -1);\n      ch = state.input.charCodeAt(state.position);\n    }\n\n    if ((state.line === _line || state.lineIndent > nodeIndent) && (ch !== 0)) {\n      throwError(state, 'bad indentation of a mapping entry');\n    } else if (state.lineIndent < nodeIndent) {\n      break;\n    }\n  }\n\n  //\n  // Epilogue.\n  //\n\n  // Special case: last mapping's node contains only the key in explicit notation.\n  if (atExplicitKey) {\n    storeMappingPair(state, _result, overridableKeys, keyTag, keyNode, null, _keyLine, _keyLineStart, _keyPos);\n  }\n\n  // Expose the resulting mapping.\n  if (detected) {\n    state.tag = _tag;\n    state.anchor = _anchor;\n    state.kind = 'mapping';\n    state.result = _result;\n  }\n\n  return detected;\n}\n\nfunction readTagProperty(state) {\n  var _position,\n      isVerbatim = false,\n      isNamed    = false,\n      tagHandle,\n      tagName,\n      ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch !== 0x21/* ! */) return false;\n\n  if (state.tag !== null) {\n    throwError(state, 'duplication of a tag property');\n  }\n\n  ch = state.input.charCodeAt(++state.position);\n\n  if (ch === 0x3C/* < */) {\n    isVerbatim = true;\n    ch = state.input.charCodeAt(++state.position);\n\n  } else if (ch === 0x21/* ! */) {\n    isNamed = true;\n    tagHandle = '!!';\n    ch = state.input.charCodeAt(++state.position);\n\n  } else {\n    tagHandle = '!';\n  }\n\n  _position = state.position;\n\n  if (isVerbatim) {\n    do { ch = state.input.charCodeAt(++state.position); }\n    while (ch !== 0 && ch !== 0x3E/* > */);\n\n    if (state.position < state.length) {\n      tagName = state.input.slice(_position, state.position);\n      ch = state.input.charCodeAt(++state.position);\n    } else {\n      throwError(state, 'unexpected end of the stream within a verbatim tag');\n    }\n  } else {\n    while (ch !== 0 && !is_WS_OR_EOL(ch)) {\n\n      if (ch === 0x21/* ! */) {\n        if (!isNamed) {\n          tagHandle = state.input.slice(_position - 1, state.position + 1);\n\n          if (!PATTERN_TAG_HANDLE.test(tagHandle)) {\n            throwError(state, 'named tag handle cannot contain such characters');\n          }\n\n          isNamed = true;\n          _position = state.position + 1;\n        } else {\n          throwError(state, 'tag suffix cannot contain exclamation marks');\n        }\n      }\n\n      ch = state.input.charCodeAt(++state.position);\n    }\n\n    tagName = state.input.slice(_position, state.position);\n\n    if (PATTERN_FLOW_INDICATORS.test(tagName)) {\n      throwError(state, 'tag suffix cannot contain flow indicator characters');\n    }\n  }\n\n  if (tagName && !PATTERN_TAG_URI.test(tagName)) {\n    throwError(state, 'tag name cannot contain such characters: ' + tagName);\n  }\n\n  try {\n    tagName = decodeURIComponent(tagName);\n  } catch (err) {\n    throwError(state, 'tag name is malformed: ' + tagName);\n  }\n\n  if (isVerbatim) {\n    state.tag = tagName;\n\n  } else if (_hasOwnProperty$1.call(state.tagMap, tagHandle)) {\n    state.tag = state.tagMap[tagHandle] + tagName;\n\n  } else if (tagHandle === '!') {\n    state.tag = '!' + tagName;\n\n  } else if (tagHandle === '!!') {\n    state.tag = 'tag:yaml.org,2002:' + tagName;\n\n  } else {\n    throwError(state, 'undeclared tag handle \"' + tagHandle + '\"');\n  }\n\n  return true;\n}\n\nfunction readAnchorProperty(state) {\n  var _position,\n      ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch !== 0x26/* & */) return false;\n\n  if (state.anchor !== null) {\n    throwError(state, 'duplication of an anchor property');\n  }\n\n  ch = state.input.charCodeAt(++state.position);\n  _position = state.position;\n\n  while (ch !== 0 && !is_WS_OR_EOL(ch) && !is_FLOW_INDICATOR(ch)) {\n    ch = state.input.charCodeAt(++state.position);\n  }\n\n  if (state.position === _position) {\n    throwError(state, 'name of an anchor node must contain at least one character');\n  }\n\n  state.anchor = state.input.slice(_position, state.position);\n  return true;\n}\n\nfunction readAlias(state) {\n  var _position, alias,\n      ch;\n\n  ch = state.input.charCodeAt(state.position);\n\n  if (ch !== 0x2A/* * */) return false;\n\n  ch = state.input.charCodeAt(++state.position);\n  _position = state.position;\n\n  while (ch !== 0 && !is_WS_OR_EOL(ch) && !is_FLOW_INDICATOR(ch)) {\n    ch = state.input.charCodeAt(++state.position);\n  }\n\n  if (state.position === _position) {\n    throwError(state, 'name of an alias node must contain at least one character');\n  }\n\n  alias = state.input.slice(_position, state.position);\n\n  if (!_hasOwnProperty$1.call(state.anchorMap, alias)) {\n    throwError(state, 'unidentified alias \"' + alias + '\"');\n  }\n\n  state.result = state.anchorMap[alias];\n  skipSeparationSpace(state, true, -1);\n  return true;\n}\n\nfunction composeNode(state, parentIndent, nodeContext, allowToSeek, allowCompact) {\n  var allowBlockStyles,\n      allowBlockScalars,\n      allowBlockCollections,\n      indentStatus = 1, // 1: this>parent, 0: this=parent, -1: this<parent\n      atNewLine  = false,\n      hasContent = false,\n      typeIndex,\n      typeQuantity,\n      typeList,\n      type,\n      flowIndent,\n      blockIndent;\n\n  if (state.listener !== null) {\n    state.listener('open', state);\n  }\n\n  state.tag    = null;\n  state.anchor = null;\n  state.kind   = null;\n  state.result = null;\n\n  allowBlockStyles = allowBlockScalars = allowBlockCollections =\n    CONTEXT_BLOCK_OUT === nodeContext ||\n    CONTEXT_BLOCK_IN  === nodeContext;\n\n  if (allowToSeek) {\n    if (skipSeparationSpace(state, true, -1)) {\n      atNewLine = true;\n\n      if (state.lineIndent > parentIndent) {\n        indentStatus = 1;\n      } else if (state.lineIndent === parentIndent) {\n        indentStatus = 0;\n      } else if (state.lineIndent < parentIndent) {\n        indentStatus = -1;\n      }\n    }\n  }\n\n  if (indentStatus === 1) {\n    while (readTagProperty(state) || readAnchorProperty(state)) {\n      if (skipSeparationSpace(state, true, -1)) {\n        atNewLine = true;\n        allowBlockCollections = allowBlockStyles;\n\n        if (state.lineIndent > parentIndent) {\n          indentStatus = 1;\n        } else if (state.lineIndent === parentIndent) {\n          indentStatus = 0;\n        } else if (state.lineIndent < parentIndent) {\n          indentStatus = -1;\n        }\n      } else {\n        allowBlockCollections = false;\n      }\n    }\n  }\n\n  if (allowBlockCollections) {\n    allowBlockCollections = atNewLine || allowCompact;\n  }\n\n  if (indentStatus === 1 || CONTEXT_BLOCK_OUT === nodeContext) {\n    if (CONTEXT_FLOW_IN === nodeContext || CONTEXT_FLOW_OUT === nodeContext) {\n      flowIndent = parentIndent;\n    } else {\n      flowIndent = parentIndent + 1;\n    }\n\n    blockIndent = state.position - state.lineStart;\n\n    if (indentStatus === 1) {\n      if (allowBlockCollections &&\n          (readBlockSequence(state, blockIndent) ||\n           readBlockMapping(state, blockIndent, flowIndent)) ||\n          readFlowCollection(state, flowIndent)) {\n        hasContent = true;\n      } else {\n        if ((allowBlockScalars && readBlockScalar(state, flowIndent)) ||\n            readSingleQuotedScalar(state, flowIndent) ||\n            readDoubleQuotedScalar(state, flowIndent)) {\n          hasContent = true;\n\n        } else if (readAlias(state)) {\n          hasContent = true;\n\n          if (state.tag !== null || state.anchor !== null) {\n            throwError(state, 'alias node should not have any properties');\n          }\n\n        } else if (readPlainScalar(state, flowIndent, CONTEXT_FLOW_IN === nodeContext)) {\n          hasContent = true;\n\n          if (state.tag === null) {\n            state.tag = '?';\n          }\n        }\n\n        if (state.anchor !== null) {\n          state.anchorMap[state.anchor] = state.result;\n        }\n      }\n    } else if (indentStatus === 0) {\n      // Special case: block sequences are allowed to have same indentation level as the parent.\n      // http://www.yaml.org/spec/1.2/spec.html#id2799784\n      hasContent = allowBlockCollections && readBlockSequence(state, blockIndent);\n    }\n  }\n\n  if (state.tag === null) {\n    if (state.anchor !== null) {\n      state.anchorMap[state.anchor] = state.result;\n    }\n\n  } else if (state.tag === '?') {\n    // Implicit resolving is not allowed for non-scalar types, and '?'\n    // non-specific tag is only automatically assigned to plain scalars.\n    //\n    // We only need to check kind conformity in case user explicitly assigns '?'\n    // tag, for example like this: \"!<?> [0]\"\n    //\n    if (state.result !== null && state.kind !== 'scalar') {\n      throwError(state, 'unacceptable node kind for !<?> tag; it should be \"scalar\", not \"' + state.kind + '\"');\n    }\n\n    for (typeIndex = 0, typeQuantity = state.implicitTypes.length; typeIndex < typeQuantity; typeIndex += 1) {\n      type = state.implicitTypes[typeIndex];\n\n      if (type.resolve(state.result)) { // `state.result` updated in resolver if matched\n        state.result = type.construct(state.result);\n        state.tag = type.tag;\n        if (state.anchor !== null) {\n          state.anchorMap[state.anchor] = state.result;\n        }\n        break;\n      }\n    }\n  } else if (state.tag !== '!') {\n    if (_hasOwnProperty$1.call(state.typeMap[state.kind || 'fallback'], state.tag)) {\n      type = state.typeMap[state.kind || 'fallback'][state.tag];\n    } else {\n      // looking for multi type\n      type = null;\n      typeList = state.typeMap.multi[state.kind || 'fallback'];\n\n      for (typeIndex = 0, typeQuantity = typeList.length; typeIndex < typeQuantity; typeIndex += 1) {\n        if (state.tag.slice(0, typeList[typeIndex].tag.length) === typeList[typeIndex].tag) {\n          type = typeList[typeIndex];\n          break;\n        }\n      }\n    }\n\n    if (!type) {\n      throwError(state, 'unknown tag !<' + state.tag + '>');\n    }\n\n    if (state.result !== null && type.kind !== state.kind) {\n      throwError(state, 'unacceptable node kind for !<' + state.tag + '> tag; it should be \"' + type.kind + '\", not \"' + state.kind + '\"');\n    }\n\n    if (!type.resolve(state.result, state.tag)) { // `state.result` updated in resolver if matched\n      throwError(state, 'cannot resolve a node with !<' + state.tag + '> explicit tag');\n    } else {\n      state.result = type.construct(state.result, state.tag);\n      if (state.anchor !== null) {\n        state.anchorMap[state.anchor] = state.result;\n      }\n    }\n  }\n\n  if (state.listener !== null) {\n    state.listener('close', state);\n  }\n  return state.tag !== null ||  state.anchor !== null || hasContent;\n}\n\nfunction readDocument(state) {\n  var documentStart = state.position,\n      _position,\n      directiveName,\n      directiveArgs,\n      hasDirectives = false,\n      ch;\n\n  state.version = null;\n  state.checkLineBreaks = state.legacy;\n  state.tagMap = Object.create(null);\n  state.anchorMap = Object.create(null);\n\n  while ((ch = state.input.charCodeAt(state.position)) !== 0) {\n    skipSeparationSpace(state, true, -1);\n\n    ch = state.input.charCodeAt(state.position);\n\n    if (state.lineIndent > 0 || ch !== 0x25/* % */) {\n      break;\n    }\n\n    hasDirectives = true;\n    ch = state.input.charCodeAt(++state.position);\n    _position = state.position;\n\n    while (ch !== 0 && !is_WS_OR_EOL(ch)) {\n      ch = state.input.charCodeAt(++state.position);\n    }\n\n    directiveName = state.input.slice(_position, state.position);\n    directiveArgs = [];\n\n    if (directiveName.length < 1) {\n      throwError(state, 'directive name must not be less than one character in length');\n    }\n\n    while (ch !== 0) {\n      while (is_WHITE_SPACE(ch)) {\n        ch = state.input.charCodeAt(++state.position);\n      }\n\n      if (ch === 0x23/* # */) {\n        do { ch = state.input.charCodeAt(++state.position); }\n        while (ch !== 0 && !is_EOL(ch));\n        break;\n      }\n\n      if (is_EOL(ch)) break;\n\n      _position = state.position;\n\n      while (ch !== 0 && !is_WS_OR_EOL(ch)) {\n        ch = state.input.charCodeAt(++state.position);\n      }\n\n      directiveArgs.push(state.input.slice(_position, state.position));\n    }\n\n    if (ch !== 0) readLineBreak(state);\n\n    if (_hasOwnProperty$1.call(directiveHandlers, directiveName)) {\n      directiveHandlers[directiveName](state, directiveName, directiveArgs);\n    } else {\n      throwWarning(state, 'unknown document directive \"' + directiveName + '\"');\n    }\n  }\n\n  skipSeparationSpace(state, true, -1);\n\n  if (state.lineIndent === 0 &&\n      state.input.charCodeAt(state.position)     === 0x2D/* - */ &&\n      state.input.charCodeAt(state.position + 1) === 0x2D/* - */ &&\n      state.input.charCodeAt(state.position + 2) === 0x2D/* - */) {\n    state.position += 3;\n    skipSeparationSpace(state, true, -1);\n\n  } else if (hasDirectives) {\n    throwError(state, 'directives end mark is expected');\n  }\n\n  composeNode(state, state.lineIndent - 1, CONTEXT_BLOCK_OUT, false, true);\n  skipSeparationSpace(state, true, -1);\n\n  if (state.checkLineBreaks &&\n      PATTERN_NON_ASCII_LINE_BREAKS.test(state.input.slice(documentStart, state.position))) {\n    throwWarning(state, 'non-ASCII line breaks are interpreted as content');\n  }\n\n  state.documents.push(state.result);\n\n  if (state.position === state.lineStart && testDocumentSeparator(state)) {\n\n    if (state.input.charCodeAt(state.position) === 0x2E/* . */) {\n      state.position += 3;\n      skipSeparationSpace(state, true, -1);\n    }\n    return;\n  }\n\n  if (state.position < (state.length - 1)) {\n    throwError(state, 'end of the stream or a document separator is expected');\n  } else {\n    return;\n  }\n}\n\n\nfunction loadDocuments(input, options) {\n  input = String(input);\n  options = options || {};\n\n  if (input.length !== 0) {\n\n    // Add tailing `\\n` if not exists\n    if (input.charCodeAt(input.length - 1) !== 0x0A/* LF */ &&\n        input.charCodeAt(input.length - 1) !== 0x0D/* CR */) {\n      input += '\\n';\n    }\n\n    // Strip BOM\n    if (input.charCodeAt(0) === 0xFEFF) {\n      input = input.slice(1);\n    }\n  }\n\n  var state = new State$1(input, options);\n\n  var nullpos = input.indexOf('\\0');\n\n  if (nullpos !== -1) {\n    state.position = nullpos;\n    throwError(state, 'null byte is not allowed in input');\n  }\n\n  // Use 0 as string terminator. That significantly simplifies bounds check.\n  state.input += '\\0';\n\n  while (state.input.charCodeAt(state.position) === 0x20/* Space */) {\n    state.lineIndent += 1;\n    state.position += 1;\n  }\n\n  while (state.position < (state.length - 1)) {\n    readDocument(state);\n  }\n\n  return state.documents;\n}\n\n\nfunction loadAll$1(input, iterator, options) {\n  if (iterator !== null && typeof iterator === 'object' && typeof options === 'undefined') {\n    options = iterator;\n    iterator = null;\n  }\n\n  var documents = loadDocuments(input, options);\n\n  if (typeof iterator !== 'function') {\n    return documents;\n  }\n\n  for (var index = 0, length = documents.length; index < length; index += 1) {\n    iterator(documents[index]);\n  }\n}\n\n\nfunction load$1(input, options) {\n  var documents = loadDocuments(input, options);\n\n  if (documents.length === 0) {\n    /*eslint-disable no-undefined*/\n    return undefined;\n  } else if (documents.length === 1) {\n    return documents[0];\n  }\n  throw new exception('expected a single document in the stream, but found more');\n}\n\n\nvar loadAll_1 = loadAll$1;\nvar load_1    = load$1;\n\nvar loader = {\n\tloadAll: loadAll_1,\n\tload: load_1\n};\n\n/*eslint-disable no-use-before-define*/\n\n\n\n\n\nvar _toString       = Object.prototype.toString;\nvar _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar CHAR_BOM                  = 0xFEFF;\nvar CHAR_TAB                  = 0x09; /* Tab */\nvar CHAR_LINE_FEED            = 0x0A; /* LF */\nvar CHAR_CARRIAGE_RETURN      = 0x0D; /* CR */\nvar CHAR_SPACE                = 0x20; /* Space */\nvar CHAR_EXCLAMATION          = 0x21; /* ! */\nvar CHAR_DOUBLE_QUOTE         = 0x22; /* \" */\nvar CHAR_SHARP                = 0x23; /* # */\nvar CHAR_PERCENT              = 0x25; /* % */\nvar CHAR_AMPERSAND            = 0x26; /* & */\nvar CHAR_SINGLE_QUOTE         = 0x27; /* ' */\nvar CHAR_ASTERISK             = 0x2A; /* * */\nvar CHAR_COMMA                = 0x2C; /* , */\nvar CHAR_MINUS                = 0x2D; /* - */\nvar CHAR_COLON                = 0x3A; /* : */\nvar CHAR_EQUALS               = 0x3D; /* = */\nvar CHAR_GREATER_THAN         = 0x3E; /* > */\nvar CHAR_QUESTION             = 0x3F; /* ? */\nvar CHAR_COMMERCIAL_AT        = 0x40; /* @ */\nvar CHAR_LEFT_SQUARE_BRACKET  = 0x5B; /* [ */\nvar CHAR_RIGHT_SQUARE_BRACKET = 0x5D; /* ] */\nvar CHAR_GRAVE_ACCENT         = 0x60; /* ` */\nvar CHAR_LEFT_CURLY_BRACKET   = 0x7B; /* { */\nvar CHAR_VERTICAL_LINE        = 0x7C; /* | */\nvar CHAR_RIGHT_CURLY_BRACKET  = 0x7D; /* } */\n\nvar ESCAPE_SEQUENCES = {};\n\nESCAPE_SEQUENCES[0x00]   = '\\\\0';\nESCAPE_SEQUENCES[0x07]   = '\\\\a';\nESCAPE_SEQUENCES[0x08]   = '\\\\b';\nESCAPE_SEQUENCES[0x09]   = '\\\\t';\nESCAPE_SEQUENCES[0x0A]   = '\\\\n';\nESCAPE_SEQUENCES[0x0B]   = '\\\\v';\nESCAPE_SEQUENCES[0x0C]   = '\\\\f';\nESCAPE_SEQUENCES[0x0D]   = '\\\\r';\nESCAPE_SEQUENCES[0x1B]   = '\\\\e';\nESCAPE_SEQUENCES[0x22]   = '\\\\\"';\nESCAPE_SEQUENCES[0x5C]   = '\\\\\\\\';\nESCAPE_SEQUENCES[0x85]   = '\\\\N';\nESCAPE_SEQUENCES[0xA0]   = '\\\\_';\nESCAPE_SEQUENCES[0x2028] = '\\\\L';\nESCAPE_SEQUENCES[0x2029] = '\\\\P';\n\nvar DEPRECATED_BOOLEANS_SYNTAX = [\n  'y', 'Y', 'yes', 'Yes', 'YES', 'on', 'On', 'ON',\n  'n', 'N', 'no', 'No', 'NO', 'off', 'Off', 'OFF'\n];\n\nvar DEPRECATED_BASE60_SYNTAX = /^[-+]?[0-9_]+(?::[0-9_]+)+(?:\\.[0-9_]*)?$/;\n\nfunction compileStyleMap(schema, map) {\n  var result, keys, index, length, tag, style, type;\n\n  if (map === null) return {};\n\n  result = {};\n  keys = Object.keys(map);\n\n  for (index = 0, length = keys.length; index < length; index += 1) {\n    tag = keys[index];\n    style = String(map[tag]);\n\n    if (tag.slice(0, 2) === '!!') {\n      tag = 'tag:yaml.org,2002:' + tag.slice(2);\n    }\n    type = schema.compiledTypeMap['fallback'][tag];\n\n    if (type && _hasOwnProperty.call(type.styleAliases, style)) {\n      style = type.styleAliases[style];\n    }\n\n    result[tag] = style;\n  }\n\n  return result;\n}\n\nfunction encodeHex(character) {\n  var string, handle, length;\n\n  string = character.toString(16).toUpperCase();\n\n  if (character <= 0xFF) {\n    handle = 'x';\n    length = 2;\n  } else if (character <= 0xFFFF) {\n    handle = 'u';\n    length = 4;\n  } else if (character <= 0xFFFFFFFF) {\n    handle = 'U';\n    length = 8;\n  } else {\n    throw new exception('code point within a string may not be greater than 0xFFFFFFFF');\n  }\n\n  return '\\\\' + handle + common.repeat('0', length - string.length) + string;\n}\n\n\nvar QUOTING_TYPE_SINGLE = 1,\n    QUOTING_TYPE_DOUBLE = 2;\n\nfunction State(options) {\n  this.schema        = options['schema'] || _default;\n  this.indent        = Math.max(1, (options['indent'] || 2));\n  this.noArrayIndent = options['noArrayIndent'] || false;\n  this.skipInvalid   = options['skipInvalid'] || false;\n  this.flowLevel     = (common.isNothing(options['flowLevel']) ? -1 : options['flowLevel']);\n  this.styleMap      = compileStyleMap(this.schema, options['styles'] || null);\n  this.sortKeys      = options['sortKeys'] || false;\n  this.lineWidth     = options['lineWidth'] || 80;\n  this.noRefs        = options['noRefs'] || false;\n  this.noCompatMode  = options['noCompatMode'] || false;\n  this.condenseFlow  = options['condenseFlow'] || false;\n  this.quotingType   = options['quotingType'] === '\"' ? QUOTING_TYPE_DOUBLE : QUOTING_TYPE_SINGLE;\n  this.forceQuotes   = options['forceQuotes'] || false;\n  this.replacer      = typeof options['replacer'] === 'function' ? options['replacer'] : null;\n\n  this.implicitTypes = this.schema.compiledImplicit;\n  this.explicitTypes = this.schema.compiledExplicit;\n\n  this.tag = null;\n  this.result = '';\n\n  this.duplicates = [];\n  this.usedDuplicates = null;\n}\n\n// Indents every line in a string. Empty lines (\\n only) are not indented.\nfunction indentString(string, spaces) {\n  var ind = common.repeat(' ', spaces),\n      position = 0,\n      next = -1,\n      result = '',\n      line,\n      length = string.length;\n\n  while (position < length) {\n    next = string.indexOf('\\n', position);\n    if (next === -1) {\n      line = string.slice(position);\n      position = length;\n    } else {\n      line = string.slice(position, next + 1);\n      position = next + 1;\n    }\n\n    if (line.length && line !== '\\n') result += ind;\n\n    result += line;\n  }\n\n  return result;\n}\n\nfunction generateNextLine(state, level) {\n  return '\\n' + common.repeat(' ', state.indent * level);\n}\n\nfunction testImplicitResolving(state, str) {\n  var index, length, type;\n\n  for (index = 0, length = state.implicitTypes.length; index < length; index += 1) {\n    type = state.implicitTypes[index];\n\n    if (type.resolve(str)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// [33] s-white ::= s-space | s-tab\nfunction isWhitespace(c) {\n  return c === CHAR_SPACE || c === CHAR_TAB;\n}\n\n// Returns true if the character can be printed without escaping.\n// From YAML 1.2: \"any allowed characters known to be non-printable\n// should also be escaped. [However,] This isn\u2019t mandatory\"\n// Derived from nb-char - \\t - #x85 - #xA0 - #x2028 - #x2029.\nfunction isPrintable(c) {\n  return  (0x00020 <= c && c <= 0x00007E)\n      || ((0x000A1 <= c && c <= 0x00D7FF) && c !== 0x2028 && c !== 0x2029)\n      || ((0x0E000 <= c && c <= 0x00FFFD) && c !== CHAR_BOM)\n      ||  (0x10000 <= c && c <= 0x10FFFF);\n}\n\n// [34] ns-char ::= nb-char - s-white\n// [27] nb-char ::= c-printable - b-char - c-byte-order-mark\n// [26] b-char  ::= b-line-feed | b-carriage-return\n// Including s-white (for some reason, examples doesn't match specs in this aspect)\n// ns-char ::= c-printable - b-line-feed - b-carriage-return - c-byte-order-mark\nfunction isNsCharOrWhitespace(c) {\n  return isPrintable(c)\n    && c !== CHAR_BOM\n    // - b-char\n    && c !== CHAR_CARRIAGE_RETURN\n    && c !== CHAR_LINE_FEED;\n}\n\n// [127]  ns-plain-safe(c) ::= c = flow-out  \u21D2 ns-plain-safe-out\n//                             c = flow-in   \u21D2 ns-plain-safe-in\n//                             c = block-key \u21D2 ns-plain-safe-out\n//                             c = flow-key  \u21D2 ns-plain-safe-in\n// [128] ns-plain-safe-out ::= ns-char\n// [129]  ns-plain-safe-in ::= ns-char - c-flow-indicator\n// [130]  ns-plain-char(c) ::=  ( ns-plain-safe(c) - \u201C:\u201D - \u201C#\u201D )\n//                            | ( /* An ns-char preceding */ \u201C#\u201D )\n//                            | ( \u201C:\u201D /* Followed by an ns-plain-safe(c) */ )\nfunction isPlainSafe(c, prev, inblock) {\n  var cIsNsCharOrWhitespace = isNsCharOrWhitespace(c);\n  var cIsNsChar = cIsNsCharOrWhitespace && !isWhitespace(c);\n  return (\n    // ns-plain-safe\n    inblock ? // c = flow-in\n      cIsNsCharOrWhitespace\n      : cIsNsCharOrWhitespace\n        // - c-flow-indicator\n        && c !== CHAR_COMMA\n        && c !== CHAR_LEFT_SQUARE_BRACKET\n        && c !== CHAR_RIGHT_SQUARE_BRACKET\n        && c !== CHAR_LEFT_CURLY_BRACKET\n        && c !== CHAR_RIGHT_CURLY_BRACKET\n  )\n    // ns-plain-char\n    && c !== CHAR_SHARP // false on '#'\n    && !(prev === CHAR_COLON && !cIsNsChar) // false on ': '\n    || (isNsCharOrWhitespace(prev) && !isWhitespace(prev) && c === CHAR_SHARP) // change to true on '[^ ]#'\n    || (prev === CHAR_COLON && cIsNsChar); // change to true on ':[^ ]'\n}\n\n// Simplified test for values allowed as the first character in plain style.\nfunction isPlainSafeFirst(c) {\n  // Uses a subset of ns-char - c-indicator\n  // where ns-char = nb-char - s-white.\n  // No support of ( ( \u201C?\u201D | \u201C:\u201D | \u201C-\u201D ) /* Followed by an ns-plain-safe(c)) */ ) part\n  return isPrintable(c) && c !== CHAR_BOM\n    && !isWhitespace(c) // - s-white\n    // - (c-indicator ::=\n    // \u201C-\u201D | \u201C?\u201D | \u201C:\u201D | \u201C,\u201D | \u201C[\u201D | \u201C]\u201D | \u201C{\u201D | \u201C}\u201D\n    && c !== CHAR_MINUS\n    && c !== CHAR_QUESTION\n    && c !== CHAR_COLON\n    && c !== CHAR_COMMA\n    && c !== CHAR_LEFT_SQUARE_BRACKET\n    && c !== CHAR_RIGHT_SQUARE_BRACKET\n    && c !== CHAR_LEFT_CURLY_BRACKET\n    && c !== CHAR_RIGHT_CURLY_BRACKET\n    // | \u201C#\u201D | \u201C&\u201D | \u201C*\u201D | \u201C!\u201D | \u201C|\u201D | \u201C=\u201D | \u201C>\u201D | \u201C'\u201D | \u201C\"\u201D\n    && c !== CHAR_SHARP\n    && c !== CHAR_AMPERSAND\n    && c !== CHAR_ASTERISK\n    && c !== CHAR_EXCLAMATION\n    && c !== CHAR_VERTICAL_LINE\n    && c !== CHAR_EQUALS\n    && c !== CHAR_GREATER_THAN\n    && c !== CHAR_SINGLE_QUOTE\n    && c !== CHAR_DOUBLE_QUOTE\n    // | \u201C%\u201D | \u201C@\u201D | \u201C`\u201D)\n    && c !== CHAR_PERCENT\n    && c !== CHAR_COMMERCIAL_AT\n    && c !== CHAR_GRAVE_ACCENT;\n}\n\n// Simplified test for values allowed as the last character in plain style.\nfunction isPlainSafeLast(c) {\n  // just not whitespace or colon, it will be checked to be plain character later\n  return !isWhitespace(c) && c !== CHAR_COLON;\n}\n\n// Same as 'string'.codePointAt(pos), but works in older browsers.\nfunction codePointAt(string, pos) {\n  var first = string.charCodeAt(pos), second;\n  if (first >= 0xD800 && first <= 0xDBFF && pos + 1 < string.length) {\n    second = string.charCodeAt(pos + 1);\n    if (second >= 0xDC00 && second <= 0xDFFF) {\n      // https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\n      return (first - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;\n    }\n  }\n  return first;\n}\n\n// Determines whether block indentation indicator is required.\nfunction needIndentIndicator(string) {\n  var leadingSpaceRe = /^\\n* /;\n  return leadingSpaceRe.test(string);\n}\n\nvar STYLE_PLAIN   = 1,\n    STYLE_SINGLE  = 2,\n    STYLE_LITERAL = 3,\n    STYLE_FOLDED  = 4,\n    STYLE_DOUBLE  = 5;\n\n// Determines which scalar styles are possible and returns the preferred style.\n// lineWidth = -1 => no limit.\n// Pre-conditions: str.length > 0.\n// Post-conditions:\n//    STYLE_PLAIN or STYLE_SINGLE => no \\n are in the string.\n//    STYLE_LITERAL => no lines are suitable for folding (or lineWidth is -1).\n//    STYLE_FOLDED => a line > lineWidth and can be folded (and lineWidth != -1).\nfunction chooseScalarStyle(string, singleLineOnly, indentPerLevel, lineWidth,\n  testAmbiguousType, quotingType, forceQuotes, inblock) {\n\n  var i;\n  var char = 0;\n  var prevChar = null;\n  var hasLineBreak = false;\n  var hasFoldableLine = false; // only checked if shouldTrackWidth\n  var shouldTrackWidth = lineWidth !== -1;\n  var previousLineBreak = -1; // count the first line correctly\n  var plain = isPlainSafeFirst(codePointAt(string, 0))\n          && isPlainSafeLast(codePointAt(string, string.length - 1));\n\n  if (singleLineOnly || forceQuotes) {\n    // Case: no block styles.\n    // Check for disallowed characters to rule out plain and single.\n    for (i = 0; i < string.length; char >= 0x10000 ? i += 2 : i++) {\n      char = codePointAt(string, i);\n      if (!isPrintable(char)) {\n        return STYLE_DOUBLE;\n      }\n      plain = plain && isPlainSafe(char, prevChar, inblock);\n      prevChar = char;\n    }\n  } else {\n    // Case: block styles permitted.\n    for (i = 0; i < string.length; char >= 0x10000 ? i += 2 : i++) {\n      char = codePointAt(string, i);\n      if (char === CHAR_LINE_FEED) {\n        hasLineBreak = true;\n        // Check if any line can be folded.\n        if (shouldTrackWidth) {\n          hasFoldableLine = hasFoldableLine ||\n            // Foldable line = too long, and not more-indented.\n            (i - previousLineBreak - 1 > lineWidth &&\n             string[previousLineBreak + 1] !== ' ');\n          previousLineBreak = i;\n        }\n      } else if (!isPrintable(char)) {\n        return STYLE_DOUBLE;\n      }\n      plain = plain && isPlainSafe(char, prevChar, inblock);\n      prevChar = char;\n    }\n    // in case the end is missing a \\n\n    hasFoldableLine = hasFoldableLine || (shouldTrackWidth &&\n      (i - previousLineBreak - 1 > lineWidth &&\n       string[previousLineBreak + 1] !== ' '));\n  }\n  // Although every style can represent \\n without escaping, prefer block styles\n  // for multiline, since they're more readable and they don't add empty lines.\n  // Also prefer folding a super-long line.\n  if (!hasLineBreak && !hasFoldableLine) {\n    // Strings interpretable as another type have to be quoted;\n    // e.g. the string 'true' vs. the boolean true.\n    if (plain && !forceQuotes && !testAmbiguousType(string)) {\n      return STYLE_PLAIN;\n    }\n    return quotingType === QUOTING_TYPE_DOUBLE ? STYLE_DOUBLE : STYLE_SINGLE;\n  }\n  // Edge case: block indentation indicator can only have one digit.\n  if (indentPerLevel > 9 && needIndentIndicator(string)) {\n    return STYLE_DOUBLE;\n  }\n  // At this point we know block styles are valid.\n  // Prefer literal style unless we want to fold.\n  if (!forceQuotes) {\n    return hasFoldableLine ? STYLE_FOLDED : STYLE_LITERAL;\n  }\n  return quotingType === QUOTING_TYPE_DOUBLE ? STYLE_DOUBLE : STYLE_SINGLE;\n}\n\n// Note: line breaking/folding is implemented for only the folded style.\n// NB. We drop the last trailing newline (if any) of a returned block scalar\n//  since the dumper adds its own newline. This always works:\n//    \u2022 No ending newline => unaffected; already using strip \"-\" chomping.\n//    \u2022 Ending newline    => removed then restored.\n//  Importantly, this keeps the \"+\" chomp indicator from gaining an extra line.\nfunction writeScalar(state, string, level, iskey, inblock) {\n  state.dump = (function () {\n    if (string.length === 0) {\n      return state.quotingType === QUOTING_TYPE_DOUBLE ? '\"\"' : \"''\";\n    }\n    if (!state.noCompatMode) {\n      if (DEPRECATED_BOOLEANS_SYNTAX.indexOf(string) !== -1 || DEPRECATED_BASE60_SYNTAX.test(string)) {\n        return state.quotingType === QUOTING_TYPE_DOUBLE ? ('\"' + string + '\"') : (\"'\" + string + \"'\");\n      }\n    }\n\n    var indent = state.indent * Math.max(1, level); // no 0-indent scalars\n    // As indentation gets deeper, let the width decrease monotonically\n    // to the lower bound min(state.lineWidth, 40).\n    // Note that this implies\n    //  state.lineWidth \u2264 40 + state.indent: width is fixed at the lower bound.\n    //  state.lineWidth > 40 + state.indent: width decreases until the lower bound.\n    // This behaves better than a constant minimum width which disallows narrower options,\n    // or an indent threshold which causes the width to suddenly increase.\n    var lineWidth = state.lineWidth === -1\n      ? -1 : Math.max(Math.min(state.lineWidth, 40), state.lineWidth - indent);\n\n    // Without knowing if keys are implicit/explicit, assume implicit for safety.\n    var singleLineOnly = iskey\n      // No block styles in flow mode.\n      || (state.flowLevel > -1 && level >= state.flowLevel);\n    function testAmbiguity(string) {\n      return testImplicitResolving(state, string);\n    }\n\n    switch (chooseScalarStyle(string, singleLineOnly, state.indent, lineWidth,\n      testAmbiguity, state.quotingType, state.forceQuotes && !iskey, inblock)) {\n\n      case STYLE_PLAIN:\n        return string;\n      case STYLE_SINGLE:\n        return \"'\" + string.replace(/'/g, \"''\") + \"'\";\n      case STYLE_LITERAL:\n        return '|' + blockHeader(string, state.indent)\n          + dropEndingNewline(indentString(string, indent));\n      case STYLE_FOLDED:\n        return '>' + blockHeader(string, state.indent)\n          + dropEndingNewline(indentString(foldString(string, lineWidth), indent));\n      case STYLE_DOUBLE:\n        return '\"' + escapeString(string) + '\"';\n      default:\n        throw new exception('impossible error: invalid scalar style');\n    }\n  }());\n}\n\n// Pre-conditions: string is valid for a block scalar, 1 <= indentPerLevel <= 9.\nfunction blockHeader(string, indentPerLevel) {\n  var indentIndicator = needIndentIndicator(string) ? String(indentPerLevel) : '';\n\n  // note the special case: the string '\\n' counts as a \"trailing\" empty line.\n  var clip =          string[string.length - 1] === '\\n';\n  var keep = clip && (string[string.length - 2] === '\\n' || string === '\\n');\n  var chomp = keep ? '+' : (clip ? '' : '-');\n\n  return indentIndicator + chomp + '\\n';\n}\n\n// (See the note for writeScalar.)\nfunction dropEndingNewline(string) {\n  return string[string.length - 1] === '\\n' ? string.slice(0, -1) : string;\n}\n\n// Note: a long line without a suitable break point will exceed the width limit.\n// Pre-conditions: every char in str isPrintable, str.length > 0, width > 0.\nfunction foldString(string, width) {\n  // In folded style, $k$ consecutive newlines output as $k+1$ newlines\u2014\n  // unless they're before or after a more-indented line, or at the very\n  // beginning or end, in which case $k$ maps to $k$.\n  // Therefore, parse each chunk as newline(s) followed by a content line.\n  var lineRe = /(\\n+)([^\\n]*)/g;\n\n  // first line (possibly an empty line)\n  var result = (function () {\n    var nextLF = string.indexOf('\\n');\n    nextLF = nextLF !== -1 ? nextLF : string.length;\n    lineRe.lastIndex = nextLF;\n    return foldLine(string.slice(0, nextLF), width);\n  }());\n  // If we haven't reached the first content line yet, don't add an extra \\n.\n  var prevMoreIndented = string[0] === '\\n' || string[0] === ' ';\n  var moreIndented;\n\n  // rest of the lines\n  var match;\n  while ((match = lineRe.exec(string))) {\n    var prefix = match[1], line = match[2];\n    moreIndented = (line[0] === ' ');\n    result += prefix\n      + (!prevMoreIndented && !moreIndented && line !== ''\n        ? '\\n' : '')\n      + foldLine(line, width);\n    prevMoreIndented = moreIndented;\n  }\n\n  return result;\n}\n\n// Greedy line breaking.\n// Picks the longest line under the limit each time,\n// otherwise settles for the shortest line over the limit.\n// NB. More-indented lines *cannot* be folded, as that would add an extra \\n.\nfunction foldLine(line, width) {\n  if (line === '' || line[0] === ' ') return line;\n\n  // Since a more-indented line adds a \\n, breaks can't be followed by a space.\n  var breakRe = / [^ ]/g; // note: the match index will always be <= length-2.\n  var match;\n  // start is an inclusive index. end, curr, and next are exclusive.\n  var start = 0, end, curr = 0, next = 0;\n  var result = '';\n\n  // Invariants: 0 <= start <= length-1.\n  //   0 <= curr <= next <= max(0, length-2). curr - start <= width.\n  // Inside the loop:\n  //   A match implies length >= 2, so curr and next are <= length-2.\n  while ((match = breakRe.exec(line))) {\n    next = match.index;\n    // maintain invariant: curr - start <= width\n    if (next - start > width) {\n      end = (curr > start) ? curr : next; // derive end <= length-2\n      result += '\\n' + line.slice(start, end);\n      // skip the space that was output as \\n\n      start = end + 1;                    // derive start <= length-1\n    }\n    curr = next;\n  }\n\n  // By the invariants, start <= length-1, so there is something left over.\n  // It is either the whole string or a part starting from non-whitespace.\n  result += '\\n';\n  // Insert a break if the remainder is too long and there is a break available.\n  if (line.length - start > width && curr > start) {\n    result += line.slice(start, curr) + '\\n' + line.slice(curr + 1);\n  } else {\n    result += line.slice(start);\n  }\n\n  return result.slice(1); // drop extra \\n joiner\n}\n\n// Escapes a double-quoted string.\nfunction escapeString(string) {\n  var result = '';\n  var char = 0;\n  var escapeSeq;\n\n  for (var i = 0; i < string.length; char >= 0x10000 ? i += 2 : i++) {\n    char = codePointAt(string, i);\n    escapeSeq = ESCAPE_SEQUENCES[char];\n\n    if (!escapeSeq && isPrintable(char)) {\n      result += string[i];\n      if (char >= 0x10000) result += string[i + 1];\n    } else {\n      result += escapeSeq || encodeHex(char);\n    }\n  }\n\n  return result;\n}\n\nfunction writeFlowSequence(state, level, object) {\n  var _result = '',\n      _tag    = state.tag,\n      index,\n      length,\n      value;\n\n  for (index = 0, length = object.length; index < length; index += 1) {\n    value = object[index];\n\n    if (state.replacer) {\n      value = state.replacer.call(object, String(index), value);\n    }\n\n    // Write only valid elements, put null instead of invalid elements.\n    if (writeNode(state, level, value, false, false) ||\n        (typeof value === 'undefined' &&\n         writeNode(state, level, null, false, false))) {\n\n      if (_result !== '') _result += ',' + (!state.condenseFlow ? ' ' : '');\n      _result += state.dump;\n    }\n  }\n\n  state.tag = _tag;\n  state.dump = '[' + _result + ']';\n}\n\nfunction writeBlockSequence(state, level, object, compact) {\n  var _result = '',\n      _tag    = state.tag,\n      index,\n      length,\n      value;\n\n  for (index = 0, length = object.length; index < length; index += 1) {\n    value = object[index];\n\n    if (state.replacer) {\n      value = state.replacer.call(object, String(index), value);\n    }\n\n    // Write only valid elements, put null instead of invalid elements.\n    if (writeNode(state, level + 1, value, true, true, false, true) ||\n        (typeof value === 'undefined' &&\n         writeNode(state, level + 1, null, true, true, false, true))) {\n\n      if (!compact || _result !== '') {\n        _result += generateNextLine(state, level);\n      }\n\n      if (state.dump && CHAR_LINE_FEED === state.dump.charCodeAt(0)) {\n        _result += '-';\n      } else {\n        _result += '- ';\n      }\n\n      _result += state.dump;\n    }\n  }\n\n  state.tag = _tag;\n  state.dump = _result || '[]'; // Empty sequence if no valid values.\n}\n\nfunction writeFlowMapping(state, level, object) {\n  var _result       = '',\n      _tag          = state.tag,\n      objectKeyList = Object.keys(object),\n      index,\n      length,\n      objectKey,\n      objectValue,\n      pairBuffer;\n\n  for (index = 0, length = objectKeyList.length; index < length; index += 1) {\n\n    pairBuffer = '';\n    if (_result !== '') pairBuffer += ', ';\n\n    if (state.condenseFlow) pairBuffer += '\"';\n\n    objectKey = objectKeyList[index];\n    objectValue = object[objectKey];\n\n    if (state.replacer) {\n      objectValue = state.replacer.call(object, objectKey, objectValue);\n    }\n\n    if (!writeNode(state, level, objectKey, false, false)) {\n      continue; // Skip this pair because of invalid key;\n    }\n\n    if (state.dump.length > 1024) pairBuffer += '? ';\n\n    pairBuffer += state.dump + (state.condenseFlow ? '\"' : '') + ':' + (state.condenseFlow ? '' : ' ');\n\n    if (!writeNode(state, level, objectValue, false, false)) {\n      continue; // Skip this pair because of invalid value.\n    }\n\n    pairBuffer += state.dump;\n\n    // Both key and value are valid.\n    _result += pairBuffer;\n  }\n\n  state.tag = _tag;\n  state.dump = '{' + _result + '}';\n}\n\nfunction writeBlockMapping(state, level, object, compact) {\n  var _result       = '',\n      _tag          = state.tag,\n      objectKeyList = Object.keys(object),\n      index,\n      length,\n      objectKey,\n      objectValue,\n      explicitPair,\n      pairBuffer;\n\n  // Allow sorting keys so that the output file is deterministic\n  if (state.sortKeys === true) {\n    // Default sorting\n    objectKeyList.sort();\n  } else if (typeof state.sortKeys === 'function') {\n    // Custom sort function\n    objectKeyList.sort(state.sortKeys);\n  } else if (state.sortKeys) {\n    // Something is wrong\n    throw new exception('sortKeys must be a boolean or a function');\n  }\n\n  for (index = 0, length = objectKeyList.length; index < length; index += 1) {\n    pairBuffer = '';\n\n    if (!compact || _result !== '') {\n      pairBuffer += generateNextLine(state, level);\n    }\n\n    objectKey = objectKeyList[index];\n    objectValue = object[objectKey];\n\n    if (state.replacer) {\n      objectValue = state.replacer.call(object, objectKey, objectValue);\n    }\n\n    if (!writeNode(state, level + 1, objectKey, true, true, true)) {\n      continue; // Skip this pair because of invalid key.\n    }\n\n    explicitPair = (state.tag !== null && state.tag !== '?') ||\n                   (state.dump && state.dump.length > 1024);\n\n    if (explicitPair) {\n      if (state.dump && CHAR_LINE_FEED === state.dump.charCodeAt(0)) {\n        pairBuffer += '?';\n      } else {\n        pairBuffer += '? ';\n      }\n    }\n\n    pairBuffer += state.dump;\n\n    if (explicitPair) {\n      pairBuffer += generateNextLine(state, level);\n    }\n\n    if (!writeNode(state, level + 1, objectValue, true, explicitPair)) {\n      continue; // Skip this pair because of invalid value.\n    }\n\n    if (state.dump && CHAR_LINE_FEED === state.dump.charCodeAt(0)) {\n      pairBuffer += ':';\n    } else {\n      pairBuffer += ': ';\n    }\n\n    pairBuffer += state.dump;\n\n    // Both key and value are valid.\n    _result += pairBuffer;\n  }\n\n  state.tag = _tag;\n  state.dump = _result || '{}'; // Empty mapping if no valid pairs.\n}\n\nfunction detectType(state, object, explicit) {\n  var _result, typeList, index, length, type, style;\n\n  typeList = explicit ? state.explicitTypes : state.implicitTypes;\n\n  for (index = 0, length = typeList.length; index < length; index += 1) {\n    type = typeList[index];\n\n    if ((type.instanceOf  || type.predicate) &&\n        (!type.instanceOf || ((typeof object === 'object') && (object instanceof type.instanceOf))) &&\n        (!type.predicate  || type.predicate(object))) {\n\n      if (explicit) {\n        if (type.multi && type.representName) {\n          state.tag = type.representName(object);\n        } else {\n          state.tag = type.tag;\n        }\n      } else {\n        state.tag = '?';\n      }\n\n      if (type.represent) {\n        style = state.styleMap[type.tag] || type.defaultStyle;\n\n        if (_toString.call(type.represent) === '[object Function]') {\n          _result = type.represent(object, style);\n        } else if (_hasOwnProperty.call(type.represent, style)) {\n          _result = type.represent[style](object, style);\n        } else {\n          throw new exception('!<' + type.tag + '> tag resolver accepts not \"' + style + '\" style');\n        }\n\n        state.dump = _result;\n      }\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// Serializes `object` and writes it to global `result`.\n// Returns true on success, or false on invalid object.\n//\nfunction writeNode(state, level, object, block, compact, iskey, isblockseq) {\n  state.tag = null;\n  state.dump = object;\n\n  if (!detectType(state, object, false)) {\n    detectType(state, object, true);\n  }\n\n  var type = _toString.call(state.dump);\n  var inblock = block;\n  var tagStr;\n\n  if (block) {\n    block = (state.flowLevel < 0 || state.flowLevel > level);\n  }\n\n  var objectOrArray = type === '[object Object]' || type === '[object Array]',\n      duplicateIndex,\n      duplicate;\n\n  if (objectOrArray) {\n    duplicateIndex = state.duplicates.indexOf(object);\n    duplicate = duplicateIndex !== -1;\n  }\n\n  if ((state.tag !== null && state.tag !== '?') || duplicate || (state.indent !== 2 && level > 0)) {\n    compact = false;\n  }\n\n  if (duplicate && state.usedDuplicates[duplicateIndex]) {\n    state.dump = '*ref_' + duplicateIndex;\n  } else {\n    if (objectOrArray && duplicate && !state.usedDuplicates[duplicateIndex]) {\n      state.usedDuplicates[duplicateIndex] = true;\n    }\n    if (type === '[object Object]') {\n      if (block && (Object.keys(state.dump).length !== 0)) {\n        writeBlockMapping(state, level, state.dump, compact);\n        if (duplicate) {\n          state.dump = '&ref_' + duplicateIndex + state.dump;\n        }\n      } else {\n        writeFlowMapping(state, level, state.dump);\n        if (duplicate) {\n          state.dump = '&ref_' + duplicateIndex + ' ' + state.dump;\n        }\n      }\n    } else if (type === '[object Array]') {\n      if (block && (state.dump.length !== 0)) {\n        if (state.noArrayIndent && !isblockseq && level > 0) {\n          writeBlockSequence(state, level - 1, state.dump, compact);\n        } else {\n          writeBlockSequence(state, level, state.dump, compact);\n        }\n        if (duplicate) {\n          state.dump = '&ref_' + duplicateIndex + state.dump;\n        }\n      } else {\n        writeFlowSequence(state, level, state.dump);\n        if (duplicate) {\n          state.dump = '&ref_' + duplicateIndex + ' ' + state.dump;\n        }\n      }\n    } else if (type === '[object String]') {\n      if (state.tag !== '?') {\n        writeScalar(state, state.dump, level, iskey, inblock);\n      }\n    } else if (type === '[object Undefined]') {\n      return false;\n    } else {\n      if (state.skipInvalid) return false;\n      throw new exception('unacceptable kind of an object to dump ' + type);\n    }\n\n    if (state.tag !== null && state.tag !== '?') {\n      // Need to encode all characters except those allowed by the spec:\n      //\n      // [35] ns-dec-digit    ::=  [#x30-#x39] /* 0-9 */\n      // [36] ns-hex-digit    ::=  ns-dec-digit\n      //                         | [#x41-#x46] /* A-F */ | [#x61-#x66] /* a-f */\n      // [37] ns-ascii-letter ::=  [#x41-#x5A] /* A-Z */ | [#x61-#x7A] /* a-z */\n      // [38] ns-word-char    ::=  ns-dec-digit | ns-ascii-letter | \u201C-\u201D\n      // [39] ns-uri-char     ::=  \u201C%\u201D ns-hex-digit ns-hex-digit | ns-word-char | \u201C#\u201D\n      //                         | \u201C;\u201D | \u201C/\u201D | \u201C?\u201D | \u201C:\u201D | \u201C@\u201D | \u201C&\u201D | \u201C=\u201D | \u201C+\u201D | \u201C$\u201D | \u201C,\u201D\n      //                         | \u201C_\u201D | \u201C.\u201D | \u201C!\u201D | \u201C~\u201D | \u201C*\u201D | \u201C'\u201D | \u201C(\u201D | \u201C)\u201D | \u201C[\u201D | \u201C]\u201D\n      //\n      // Also need to encode '!' because it has special meaning (end of tag prefix).\n      //\n      tagStr = encodeURI(\n        state.tag[0] === '!' ? state.tag.slice(1) : state.tag\n      ).replace(/!/g, '%21');\n\n      if (state.tag[0] === '!') {\n        tagStr = '!' + tagStr;\n      } else if (tagStr.slice(0, 18) === 'tag:yaml.org,2002:') {\n        tagStr = '!!' + tagStr.slice(18);\n      } else {\n        tagStr = '!<' + tagStr + '>';\n      }\n\n      state.dump = tagStr + ' ' + state.dump;\n    }\n  }\n\n  return true;\n}\n\nfunction getDuplicateReferences(object, state) {\n  var objects = [],\n      duplicatesIndexes = [],\n      index,\n      length;\n\n  inspectNode(object, objects, duplicatesIndexes);\n\n  for (index = 0, length = duplicatesIndexes.length; index < length; index += 1) {\n    state.duplicates.push(objects[duplicatesIndexes[index]]);\n  }\n  state.usedDuplicates = new Array(length);\n}\n\nfunction inspectNode(object, objects, duplicatesIndexes) {\n  var objectKeyList,\n      index,\n      length;\n\n  if (object !== null && typeof object === 'object') {\n    index = objects.indexOf(object);\n    if (index !== -1) {\n      if (duplicatesIndexes.indexOf(index) === -1) {\n        duplicatesIndexes.push(index);\n      }\n    } else {\n      objects.push(object);\n\n      if (Array.isArray(object)) {\n        for (index = 0, length = object.length; index < length; index += 1) {\n          inspectNode(object[index], objects, duplicatesIndexes);\n        }\n      } else {\n        objectKeyList = Object.keys(object);\n\n        for (index = 0, length = objectKeyList.length; index < length; index += 1) {\n          inspectNode(object[objectKeyList[index]], objects, duplicatesIndexes);\n        }\n      }\n    }\n  }\n}\n\nfunction dump$1(input, options) {\n  options = options || {};\n\n  var state = new State(options);\n\n  if (!state.noRefs) getDuplicateReferences(input, state);\n\n  var value = input;\n\n  if (state.replacer) {\n    value = state.replacer.call({ '': value }, '', value);\n  }\n\n  if (writeNode(state, 0, value, true, true)) return state.dump + '\\n';\n\n  return '';\n}\n\nvar dump_1 = dump$1;\n\nvar dumper = {\n\tdump: dump_1\n};\n\nfunction renamed(from, to) {\n  return function () {\n    throw new Error('Function yaml.' + from + ' is removed in js-yaml 4. ' +\n      'Use yaml.' + to + ' instead, which is now safe by default.');\n  };\n}\n\n\nvar Type                = type;\nvar Schema              = schema;\nvar FAILSAFE_SCHEMA     = failsafe;\nvar JSON_SCHEMA         = json;\nvar CORE_SCHEMA         = core;\nvar DEFAULT_SCHEMA      = _default;\nvar load                = loader.load;\nvar loadAll             = loader.loadAll;\nvar dump                = dumper.dump;\nvar YAMLException       = exception;\n\n// Re-export all types in case user wants to create custom schema\nvar types = {\n  binary:    binary,\n  float:     float,\n  map:       map,\n  null:      _null,\n  pairs:     pairs,\n  set:       set,\n  timestamp: timestamp,\n  bool:      bool,\n  int:       int,\n  merge:     merge,\n  omap:      omap,\n  seq:       seq,\n  str:       str\n};\n\n// Removed functions from JS-YAML 3.0.x\nvar safeLoad            = renamed('safeLoad', 'load');\nvar safeLoadAll         = renamed('safeLoadAll', 'loadAll');\nvar safeDump            = renamed('safeDump', 'dump');\n\nvar jsYaml = {\n\tType: Type,\n\tSchema: Schema,\n\tFAILSAFE_SCHEMA: FAILSAFE_SCHEMA,\n\tJSON_SCHEMA: JSON_SCHEMA,\n\tCORE_SCHEMA: CORE_SCHEMA,\n\tDEFAULT_SCHEMA: DEFAULT_SCHEMA,\n\tload: load,\n\tloadAll: loadAll,\n\tdump: dump,\n\tYAMLException: YAMLException,\n\ttypes: types,\n\tsafeLoad: safeLoad,\n\tsafeLoadAll: safeLoadAll,\n\tsafeDump: safeDump\n};\n\nexport default jsYaml;\nexport { CORE_SCHEMA, DEFAULT_SCHEMA, FAILSAFE_SCHEMA, JSON_SCHEMA, Schema, Type, YAMLException, dump, load, loadAll, safeDump, safeLoad, safeLoadAll, types };\n"],
  "mappings": "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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA6XpB,KAAK,WAAW,YA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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": ["isWindow", "thing", "Window", "realWindow", "win", "init", "window", "el", "document", "createTextNode", "ownerDocument", "wrap", "getWindow", "node", "defaultView", "object", "_typeof", "func", "is", "docFrag", "nodeType", "number", "bool", "string", "element", "_window", "test", "Element", "nodeName", "plainObject", "constructor", "toString", "array", "length", "splice", "beforeMove", "_ref", "interaction", "prepared", "name", "axis", "coords", "cur", "page", "y", "start", "client", "velocity", "x", "move", "_ref2", "iEvent", "opposite", "delta", "drag", "id", "install", "scope", "actions", "Interactable", "defaults", "prototype", "draggable", "map", "methodDict", "listeners", "arg", "interactable", "buttons", "dragOptions", "options", "enabled", "pointerIsDown", "pointerType", "mouseButtons", "action", "lockAxis", "startAxis", "this", "setPerAction", "setOnEvents", "getCursor", "filterEventType", "type", "search", "drag$1", "domObjects", "DocumentFragment", "blank", "SVGElement", "SVGSVGElement", "SVGElementInstance", "HTMLElement", "Event", "Touch", "PointerEvent", "MSPointerEvent", "domObjects$1", "browser", "navigator", "supportsTouch", "DocumentTouch", "supportsPointerEvent", "pointerEnabled", "isIOS", "platform", "isIOS7", "appVersion", "isIe9", "userAgent", "isOperaMobile", "appName", "prefixedMatchesSelector", "pEventTypes", "up", "down", "over", "out", "cancel", "wheelEvent", "browser$1", "nodeContains", "parent", "child", "contains", "parentNode", "closest", "selector", "matchesSelector", "host", "replace", "getParent", "getNodeParents", "limit", "parentParent", "parents", "unshift", "matchesUpTo", "getActualElement", "correspondingUseElement", "getElementClientRect", "clientRect", "getBoundingClientRect", "getClientRects", "left", "right", "top", "bottom", "width", "height", "getElementRect", "relevantWindow", "scroll", "scrollX", "documentElement", "scrollLeft", "scrollY", "scrollTop", "getPath", "path", "push", "trySelector", "value", "querySelector", "extend", "dest", "source", "prop", "getStringOptionResult", "target", "getRect", "resolveRectLike", "functionArgs", "returnValue", "apply", "rectToXY", "rect", "tlbrToXywh", "addEdges", "edges", "getOriginXY", "actionName", "actionOptions", "origin", "normalize", "filter", "arguments", "_typeOrPrefix", "result", "split", "forEach", "t", "_i2", "_listeners2", "l", "prefix", "p", "concat", "trim", "hypot", "Math", "sqrt", "VENDOR_PREFIXES", "pointerExtend", "__set", "_loop", "some", "indexOf", "Object", "defineProperty", "get", "set", "configurable", "copyCoords", "src", "timeStamp", "setZeroCoords", "targetObj", "isNativePointer", "pointer", "dom", "getXY", "xy", "getPageXY", "getPointerId", "pointerId", "identifier", "setCoords", "pointers", "pointerAverage", "getTouchPair", "event", "touches", "changedTouches", "average", "pageX", "pageY", "clientX", "clientY", "screenX", "screenY", "touchBBox", "minX", "min", "minY", "maxX", "max", "maxY", "touchDistance", "deltaSource", "sourceX", "sourceY", "dx", "dy", "touchAngle", "atan2", "PI", "getPointerType", "undefined", "getEventTargets", "composedPath", "domUtils", "currentTarget", "BaseEvent", "_classCallCheck", "immediatePropagationStopped", "propagationStopped", "_interaction", "_createClass", "key", "_proxy", "merge", "item", "from", "findIndex", "i", "find", "DropEvent", "_BaseEvent", "_inherits", "_super", "_createSuper", "dropState", "dragEvent", "_this", "call", "dropzone", "relatedTarget", "prev", "_this2", "rejected", "events", "enter", "stopImmediatePropagation", "activeDrops", "index", "arr", "deactivateEvent", "fire", "fireActivationEvents", "_i6", "_activeDrops$slice2", "slice", "_activeDrops$slice2$_", "getActiveDrops", "dragElement", "draggableElement", "drops", "_interactables$list2", "interactables", "list", "drop", "accept", "_i4", "_dropzone$getAllEleme2", "getAllElements", "dropzoneElement", "_i8", "activeDrop", "getDrop", "pointerEvent", "validDrops", "_i10", "_dropState$activeDrop2", "_dropState$activeDrop3", "isValid", "dropCheck", "dropIndex", "elements", "deepestNodeIndex", "higherNode", "lowerNode", "deepestNodeParents", "currentNode", "deepestNode", "currentNodeParent", "deepestNodeParent", "ancestryStart", "ownerSVGElement", "currentNodeParents", "commonIndex", "lastChild", "previousSibling", "parseInt", "getComputedStyle", "zIndex", "getDropEvents", "_pointerEvent", "dropEvents", "leave", "activate", "deactivate", "dragLeave", "prevDropzone", "dragEnter", "fireDropEvents", "onEventCreated", "_ref3", "dynamicDrop", "dropResult", "interact", "interactStatic", "usePlugin", "normalized", "normalizeListeners", "corrected", "keys", "reduce", "acc", "prevListeners", "off", "on", "ondrop", "ondropactivate", "ondropdeactivate", "ondragenter", "ondragleave", "ondropmove", "overlap", "checker", "dropElement", "dropped", "dropOverlap", "pointerUtils", "horizontal", "vertical", "dragRect", "cx", "cy", "newValue", "phaselessTypes", "dragenter", "dragleave", "dropactivate", "dropdeactivate", "dropmove", "_ref4", "_ref5", "_ref6", "_ref7", "drop$1", "updateGestureProps", "phase", "starting", "ending", "distance", "box", "scale", "ds", "angle", "da", "gesture", "startDistance", "startAngle", "prevEvent", "Infinity", "isNaN", "before", "gesturable", "gestureOptions", "gesture$1", "checkResizeEdge", "interactableElement", "margin", "abs", "edge", "updateEventAxes", "resizeAxes", "resizeEvent", "resize", "square", "axes", "request", "cursors", "topleft", "bottomright", "topright", "bottomleft", "defaultMargin", "resizable", "preserveAspectRatio", "_rects", "previous", "deltaRect", "invert", "invertible", "current", "_interaction$_rects", "startRect", "swap", "resizeOptions", "resizeEdges", "_latestPointer", "eventTarget", "NaN", "cursorKey", "_ref8", "resize$1", "lastTime", "raf", "callback", "token", "global", "requestAnimationFrame", "cancelAnimationFrame", "vendors", "vendor", "bind", "currTime", "Date", "now", "timeToCall", "setTimeout", "clearTimeout", "autoScroll", "container", "speed", "isScrolling", "prevTime", "stop", "getContainer", "dt", "s", "scrollBy", "prevScroll", "getScroll", "curScroll", "check", "_options$actionName$a", "onInteractionMove", "interacting", "simulation", "innerWidth", "innerHeight", "body", "autoScrollPlugin", "autoscroll", "perAction", "autoScroll$1", "warnOnce", "method", "message", "warned", "console", "warn", "copyAction", "styleCursor", "actionChecker", "InteractableMethods", "getAction", "button", "ignoreFrom", "_backCompatOption", "allowFrom", "validateAction", "testIgnoreAllow", "withinInteractionLimit", "validateMatches", "matches", "matchElements", "len", "match", "matchElement", "matchAction", "getActionInfo", "pushMatches", "forEachMatch", "actionInfo", "manualStart", "prepare", "setInteractionCursor", "maxActions", "maxPerElement", "autoStartMax", "autoStart", "maxInteractions", "activeInteractions", "interactableCount", "elementCount", "_scope$interactions$l2", "interactions", "otherAction", "setCursor", "cursor", "prevCursorElement", "cursorElement", "style", "cursorChecker", "_interacting", "base", "pointerWasMoved", "autoStart$2", "dragAxis", "absX", "absY", "targetOptions", "currentAxis", "getDraggable", "downPointer", "downEvent", "thisAxis", "getHoldDuration", "hold", "delay", "basePlugin", "autoStartHoldTimer", "duplicate", "hold$1", "preventDefault", "onInteractionEvent", "checkAndPreventDefault", "interactablePreventDefault", "setting", "supportsPassive", "doc", "docOptions", "getDocOptions", "passive", "docEvents", "listener", "eventType", "isNonNativeEvent", "substr", "phases", "clone", "Modification", "states", "startOffset", "startDelta", "endResult", "startEdges", "createResult", "pageCoords", "modifierList", "actionModifiers", "modifiers", "methods", "_methods", "m", "prepareStates", "fillArg", "preEnd", "startAll", "setAll", "_this$states2", "state", "skipModifiers", "unmodifiedRect", "unmodifiedEdges", "newResult", "_state$methods", "lastModifierCoords", "shouldDo", "rectUtils", "eventProps", "rectDelta", "prevCoords", "prevRect", "rectChanged", "changed", "curCoords", "startCoords", "curDelta", "_ref3$_i", "coordsSet", "modifiedCoords", "adjustment", "applyToInteraction", "doPreend", "endPosition", "beforeEnd", "modifierArg", "_this$states4", "_modifierList$index", "_ref4$interaction", "modification", "_modification$result", "_i12", "_ref6$_i", "requireEndOnly", "endOnly", "setStart", "other", "makeModifier", "module", "modifier", "_options", "enable", "disable", "_defaults", "addEventModifiers", "modifiersBase", "ret", "setAndApply", "restoreInteractionCoords", "InteractEvent", "ctrlKey", "shiftKey", "altKey", "metaKey", "x0", "y0", "t0", "duration", "clientX0", "clientY0", "swipe", "_assertThisInitialized", "downTime", "getSwipe", "velocityY", "velocityX", "defineProperties", "PointerInfo", "downTarget", "_ProxyValues", "_ProxyMethods", "idCounter", "Interaction", "scopeFire", "_scopeFire", "_ending", "_stopped", "doMove", "signalArg", "_id", "that", "_loop2", "_key", "pointerIndex", "updatePointer", "pointerInfo", "_doPhase", "duplicateMove", "pointerMoveTolerance", "getPointerIndex", "curEventTarget", "end", "removePointer", "endPhaseResult", "curPointer", "_now", "_updateLatestPointer", "_this$interactable", "_createPreparedEvent", "_fireEvent", "beforeAction", "applyPending", "offset", "pending", "addToCoords", "offsetBy", "total", "offset$1", "InertiaState", "active", "isModified", "smoothEnd", "allowResume", "modifierCount", "v0", "te", "targetOffset", "modifiedOffset", "currentOffset", "lambda_v0", "one_ve_v0", "timeout", "getOptions", "velocityClient", "pointerSpeed", "copyFrom", "minSpeed", "endSpeed", "startInertia", "startSmoothEnd", "startVelocity", "lambda", "resistance", "inertiaDur", "log", "onNextFrame", "inertiaTick", "smoothEndTick", "tickFn", "_this3", "startX", "startY", "cpX", "cpY", "endX", "endY", "position", "_this4", "newOffset", "progress", "exp", "_getQBezierValue", "_this5", "smoothEndDuration", "easeOutQuad", "inertia", "inertiastart", "resume", "p1", "p2", "p3", "iT", "b", "c", "d", "inertia$1", "fireUntilImmediateStopped", "Eventable", "types", "eventList", "_listeners$type2", "subListener", "_element", "FakeEvent", "originalEvent", "pExtend", "stopPropagation", "param", "capture", "optionsMatch", "a", "_scope$document", "targets", "delegatedEvents", "documents", "eventsMethods", "add", "remove", "addDelegate", "context", "optionalArg", "_i3", "delegateListener", "delegateUseCapture", "delegates", "delegate", "removeDelegate", "matchFound", "entry", "supportsOptions", "addEventListener", "removeEventListener", "targetIndex", "typeIsEmpty", "typeListeners", "hasOwnProperty", "fakeEvent", "_i5", "createElement", "finder", "methodOrder", "details", "_finder$methodOrder2", "simulationResume", "mouseOrPen", "firstNonActive", "_scope$interactions$l4", "hasPointerId", "_scope$interactions$l6", "hasPointer", "_scope$interactions$l8", "idle", "_scope$interactions$l10", "finder$1", "methodNames", "doOnInteractions", "_pointerUtils$getEven", "prevTouchTime", "_event$changedTouches2", "changedTouch", "searchDetails", "getInteraction", "invalidPointer", "_matches$_i", "new", "onDocSignal", "eventMethodName", "eventMethod", "eventOptions", "_i14", "_docEvents$_i", "releasePointersOnRemovedEls", "_interaction$pointers2", "pointerDown", "pointerMove", "pointerUp", "documentBlur", "_InteractionBase", "_class", "InteractionBase", "destroy", "interactions$1", "OnOffMethod", "defaultContext", "scopeEvents", "_actions", "_context", "_win", "_doc", "_scopeEvents", "onstart", "onmove", "onend", "oninertiastart", "_this$_actions$map$ac", "actionFilter", "_onOff", "Off", "On", "optionName_", "optionName", "optionValue", "updatePerActionListeners", "Array", "querySelectorAll", "targetNode", "testIgnore", "testAllow", "typeArg", "listenerArg", "_listeners$_type2", "actionName_", "methodName", "rectChecker", "delegated", "_delegated$i", "InteractableSet", "selectorMap", "addListeners", "interactablesOnTarget", "addDocument", "isSelector", "inContext", "_this$list2", "Scope", "floor", "random", "isInitialized", "listenerMaps", "getExisting", "globalEvents", "getPointerAverage", "getTouchBBox", "getTouchDistance", "getTouchAngle", "version", "process", "use", "plugin", "isSet", "_type2", "debug", "_this$scope$interacti2", "removeDocument", "_plugins", "onWindowUnload", "_InteractableBase", "_class2", "_get", "_getPrototypeOf", "InteractableBase", "_this$listenerMaps2", "pluginIsInstalled", "pluginIdRoot", "otherId", "getDocIndex", "docIndex", "interact$1", "_global", "globalThis", "fn", "grid", "coordFields", "xField", "yField", "gridFunc", "range", "_grid$limits", "limits", "_grid$offset", "_coordFields$_i", "gridx", "round", "gridy", "snappersPlugin", "snappers", "allSnappers", "createSnapGrid", "aspectRatio", "_state$options", "ratio", "_state$options2", "equalDelta", "linkedEdges", "xIsPrimaryAxis", "sign", "edgeSign", "subModification", "_objectSpread", "initialCoords", "aspectMethod", "setEqualDelta", "setRatio", "correctedRect", "newHeight", "newWidth", "aspectRatio$1", "noop", "rubberband", "getRestrictionRect", "restrict", "elementRect", "restriction", "widthDiff", "heightDiff", "restrict$1", "noInner", "noOuter", "fixRect", "restrictEdges", "inner", "outer", "restrictEdges$1", "_", "restrictRect$1", "noMin", "noMax", "restrictSize$1", "minSize", "maxSize", "snap", "snapOffset", "offsetWithOrigin", "optionsOrigin", "offsetRect", "relativePoints", "offsets", "relativePoint", "relativeX", "relativeY", "snapTarget", "inRange", "snap$1", "snapSize", "targetFields", "relative", "_state$targetFields2", "_state$targetFields2$", "snapSize$1", "all", "restrictRect", "restrictSize", "snapEdges", "spring", "avoid", "transform", "_all", "modifiers$1", "interval", "tapTime", "double", "prevTap", "originX", "originY", "pointerEvents", "clearHold", "timer", "minDuration", "_signalArg$targets2", "holdDuration", "eventable", "collectEventTargets", "tap", "doubletap", "_arg$targets", "props", "_subtractOrigin", "_addOrigin", "_interaction$pointers", "Nn", "Bn", "endHoldRepeat", "holdIntervalHandle", "clearInterval", "holdRepeat", "holdRepeatInterval", "holdrepeat", "enderTypes", "count", "holdRepeat$1", "__backCompatOption", "interactableTargets", "reflow", "Promise", "promises", "reflowPromise", "runningInteraction", "_reflowPromise", "resolve", "_reflowResolve", "xywh", "then", "reflow$1", "default", "exports", "_unused", "import_interactjs", "isNothing", "subject", "isObject", "toArray", "sequence", "extend", "target", "source", "index", "length", "key", "sourceKeys", "repeat", "string", "count", "result", "cycle", "isNegativeZero", "number", "isNothing_1", "isObject_1", "toArray_1", "repeat_1", "isNegativeZero_1", "extend_1", "common", "formatError", "exception", "compact", "where", "message", "YAMLException$1", "reason", "mark", "getLine", "buffer", "lineStart", "lineEnd", "position", "maxLineLength", "head", "tail", "maxHalfLength", "padStart", "max", "makeSnippet", "options", "re", "lineStarts", "lineEnds", "match", "foundLineNo", "i", "line", "lineNoLength", "snippet", "TYPE_CONSTRUCTOR_OPTIONS", "YAML_NODE_KINDS", "compileStyleAliases", "map", "style", "alias", "Type$1", "tag", "name", "data", "type", "compileList", "schema", "currentType", "newIndex", "previousType", "previousIndex", "compileMap", "collectType", "Schema$1", "definition", "implicit", "explicit", "type$1", "str", "seq", "failsafe", "resolveYamlNull", "constructYamlNull", "isNull", "object", "_null", "resolveYamlBoolean", "constructYamlBoolean", "isBoolean", "bool", "isHexCode", "c", "isOctCode", "isDecCode", "resolveYamlInteger", "hasDigits", "ch", "constructYamlInteger", "value", "sign", "isInteger", "int", "obj", "YAML_FLOAT_PATTERN", "resolveYamlFloat", "constructYamlFloat", "SCIENTIFIC_WITHOUT_DOT", "representYamlFloat", "res", "isFloat", "float", "json", "core", "YAML_DATE_REGEXP", "YAML_TIMESTAMP_REGEXP", "resolveYamlTimestamp", "constructYamlTimestamp", "year", "month", "day", "hour", "minute", "second", "fraction", "delta", "tz_hour", "tz_minute", "date", "representYamlTimestamp", "timestamp", "resolveYamlMerge", "merge", "BASE64_MAP", "resolveYamlBinary", "code", "idx", "bitlen", "constructYamlBinary", "tailbits", "input", "bits", "representYamlBinary", "isBinary", "binary", "_hasOwnProperty$3", "_toString$2", "resolveYamlOmap", "objectKeys", "pair", "pairKey", "pairHasKey", "constructYamlOmap", "omap", "_toString$1", "resolveYamlPairs", "keys", "constructYamlPairs", "pairs", "_hasOwnProperty$2", "resolveYamlSet", "constructYamlSet", "set", "_default", "_hasOwnProperty$1", "CONTEXT_FLOW_IN", "CONTEXT_FLOW_OUT", "CONTEXT_BLOCK_IN", "CONTEXT_BLOCK_OUT", "CHOMPING_CLIP", "CHOMPING_STRIP", "CHOMPING_KEEP", "PATTERN_NON_PRINTABLE", "PATTERN_NON_ASCII_LINE_BREAKS", "PATTERN_FLOW_INDICATORS", "PATTERN_TAG_HANDLE", "PATTERN_TAG_URI", "_class", "is_EOL", "is_WHITE_SPACE", "is_WS_OR_EOL", "is_FLOW_INDICATOR", "fromHexCode", "lc", "escapedHexLen", "fromDecimalCode", "simpleEscapeSequence", "charFromCodepoint", "simpleEscapeCheck", "simpleEscapeMap", "State$1", "generateError", "state", "throwError", "throwWarning", "directiveHandlers", "args", "major", "minor", "handle", "prefix", "captureSegment", "start", "end", "checkJson", "_position", "_length", "_character", "_result", "mergeMappings", "destination", "overridableKeys", "quantity", "storeMappingPair", "keyTag", "keyNode", "valueNode", "startLine", "startLineStart", "startPos", "readLineBreak", "skipSeparationSpace", "allowComments", "checkIndent", "lineBreaks", "testDocumentSeparator", "writeFoldedLines", "readPlainScalar", "nodeIndent", "withinFlowCollection", "preceding", "following", "captureStart", "captureEnd", "hasPendingContent", "_line", "_lineStart", "_lineIndent", "_kind", "readSingleQuotedScalar", "readDoubleQuotedScalar", "hexLength", "hexResult", "tmp", "readFlowCollection", "readNext", "_pos", "_tag", "_anchor", "terminator", "isPair", "isExplicitPair", "isMapping", "composeNode", "readBlockScalar", "folding", "chomping", "didReadContent", "detectedIndent", "textIndent", "emptyLines", "atMoreIndented", "readBlockSequence", "detected", "readBlockMapping", "flowIndent", "allowCompact", "_keyLine", "_keyLineStart", "_keyPos", "atExplicitKey", "readTagProperty", "isVerbatim", "isNamed", "tagHandle", "tagName", "readAnchorProperty", "readAlias", "parentIndent", "nodeContext", "allowToSeek", "allowBlockStyles", "allowBlockScalars", "allowBlockCollections", "indentStatus", "atNewLine", "hasContent", "typeIndex", "typeQuantity", "typeList", "blockIndent", "readDocument", "documentStart", "directiveName", "directiveArgs", "hasDirectives", "loadDocuments", "nullpos", "loadAll$1", "iterator", "documents", "load$1", "loadAll_1", "load_1", "loader", "_toString", "_hasOwnProperty", "CHAR_BOM", "CHAR_TAB", "CHAR_LINE_FEED", "CHAR_CARRIAGE_RETURN", "CHAR_SPACE", "CHAR_EXCLAMATION", "CHAR_DOUBLE_QUOTE", "CHAR_SHARP", "CHAR_PERCENT", "CHAR_AMPERSAND", "CHAR_SINGLE_QUOTE", "CHAR_ASTERISK", "CHAR_COMMA", "CHAR_MINUS", "CHAR_COLON", "CHAR_EQUALS", "CHAR_GREATER_THAN", "CHAR_QUESTION", "CHAR_COMMERCIAL_AT", "CHAR_LEFT_SQUARE_BRACKET", "CHAR_RIGHT_SQUARE_BRACKET", "CHAR_GRAVE_ACCENT", "CHAR_LEFT_CURLY_BRACKET", "CHAR_VERTICAL_LINE", "CHAR_RIGHT_CURLY_BRACKET", "ESCAPE_SEQUENCES", "DEPRECATED_BOOLEANS_SYNTAX", "DEPRECATED_BASE60_SYNTAX", "compileStyleMap", "encodeHex", "character", "QUOTING_TYPE_SINGLE", "QUOTING_TYPE_DOUBLE", "State", "indentString", "spaces", "ind", "next", "generateNextLine", "level", "testImplicitResolving", "isWhitespace", "isPrintable", "isNsCharOrWhitespace", "isPlainSafe", "prev", "inblock", "cIsNsCharOrWhitespace", "cIsNsChar", "isPlainSafeFirst", "isPlainSafeLast", "codePointAt", "pos", "first", "needIndentIndicator", "leadingSpaceRe", "STYLE_PLAIN", "STYLE_SINGLE", "STYLE_LITERAL", "STYLE_FOLDED", "STYLE_DOUBLE", "chooseScalarStyle", "singleLineOnly", "indentPerLevel", "lineWidth", "testAmbiguousType", "quotingType", "forceQuotes", "char", "prevChar", "hasLineBreak", "hasFoldableLine", "shouldTrackWidth", "previousLineBreak", "plain", "writeScalar", "iskey", "indent", "testAmbiguity", "blockHeader", "dropEndingNewline", "foldString", "escapeString", "indentIndicator", "clip", "keep", "chomp", "width", "lineRe", "nextLF", "foldLine", "prevMoreIndented", "moreIndented", "breakRe", "curr", "escapeSeq", "writeFlowSequence", "writeNode", "writeBlockSequence", "writeFlowMapping", "objectKeyList", "objectKey", "objectValue", "pairBuffer", "writeBlockMapping", "explicitPair", "detectType", "block", "isblockseq", "tagStr", "objectOrArray", "duplicateIndex", "duplicate", "getDuplicateReferences", "objects", "duplicatesIndexes", "inspectNode", "dump$1", "dump_1", "dumper", "renamed", "from", "to", "Type", "Schema", "FAILSAFE_SCHEMA", "JSON_SCHEMA", "CORE_SCHEMA", "DEFAULT_SCHEMA", "load", "loadAll", "dump", "YAMLException", "types", "safeLoad", "safeLoadAll", "safeDump", "jsYaml", "js_yaml_default", "interact", "js_yaml_default", "VERSION", "LOG", "m", "a", "raf", "r", "idle", "DragAndDropCard", "_DragAndDropCard", "__publicField", "_a", "bar", "btn", "idx", "selected", "e", "list", "focusedIndex", "b", "activeIndex", "target", "first", "id", "url_path", "ll", "hit", "c", "viewIndex", "cardIndex", "parentPath", "view", "updated", "_b", "partial", "merged", "llConfig", "predicate", "views", "vi", "node", "cards", "ci", "sub", "container", "value", "s", "style", "show", "_c", "_d", "_e", "_f", "el", "host", "prev", "cc", "showAll", "ua", "bg", "cfg", "cont", "url", "repeat", "opacity", "size", "position", "attachment", "filter", "_g", "_h", "mode", "src", "p", "resolve", "reject", "fn", "root", "d", "originalGetById", "originalQuerySelector", "safe", "sel", "loadScript", "DEFAULTS", "allowPointer", "conf", "finalConf", "err", "inst", "input", "ready", "wrap", "videoId", "start", "end", "mute", "loop", "params", "iframe", "posStr", "ax", "ay", "frame", "now", "contEl", "natW", "natH", "cw", "ch", "scale", "fixedAttach", "vw", "vh", "videoAR", "contAR", "w", "h", "left", "top", "visList", "hass", "evalCond", "cond", "type", "children", "child", "entity", "stateObj", "st", "v", "val", "mq", "users", "uid", "wraps", "currentTabId", "shouldShow", "_i", "_j", "gs", "step", "dx", "dy", "_k", "_l", "t", "dup", "w2", "x", "y", "nextZVal", "tid", "liveSnap", "fixed", "box", "proposed", "rawX", "rawY", "nx", "ny", "sx", "sy", "ref", "width", "rect", "rect2", "editable", "tag", "ev", "path", "n", "gBuild", "gStatus", "pill", "dot", "txt", "gSys", "rowL", "rowM", "rowR", "entries", "action", "ctx", "done", "fail", "outer", "selector", "results", "visit", "treeWalker", "sr", "inp", "editor", "text", "helper", "config", "base", "updateButtons", "dirty", "isDirty", "applyBtn", "fire", "newConfig", "optsToSave", "opts", "toggleSizeControls", "revertBtn", "sizeModeEl", "presetSelect", "groups", "acc", "group", "items", "optgroup", "preset", "item", "header", "selBgMode", "inpBgImg", "selBgRepeat", "selBgSize", "selBgPosition", "selBgAttachment", "rngBgOpacity", "inpParticlesUrl", "chkParticlesPtr", "inpYtUrl", "inpYtStart", "inpYtEnd", "chkYtMute", "chkYtLoop", "selYtSize", "selYtPosition", "selYtAttachment", "rngYtOpacity", "clamp01", "pctTo01", "pick", "o", "srcVal", "current", "baseline", "on", "initial", "ww", "hh", "nw", "nh", "nx2", "ny2", "ha", "shadow", "drawer", "right", "sz", "kind", "msg", "extra", "line", "_m", "_n", "_o", "_p", "_q", "_r", "_s", "_t", "_u", "_v", "_w", "_x", "_y", "_z", "_A", "prevKey", "ssDelay", "lastT", "keyChanged", "scheduled", "apply", "inner", "optsWhenScaling", "optsWhenStatic", "observeAttrs", "mo", "io", "force", "__rebuildAfter", "saved", "local", "yamlCfg", "storage_key", "optsNoKey", "overrideKeys", "cfgOpts", "k", "builtAny", "cardEl", "tabId", "valid", "tabs", "activeBtn", "reduceMotion", "totalAnimationTime", "animationIntensity", "duration", "maxDelay", "cs", "offsetY", "fromT", "toT", "delay", "motionEase", "wrapper", "entryTabId", "chip", "opt", "cur", "entering", "wasOff", "cfgPin", "pin", "entered", "toolbar", "setDisplay", "off", "showButtons", "hideButtons", "handle", "ox", "oy", "HOLD_MS", "DRIFT_PX", "isElem", "containsSafe", "within", "isOverCard", "makeRing", "fg", "circ", "timer", "ring", "startX", "startY", "activePointerId", "clearTimer", "onPointerDown", "toState", "onPointerMove", "onPointerUpOrCancel", "onContextMenu", "onDblClick", "empty", "toggle", "reason", "clientX", "clientY", "localX", "localY", "veil", "live", "mods", "autoscaled", "gridSnap", "lead", "srL", "curLeadX", "curLeadY", "dxLead", "dyLead", "snapX", "snapY", "pr", "endRects", "curW", "curH", "height", "wTry", "hTry", "nextW", "nextH", "prevW", "prevH", "wSnap", "hSnap", "nextVal", "delHandle", "act", "targets", "za", "zb", "minZ", "z", "baseMin", "newCfg", "oldEl", "newEl", "shield", "hero", "heroImgUrl", "img", "title", "card", "phW", "phH", "rootRect", "contRect", "hostCenterX", "hostCenterY", "centerX", "centerY", "delta", "next", "max", "maxX", "maxY", "wEl", "bottom", "gw", "tick", "last", "wantW", "wantH", "sameW", "sameH", "sameT", "pw", "wantOuterW", "wantOuterH", "availableW", "vb", "availW", "availH", "viewportH", "remaining", "cr", "targetW", "targetH", "topOffset", "vb2", "vpH", "availViewH", "tb", "proposedRects", "gridSize", "selectedSet", "allCards", "isFixed", "orig", "snX", "snY", "selectedRects", "finalPos", "cardSizes", "signX", "signY", "horizontal", "other", "candidateX", "candidateY", "ow", "oh", "overlaps", "guard", "candidateRect", "collision", "fp", "pos", "wpx", "hpx", "x0", "y0", "eps", "ignoreSet", "others", "otherRects", "or", "raw", "parsed", "helpers", "getCardClass", "baseCfg", "stubCfg", "CardClass", "formInfo", "formEl", "entry", "candidates", "tmp", "it", "S", "any", "fireChange", "clean", "entRow", "entLabel", "entInput", "newVal", "updateAttributeOptions", "grid", "makeField", "labelText", "inputEl", "lab", "nameInput", "iconInput", "attrInput", "attrs", "eid", "FRIENDLY_ATTR_NAMES", "makeLabel", "key", "part", "name", "emptyItem", "emptyOpt", "unitInput", "themeInput", "colorInput", "colWrap", "colorLabel", "cfg2", "themeNames", "prevVal", "sc", "out", "f", "domains", "all", "map", "set", "l", "hostEl", "initialCfg", "onValidChange", "onInvalidChange", "dump", "parse", "initialText", "ed", "programmatic", "cm", "ta", "rowHeight", "renderRow", "spacer", "mount", "render", "scrollTop", "i", "newItems", "onCommit", "close", "modal", "addTop", "addBottom", "cancelTop", "cancelBot", "search", "cardHost", "editorHost", "editorSpin", "quickFill", "yamlHost", "yamlErr", "yamlSec", "tabVisual", "tabYaml", "tabVis", "visSec", "visHost", "previewSpin", "enableCommit", "setError", "faves", "recent", "catalog", "favSection", "recSection", "allItems", "customItems", "quickFillSecDiv", "optionsHd", "selInfo", "favBtn", "updateFavStar", "currentType", "icon", "updateHeader", "nm", "titleSpan", "renderLeft", "__activeTab", "showTab", "wantYaml", "wantVis", "wantVisual", "visualEditor", "mountVisualEditor", "currentConfig", "buildVisUI", "filteredCatalog", "section", "sec", "cat", "div", "highlight", "selectType", "yamlEditorApi", "pickSeq", "__previewTimer", "__lastPreviewCfgJSON", "buildQuickFill", "fieldWrap", "addEntityItem", "arr", "keyForMulti", "mountPreview", "row", "label", "pool", "paint", "filtered", "q", "dsWrap", "ds", "iconLead", "dl", "inpWrap", "numIcon", "selWrap", "selIcon", "tIcon", "visExpansionStates", "buildVisUIOld", "reRender", "updateConfig", "headerDiv", "leftWrap", "iconName", "labelSpan", "del", "index", "typeRow", "typeLabel", "typeSel", "fields", "addField", "lbl", "entPicker", "opSel", "optEq", "optNeq", "stInput", "aboveField", "belowField", "screenSel", "presets", "customInp", "userPicker", "addBtn", "__cachedUserList", "fetchUsers", "resp", "fallbackLists", "u", "instr", "renderList", "renderCondition", "addWrap", "existing", "menu", "newCond", "ic", "la", "parentList", "expanded", "rm", "tn", "ent", "op", "above", "below", "rowcb", "cb", "sp", "up", "loading", "selUsers", "uList", "uname", "commit", "childContainer", "cfgJSON", "seq", "temp", "wantType", "byDomain", "better", "onChange", "nextType", "mountYaml", "shaped", "typeChanged", "getStub", "visReady", "finalCfg", "__searchTimer", "stub", "firstSensor", "defaultEntity", "areas", "occupied", "xStart", "yStart", "xEnd", "yEnd", "xi", "yi", "cardConfig", "wrappers", "minX", "minY", "clip", "shift", "baseX", "baseY", "marquee", "active", "toLocal", "updateSel", "rRect", "wr", "down", "move", "sk", "usingHost", "logsToHtml", "rows", "refreshLogs", "logArea", "logsToHtmlLocal", "cardCfg", "payload", "blob", "file", "json", "back", "existingModal", "chkAuto", "inpGrid", "chkAnim", "chkHdr", "chkBar", "chkSnap", "chkASave", "inpDeb", "selSize", "selOrient", "chkOverlap", "inpEditPin", "inpCBg", "inpCardBg", "chkShadow", "outBgOpacity", "chkDebug", "chkScreenSaver", "rngScreenDelay", "outScreenDelay", "secImg", "secParticles", "secYoutube", "chkParticlesPointer", "outYtOpacity", "bgCfg", "bgMode", "pCfg", "yCfg", "ytStr", "ypct", "showBgSections", "secAutoResize", "updateAutoResizeVisibility", "bgObj", "pct", "ms", "mins", "yamlPin", "uiPin", "gridSlider", "gridOut", "gridDemo", "gridMeta", "gridInput", "renderMeta", "cell", "cols", "syncGrid", "ro", "sizeSel", "inpW", "inpH", "SWATCHES", "buildSwatches", "containerSel", "targetInputSel", "targetPickerSel", "picker", "pickSel", "textSel", "hex", "fileInput", "urlInput", "thumb", "updateThumb", "isIOS", "objectUrl", "canvas", "dataUrl", "background_image", "rest", "evt", "closeModal", "onKey", "extrasDiv", "updateSizeExtras", "modeVal", "wrapW", "spanW", "wrapH", "spanH", "span", "select", "readTabs", "writeTabs", "defaultId", "defaultTabId", "tabsListEl", "renderTabs", "def", "radio", "nameWrap", "preview", "iconWrap", "modes", "mkMode", "actions", "delBtn", "nextTabs", "nextDefault", "clearBtn", "GRADIENTS", "buildGradients", "g", "newSize", "newAuto", "newGrid", "newAnim", "newHideHdr", "newHideBar", "newSnap", "newASave", "newDeb", "newOrient", "newOverlap", "newCBg", "newCardBg", "newBgImg", "newDebug", "newEditPin", "newBgMode", "newParticlesUrl", "newParticlesPtr", "newYtUrl", "newYtStart", "newYtEnd", "newYtMute", "newYtLoop", "newYtSize", "newYtPosition", "newYtOpacity", "newYtAttachment", "newShadow", "newScreenSaverEnabled", "newScreenSaverDelayMin", "newScreenSaverDelayMs", "snapChanged", "sizeChanged", "orientChanged", "wVal", "hVal", "presetVal", "prevBg", "rep", "att", "background_particles", "background_youtube", "cfgErr", "obj", "keys", "recalc", "updatedCfg", "modeLower", "HARD_REPLACE", "ADOPT_IMPORTED_STORAGE_KEY", "KNOWN_OPT_KEYS", "_B", "_C", "_D", "_E", "_F", "_G", "_H", "_I", "_J", "_K", "_L", "_M", "_N", "_O", "_P", "_Q", "_R", "_S", "_T", "_U", "_V", "_W", "_X", "prevStorageKey", "hasOptionsTabs", "hasCardTabIds", "compatTabs", "compatTabsPosition", "compatDefaultTab", "compatHideSingle", "imported", "targetKey", "importedOptions", "persistOptions", "result", "yamlOk", "hop", "rHost", "seen", "hits", "push", "viewIdx", "vv", "patchAllInCurrentViewIfNoKey", "curView", "newKey", "inCur", "basePatch", "seg", "existingKey", "shouldRename", "silent", "t0", "data", "res", "newOptions", "baseId", "desiredId", "overlay", "handler", "clockEl", "dateEl", "calEl", "locale", "year", "month", "monthName", "dayNames", "firstDay", "daysInMonth", "prevMonthDays", "cells", "isToday", "nextDay", "html", "classes", "weekDayIndex", "message", "main", "ppr", "panel", "inEdit", "bigEnough", "invSX", "invSY", "unscaledW", "unscaledH", "dpr", "tw", "th", "rr", "pat", "minCol", "maxCol", "minRow", "maxRow", "col", "hcol", "hrow", "_ev", "padL", "padT", "bordL", "bordT", "scrollX", "scrollY", "cx", "cy", "m2d", "m3d", "contCS", "bL", "bT", "canvRect", "viewportX", "viewportY", "outX", "outY", "outW", "outH", "snap", "sw", "sh", "mapped", "finalRect", "currentTab", "intersects", "r1", "r2", "hitCount", "wx", "wy", "wh", "__origAddPicked", "isAuto", "offX", "offY", "posX", "posY", "SEEN", "isLikelyCard", "rebuildOnce", "deepScan", "installOnInstance", "muts", "hookExisting", "ctor", "origConnected", "iv", "Cls", "_getLovelace", "_scanDdcCards", "_makeYamlBackup", "patch", "when", "backup", "_offerBackupDownload", "_recordRecentKey", "K", "_getRecentKeys", "_collectBackupKeys", "names", "_persistOptionsToYaml", "forceTargetKey", "onlyThisCard", "noDownload", "norm", "myKey", "cardsForStorage", "_fetchBackendKeys", "parseKeys", "urls", "_fetchLayoutByKey", "parseDesign", "tryCall", "method", "tryFetch", "ct", "j", "enc", "_applyDesignObject", "source", "toPersist", "_updateSwitcherVisibility", "edit", "hui", "_ensureInlineSwitcher", "fill", "serverKeys", "backupKeys", "recentKeys", "toUnique", "server", "backups", "makeGroup", "og", "none", "design", "oldKey", "persistOk", "persistOpts", "e2", "desc", "origSet", "origUpdate", "args"]
}
